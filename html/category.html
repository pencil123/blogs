<!DOCTYPE html>
<!-- saved from url=(0026)http://www2.cn-blogs.cn/0/ -->
<html lang="zh-CN" "="">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>MySQL 慢日志分析 | 青春部落</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" media="all" href="./css/style.css">
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="pingback" href="http://www2.cn-blogs.cn/xmlrpc.php">
    <link rel="dns-prefetch" href="http://s.w.org/">
<meta name="generator" content="WordPress 4.9.1">
    
</head>

<body class="home blog">
<header id="topbar">
    <div class="wrapper">
    <hgroup class="alignleft">
    <h2 class="alignleft"><p class="site-title"><a href="http://www2.cn-blogs.cn/" rel="home">青春部落</a></p></h2>
    </hgroup>
    记录生活的足迹
    <div class="alignright search">
     <div><form role="search" method="get" id="searchform" class="searchform" action="http://www2.cn-blogs.cn/">
				<div>
					<input type="text" value="" name="s" id="s">
					<input type="submit" id="searchsubmit" value="搜索">
				</div>
			</form></div>     </div>
    </div>
</header>
<div id="breadcrumb" class="wrapper">
<a href="/html">首页</a>>Mysql
</div>
<!-- 头部 -->
<div class="wrapper">
<div id="content">

<div class="post-box-title">MySQL 慢日志分析</div>
<div class="post-meta">2018-02-13由admin</div>
<div class="entry-content">
    <h2>pt-query-digest 慢日志分析工具</h2>
<p>可以分析的日志包括MySQL记录的日志（二进制日志，慢日志等）、processlist和TCPdump数据。</p>
<h2>Usage</h2>
<p><code>pt-query-digest [OPTIONS] [FILES] [DSN]</code><br />
pt-query-digest具有两个功能：查询查看（&#8211;review）和查询历史（&#8211;history）。<br />
<strong>当使用该&#8211;review 选项时</strong>，所有唯一查询将保存到数据库中。当该工具再次运行时&#8211;review，数据库中标记为已审阅的查询不会打印在报告中。这突出了需要审查的新查询。<br />
<strong>使用该&#8211;history选项时</strong>，每个唯一查询的查询度量标准（查询时间，锁定时间等）将保存到数据库中。每次使用该工具时&#8211;history，都会保存更多的历史数据，以便随着时间推移趋势和分析查询性能。<br />
pt-query-digest处理事件，这是一组称为属性的键值对。您将马上识别大部分属性： Query_time，Lock_time等等</p>
<h2>输出报告</h2>
<p><strong>第一部分：总体统计信息</strong><br />
Overall: 总共有多少条查询，上例为总共266个查询。<br />
Time range: 查询执行的时间范围。<br />
unique: 唯一查询数量，即对查询条件进行参数化以后，总共有多少个不同的查询，该例为55。<br />
total: 总计 min:最小 max: 最大 avg:平均<br />
95%: 把所有值从小到大排列，位置位于95%的那个数，这个数一般最具有参考价值。<br />
median: 中位数，把所有值从小到大排列，位置位于中间那个数。</p>
<p><strong>第二部分：查询分组统计信息</strong><br />
Response: 总的响应时间。<br />
time: 该查询在本次分析中总的时间占比。<br />
calls: 执行次数，即本次分析总共有多少条这种类型的查询语句。<br />
R/Call: 平均每次执行的响应时间。<br />
Item : 查询对象</p>
<p><strong>第三部分：每一unique查询的详细信息</strong><br />
Databases: 库名<br />
Users: 各个用户执行的次数（占比）<br />
Query_time distribution : 查询时间分布, 长短体现区间占比，本例中1s-10s之间查询数量是10s以上的两倍。<br />
Tables: 查询中涉及到的表<br />
Explain: 示例</p>
<h2>使用示例</h2>
<p>直接分析慢查询文件<br />
<code>pt-query-digest  slow.log &gt; slow_report.log</code></p>
<p>分析最近12小时内的查询<br />
<code>pt-query-digest  --since=12h  slow.log &gt; slow_report.log</code></p>
<p>分析指定时间范围内的查询：<br />
<code>pt-query-digest slow.log --since '2017-04-20 09:40:00' --until '2018-01-14 12:00:00'&gt; &gt; slow_report.log</code></p>
</div>
</div>


<div id="sidebar">


<div class="sidebox">
<div class="side-title">
近期文章
</div>

<div class="side-list">
<ul>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
</ul>
</div>
</div>


<div class="sidebox">
<div class="side-title">
文章列表
</div>

<div class="side-list">
<ul>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
<li>Mysql 数据库</li>
</ul>
</div>
</div>


<div class="sidebox">
<div class="side-title">
文章归档
</div>

<div class="side-list">
<ul>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
<li>2015年八月 (20)</li>
</ul>
</div>
</div>



</div>
</div>
<!-- 内容部分 -->
<footer id="footer">
<div class="wrapper footer-info">
Copyright©2015-20178 cn-blogs.cn. All Rights Reserved. 粤ICP备12040927号.
</div>
</footer><!-- .site-footer -->

<!-- .site -->
<script type="text/javascript" src="./js/wp-embed.min.js"></script>

</body></html>