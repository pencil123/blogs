<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>第6章安全</title>
<link rel="stylesheet" href="./images/mvl.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
<link rel="start" href="/mysql-5.7-google-zh/index.html" title="{书名}">
<link rel="up" href="/mysql-5.7-google-zh/security.html" title="">
<link rel="prev" href="/mysql-5.7-google-zh/server-administration.html" title="第5章MySQL服务器管理">
<link rel="next" href="/mysql-5.7-google-zh/backup-and-recovery.html" title="第7章备份和恢复">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./images/translateelement.css"></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tbody><tr>
<th colspan="3" align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章安全</font></font></th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/server-administration.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a>&nbsp;</td>
<th width="60%" align="center"></th>
<td width="20%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/backup-and-recovery.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
</tbody></table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="security"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章安全</font></font></h1>

</div>

</div>

</div>
<div class="toc">
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></b></p><dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#general-security-issues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1一般安全问题</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#security-guidelines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1安全指南</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#password-security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2确保密码安全</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#security-against-attack"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3使MySQL免受攻击者的攻击</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#security-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.4安全相关的mysqld选项和变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#changing-mysql-user"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.5如何以普通用户身份运行MySQL</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#load-data-local"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.6 LOAD DATA LOCAL的安全问题</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#secure-client-programming"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.7客户端编程安全指南</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#privilege-system"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2 MySQL访问权限系统</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#privileges-provided"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1由MySQL提供的权限</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#grant-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.2授予表格</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#account-names"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.3指定帐户名称</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#connection-access"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.4访问控制，阶段1：连接验证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#request-access"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.5访问控制，阶段2：请求验证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#privilege-changes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.6特权更改生效时</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#problems-connecting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.7排除连接到MySQL的问题</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#user-account-management"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3 MySQL用户帐户管理</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#user-names"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.1用户名和密码</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#adding-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.2添加用户帐户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#removing-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.3删除用户帐户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#reserved-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.4保留用户帐户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#user-resources"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.5设置帐户资源限制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#assigning-passwords"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.6分配帐户密码</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#password-management"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.7密码管理</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#expired-password-handling"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.8密码过期和沙盒模式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.9可插入认证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#proxy-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.10代理用户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#account-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.11用户帐户锁定</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#account-activity-auditing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.12基于SQL的MySQL账户活动审计</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#encrypted-connections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4使用加密连接</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#using-encrypted-connections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.1配置MySQL以使用加密连接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#encrypted-connection-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.2加密连接的命令选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3创建SSL和RSA证书和密钥</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#ssl-libraries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.4 OpenSSL与yaSSL</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#building-with-encrypted-connection-support"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.5构建支持加密连接的MySQL</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.6加密的连接协议和密码</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#windows-and-ssh"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.7通过SSH从Windows远程连接到MySQL</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#security-plugins"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5安全插件</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#authentication-plugins"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1身份验证插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#connection-control"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.2连接控制插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#validate-password"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.3密码验证插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4 MySQL Keyring</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5 MySQL企业审计</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#firewall"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6 MySQL企业防火墙</font></font></a></span></dt></dl></dd></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在考虑MySQL安装中的安全性时，您应该考虑各种可能的主题以及它们如何影响MySQL服务器和相关应用程序的安全性：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        影响安全性的一般因素。</font><font style="vertical-align: inherit;">这些包括选择良好的密码，不授予用户不必要的特权，通过防止SQL注入和数据损坏等来确保应用程序的安全性。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#general-security-issues" title="6.1一般安全问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1节“常规安全问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        安装本身的安全性。</font><font style="vertical-align: inherit;">数据文件，日志文件以及安装的所有应用程序文件应受到保护，以确保它们不可被未授权方读取或写入。</font><font style="vertical-align: inherit;">有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#postinstallation" title="2.10安装后设置和测试"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10节“安装后的安装和测试”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        数据库系统本身的访问控制和安全性，包括授予访问数据库的用户和数据库，视图和数据库中正在使用的存储程序。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#privilege-system" title="6.2 MySQL访问权限系统"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2节“MySQL访问权限系统”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#user-account-management" title="6.3 MySQL用户帐户管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3节“MySQL用户帐户管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        安全相关插件提供的功能。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#security-plugins" title="6.5安全插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5节“安全插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL和你的系统的网络安全。</font><font style="vertical-align: inherit;">安全性与个人用户的授权相关，但您也可能希望限制MySQL，使其仅在MySQL服务器主机上本地可用，或仅限于其他有限的其他主机。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        确保您有足够和适当的数据库文件备份，配置和日志文件。</font><font style="vertical-align: inherit;">另外，请确保您有适当的恢复解决方案，并测试您是否能够成功恢复备份中的信息。</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html" title="第7章备份和恢复"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份和恢复</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="general-security-issues"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1一般安全问题</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#security-guidelines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1安全指南</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#password-security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2确保密码安全</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#security-against-attack"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3使MySQL免受攻击者的攻击</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#security-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.4安全相关的mysqld选项和变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#changing-mysql-user"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.5如何以普通用户身份运行MySQL</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#load-data-local"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.6 LOAD DATA LOCAL的安全问题</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#secure-client-programming"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.7客户端编程安全指南</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528120776592"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本节介绍一般安全性问题，以及您可以如何使MySQL安装更加安全，防止攻击或误用。</font><font style="vertical-align: inherit;">有关MySQL用于设置用户帐户和检查数据库访问的访问控制系统的具体信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#postinstallation" title="2.10安装后设置和测试"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10节“安装后的安装和测试”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关MySQL服务器安全问题经常被问及的一些问题的答案，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/faqs.html#faqs-security" title="A.9 MySQL 5.7常见问题解答：安全性"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第A.9节“MySQL 5.7 FAQ：安全性”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-guidelines"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1安全指南</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528120771328"></a><a class="indexterm" name="idm140528120770256"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在连接到互联网的计算机上使用MySQL的任何人都应阅读本节以避免最常见的安全错误。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在讨论安全性时，有必要考虑全面保护整个服务器主机（而不仅仅是MySQL服务器），以抵御所有类型的适用攻击：窃听，修改，回放和拒绝服务。</font><font style="vertical-align: inherit;">我们并未涵盖可用性和容错的所有方面。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL为所有连接，查询和用户可以尝试执行的其他操作使用基于访问控制列表（ACL）的安全性。</font><font style="vertical-align: inherit;">还支持MySQL客户端和服务器之间的SSL加密连接。</font><font style="vertical-align: inherit;">这里讨论的许多概念都不是特定于MySQL的; </font><font style="vertical-align: inherit;">几乎所有的应用程序都适用相同的一般思路。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      运行MySQL时，请遵循以下准则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永远不要给任何人（除了MySQL
           </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户）访问</font><font style="vertical-align: inherit;">
          数据库中</font><font style="vertical-align: inherit;">的
           </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这很关键。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          了解MySQL访问权限系统的工作方式（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#privilege-system" title="6.2 MySQL访问权限系统"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2节“MySQL访问权限系统”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来控制对MySQL的访问。</font><font style="vertical-align: inherit;">不要给予超出必要的特权。</font><font style="vertical-align: inherit;">切勿将权限授予所有主机。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          清单：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              尝试</font></font><code class="literal">mysql -u root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您能够成功连接到服务器而不需要密码，任何人都可以以</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有完全权限</font><font style="vertical-align: inherit;">的MySQL </font><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">身份连接到MySQL服务器</font><font style="vertical-align: inherit;">！</font><font style="vertical-align: inherit;">查看MySQL安装说明，特别注意关于设置</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font><font style="vertical-align: inherit;">的信息
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#default-privileges" title="2.10.4确保初始MySQL帐户的安全"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10.4节“确保初始MySQL帐户的安全”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-grants" title="13.7.5.21 SHOW GRANTS语法"><code class="literal">SHOW GRANTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句来检查哪些帐户有权访问什么。</font><font style="vertical-align: inherit;">然后使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句删除那些不必要的权限。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不要在数据库中存储明文密码。</font><font style="vertical-align: inherit;">如果您的计算机受到威胁，入侵者可以获取完整的密码列表并使用它们。</font><font style="vertical-align: inherit;">相反，使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sha2"><code class="literal">SHA2()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或其他一些单向散列函数并存储散列值。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要防止使用彩虹表进行密码恢复，请不要在普通密码上使用这些功能; </font><font style="vertical-align: inherit;">相反，选择一些字符串作为盐，并使用散列（哈希（密码）+盐）值。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不要从字典中选择密码。</font><font style="vertical-align: inherit;">存在破解密码的特殊程序。</font><font style="vertical-align: inherit;">即使像</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xfish98</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的密码
           </font><font style="vertical-align: inherit;">也很糟糕。</font><font style="vertical-align: inherit;">更好的是
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duag98</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含相同的单词
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鱼</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但在标准的QWERTY键盘上键入左侧的一个键。</font><font style="vertical-align: inherit;">另一种方法是使用从句子中每个单词的第一个字符获取的密码（例如，</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">四七七年前</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致密码为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fsasya</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">密码很容易记住和键入，但对于不知道该句子的人很难猜出。</font><font style="vertical-align: inherit;">在这种情况下，您可以另外用数字替换数字来获得短语</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4分和7年前</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，产生</font><font style="vertical-align: inherit;">更难猜测</font><font style="vertical-align: inherit;">的密码</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4sa7ya</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          投资于防火墙。</font><font style="vertical-align: inherit;">这可以保护您免受任何软件中至少50％的所有类型的漏洞攻击。</font><font style="vertical-align: inherit;">将MySQL放在防火墙后面或非军事区（DMZ）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          清单：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              尝试使用类似的工具从Internet扫描您的端口</font></font><code class="literal">nmap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQL默认使用端口3306。</font><font style="vertical-align: inherit;">不应该从不受信任的主机访问此端口。</font><font style="vertical-align: inherit;">作为检查MySQL端口是否打开的简单方法，请尝试从某个远程计算机执行以下命令，其中</font></font><em class="replaceable"><code>server_host</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是运行MySQL服务器的主机的主机名或IP地址：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>telnet <em class="replaceable"><code>server_host</code></em> 3306</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telnet</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">挂起或连接被拒绝，则该端口被阻止，这是您希望的方式。</font><font style="vertical-align: inherit;">如果你得到一个连接和一些垃圾字符，端口是开放的，并且应该在你的防火墙或路由器上关闭，除非你确实有充分的理由保持它打开。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          访问MySQL的应用程序不应该信任用户输入的任何数据，应该使用适当的防御性编程技术来编写。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#secure-client-programming" title="6.1.7客户端编程安全指南"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.7节“客户端编程安全指南”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不要通过Internet传输简单（未加密）的数据。</font><font style="vertical-align: inherit;">每个有时间和能力的人都可以访问这些信息，并将其用于自己的目的。</font><font style="vertical-align: inherit;">相反，请使用SSL或SSH等加密协议。</font><font style="vertical-align: inherit;">MySQL支持内部SSL连接。</font><font style="vertical-align: inherit;">另一种技术是使用SSH端口转发为通信创建加密（和压缩）隧道。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          学习使用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcpdump</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序。</font><font style="vertical-align: inherit;">在大多数情况下，您可以通过发出如下命令来检查MySQL数据流是否未加密：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>tcpdump -l -i eth0 -w - src or dst port 3306 | strings</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这在Linux下可用，并且应该在其他系统下进行小修改。
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您没有看到明文数据，这并不总意味着信息实际上是加密的。</font><font style="vertical-align: inherit;">如果您需要高安全性，请咨询安全专家。
</font></font></p>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="password-security"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2确保密码安全</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#password-security-user"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.1密码安全的最终用户指南</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#password-security-admin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.2密码安全管理员指南</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#password-logging"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.3密码和记录</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#password-hashing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.4 MySQL中的密码散列</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528120724176"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      密码出现在MySQL的几个上下文中。</font><font style="vertical-align: inherit;">以下各节提供了使最终用户和管理员能够保证这些密码安全并避免暴露这些密码的指导原则。</font><font style="vertical-align: inherit;">另外还讨论了MySQL如何在内部使用密码散列以及如何使用可用于实施更严格密码的插件。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-security-user"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.1密码安全的最终用户指南</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528120720784"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL用户应该使用以下准则来确保密码的安全。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当您运行客户端程序以连接到MySQL服务器时，以将其公开给其他用户的方式指定您的密码是不可取的。</font><font style="vertical-align: inherit;">这里列出了您在运行客户端程序时用于指定密码的方法，以及每种方法的风险评估。</font><font style="vertical-align: inherit;">简而言之，最安全的方法是让客户端程序提示输入密码或在正确保护的选项文件中指定密码。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-config-editor" title="4.6.6 mysql_config_editor  -  MySQL配置实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_config_editor</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序，该实用程序使您可以将认证凭证存储在名为的加密登录路径文件中
             </font></font><code class="filename">.mylogin.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQL客户端程序可以稍后阅读该文件，以获取用于连接到MySQL服务器的认证凭证。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysql-config-editor" title="4.6.6 mysql_config_editor  -  MySQL配置实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.6节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_config_editor</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  MySQL配置实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528120713440"></a>

            <a class="indexterm" name="idm140528120712368"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在命令行上</font><font style="vertical-align: inherit;">

            使用
             </font><font style="vertical-align: inherit;">或
             </font><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">例如：
          </font></font><code class="option">-p<em class="replaceable"><code>your_pass</code></em></code><font style="vertical-align: inherit;"></font><code class="option">--password=<em class="replaceable"><code>your_pass</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -u francis -pfrank <em class="replaceable"><code>db_name</code></em></code></strong>
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这很方便</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不安全</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在某些系统上，您的密码对系统状态程序（如</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps）</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可见，</font><font style="vertical-align: inherit;">可由其他用户调用以显示命令行。</font><font style="vertical-align: inherit;">MySQL客户端通常在其初始化序列中用零覆盖命令行密码参数。</font><font style="vertical-align: inherit;">但是，仍然有一个短暂的时间间隔，可以看到该值。</font><font style="vertical-align: inherit;">另外，在某些系统上，这种覆盖策略是无效的，密码对</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然可见</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（SystemV Unix系统和其他可能会遇到这个问题。）
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您的操作环境设置为在终端窗口的标题栏中显示当前命令，则只要该命令正在运行，密码仍然可见，即使该命令在窗口内容区域中滚动出视图也是如此。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在命令行上</font><font style="vertical-align: inherit;">
            使用</font></font><code class="option">-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="option">--password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，没有指定密码值。</font><font style="vertical-align: inherit;">在这种情况下，客户端程序交互式地请求密码：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -u francis -p <em class="replaceable"><code>db_name</code></em></code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码： ********</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些</font></font><code class="literal">*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符表示您输入密码的位置。</font><font style="vertical-align: inherit;">输入密码时不显示密码。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以这种方式输入密码比在命令行上指定密码更安全，因为其他用户不可见。</font><font style="vertical-align: inherit;">但是，这种输入密码的方法仅适用于交互式运行的程序。</font><font style="vertical-align: inherit;">如果您想从非交互式脚本中调用客户端，则无法通过键盘输入密码。</font><font style="vertical-align: inherit;">在某些系统上，您甚至可能会发现脚本的第一行被读取并解释（错误地）为您的密码。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528120697024"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

            将您的密码存储在选项文件中。</font><font style="vertical-align: inherit;">例如，在Unix上，您可以</font><font style="vertical-align: inherit;">在您的主目录</font></font><code class="literal">[client]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font></font><code class="filename">.my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">部分
             </font><font style="vertical-align: inherit;">列出您的密码
             </font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[客户]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
密码= your_pass的</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为确保密码安全，除了您自己以外，任何人都无法访问该文件。</font><font style="vertical-align: inherit;">为确保这一点，请将文件访问模式设置为</font></font><code class="literal">400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">600</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>chmod 600 .my.cnf</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要从命令行命名包含密码的特定选项文件，请使用
             </font><font style="vertical-align: inherit;">
            选项，其中</font><font style="vertical-align: inherit;">是该文件的完整路径名。</font><font style="vertical-align: inherit;">例如：
          </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_defaults-file"><code class="option">--defaults-file=<em class="replaceable"><code>file_name</code></em></code></a><font style="vertical-align: inherit;"></font><code class="filename">file_name</code><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql --defaults-file=/home/francis/mysql-opts</code></strong>
</pre><p>
            <a class="xref" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.6节“使用选项文件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更详细地讨论选项文件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将您的密码存储在</font></font><code class="literal">MYSQL_PWD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            环境变量中。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#environment-variables" title="4.9 MySQL程序环境变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.9节“MySQL程序环境变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这种指定你的MySQL密码的方法必须被认为是</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常不安全的</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，不应该被使用。</font><font style="vertical-align: inherit;">某些版本的</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            包含显示正在运行的进程环境的选项。</font><font style="vertical-align: inherit;">在某些系统上，如果您设置了</font></font><code class="literal">MYSQL_PWD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font><font style="vertical-align: inherit;">，那么您
             </font><font style="vertical-align: inherit;">的密码将暴露给运行</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps的</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何其他用户</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">即使在没有这种</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本的系统上</font><font style="vertical-align: inherit;">，假设没有其他用户可以检查过程环境的方法也是不明智的。
</font></font></p></li></ul>
</div>
<a class="indexterm" name="idm140528120677664"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在Unix上，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端将执行语句的记录写入历史文件（参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysql-logging" title="4.5.1.3 mysql日志记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.5.1.3节“mysql日志记录”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">默认情况下，该文件被命名
         </font></font><code class="filename">.mysql_history</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在您的主目录中创建。</font><font style="vertical-align: inherit;">密码可以在SQL语句（如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        和）中</font><font style="vertical-align: inherit;">以纯文本形式写入</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此如果使用这些语句，则会将其记录在历史记录文件中。</font><font style="vertical-align: inherit;">为了保证这个文件的安全，使用限制性访问模式，就像前面对</font></font><code class="filename">.my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">描述的一样</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您的命令解释程序配置为保留历史记录，则保存命令的任何文件都将包含在命令行中输入的MySQL密码。</font><font style="vertical-align: inherit;">例如，
         </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bash</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
         </font></font><code class="filename">~/.bash_history</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">任何这样的文件都应该有一个限制性的访问模式。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-security-admin"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.2密码安全管理员指南</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528120666544"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        数据库管理员应该使用以下准则来确保密码的安全。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL在</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">存储用户帐户的密码
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">永远不应该授予任何非行政账户。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        帐户密码可以过期，以便用户必须重置它们。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-management" title="6.3.7密码管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.7节“密码管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#expired-password-handling" title="6.3.8密码过期和沙盒模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.8节“密码过期和沙箱模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件可用于强制执行可接受的密码策略。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#validate-password" title="6.5.3密码验证插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.3节“密码验证插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有权修改插件目录（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">）或</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定插件目录位置</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">文件的用户可以替换插件并修改插件提供的功能，包括身份验证插件。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        诸如可能写入密码的日志文件等文件应该受到保护。</font><font style="vertical-align: inherit;">参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-logging" title="6.1.2.3密码和记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.3节“密码和记录”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-logging"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.3密码和记录</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528120654592"></a><a class="indexterm" name="idm140528120653104"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        口令可以写在SQL语句，如纯文本
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET
        PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和语句调用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数。</font><font style="vertical-align: inherit;">如果MySQL服务器记录了这样的语句，那么访问日志的任何人都可以看到它们的密码。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句记录可以避免为以下语句以明文形式编写密码：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER ... IDENTIFIED BY ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER USER ...被IDENTIFIED BY ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT ... IDENTIFIED BY ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置密码 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从属开始...密码= ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE SERVER ... OPTIONS（... PASSWORD ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER SERVER ...选项（... PASSWORD ...）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些语句中的密码被重写为不会写入写入常规查询日志，慢查询日志和二进制日志的语句文本中。</font><font style="vertical-align: inherit;">重写不适用于其他语句。</font><font style="vertical-align: inherit;">特别是，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对
         </font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表引用文字密码的语句按原样记录，所以您应该避免使用这些语句。</font><font style="vertical-align: inherit;">（无论如何，不​​鼓励直接修改授权表。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于一般查询日志，可以通过使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器来抑制密码重写
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">出于安全原因，不建议将此选项用于生产用途。</font><font style="vertical-align: inherit;">出于诊断目的，查看服务器收到的语句的确切文本可能很有用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        审计日志插件生成的审计日志文件的内容未加密。</font><font style="vertical-align: inherit;">出于安全原因，这个文件应该写入一个只能由MySQL服务器访问的目录以及具有合法理由查看日志的用户。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-security" title="6.5.5.3 MySQL企业审计安全注意事项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.3节“MySQL企业审计安全注意事项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果安装了查询重写插件，则服务器收到的语句可能会被重写（请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#query-rewrite-plugin-type" title="查询重写插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写插件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在这种情况下，该
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项会影响语句记录，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果没有</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，服务器将记录查询重写插件返回的语句。</font><font style="vertical-align: inherit;">这可能与收到的声明有所不同。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用时</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，服务器将收到的原始语句记录下来。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密码重写的含义是无法解析的语句（例如，由于语法错误）不会写入常规查询日志，因为它们不能被称为无密码。</font><font style="vertical-align: inherit;">需要记录所有语句（包括具有错误的语句）的用例应使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，同时请记住，这也会绕过密码重写。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密码重写仅在需要纯文本密码时才会发生。</font><font style="vertical-align: inherit;">对于需要密码哈希值的语法，不会发生重写。</font><font style="vertical-align: inherit;">如果为这种语法错误地提供明文密码，则密码将按给定的方式记录，而不会重写。</font><font style="vertical-align: inherit;">例如，下面的语句会按照所示进行记录，因为需要密码哈希值：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'user1'@'localhost'IDENTIFIED BY PASSWORD'not-so-secret';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要防范日志文件遭受无端暴露，请将它们放入限制访问服务器和数据库管理员的目录中。</font><font style="vertical-align: inherit;">如果服务器记录到</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中的</font><font style="vertical-align: inherit;">表中，请将
         </font><font style="vertical-align: inherit;">这些表的访问权限授予数据库管理员。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        复制从服务器将复制主服务器的密码存储在主信息存储库中，该存储库可以是文件或表（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">确保只能由数据库管理员访问存储库。</font><font style="vertical-align: inherit;">将密码存储在文件中的替代方法是使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句指定用于连接到主设备的凭证。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用受限制的访问模式来保护包含日志表或包含密码的日志文件的数据库备份。
</font></font></p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-hashing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.4 MySQL中的密码散列</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528120621280"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节中的信息仅在MySQL 5.7.5之前适用，并且仅适用于使用</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认证插件的</font><font style="vertical-align: inherit;">帐户
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7.5中删除了对4.1之前的密码哈希的支持。</font><font style="vertical-align: inherit;">这包括删除
           </font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证插件和</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          函数。</font><font style="vertical-align: inherit;">此外，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不能被禁用，并且
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能设置为1。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从MySQL 5.7.5开始，只有关于4.1密码哈希和</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          认证插件的信息保持相关。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">列出用户帐户</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个MySQL帐户都可以分配一个密码，尽管该</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表不存储密码的明文版本，但是</font><font style="vertical-align: inherit;">会计</font><font style="vertical-align: inherit;">算出一个哈希值。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL在客户端/服务器通信的两个阶段使用密码：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当客户端尝试连接到服务器时，有一个初始身份验证步骤，客户端必须提供一个密码，该密码的哈希值与</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户机希望使用的帐户的表中</font><font style="vertical-align: inherit;">存储的哈希值相匹配</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            客户端连接后，它可以（如果它有足够的权限）设置或更改</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">列出的帐户的密码哈希值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">客户端可以通过做这个
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能来生成密码哈希值，或使用一个密码生成的语句（</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        换句话说，</font><font style="vertical-align: inherit;">当客户端首次尝试连接时</font><font style="vertical-align: inherit;">，服务器</font><font style="vertical-align: inherit;">在验证过程中</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列值。</font><font style="vertical-align: inherit;">如果连接的客户端调用该</font><font style="vertical-align: inherit;">函数或使用密码生成语句来设置或更改密码</font><font style="vertical-align: inherit;">，则服务器会</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希值
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL中的密码哈希方法具有以下描述的历史记录。</font><font style="vertical-align: inherit;">这些更改通过</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        计算密码哈希值</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">函数以及</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储密码</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的结构中的</font><font style="vertical-align: inherit;">更改来说明。
</font></font></p>
<h5><a name="idm140528120593984"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始（4.1之前的）散列方法</font></font></h5>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        原始的哈希方法产生了一个16字节的字符串。</font><font style="vertical-align: inherit;">这样的哈希看起来像这样：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PASSWORD('mypass');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">密码（'mypass'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6f8c114b58f2ce9e |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要存储帐户密码，</font><font style="vertical-align: inherit;">表格的这一</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        列</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这一点上是16个字节。
</font></font></p>
<h5><a name="idm140528120589072"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1哈希法</font></font></h5>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL 4.1引入了密码哈希，提供了更好的安全性并降低了密码被截取的风险。</font><font style="vertical-align: inherit;">这种变化有几个方面：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数
           </font><font style="vertical-align: inherit;">
            生成的密码值的不同格式
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            加宽</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">色谱柱
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制默认的散列方法
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制尝试连接到服务器的客户端所允许的哈希方法
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL 4.1的变化发生在两个阶段：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL 4.1.0使用了4.1哈希方法的初步版本。</font><font style="vertical-align: inherit;">这种方法很短暂，下面的讨论没有提到更多关于它的内容。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 4.1.1中，哈希方法被修改以产生更长的41字节哈希值：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PASSWORD('mypass');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">密码（'mypass'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">* 6C8989366EAF75BB670AD8EA7A7FC1176A95CEF4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            较长的密码哈希格式具有更好的加密属性，基于长哈希的客户端验证比基于较旧的短哈希更安全。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了适应更长的密码散列，</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的
             </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列在
             </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处被更改为41字节，即当前长度。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            加宽的</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列可以存储4.1以前版本和4.1版本的密码哈希值。</font><font style="vertical-align: inherit;">任何给定散列值的格式可以通过两种方式确定：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                长度：4.1和4.1之前的哈希分别是41和16个字节。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                4.1格式的密码哈希总是以一个</font></font><code class="literal">*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符</font><font style="vertical-align: inherit;">开始
                 </font><font style="vertical-align: inherit;">，而4.1之前的格式的密码永远不会。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了允许明确生成4.1以前的密码哈希，我们做了两项额外的修改：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                函数被添加，它以16字节的格式返回散列值。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为了兼容，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">了
                 </font><font style="vertical-align: inherit;">系统变量，以使DBA和应用程序能够控制散列方法。</font><font style="vertical-align: inherit;">默认
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为0会导致哈希使用4.1方法（41字节哈希值），但设置
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希将使用4.1之前的方法。</font><font style="vertical-align: inherit;">在这种情况下，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生16个字节的值并相当于
                </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了允许DBA控制客户端被允许连接的方式，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量被添加了。</font><font style="vertical-align: inherit;">在禁用或启用此变量的情况下启动服务器允许或禁止客户端使用旧的4.1之前的密码散列方法进行连接。</font><font style="vertical-align: inherit;">在MySQL 5.6.5之前，
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下是禁用的。</font><font style="vertical-align: inherit;">从5.6.5开始，
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下启用，以促进更安全的默认配置DBA可以自行禁用它，但不建议这样做，并且4.1之前的密码哈希值已被弃用，应该避免。</font><font style="vertical-align: inherit;">（有关帐户升级说明，请参阅
            </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#account-upgrades" title="6.5.1.3从4.1之前的密码散列和mysql_old_password插件迁移"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.3节，“从4.1之前的密码散列和mysql_old_password插件迁移”）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            另外，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端支持</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_secure-auth"><code class="option">--secure-auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似于</font><font style="vertical-align: inherit;">客户端的
             </font><font style="vertical-align: inherit;">选项</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它可以用来阻止使用4.1之前的密码散列的较不安全帐户的连接。</font><font style="vertical-align: inherit;">此选项在MySQL 5.6.7之前默认为禁用，此后启用。
</font></font></p></li></ul>
</div>
<h5><a name="idm140528120550544"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与散列方法相关的兼容性问题</font></font></h5>
<p><font style="vertical-align: inherit;"></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.1 </font><font style="vertical-align: inherit;">
        中的</font><font style="vertical-align: inherit;">列从16字节扩展到41字节会影响安装或升级操作，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您执行MySQL的新安装，则该
             </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列会自动变为41个字节。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 4.1或更高版本升级到当前版本的MySQL不应引起与</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">有关的任何问题，
             </font><font style="vertical-align: inherit;">因为两个版本使用相同的列长度和密码散列方法。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于从4.1之前版本升级到4.1或更高版本，升级后必须升级系统表。</font><font style="vertical-align: inherit;">（请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.4.7节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 检查并升级MySQL表”）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        4.1 hashing方法只能被MySQL 4.1（和更高版本）服务器和客户端所理解，这可能会导致一些兼容性问题。</font><font style="vertical-align: inherit;">4.1或更高版本的客户端可以连接到4.1之前的服务器，因为客户端可以理解4.1之前的密码哈希方法和4.1之前的密码哈希方法。</font><font style="vertical-align: inherit;">但是，尝试连接到4.1或更高版本的服务器的4.1之前的客户端可能会遇到困难。</font><font style="vertical-align: inherit;">例如，4.0 </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端可能会失败，并显示以下错误消息：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -h localhost -u root</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
客户端不支持请求的身份验证协议</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过服务器; </font><font style="vertical-align: inherit;">考虑升级MySQL客户端</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在升级到MySQL 4.1或更高版本后</font><font style="vertical-align: inherit;">
        ，尝试使用较旧的PHP </font><font style="vertical-align: inherit;">扩展</font><font style="vertical-align: inherit;">也会出现这种现象
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（请参阅</font></font><a class="ulink" href="http://dev.mysql.com/doc/apis-php/en/apis-php-problems.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL和PHP的常见问题</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下面的讨论描述了4.1之前和4.1之间的哈希方法之间的区别，以及如果升级服务器时应该做什么，但是需要保持与4.1以前的客户端的向后兼容性。</font><font style="vertical-align: inherit;">（但是，不建议允许旧客户端进行连接，并应尽可能避免使用这些信息。）这些信息对于PHP程序员将MySQL数据库从4.1以上版本迁移到4.1或更高版本特别重要。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        短密码和长密码哈希之间的区别与服务器在身份验证过程中如何使用密码以及如何为执行密码更改操作的连接客户端生成密码哈希有关。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在认证过程中服务器使用密码散列的方式受</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的宽度影响
         </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果该列较短，则只使用短散列身份验证。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果该列很长，则可以保存短或长的哈希值，并且服务器可以使用以下任一格式：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                4.1之前的客户端可以连接，但因为他们只知道4.1之前的散列方法，所以他们只能使用短散列的帐户进行认证。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                4.1和更高版本的客户端可以使用短或长哈希值的帐户进行身份验证。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        即使对于短散列账户，对于4.1及更高版本的客户端来说，认证过程实际上比旧客户端更安全一些。</font><font style="vertical-align: inherit;">就安全性而言，从最小到最安全的梯度是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用短密码散列进行4.1之前的客户端认证
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            4.1或更高版本的客户端使用短密码散列进行验证
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            4.1或更高版本的客户端使用长密码哈希进行验证
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器为连接的客户端生成密码哈希的方式受</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的宽度
         </font><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量的影响。</font><font style="vertical-align: inherit;">只有满足特定条件时，4.1或更高版本的服务器才会生成长哈希值：该</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列必须足够宽才能保存长值，且
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能设置为1。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些条件适用如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列必须足够宽以容纳长哈希（41个字节）。</font><font style="vertical-align: inherit;">如果列未被更新并且仍然具有16字节以前的宽度，则服务器注意到长哈希不适合它并且当客户端使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数或密码生成</font><font style="vertical-align: inherit;">来执行密码改变操作时仅生成短哈希
             </font><font style="vertical-align: inherit;">声明。</font><font style="vertical-align: inherit;">这是如果您从早于4.1的MySQL版本升级到4.1或更高版本，但尚未运行
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序以
             </font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables"><span class="command"><strong><font style="vertical-align: inherit;">扩展</font></strong></span></a></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的情况下发生的行为。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列很宽，它可以存储短或长密码散列。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数和密码生成语句会生成长哈希，除非服务器启动时
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量设置为1，以强制服务器生成短密码哈希值。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">
        的目的
         </font><font style="vertical-align: inherit;">是在服务器否则会产生长密码散列的情况下允许与4.1之前的客户端向后兼容。</font><font style="vertical-align: inherit;">该选项不会影响身份验证（4.1和更高版本的客户端仍然可以使用具有长密码哈希的帐户），但它确实可以防止在</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码更改操作</font><font style="vertical-align: inherit;">中在</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">创建长密码哈希值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果允许发生这种情况，4.1之前的客户不能再使用该账户。</font><font style="vertical-align: inherit;">随着
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">残疾人，以下不良情况是可能的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            旧的4.1之前的客户端连接到具有短密码哈希的帐户。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            客户端更改自己的密码。</font><font style="vertical-align: inherit;">在
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用的情况下，这会导致帐户拥有较长的密码哈希。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            下一次旧客户端尝试连接到该帐户时，它不能，因为该帐户有一个长密码哈希，需要在验证过程中使用4.1哈希方法。</font><font style="vertical-align: inherit;">（一旦帐户在用户表中有一个长密码散列，只有4.1和更高版本的客户端可以进行认证，因为4.1之前的客户端不理解长哈希。）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这种情况说明，如果您必须支持较早的4.1之前的客户端，那么在未</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为1的</font><font style="vertical-align: inherit;">情况下运行4.1或更高版本的服务器会有问题</font><font style="vertical-align: inherit;">。通过运行服务器
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，密码更改操作不会生成长密码哈希值，因此不会生成长密码哈希值导致旧帐户无法访问帐户。</font><font style="vertical-align: inherit;">（这些客户不会无意中通过更改密码来锁定自己，并最终获得长密码哈希。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        缺点</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        是任何创建或更改的密码都使用较短的哈希值，即使是4.1或更高版本的客户端也是如此。</font><font style="vertical-align: inherit;">因此，您失去了长密码哈希提供的额外安全性。</font><font style="vertical-align: inherit;">要创建具有长散列值的帐户（例如，供4.1客户端使用）或将现有帐户更改为使用长密码散列值，管理员可以将会话值
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为0，同时将全局值设置为1：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SET @@session.old_passwords = 0;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@session.old_passwords, @@global.old_passwords;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ session.old_passwords | </font><font style="vertical-align: inherit;">@@ global.old_passwords |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>CREATE USER 'newuser'@'localhost' IDENTIFIED BY 'newpass';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.03秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SET PASSWORD FOR 'existinguser'@'localhost' = PASSWORD('existingpass');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下情况在MySQL 4.1或更高版本中是可能的。</font><font style="vertical-align: inherit;">这些因素是</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列是短还是长，以及如果长时间，服务器是
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用启用还是禁用。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">场景1：</font></font></strong></span><font style="vertical-align: inherit;"></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户表中的</font><font style="vertical-align: inherit;">短
        </font><font style="vertical-align: inherit;">列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            只有短的哈希可以存储在
             </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器在客户端身份验证期间仅使用较短的哈希。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于连接的客户端，涉及</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            函数或密码生成语句的</font><font style="vertical-align: inherit;">密码哈希生成操作</font><font style="vertical-align: inherit;">仅使用短哈希。</font><font style="vertical-align: inherit;">对帐户密码的任何更改都会导致该帐户拥有较短的密码哈希值。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是无关紧要的，因为对于较短的
             </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，服务器无论如何都只生成简短密码散列。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当4.1版之前的MySQL安装已升级到4.1或更高版本，但</font><font style="vertical-align: inherit;">
        尚未运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以升级</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">的系统表时，会发生此情况
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这不是推荐的配置，因为它不允许使用更安全的4.1密码散列。）
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情景2：</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长
        </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列; </font><font style="vertical-align: inherit;">服务器开始于
        </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            短列或长</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">可以存储在
             </font><font style="vertical-align: inherit;">列中。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            4.1和更高版本的客户端可以对具有短或长哈希的帐户进行身份验证。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            4.1之前的客户端只能对具有较短哈希值的帐户进行身份验证。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于连接的客户端，涉及</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            函数或密码生成语句的</font><font style="vertical-align: inherit;">密码哈希生成操作</font><font style="vertical-align: inherit;">仅使用短哈希。</font><font style="vertical-align: inherit;">对帐户密码的任何更改都会导致该帐户拥有较短的密码哈希值。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，新创建的帐户具有短密码哈希，因为</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        防止产生长哈希。</font><font style="vertical-align: inherit;">此外，如果您在设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为1 </font><font style="vertical-align: inherit;">之前创建一个包含长散列的帐户，那么在
         </font><font style="vertical-align: inherit;">更改帐户的密码时会
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致帐户被设置一个简短的密码，导致它失去了较长散列的安全优势。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要创建一个长密码散列的新帐户，或者要将任何现有帐户的密码更改为使用长散列，请首先</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将会话</font><font style="vertical-align: inherit;">值
         </font><font style="vertical-align: inherit;">设置为0，同时将全局值设置为1，如前所述。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，服务器有一个最新的
         </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，但运行默认密码散列方法来生成4.1之前的散列值。</font><font style="vertical-align: inherit;">这不是推荐的配置，但在4.1之前的客户端和密码升级到4.1或更高版本的过渡时期可能会有用。</font><font style="vertical-align: inherit;">完成后，最好使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font><font style="vertical-align: inherit;">运行服务器
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情景3：</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长
        </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列; </font><font style="vertical-align: inherit;">服务器开始于
        </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            短列或长</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">可以存储在
             </font><font style="vertical-align: inherit;">列中。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            4.1和更高版本的客户端可以使用短或长哈希值的帐户进行身份验证。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            4.1之前的客户端只能使用短哈希值的帐户进行身份验证。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于连接的客户端，涉及</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            函数或密码生成语句的</font><font style="vertical-align: inherit;">密码哈希生成操作</font><font style="vertical-align: inherit;">仅使用长哈希。</font><font style="vertical-align: inherit;">对帐户密码的更改会导致该帐户拥有较长的密码哈希。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如前所述，这种情况的一个危险之处在于，4.1之前的客户端可能无法访问具有短密码散列的帐户。</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数或密码生成语句</font><font style="vertical-align: inherit;">对该帐户的密码进行
         </font><font style="vertical-align: inherit;">的更改会导致该帐户被授予长密码哈希值。</font><font style="vertical-align: inherit;">从那时起，4.1之前的客户端无法使用该帐户连接到服务器。</font><font style="vertical-align: inherit;">客户端必须升级到4.1或更高版本。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果这是一个问题，您可以用特殊方式更改密码。</font><font style="vertical-align: inherit;">例如，通常您使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET
        PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下方式更改帐户密码：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET PASSWORD FOR' </font></font><em class="replaceable"><code>some_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'@' </font></font><em class="replaceable"><code>some_host</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'=密码（' </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要更改密码但创建一个短散列，请改用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET PASSWORD FOR' </font></font><em class="replaceable"><code>some_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'@' </font></font><em class="replaceable"><code>some_host</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'= OLD_PASSWORD（' </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'）;
</font></font></pre><p>
        <a class="link" href="/mysql-5.7-google-zh/functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 对于您明确希望生成短散列的情况非常有用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        上述每种情况的缺点可以总结如下：
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在场景1中，您不能利用提供更安全身份验证的更长时间的哈希。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在场景2中，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        防止短哈希帐户无法访问，但密码更改操作会导致具有长哈希的帐户恢复为短哈希值，除非您先小心地将会话值更改</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为0。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在方案3中，如果您在未明确使用的情况下更改其密码，则4.1之前的客户端将无法访问短哈希帐户</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        避免与简短密码哈希相关的兼容性问题的最佳方法是不要使用它们：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将所有客户端程序升级到MySQL 4.1或更高版本。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            运行服务器
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用短密码散列重置任何帐户的密码以使用长密码散列。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了增加安全性，请使用服务器运行
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-against-attack"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3使MySQL免受攻击者的攻击</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528120420672"></a><a class="indexterm" name="idm140528120419216"></a><a class="indexterm" name="idm140528120417728"></a><a class="indexterm" name="idm140528120416656"></a><a class="indexterm" name="idm140528120415568"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当你连接到MySQL服务器时，你应该使用密码。</font><font style="vertical-align: inherit;">密码不通过连接以明文形式传输。</font><font style="vertical-align: inherit;">客户端连接序列中的密码处理在MySQL 4.1.1中升级，非常安全。</font><font style="vertical-align: inherit;">如果您仍在使用4.1.1之前版本的密码，则加密算法不如新算法那么强大。</font><font style="vertical-align: inherit;">经过一番努力，一个能够嗅探客户端和服务器之间流量的聪明的攻击者可以破解密码。</font><font style="vertical-align: inherit;">（有关</font><font style="vertical-align: inherit;">不同密码处理方法的讨论，</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-hashing" title="6.1.2.4 MySQL中的密码散列"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.4节“MySQL中的密码散列”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      所有其他信息以文本形式传输，任何能够观看连接的人都可以阅读。</font><font style="vertical-align: inherit;">如果客户端和服务器之间的连接经过不可信网络，并且您担心这一点，则可以使用压缩协议来使流量难以解密。</font><font style="vertical-align: inherit;">您也可以使用MySQL的内部SSL支持来使连接更安全。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connections" title="6.4使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4节“使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，使用SSH获取MySQL服务器和MySQL客户端之间的加密TCP / IP连接。</font><font style="vertical-align: inherit;">您可以在</font></font><a class="ulink" href="http://www.openssh.org/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.openssh.org/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到一个开源SSH客户端
       </font><font style="vertical-align: inherit;">，以及比较开源客户端和商用SSH客户端
      </font></font><a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要使MySQL系统安全，您应该强烈考虑以下建议：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要求所有MySQL帐户都有密码。</font><font style="vertical-align: inherit;">客户程序不一定知道运行它的人的身份。</font><font style="vertical-align: inherit;">客户端/服务器应用程序的常见情况是，用户可以指定客户端程序的任何用户名。</font><font style="vertical-align: inherit;">例如，任何人都可以</font><font style="vertical-align: inherit;">像任何其他人一样</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序进行连接，只需调用它就
           </font><font style="vertical-align: inherit;">好像
           </font><font style="vertical-align: inherit;">没有密码一样。</font><font style="vertical-align: inherit;">如果所有帐户都有密码，则使用其他用户的帐户连接变得更加困难。
        </font></font><code class="literal">mysql -u <em class="replaceable"><code>other_user</code></em>
          <em class="replaceable"><code>db_name</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>other_user</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关设置密码方法的讨论，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#assigning-passwords" title="6.3.6分配帐户密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.6节“分配帐户密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          确保数据库目录中唯一具有读或写权限的Unix用户帐户是用于运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的帐户</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          切勿以Unix </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用户</font><font style="vertical-align: inherit;">身份运行MySQL服务器</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是非常危险的，因为任何具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限的</font><font style="vertical-align: inherit;">用户
           </font><font style="vertical-align: inherit;">都可以使服务器创建文件</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如</font></font><code class="literal">~root/.bashrc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">为了防止这种情况，
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拒绝运行，
           </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除非使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_user"><code class="option">--user=root</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">明确指定</font><font style="vertical-align: inherit;">。
        </font></font></p><p>
          <a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以（而且应该）作为普通的非特权用户来运行。</font><font style="vertical-align: inherit;">您可以创建一个单独的Unix帐户</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使其更安全。</font><font style="vertical-align: inherit;">只能用这个帐号来管理MySQL。</font><font style="vertical-align: inherit;">要</font><font style="vertical-align: inherit;">以不同的Unix用户身份</font><font style="vertical-align: inherit;">启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请添加一个</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，用于</font><font style="vertical-align: inherit;">在指定服务器选项</font></font><code class="literal">[mysqld]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项文件</font><font style="vertical-align: inherit;">组中
          </font><font style="vertical-align: inherit;">指定用户名</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用户= MySQL的</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这会导致服务器以指定用户身份启动，无论是手动启动还是使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld-safe" title="4.3.2 mysqld_safe  -  MySQL服务器启动脚本"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld_safe</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-server" title="4.3.3 mysql.server  -  MySQL服务器启动脚本"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql.server</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多详细信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#changing-mysql-user" title="6.1.5如何以普通用户身份运行MySQL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.5节“如何以普通用户身份运行MySQL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以非Unix用户身份
           </font><font style="vertical-align: inherit;">
          运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并不意味着您需要更改</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名
           </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL帐户的用户名与Unix帐户的用户名无关</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不要将</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限</font><font style="vertical-align: inherit;">授予</font><font style="vertical-align: inherit;">非管理员用户。</font><font style="vertical-align: inherit;">任何具有此特权的用户都可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">守护进程</font><font style="vertical-align: inherit;">的权限在文件系统中的任何位置写入文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这包括服务器的数据目录，其中包含实现特权表的文件。</font><font style="vertical-align: inherit;">为了使
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权操作更安全一些，使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO语法"><code class="literal">SELECT ... INTO
          OUTFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会覆盖现有文件并且每个人都可写的文件。
        </font></font></p><a class="indexterm" name="idm140528120372448"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权还可以用于读取任何世界可读的或服务器运行的Unix用户可以访问的文件。</font><font style="vertical-align: inherit;">有了这个特权，你可以读取任何文件到数据库表中。</font><font style="vertical-align: inherit;">这可能会被滥用，例如，通过使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
          DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载</font></font><code class="filename">/etc/passwd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到表中，然后可以显示
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要限制可以读取和写入文件的位置，请将</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_file_priv"><code class="literal">secure_file_priv</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统设置为特定的目录。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_process"><code class="literal">PROCESS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权非管理员用户。</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
          PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程列表</font><font style="vertical-align: inherit;">的输出</font><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">显示当前正在执行的任何语句的文本，因此任何被允许查看服务器进程列表的用户都可以看到其他用户（例如，）发布的语句</font></font><code class="literal">UPDATE user SET
          password=PASSWORD('not_secure')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p>
          <a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          权限的</font><font style="vertical-align: inherit;">用户保留一个额外的连接</font><font style="vertical-align: inherit;">，以便MySQL</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以登录并检查服务器活动，即使所有正常连接都在使用中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可用于终止客户端连接，通过更改系统变量的值来更改服务器操作，并控制复制服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不允许使用符号链接表。</font><font style="vertical-align: inherit;">（此功能可通过禁用
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项。）如果您运行，这一点尤其重要
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为有写访问到服务器的数据目录，然后任何人都可以在系统中删除任何文件！</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#symbolic-links-to-tables" title="8.12.3.2在Unix上使用MyISAM表的符号链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.12.3.2节“在Unix上使用MyISAM表的符号链接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          应使用</font></font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-programs-security" title="23.6存储程序和视图的访问控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第23.6节“存储程序和视图的访问控制”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论的安全准则编写
           </font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-programs-security" title="23.6 Access Control for Stored Programs and Views"><font style="vertical-align: inherit;">存储程序和视图</font></a><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你不信任你的DNS，你应该在授权表中使用IP地址而不是主机名。</font><font style="vertical-align: inherit;">无论如何，您应该非常小心使用包含通配符的主机名值创建授权表条目。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您想要限制允许单个帐户的连接数量，可以通过</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld中</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">变量来实现</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE
          USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句也支持资源控制选项来限制允许帐户服务器使用的程度。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.2节“CREATE USER语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.1节“ALTER USER语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件目录可由服务器写入，则用户可以使用可执行代码写入目录中的文件</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT
          ... INTO DUMPFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可以通过</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只读服务器或通过设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_secure-file-priv"><code class="option">--secure-file-priv</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以安全写入</font><font style="vertical-align: inherit;">的目录</font><font style="vertical-align: inherit;">来防止
           </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.4安全相关的mysqld选项和变量</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      下表显示</font><font style="vertical-align: inherit;">影响安全性的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项和系统变量。</font><font style="vertical-align: inherit;">有关每种方法的说明，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-options" title="5.1.4服务器命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.4节“服务器命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528120326144"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.1安全选项和变量摘要</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Security-related command-line options and system variables."><colgroup><col width="20%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMD线</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项文件</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Var范围</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_allow-suspicious-udfs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许可疑-UDF的</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_automatic_sp_privileges"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automatic_sp_privileges</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_chroot"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chroot环境</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_des-key-file"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DES密钥文件</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_local_infile"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">local_infile</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">old_passwords</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_safe-user-create"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全用户创建</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_secure-auth"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全-AUTH</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secure_auth</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_secure-file-priv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全文件私法</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_file_priv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secure_file_priv</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-grant-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳过赠款表</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-name-resolve"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳过名称解析</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_skip_name_resolve"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skip_name_resolve</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-networking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳过网络</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_skip_networking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skip_networking</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-show-database"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳过出现数据库</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_skip_show_database"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skip_show_database</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="changing-mysql-user"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.5如何以普通用户身份运行MySQL</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528120184976"></a><a class="indexterm" name="idm140528120183520"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在Windows上，您可以使用普通用户帐户作为Windows服务运行服务器。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在Linux上，对于使用MySQL存储库，RPM软件包或Debian软件包执行的安装，MySQL服务器
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该由本地
       </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统用户启动。</font><font style="vertical-align: inherit;">作为安装的一部分包含的init脚本不支持由另一个操作系统用户启动。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在Unix上（或Linux上使用</font></font><code class="filename">tar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="filename">tar.gz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件包</font><font style="vertical-align: inherit;">执行安装
       </font><font style="vertical-align: inherit;">），MySQL服务器</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以由任何用户启动和运行。</font><font style="vertical-align: inherit;">但是，</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于安全原因</font><font style="vertical-align: inherit;">，您应该避免以Unix </font><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">身份运行服务器</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要将</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">为普通非特权Unix用户</font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，必须执行以下操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          停止服务器（如果它正在运行）（使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin shutdown</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          更改数据库目录和文件，以便
           </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有读写文件的权限（您可能需要以Unix </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">身份执行此
           </font><font style="vertical-align: inherit;">操作）：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>chown -R <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>/path/to/mysql/datadir</code></em></code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您不这样做，服务器运行时将无法访问数据库或表
           </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果MySQL数据目录中的目录或文件是符号链接，</font></font><code class="literal">chown -R</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能不会遵循符号链接。</font><font style="vertical-align: inherit;">如果没有，您还需要关注这些链接并更改它们指向的目录和文件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以用户身份启动服务器</font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另一种方法是以</font><font style="vertical-align: inherit;">Unix </font><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">身份启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用该
           </font><font style="vertical-align: inherit;">
          选项。</font><font style="vertical-align: inherit;">启动</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong><font style="vertical-align: inherit;">mysqld</font></strong></span></a><font style="vertical-align: inherit;">，然后</font><font style="vertical-align: inherit;">
          在接受任何连接之前</font><font style="vertical-align: inherit;">切换为以Unix用户身份运行</font><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_user"><code class="option">--user=<em class="replaceable"><code>user_name</code></em></code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在系统启动时自动以给定用户身份启动服务器，请通过向</font><font style="vertical-align: inherit;">选项文件</font><font style="vertical-align: inherit;">组</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">服务器数据目录</font><font style="vertical-align: inherit;">中的
           </font><font style="vertical-align: inherit;">选项文件
           </font><font style="vertical-align: inherit;">添加</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来
           </font><font style="vertical-align: inherit;">指定用户名
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
        </font></font><code class="literal">[mysqld]</code><font style="vertical-align: inherit;"></font><code class="filename">/etc/my.cnf</code><font style="vertical-align: inherit;"></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用户=</font></font><em class="replaceable"><code>user_name</code></em>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您的Unix机器本身不安全，您应该将密码分配给</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授权表中</font><font style="vertical-align: inherit;">的MySQL </font><font style="vertical-align: inherit;">帐户。</font><font style="vertical-align: inherit;">否则，任何在该机器上拥有登录帐户的用户都可以</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_user"><code class="option">--user=root</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并执行任何操作。</font><font style="vertical-align: inherit;">（在任何情况下都要给MySQL帐户分配密码是一个好主意，但当服务器主机上存在其他登录帐户时尤其如此）。请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#default-privileges" title="2.10.4确保初始MySQL帐户的安全"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10.4节“保护初始MySQL帐户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="load-data-local"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.6 LOAD DATA LOCAL的安全问题</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句可以加载位于服务器主机上的文件，或者，如果</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">，则可以加载
       </font><font style="vertical-align: inherit;">客户端主机上的文件。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这个</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本</font><font style="vertical-align: inherit;">有两个潜在的安全问题
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
      DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从客户端主机到服务器主机的文件传输是由MySQL服务器启动的。</font><font style="vertical-align: inherit;">从理论上讲，可以构建一个补丁服务器，告诉客户端程序在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
          DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">传输服务器选择的文件，而不是客户端命名的文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这样的服务器可以访问客户端用户读取访问的客户端主机上的任何文件。</font><font style="vertical-align: inherit;">（补丁服务器事实上可以向任何语句回复文件传输请求，而不仅仅是
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
          LOCAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以一个更基本的问题是客户端不应该连接到不受信任的服务器。）
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在客户端从Web服务器连接的Web环境中，用户可以使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
          LOCAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它读取Web服务器进程读取访问的任何文件（假设用户可以针对SQL服务器运行任何语句）。</font><font style="vertical-align: inherit;">在这种环境下，与MySQL服务器相关的客户端实际上是Web服务器，而不是由连接到Web服务器的用户运行的远程程序。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为避免</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题，客户应避免使用</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了避免连接到不受信任的服务器，客户端可以建立安全连接并通过使用该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_IDENTITY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项和相应的CA证书</font><font style="vertical-align: inherit;">进行连接来验证服务器身份
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要使管理员和应用程序能够管理本地数据加载功能，</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置的工作方式如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器端：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所述</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量控制服务器端</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的能力。</font><font style="vertical-align: inherit;">根据
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置，服务器拒绝或允许</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在客户端启用</font><font style="vertical-align: inherit;">客户端的本地数据加载</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已启用。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要明确导致服务器拒绝或允许
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
              LOCAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（不论如何客户程序和库在构建时或运行时配置），启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别禁用或启用。
              </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以在运行时设置。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在客户端：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font><span class="command"><strong><font style="vertical-align: inherit;">CMake的</font></strong></span><font style="vertical-align: inherit;">选项控制编译默认</font><font style="vertical-align: inherit;">的MySQL客户端库的能力。</font><font style="vertical-align: inherit;">因此，没有明确安排的客户端</font><font style="vertical-align: inherit;">根据</font><font style="vertical-align: inherit;">MySQL构建时指定</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">禁用或启用了功能
               </font><font style="vertical-align: inherit;">。
            </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_enabled_local_infile"><code class="option">ENABLED_LOCAL_INFILE</code></a>
              <span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_enabled_local_infile"><code class="option">ENABLED_LOCAL_INFILE</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              默认情况下，MySQL二进制分发版中的客户端库在</font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_enabled_local_infile"><code class="option">ENABLED_LOCAL_INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用时</font><font style="vertical-align: inherit;">编译
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您从源代码编译MySQL，请</font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_enabled_local_infile"><code class="option">ENABLED_LOCAL_INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              根据未明确安排的客户端是否</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              分别禁用或启用功能，将其配置为禁用或启用。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用C API的客户端程序可以通过调用</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-options" title="27.8.7.50 mysql_options（）"><code class="literal">mysql_options()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用或启用该</font></font><code class="literal">MYSQL_OPT_LOCAL_INFILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选项</font><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">显式控制加载数据加载
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-options" title="27.8.7.50 mysql_options（）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第27.8.7.50节“mysql_options（）”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端，默认禁用本地数据加载。</font><font style="vertical-align: inherit;">要明确禁用或启用它，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_local-infile"><code class="option">--local-infile=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_local-infile"><code class="option">--local-infile[=1]</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlimport" title="4.5.5 mysqlimport  - 数据导入程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlimport</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端，默认禁用本地数据加载。</font><font style="vertical-align: inherit;">要明确禁用或启用它，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlimport_local"><code class="option">--local=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlimport_local"><code class="option">--local[=1]</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
              DATA LOCAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Perl脚本或其他程序中使用</font></font><code class="literal">[client]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从选项文件</font><font style="vertical-align: inherit;">读取</font><font style="vertical-align: inherit;">组，则可以将</font></font><code class="literal">local-infile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项设置</font><font style="vertical-align: inherit;">添加
               </font><font style="vertical-align: inherit;">到该组。</font><font style="vertical-align: inherit;">为防止不理解此选项的程序出现问题，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option-modifiers" title="4.2.5程序选项修饰符"><code class="literal">loose-</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              前缀</font><font style="vertical-align: inherit;">指定它
               </font><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[客户]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
松和本地的infile = 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要么：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[客户]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
松和本地的infile = 1</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在所有情况下，</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              客户端</font><font style="vertical-align: inherit;">成功使用</font><font style="vertical-align: inherit;">加载操作也要求服务器允许。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用了功能，则在服务器或客户端，尝试发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
      LOCAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的客户端会
       </font><font style="vertical-align: inherit;">收到以下错误消息：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1148：这个MySQL版本不允许使用该命令
</font></font></pre><a class="indexterm" name="idm140528120081840"></a><a class="indexterm" name="idm140528120080320"></a>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="secure-client-programming"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.7客户端编程安全指南</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      访问MySQL的应用程序不应该信任用户输入的任何数据，他们可以尝试通过在Web窗体，URL或任何您已构建的应用程序中输入特殊或转义的字符序列来欺骗您的代码。</font><font style="vertical-align: inherit;">如果用户输入类似的内容，请确保您的应用程序保持安全</font></font><code class="literal">; DROP DATABASE
      mysql;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个极端的例子，但是如果你没有为它们做准备，那么由于黑客使用类似的技术可能会导致大量的安全漏洞和数据丢失。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一个常见的错误是仅保护字符串数据值。</font><font style="vertical-align: inherit;">请记得检查数字数据。</font><font style="vertical-align: inherit;">如果应用程序生成查询，例如</font></font><code class="literal">SELECT * FROM table WHERE ID=234</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户输入值时</font></font><code class="literal">234</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，用户可以输入该值</font></font><code class="literal">234 OR 1=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以使应用程序生成查询</font></font><code class="literal">SELECT * FROM table WHERE ID=234 OR
      1=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">结果，服务器检索表中的每一行。</font><font style="vertical-align: inherit;">这会暴露每一行并导致过多的服务器负载。</font><font style="vertical-align: inherit;">防止此类攻击的最简单方法是在数字常量周围使用单引号：
       </font></font><code class="literal">SELECT * FROM table WHERE ID='234'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果用户输入额外信息，则全部成为字符串的一部分。</font><font style="vertical-align: inherit;">在数字上下文中，MySQL会自动将此字符串转换为数字，并从中删除任何尾随的非数字字符。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有时候人们会认为如果一个数据库只包含公开可用的数据，它就不需要保护。</font><font style="vertical-align: inherit;">这是不正确的。</font><font style="vertical-align: inherit;">即使允许在数据库中显示任何行，也应该防止拒绝服务攻击（例如，基于前一段中导致服务器浪费资源的技术的攻击）。</font><font style="vertical-align: inherit;">否则，您的服务器将无法响应合法用户。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      清单：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          启用严格的SQL模式来告诉服务器对它接受的数据值有更多的限制。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#sql-mode" title="5.1.8服务器SQL模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.8节“服务器SQL模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          尝试</font><font style="vertical-align: inherit;">在所有Web表单中</font><font style="vertical-align: inherit;">输入单引号和双引号（</font></font><code class="literal">'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果您遇到任何类型的MySQL错误，请立即调查问题。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          尝试通过向它们添加</font></font><code class="literal">%22</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          （</font></font><code class="literal">"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font></font><code class="literal">%23</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          （</font></font><code class="literal">#</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和</font></font><code class="literal">%27</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          （</font></font><code class="literal">'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）来</font><font style="vertical-align: inherit;">修改动态URL </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          尝试使用前面示例中显示的字符将动态URL中的数据类型从数字修改为字符类型。</font><font style="vertical-align: inherit;">你的应用程序应该对这些和类似的攻击是安全的。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          尝试输入字符，空格和特殊符号，而不是数字字段中的数字。</font><font style="vertical-align: inherit;">在将应用程序传递给MySQL之前，您的应用程序应删除它们，否则会产生错误 </font><font style="vertical-align: inherit;">将未经检查的值传递给MySQL是非常危险的！
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在传递给MySQL之前检查数据的大小。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          让您的应用程序使用与用于管理目的的用户名不同的用户名连接到数据库。</font><font style="vertical-align: inherit;">不要给你的应用程序任何他们不需要的访问权限。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      许多应用程序编程接口提供了转义数据值中特殊字符的方法。</font><font style="vertical-align: inherit;">正确使用，这可以防止应用程序用户输入导致应用程序生成具有不同效果的语句的值：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL C API：使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-real-escape-string-quote" title="27.8.7.56 mysql_real_escape_string_quote（）"><code class="literal">mysql_real_escape_string_quote()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          API调用。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL ++：</font><font style="vertical-align: inherit;">对查询流</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">escape</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">quote</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修饰符。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          PHP：使用</font></font><code class="literal">mysqli</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><code class="literal">pdo_mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展名，而不是旧的
           </font></font><code class="literal">ext/mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展名。</font><font style="vertical-align: inherit;">首选的API支持改进的MySQL身份验证协议和密码，以及带占位符的准备语句。</font><font style="vertical-align: inherit;">另请参阅</font></font><a class="ulink" href="http://dev.mysql.com/doc/apis-php/en/apis-php-mysqlinfo.api.choosing.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">ext/mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用</font><font style="vertical-align: inherit;">较旧的</font><font style="vertical-align: inherit;">扩展名，则转义使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-real-escape-string-quote" title="27.8.7.56 mysql_real_escape_string_quote（）"><code class="literal">mysql_real_escape_string_quote()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          功能而不使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-escape-string" title="27.8.7.16 mysql_escape_string（）"><code class="literal">mysql_escape_string()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
           </font></font><code class="function">addslashes()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为只能
           </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-real-escape-string-quote" title="27.8.7.56 mysql_real_escape_string_quote（）"><code class="literal">mysql_real_escape_string_quote()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          识别字符集; </font><font style="vertical-align: inherit;">当使用（无效）多字节字符集时</font><font style="vertical-align: inherit;">，其他函数可以被
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绕过</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Perl DBI：使用占位符或</font></font><code class="literal">quote()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          方法。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Ruby DBI：使用占位符或</font></font><code class="literal">quote()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          方法。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Java JDBC：使用</font></font><code class="literal">PreparedStatement</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象和占位符。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      其他编程接口可能具有相似的功能。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="privilege-system"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2 MySQL访问权限系统</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#privileges-provided"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1由MySQL提供的权限</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#grant-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.2授予表格</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#account-names"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.3指定帐户名称</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#connection-access"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.4访问控制，阶段1：连接验证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#request-access"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.5访问控制，阶段2：请求验证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#privilege-changes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.6特权更改生效时</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#problems-connecting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.7排除连接到MySQL的问题</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528120033856"></a><a class="indexterm" name="idm140528120032816"></a><a class="indexterm" name="idm140528120031744"></a><a class="indexterm" name="idm140528120030256"></a><a class="indexterm" name="idm140528120029184"></a><a class="indexterm" name="idm140528120028112"></a><a class="indexterm" name="idm140528120026624"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL权限系统的主要功能是验证谁从给定主机连接用户，并与特权用户数据库如联想
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">其他功能包括具有匿名用户并授予特定于MySQL的功能（如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
    INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理操作）的</font><font style="vertical-align: inherit;">权限
     </font><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有些事情你不能用MySQL权限系统来做：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您不能明确指定给定用户应该被拒绝访问。</font><font style="vertical-align: inherit;">也就是说，你不能明确地匹配用户，然后拒绝连接。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您不能指定用户有权创建或删除数据库中的表，但不能创建或删除数据库本身。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密码全球适用于帐户。</font><font style="vertical-align: inherit;">您不能将密码与特定对象（如数据库，表或例程）关联。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    用户界面的MySQL权限系统由SQL语句如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#account-management-sql" title="13.7.1账户管理陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1节“帐户管理语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在内部，服务器将权限信息存储在</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">的授权表中</font><font style="vertical-align: inherit;">（即，在名为的数据库中</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">MySQL服务器在启动时将这些表的内容读取到内存中，并基于授予表的内存副本对访问控制做出决定。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL特权系统确保所有用户只能执行允许的操作。</font><font style="vertical-align: inherit;">作为用户，当您连接到MySQL服务器时，您的身份由</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接的主机</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您指定的用户名确定</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在连接后发出请求时，系统将根据您的身份和</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您想要执行的操作</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予权限
     </font><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    因为没有理由认为给定的用户名属于所有主机上的同一个人，所以MySQL会将您的主机名和用户名同时识别。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">joe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接
     </font><font style="vertical-align: inherit;">的用户
     </font></font><code class="literal">office.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要与</font></font><code class="literal">joe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接
     </font><font style="vertical-align: inherit;">的用户是同一个人</font></font><code class="literal">home.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQL的，使您能够区分上碰巧有相同的名称不同的主机用户来处理它：你可以通过授予一组的连接权限
     </font></font><code class="literal">joe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code class="literal">office.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并通过连接一组不同的权限
     </font></font><code class="literal">joe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code class="literal">home.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要查看给定帐户具有的权限，请使用该
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-grants" title="13.7.5.21 SHOW GRANTS语法"><code class="literal">SHOW GRANTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">例如：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示'joe'@office.example.com'的赠款;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
显示'joe'@home.example.com'的赠款;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    当您运行连接到服务器的客户端程序时，MySQL访问控制涉及两个阶段：
  </font></font></p><p>
    <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段1：</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器根据您的身份接受或拒绝连接，以及您是否可以通过提供正确的密码来验证您的身份。
  </font></font></p><p>
    <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段2：</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设您可以连接，服务器会检查您发出的每条语句，以确定您是否有足够的权限来执行它。</font><font style="vertical-align: inherit;">例如，如果尝试从数据库中的表中选择行或从数据库中删除表，则服务器会验证您是否具有
    </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该表的</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">的
    </font><font style="vertical-align: inherit;">权限。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关每个阶段发生情况的更详细说明，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-access" title="6.2.4访问控制，阶段1：连接验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.4节“访问控制阶段1：连接验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#request-access" title="6.2.5访问控制，阶段2：请求验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.5节“访问控制阶段2：请求验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    如果您在连接时更改了权限（通过您自己或其他人），那么对于您发布的下一条语句，这些更改不一定会立即生效。</font><font style="vertical-align: inherit;">有关服务器重新加载授权表的条件的详细信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#privilege-changes" title="6.2.6特权更改生效时"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.6节“特权更改生效时”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关一般安全相关的建议，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#general-security-issues" title="6.1一般安全问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1节“常规安全问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关诊断权限相关问题的帮助，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#problems-connecting" title="6.2.7排除连接到MySQL的问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.7节“连接到MySQL的问题疑难解答”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="privileges-provided"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1由MySQL提供的权限</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      授予MySQL帐户的权限决定了帐户可以执行的操作。</font><font style="vertical-align: inherit;">MySQL权限在应用的上下文和不同的操作级别上有所不同：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          管理权限使用户能够管理MySQL服务器的操作。</font><font style="vertical-align: inherit;">这些权限是全局性的，因为它们不是特定于特定数据库的。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          数据库特权适用于数据库及其中的所有对象。</font><font style="vertical-align: inherit;">这些特权可以授予特定数据库，也可以授予全局特权，以便适用于所有数据库。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可为数据库中的特定对象，数据库内给定类型的所有对象（例如数据库中的所有表）授予数据库对象（例如表，索引，视图和存储例程）的权限，也可授予全局所有数据库中给定类型的对象）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关帐户权限的信息存储在
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表
       </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库（见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#grant-tables" title="6.2.2授予表格"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.2节“授权表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">MySQL服务器在启动时将这些表的内容读入内存，并在</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#privilege-changes" title="6.2.6特权更改生效时"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.6节“特权更改</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生效时</font><a class="xref" href="/mysql-5.7-google-zh/security.html#privilege-changes" title="6.2.6 When Privilege Changes Take Effect"><font style="vertical-align: inherit;">”中</font></a><font style="vertical-align: inherit;">指出的情况下重新加载它们
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">访问控制决策基于授权表的内存中副本。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一些MySQL版本引入了对授权表结构的更改以添加新的特权或功能。</font><font style="vertical-align: inherit;">为了确保您可以利用任何新功能，请更新您的授权表，以便在升级MySQL时拥有当前结构。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.4.7节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 检查并升级MySQL表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      下表显示了在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">使用的特权名称
       </font><font style="vertical-align: inherit;">，以及与授权表中的每个特权相关联的列名以及特权所应用的上下文。
</font></font></p>
<div class="table">
<a name="idm140528119969488"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.2 GRANT和REVOKE的允许特权</font></font></b></p>
<div class="table-contents">
<table><colgroup><col width="30%"><col width="33%"><col width="37%"></colgroup><thead><tr>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权</font></font></th>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱</font></font></th>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文</font></font></th>
        </tr></thead><tbody><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_all"><code class="literal">ALL [PRIVILEGES]</code></a></td>
          <td><font style="vertical-align: inherit;"><span class="quote"><font style="vertical-align: inherit;">“ </font></span><span class="quote"><span class="quote"><font style="vertical-align: inherit;">所有权限</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”的</font></span><font style="vertical-align: inherit;">同义词</font></font><span class="quote"><font style="vertical-align: inherit;"></font><span class="quote"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></span></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_alter"><code class="literal">ALTER</code></a></td>
          <td><code class="literal">Alter_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_alter-routine"><code class="literal">ALTER ROUTINE</code></a></td>
          <td><code class="literal">Alter_routine_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储的例程</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create"><code class="literal">CREATE</code></a></td>
          <td><code class="literal">Create_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库，表或索引</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-routine"><code class="literal">CREATE ROUTINE</code></a></td>
          <td><code class="literal">Create_routine_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储的例程</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-tablespace"><code class="literal">CREATE TABLESPACE</code></a></td>
          <td><code class="literal">Create_tablespace_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY TABLES</code></a></td>
          <td><code class="literal">Create_tmp_table_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-user"><code class="literal">CREATE USER</code></a></td>
          <td><code class="literal">Create_user_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-view"><code class="literal">CREATE VIEW</code></a></td>
          <td><code class="literal">Create_view_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_delete"><code class="literal">DELETE</code></a></td>
          <td><code class="literal">Delete_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a></td>
          <td><code class="literal">Drop_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库，表格或视图</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_event"><code class="literal">EVENT</code></a></td>
          <td><code class="literal">Event_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a></td>
          <td><code class="literal">Execute_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储的例程</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a></td>
          <td><code class="literal">File_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器主机上的文件访问</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a></td>
          <td><code class="literal">Grant_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库，表格或存储例程</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_index"><code class="literal">INDEX</code></a></td>
          <td><code class="literal">Index_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a></td>
          <td><code class="literal">Insert_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或列</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_lock-tables"><code class="literal">LOCK TABLES</code></a></td>
          <td><code class="literal">Lock_tables_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_process"><code class="literal">PROCESS</code></a></td>
          <td><code class="literal">Process_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">见</font></font><code class="literal">proxies_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_references"><code class="literal">REFERENCES</code></a></td>
          <td><code class="literal">References_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库或表格</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_reload"><code class="literal">RELOAD</code></a></td>
          <td><code class="literal">Reload_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_replication-client"><code class="literal">REPLICATION CLIENT</code></a></td>
          <td><code class="literal">Repl_client_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a></td>
          <td><code class="literal">Repl_slave_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a></td>
          <td><code class="literal">Select_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或列</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_show-databases"><code class="literal">SHOW DATABASES</code></a></td>
          <td><code class="literal">Show_db_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_show-view"><code class="literal">SHOW VIEW</code></a></td>
          <td><code class="literal">Show_view_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a></td>
          <td><code class="literal">Shutdown_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a></td>
          <td><code class="literal">Super_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_trigger"><code class="literal">TRIGGER</code></a></td>
          <td><code class="literal">Trigger_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_update"><code class="literal">UPDATE</code></a></td>
          <td><code class="literal">Update_priv</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或列</font></font></td>
        </tr><tr>
          <td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#priv_usage"><code class="literal">USAGE</code></a></td>
          <td><font style="vertical-align: inherit;"><span class="quote"><font style="vertical-align: inherit;">“ </font></span><span class="quote"><span class="quote"><font style="vertical-align: inherit;">没有权限</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”的</font></span><font style="vertical-align: inherit;">同义词</font></font><span class="quote"><font style="vertical-align: inherit;"></font><span class="quote"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></span></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器管理</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下列表提供了MySQL中可用权限的一般描述。</font><font style="vertical-align: inherit;">特定的SQL语句可能具有比此处指示的更具体的特权要求。</font><font style="vertical-align: inherit;">如果是这样，那么有关声明的描述将提供详细信息。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="priv_all"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_all"><code class="literal">ALL PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          权限说明符的简写。</font><font style="vertical-align: inherit;">它代表</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在给定特权级别可用的所有特权</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          （除外</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如，</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在全局或表级授予授予所有全局特权或所有表级特权。
        </font></font></p></li><li class="listitem"><p><a name="priv_alter"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_alter"><code class="literal">ALTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使得能够使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来改变表格的结构。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还需要
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create"><code class="literal">CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。</font><font style="vertical-align: inherit;">重命名表需要</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_alter"><code class="literal">ALTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对旧表，
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create"><code class="literal">CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对新表。
        </font></font></p></li><li class="listitem"><p><a name="priv_alter-routine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          的</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_alter-routine"><code class="literal">ALTER ROUTINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要特权更改或删除存储例程（过程和功能）。
        </font></font></p></li><li class="listitem"><p><a name="priv_create"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create"><code class="literal">CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使得可以创建新的数据库和表格。
        </font></font></p></li><li class="listitem"><p><a name="priv_create-routine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-routine"><code class="literal">CREATE ROUTINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要的权限来创建存储例程（过程和函数）。
        </font></font></p></li><li class="listitem"><p><a name="priv_create-tablespace"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-tablespace"><code class="literal">CREATE TABLESPACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要权限才能创建，更改或删除表空间和日志文件组。
        </font></font></p></li><li class="listitem"><p><a name="priv_create-temporary-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          特权使得能够使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-temporary-table" title="13.1.18.3 CREATE TEMPORARY TABLE语法"><code class="literal">CREATE TEMPORARY TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句</font><font style="vertical-align: inherit;">创建临时表
           </font><font style="vertical-align: inherit;">。
        </font></font></p><a class="indexterm" name="idm140528119777456"></a><a class="indexterm" name="idm140528119775968"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          会话创建临时表后，服务器不会在该表上执行进一步的特权检查。</font><font style="vertical-align: inherit;">所述创建会话可以在桌子上进行任何操作，例如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-temporary-table" title="13.1.18.3 CREATE TEMPORARY TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18.3节“CREATE TEMPORARY TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="priv_create-user"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-user"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限允许使用的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-user" title="13.7.1.3 DROP USER语法"><code class="literal">DROP USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#rename-user" title="13.7.1.5 RENAME USER语法"><code class="literal">RENAME USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE ALL
          PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
        </font></font></p></li><li class="listitem"><p><a name="priv_create-view"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-view"><code class="literal">CREATE VIEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-view" title="13.1.21 CREATE VIEW语法"><code class="literal">CREATE VIEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          声明。
        </font></font></p></li><li class="listitem"><p><a name="priv_delete"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_delete"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使行可以从数据库中的表中删除。
        </font></font></p></li><li class="listitem"><p><a name="priv_drop"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限使您能够删除（删除）现有的数据库，表和视图。</font><font style="vertical-align: inherit;">该
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限需要以使用语句</font></font><code class="literal">ALTER TABLE ... DROP
          PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的分区表。</font><font style="vertical-align: inherit;">该
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权也是必需的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">权限</font><font style="vertical-align: inherit;">授予</font><font style="vertical-align: inherit;">给用户，则该用户可以删除存储MySQL访问权限的数据库。</font></font></em></span>
        </p></li><li class="listitem"><p><a name="priv_event"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_event"><code class="literal">EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限用于创建，修改，删除，或查看事件调度的事件。
        </font></font></p></li><li class="listitem"><p><a name="priv_execute"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权是执行存储例程（过程和函数）所必需的。
        </font></font></p></li><li class="listitem"><p><a name="priv_file"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
          INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO语法"><code class="literal">SELECT ... INTO
          OUTFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句和
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">在服务器主机上读写文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">拥有该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限的</font><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">可以读取服务器主机上任何全球可读或MySQL服务器可读的文件。</font><font style="vertical-align: inherit;">（这意味着用户可以读取任何数据库目录中的任何文件，因为服务器可以访问任何这些文件。）
          </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权还使用户能够在MySQL服务器具有写访问权限的任何目录中创建新文件。</font><font style="vertical-align: inherit;">这包括服务器的数据目录，其中包含实现特权表的文件。</font><font style="vertical-align: inherit;">作为安全措施，服务器不会覆盖现有文件。</font><font style="vertical-align: inherit;">从MySQL 5.7.17开始，
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font><font style="vertical-align: inherit;">为</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">INDEX
          DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表选项
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要限制可以读取和写入文件的位置，请将</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_file_priv"><code class="literal">secure_file_priv</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统设置为特定的目录。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="priv_grant-option"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使您可以向其他用户提供或从其他用户中删除您自己拥有的特权。
        </font></font></p></li><li class="listitem"><p><a name="priv_index"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_index"><code class="literal">INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限使您能够创建或删除（删除）索引。
          </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_index"><code class="literal">INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于现有的表格。</font><font style="vertical-align: inherit;">如果您拥有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create"><code class="literal">CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表格</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">特权，则可以在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">包含索引定义</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="priv_insert"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使行可以插入到数据库的表中。
          </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还需要对
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表维护语句。
        </font></font></p></li><li class="listitem"><p><a name="priv_lock-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_lock-tables"><code class="literal">LOCK TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可以使用显式</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK
          TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来锁定您有权访问的表</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这包括使用写入锁，这会阻止其他会话读取锁定的表。
        </font></font></p></li><li class="listitem"><p><a name="priv_process"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_process"><code class="literal">PROCESS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权适用于显示有关在服务器内执行的线程的信息（即关于正在由会话执行的语句的信息）。</font><font style="vertical-align: inherit;">该特权使得能够使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin processlist</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来查看属于其他账户的线程; </font><font style="vertical-align: inherit;">你总是可以看到你自己的线程。</font><font style="vertical-align: inherit;">该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_process"><code class="literal">PROCESS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权还可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE语法"><code class="literal">SHOW
          ENGINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="priv_proxy"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使用户能够冒充或成为另一个用户。</font><font style="vertical-align: inherit;">参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="priv_references"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          创建外键约束需要</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_references"><code class="literal">REFERENCES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">父表</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">特权。
        </font></font></p></li><li class="listitem"><p><a name="priv_reload"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_reload"><code class="literal">RELOAD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush" title="13.7.6.3 FLUSH语法"><code class="literal">FLUSH</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。</font><font style="vertical-align: inherit;">这也使</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中mysqladmin</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等效于命令</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush" title="13.7.6.3 FLUSH语法"><code class="literal">FLUSH</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作：
           </font></font><code class="literal">flush-hosts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">flush-logs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">flush-privileges</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">flush-status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">flush-tables</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">flush-threads</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">reload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">reload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令会通知服务器将授权表重新加载到内存中。
          </font></font><code class="literal">flush-privileges</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个同义词
           </font></font><code class="literal">reload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          命令关闭并重新打开日志文件并刷新所有表。</font><font style="vertical-align: inherit;">其他
           </font><font style="vertical-align: inherit;">
          命令执行类似于的功能
           </font><font style="vertical-align: inherit;">，但是更具体并且在某些情况下可能是优选的。</font><font style="vertical-align: inherit;">例如，如果您只想刷新日志文件，那么这</font><font style="vertical-align: inherit;">是比选择更好的选择</font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">flush-<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">refresh</code><font style="vertical-align: inherit;"></font><code class="literal">flush-logs</code><font style="vertical-align: inherit;"></font><code class="literal">refresh</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><a name="priv_replication-client"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_replication-client"><code class="literal">REPLICATION CLIENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          权限允许使用的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS语法"><code class="literal">SHOW
          MASTER STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE
          STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-binary-logs" title="13.7.5.1 SHOW BINARY LOGS语法"><code class="literal">SHOW BINARY
          LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
        </font></font></p></li><li class="listitem"><p><a name="priv_replication-slave"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限应授予从服务器用作主服务器连接到当前服务器的帐户。</font><font style="vertical-align: inherit;">如果没有此权限，从属服务器无法请求对主服务器上的数据库进行更新。
        </font></font></p></li><li class="listitem"><p><a name="priv_select"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使您能够从数据库中的表中选择行。
          </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当它们实际从表中检索行时才</font><font style="vertical-align: inherit;">需要该
           </font><font style="vertical-align: inherit;">特权。</font><font style="vertical-align: inherit;">一些
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句不访问表，并且可以在没有任何数据库许可的情况下执行。</font><font style="vertical-align: inherit;">例如，您可以
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作简单的计算器来评估不参考表的表达式：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT 1 + 1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT PI（）* 2;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还需要读取列值等语句的权限。</font><font style="vertical-align: inherit;">例如，对于</font><font style="vertical-align: inherit;">
          在</font><font style="vertical-align: inherit;">语句中</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">赋值</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或在</font><font style="vertical-align: inherit;">或
           </font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中
           </font><font style="vertical-align: inherit;">命名的</font><font style="vertical-align: inherit;">列的右侧引用的列</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">需要使用这些列
           </font><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还需要用于被与用于表或视图特权
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，包括视图任何基础表。
        </font></font></p></li><li class="listitem"><p><a name="priv_show-databases"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_show-databases"><code class="literal">SHOW DATABASES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限使帐户能够通过发布该</font></font><code class="literal">SHOW DATABASE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">来查看数据库名称
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">没有此权限的帐户只能看到他们拥有某些权限的数据库，并且如果服务器是使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-show-database"><code class="option">--skip-show-database</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动的，则完全不能使用该语句
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局特权都是数据库的特权。
        </font></font></p></li><li class="listitem"><p><a name="priv_show-view"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_show-view"><code class="literal">SHOW VIEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-view" title="13.7.5.13 SHOW CREATE VIEW语法"><code class="literal">SHOW CREATE VIEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          声明。</font><font style="vertical-align: inherit;">这个特权对于使用的视图也是需要的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="priv_shutdown"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权支持使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#shutdown" title="13.7.6.7 SHUTDOWN语法"><code class="literal">SHUTDOWN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin shutdown</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令和
           </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-shutdown" title="27.8.7.71 mysql_shutdown（）"><code class="literal">mysql_shutdown()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C API函数。
        </font></font></p></li><li class="listitem"><p><a name="priv_super"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限启用这些操作和服务器行为：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过修改全局系统变量来启用配置更改。</font><font style="vertical-align: inherit;">对于某些系统变量，设置会话值还需要
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权; </font><font style="vertical-align: inherit;">如果是这样，则在变量描述中指出。</font><font style="vertical-align: inherit;">实例包括
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_log_bin"><code class="literal">sql_log_bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_log_off"><code class="literal">sql_log_off</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用对全局事务特征的更改（请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.3.6节“SET TRANSACTION语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用从属服务器上的启动和停止复制，包括组复制。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
              TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-replication-filter" title="13.4.2.2更改复制过滤器语法"><code class="literal">CHANGE REPLICATION
              FILTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#purge-binary-logs" title="13.4.1.1 PURGE BINARY LOGS语法"><code class="literal">PURGE BINARY LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#binlog" title="13.7.6.1 BINLOG语法"><code class="literal">BINLOG</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">启用二进制日志控制
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在执行视图或存储程序时启用设置有效授权ID。</font><font style="vertical-align: inherit;">具有此权限的用户可以在</font></font><code class="literal">DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图或存储程序</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性中</font><font style="vertical-align: inherit;">指定任何帐户
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              允许使用的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE
              SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-server" title="13.1.7 ALTER SERVER语法"><code class="literal">ALTER
              SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-server" title="13.1.28 DROP SERVER语法"><code class="literal">DROP
              SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin调试</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
              命令。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按键旋转。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_des-encrypt"><code class="literal">DES_ENCRYPT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能</font><font style="vertical-align: inherit;">可以读取DES密钥文件
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用版本令牌用户定义函数的执行。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用对非</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">不允许的客户端连接的控制</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  启用使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#kill" title="13.7.6.4 KILL语法"><code class="literal">KILL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  语句或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin kill</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  命令来终止属于其他帐户的线程。</font><font style="vertical-align: inherit;">（你总是可以杀死你自己的线程。）
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  达到</font><font style="vertical-align: inherit;">由</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">控制的连接限制</font><font style="vertical-align: inherit;">
                  ，服务器</font><font style="vertical-align: inherit;">也会</font><font style="vertical-align: inherit;">从</font><font style="vertical-align: inherit;">客户端
                   </font><font style="vertical-align: inherit;">接受一个连接
                   </font><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  即使</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">系统变量，</font><font style="vertical-align: inherit;">也可以执行更新
                   </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这适用于表更新和使用帐户管理语句，如
                   </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                   </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端连接</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_init_connect"><code class="literal">init_connect</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">
                  ，服务器不执行
                   </font><font style="vertical-align: inherit;">系统变量内容
                   </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  处于脱机模式（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_offline_mode"><code class="literal">offline_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  启用）的服务器不会</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下一个客户端请求中</font><font style="vertical-align: inherit;">终止
                   </font><font style="vertical-align: inherit;">客户端连接，并接受来自</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端的</font><font style="vertical-align: inherit;">新连接
                   </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果启用二进制日志记录功能，则</font><font style="vertical-align: inherit;">
          可能还需要</font><font style="vertical-align: inherit;">创建或更改存储功能</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">权限，如
           </font></font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-programs-logging" title="23.7存储程序的二进制记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第23.7节“存储程序的二进制日志记录”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="priv_trigger"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_trigger"><code class="literal">TRIGGER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使触发操作成为可能。</font><font style="vertical-align: inherit;">您必须拥有该表的特权才能创建，删除，执行或显示该表的触发器。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当触发器被激活（由谁拥有特权执行用户</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与触发器关联的表的语句），触发器执行要求谁定义触发器的用户仍然有
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_trigger"><code class="literal">TRIGGER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。
        </font></font></p></li><li class="listitem"><p><a name="priv_update"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_update"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使行能够在数据库中的表中更新。
        </font></font></p></li><li class="listitem"><p><a name="priv_usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_usage"><code class="literal">USAGE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限说明符表示</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有权限。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它在全球范围内</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于修改帐户属性，例如资源限制或SSL特性，而无需命名特定的帐户权限。
          </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-grants" title="13.7.5.21 SHOW GRANTS语法"><code class="literal">SHOW GRANTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_usage"><code class="literal">USAGE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以指示帐户在特权级别没有特权。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      向账户授予只有它需要的权限是一个好主意。</font><font style="vertical-align: inherit;">您在授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理权限</font><font style="vertical-align: inherit;">时应特别小心</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限可能会被滥用以将任何MySQL服务器可以在服务器主机上读取的文件读入数据库表中。</font><font style="vertical-align: inherit;">这包括服务器数据目录中所有世界可读的文件和文件。</font><font style="vertical-align: inherit;">然后可以使用表
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来将其内容传输到客户端主机。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权使用户可以将其权限授予其他用户。</font><font style="vertical-align: inherit;">具有不同特权和特权的两个用户
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以组合特权。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_alter"><code class="literal">ALTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可以用来通过重命名表来颠覆权限系统。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可能会被滥用以完全通过终止服务器来拒绝向其他用户提供服务。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_process"><code class="literal">PROCESS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可用于查看当前正在执行的语句的纯文本，包括设置或更改密码的语句。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可用于终止其他会话或更改服务器的运行方式。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库本身</font><font style="vertical-align: inherit;">授予的权限</font><font style="vertical-align: inherit;">可用于更改密码和其他访问权限信息。</font><font style="vertical-align: inherit;">密码被加密存储，所以恶意用户不能简单地阅读它们以知道明文密码。</font><font style="vertical-align: inherit;">但是，对</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表
           </font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">具有写权限的用户
           </font><font style="vertical-align: inherit;">可以更改帐户的密码，然后使用该帐户连接到MySQL服务器。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="grant-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.2授予表格</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528119528032"></a><a class="indexterm" name="idm140528119526544"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库包括包含关于用户帐户和他们持有的特权信息的几个授权表。</font><font style="vertical-align: inherit;">本节介绍这些表格。</font><font style="vertical-align: inherit;">有关系统数据库中其他表的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#system-database" title="5.3 mysql系统数据库"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.3节“mysql系统数据库”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要操纵授权表的内容，请使用帐户管理语句（如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，）
       </font><font style="vertical-align: inherit;">间接修改它们
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置帐户并控制每个帐户的可用权限。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#account-management-sql" title="13.7.1账户管理陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1节“帐户管理语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这里的讨论描述了授权表的底层结构以及服务器在与客户端交互时如何使用其内容。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        using语句，如授权表的直接修改
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不鼓励，并在您自行承担风险。</font><font style="vertical-align: inherit;">服务器可以自由忽略由于此类修改而变得格式错误的行。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从MySQL 5.7.18开始，对于修改授权表的任何操作，服务器会检查该表是否具有预期的结构，如果不是，则会产生错误。
        </font><font style="vertical-align: inherit;">必须运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以将表更新为预期的结构。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这些</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库表包含授权信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用户帐户，全局权限和其他非特权列
        </font></font></p><a class="indexterm" name="idm140528119508464"></a><a class="indexterm" name="idm140528119506976"></a><a class="indexterm" name="idm140528119505488"></a></li><li class="listitem"><p>
          <code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：数据库级别的权限
        </font></font></p><a class="indexterm" name="idm140528119502528"></a><a class="indexterm" name="idm140528119501040"></a><a class="indexterm" name="idm140528119499552"></a></li><li class="listitem"><p>
          <code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：表级特权
        </font></font></p><a class="indexterm" name="idm140528119496560"></a><a class="indexterm" name="idm140528119495072"></a><a class="indexterm" name="idm140528119493584"></a></li><li class="listitem"><p>
          <code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：列级权限
        </font></font></p><a class="indexterm" name="idm140528119490592"></a><a class="indexterm" name="idm140528119489104"></a><a class="indexterm" name="idm140528119487616"></a></li><li class="listitem"><p>
          <code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：存储过程和功能特权
        </font></font></p><a class="indexterm" name="idm140528119484592"></a><a class="indexterm" name="idm140528119483104"></a><a class="indexterm" name="idm140528119481616"></a></li><li class="listitem"><p>
          <code class="literal">proxies_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：代理用户权限
</font></font></p><a class="indexterm" name="idm140528119478624"></a><a class="indexterm" name="idm140528119477136"></a><a class="indexterm" name="idm140528119475648"></a></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个授权表都包含范围列和特权列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          范围列确定表中每一行的范围; </font><font style="vertical-align: inherit;">也就是行所适用的上下文。</font><font style="vertical-align: inherit;">例如，
           </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与表行</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
           </font></font><code class="literal">'h1.example.net'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">'bob'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于认证到来自主机的服务器进行连接，
           </font></font><code class="literal">h1.example.net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由客户端指定的用户名</font></font><code class="literal">bob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">类似地，一个
           </font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格行</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其
           </font><font style="vertical-align: inherit;">值为</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值为</font></font><code class="literal">'h1.example.net'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">'bob'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">'reports'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><code class="literal">bob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从主机连接
           </font></font><code class="literal">h1.example.net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以访问
           </font></font><code class="literal">reports</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库时应用。</font><font style="vertical-align: inherit;">在
           </font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
          </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表包含指示每个行适用的表或表/列组合的范围列。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围列表示存储程序到各行适用。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          权限列指示表行授予的特权; </font><font style="vertical-align: inherit;">也就是说，它允许执行哪些操作。</font><font style="vertical-align: inherit;">服务器将各种授权表中的信息组合起来，形成对用户权限的完整描述。
          </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#request-access" title="6.2.5访问控制，阶段2：请求验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.5节“访问控制第2阶段：请求验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述了这个规则。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器按照以下方式使用授权表：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          的</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表范围列确定是否拒绝或允许传入连接。</font><font style="vertical-align: inherit;">对于允许的连接，</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">授予的任何特权都
           </font><font style="vertical-align: inherit;">表示用户的全局特权。</font><font style="vertical-align: inherit;">此表中授予的任何权限均适用于
           </font><font style="vertical-align: inherit;">服务器上的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库。
</font></font></p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于任何全局特权都被视为所有数据库的特权，因此任何全局特权都允许用户</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-databases" title="13.7.5.14 SHOW DATABASES语法"><code class="literal">SHOW
            DATABASES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过检查
             </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#schemata-table" title="24.21 INFORMATION_SCHEMA SCHEMATA表"><code class="literal">SCHEMATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表
             </font><font style="vertical-align: inherit;">来查看所有数据库名称</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表范围列决定哪些用户可以访问哪些数据库从哪个主机。</font><font style="vertical-align: inherit;">权限列确定允许的操作。</font><font style="vertical-align: inherit;">在数据库级授予的特权适用于数据库和数据库中的所有对象，如表和存储程序。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font><font style="vertical-align: inherit;">表</font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
           </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格类似
           </font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但更为细化：它们适用于表和列级别，而不适用于数据库级别。</font><font style="vertical-align: inherit;">在表级授予的特权适用于表及其所有列。</font><font style="vertical-align: inherit;">在列级授予的特权仅适用于特定列。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表适用于存储的例程（过程和函数）。</font><font style="vertical-align: inherit;">在例行级授予的特权仅适用于单一程序或功能。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">proxies_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表指示哪些用户可以充当其他用户的代理以及用户是否可以授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他用户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">特权。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">
      访问控制的第一阶段和第二阶段都</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">数据库中的</font><font style="vertical-align: inherit;">表</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据表</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#privilege-system" title="6.2 MySQL访问权限系统"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2节“MySQL Access Privilege System”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在
       </font><font style="vertical-align: inherit;">这里显示</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的列。
</font></font></p>
<div class="table">
<a name="idm140528119433056"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.3用户和数据库表列</font></font></b></p>
<div class="table-contents">
<table><colgroup><col width="40%"><col width="30%"><col width="30%"></colgroup><thead><tr>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表名称</font></font></th>
          <th scope="col"><code class="literal">user</code></th>
          <th scope="col"><code class="literal">db</code></th>
        </tr></thead><tbody><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围列</font></font></strong></span></td>
          <td><code class="literal">Host</code></td>
          <td><code class="literal">Host</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">User</code></td>
          <td><code class="literal">Db</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td></td>
          <td><code class="literal">User</code></td>
        </tr><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权列</font></font></strong></span></td>
          <td><code class="literal">Select_priv</code></td>
          <td><code class="literal">Select_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Insert_priv</code></td>
          <td><code class="literal">Insert_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Update_priv</code></td>
          <td><code class="literal">Update_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Delete_priv</code></td>
          <td><code class="literal">Delete_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Index_priv</code></td>
          <td><code class="literal">Index_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Alter_priv</code></td>
          <td><code class="literal">Alter_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Create_priv</code></td>
          <td><code class="literal">Create_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Drop_priv</code></td>
          <td><code class="literal">Drop_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Grant_priv</code></td>
          <td><code class="literal">Grant_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Create_view_priv</code></td>
          <td><code class="literal">Create_view_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Show_view_priv</code></td>
          <td><code class="literal">Show_view_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Create_routine_priv</code></td>
          <td><code class="literal">Create_routine_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Alter_routine_priv</code></td>
          <td><code class="literal">Alter_routine_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Execute_priv</code></td>
          <td><code class="literal">Execute_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Trigger_priv</code></td>
          <td><code class="literal">Trigger_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Event_priv</code></td>
          <td><code class="literal">Event_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Create_tmp_table_priv</code></td>
          <td><code class="literal">Create_tmp_table_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Lock_tables_priv</code></td>
          <td><code class="literal">Lock_tables_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">References_priv</code></td>
          <td><code class="literal">References_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Reload_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Shutdown_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Process_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">File_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Show_db_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Super_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Repl_slave_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Repl_client_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Create_user_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Create_tablespace_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全列</font></font></strong></span></td>
          <td><code class="literal">ssl_type</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">ssl_cipher</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">x509_issuer</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">x509_subject</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">plugin</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">authentication_string</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">password_expired</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">password_last_changed</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">password_lifetime</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">account_locked</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源控制列</font></font></strong></span></td>
          <td><code class="literal">max_questions</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">max_updates</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">max_connections</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">max_user_connections</code></td>
          <td></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列存储身份验证插件和证书信息。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器使用</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      帐户行列中</font><font style="vertical-align: inherit;">指定的插件</font><font style="vertical-align: inherit;">来验证帐户的连接尝试。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列必须是非空的。</font><font style="vertical-align: inherit;">在启动时，在运行时</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-privileges"><code class="literal">FLUSH
      PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行时，服务器检查
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格行。</font><font style="vertical-align: inherit;">对于任何具有空</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的</font><font style="vertical-align: inherit;">行
       </font><font style="vertical-align: inherit;">，服务器会向此表单的错误日志写入警告：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[警告]用户输入' </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'@' </font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'有一个空的插件</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值。</font><font style="vertical-align: inherit;">用户将被忽略，任何人都无法使用该用户登录</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
了。</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要解决此问题，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#account-upgrades" title="6.5.1.3从4.1之前的密码散列和mysql_old_password插件迁移"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.3节“从4.1之前的密码散列和mysql_old_password插件迁移”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">password_expired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列允许DBA过期帐户密码并要求用户重置密码。</font><font style="vertical-align: inherit;">默认</font></font><code class="literal">password_expired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是
       </font></font><code class="literal">'N'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但可以</font></font><code class="literal">'Y'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">帐户密码过期后，帐户在后续连接到服务器时执行的所有操作都会导致错误，直到用户发出
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明以建立新帐户密码。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      密码过期后可以</font><font style="vertical-align: inherit;">通过将密码设置为其当前值</font><font style="vertical-align: inherit;">来</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码。</font><font style="vertical-align: inherit;">作为一个良好的政策，最好选择一个不同的密码。
    </font></font></p><p>
      <code class="literal">password_last_changed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
       </font></font><code class="literal">TIMESTAMP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示密码上次更改时间的列。</font><font style="vertical-align: inherit;">该值</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不仅适用于使用MySQL内置身份验证方法的帐户（使用</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font><font style="vertical-align: inherit;">的身份验证插件的帐户
       </font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">该值适用
       </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于其他帐户，例如使用外部认证系统进行身份验证的帐户。
    </font></font></p><p>
      <code class="literal">password_last_changed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过更新
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报表，并通过
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创造一个帐户或更改帐户密码的语句。
    </font></font></p><p>
      <code class="literal">password_lifetime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示帐户密码的生存期，以天为单位。</font><font style="vertical-align: inherit;">如果密码超过其使用期限（使用</font></font><code class="literal">password_last_changed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      列</font><font style="vertical-align: inherit;">进行评估</font><font style="vertical-align: inherit;">），则当客户端使用该帐户进行连接时，服务器认为密码已过期。</font><font style="vertical-align: inherit;">的值</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      大于零意味着该密码必须在每次更改
       </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">天。</font><font style="vertical-align: inherit;">值为0将禁用自动密码到期。</font><font style="vertical-align: inherit;">如果该值为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（缺省值），则应用全局过期策略，如</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">所定义
       </font><font style="vertical-align: inherit;">。
    </font></font></p><a class="indexterm" name="idm140528119220512"></a><a class="indexterm" name="idm140528119219440"></a><a class="indexterm" name="idm140528119217952"></a><p>
      <code class="literal">account_locked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示账户是否被锁定（参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#account-locking" title="6.3.11用户帐户锁定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.11节“用户账户锁定”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在访问控制的第二阶段，服务器执行请求验证，以确保每个客户端对其发出的每个请求拥有足够的权限。</font><font style="vertical-align: inherit;">除了
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予表之外，服务器还可以查询</font><font style="vertical-align: inherit;">涉及表的请求</font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">后面的表格在表和列级别提供更好的权限控制。</font><font style="vertical-align: inherit;">它们具有下表中显示的列。
</font></font></p>
<div class="table">
<a name="idm140528119210992"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.4 tables_priv和columns_priv表列</font></font></b></p>
<div class="table-contents">
<table><colgroup><col width="20%"><col width="20%"><col width="20%"></colgroup><thead><tr>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表名称</font></font></th>
          <th scope="col"><code class="literal">tables_priv</code></th>
          <th scope="col"><code class="literal">columns_priv</code></th>
        </tr></thead><tbody><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围列</font></font></strong></span></td>
          <td><code class="literal">Host</code></td>
          <td><code class="literal">Host</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Db</code></td>
          <td><code class="literal">Db</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">User</code></td>
          <td><code class="literal">User</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Table_name</code></td>
          <td><code class="literal">Table_name</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td></td>
          <td><code class="literal">Column_name</code></td>
        </tr><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权列</font></font></strong></span></td>
          <td><code class="literal">Table_priv</code></td>
          <td><code class="literal">Column_priv</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Column_priv</code></td>
          <td></td>
        </tr><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他栏目</font></font></strong></span></td>
          <td><code class="literal">Timestamp</code></td>
          <td><code class="literal">Timestamp</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Grantor</code></td>
          <td></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      的</font></font><code class="literal">Timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Grantor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      列被设置为当前时间戳和
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，分别，但其他未使用的。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了验证涉及存储例程的请求，服务器可以查阅</font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有下表所示列的表。
</font></font></p>
<div class="table">
<a name="idm140528119162640"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.5 procs_priv表列</font></font></b></p>
<div class="table-contents">
<table><colgroup><col width="20%"><col width="20%"></colgroup><thead><tr>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表名称</font></font></th>
          <th scope="col"><code class="literal">procs_priv</code></th>
        </tr></thead><tbody><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围列</font></font></strong></span></td>
          <td><code class="literal">Host</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Db</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">User</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Routine_name</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Routine_type</code></td>
        </tr><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权列</font></font></strong></span></td>
          <td><code class="literal">Proc_priv</code></td>
        </tr><tr>
          <td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他栏目</font></font></strong></span></td>
          <td><code class="literal">Timestamp</code></td>
        </tr><tr>
          <td scope="row"></td>
          <td><code class="literal">Grantor</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">Routine_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列是
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#enum" title="11.4.4 ENUM类型"><code class="literal">ENUM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为
       </font></font><code class="literal">'FUNCTION'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">'PROCEDURE'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的行，用于指示行所引用的例程的类型。</font><font style="vertical-align: inherit;">此列允许为具有相同名称的函数和过程单独授予权限。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在</font></font><code class="literal">Timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="literal">Grantor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      列未使用。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">proxies_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表记录有关代理帐户的信息。</font><font style="vertical-align: inherit;">它有这些列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：代理账户; </font><font style="vertical-align: inherit;">即具有
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理帐户特权的帐户。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">Proxied_host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">Proxied_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：代理帐户。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">Grantor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：未使用。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">With_grant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：代理帐户是否可以授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他帐户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">权限。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要使帐户能够授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他帐户</font><font style="vertical-align: inherit;">的
       </font><font style="vertical-align: inherit;">权限，该帐户必须在</font></font><code class="literal">proxies_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格中</font></font><code class="literal">With_grant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为1的行，
       </font></font><code class="literal">Proxied_host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
       </font></font><code class="literal">Proxied_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为指示可授予该权限的帐户。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">'root'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL安装过程中创建</font><font style="vertical-align: inherit;">的
       </font><font style="vertical-align: inherit;">帐户在</font></font><code class="literal">proxies_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表中</font><font style="vertical-align: inherit;">有一行</font><font style="vertical-align: inherit;">允许授予</font><font style="vertical-align: inherit;">所有用户和所有主机</font><font style="vertical-align: inherit;">的
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限
       </font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这使得</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够设置代理用户，并且能够委派给其他账户设置代理用户的权限。</font><font style="vertical-align: inherit;">参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      授权表中的范围列包含字符串。</font><font style="vertical-align: inherit;">每个的默认值是空字符串。</font><font style="vertical-align: inherit;">下表显示了每列中允许的字符数。
</font></font></p>
<div class="table">
<a name="idm140528119105184"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.6授予表范围列长度</font></font></b></p>
<div class="table-contents">
<table><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列名称</font></font></th>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大允许字符数</font></font></th>
        </tr></thead><tbody><tr>
          <td scope="row"><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， </font></font><code class="literal">Proxied_host</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">60</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， </font></font><code class="literal">Proxied_user</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">Password</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">41</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">Db</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">Table_name</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">Column_name</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">Routine_name</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><a class="indexterm" name="idm140528119078576"></a><a class="indexterm" name="idm140528119077088"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于访问检查的目的，进行比较
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Proxied_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">Table_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值是大小写敏感的。</font><font style="vertical-align: inherit;">的比较</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">Proxied_host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Column_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">Routine_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值是不区分大小写。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表列出了被声明为一个单独的列每个特权
       </font></font><code class="literal">ENUM('N','Y') DEFAULT 'N'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">换句话说，每个权限都可以被禁用或启用，默认情况下被禁用。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      的</font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表申报权限列的
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#set" title="11.4.5 SET类型"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">这些列中的值可以包含表控制权限的任意组合。</font><font style="vertical-align: inherit;">只有在列值中列出的特权才被启用。
</font></font></p>
<div class="table">
<a name="idm140528119061344"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.7设置类型权限列值</font></font></b></p>
<div class="table-contents">
<table><colgroup><col width="20%"><col width="25%"><col width="45%"></colgroup><thead><tr>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表名称</font></font></th>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列名称</font></font></th>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能的设置元素</font></font></th>
        </tr></thead><tbody><tr>
          <td scope="row"><code class="literal">tables_priv</code></td>
          <td><code class="literal">Table_priv</code></td>
          <td><code class="literal">'Select', 'Insert', 'Update', 'Delete', 'Create', 'Drop',
            'Grant', 'References', 'Index', 'Alter', 'Create View',
            'Show view', 'Trigger'</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">tables_priv</code></td>
          <td><code class="literal">Column_priv</code></td>
          <td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">columns_priv</code></td>
          <td><code class="literal">Column_priv</code></td>
          <td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">procs_priv</code></td>
          <td><code class="literal">Proc_priv</code></td>
          <td><code class="literal">'Execute', 'Alter Routine', 'Grant'</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      只有</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格指定管理权限，例如</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_reload"><code class="literal">RELOAD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">管理操作是服务器本身的操作，并不是特定于数据库的，因此没有理由在其他授权表中列出这些权限。</font><font style="vertical-align: inherit;">因此，服务器只需咨询
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表以确定用户是否可以执行管理操作。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限也仅在</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这不是管理权限，但用户在服务器主机上读写文件的能力与被访问的数据库无关。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器在启动时将授权表的内容读入内存。</font><font style="vertical-align: inherit;">您可以通过发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-privileges</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin reload</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">来告诉它重新加载表
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">授予表的更改将按照</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#privilege-changes" title="6.2.6特权更改生效时"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.6节“特权更改</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生效时”的指示生效
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在修改帐户时，验证您的更改是否具有预期效果是一个好主意。</font><font style="vertical-align: inherit;">要检查给定帐户的权限，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-grants" title="13.7.5.21 SHOW GRANTS语法"><code class="literal">SHOW GRANTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      语句。</font><font style="vertical-align: inherit;">例如，要确定授予用户名和主机名值为</font></font><code class="literal">bob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font><font style="vertical-align: inherit;">的帐户的权限
       </font></font><code class="literal">pc84.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用以下语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示'bob'@pc84.example.com'的赠款;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要显示帐户的非特权属性，请使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-user" title="13.7.5.12 SHOW CREATE USER语法"><code class="literal">SHOW CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW CREATE USER'bob'@'pc84.example.com';
</font></font></pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-names"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.3指定帐户名称</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528119014928"></a><a class="indexterm" name="idm140528119013888"></a><a class="indexterm" name="idm140528119012400"></a><a class="indexterm" name="idm140528119010912"></a><a class="indexterm" name="idm140528119009424"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL帐户名由用户名和主机名组成。</font><font style="vertical-align: inherit;">这样可以为可以从不同主机连接的具有相同名称的用户创建帐户。</font><font style="vertical-align: inherit;">本节介绍如何编写帐户名称，包括特殊值和通配符规则。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在SQL语句，例如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE
      USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户名遵循以下规则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          帐户名称语法是
           </font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          仅由用户名组成的帐户名相当于
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，</font><font style="vertical-align: inherit;">相当于
           </font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'%'</code><font style="vertical-align: inherit;"></font><code class="literal">'me'</code><font style="vertical-align: inherit;"></font><code class="literal">'me'@'%'</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果用户名称和主机名称作为非引用标识符合法，则不需要引用它们。</font><font style="vertical-align: inherit;">引号是指定一个</font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含特殊字符（如空格或</font></font><code class="literal">-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），或</font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含特殊字符或通配符（如
           </font></font><code class="literal">.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">字符串</font><font style="vertical-align: inherit;">所必需的</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">例如
           </font></font><code class="literal">'test-user'@'%.com'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用反引号（</font></font><code class="literal">`</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），单引号（</font></font><code class="literal">'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或双引号（</font></font><code class="literal">"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">引用用户名和主机名作为标识符或字符串</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关字符串引用和标识符引用的指导原则，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#string-literals" title="9.1.1字符串文字"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.1.1节“字符串文字”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#identifiers" title="9.2模式对象名称"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2节“模式对象名称”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用户名和主机名部分（如果带有引号）必须单独引用。</font><font style="vertical-align: inherit;">那就是写
           </font></font><code class="literal">'me'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是
           </font></font><code class="literal">'me@localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">后者实际上相当于</font></font><code class="literal">'me@localhost'@'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          or </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的</font><font style="vertical-align: inherit;">引用</font><font style="vertical-align: inherit;">等同于从字面上指定当前客户端的用户名和主机名。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户名和主机名部分的单独列</font><font style="vertical-align: inherit;">将帐户名称存储在</font><font style="vertical-align: inherit;">系统数据库</font><font style="vertical-align: inherit;">中的授权表中
       </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表包含每个帐户的一行。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列存储用户名和主机名。</font><font style="vertical-align: inherit;">该表还指出该帐户拥有哪些全局特权。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          其他授权表指示帐户对数据库中的数据库和对象具有的权限。</font><font style="vertical-align: inherit;">这些表格
           </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列可以存储帐户名称。</font><font style="vertical-align: inherit;">这些表中的每一行与</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中具有相同</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值</font><font style="vertical-align: inherit;">的帐户相关联</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了进行访问检查，用户值的比较区分大小写。</font><font style="vertical-align: inherit;">主机值的比较不区分大小写。
</font></font></p><a class="indexterm" name="idm140528118971104"></a><a class="indexterm" name="idm140528118969616"></a></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关授权表结构的更多详细信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#grant-tables" title="6.2.2授予表格"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.2节“授予表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      用户名和主机名具有某些特殊值或通配符约定，如下所述。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      帐户名称的用户名部分可以是与输入连接尝试的用户名字面相匹配的非空白值，也可以是与任何用户名匹配的空值（空字符串）。</font><font style="vertical-align: inherit;">具有空白用户名的帐户是匿名用户。</font><font style="vertical-align: inherit;">要在SQL语句中指定匿名用户，请使用带引号的空用户名部分，例如</font></font><code class="literal">''@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      帐户名称的主机名部分可以采用多种形式，并且允许使用通配符：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          主机值可以是主机名或IP地址（IPv4或IPv6）。</font><font style="vertical-align: inherit;">该名称</font></font><code class="literal">'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示本地主机。</font><font style="vertical-align: inherit;">IP地址</font></font><code class="literal">'127.0.0.1'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表示IPv4环回接口。</font><font style="vertical-align: inherit;">IP地址
           </font></font><code class="literal">'::1'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示IPv6回环接口。
        </font></font></p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140528118960240"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

          在</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通配符允许在主机名或IP地址的值。</font><font style="vertical-align: inherit;">这些与操作员执行的模式匹配操作具有相同的含义</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，一个主机值</font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配任何主机名，而一个值
           </font></font><code class="literal">'%.mysql.com'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配</font></font><code class="literal">mysql.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域中的</font><font style="vertical-align: inherit;">任何主机
           </font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">'198.51.100.%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配198.51.100 C类网络中的任何主机。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因为主机值允许使用IP通配符值（例如，</font></font><code class="literal">'198.51.100.%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了匹配子网上的每个主机），所以有人可以通过命名主机来尝试利用此功能</font></font><code class="literal">198.51.100.somewhere.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了阻止这种尝试，MySQL不会在以数字和点开头的主机名上执行匹配。</font><font style="vertical-align: inherit;">例如，如果主机被命名</font></font><code class="literal">1.2.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则其名称永远不会与主机部分的帐户名称匹配。</font><font style="vertical-align: inherit;">IP通配符值只能匹配IP地址，而不能匹配主机名。
        </font></font></p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140528118949104"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

          对于指定为IPv4地址的主机值，可以给出网络掩码以指示要为网络号使用多少个地址位。</font><font style="vertical-align: inherit;">网络掩码符号不能用于IPv6地址。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语法是
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
        </font></font><code class="literal"><em class="replaceable"><code>host_ip</code></em>/<em class="replaceable"><code>netmask</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'david'@'198.51.100.0/255.255.255.0';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这使得</font></font><code class="literal">david</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以从具有满足</font></font><em class="replaceable"><code>client_ip</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下条件</font><font style="vertical-align: inherit;">的IP地址的任何客户端主机进行连接
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="clike" class="programlisting"><em class="replaceable"><code>client_ip</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＆</font></font><em class="replaceable"><code>netmask</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>host_ip</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          就是说，对于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          刚刚显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">陈述：
        </font></font></p><pre data-lang="clike" class="programlisting"><em class="replaceable"><code>client_ip</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ＆255.255.255.0 = 198.51.100.0
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          满足此条件范围的IP地址
           </font></font><code class="literal">198.51.100.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来
           </font></font><code class="literal">198.51.100.255</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          网络掩码通常以位设置为1开始，接着位设置为0.示例：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">198.0.0.0/255.0.0.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：198类A网络上的任何主机
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">198.51.100.0/255.255.0.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：198.51 B类网络上的任何主机
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">198.51.100.0/255.255.255.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：198.51.100 C类网络上的任何主机
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">198.51.100.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：只有具有此特定IP地址的主机
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器使用系统DNS解析程序返回的值为客户端主机名或IP地址执行帐户名中主机值与客户端主机的匹配。</font><font style="vertical-align: inherit;">除了使用网络掩码表示法指定帐户主机值以外，服务器还会将该比较作为字符串匹配执行，即使对于作为IP地址给定的帐户主机值也是如此。</font><font style="vertical-align: inherit;">这意味着您应该使用DNS使用的相同格式指定帐户主机值。</font><font style="vertical-align: inherit;">以下是需要注意的问题示例：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设本地网络上的主机具有完全限定的名称</font></font><code class="literal">host1.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果DNS返回此主机的名称查找，请
           </font></font><code class="literal">host1.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在帐户主机值中使用该名称。</font><font style="vertical-align: inherit;">如果DNS只是返回</font></font><code class="literal">host1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请</font></font><code class="literal">host1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改为</font><font style="vertical-align: inherit;">使用
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果DNS返回给定主机的IP地址
           </font></font><code class="literal">198.51.100.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则该值将与帐户主机值匹配，</font></font><code class="literal">198.51.100.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不
           </font><font style="vertical-align: inherit;">匹配</font></font><code class="literal">198.051.100.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同样，它会匹配一个帐户主机模式，</font></font><code class="literal">198.51.100.%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不是</font></font><code class="literal">198.051.100.%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为避免这些问题，建议检查DNS返回主机名和地址的格式。</font><font style="vertical-align: inherit;">在MySQL帐户名称中使用相同格式的值。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="connection-access"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.4访问控制，阶段1：连接验证</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118916640"></a><a class="indexterm" name="idm140528118915600"></a><a class="indexterm" name="idm140528118914112"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当您尝试连接到MySQL服务器时，服务器根据这些条件接受或拒绝连接：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您的身份以及您是否可以通过提供正确的密码来验证您的身份
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          无论您的帐户是锁定还是解锁
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器首先检查凭证，然后检查帐户锁定状态。</font><font style="vertical-align: inherit;">任一步骤失败都会导致服务器完全拒绝您的访问。</font><font style="vertical-align: inherit;">否则，服务器接受连接，然后进入第2阶段并等待请求。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用三个执行凭证检查
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表范围列（</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
       </font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">锁定状态记录在</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格
       </font></font><code class="literal">account_locked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中。</font><font style="vertical-align: inherit;">服务器仅</font><font style="vertical-align: inherit;">在某些</font><font style="vertical-align: inherit;">
      表行中的</font><font style="vertical-align: inherit;">列</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与客户端主机名和用户名匹配</font><font style="vertical-align: inherit;">时才接受连接</font><font style="vertical-align: inherit;">，客户端提供在该行中指定的密码，并且
       </font></font><code class="literal">account_locked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为</font></font><code class="literal">'N'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><a class="xref" href="/mysql-5.7-google-zh/security.html#account-names" title="6.2.3 Specifying Account Names"><font style="vertical-align: inherit;">第6.2.3节“指定帐户名称”</font></a><font style="vertical-align: inherit;">中给出</font><font style="vertical-align: inherit;">了允许</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值
       </font><font style="vertical-align: inherit;">的规则</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">帐户锁定可以通过</font><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">进行更改</font><font style="vertical-align: inherit;">。
    </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#account-names" title="6.2.3指定帐户名称"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您的身份基于两部分信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您连接的客户端主机
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          你的MySQL用户名
</font></font></p></li></ul>
</div>
<a class="indexterm" name="idm140528118894800"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值不是空白，则传入连接中的用户名必须完全匹配。</font><font style="vertical-align: inherit;">如果该
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为空，则它匹配任何用户名。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与传入连接匹配</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表行具有空白用户名，则该用户将被视为不具有名称的匿名用户，而不是具有客户端实际指定的名称的用户。</font><font style="vertical-align: inherit;">这意味着在连接期间（即在第2阶段），所有进一步访问检查都会使用空白用户名。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列可以是空白的。</font><font style="vertical-align: inherit;">这不是通配符，并不意味着任何密码匹配。</font><font style="vertical-align: inherit;">这意味着用户必须连接而不指定密码。</font><font style="vertical-align: inherit;">如果服务器使用插件对客户端进行身份验证，则插件实现的身份验证方法可能会或可能不会使用该</font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      列中</font><font style="vertical-align: inherit;">的密码</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，可能还会使用外部密码对MySQL服务器进行身份验证。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的非</font><font style="vertical-align: inherit;">
      空白</font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示加密的密码。</font><font style="vertical-align: inherit;">MySQL不以明文形式存储任何人都可以看到的密码。</font><font style="vertical-align: inherit;">相反，试图连接的用户提供的密码是加密的（使用由帐户认证插件实施的密码散列方法）。</font><font style="vertical-align: inherit;">然后在连接过程中使用加密的密码来检查密码是否正确。</font><font style="vertical-align: inherit;">这是在没有经过连接的加密密码的情况下完成的。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#user-names" title="6.3.1用户名和密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.1节“用户名和密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从MySQL的角度来看，加密的密码是
       </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真正的</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码，所以你绝对不应该让任何人访问它。</font><font style="vertical-align: inherit;">特别是，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要让非管理员用户读取</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中的</font><font style="vertical-align: inherit;">表格
      </font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      下表显示了表中各种组合</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值
       </font><font style="vertical-align: inherit;">如何
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于传入连接。
</font></font></p>
<div class="informaltable">
<table summary="How various combinations of User and Host values in the user table apply to incoming connections to a MySQL server."><colgroup><col width="15%"><col width="35%"><col width="50%"></colgroup><thead><tr>
          <th scope="col"><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 值</font></font></th>
          <th scope="col"><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 值</font></font></th>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许的连接</font></font></th>
        </tr></thead><tbody><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'h1.example.net'</code></td>
          <td><code class="literal">fred</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从。连接
            </font></font><code class="literal">h1.example.net</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">''</code></td>
          <td><code class="literal">'h1.example.net'</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何用户，从。连接 </font></font><code class="literal">h1.example.net</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'%'</code></td>
          <td><code class="literal">fred</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从任何主机连接</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">''</code></td>
          <td><code class="literal">'%'</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何用户，从任何主机连接</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'%.example.net'</code></td>
          <td><code class="literal">fred</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从</font></font><code class="literal">example.net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域中的</font><font style="vertical-align: inherit;">任何主机连接
            </font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'x.example.%'</code></td>
          <td><code class="literal">fred</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从连接
             </font></font><code class="literal">x.example.net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">x.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">x.example.edu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，等; </font><font style="vertical-align: inherit;">这可能没有用</font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'198.51.100.177'</code></td>
          <td><code class="literal">fred</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从主机连接IP地址
            </font></font><code class="literal">198.51.100.177</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'198.51.100.%'</code></td>
          <td><code class="literal">fred</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从</font></font><code class="literal">198.51.100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C类子网</font><font style="vertical-align: inherit;">中的任何主机连接
            </font></font></td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'198.51.100.0/255.255.255.0'</code></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与前面的例子相同</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      传入连接的客户端主机名和用户名可能与</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">中的多个行匹配
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">前面的一组示例演示了这一点：显示的一些条目与来自</font></font><code class="literal">h1.example.net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by </font><font style="vertical-align: inherit;">的连接匹配</font></font><code class="literal">fred</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当多个匹配成为可能时，服务器必须确定要使用哪一个。</font><font style="vertical-align: inherit;">它解决这个问题如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          无论何时服务器将</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">读</font><font style="vertical-align: inherit;">入内存，它都对行进行排序。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当客户端尝试连接时，服务器按排序顺序查看行。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器使用与客户端主机名和用户名匹配的第一行。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器使用排序规则，首先排序具有最特定</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">文字主机名和IP地址是最具体的。</font><font style="vertical-align: inherit;">（文字IP地址的特异性不受其是否具有网络掩码，因此</font></font><code class="literal">198.51.100.13</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">198.51.100.0/255.255.255.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被认为是同样特异性的。）该模式</font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是指
       </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何主机</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且是最不特定。</font><font style="vertical-align: inherit;">空字符串
       </font></font><code class="literal">''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也意味着</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何主机</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但后来排序</font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">具有相同</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">行
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先</font><font style="vertical-align: inherit;">排列最具体的
       </font><font style="vertical-align: inherit;">值（空白
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值表示</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何用户</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且是最不具体的）。</font><font style="vertical-align: inherit;">对于具有相同特定
       </font><font style="vertical-align: inherit;">值</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的行，顺序不确定。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要看看这是如何工作的，假设</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表格如下所示：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ----------- + ---------- +  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">主机| </font><font style="vertical-align: inherit;">用户| </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- + ---------- +  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">％| </font><font style="vertical-align: inherit;">root | </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">％| </font><font style="vertical-align: inherit;">jeffrey | </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">localhost | </font><font style="vertical-align: inherit;">root | </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">localhost | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- + ---------- +  - </font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当服务器将表读入内存时，它使用刚刚描述的规则对行进行排序。</font><font style="vertical-align: inherit;">排序后的结果如下所示：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ----------- + ---------- +  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">主机| </font><font style="vertical-align: inherit;">用户| </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- + ---------- +  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">localhost | </font><font style="vertical-align: inherit;">root | </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">localhost | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">％| </font><font style="vertical-align: inherit;">jeffrey | </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">％| </font><font style="vertical-align: inherit;">root | </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- + ---------- +  - </font></font><font></font>
</pre><a class="indexterm" name="idm140528118804144"></a><a class="indexterm" name="idm140528118802656"></a><a class="indexterm" name="idm140528118801168"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当客户端尝试连接时，服务器会查看已排序的行并使用找到的第一个匹配项。</font><font style="vertical-align: inherit;">对于从连接
       </font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由</font></font><code class="literal">jeffrey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个从表匹配的行的：一个具有
       </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
       </font></font><code class="literal">'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和一个具有值</font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">'jeffrey'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      行首先按排序顺序出现，这是服务器使用的那个。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这是另一个例子。</font><font style="vertical-align: inherit;">假设</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表格如下所示：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ---------------- + ---------- +  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">主机| </font><font style="vertical-align: inherit;">用户| </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ---------- +  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">％| </font><font style="vertical-align: inherit;">jeffrey | </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">h1.example.net | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ---------- +  - </font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      排序表如下所示：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ---------------- + ---------- +  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">主机| </font><font style="vertical-align: inherit;">用户| </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ---------- +  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">h1.example.net | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">％| </font><font style="vertical-align: inherit;">jeffrey | </font><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ---------- +  - </font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">jeffrey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from
       </font><font style="vertical-align: inherit;">
      的连接</font></font><code class="literal">h1.example.net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与第一行匹配，而</font></font><code class="literal">jeffrey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自任何主机</font><font style="vertical-align: inherit;">的连接</font><font style="vertical-align: inherit;">与第二个匹配。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        认为对于给定的用户名，当服务器试图为连接找到匹配时，首先使用明确指定该用户的所有行是一种常见的误解。</font><font style="vertical-align: inherit;">这不是真的。</font><font style="vertical-align: inherit;">前面的例子说明了这一点，其中来自</font></font><code class="literal">h1.example.net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by
         </font><font style="vertical-align: inherit;">的连接</font></font><code class="literal">jeffrey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先不与包含</font></font><code class="literal">'jeffrey'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为
         </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值</font><font style="vertical-align: inherit;">的行匹配</font><font style="vertical-align: inherit;">，而是与没有用户名</font><font style="vertical-align: inherit;">的行匹配</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此</font></font><code class="literal">jeffrey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即使在连接时指定了用户名，也会被认证为匿名用户。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您能够连接到服务器，但您的权限不符合您的期望，那么您可能正在通过其他帐户进行身份验证。</font><font style="vertical-align: inherit;">要找出服务器用于验证您的帐户，请使用该
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">（请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#information-functions" title="12.14信息功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.14节“信息函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）它以</font><font style="vertical-align: inherit;">
      格式</font><font style="vertical-align: inherit;">返回一个值，
       </font><font style="vertical-align: inherit;">用于指示</font><font style="vertical-align: inherit;">匹配</font><font style="vertical-align: inherit;">表行中的</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">和
       </font><font style="vertical-align: inherit;">值
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设
       </font><font style="vertical-align: inherit;">连接并发出以下查询：
    </font></font><code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">User</code><font style="vertical-align: inherit;"></font><code class="literal">Host</code><font style="vertical-align: inherit;"></font><code class="literal">user</code><font style="vertical-align: inherit;"></font><code class="literal">jeffrey</code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT CURRENT_USER();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CURRENT_USER（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@localhost |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      此处显示的结果表明匹配
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表行具有空白
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值。</font><font style="vertical-align: inherit;">换句话说，服务器被</font></font><code class="literal">jeffrey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视为匿名用户。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      诊断认证问题的另一种方法是打印出</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格并手工排序，以查看第一个匹配的位置。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="request-access"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.5访问控制，阶段2：请求验证</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      建立连接后，服务器进入访问控制的第2阶段。</font><font style="vertical-align: inherit;">对于通过该连接发出的每个请求，服务器都会确定要执行的操作，然后检查您是否有足够的权限来执行此操作。</font><font style="vertical-align: inherit;">这是授予表中的特权列发挥作用的地方。</font><font style="vertical-align: inherit;">这些权限可以来自任何的
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">（您可能会发现参考</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#grant-tables" title="6.2.2授予表格"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.2节“授予表格”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很有帮助</font><font style="vertical-align: inherit;">，该表格列出了每个授权表格中的列。）
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表授予在全局基础上分配给您的权限，并且不管默认数据库是什么。</font><font style="vertical-align: inherit;">例如，如果
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表授予您
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_delete"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权，您可以从服务器主机上的任何数据库的任何表中删除行！</font><font style="vertical-align: inherit;">将</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">权限</font><font style="vertical-align: inherit;">仅</font><font style="vertical-align: inherit;">授予</font><font style="vertical-align: inherit;">需要它们的人员</font><font style="vertical-align: inherit;">是明智的</font><font style="vertical-align: inherit;">，例如数据库管理员。</font><font style="vertical-align: inherit;">对于其他用户，您应该将</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">所有权限
       </font><font style="vertical-align: inherit;">设置为</font></font><code class="literal">'N'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并仅在更具体的级别授予权限。</font><font style="vertical-align: inherit;">您可以授予特定数据库，表，列或例程的权限。
    </font></font></p><a class="indexterm" name="idm140528118756624"></a><a class="indexterm" name="idm140528118755552"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表授予数据库特定的权限。</font><font style="vertical-align: inherit;">此表的范围列中的值可以采用以下形式：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          空白</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值与匿名用户匹配。</font><font style="vertical-align: inherit;">非空白值与字面匹配; </font><font style="vertical-align: inherit;">用户名中没有通配符。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通配符</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在使用
           </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">这些与操作员执行的模式匹配操作具有相同的含义</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您想在授予权限时直接使用任一字符，则必须使用反斜杠进行转义。</font><font style="vertical-align: inherit;">例如，要将下划线字符（</font></font><code class="literal">_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）包含为数据库名称的一部分，请</font></font><code class="literal">\_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">指定它</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          A </font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或空白</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值意味着</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何主机。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span>
        </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          A </font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或空白</font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值意味着</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何数据库。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span>
</p></li></ul>
</div>
<a class="indexterm" name="idm140528118737824"></a><a class="indexterm" name="idm140528118736336"></a><a class="indexterm" name="idm140528118734848"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器将</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">读</font><font style="vertical-align: inherit;">入内存，并在读取</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的同时对其进行排序
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">服务器排序
       </font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于表</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围列。</font><font style="vertical-align: inherit;">与</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表一样，排序会将最具体的值放在最前面，将最不具体的值放到最后，当服务器查找匹配的行时，会使用找到的第一个匹配项。
    </font></font></p><a class="indexterm" name="idm140528118727712"></a><a class="indexterm" name="idm140528118726208"></a><a class="indexterm" name="idm140528118724704"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表授予特定于表，特定于列和特定于例程的特权。</font><font style="vertical-align: inherit;">这些表的范围列中的值可以采用以下形式：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通配符</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可在使用
           </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的列。</font><font style="vertical-align: inherit;">这些与操作员执行的模式匹配操作具有相同的含义
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          A </font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或空白</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值意味着</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何主机。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span>
        </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Table_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">Column_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><code class="literal">Routine_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列不能包含通配符或空白。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器排序</font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      基于表</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">这与</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格排序</font><font style="vertical-align: inherit;">类似</font><font style="vertical-align: inherit;">，但更简单，因为只有</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列可以包含通配符。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器使用排序表来验证它收到的每个请求。</font><font style="vertical-align: inherit;">对于需要管理权限（例如</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_reload"><code class="literal">RELOAD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">请求，</font><font style="vertical-align: inherit;">服务器仅检查
       </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表行，因为这是唯一指定管理权限的表。</font><font style="vertical-align: inherit;">如果该行允许请求的操作，则服务器授予访问权限，否则拒绝访问。</font><font style="vertical-align: inherit;">例如，如果你想执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin shutdown，</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但你的</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表行不授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">权限，服务器甚至不检查</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表就</font><font style="vertical-align: inherit;">拒绝访问
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（它不包含
       </font></font><code class="literal">Shutdown_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，所以不需要这样做。）
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于与数据库相关的请求（</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等），服务器首先通过查看</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格行来</font><font style="vertical-align: inherit;">检查用户的全局特权
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果该行允许请求的操作，则授予访问权限。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的全局特权</font><font style="vertical-align: inherit;">不足，则服务器通过检查</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">来确定用户的数据库特定权限
       </font><font style="vertical-align: inherit;">：
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该服务器会在</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上的匹配</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列与连接用户的主机名和MySQL用户名匹配。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">Db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      列与用户想要访问的数据库相匹配。</font><font style="vertical-align: inherit;">如果没有排为</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，访问被拒绝。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在确定</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表行</font><font style="vertical-align: inherit;">授予的特定于数据库的特权之后
       </font><font style="vertical-align: inherit;">，服务器将它们添加到</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">授予的全局特权</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果结果允许请求的操作，则授予访问权限。</font><font style="vertical-align: inherit;">否则，服务器先后检查用户的表和列权限在</font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，把它们加到用户的权限，并允许或拒绝基于结果存取。</font><font style="vertical-align: inherit;">对于存储例程操作，服务器使用
       </font></font><code class="literal">procs_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表而不是
       </font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      用布尔表达式来表示用户权限计算方式的上述描述可以总结如下：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球特权</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OR（数据库权限和主机权限）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OR表特权</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或列权限</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OR例程权限</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      最初发现</font><font style="vertical-align: inherit;">全局</font><font style="vertical-align: inherit;">行权限不足以满足所请求的操作，那么</font><font style="vertical-align: inherit;">可能并不明显，为什么</font><font style="vertical-align: inherit;">服务器稍后将这些权限添加到数据库，表和列权限。</font><font style="vertical-align: inherit;">原因是请求可能需要多种类型的权限。</font><font style="vertical-align: inherit;">例如，如果您执行
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT INTO ...
      SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，则需要
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。</font><font style="vertical-align: inherit;">你的特权可能是这样的，</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表行授予一个特权和</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格行授予另一个。</font><font style="vertical-align: inherit;">在这种情况下，您拥有执行请求所需的特权，但服务器无法从任何一个表单自行分配; </font><font style="vertical-align: inherit;">必须将两个表中的行授予的权限组合在一起。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="privilege-changes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.6特权更改生效时</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118666640"></a><a class="indexterm" name="idm140528118665184"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动时，它将所有授权表内容读入内存。</font><font style="vertical-align: inherit;">内存表在此时对访问控制有效。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果你修改授权表间接使用账户管理语句，如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET
      PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#rename-user" title="13.7.1.5 RENAME USER语法"><code class="literal">RENAME USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，服务器注意到这些变化，并立即再次加载授权表到内存中。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果你修改授权表直接使用的语句，例如
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你的变化对特权的效果检查，直到你重新启动服务器或告诉它重新加载表。</font><font style="vertical-align: inherit;">如果您直接更改授权表，但忘记重新加载它们，则</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在重新启动服务器之后</font><font style="vertical-align: inherit;">，更改</font><font style="vertical-align: inherit;">才会</font><span class="emphasis"><em><font style="vertical-align: inherit;">生效</font></em></span><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可能会让你想知道为什么你的改变似乎没有什么区别！
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要通知服务器重新加载授权表，请执行刷新特权操作。</font><font style="vertical-align: inherit;">这可以通过发出
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-privileges</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin reload</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来完成。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      授权表重新加载会影响每个现有客户端连接的权限，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表和列权限更改将在客户端的下一个请求中生效。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          数据库特权更改将在客户端下次执行</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">时生效</font><font style="vertical-align: inherit;">。
</font></font><code class="literal">USE
          <em class="replaceable"><code>db_name</code></em></code><font style="vertical-align: inherit;"></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            客户端应用程序可能缓存数据库名称 </font><font style="vertical-align: inherit;">因此，如果不实际更改为不同的数据库，这种影响可能对他们不可见。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          全局权限和密码不受连接客户端的影响。</font><font style="vertical-align: inherit;">这些更改仅对后续连接生效。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果服务器使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动
       </font><font style="vertical-align: inherit;">，则不会读取授权表或实施任何访问控制。</font><font style="vertical-align: inherit;">任何人都可以连接并做任何事情，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是不安全的。</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使服务器开始读取表并启用访问检查，请刷新权限。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="problems-connecting"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.7排除连接到MySQL的问题</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118638640"></a><a class="indexterm" name="idm140528118637600"></a><a class="indexterm" name="idm140528118636112"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果在尝试连接到MySQL服务器时遇到问题，下列各项描述了一些您可以采取的纠正问题的措施。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          确保服务器正在运行。</font><font style="vertical-align: inherit;">如果不是，客户端无法连接到它。</font><font style="vertical-align: inherit;">例如，如果尝试连接到服务器失败，并显示如下消息之一，则可能是服务器未运行：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误2003：无法连接到' </font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font><font style="vertical-align: inherit;">上的MySQL服务器</font><font style="vertical-align: inherit;">（111）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
外壳&gt; </font></font><strong class="userinput"><code>mysql</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误2002：无法通过套接字连接到本地MySQL服务器</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'/tmp/mysql.sock'（111）</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可能是服务器正在运行，但是您尝试使用与服务器正在侦听的端口不同的TCP / IP端口，命名管道或Unix套接字文件进行连接。</font><font style="vertical-align: inherit;">要在调用客户端程序时纠正此问题，请指定一个
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_port"><code class="option">--port</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来指示正确的端口号，或
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_socket"><code class="option">--socket</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定正确的命名管道或Unix套接字文件的选项。</font><font style="vertical-align: inherit;">要找出套接字文件的位置，可以使用以下命令：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>netstat -ln | grep mysql</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          确保服务器尚未配置为忽略网络连接或（如果您尝试远程连接）尚未将其配置为仅在本地网络接口上侦听。</font><font style="vertical-align: inherit;">如果服务器启动</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将根本不接受TCP / IP连接。</font><font style="vertical-align: inherit;">如果服务器已启动
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_bind-address"><code class="option">--bind-address=127.0.0.1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将只在本地环回接口上侦听TCP / IP连接，并且不会接受远程连接。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          检查以确保没有防火墙阻止访问MySQL。</font><font style="vertical-align: inherit;">您的防火墙可以根据正在执行的应用程序或MySQL用于通信的端口号（默认为3306）进行配置。</font><font style="vertical-align: inherit;">在Linux或Unix下，检查您的IP表（或类似的）配置，以确保端口未被阻塞。</font><font style="vertical-align: inherit;">在Windows下，可能需要将ZoneAlarm或Windows防火墙等应用程序配置为不阻止MySQL端口。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          授予表必须正确设置，以便服务器可以将它们用于访问控制。</font><font style="vertical-align: inherit;">对于某些分发类型（例如Windows上的二进制分发版或Linux上的RPM分发版），安装过程会初始化MySQL数据目录，包括</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含授权表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">数据库。</font><font style="vertical-align: inherit;">对于不这样做的发行版，您必须手动初始化数据目录。</font><font style="vertical-align: inherit;">有关详细信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#postinstallation" title="2.10安装后设置和测试"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10节“安装后的安装和测试”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要确定是否需要初始化授权表，请</font></font><code class="filename">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据目录下</font><font style="vertical-align: inherit;">查找一个</font><font style="vertical-align: inherit;">目录。</font><font style="vertical-align: inherit;">（数据目录通常被命名为
           </font></font><code class="filename">data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="filename">var</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并位于MySQL安装目录下。）确保</font></font><code class="filename">user.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="filename">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库目录中</font><font style="vertical-align: inherit;">有一个名为文件的文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果不是，则
           </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#data-directory-initialization" title="2.10.1初始化数据目录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化数据目录</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这样做并启动服务器后，您应该能够连接到服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          全新安装之后，如果尝试以</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未使用密码</font><font style="vertical-align: inherit;">登录服务器</font><font style="vertical-align: inherit;">，则可能会收到以下错误消息。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -u root </code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1045（28000）：访问拒绝用户'root'@'localhost'（使用密码：否）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这意味着在安装过程中已经分配了一个root密码，并且必须提供该密码。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#default-privileges" title="2.10.4确保初始MySQL帐户的安全"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10.4节“保护初始MySQL帐户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，了解密码分配的不同方式，以及在某些情况下如何找到密码。</font><font style="vertical-align: inherit;">如果您需要重置根密码，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#resetting-permissions" title="B.5.3.2如何重置根密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.3.2节“如何重置根密码”中的说明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">找到或重置密码后，请</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_password"><code class="option">--password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_password"><code class="option">-p</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）选项</font><font style="vertical-align: inherit;">重新登录
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -u root -p </code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码： </font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          但是，</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您已使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld --initialize-insecure</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化MySQL </font><font style="vertical-align: inherit;">，服务器将允许您在</font><font style="vertical-align: inherit;">不使用密码的情况下进行</font><font style="vertical-align: inherit;">连接
           </font><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">有关详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#data-directory-initialization-mysqld" title="2.10.1.1使用mysqld手动初始化数据目录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/installing.html#data-directory-initialization-mysqld" title="2.10.1.1使用mysqld手动初始化数据目录"><font style="vertical-align: inherit;">第2.10.1.1节“使用mysqld手动初始化数据目录”</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这是一种安全风险，所以您应该为该</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">设置密码</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">有关说明，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#default-privileges" title="2.10.4确保初始MySQL帐户的安全"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10.4节“确保初始MySQL帐户的安全”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140528118597168"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

          如果您已经将现有的MySQL安装更新到更新的版本，您是否运行了</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          脚本？</font><font style="vertical-align: inherit;">如果没有，那就这样做。</font><font style="vertical-align: inherit;">添加新功能时，授权表的结构偶尔会发生更改，因此升级后应始终确保您的表具有当前结构。</font><font style="vertical-align: inherit;">有关说明，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.4.7节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 检查并升级MySQL表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果客户端程序在尝试连接时收到以下错误消息，则表示服务器期望密码的格式比客户端能够生成的更新：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
客户端不支持请求的身份验证协议</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过服务器; </font><font style="vertical-align: inherit;">考虑升级MySQL客户端</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关如何处理此问题的信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#account-upgrades" title="6.5.1.3从4.1之前的密码散列和mysql_old_password插件迁移"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.3节“从4.1之前的密码散列和mysql_old_password插件迁移”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140528118589152"></a>

          <a class="indexterm" name="idm140528118588080"></a>

          <a class="indexterm" name="idm140528118587008"></a>

          <a class="indexterm" name="idm140528118585936"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

          请记住，客户端程序使用选项文件或环境变量中指定的连接参数。</font><font style="vertical-align: inherit;">如果客户端程序在命令行上未指定它们时似乎发送了错误的默认连接参数，请检查任何适用的选项文件和您的环境。</font><font style="vertical-align: inherit;">例如，如果您</font></font><code class="literal">Access
          denied</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行客户端时没有任何选项，请确保您没有在任何选项文件中指定旧密码！
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过使用该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_no-defaults"><code class="option">--no-defaults</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">调用客户端程序，可以禁止使用选项文件
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin --no-defaults -u root version</code></strong>
</pre><p><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.6节“使用选项文件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          列出了客户端
           </font><a class="xref" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;">使用的选项文件</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">环境变量在</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#environment-variables" title="4.9 MySQL程序环境变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.9节“MySQL程序环境变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中列出</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果出现以下错误，则表示您使用的</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font><font style="vertical-align: inherit;">不正确</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> ver</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用户'root'@'localhost'拒绝访问（使用密码：YES）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果即使没有指定密码也会出现上述错误，这意味着您在某些选项文件中列出了不正确的密码。</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_no-defaults"><code class="option">--no-defaults</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照上一项中所述</font><font style="vertical-align: inherit;">尝试
           </font><font style="vertical-align: inherit;">选项。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关更改密码的信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#assigning-passwords" title="6.3.6分配帐户密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.6节“分配帐户密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您丢失或忘记了</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          密码，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#resetting-permissions" title="B.5.3.2如何重置根密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.3.2节“如何重置根密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 是本地主机名的同义词，也是客户端尝试连接的默认主机，如果不明确指定主机。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以使用一个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_host"><code class="option">--host=127.0.0.1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项来显式地命名服务器主机。</font><font style="vertical-align: inherit;">这将建立到本地</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          服务器</font><font style="vertical-align: inherit;">的TCP / IP连接</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您还可以通过指定</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_host"><code class="option">--host</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用本地主机的实际主机名的选项来</font><font style="vertical-align: inherit;">使用TCP / IP
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使您在服务器所在的主机上运行客户端程序，也</font><font style="vertical-align: inherit;">必须</font><font style="vertical-align: inherit;">在服务器主机</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表格行中</font><font style="vertical-align: inherit;">指定主机名</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">Access denied</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息告诉您尝试登录的用户，您尝试连接的客户端主机以及您是否使用密码。</font><font style="vertical-align: inherit;">通常，</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">应该有一行
           </font><font style="vertical-align: inherit;">与错误消息中给出的主机名和用户名完全匹配。</font><font style="vertical-align: inherit;">例如，如果您收到包含的错误消息
           </font></font><code class="literal">using password: NO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则意味着您尝试登录时没有密码。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">Access denied</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在尝试连接数据库时</font><font style="vertical-align: inherit;">遇到</font><font style="vertical-align: inherit;">错误</font><font style="vertical-align: inherit;">，则</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">可能有问题</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过执行</font><font style="vertical-align: inherit;">并发出此SQL语句</font><font style="vertical-align: inherit;">来检查此问题</font><font style="vertical-align: inherit;">：
        </font></font><code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">user</code><font style="vertical-align: inherit;"></font><code class="literal">mysql -u root mysql</code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM用户;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          结果应该包含一个有一排
           </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配您的客户端的主机名和你的MySQL用户名的列。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果在尝试从除运行MySQL服务器的主机之外的主机进行连接时发生以下错误，则表示</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表中</font><font style="vertical-align: inherit;">没有</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与客户端主机匹配的值的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机...不允许连接到这个MySQL服务器
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以通过为尝试连接时使用的客户端主机名和用户名组合设置帐户来解决此问题。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您不知道要连接的计算机的IP地址或主机名称，则应</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">表格中</font><font style="vertical-align: inherit;">填入一行
           </font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">尝试从客户端计算机进行连接后，使用</font></font><code class="literal">SELECT
          USER()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询来查看您是如何真正连接的。</font><font style="vertical-align: inherit;">然后</font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将
           </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格行中的内容</font><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">为日志中显示的实际主机名称。</font><font style="vertical-align: inherit;">否则，您的系统将处于不安全状态，因为它允许来自任何主机的给定用户名的连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Linux上，可能发生此错误的另一个原因是您正在使用的二进制MySQL版本是使用与</font></font><code class="literal">glibc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您正在使用</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">不同版本的</font><font style="vertical-align: inherit;">库进行</font><font style="vertical-align: inherit;">编译的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，您应该升级您的操作系统</font></font><code class="literal">glibc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者下载MySQL版本的源代码分发并</font><font style="vertical-align: inherit;">自行</font><font style="vertical-align: inherit;">编译。</font><font style="vertical-align: inherit;">源RPM通常很容易编译和安装，所以这不是一个大问题。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您在尝试连接时指定主机名，但在主机名未显示或IP地址时收到错误消息，则表示MySQL服务器在尝试将客户端主机的IP地址解析为一个名字：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> -h <em class="replaceable"><code>some_hostname</code></em> ver</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
访问被拒绝用户'root'@''（使用密码：YES）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果尝试连接</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并获取以下错误，则表示您的</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">没有具有
           </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          列值的行，</font></font><code class="literal">'root'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且该
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法解析客户端的主机名：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问拒绝用户''@'未知'
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些错误表明DNS问题。</font><font style="vertical-align: inherit;">要修复它，请执行
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-hosts</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以重置内部DNS主机缓存。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#host-cache" title="8.12.5.2 DNS查找优化和主机缓存"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.12.5.2节“DNS查找优化和主机缓存”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一些永久解决方案是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              确定你的DNS服务器出了什么问题并修复它。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在MySQL授权表中指定IP地址而不是主机名。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="filename">/etc/hosts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Unix或</font></font><code class="filename">\windows\hosts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows </font><font style="vertical-align: inherit;">上
               </font><font style="vertical-align: inherit;">
              输入客户机名称的条目
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用
               </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">
              启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用
               </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">
              启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-host-cache"><code class="option">--skip-host-cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在Unix上，如果您在同一台计算机上运行服务器和客户端，请连接到</font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于连接</font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MySQL程序尝试通过使用Unix套接字文件连接到本地服务器，除非指定了连接参数以确保客户端进行TCP / IP连接。</font><font style="vertical-align: inherit;">有关更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#connecting" title="4.2.2连接到MySQL服务器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.2节“连接到MySQL服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在Windows上，如果您在同一台计算机上运行服务器和客户端，并且服务器支持命名管道连接，请连接到主机名</font></font><code class="literal">.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （句点）。</font><font style="vertical-align: inherit;">连接</font></font><code class="literal">.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用命名管道而不是TCP / IP。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">mysql -u root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作但</font><font style="vertical-align: inherit;">
          导致</font><font style="vertical-align: inherit;">（其中
           </font><font style="vertical-align: inherit;">是本地主机的实际主机名），则</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">您的主机可能没有正确的名称</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这里的一个常见问题是</font><font style="vertical-align: inherit;">表格行</font><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">值
           </font><font style="vertical-align: inherit;">指定了非限定的主机名，但系统的名称解析例程返回完全限定的域名（反之亦然）。</font><font style="vertical-align: inherit;">举例来说，如果你有一排主机</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">表，但是你的DNS告诉MySQL你的主机名是</font><font style="vertical-align: inherit;">，行也不行。</font><font style="vertical-align: inherit;">尝试向</font><font style="vertical-align: inherit;">包含主机IP地址</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">添加一行
           </font><font style="vertical-align: inherit;">作为</font></font><code class="literal">mysql
          -h <em class="replaceable"><code>your_hostname</code></em> -u root</code><font style="vertical-align: inherit;"></font><code class="literal">Access denied</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>your_hostname</code></em><font style="vertical-align: inherit;"></font><code class="literal">user</code><font style="vertical-align: inherit;"></font><code class="literal">Host</code><font style="vertical-align: inherit;"></font><code class="literal">user</code><font style="vertical-align: inherit;"></font><code class="literal">'pluto'</code><font style="vertical-align: inherit;"></font><code class="literal">user</code><font style="vertical-align: inherit;"></font><code class="literal">'pluto.example.com'</code><font style="vertical-align: inherit;"></font><code class="literal">user</code><font style="vertical-align: inherit;"></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值。</font><font style="vertical-align: inherit;">（或者，您可以</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          包含通配符</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">向</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">添加一行
           </font><font style="vertical-align: inherit;">;例如，
           </font></font><code class="literal">'pluto.%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，以
           </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾的
           </font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
           </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推荐使用！）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font><font style="vertical-align: inherit;">工作但
           </font><font style="vertical-align: inherit;">没有，您尚未授予对指定数据库的指定用户的访问权限</font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em>
          <em class="replaceable"><code>some_db</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>some_db</code></em><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font><font style="vertical-align: inherit;">在服务器主机上执行时有效，但</font><font style="vertical-align: inherit;">在远程客户端主机上执行时不起作用</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">则尚未从远程主机启用对给定用户名的服务器访问权限。
        </font></font><code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">mysql -h
          <em class="replaceable"><code>host_name</code></em> -u
          <em class="replaceable"><code>user_name</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您无法弄清楚为什么会出现这种情况</font></font><code class="literal">Access
          denied</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请从</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表格中</font><font style="vertical-align: inherit;">删除</font><font style="vertical-align: inherit;">所有</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含通配符值的行（包含行</font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或</font></font><code class="literal">'_'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">一个非常常见的错误是插入一个带有</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font><font style="vertical-align: inherit;">的新行
           </font><font style="vertical-align: inherit;">，认为这使您可以指定
           </font><font style="vertical-align: inherit;">从同一台计算机进行连接。</font><font style="vertical-align: inherit;">这不起作用的原因是默认权限包含一个</font><font style="vertical-align: inherit;">= </font><font style="vertical-align: inherit;">和
           </font><font style="vertical-align: inherit;">= </font><font style="vertical-align: inherit;">的行
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因为该行的</font><font style="vertical-align: inherit;">值
           </font><font style="vertical-align: inherit;">比“更具体”
          </font></font><code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code><font style="vertical-align: inherit;"></font><code class="literal">localhost</code><font style="vertical-align: inherit;"></font><code class="literal">Host</code><font style="vertical-align: inherit;"></font><code class="literal">'localhost'</code><font style="vertical-align: inherit;"></font><code class="literal">User</code><font style="vertical-align: inherit;"></font><code class="literal">''</code><font style="vertical-align: inherit;"></font><code class="literal">Host</code><font style="vertical-align: inherit;"></font><code class="literal">'localhost'</code><font style="vertical-align: inherit;"></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从</font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font><font style="vertical-align: inherit;">连接时优先使用新行</font><font style="vertical-align: inherit;">！</font><font style="vertical-align: inherit;">正确的步骤是插入一个第二行与
           </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><code class="literal">'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font><font style="vertical-align: inherit;">，或删除的行
           </font><font style="vertical-align: inherit;">= </font><font style="vertical-align: inherit;">和
           </font><font style="vertical-align: inherit;">= </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">删除该行后，请记住发出</font><font style="vertical-align: inherit;">语句以重新加载授权表。</font><font style="vertical-align: inherit;">另请参见</font><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-access" title="6.2.4访问控制，阶段1：连接验证"><font style="vertical-align: inherit;">第6.2.4节“访问控制，第1阶段：连接验证”</font></a><font style="vertical-align: inherit;">。
        </font></font><code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code><font style="vertical-align: inherit;"></font><code class="literal">Host</code><font style="vertical-align: inherit;"></font><code class="literal">'localhost'</code><font style="vertical-align: inherit;"></font><code class="literal">User</code><font style="vertical-align: inherit;"></font><code class="literal">''</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-privileges"><code class="literal">FLUSH
          PRIVILEGES</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-access" title="6.2.4访问控制，阶段1：连接验证"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您能够连接到MySQL服务器，但</font></font><code class="literal">Access denied</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每当您发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO语法"><code class="literal">SELECT ... INTO
          OUTFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
          INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">时都会</font><font style="vertical-align: inherit;">收到
           </font><font style="vertical-align: inherit;">消息
           </font><font style="vertical-align: inherit;">，则</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">行
           </font><font style="vertical-align: inherit;">不具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">权限。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果直接更改授权表（例如，通过使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句），并且您的更改似乎被忽略，请记住您必须执行
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-privileges</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令以使服务器重新加载权限表。</font><font style="vertical-align: inherit;">否则，只有在下次重新启动服务器时，更改才会生效。</font><font style="vertical-align: inherit;">请记住，在</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">更改
           </font><font style="vertical-align: inherit;">密码
           </font><font style="vertical-align: inherit;">后，在刷新特权之前，您不需要指定新密码，因为服务器不知道您已更改密码了！
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您的权限在会话过程中似乎发生了变化，那么MySQL管理员可能会更改它们。</font><font style="vertical-align: inherit;">重新加载授权表会影响新的客户端连接，但它也会影响现有连接，如</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#privilege-changes" title="6.2.6特权更改生效时"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.6节“特权更改生效时”所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您遇到Perl，PHP，Python或ODBC程序的访问问题，请尝试使用</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">连接到服务器</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果你能够使用</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;">mysql</font></strong></span></a><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">进行连接</font><font style="vertical-align: inherit;">，问题在于你的程序，而不是访问权限。</font><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">密码</font><font style="vertical-align: inherit;">之间没有空格</font><font style="vertical-align: inherit;">，也可以使用
           </font><font style="vertical-align: inherit;">
          语法来指定密码，如果使用
           </font><font style="vertical-align: inherit;">or
           </font><font style="vertical-align: inherit;">选项而没有密码值，MySQL会提示您输入密码。）
        </font></font><code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em>
          <em class="replaceable"><code>db_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">mysql
          -u <em class="replaceable"><code>user_name</code></em>
          -p<em class="replaceable"><code>your_pass</code></em>
          <em class="replaceable"><code>db_name</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><code class="option">-p</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_password"><code class="option">--password=<em class="replaceable"><code>your_pass</code></em></code></a><font style="vertical-align: inherit;"></font><code class="option">-p</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_password"><code class="option">--password</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          出于测试目的，</font><font style="vertical-align: inherit;">
          使用该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，您可以更改MySQL授权表并使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-grants" title="13.7.5.21 SHOW GRANTS语法"><code class="literal">SHOW GRANTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来检查您的修改是否具有所需的效果。</font><font style="vertical-align: inherit;">当您对更改感到满意时，请执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-privileges</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来通知
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器重新加载权限。</font><font style="vertical-align: inherit;">这使您可以开始使用新授权表内容而无需停止并重新启动服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果一切都失败，请</font><font style="vertical-align: inherit;">
          使用调试选项</font><font style="vertical-align: inherit;">启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器（例如，
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_debug"><code class="option">--debug=d,general,query</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这将打印有关尝试连接的主机和用户信息，以及有关每个发出的命令的信息。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#dbug-package" title="28.5.3 DBUG包"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.5.3节“DBUG包”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您在MySQL授权表中存在任何其他问题，并且觉得必须将问题发布到邮件列表中，请始终提供MySQL授权表的转储。</font><font style="vertical-align: inherit;">您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">转储表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要提交错误报告，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/introduction.html#bug-reports" title="1.7如何报告错误或问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1.7节“如何报告错误或问题”中的说明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在某些情况下，你可能需要重新启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="user-account-management"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3 MySQL用户帐户管理</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#user-names"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.1用户名和密码</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#adding-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.2添加用户帐户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#removing-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.3删除用户帐户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#reserved-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.4保留用户帐户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#user-resources"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.5设置帐户资源限制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#assigning-passwords"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.6分配帐户密码</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#password-management"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.7密码管理</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#expired-password-handling"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.8密码过期和沙盒模式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.9可插入认证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#proxy-users"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.10代理用户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#account-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.11用户帐户锁定</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#account-activity-auditing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.12基于SQL的MySQL账户活动审计</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本节介绍如何为MySQL服务器的客户端设置帐户。</font><font style="vertical-align: inherit;">它讨论了以下主题：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL中使用的帐户名称和密码的含义以及如何与您的操作系统使用的名称和密码进行比较
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如何设置新帐户并删除现有帐户
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如何更改密码
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        安全使用密码准则
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    另请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#account-management-sql" title="13.7.1账户管理陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1节“帐户管理语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中描述了所有用户管理SQL语句的语法和用法。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="user-names"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.1用户名和密码</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528118417136"></a><a class="indexterm" name="idm140528118415680"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL将帐户存储在</font><font style="vertical-align: inherit;">系统数据库</font><font style="vertical-align: inherit;">的</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中
       </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">帐户是根据用户名称和用户可以连接到服务器的客户端主机或主机定义的。</font><font style="vertical-align: inherit;">有关</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">科目表示的信息</font><font style="vertical-align: inherit;">，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#grant-tables" title="6.2.2授予表格"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.2节“授予表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该帐户也可能有密码。</font><font style="vertical-align: inherit;">MySQL支持身份验证插件，因此有可能使用某种外部身份验证方法进行身份验证。</font><font style="vertical-align: inherit;">参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL和您的操作系统使用用户名和密码的方式有几点区别：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于身份验证的MySQL用户名与Windows或Unix使用的用户名（登录名）无关。</font><font style="vertical-align: inherit;">在Unix上，大多数MySQL客户端默认尝试使用当前的Unix用户名作为MySQL用户名登录，但这仅仅是为了方便。</font><font style="vertical-align: inherit;">默认值可以很容易地被覆盖，因为客户端程序允许用</font></font><code class="option">-u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
           </font><font style="vertical-align: inherit;">指定任何用户名</font></font><code class="option">--user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">这意味着任何人都可以尝试使用任何用户名连接到服务器，因此除非所有MySQL帐户都有密码，否则无法以任何方式保护数据库安全。</font><font style="vertical-align: inherit;">任何为没有密码的帐户指定用户名的人都可以成功连接到服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL用户名最长可达32个字符操作系统用户名可以具有不同的最大长度。</font><font style="vertical-align: inherit;">例如，Unix用户名通常限制为八个字符。
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL用户名长度的限制是在MySQL服务器和客户端硬编码的，试图通过修改</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">中表的定义来绕过它是
             </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行不通的</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除非通过</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.4.7节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 检查并升级MySQL表”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的过程，</font><font style="vertical-align: inherit;">
            否则绝不应</font><font style="vertical-align: inherit;">以任何方式</font><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">数据库
             </font><font style="vertical-align: inherit;">中表的结构
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">试图以任何其他方式重新定义MySQL的系统表会导致未定义（和不支持！）的行为。</font><font style="vertical-align: inherit;">服务器可以自由忽略由于此类修改而变得格式错误的行。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了验证使用MySQL本地认证（由</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认证插件实现）的</font><font style="vertical-align: inherit;">帐户的客户端连接
           </font><font style="vertical-align: inherit;">，服务器使用存储在</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">密码
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些密码与用于登录到操作系统的密码不同。</font><font style="vertical-align: inherit;">
          用于登录Windows或Unix机器</font><font style="vertical-align: inherit;">的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码与用于访问该机器上MySQL服务器的密码</font><font style="vertical-align: inherit;">之间没有必要的连接</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果服务器使用其他插件对客户端进行身份验证，则插件实现的身份验证方法可能会或可能不会使用存储在</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表中</font><font style="vertical-align: inherit;">的密码</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，可能还会使用外部密码对MySQL服务器进行身份验证。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          存储在</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的密码使用特定</font><font style="vertical-align: inherit;">于</font><font style="vertical-align: inherit;">插件的算法进行加密。</font><font style="vertical-align: inherit;">有关MySQL本机密码散列的信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-hashing" title="6.1.2.4 MySQL中的密码散列"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.4节“MySQL中的密码散列”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果用户名和密码只包含ASCII字符，则无论字符集设置如何，都可以连接到服务器。</font><font style="vertical-align: inherit;">要在用户名或密码包含非ASCII字符时进行连接，客户端应</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-options" title="27.8.7.50 mysql_options（）"><code class="literal">mysql_options()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="literal">MYSQL_SET_CHARSET_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项和适当的字符集名称作为参数</font><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">C API函数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这会导致使用指定的字符集进行身份验证。</font><font style="vertical-align: inherit;">否则，认证将失败，除非服务器默认字符集与认证默认值中的编码相同。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          标准的MySQL客户端程序支持一个
           </font></font><code class="option">--default-character-set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，导致
           </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-options" title="27.8.7.50 mysql_options（）"><code class="literal">mysql_options()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如刚才描述的那样被调用。</font><font style="vertical-align: inherit;">此外，支持字符集自动检测，如
           </font></font><a class="xref" href="/mysql-5.7-google-zh/charset.html#charset-connection" title="10.4连接字符集和排序规则"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第10.4节“连接字符集和归类”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于使用不基于C API的连接器的程序，连接器可能会提供与</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-options" title="27.8.7.50 mysql_options（）"><code class="literal">mysql_options()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用</font><font style="vertical-align: inherit;">的连接器相同的
           </font><font style="vertical-align: inherit;">替代。</font><font style="vertical-align: inherit;">检查连接器文档。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          前面的注释不适用于</font></font><code class="literal">ucs2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">utf16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">utf32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，不允许用作客户端字符集。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL安装过程使用初始</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">填充授权表</font><font style="vertical-align: inherit;">，如</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#default-privileges" title="2.10.4确保初始MySQL帐户的安全"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10.4节“确保初始MySQL帐户的安全”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，该
       </font><a class="xref" href="/mysql-5.7-google-zh/installing.html#default-privileges" title="2.10.4确保初始MySQL帐户的安全"><font style="vertical-align: inherit;">章节</font></a><font style="vertical-align: inherit;">还讨论了如何为其分配密码。</font><font style="vertical-align: inherit;">此后，你通常建立，修改和删除MySQL账户使用语句，例如
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-user" title="13.7.1.3 DROP USER语法"><code class="literal">DROP USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#account-management-sql" title="13.7.1账户管理陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1节“帐户管理语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要使用命令行客户端连接到MySQL服务器，请根据需要为要使用的帐户指定用户名和密码选项：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql --user=finley --password <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您更喜欢短期选项，该命令如下所示：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -u finley -p <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您</font><font style="vertical-align: inherit;">
      在命令行中</font><font style="vertical-align: inherit;">按</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_password"><code class="option">--password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="option">-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">忽略密码值</font><font style="vertical-align: inherit;">（如刚才所示），客户端会提示</font><font style="vertical-align: inherit;">输入密码值
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，可以在命令行中指定密码：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>mysql --user=finley --password=<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>mysql -u finley -p<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您使用该</font></font><code class="option">-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，则必须
       </font><font style="vertical-align: inherit;">与以下密码值</font><font style="vertical-align: inherit;">之间</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有空格</font></font></em></span><font style="vertical-align: inherit;"></font><code class="option">-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在命令行中指定密码应被视为不安全。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-security-user" title="6.1.2.1密码安全的最终用户指南"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.1节“密码安全的最终用户指南”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以使用选项文件或登录路径文件来避免在命令行上输入密码。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.6节“使用选项文件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysql-config-editor" title="4.6.6 mysql_config_editor  -  MySQL配置实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.6节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_config_editor</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  MySQL配置实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关指定用户名，密码和其他连接参数的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#connecting" title="4.2.2连接到MySQL服务器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.2节“连接到MySQL服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="adding-users"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.2添加用户帐户</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118358240"></a><a class="indexterm" name="idm140528118357168"></a><a class="indexterm" name="idm140528118355680"></a><a class="indexterm" name="idm140528118354192"></a><a class="indexterm" name="idm140528118352704"></a><a class="indexterm" name="idm140528118351216"></a><a class="indexterm" name="idm140528118349728"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以通过两种方式创建MySQL帐户：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过使用旨在创建帐户并建立其权限的帐户管理语句（如
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和）
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些语句会导致服务器对基础授权表进行适当的修改。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过直接操作MySQL授权表</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，，或
           </font><font style="vertical-align: inherit;">等语句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      首选的方法是使用帐户管理语句，因为它们比直接操作授权表更简洁，更不容易出错。</font><font style="vertical-align: inherit;">所有这些陈述在</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#account-management-sql" title="13.7.1账户管理陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1节“账户管理陈述”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都有描述</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不鼓励直接批准表格修改，这里不作介绍。</font><font style="vertical-align: inherit;">服务器可以自由忽略由于此类修改而变得格式错误的行。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      创建账户的另一个选择是使用GUI工具MySQL Workbench。</font><font style="vertical-align: inherit;">此外，还有几个第三方程序提供了MySQL帐户管理功能。</font></font><code class="literal">phpMyAdmin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就是这样一个程序。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下示例显示如何使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端程序设置新帐户。</font><font style="vertical-align: inherit;">这些示例假定根据</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#default-privileges" title="2.10.4确保初始MySQL帐户的安全"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10.4节“确保初始MySQL帐户的安全”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的默认值设置了权限</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着要进行更改，您必须以</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-user"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限</font><font style="vertical-align: inherit;">的MySQL </font><font style="vertical-align: inherit;">用户
       </font><font style="vertical-align: inherit;">身份连接到MySQL服务器</font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      首先，使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序以MySQL </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">身份连接到服务器</font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql --user=root mysql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您为</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      帐户</font><font style="vertical-align: inherit;">分配了密码</font><font style="vertical-align: inherit;">，则还必须提供一个</font></font><code class="option">--password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font><font style="vertical-align: inherit;">一个</font></font><code class="option">-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      连接到服务器后</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以添加新帐户。</font><font style="vertical-align: inherit;">以下示例使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER </code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来设置四个帐户：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>CREATE USER 'finley'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>GRANT ALL PRIVILEGES ON *.* TO 'finley'@'localhost'</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>    WITH GRANT OPTION;</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>CREATE USER 'finley'@'%' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>GRANT ALL PRIVILEGES ON *.* TO 'finley'@'%'</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>    WITH GRANT OPTION;</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>CREATE USER 'admin'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>GRANT RELOAD,PROCESS ON *.* TO 'admin'@'localhost';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>CREATE USER 'dummy'@'localhost';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这些语句创建的帐户具有以下属性：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          两个帐户的用户名为</font></font><code class="literal">finley</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">两者都是拥有完全权限的超级用户帐户。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">'finley'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户只能在从本地主机连接时使用。</font><font style="vertical-align: inherit;">该
           </font></font><code class="literal">'finley'@'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户使用
           </font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通配符作为主机部分，因此可用于从任何主机进行连接。
        </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">'finley'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果有匿名用户帐户，则</font><font style="vertical-align: inherit;">
          该</font><font style="vertical-align: inherit;">帐户是必需的
           </font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果没有该
           </font></font><code class="literal">'finley'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户，</font></font><code class="literal">finley</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则从本地主机连接
           </font></font><code class="literal">finley</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并被视为匿名用户</font><font style="vertical-align: inherit;">时，该匿名用户帐户优先
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是因为匿名用户帐户具有</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比</font></font><code class="literal">'finley'@'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">更具体的</font><font style="vertical-align: inherit;">列值
           </font><font style="vertical-align: inherit;">，因此在</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表排序顺序中</font><font style="vertical-align: inherit;">更早</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格分类将在
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-access" title="6.2.4访问控制，阶段1：连接验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.4节“访问控制，第1阶段：连接验证”中讨论</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">'admin'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户只能用于</font></font><code class="literal">admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从本地主机进行连接。</font><font style="vertical-align: inherit;">它被授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_reload"><code class="literal">RELOAD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_process"><code class="literal">PROCESS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理权限。</font><font style="vertical-align: inherit;">这些特权使
           </font></font><code class="literal">admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户能够执行
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin重载</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin刷新</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush</font></font><em class="replaceable"><code>xxx</code></em></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，以及</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin processlist</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">没有权限访问任何数据库。</font><font style="vertical-align: inherit;">您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句</font><font style="vertical-align: inherit;">添加这些权限</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">'dummy'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户没有密码（这是不安全的，不推荐）。</font><font style="vertical-align: inherit;">该帐户只能用于从本地主机进行连接。</font><font style="vertical-align: inherit;">没有授予特权。</font><font style="vertical-align: inherit;">假定您将使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">为帐户授予特定的权限
           </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要查看帐户的权限，请使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-grants" title="13.7.5.21 SHOW GRANTS语法"><code class="literal">SHOW GRANTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW GRANTS FOR 'admin'@'localhost';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">授予admin @ localhost |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">GRANT RELOAD，进程*。*到'admin'@'localhost'|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要查看帐户的非特权属性，请使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-user" title="13.7.5.12 SHOW CREATE USER语法"><code class="literal">SHOW CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW CREATE USER 'admin'@'localhost'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为admin @ localhost创建用户：CREATE USER'admin'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用'mysql_native_password'识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS'* 67ACDEBDAB923990001F0FFB017EB8ED41861105'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要求无密码入口默认帐户解锁</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      接下来的例子创建三个账户并授予他们访问特定数据库的权限。</font><font style="vertical-align: inherit;">他们每个人都有一个用户名
       </font></font><code class="literal">custom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和密码
       </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>CREATE USER 'custom'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>    ON bankaccount.*</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>    TO 'custom'@'localhost';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>CREATE USER 'custom'@'host47.example.com' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>    ON expenses.*</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>    TO 'custom'@'host47.example.com';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>CREATE USER 'custom'@'%.example.com' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>    ON customer.*</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>    TO 'custom'@'%.example.com';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这三个账户可以使用如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          第一个帐户可以访问
           </font></font><code class="literal">bankaccount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库，但只能从本地主机访问。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          第二个帐户可以访问</font></font><code class="literal">expenses</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          数据库，但只能从主机访问
           </font></font><code class="literal">host47.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          第三个帐户可以</font></font><code class="literal">customer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从</font></font><code class="literal">example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          域中的</font><font style="vertical-align: inherit;">任何主机</font><font style="vertical-align: inherit;">访问</font><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在帐户名称的主机部分</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">通配符，</font><font style="vertical-align: inherit;">此帐户可以访问域中的所有计算机</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="removing-users"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.3删除用户帐户</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118256320"></a><a class="indexterm" name="idm140528118254832"></a><a class="indexterm" name="idm140528118253344"></a><a class="indexterm" name="idm140528118251856"></a><a class="indexterm" name="idm140528118250368"></a><a class="indexterm" name="idm140528118248880"></a><a class="indexterm" name="idm140528118247392"></a><a class="indexterm" name="idm140528118245904"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要删除账户，请使用</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#drop-user" title="13.7.1.3 DROP USER语法"><font style="vertical-align: inherit;">第13.7.1.3节“DROP USER语法”中</font></a></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-user" title="13.7.1.3 DROP USER语法"><code class="literal">DROP
      USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
    </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#drop-user" title="13.7.1.3 DROP USER语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>DROP USER 'jeffrey'@'localhost';</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="reserved-users"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.4保留用户帐户</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118239248"></a><a class="indexterm" name="idm140528118238176"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL安装过程的一部分是数据目录初始化（参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#data-directory-initialization-mysqld" title="2.10.1.1使用mysqld手动初始化数据目录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.10.1.1节“使用mysqld手动初始化数据目录”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在数据目录初始化期间，MySQL创建应被视为保留的用户帐户：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">'root'@'localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用于管理目的。</font><font style="vertical-align: inherit;">此帐户拥有所有权限并可执行任何操作。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          严格地说，这个帐户名不会被保留，因为某些安装将该</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">重命名
           </font><font style="vertical-align: inherit;">为其他内容，以避免暴露具有众所周知名称的高度特权帐户。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">'mysql.sys'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：作为
           </font></font><code class="literal">DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对
           </font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html" title="第26章MySQL sys模式"><code class="literal">sys</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构对象。</font><font style="vertical-align: inherit;">使用
           </font></font><code class="literal">mysql.sys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户可避免DBA重命名或删除</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          帐户时</font><font style="vertical-align: inherit;">发生的问题</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此帐户已锁定，因此无法用于客户端连接。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">'mysql.session'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：由插件内部使用来访问服务器。</font><font style="vertical-align: inherit;">此帐户已锁定，因此无法用于客户端连接。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="user-resources"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.5设置帐户资源限制</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118224144"></a><a class="indexterm" name="idm140528118222688"></a><a class="indexterm" name="idm140528118221200"></a><a class="indexterm" name="idm140528118220128"></a><a class="indexterm" name="idm140528118219056"></a><a class="indexterm" name="idm140528118217968"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      限制客户端使用MySQL服务器资源的一种方法是将全局
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量设置为非零值。</font><font style="vertical-align: inherit;">这限制了任何给定帐户可以进行的同时连接的数量，但对连接后客户端可以执行的操作没有限制。</font><font style="vertical-align: inherit;">另外，设置
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能管理个人账户。</font><font style="vertical-align: inherit;">这两种类型的控制都是MySQL管理员感兴趣的。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了解决这些问题，MySQL允许个人账户使用这些服务器资源的限制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个帐户每小时可以发出的查询次数
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个帐户每小时可以发布的更新次数
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          帐户每小时可以连接到服务器的次数
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个帐户同时连接到服务器的数量
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      除非从查询缓存中提供结果，否则客户端可以发出的任何声明都会与查询限制相关。</font><font style="vertical-align: inherit;">只有修改数据库或表的语句会违反更新限制。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此上下文中</font><font style="vertical-align: inherit;">
      的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对应于</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的一行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，根据</font><font style="vertical-align: inherit;">
      适用于连接</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表格行中的</font><font style="vertical-align: inherit;">值</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">来评估</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接。</font><font style="vertical-align: inherit;">例如，一个帐户
       </font></font><code class="literal">'usera'@'%.example.com'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对应于一个行</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有表格</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      和</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值</font></font><code class="literal">usera</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">%.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以允许
       </font></font><code class="literal">usera</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从在任何主机连接
       </font></font><code class="literal">example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域。</font><font style="vertical-align: inherit;">在这种情况下，服务器将此行中的资源限制集中应用于</font><font style="vertical-align: inherit;">域中</font></font><code class="literal">usera</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何主机的
       </font><font style="vertical-align: inherit;">所有连接，</font></font><code class="literal">example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为所有此类连接都使用相同的帐户。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在MySQL 5.0之前</font><font style="vertical-align: inherit;">，会根据用户连接的实际主机评估</font><font style="vertical-align: inherit;">一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可以通过使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_old-style-user-limits"><code class="option">--old-style-user-limits</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器来选择这种较旧的记帐方法
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，如果</font></font><code class="literal">usera</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code class="literal">host1.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">host2.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font><font style="vertical-align: inherit;">同时连接</font><font style="vertical-align: inherit;">，则服务器将帐户资源限制分别应用于每个连接。</font><font style="vertical-align: inherit;">如果
       </font></font><code class="literal">usera</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次连接
       </font></font><code class="literal">host1.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则服务器将该连接的限制与来自该主机的现有连接一起应用。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要在帐户创建时为帐户建立资源限制，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      语句。</font><font style="vertical-align: inherit;">要修改现有帐户的限制，请使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">提供一个</font></font><code class="literal">WITH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将每个资源命名为受限</font><font style="vertical-align: inherit;">的
       </font><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">每个限制的默认值为零（无限制）。</font><font style="vertical-align: inherit;">例如，要创建一个可以访问</font></font><code class="literal">customer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">的新帐户
       </font><font style="vertical-align: inherit;">，但只能以有限的方式发布这些语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE USER 'francis'@'localhost' IDENTIFIED BY 'frank'</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>    WITH MAX_QUERIES_PER_HOUR 20</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>         MAX_UPDATES_PER_HOUR 10</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>         MAX_CONNECTIONS_PER_HOUR 5</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>         MAX_USER_CONNECTIONS 2;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      限制类型不需要全部在该
       </font></font><code class="literal">WITH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中命名，但是可以以任何顺序存在。</font><font style="vertical-align: inherit;">每个每小时限制的值应该是代表每小时计数的整数。</font><font style="vertical-align: inherit;">因为
       </font></font><code class="literal">MAX_USER_CONNECTIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，限制是一个整数，代表帐户同时连接的最大数量。</font><font style="vertical-align: inherit;">如果此限制设置为零，则全局
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量值将确定同时连接的数量。</font><font style="vertical-align: inherit;">如果</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是零，则帐户没有限制。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要修改现有帐户的限制，请使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">以下语句将查询限制更改为</font></font><code class="literal">francis</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      100：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER USER 'francis'@'localhost' WITH MAX_QUERIES_PER_HOUR 100;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该声明仅修改指定的限制值，并使帐户保持不变。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要删除限制，请将其值设置为零。</font><font style="vertical-align: inherit;">例如，要删除每小时</font></font><code class="literal">francis</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可以连接</font><font style="vertical-align: inherit;">多少次的限制</font><font style="vertical-align: inherit;">，请使用以下语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER USER 'francis'@'localhost' WITH MAX_CONNECTIONS_PER_HOUR 0;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如前所述，账户的同时连接限额由
       </font></font><code class="literal">MAX_USER_CONNECTIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制和
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量确定。</font><font style="vertical-align: inherit;">假设全局
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为10，并且三个帐户具有如下指定的单独资源限制：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER USER'user1'@'localhost'WITH MAX_USER_CONNECTIONS 0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER USER'user2'@'localhost'WITH MAX_USER_CONNECTIONS 5;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER USER'user3'@'localhost'WITH MAX_USER_CONNECTIONS 20;</font></font><font></font>
</pre><p>
      <code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有10的连接限制（全局
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值），因为它具有</font></font><code class="literal">MAX_USER_CONNECTIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">零</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">限制。</font></font><code class="literal">user2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并分别</font></font><code class="literal">user3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有5和20的连接限制，因为它们具有非零</font></font><code class="literal">MAX_USER_CONNECTIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器存储与帐户</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对应</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表格行中的帐户的</font><font style="vertical-align: inherit;">资源限制
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">的</font></font><code class="literal">max_questions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">max_updates</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">max_connections</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列存储每小时限制和</font></font><code class="literal">max_user_connections</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列存储</font></font><code class="literal">MAX_USER_CONNECTIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制。</font><font style="vertical-align: inherit;">（请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#grant-tables" title="6.2.2授予表格"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.2节“授予表格”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      资源使用计数发生在任何帐户对其任何资源的使用都有非零限制的情况下。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在服务器运行时，它会计算每个帐户使用资源的次数。</font><font style="vertical-align: inherit;">如果某个帐户在最近一小时内达到其连接数限制，则该服务器会拒绝该帐户的其他连接，直到该小时数到达。</font><font style="vertical-align: inherit;">同样，如果帐户达到查询或更新数量的限制，服务器会拒绝进一步的查询或更新，直到小时结束。</font><font style="vertical-align: inherit;">在所有这些情况下，服务器都会发出适当的错误消息。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      资源统计发生在每个帐户，而不是每个客户。</font><font style="vertical-align: inherit;">例如，如果您的帐户具有50的查询限制，则无法将两个客户端连接同时连接到服务器，因此无法将限制增加到100。</font><font style="vertical-align: inherit;">在两个连接上发布的查询都一起计算。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当前每小时资源使用计数可以针对所有帐户全局重置，也可以针对给定帐户单独重置：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将所有帐户的当前计数重置为零，请发出
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-user-resources"><code class="literal">FLUSH USER_RESOURCES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。</font><font style="vertical-align: inherit;">计数还可以通过重新加载授权表来重置（例如，使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-privileges"><code class="literal">FLUSH
          PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin重新加载</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过再次设置任何限制，个人账户的计数可以重置为零。</font><font style="vertical-align: inherit;">指定一个等于当前分配给帐户的值的限制值。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每小时计数器重置不会影响
       </font></font><code class="literal">MAX_USER_CONNECTIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器启动时，所有计数都从零开始。</font><font style="vertical-align: inherit;">计数不通过服务器重新启动。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于此</font></font><code class="literal">MAX_USER_CONNECTIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制，如果帐户当前已打开允许的最大连接数，则可能会出现边缘情况：</font><font style="vertical-align: inherit;">如果服务器尚未完全处理断开连接，则</font><font style="vertical-align: inherit;">连接快速断开可能导致错误（</font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_too_many_user_connections"><code class="literal">ER_TOO_MANY_USER_CONNECTIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_user_limit_reached"><code class="literal">ER_USER_LIMIT_REACHED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）发生连接的时间。</font><font style="vertical-align: inherit;">当服务器完成断开连接处理时，将再次允许另一个连接。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="assigning-passwords"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.6分配帐户密码</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118137584"></a><a class="indexterm" name="idm140528118136544"></a><a class="indexterm" name="idm140528118135472"></a><a class="indexterm" name="idm140528118133984"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      连接到MySQL服务器的客户端所需的凭据可以包含密码。</font><font style="vertical-align: inherit;">本节介绍如何为MySQL帐户分配密码。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL将凭证存储在</font><font style="vertical-align: inherit;">系统数据库</font><font style="vertical-align: inherit;">的</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">分配或修改密码的操作只允许具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create-user"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限的</font><font style="vertical-align: inherit;">用户使用
       </font><font style="vertical-align: inherit;">，或者</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      数据库的</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限（创建新帐户的</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_update"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      权限，修改现有帐户的权限）。</font><font style="vertical-align: inherit;">如果
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量已启用，则使用帐户修改语句（例如
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另外需要该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权）。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      此处的讨论仅汇总了最常用的密码分配语句的语法。</font><font style="vertical-align: inherit;">有关其他可能性的完整细节，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.2节“CREATE USER语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.1节“ALTER USER语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.4节“GRANT语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.7节“SET PASSWORD语法“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL使用插件来执行客户端身份验证; </font><font style="vertical-align: inherit;">参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在密码分配语句中，与帐户关联的认证插件会执行指定的明文密码所需的任何散列。</font><font style="vertical-align: inherit;">这使MySQL能够在将密码存储在</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">之前对密码进行模糊处理</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于这里描述的语句，MySQL自动散列指定的密码。</font><font style="vertical-align: inherit;">还有一些语法</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE
      USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许字面值指定哈希值。</font><font style="vertical-align: inherit;">有关详细信息，请参阅这些语句的说明。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要在创建新帐户时分配密码，请使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并包含一个
       </font></font><code class="literal">IDENTIFIED BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'jeffrey'@'localhost'IDENTIFIED BY' </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p>
      <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还支持指定帐户身份验证插件的语法。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.2节“创建用户语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要为现有帐户分配或更改密码，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><code class="literal">IDENTIFIED BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">的
       </font><font style="vertical-align: inherit;">语句
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER USER'jeffrey'@'localhost'IDENTIFIED BY' </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您没有以匿名用户身份进行连接，则可以更改自己的密码，而不必直接命名自己的帐户：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER USER USER（）IDENTIFIED BY' </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要从命令行更改帐户密码，请使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin -u </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h </font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码“ </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      此命令设置密码的帐户是具有</font><font style="vertical-align: inherit;">在
       </font><font style="vertical-align: inherit;">列中</font><span class="emphasis"><em><font style="vertical-align: inherit;">连接</font></em></span><font style="vertical-align: inherit;">的</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格行
       </font><font style="vertical-align: inherit;">以及</font><span class="emphasis"><em><font style="vertical-align: inherit;">您</font></em></span><font style="vertical-align: inherit;">在该</font><font style="vertical-align: inherit;">
      列中</font><span class="emphasis"><em><font style="vertical-align: inherit;">连接</font></em></span><font style="vertical-align: inherit;">的客户端主机</font><font style="vertical-align: inherit;">的帐户</font><font style="vertical-align: inherit;">。
</font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"></font><code class="literal">User</code><font style="vertical-align: inherit;"></font><span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"></font><code class="literal">Host</code><font style="vertical-align: inherit;"></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置密码</font><font style="vertical-align: inherit;">应该被认为是</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全的</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在某些系统上，您的密码对系统状态程序（如</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps）</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可见，
         </font><font style="vertical-align: inherit;">可由其他用户调用以显示命令行。</font><font style="vertical-align: inherit;">MySQL客户端通常在其初始化序列中用零覆盖命令行密码参数。</font><font style="vertical-align: inherit;">但是，仍然有一个短暂的时间间隔，可以看到该值。</font><font style="vertical-align: inherit;">另外，在某些系统上，这种覆盖策略是无效的，密码对</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然可见</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（SystemV Unix系统和其他可能会遇到这个问题。）
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您正在使用MySQL复制，请注意，目前复制从属作为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的</font><font style="vertical-align: inherit;">一部分使用的密码
       </font><font style="vertical-align: inherit;">长度限制为32个字符; </font><font style="vertical-align: inherit;">如果密码较长，则多余的字符会被截断。</font><font style="vertical-align: inherit;">这不是由于MySQL服务器强加的任何限制，而是MySQL复制特有的问题。</font><font style="vertical-align: inherit;">（有关更多信息，请参阅错误＃43439。）
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="password-management"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.7密码管理</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL使数据库管理员能够手动过期帐户密码，并建立自动密码过期策略。</font><font style="vertical-align: inherit;">可以在全球范围内建立到期保单政策，也可以按照每个帐户进行。</font><font style="vertical-align: inherit;">这些功能适用于使用MySQL内置身份验证插件（</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于使用对外部凭证系统执行验证的插件的帐户，密码到期也必须在外部处理。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要手动过期帐户密码，请使用以下
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改用户'jeffrey'@'localhost'密码EXPIRE;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      此操作将在相应的</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格行中</font><font style="vertical-align: inherit;">标记过期的密码
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      根据策略的密码过期是自动的，并且基于密码的年龄，对于给定的帐户，密码的年龄根据其最近一次密码更改的日期和时间进行评估。</font><font style="vertical-align: inherit;">该
       </font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表为每个帐户指出密码的最后更改时间，并且如果服务器的年龄大于其允许的生命周期，则服务器会在客户端连接时自动将密码视为过期。</font><font style="vertical-align: inherit;">这适用于没有明确的手动密码到期。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要全局建立自动密码到期策略，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      系统变量。</font><font style="vertical-align: inherit;">其默认值为0，禁用自动密码过期。</font><font style="vertical-align: inherit;">如果值为
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正整数</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则表示允许的密码生存期，以便密码必须每天更改</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在5.7.11之前，默认
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是360（密码必须每年大约更改一次）。</font><font style="vertical-align: inherit;">对于此类版本，请注意，如果您未对</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        变量或个人用户帐户</font><font style="vertical-align: inherit;">进行更改
         </font><font style="vertical-align: inherit;">，则每个用户密码将在360天后过期，并且帐户开始以受限模式运行。</font><font style="vertical-align: inherit;">使用该帐户连接到服务器的客户端会收到错误消息，指出必须更改密码：</font></font><code class="literal">ERROR 1820 (HY000): You must reset your
        password using ALTER USER statement before executing this
        statement.</code>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，对于自动连接到服务器的客户端（如使用脚本建立的连接），很容易错过。</font><font style="vertical-align: inherit;">为避免由于密码过期而导致此类客户端突然停止工作，请确保为这些客户端更改密码到期设置，如下所示：

</font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER USER'script'@'localhost'密码永远不会出现
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

        或者，将该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        变量</font><font style="vertical-align: inherit;">设置
         </font><font style="vertical-align: inherit;">为</font></font><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从而禁用所有用户的自动密码到期。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      例子：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要建立全局策略，密码的使用期限大约为六个月，请在服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用以下行启动服务器</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
default_password_lifetime = 180</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要建立全局策略，以便密码永不过期，请将其设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为0：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
default_password_lifetime = 0</font></font><font></font>
</pre></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 也可以在运行时更改：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL default_password_lifetime = 180;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL default_password_lifetime = 0;</font></font><font></font>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要为个人账户建立密码到期政策，请使用</font><font style="vertical-align: inherit;">和
       </font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font></font><code class="literal">PASSWORD EXPIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;">第13.7.1.2节“CREATE USER语法”</font></a><font style="vertical-align: inherit;">和</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><font style="vertical-align: inherit;">第13.7.1.1节“ALTER USER语法”</font></a><font style="vertical-align: inherit;">。
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      账户特定的到期报表示例：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要求每90天更换密码：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户'jeffrey'@'localhost'密码EXPIRE INTERVAL 90天;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更改用户'jeffrey'@'localhost'密码EXPIRE INTERVAL 90天;</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          禁用密码过期：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户'jeffrey'@'localhost'密码永远不会出现;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
改变用户'jeffrey'@'localhost'密码永远不会出现;</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          遵循全球到期政策：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'jeffrey'@'localhost'PASSWORD EXPIRE DEFAULT;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER USER'jeffrey'@'localhost'密码EXPIRE DEFAULT;</font></font><font></font>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当客户端成功连接时，服务器将确定帐户密码是否已过期：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器检查密码是否已手动过期。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          否则，服务器根据自动密码过期策略检查密码年龄是否大于其允许的生存期。</font><font style="vertical-align: inherit;">如果是这样，服务器认为密码已过期。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果密码已过期（无论是手动还是自动），服务器要么断开客户端连接，要么限制允许的操作（请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#expired-password-handling" title="6.3.8密码过期和沙盒模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.8节“密码过期和沙箱模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">受限客户端执行的操作会导致错误，直到用户建立新的帐户密码为止：
    </font></font></p><a class="indexterm" name="idm140528118039264"></a><a class="indexterm" name="idm140528118038224"></a><a class="indexterm" name="idm140528118036736"></a><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT 1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1820（HY000）：您必须使用ALTER USER重置您的密码</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
语句执行此语句之前。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER USER USER() IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.01秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT 1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这种受限制的操作模式允许使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      语句，如果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用</font><font style="vertical-align: inherit;">MySQL 5.7.6之前的语句，而不是使用该语句，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且帐户密码的哈希格式需要
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为与默认值不同的值。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      客户端重置密码后，服务器将恢复会话的正常访问权限，并恢复使用该帐户的后续连接。</font><font style="vertical-align: inherit;">管理用户也可以重置帐户密码，但该帐户的任何现有受限制会话仍然受到限制。</font><font style="vertical-align: inherit;">在成功执行语句之前，使用该帐户的客户端必须断开连接并重新连接。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可以</font><font style="vertical-align: inherit;">通过将密码设置为当前值</font><font style="vertical-align: inherit;">来</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码。</font><font style="vertical-align: inherit;">作为一个良好的政策，最好选择一个不同的密码。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="expired-password-handling"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.8密码过期和沙盒模式</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528118022352"></a><a class="indexterm" name="idm140528118021280"></a><a class="indexterm" name="idm140528118019792"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL提供了密码到期功能，使数据库管理员可以要求用户重置密码。</font><font style="vertical-align: inherit;">密码可以手动过期，并根据自动到期的策略（见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-management" title="6.3.7密码管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.7节“密码管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于每个使用带有过期密码的帐户的连接，服务器要么断开客户端连接，要么将客户端限制为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沙盒模式</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该</font><span class="quote"><span class="quote"><font style="vertical-align: inherit;">模式下，</font></span></span><font style="vertical-align: inherit;">服务器只允许客户端重置过期密码所需的操作。</font><font style="vertical-align: inherit;">正如稍后讨论的，服务器采取的操作取决于客户端和服务器设置。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果服务器断开客户端，它将返回一个
       </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_must_change_password_login"><code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      错误：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql -u myuser -p</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
密码：</font></font><strong class="userinput"><code>******</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1862（HY000）：您的密码已过期。</font><font style="vertical-align: inherit;">要登录，您必须</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用支持过期密码的客户端更改它。</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果服务器将客户端限制为沙盒模式，则在客户端会话中允许执行以下操作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          客户可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font><font style="vertical-align: inherit;">重置账户密码
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">密码重置后，服务器恢复会话的正常访问权限，以及使用该帐户的后续连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以</font><font style="vertical-align: inherit;">通过将密码设置为当前值</font><font style="vertical-align: inherit;">来</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码。</font><font style="vertical-align: inherit;">作为一个良好的政策，最好选择一个不同的密码。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          客户端可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句，如果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用</font><font style="vertical-align: inherit;">MySQL 5.7.6之前的语句，而不是</font><font style="vertical-align: inherit;">使用
           </font><font style="vertical-align: inherit;">语句，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且帐户密码的哈希格式需要
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为与默认值不同的值。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于会话中不允许的任何操作，服务器返回一个</font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_must_change_password"><code class="literal">ER_MUST_CHANGE_PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      错误：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>USE performance_schema;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1820（HY000）：您必须使用ALTER USER重置您的密码</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
语句执行此语句之前。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT 1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1820（HY000）：您必须使用ALTER USER重置您的密码</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
语句执行此语句之前。</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这就是</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端的</font><font style="vertical-align: inherit;">交互式调用通常会发生的情况，
       </font><font style="vertical-align: inherit;">因为默认情况下，这些调用会放入沙箱模式。</font><font style="vertical-align: inherit;">要清除错误并恢复正常功能，请选择一个新密码。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
      客户端的</font><font style="vertical-align: inherit;">非交互式调用</font><font style="vertical-align: inherit;">（例如，在批处理模式下），如果密码过期，服务器通常会断开客户端连接。</font><font style="vertical-align: inherit;">要允许非交互式</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用保持连接，以便可以更改密码（使用刚描述的语句），请将该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_connect-expired-password"><code class="option">--connect-expired-password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">添加
       </font><font style="vertical-align: inherit;">到</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如前所述，服务器是否断开过期密码客户端或将其限制为沙箱模式取决于客户端和服务器设置的组合。</font><font style="vertical-align: inherit;">以下讨论描述了相关设置以及它们如何相互作用。</font><font style="vertical-align: inherit;">该讨论仅适用于具有过期密码的帐户。</font><font style="vertical-align: inherit;">如果客户端使用非激活密码进行连接，则服务器通常会处理客户端。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在客户端，给定的客户端指示它是否可以处理过期密码的沙箱模式。</font><font style="vertical-align: inherit;">对于使用C客户端库的客户端，有两种方法可以执行此操作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在连接之前</font><font style="vertical-align: inherit;">
          传递该
           </font></font><code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-options" title="27.8.7.50 mysql_options（）"><code class="literal">mysql_options()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="c" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arg = 1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果= mysql_options（mysql，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       ＆ARG）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果以交互方式调用或
           </font><font style="vertical-align: inherit;">
          给出选项</font><font style="vertical-align: inherit;">
          ，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端将启用
           </font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_connect-expired-password"><code class="option">--connect-expired-password</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在连接时间</font><font style="vertical-align: inherit;">
          通过
           </font></font><code class="literal">CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志
           </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-real-connect" title="27.8.7.54 mysql_real_connect（）"><code class="literal">mysql_real_connect()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="c" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql = mysql_real_connect（mysql，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           主机，用户，密码，数据库，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           端口，unix_socket，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS）;</font></font><font></font>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      其他MySQL连接器有自己的约定用于表示准备好处理沙盒模式。</font><font style="vertical-align: inherit;">请参阅您感兴趣的连接器的文档。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在服务器端，如果客户端指出它可以处理过期的密码，则服务器将其置于沙盒模式。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果客户端没有指出它可以处理过期的密码（或使用不能指示的客户端库的旧版本），则服务器操作取决于</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      系统变量</font><font style="vertical-align: inherit;">的值
       </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          启用（默认），服务器会断开连接并出现
           </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_must_change_password_login"><code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          错误。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          禁用，则服务器将客户端置于沙盒模式。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.9可插入认证</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当客户端连接到MySQL服务器时，服务器使用客户端和客户端主机提供的用户名从</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      系统表中</font><font style="vertical-align: inherit;">选择适当的帐户行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，服务器对客户端进行身份验证，从帐户行确定哪个身份验证插件适用于客户端：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果服务器找不到插件，则会发生错误并拒绝连接尝试。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          否则，服务器调用该插件来认证用户，插件向服务器返回一个状态，指示用户是否提供了正确的密码并被允许连接。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可插入的身份验证启用了以下重要功能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认证方法的选择。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可插入的身份验证使DBA可以轻松选择和更改用于各个MySQL帐户的身份验证方法。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部认证。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可插入的身份验证使客户端可以使用适用于在</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统表</font><font style="vertical-align: inherit;">中存储凭据的身份验证方法的凭据连接到MySQL服务器</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，可以创建插件以使用外部身份验证方法，例如PAM，Windows登录ID，LDAP或Kerberos。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户：&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            如果允许用户连接，认证插件可以向服务器返回与连接用户名称不同的用户名，以表明连接用户是另一个用户（代理用户）的代理。</font><font style="vertical-align: inherit;">当连接持续时，为了访问控制，代理用户被视为具有代理用户的特权。</font><font style="vertical-align: inherit;">实际上，一个用户冒充另一个用户。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器，则
         </font><font style="vertical-align: inherit;">即使加载身份验证插件也不会使用，因为服务器不执行客户端身份验证并允许任何客户端进行连接。</font><font style="vertical-align: inherit;">因为这是不安全的，所以您可能希望
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结合使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来防止远程客户端连接。
</font></font></p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication-available-plugins" title="可用的身份验证插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用的身份验证插件</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication-usage" title="身份验证插件用法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证插件用法</font></font></a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="pluggable-authentication-available-plugins"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用的身份验证插件</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL 5.7提供了这些认证插件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            执行本机认证的插件; </font><font style="vertical-align: inherit;">也就是说，基于在MySQL中引入可插入认证之前使用的密码散列方法的认证。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件基于本机密码散列方法实现认证。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            插件基于旧的（4.1之前的）密码散列方法实现本地认证（在MySQL 5.7.5中已被弃用和删除）。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#native-pluggable-authentication" title="6.5.1.1本地可插拔认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.1节“本机可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#old-native-pluggable-authentication" title="6.5.1.2旧本地可插拔认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.2节“旧本机可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用SHA-256密码散列执行验证的插件。</font><font style="vertical-align: inherit;">这是比本机认证可用的更强的加密。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#sha256-pluggable-authentication" title="6.5.1.4 SHA-256可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.4节“SHA-256可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个客户端插件，它将密码发送到服务器而不进行散列或加密。</font><font style="vertical-align: inherit;">该插件与服务器端插件一起使用，这些插件需要完全按照客户端用户提供的密码访问。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#cleartext-pluggable-authentication" title="6.5.1.5客户端明文可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.5节“客户端明文可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用PAM（可插入认证模块）执行外部认证的插件，使MySQL服务器能够使用PAM来认证MySQL用户。</font><font style="vertical-align: inherit;">这个插件也支持代理用户。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication" title="6.5.1.6 PAM可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.6节“PAM可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个在Windows上执行外部验证的插件，使MySQL服务器能够使用本机Windows服务来验证客户端连接。</font><font style="vertical-align: inherit;">登录到Windows的用户可以根据其环境中的信息从MySQL客户端程序连接到服务器，无需指定额外的密码。</font><font style="vertical-align: inherit;">这个插件也支持代理用户。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#windows-pluggable-authentication" title="6.5.1.7 Windows可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.7节“Windows可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用LDAP（轻量级目录访问协议）执行身份验证的插件，通过访问目录服务（如X.500）对MySQL用户进行身份验证。</font><font style="vertical-align: inherit;">这些插件也支持代理用户。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication" title="6.5.1.8 LDAP可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.8节“LDAP可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            阻止所有客户端连接到使用它的任何帐户的插件。</font><font style="vertical-align: inherit;">此插件的使用案例包括代理帐户，绝不允许直接登录，但只能通过代理帐户和必须能够使用提升的特权执行存储的程序和视图的帐户进行访问，而不向普通用户公开这些特权。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#no-login-pluggable-authentication" title="6.5.1.9无登录可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.9节“无登录可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            验证通过Unix套接字文件从本地主机连接的客户端的插件。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#socket-pluggable-authentication" title="6.5.1.10套接字对等凭证可插拔认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.10节“套接字对等凭证可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            测试插件，用于检查帐户凭证并将成功或失败记录到服务器错误日志中。</font><font style="vertical-align: inherit;">此插件旨在用于测试和开发目的，并作为如何编写身份验证插件的示例。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#test-pluggable-authentication" title="6.5.1.11测试可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.11节“测试可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关使用可插入身份验证的当前限制的信息，包括哪些连接器支持哪些插件，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/restrictions.html#pluggable-authentication-restrictions" title="C.9对可插入认证的限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第C.9节“对可插入身份验证的限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          第三方连接器开发人员应该阅读该部分，以确定连接器可以利用可插入身份验证功能的程度以及采取哪些步骤以变得更加合规。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您有兴趣编写自己的身份验证插件，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#writing-authentication-plugins" title="28.2.4.9编写认证插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.2.4.9节“编写身份验证插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证插件用法</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节提供有关安装和使用身份验证插件的一般说明。</font><font style="vertical-align: inherit;">有关特定插件的说明，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#authentication-plugins" title="6.5.1身份验证插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1节“身份验证插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中介绍该插件的
         </font><a class="xref" href="/mysql-5.7-google-zh/security.html#authentication-plugins" title="6.5.1 Authentication Plugins"><font style="vertical-align: inherit;">部分</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通常，可插入认证在服务器和客户端使用一对相应的插件，因此您使用如下所示的给定认证方法：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如有必要，请安装插件库或包含相应插件的库。</font><font style="vertical-align: inherit;">在服务器主机上，安装包含服务器端插件的库，以便服务器可以使用它来验证客户端连接。</font><font style="vertical-align: inherit;">同样，在每台客户端主机上，安装包含客户端插件的库供客户端程序使用。</font><font style="vertical-align: inherit;">无需安装内置的身份验证插件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于您创建的每个MySQL帐户，请指定相应的服务器端插件用于身份验证。</font><font style="vertical-align: inherit;">如果帐户要使用默认身份验证插件，则帐户创建语句不需要明确指定插件。</font><font style="vertical-align: inherit;">该
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_authentication_plugin"><code class="literal">default_authentication_plugin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量配置默认的身份验证插件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当客户端连接时，服务器端插件会告诉客户端程序使用哪个客户端插件进行身份验证。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在帐户使用服务器和客户端程序默认的身份验证方法的情况下，服务器无需与客户端通信使用哪个客户端插件，并且可以在客户端/服务器协商中进行往返避免。</font><font style="vertical-align: inherit;">对于使用本机MySQL身份验证的帐户，情况正确。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于标准的MySQL客户端，例如</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">
        可以在命令行上指定</font><font style="vertical-align: inherit;">该
         </font><font style="vertical-align: inherit;">选项作为关于该程序可以使用哪个客户端插件的提示，但如果服务器端插件与用户帐户需要不同的客户端插件。
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_default-auth"><code class="option">--default-auth=<em class="replaceable"><code>plugin_name</code></em></code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果客户端程序未找到客户端插件库文件，请指定一个
         </font><font style="vertical-align: inherit;">
        选项来指示插件库目录位置。
</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_plugin-dir"><code class="option">--plugin-dir=<em class="replaceable"><code>dir_name</code></em></code></a><font style="vertical-align: inherit;"></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="proxy-users"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.10代理用户</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117904928"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL服务器使用认证插件来认证客户端连接。</font><font style="vertical-align: inherit;">对特定连接进行身份验证的插件可能会要求将连接（外部）用户作为不同的用户进行特权检查。</font><font style="vertical-align: inherit;">这使得外部用户成为第二用户的代理; </font><font style="vertical-align: inherit;">也就是承担第二个用户的权限：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          外部用户是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（可以扮演或被称为另一个用户的用户）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          第二个用户是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（一个用户，其身份和权限可以由代理用户承担）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍代理用户功能的工作方式。</font><font style="vertical-align: inherit;">有关认证插件的一般信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关特定插件的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#authentication-plugins" title="6.5.1身份验证插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1节“身份验证插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关编写支持代理用户的认证插件的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#writing-authentication-plugins-proxy-users" title="28.2.4.9.4在认证插件中实现代理用户支持"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.2.4.9.4节“在认证插件中实现代理用户支持”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-support-requirements" title="代理用户支持的要求"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户支持的要求</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-granting-proxy-privilege" title="授予代理权限"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予代理权限</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#default-proxy-users" title="默认代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认代理用户</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-conflicts" title="默认代理用户和匿名用户冲突"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认代理用户和匿名用户冲突</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-server-user-mapping" title="服务器支持代理用户映射"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器支持代理用户映射</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-system-variables" title="代理用户系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户系统变量</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="proxy-users-support-requirements"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户支持的要求</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了对给定的认证插件进行代理，必须满足以下条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代理服务器必须支持代理服务器，或者由插件本身支持，或者由MySQL服务器代表插件支持代理服务器。</font><font style="vertical-align: inherit;">在后一种情况下，可能需要明确启用服务器支持; </font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-server-user-mapping" title="服务器支持代理用户映射"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器支持代理用户映射</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代理用户帐户必须设置为由插件进行认证。</font><font style="vertical-align: inherit;">使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE
            USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句将帐户与身份验证插件相关联，或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER
            USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改其插件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            必须创建代理用户帐户并授予代理用户将承担的特权。</font><font style="vertical-align: inherit;">为此</font><font style="vertical-align: inherit;">使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代理用户帐户必须具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理帐户</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">特权。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此</font><font style="vertical-align: inherit;">使用
             </font><font style="vertical-align: inherit;">声明。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于连接到代理帐户的客户端将被视为代理用户，身份验证插件必须返回与客户端用户名不同的用户名，以指示代理帐户的用户名，该用户名定义代理将承担的特权用户。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或者，对于由服务器提供代理映射的插件，代理用户</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由代理用户持有</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">特权</font><font style="vertical-align: inherit;">确定
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        代理机制只允许将客户端用户名映射到代理用户名。</font><font style="vertical-align: inherit;">没有规定映射主机名称。</font><font style="vertical-align: inherit;">当连接客户端与代理帐户匹配时，服务器将尝试使用身份验证插件返回的用户名和代理帐户的主机名来查找代理帐户的匹配项。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        考虑以下帐户定义：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 创建代理帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'employee_ext'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用my_auth_plugin AS'my_auth_string'识别;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 创建代理帐户并授予其权限</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'员工'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IDENTIFIED BY'employee_pass';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT ALL ON员工。*</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  TO'员工'@'localhost';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 授予PROXY特权代理帐户的代理帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予代理</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ON'employee'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  TO'employee_ext'@'localhost';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当客户端</font></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从本地主机</font><font style="vertical-align: inherit;">连接时</font><font style="vertical-align: inherit;">，MySQL使用指定的插件
         </font></font><code class="literal">my_auth_plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来执行认证。</font><font style="vertical-align: inherit;">假设</font><font style="vertical-align: inherit;">根据内容</font><font style="vertical-align: inherit;">和可能通过咨询某个外部认证系统</font></font><code class="literal">my_auth_plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">employee</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向服务器</font><font style="vertical-align: inherit;">返回用户名</font></font><code class="literal">'my_auth_string'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">名称
         </font></font><code class="literal">employee</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同于此
         </font></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以返回
         </font></font><code class="literal">employee</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为对服务器的请求</font></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以作为</font></font><code class="literal">employee</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地用户</font><font style="vertical-align: inherit;">来处理</font><font style="vertical-align: inherit;">客户端，以进行特权检查</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，</font></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户</font></font><code class="literal">employee</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是代理用户。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器</font><font style="vertical-align: inherit;">通过检查</font><font style="vertical-align: inherit;">（代理用户）是否具有</font><font style="vertical-align: inherit;">针对</font><font style="vertical-align: inherit;">（代理用户）</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">特权来
         </font><font style="vertical-align: inherit;">验证</font><font style="vertical-align: inherit;">用户是否
         </font></font><code class="literal">employee</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有可能进行
         </font><font style="vertical-align: inherit;">代理认证
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此特权尚未授予，则会发生错误。</font><font style="vertical-align: inherit;">否则，
         </font><font style="vertical-align: inherit;">承担特权
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">服务器通过</font><font style="vertical-align: inherit;">针对授予的权限来</font><font style="vertical-align: inherit;">检查在客户端会话期间执行的语句
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，
         </font><font style="vertical-align: inherit;">可以访问</font><font style="vertical-align: inherit;">数据库中的</font><font style="vertical-align: inherit;">表
         </font><font style="vertical-align: inherit;">。
      </font></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"></font><code class="literal">employee</code><font style="vertical-align: inherit;"></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"></font><code class="literal">employee</code><font style="vertical-align: inherit;"></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"></font><code class="literal">employee</code><font style="vertical-align: inherit;"></font><code class="literal">employee_ext</code><font style="vertical-align: inherit;"></font><code class="literal">employees</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        发生代理时，</font><font style="vertical-align: inherit;">可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        和</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数查看连接用户（代理用户）与在当前会话期间应用特权的帐户（代理用户）之间的区别。</font><font style="vertical-align: inherit;">对于刚才描述的例子，这些函数返回这些值：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ + -------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ + -------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">employee_ext @ localhost | </font><font style="vertical-align: inherit;">employee @ localhost |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ + -------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建代理用户帐户的</font></font><code class="literal">IDENTIFIED
        WITH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中，为认证插件命名</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句可选地后跟一个</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">子句指定服务器在用户连接时传递给插件的字符串。</font><font style="vertical-align: inherit;">如果存在，该字符串将提供帮助插件确定如何将外部客户端用户名映射到代理用户名的信息。</font><font style="vertical-align: inherit;">是否需要该</font><font style="vertical-align: inherit;">条款</font><font style="vertical-align: inherit;">取决于每个插件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果是这样，认证字符串的格式取决于插件打算如何使用它。</font><font style="vertical-align: inherit;">有关它接受的验证字符串值的信息，请查阅给定插件的文档。
</font></font><code class="literal">AS
        '<em class="replaceable"><code>auth_string</code></em>'</code><font style="vertical-align: inherit;"></font><code class="literal">AS</code><font style="vertical-align: inherit;"></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-granting-proxy-privilege"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予代理权限</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117840560"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        的</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要特权以使外部用户，以作为连接并具有另一个用户的权限。</font><font style="vertical-align: inherit;">要授予此特权，请使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予代理' </font></font><em class="replaceable"><code>proxied_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'到' </font></font><em class="replaceable"><code>proxy_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><a class="indexterm" name="idm140528117834240"></a><a class="indexterm" name="idm140528117832752"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该语句在</font></font><code class="literal">mysql.proxies_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授权表中</font><font style="vertical-align: inherit;">创建一行
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在连接时，</font></font><em class="replaceable"><code>proxy_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须代表一个有效的外部认证的MySQL用户，并且
         </font></font><em class="replaceable"><code>proxied_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须代表一个有效的本地认证用户。</font><font style="vertical-align: inherit;">否则，连接尝试失败。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        相应的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法是：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REVOKE PROXY ON''FROM </font></font><em class="replaceable"><code>proxied_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><em class="replaceable"><code>proxy_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法扩展像平常一样工作。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予代理'a'到'b'，'c'，'d';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予代理授权代理'a'至'd';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予代理'a'至'''';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'a'从'b'，'c'，'d'撤销代理</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权可以在这些情况下授予：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过具有用户</font></font><code class="literal">GRANT PROXY ... WITH GRANT
            OPTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
             </font></font><em class="replaceable"><code>proxied_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过</font></font><em class="replaceable"><code>proxied_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对自身：值</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须完全匹配</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><em class="replaceable"><code>proxied_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，同时为用户名和账户名的主机名部分。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL安装过程中创建</font><font style="vertical-align: inherit;">
        的初始</font><font style="vertical-align: inherit;">帐户拥有</font><font style="vertical-align: inherit;">所有用户和所有主机</font><font style="vertical-align: inherit;">的
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY ... WITH GRANT
        OPTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这使得
         </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够设置代理用户，并且能够委派给其他账户设置代理用户的权限。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以这样做：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'admin'@'localhost'IDENTIFIED BY'test';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予代理''@''到'admin'@'localhost'授予选项;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些语句创建一个</font></font><code class="literal">admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以管理所有</font></font><code class="literal">GRANT PROXY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以这样做：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予代理在萨莉上乔;
</font></font></pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="default-proxy-users"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认代理用户</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117802192"></a><a class="indexterm" name="idm140528117800704"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要指定某些或所有用户应使用给定的身份验证插件进行连接，请创建一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空白</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MySQL账户（</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），将其与该插件关联，并让该插件返回真实身份验证的用户名（如果与空白用户不同）。</font><font style="vertical-align: inherit;">例如，假设存在一个名为的插件</font></font><code class="literal">ldap_auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ，</font><font style="vertical-align: inherit;">该插件</font><font style="vertical-align: inherit;">实现LDAP身份验证并将连接用户映射到开发人员或经理帐户。</font><font style="vertical-align: inherit;">要设置用户对这些帐户的代理，请使用以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 创建默认代理帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'''''IDENTIFIED WITH ldap_auth AS'O = Oracle，OU = MySQL';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 创建代理帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'developer'@'localhost'IDENTIFIED BY'developer_pass';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'manager'@'localhost'IDENTIFIED BY'manager_pass';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 将PROXY权限授予代理帐户的默认代理帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予代理经理'@'localhost'到'''';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT PROXY ON'developer'@'localhost'TO'''';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        现在假设客户端连接如下：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql --user=myuser --password ...</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><em class="replaceable"><code>myuser_pass</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器不会被</font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义为MySQL用户。</font><font style="vertical-align: inherit;">但是，因为有一个空白的用户帐户（</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相匹配的客户端用户名和主机名），该服务器验证针对该帐户的客户端：服务器调用</font></font><code class="literal">ldap_auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        身份验证插件和传球</font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
         </font></font><code class="literal">myuser_pass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">把它作为用户名和密码。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果</font></font><code class="literal">ldap_auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件在LDAP目录中找到的</font></font><code class="literal">myuser_pass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码不正确</font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则认证失败并且服务器拒绝连接。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果密码正确并且</font></font><code class="literal">ldap_auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        发现它</font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是开发人员，则它将用户名返回</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给MySQL服务器，而不是</font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将不同于</font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        信号</font><font style="vertical-align: inherit;">的客户端用户名的用户名返回给</font><font style="vertical-align: inherit;">应
         </font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视为代理的服务器。</font><font style="vertical-align: inherit;">服务器验证
         </font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以进行身份​​验证
         </font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（因为该帐户
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有权这样做）并接受连接。</font><font style="vertical-align: inherit;">会话继续
         </font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户</font><font style="vertical-align: inherit;">的特权
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这些权限应由DBA使用
         </font></font><code class="literal">GRANT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句设置，未显示。）
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
        </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 函数返回这些值：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">myuser @ localhost | </font><font style="vertical-align: inherit;">developer @ localhost |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + --------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果该插件在LDAP目录中找到的
         </font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是管理器，则它将</font></font><code class="literal">manager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以用户名的形式</font><font style="vertical-align: inherit;">返回
         </font><font style="vertical-align: inherit;">并且会话继续</font></font><code class="literal">myuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有特权
         </font></font><code class="literal">manager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">myuser @ localhost | </font><font style="vertical-align: inherit;">manager @ localhost |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了简单起见，外部认证不能是多层次的：</font><font style="vertical-align: inherit;">在前面的例子中，</font><font style="vertical-align: inherit;">既没有考虑这些认证，</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也没有</font></font><code class="literal">manager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑</font><font style="vertical-align: inherit;">这些</font><font style="vertical-align: inherit;">认证</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，如果一个客户端试图连接，并直接为验证他们仍然使用
         </font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">manager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        帐户，这就是为什么这些账户应当分配的密码。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-conflicts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认代理用户和匿名用户冲突</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117761312"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您打算创建默认代理用户，请检查</font><font style="vertical-align: inherit;">优先于默认代理用户的</font><font style="vertical-align: inherit;">其他现有</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配任何用户</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户，因为他们可能会阻止该用户按预期工作。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在前面的讨论中，默认的代理用户帐户
         </font></font><code class="literal">''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主机部分中，它与任何主机都匹配。</font><font style="vertical-align: inherit;">如果您设置了默认代理用户，请注意同时检查非代理帐户是否存在于同一用户部分和
         </font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机部分中，因为它们
         </font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也与任何主机匹配，但优先于</font></font><code class="literal">''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器用于对帐户行进行排序的规则内部（参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-access" title="6.2.4访问控制，阶段1：连接验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.4节“访问控制，第1阶段：连接验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设MySQL安装包含这两个帐户：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 创建默认代理帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建用户 ''@''</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用some_plugin AS'some_auth_string'识别;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 创建匿名帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建用户 ''@'％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  由'some_password'识别;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        第一个帐户（</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）旨在作为默认代理用户，用于验证没有以其他方式匹配更具体帐户的用户的连接。</font><font style="vertical-align: inherit;">第二个帐户（</font></font><code class="literal">''@'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是一个匿名用户帐户，可能已创建该帐户，例如，为了使用户无需其自己的帐户进行匿名连接。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        两个帐户都有相同的用户部分（</font></font><code class="literal">''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），它与任何用户匹配。</font><font style="vertical-align: inherit;">并且每个帐户都有一个与任何主机匹配的主机部分。</font><font style="vertical-align: inherit;">尽管如此，在帐户匹配优先级的连接尝试，因为匹配规则不大不小的主机</font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的前面</font></font><code class="literal">''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于不匹配任何特定于更具体帐户的帐户，服务器会尝试对</font></font><code class="literal">''@'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（匿名用户）而不是
         </font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认代理用户）</font><font style="vertical-align: inherit;">进行身份验证
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">结果是从不使用默认代理帐户。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要避免此问题，请使用以下策略之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            删除匿名帐户，以便它不会与默认代理用户冲突。</font><font style="vertical-align: inherit;">无论如何，这可能是一个好主意，如果你想将每个连接与一个指定的用户相关联。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用与匿名用户相匹配的更具体的默认代理用户。</font><font style="vertical-align: inherit;">例如，要仅允许
             </font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理连接，请使用
             </font></font><code class="literal">''@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER''@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用some_plugin AS'some_auth_string'识别;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            另外，修改任何</font></font><code class="literal">GRANT PROXY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句来命名</font></font><code class="literal">''@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            请注意，此策略阻止来自匿名用户的连接</font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            创建多个代理用户，一个用于本地连接，另一个用于</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（远程连​​接）。</font><font style="vertical-align: inherit;">当本地用户应该具有远程用户的不同权限时，这可能很有用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            创建代理用户：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 为本地连接创建代理用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER''@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用some_plugin AS'some_auth_string'识别;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 为远程连接创建代理用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建用户 ''@'％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用some_plugin AS'some_auth_string'识别;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            创建代理用户：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 为本地连接创建代理用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'developer'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  由'some_password'识别;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 为远程连接创建代理用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'developer'@'％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  由'some_password'识别;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为每个代理用户授予相应代理用户的代理权限：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRANT PROXY ON'developer'@'localhost'TO''@ localhost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT PROXY ON'developer'@'％'TO''@'％';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            最后，为本地和远程代理用户授予适当的权限（未显示）。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假定
             </font></font><code class="literal">some_plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code class="literal">'some_auth_string'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            组合导致</font></font><code class="literal">some_plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将客户端用户名映射到</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">本地连接匹配</font></font><code class="literal">''@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            映射到</font></font><code class="literal">'developer'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">代理用户。</font><font style="vertical-align: inherit;">远程连接与</font></font><code class="literal">''@'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射到</font></font><code class="literal">'developer'@'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代理用户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">代理用户相</font><font style="vertical-align: inherit;">匹配</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-server-user-mapping"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器支持代理用户映射</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117722896"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一些认证插件为自己实现代理用户映射。</font><font style="vertical-align: inherit;">对于某些人来说，MySQL服务器本身可以根据授予的代理权限映射代理用户。</font><font style="vertical-align: inherit;">如果
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_check_proxy_users"><code class="literal">check_proxy_users</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量已启用，则服务器将执行代理用户映射以查找请求它的任何认证插件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认情况下，
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_check_proxy_users"><code class="literal">check_proxy_users</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该功能处于禁用状态，因此服务器即使对请求它的认证插件也不执行代理用户映射。
          </font></font></p><a class="indexterm" name="idm140528117717008"></a><a class="indexterm" name="idm140528117715968"></a></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_check_proxy_users"><code class="literal">check_proxy_users</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用，它也可能需要启用特定插件，系统变量，以利用代理服务器用户映射的支持：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，启用
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_mysql_native_password_proxy_users"><code class="literal">mysql_native_password_proxy_users</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p><a class="indexterm" name="idm140528117709184"></a><a class="indexterm" name="idm140528117708144"></a></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，启用
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_proxy_users"><code class="literal">sha256_password_proxy_users</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p><a class="indexterm" name="idm140528117703792"></a><a class="indexterm" name="idm140528117702688"></a></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器执行的代理用户映射受以下限制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            即使</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            授予</font><font style="vertical-align: inherit;">相关</font><font style="vertical-align: inherit;">权限</font><font style="vertical-align: inherit;">，服务器也不会向匿名用户代理或从匿名用户代理</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当一个帐户被授予多个代理帐户的代理权限时，服务器代理用户映射不确定。</font><font style="vertical-align: inherit;">因此，不鼓励为多个代理帐户授予单个帐户代理权限。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-system-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户系统变量</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117695248"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        两个系统变量有助于跟踪代理登录过程：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_proxy_user"><code class="literal">proxy_user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果不使用代理，则</font><font style="vertical-align: inherit;">此值为
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，它表示代理用户帐户。</font><font style="vertical-align: inherit;">例如，如果客户端通过</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代理帐户进行</font><font style="vertical-align: inherit;">身份验证</font><font style="vertical-align: inherit;">，则该变量设置如下：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@proxy_user;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ proxy_user |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">''@''|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：有时身份验证插件可能会使用外部用户对MySQL服务器进行身份验证。</font><font style="vertical-align: inherit;">例如，使用Windows本机认证时，使用Windows API进行认证的插件不需要传递给它的登录ID。</font><font style="vertical-align: inherit;">但是，它仍然使用Windows用户标识进行身份验证。</font><font style="vertical-align: inherit;">插件可以使用</font></font><code class="literal">external_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只读会话变量</font><font style="vertical-align: inherit;">将此外部用户标识（或其前512个UTF-8字节）返回给服务器
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果插件没有设置这个变量，它的值是
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.11用户帐户锁定</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117682224"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从版本5.7.6开始，MySQL支持使用</font></font><code class="literal">ACCOUNT LOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
       </font><font style="vertical-align: inherit;">和
       </font><font style="vertical-align: inherit;">statements </font></font><code class="literal">ACCOUNT UNLOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句来
       </font><font style="vertical-align: inherit;">锁定和解锁用户帐户</font><font style="vertical-align: inherit;">：
</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些子句</font><font style="vertical-align: inherit;">一起使用时</font><font style="vertical-align: inherit;">，为新帐户指定初始锁定状态。</font><font style="vertical-align: inherit;">在没有任何一个条款的情况下，该帐户被创建为解锁状态。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些子句</font><font style="vertical-align: inherit;">一起使用时</font><font style="vertical-align: inherit;">，为现有帐户指定新的锁定状态。</font><font style="vertical-align: inherit;">在没有任何条款的情况下，账户锁定状态保持不变。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      帐户锁定状态记录在</font><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">的
       </font></font><code class="literal">account_locked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中
       </font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">输出来自于
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-user" title="13.7.5.12 SHOW CREATE USER语法"><code class="literal">SHOW CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示账户是否被锁定或解锁。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果客户端尝试连接到锁定的帐户，则尝试失败。</font><font style="vertical-align: inherit;">服务器递增</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Locked_connects"><code class="literal">Locked_connects</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量，</font><font style="vertical-align: inherit;">该
       </font><font style="vertical-align: inherit;">变量指示尝试连接到锁定帐户的次数，返回
       </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_account_has_been_locked"><code class="literal">ER_ACCOUNT_HAS_BEEN_LOCKED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误并将消息写入错误日志：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拒绝用户</font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“@” </font><font style="vertical-align: inherit;">访问</font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
帐户已锁定。</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      锁定帐户不会影响使用假定已锁定帐户身份的代理用户进行连接。</font><font style="vertical-align: inherit;">它也不会影响执行存储程序或视图的能力，这些程序或视图具有</font></font><code class="literal">DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名锁定帐户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">也就是说，使用代理帐户或存储程序或视图的能力不受锁定帐户的影响。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      帐户锁定功能取决于</font><font style="vertical-align: inherit;">表格中</font></font><code class="literal">account_locked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
       </font><font style="vertical-align: inherit;">的存在
       </font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要从旧版本升级到MySQL 5.7.6及更高版本，请运行
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以确保此列存在。</font><font style="vertical-align: inherit;">对于没有</font></font><code class="literal">account_locked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的非</font><font style="vertical-align: inherit;">升级安装，
       </font><font style="vertical-align: inherit;">服务器将所有帐户视为解锁，并且使用</font></font><code class="literal">ACCOUNT
      LOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">ACCOUNT UNLOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句会产生错误。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-activity-auditing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.12基于SQL的MySQL账户活动审计</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      应用程序可以使用以下指导原则执行基于SQL的审计，将数据库活动与MySQL帐户绑定。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL帐户对应</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">行
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当客户端连接成功时，服务器将客户端认证到此表中的特定行。</font><font style="vertical-align: inherit;">在</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
       </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该行的列值唯一标识账号和对应
       </font><font style="vertical-align: inherit;">
      的账户名都写在SQL语句格式。
    </font></font><code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      用于认证客户端的帐户决定了客户端拥有哪些特权。</font><font style="vertical-align: inherit;">通常，</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以调用</font><font style="vertical-align: inherit;">该
       </font><font style="vertical-align: inherit;">函数来确定客户端用户使用哪个帐户。</font><font style="vertical-align: inherit;">它的值由</font><font style="vertical-align: inherit;">
      帐户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表格行</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列构成</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      但是，在某些情况下，
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值不是与客户用户相对应，而是与其他帐户相对应。</font><font style="vertical-align: inherit;">这发生在特权检查不基于客户端帐户时的上下文中：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          存储的例程（过程和函数）与</font></font><code class="literal">SQL SECURITY DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特性一起
         </font><font style="vertical-align: inherit;">定义
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          由</font></font><code class="literal">SQL SECURITY DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          特征
         </font><font style="vertical-align: inherit;">定义的视图</font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          触发器和事件
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在这些情况下，特权检查是针对该
       </font></font><code class="literal">DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">账户进行的，并且
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及该账户，而不是针对调用存储例程或视图的客户的账户或者谁引起触发器激活的账户。</font><font style="vertical-align: inherit;">要确定调用用户，可以调用该
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，该函数将返回一个值，该值指示客户端和客户端连接的主机提供的实际用户名。</font><font style="vertical-align: inherit;">但是，此值不一定直接对应于</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的帐户
       </font><font style="vertical-align: inherit;">，因为该
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值从不包含通配符，而帐户值（由返回的值
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）可能包含用户名和主机名通配符。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      例如，一个空白的用户名与任何用户相匹配，所以一个帐户
       </font></font><code class="literal">''@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使得客户端能够以任何用户名的身份从本地主机作为匿名用户进行连接。</font><font style="vertical-align: inherit;">在这种情况下，如果客户端</font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从本地主机</font><font style="vertical-align: inherit;">连接</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回不同的值：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ---------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ---------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">user1 @ localhost | </font><font style="vertical-align: inherit;">@localhost |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ---------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      帐户的主机名部分也可以包含通配符。</font><font style="vertical-align: inherit;">如果主机名包含一个</font></font><code class="literal">'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">'_'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式字符或使用网络掩码符号，则该帐户可用于从多个主机连接的客户端，并且该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不会指示哪一个。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">'user2'@'%.example.com'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用
       </font><font style="vertical-align: inherit;">该帐户
       </font></font><code class="literal">user2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code class="literal">example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域中的</font><font style="vertical-align: inherit;">任何主机进行连接
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">user2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从连接</font></font><code class="literal">remote.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回不同的值：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">user2@remote.example.com | </font><font style="vertical-align: inherit;">user2@%.example.com |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + --------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果应用程序必须调用
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户审计（例如，如果它从触发器中进行审计），但也必须能够将该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      值与</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的帐户</font><font style="vertical-align: inherit;">相关联</font><font style="vertical-align: inherit;">，则必须避免在</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">中包含通配符的帐户
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">具体而言，不允许</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空（创建匿名用户帐户），并且不允许在</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      值中使用</font><font style="vertical-align: inherit;">模式字符或网络掩码表示法</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有帐户都必须具有非空</font></font><code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      值和文字</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      关于前面的示例，
       </font><font style="vertical-align: inherit;">应该更改帐户</font></font><code class="literal">''@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">'user2'@'%.example.com'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不使用通配符：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RENAME USER'''localhost'TO'user1'@'localhost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RENAME USER'user2'@'%.example.com'TO'user2'@'remote.example.com';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font></font><code class="literal">user2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须能够从</font></font><code class="literal">example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域中的</font><font style="vertical-align: inherit;">多个主机进行连接</font><font style="vertical-align: inherit;">，则每个主机应该有一个单独的帐户。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要从a </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值中</font><font style="vertical-align: inherit;">提取用户名或主机名部分
       </font><font style="vertical-align: inherit;">，请使用以下
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_substring-index"><code class="literal">SUBSTRING_INDEX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SUBSTRING_INDEX（CURRENT_USER（），'@'，1）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">user1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------- +</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',-1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SUBSTRING_INDEX（CURRENT_USER（），'@'， -  1）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">localhost |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------- +</font></font><font></font>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="encrypted-connections"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4使用加密连接</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#using-encrypted-connections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.1配置MySQL以使用加密连接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#encrypted-connection-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.2加密连接的命令选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3创建SSL和RSA证书和密钥</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#ssl-libraries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.4 OpenSSL与yaSSL</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#building-with-encrypted-connection-support"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.5构建支持加密连接的MySQL</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.6加密的连接协议和密码</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#windows-and-ssh"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.7通过SSH从Windows远程连接到MySQL</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528117592976"></a><a class="indexterm" name="idm140528117591936"></a><a class="indexterm" name="idm140528117590864"></a><a class="indexterm" name="idm140528117589776"></a><a class="indexterm" name="idm140528117588688"></a><a class="indexterm" name="idm140528117587616"></a><a class="indexterm" name="idm140528117586544"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    通过MySQL客户端和服务器之间的未加密连接，有权访问网络的人员可以监视所有流量并检查客户端和服务器之间发送或接收的数据。
  </font></font></p><a class="indexterm" name="idm140528117584464"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    当您必须以安全的方式通过网络传输信息时，未加密的连接是不可接受的。</font><font style="vertical-align: inherit;">要使任何类型的数据不可读，请使用加密。</font><font style="vertical-align: inherit;">加密算法必须包含安全元素以抵御多种已知的攻击，例如更改加密消息的顺序或重放数据两次。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL支持使用TLS（传输层安全性）协议的客户端和服务器之间的加密连接。</font><font style="vertical-align: inherit;">TLS有时被称为SSL（安全套接字层），但MySQL实际上并未将SSL协议用于加密连接，因为其加密功能较弱（请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers" title="6.4.6加密的连接协议和密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.6节“加密连接协议和密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    TLS使用加密算法来确保通过公共网络接收的数据可以被信任。</font><font style="vertical-align: inherit;">它具有检测数据更改，丢失或重放的机制。</font><font style="vertical-align: inherit;">TLS还包含了使用X509标准提供身份验证的算法。
  </font></font></p><a class="indexterm" name="idm140528117580496"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    X509可以识别互联网上的某个人。</font><font style="vertical-align: inherit;">基本而言，应该有一个实体称为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书颁发机构</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或CA），它将电子证书分配给需要它们的任何人。</font><font style="vertical-align: inherit;">证书依赖于具有两个加密密钥（公钥和秘密密钥）的非对称加密算法。</font><font style="vertical-align: inherit;">证书所有者可以将证书呈现给另一方作为身份证明。</font><font style="vertical-align: inherit;">证书由其所有者的公钥组成。</font><font style="vertical-align: inherit;">使用该公钥加密的任何数据只能使用由证书所有者持有的相应密钥进行解密。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL可以编译为使用OpenSSL或yaSSL的加密连接支持。</font><font style="vertical-align: inherit;">有关这两个软件包的比较，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ssl-libraries" title="6.4.4 OpenSSL与yaSSL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.4节“OpenSSL与yaSSL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关每个软件包支持的加密协议和密码的信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers" title="6.4.6加密的连接协议和密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.6节“加密连接协议和密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    默认情况下，如果服务器支持加密连接，则MySQL程序尝试使用加密进行连接，如果无法建立加密连接，则会回退到未加密连接。</font><font style="vertical-align: inherit;">有关影响使用加密连接的选项的信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-options" title="6.4.2加密连接的命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.2节“加密连接的命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL在每个连接的基础上执行加密，并且对给定用户使用加密可以是可选的或强制的。</font><font style="vertical-align: inherit;">这使您可以根据各个应用程序的要求选择加密或未加密的连接。</font><font style="vertical-align: inherit;">有关如何要求用户使用加密连接的信息，请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;">第13.7.1.2节“CREATE USER语法”</font></a></font><code class="literal">REQUIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中关于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
     </font><font style="vertical-align: inherit;">子句
     </font><font style="vertical-align: inherit;">的讨论</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另见的描述
     </font><font style="vertical-align: inherit;">系统变量在</font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;">第5.1.5节，“服务器系统变量”</font></a></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"></font></a>
  </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    主站和从站复制服务器之间可以使用加密连接。</font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-encrypted-connections" title="16.3.8设置复制以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.8节“设置复制以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关使用MySQL C API中的加密连接的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/connectors-apis.html#c-api-encrypted-connections" title="27.8.15 C API加密连接支持"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第27.8.15节“C API加密连接支持”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    也可以使用SSH连接内的加密连接到MySQL服务器主机。</font><font style="vertical-align: inherit;">有关示例，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#windows-and-ssh" title="6.4.7通过SSH从Windows远程连接到MySQL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.7节“使用SSH从Windows远程连接到MySQL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在MySQL 5.7中对加密连接支持进行了一些改进。</font><font style="vertical-align: inherit;">以下时间表总结了这些变化：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        5.7.3：在客户端，明确的
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项不再是建议性的，而是规定性的。</font><font style="vertical-align: inherit;">如果启用支持加密连接的服务器，则客户端程序可以通过仅指定</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">来要求加密连接
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（此之前，有必要对客户端指定的任意
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，或者所有三个</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。）如果加密连接，无法建立连接尝试失败。</font><font style="vertical-align: inherit;">客户方的</font><font style="vertical-align: inherit;">其他
         </font><font style="vertical-align: inherit;">选择是在没有时提供咨询
        </font></font><code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：客户端尝试使用加密进行连接，但如果无法建立加密连接，则会回退到未加密连接。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        5.7.5：</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        默认情况下启用</font><font style="vertical-align: inherit;">服务器端</font><font style="vertical-align: inherit;">选项值。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于使用OpenSSL编译的服务器
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_auto_generate_certs"><code class="literal">auto_generate_certs</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量可用于在启动时启用自动生成和自动发现SSL / RSA证书和密钥文件。</font><font style="vertical-align: inherit;">对于证书和密钥自动发现，如果
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用并且</font><span class="emphasis"><em><font style="vertical-align: inherit;">未</font></em></span><font style="vertical-align: inherit;">提供</font><font style="vertical-align: inherit;">其他
         </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">以明确配置加密连接，则服务器会在启动时自动启用对加密连接的支持，前提是它在数据目录中发现必需的证书和密钥文件。
      </font></font><code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        5.7.6：</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序可用于更轻松地手动生成SSL / RSA证书和密钥文件。</font><font style="vertical-align: inherit;">无论是使用OpenSSL还是使用yaSSL进行编译，启动时SSL / RSA文件的自动发现都会扩展应用于所有服务器。</font><font style="vertical-align: inherit;">（这意味着
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_auto_generate_certs"><code class="literal">auto_generate_certs</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要启用自动发现功能。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果服务器在启动时发现CA证书是自签名的，则会向错误日志写入警告。</font><font style="vertical-align: inherit;">（如果服务器自动创建证书，或手动使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则证书是自签名的
         </font><font style="vertical-align: inherit;">。）
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        5.7.7：如果服务器支持加密连接，则C客户端库默认尝试建立加密连接。</font><font style="vertical-align: inherit;">这会影响客户程序，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果没有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项，则客户端尝试使用加密进行连接，如果无法建立加密连接，则会回退到未加密的连接。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            显式
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项或同义词（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--enable-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的存在是规定性的：客户端需要加密连接，如果无法建立，连接将失败。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项或同义词（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--skip-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--disable-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），客户端使用未加密的连接。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此更改还会影响基于C客户端库的后续版本的MySQL连接器：连接器/ C，连接器/ C ++和连接器/ ODBC。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        5.7.8：
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量可用于控制到服务器的客户端连接是否必须使用某种形式的安全传输。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        5.7.10：TLS协议支持从TLSv1扩展到还包括TLSv1.1和TLSv1.2。</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">系统变量和
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_tls-version"><code class="option">--tls-version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端的选项可以选择支持级别。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers" title="6.4.6加密的连接协议和密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.6节“加密的连接协议和密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        5.7.11：MySQL客户端程序支持一个
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，使您可以指定到服务器的连接的安全状态。</font><font style="vertical-align: inherit;">该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项包含客户端
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-verify-server-cert"><code class="option">--ssl-verify-server-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项的功能。</font><font style="vertical-align: inherit;">因此，</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-verify-server-cert"><code class="option">--ssl-verify-server-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已被弃用，并在MySQL 8.0被删除。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="using-encrypted-connections"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.1配置MySQL以使用加密连接</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117515072"></a><a class="indexterm" name="idm140528117514032"></a><a class="indexterm" name="idm140528117512560"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有几个选项可用于指示是否使用加密连接，并指定适当的证书和密钥文件。</font><font style="vertical-align: inherit;">本节提供有关为加密连接配置服务器和客户端的一般指导：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections-server-side-configuration" title="加密连接的服务器端配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密连接的服务器端配置</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections-client-side-configuration" title="加密连接的客户端配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密连接的客户端配置</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关建立加密连接的完整选项列表，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-options" title="6.4.2加密连接的命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.2节“加密连接的命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您需要创建所需的证书和密钥文件，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files" title="6.4.3创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3节“创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      主站和从站复制服务器之间可以使用加密连接。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-encrypted-connections" title="16.3.8设置复制以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.8节“设置复制以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      加密连接可通过MySQL C API获得。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/connectors-apis.html#c-api-encrypted-connections" title="27.8.15 C API加密连接支持"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第27.8.15节“C API加密连接支持”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="using-encrypted-connections-server-side-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密连接的服务器端配置</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在服务器端，该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项指定服务器允许但不需要加密连接。</font><font style="vertical-align: inherit;">该选项默认启用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器端的这些选项可识别服务器在允许客户端建立加密连接时使用的证书和密钥文件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：证书颁发机构（CA）证书文件的路径名称。</font><font style="vertical-align: inherit;">（</font></font><code class="option">--ssl-capath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似但指定CA证书文件目录的路径名称。）
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：服务器公钥证书文件的路径名。</font><font style="vertical-align: inherit;">这可以发送给客户端，并根据它拥有的CA证书进行身份验证。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：服务器私钥文件的路径名称。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        例如，要启用加密连接的服务器，请使用</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        文件中的</font><font style="vertical-align: inherit;">这些行来启动它，并</font><font style="vertical-align: inherit;">根据需要更改文件名称：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL的CA = ca.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL证书=服务器cert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL的密钥=服务器key.pem</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个选项都以PEM格式命名文件。</font><font style="vertical-align: inherit;">如果您需要创建所需的证书和密钥文件，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files" title="6.4.3创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3节“创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，如果您拥有MySQL源代码发行版，则可以使用其</font></font><code class="filename">mysql-test/std_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录中</font><font style="vertical-align: inherit;">的演示证书和密钥文件来测试您的设置
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用OpenSSL编译的MySQL服务器可以在启动时自动生成缺少的证书和密钥文件。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql" title="6.4.3.1使用MySQL创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3.1节“使用MySQL创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器执行证书和密钥文件自动发现。</font><font style="vertical-align: inherit;">如果
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用（可能随附</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并且</font><span class="emphasis"><em><font style="vertical-align: inherit;">未</font></em></span><font style="vertical-align: inherit;">提供</font><font style="vertical-align: inherit;">其他
         </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">以明确配置加密连接，则服务器将尝试在启动时自动启用对加密连接的支持：
</font></font><code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果服务器发现有效的证书和命名的密钥文件</font></font><code class="filename">ca.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="filename">server-cert.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
             </font></font><code class="filename">server-key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据目录中，它能够通过客户端加密的连接支持。</font><font style="vertical-align: inherit;">（这些文件不一定是自动生成的;重要的是它们具有指定的名称并且是有效的。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果服务器在数据目录中找不到有效的证书和密钥文件，它将继续执行，但不支持加密连接。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果服务器自动启用对加密连接的支持，则会向错误日志中写入注释。</font><font style="vertical-align: inherit;">如果服务器发现CA证书是自签名的，则会向错误日志写入警告。</font><font style="vertical-align: inherit;">（如果服务器自动创建证书，或手动使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则证书是自签名的
         </font><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器使用任何自动发现并使用证书和密钥文件的名称，设置相应的系统变量（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ssl_ca"><code class="literal">ssl_ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ssl_cert"><code class="literal">ssl_cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ssl_key"><code class="literal">ssl_key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了进一步控制客户端是否必须使用加密进行连接，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量; </font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要明确指定允许的加密协议，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量; </font><font style="vertical-align: inherit;">参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers" title="6.4.6加密的连接协议和密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.6节“加密连接协议和密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="using-encrypted-connections-client-side-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密连接的客户端配置</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        默认情况下，如果服务器支持加密连接，MySQL客户端程序会尝试建立加密连接，并通过以下</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">进一步控制
         </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果没有
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，则客户端尝试使用加密进行连接，如果无法建立加密连接，则会回退到未加密的连接。</font><font style="vertical-align: inherit;">这也是具有明确</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=PREFFERED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的行为
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用时</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=REQUIRED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，客户端需要加密连接，如果无法建立，则会失败。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用时</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=DISABLED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，客户端使用未加密的连接。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_CA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_IDENTITY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，客户端需要加密连接，并且还要根据服务器CA证书和（与</font></font><code class="literal">VERIFY_IDENTITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">证书
             </font><font style="vertical-align: inherit;">中的服务器主机名进行验证。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        客户端上的以下选项标识客户端在建立到服务器的加密连接时使用的证书和密钥文件。</font><font style="vertical-align: inherit;">它们类似于在服务器端使用的选项，但
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别客户端公钥和私钥：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：证书颁发机构（CA）证书文件的路径名称。</font><font style="vertical-align: inherit;">该选项（如果使用）必须指定服务器使用的相同证书。</font><font style="vertical-align: inherit;">（</font></font><code class="option">--ssl-capath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似但指定CA证书文件目录的路径名称。）
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：客户端公钥证书文件的路径名。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：客户机私钥文件的路径名称。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        相对于默认加密提供的安全性，客户端可以提供与服务器使用的证书相匹配的CA证书并启用主机名身份验证。</font><font style="vertical-align: inherit;">通过这种方式，服务器和客户端将他们的信任置于相同的CA证书中，并且客户端验证其连接的主机是否是预期的主机：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要指定CA证书，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并指定
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_CA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要启用主机名身份验证，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_IDENTITY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            而不是
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_CA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          主机名身份验证不适用于由服务器自动创建的自签名证书，或手动使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql" title="6.4.3.1使用MySQL创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3.1节“使用MySQL创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这些自签名证书不包含作为通用名称值的服务器名称。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        根据客户端使用的MySQL帐户的加密要求，可能需要客户端指定某些选项以使用加密连接到支持加密连接的MySQL服务器。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设您要使用没有特殊加密要求的帐户进行连接，或者使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含该</font></font><code class="literal">REQUIRE SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">创建帐户
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假定服务器支持加密连接，则客户端可以使用不带</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项或显式</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=PREFFERED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项的</font><font style="vertical-align: inherit;">加密进行连接
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要么：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --ssl-mode = PREFERRED
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于一个帐户</font></font><code class="literal">REQUIRE SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果无法建立加密连接，则连接尝试失败。</font><font style="vertical-align: inherit;">对于没有特殊加密要求的帐户，如果无法建立加密连接，则尝试回退到未加密连接。</font><font style="vertical-align: inherit;">如果无法获得加密连接，要防止回退并失败，请如下连接：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --ssl-mode = REQUIRED
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果帐户有更严格的安全要求，则必须指定其他选项来建立加密连接：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于账户</font></font><code class="literal">REQUIRE X509</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，客户必须至少指定
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另外，
             </font><font style="vertical-align: inherit;">推荐使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），以便可以验证服务器提供的公共证书。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --ssl-ca = ca.pem \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      --ssl-cert = client-cert.pem \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      --ssl密钥=客户端 -  key.pem</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于具有</font></font><code class="literal">REQUIRE ISSUER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
             </font></font><code class="literal">REQUIRE SUBJECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，选项要求与</font><font style="vertical-align: inherit;">帐户相同的帐户</font></font><code class="literal">REQUIRE X509</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但证书必须分别与帐户定义中指定的问题或主题相匹配。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关该</font></font><code class="literal">REQUIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        子句的</font><font style="vertical-align: inherit;">其他信息</font><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.2节“CREATE USER语法”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的讨论</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要防止使用加密并覆盖其他
         </font><font style="vertical-align: inherit;">选项，请通过以下方式调用客户端程序
         </font><font style="vertical-align: inherit;">：
      </font></font><code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=DISABLED</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --ssl-mode = DISABLED
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要明确指定允许的加密协议，请使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_tls-version"><code class="option">--tls-version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项; </font><font style="vertical-align: inherit;">参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers" title="6.4.6加密的连接协议和密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.6节“加密连接协议和密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要确定当前与服务器的连接是否使用加密，请检查</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Ssl_cipher"><code class="literal">Ssl_cipher</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果该值为空，则连接未加密。</font><font style="vertical-align: inherit;">否则，连接将被加密，并且该值指示加密密码。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW SESSION STATUS LIKE 'Ssl_cipher';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + --------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + --------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Ssl_cipher | </font><font style="vertical-align: inherit;">DHE-RSA-AES128-GCM-SHA256 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + --------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端，另一种方法是使用</font></font><code class="literal">STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">\s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        命令并检查该</font></font><code class="literal">SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>\s</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL：未使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要么：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>\s</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL：使用的密码是DHE-RSA-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="encrypted-connection-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.2加密连接的命令选项</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528117395120"></a><a class="indexterm" name="idm140528117393632"></a><a class="indexterm" name="idm140528117392144"></a><a class="indexterm" name="idm140528117390688"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍用于指定是否使用加密连接的选项，证书和密钥文件的名称以及与加密连接支持相关的其他参数。</font><font style="vertical-align: inherit;">这些选项可以在命令行或选项文件中给出。</font><font style="vertical-align: inherit;">有关建议使用以及如何检查连接是否加密的示例，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关使用MySQL C API中的加密连接的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/connectors-apis.html#c-api-encrypted-connections" title="27.8.15 C API加密连接支持"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第27.8.15节“C API加密连接支持”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528117386544"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.8加密连接选项摘要</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Command-line options available for establishing encrypted connections."><colgroup><col width="31%"><col width="56%"><col width="12%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--skip-SSL</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要使用加密连接</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用加密连接</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl-CA</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含可信SSL证书颁发机构列表的文件</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl-capath</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含可信SSL证书颁发机构证书文件的目录</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl证书</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含X509证书的文件</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cipher"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl-密码</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许连接加密的密码列表</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl-CRL</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含证书吊销列表的文件</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crlpath"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl-crlpath</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含证书撤销列表文件的目录</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl键</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含X509密钥的文件</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl模式</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到服务器的安全状态</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.11</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-verify-server-cert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl-验证服务器证书</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据服务器证书通用名称身份验证主机名称</font></font></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_tls-version"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--tls版本</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许加密连接的协议</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.10</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_general_ssl"></a>
          <a class="indexterm" name="idm140528117333456"></a>

          <a class="indexterm" name="idm140528117332416"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此选项对客户端和服务器端有不同的影响。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            客户端</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项从MySQL 5.7.11开始已弃用，并在MySQL 8.0中删除。</font><font style="vertical-align: inherit;">对于客户端程序，请
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=REQUIRED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                而不是</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--enable-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=DISABLED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                替代</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--skip-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--disable-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有明确的</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                选项等同于没有明确的
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器端</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被弃用。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          默认情况下，如果服务器支持加密连接，MySQL客户端程序将尝试建立加密连接，并通过以下</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">进一步控制
           </font><font style="vertical-align: inherit;">：客户端
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项的工作方式如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果没有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选项，则客户端尝试使用加密进行连接，如果无法建立加密连接，则会回退到未加密的连接。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              显式
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项或同义词（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--enable-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的存在是规定性的：客户端需要加密连接，如果无法建立，连接将失败。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项或同义词（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--skip-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--disable-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），客户端使用未加密的连接。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要通过MySQL帐户要求使用加密连接，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code class="literal">REQUIRE SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">创建帐户</font><font style="vertical-align: inherit;">，或者使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现有帐户添加</font></font><code class="literal">REQUIRE SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">除非MySQL支持加密连接并且可以建立加密连接，否则使用该帐户的客户端的连接尝试将被拒绝。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">REQUIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句允许其他与加密相关的选项，这些选项可用于强制执行比这更严格的安全要求</font></font><code class="literal">REQUIRE
          SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关其他详细信息有关哪些选项可以或必须由连接使用使用各种配置的帐户的客户来指定命令
           </font></font><code class="literal">REQUIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，见描述
           </font></font><code class="literal">REQUIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.2，“CREATE USER语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器端，该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项指定服务器允许但不需要加密连接。</font><font style="vertical-align: inherit;">该选项默认在服务器端启用。</font><font style="vertical-align: inherit;">如</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">所暗示的
           </font><font style="vertical-align: inherit;">，如这些选项的说明中所述。
        </font></font><code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以否定的形式选项表示加密应该</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          使用，并覆盖其他
           </font><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">将选项指定为</font><font style="vertical-align: inherit;">
          或同义词（</font><font style="vertical-align: inherit;">，
           </font><font style="vertical-align: inherit;">）。
        </font></font><code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl=0</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--skip-ssl</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--disable-ssl</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要加密的连接指定其他参数，至少使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器侧和</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端侧。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该部分还介绍了证书和密钥文件自动生成和自动发现的服务器功能。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-ca"></a>
          <a class="indexterm" name="idm140528117277968"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca=<em class="replaceable"><code>file_name</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          PEM格式的证书颁发机构（CA）证书文件的路径名。</font><font style="vertical-align: inherit;">在服务器端，这个选项意味着
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要告诉客户端在与服务器建立加密连接时不要验证服务器证书，也</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要
           </font><font style="vertical-align: inherit;">指定</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">服务器仍根据为客户帐户建立的任何适用要求验证客户端，并且它仍使用</font><font style="vertical-align: inherit;">服务器端指定的</font><font style="vertical-align: inherit;">任何
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项值。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-capath"></a>
          <a class="indexterm" name="idm140528117268304"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath=<em class="replaceable"><code>dir_name</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          包含PEM格式的可信SSL证书颁发机构（CA）证书文件的目录的路径名。</font><font style="vertical-align: inherit;">在服务器端，这个选项意味着
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要告诉客户端在与服务器建立加密连接时不要验证服务器证书，也</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要
           </font><font style="vertical-align: inherit;">指定</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">服务器仍根据为客户帐户建立的任何适用要求验证客户端，并且它仍使用</font><font style="vertical-align: inherit;">服务器端指定的</font><font style="vertical-align: inherit;">任何
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项值。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用OpenSSL编译的MySQL发行版支持该
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ssl-libraries" title="6.4.4 OpenSSL与yaSSL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.4节“OpenSSL与yaSSL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">使用yaSSL编译的分布不会因为yaSSL不在任何目录中查找而且不遵循链式证书树。</font><font style="vertical-align: inherit;">yaSSL要求CA证书树的所有组件都包含在单个CA证书树中，并且文件中的每个证书都具有唯一的SubjectName值。</font><font style="vertical-align: inherit;">要解决此yaSSL限制，将构成证书树的单个证书文件连接到一个新文件，并将该文件指定为该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-cert"></a>
          <a class="indexterm" name="idm140528117254912"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert=<em class="replaceable"><code>file_name</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          PEM格式的SSL公钥证书文件的路径名。</font><font style="vertical-align: inherit;">在客户端，这是客户端公钥证书。</font><font style="vertical-align: inherit;">在服务器端，这是服务器公钥证书。</font><font style="vertical-align: inherit;">在服务器端，这个选项意味着
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-cipher"></a>
          <a class="indexterm" name="idm140528117249728"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher=<em class="replaceable"><code>cipher_list</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于连接加密的允许密码列表。</font><font style="vertical-align: inherit;">如果列表中不支持密码，则加密连接将不起作用。</font><font style="vertical-align: inherit;">在服务器端，这个选项意味着
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了获得最大的可移植性，
           </font></font><em class="replaceable"><code>cipher_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该列出一个或多个以冒号分隔的密码名称。</font><font style="vertical-align: inherit;">这种格式可以通过OpenSSL和yaSSL来理解。</font><font style="vertical-align: inherit;">例子：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--ssl-密码= AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--ssl-密码= DHE-RSA-AES128-GCM-SHA256：AES128-SHA</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          OpenSSL支持更灵活的语法来指定密码，如OpenSSL文档中所述，位于
           </font></font><a class="ulink" href="https://www.openssl.org/docs/manmaster/man1/ciphers.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.openssl.org/docs/manmaster/man1/ciphers.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">yaSSL没有，所以试图使用这种扩展语法对使用yaSSL编译的MySQL发行版失败。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关MySQL支持哪些加密密码的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers" title="6.4.6加密的连接协议和密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.6节“加密连接协议和密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-crl"></a>
          <a class="indexterm" name="idm140528117240064"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crl"><code class="option">--ssl-crl=<em class="replaceable"><code>file_name</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          包含PEM格式的证书吊销列表的文件的路径名称。</font><font style="vertical-align: inherit;">在服务器端，这个选项意味着
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果既没有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也没有
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出，即使CA路径包含证书撤销列表，也不执行CRL检查。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用OpenSSL编译的MySQL发行版支持该
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ssl-libraries" title="6.4.4 OpenSSL与yaSSL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.4节“OpenSSL与yaSSL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">使用yaSSL编译的分布不会因为撤销列表不能用于yaSSL。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-crlpath"></a>
          <a class="indexterm" name="idm140528117230336"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath=<em class="replaceable"><code>dir_name</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          包含PEM格式的证书撤销列表文件的目录的路径名。</font><font style="vertical-align: inherit;">在服务器端，这个选项意味着</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果既没有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也没有
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出，即使CA路径包含证书撤销列表，也不执行CRL检查。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用OpenSSL编译的MySQL发行版支持该
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ssl-libraries" title="6.4.4 OpenSSL与yaSSL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.4节“OpenSSL与yaSSL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">使用yaSSL编译的分布不会因为撤销列表不能用于yaSSL。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-key"></a>
          <a class="indexterm" name="idm140528117220688"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key=<em class="replaceable"><code>file_name</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          PEM格式的SSL私钥文件的路径名。</font><font style="vertical-align: inherit;">在客户端，这是客户端私钥。</font><font style="vertical-align: inherit;">在服务器端，这是服务器私钥。</font><font style="vertical-align: inherit;">在服务器端，这个选项意味着</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果密钥文件受密码保护，程序将提示用户输入密码。</font><font style="vertical-align: inherit;">密码必须交互提供; </font><font style="vertical-align: inherit;">它不能存储在一个文件中。</font><font style="vertical-align: inherit;">如果密码不正确，则程序继续，因为它无法读取密钥。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了获得更好的安全性，请使用RSA密钥长度至少为2048位的证书。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-mode"></a>
          <a class="indexterm" name="idm140528117214432"></a>

          <a class="indexterm" name="idm140528117212976"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=<em class="replaceable"><code>mode</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此选项仅适用于客户端程序，不适用于服务器。</font><font style="vertical-align: inherit;">它指定到服务器的连接的安全状态。</font><font style="vertical-align: inherit;">这些选项值是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">PREFERRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：如果服务器支持加密连接，则建立加密连接，如果无法建立加密连接，则回退到未加密连接。</font><font style="vertical-align: inherit;">如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定，</font><font style="vertical-align: inherit;">则这是默认值
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">REQUIRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：如果服务器支持加密连接，则建立加密连接。</font><font style="vertical-align: inherit;">如果无法建立加密连接，则连接尝试失败。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">VERIFY_CA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Like
               </font></font><code class="literal">REQUIRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是另外根据配置的CA证书验证服务器证书颁发机构（CA）证书。</font><font style="vertical-align: inherit;">如果找不到有效的匹配CA证书，则连接尝试失败。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">VERIFY_IDENTITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：类似
               </font></font><code class="literal">VERIFY_CA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是另外通过检查服务器发送给客户端的证书中的服务器的公用名身份来执行主机名称标识验证。</font><font style="vertical-align: inherit;">客户端根据客户端用于连接到服务器的主机名验证公用名，如果不匹配，连接将失败。</font><font style="vertical-align: inherit;">对于加密连接，此选项有助于防止中间人攻击。</font><font style="vertical-align: inherit;">这就像传统
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-verify-server-cert"><code class="option">--ssl-verify-server-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选项。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                主机名身份验证不适用于由服务器自动创建的自签名证书，或手动使用
                 </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql" title="6.4.3.1使用MySQL创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3.1节“使用MySQL创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这些自签名证书不包含作为通用名称值的服务器名称。
</font></font></p>
</div>
</li><li class="listitem"><p>
              <code class="literal">DISABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：建立一个未加密的连接。</font><font style="vertical-align: inherit;">这就像传统
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项或其同义词（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--skip-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--disable-ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项与CA证书选项交互如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有明确设置，则使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暗示
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_CA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
               </font></font><code class="literal">VERIFY_CA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">VERIFY_IDENTITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还需要，以提供匹配由服务器使用的一个CA证书。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个显式</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选项的值不是
               </font></font><code class="literal">VERIFY_CA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">VERIFY_IDENTITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与显式</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">一起显示</font><font style="vertical-align: inherit;">，但会产生一条警告，表示不会验证服务器证书，尽管指定了CA证书选项。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项已添加到MySQL 5.7.11中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要通过MySQL帐户要求使用加密连接，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code class="literal">REQUIRE SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">创建帐户</font><font style="vertical-align: inherit;">，或者使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现有帐户添加</font></font><code class="literal">REQUIRE SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">除非MySQL支持加密连接并且可以建立加密连接，否则使用该帐户的客户端的连接尝试将被拒绝。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">REQUIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句允许其他与加密相关的选项，这些选项可用于强制执行比这更严格的安全要求</font></font><code class="literal">REQUIRE
          SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关其他详细信息有关哪些选项可以或必须由连接使用使用各种配置的帐户的客户来指定命令
           </font></font><code class="literal">REQUIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，见描述
           </font></font><code class="literal">REQUIRE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.1.2，“CREATE USER语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="option_general_ssl-verify-server-cert"></a>
          <a class="indexterm" name="idm140528117162384"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-verify-server-cert"><code class="option">--ssl-verify-server-cert</code></a>
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-verify-server-cert"><code class="option">--ssl-verify-server-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项从MySQL 5.7.11开始已弃用，并在MySQL 8.0中删除。</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_IDENTITY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            改为</font><font style="vertical-align: inherit;">使用
             </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此选项仅适用于客户端程序，不适用于服务器。</font><font style="vertical-align: inherit;">它使客户端通过检查服务器发送给客户端的证书中的服务器的公共名称标识来执行主机名称标识验证。</font><font style="vertical-align: inherit;">客户端根据客户端用于连接到服务器的主机名验证公用名，如果不匹配，连接将失败。</font><font style="vertical-align: inherit;">对于加密连接，此选项有助于防止中间人攻击。</font><font style="vertical-align: inherit;">主机名身份验证默认为禁用。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            主机名身份验证不适用于由服务器自动创建的自签名证书，或手动使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql" title="6.4.3.1使用MySQL创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3.1节“使用MySQL创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这些自签名证书不包含作为通用名称值的服务器名称。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_general_tls-version"></a>
          <a class="indexterm" name="idm140528117152160"></a>

          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_tls-version"><code class="option">--tls-version=<em class="replaceable"><code>protocol_list</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于客户端程序，客户端允许用于加密连接的协议。</font><font style="vertical-align: inherit;">该值是一个包含一个或多个协议名称的逗号分隔列表。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --tls-version =“TLSv1.1，TLSv1.2”
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以为这个选项命名的协议取决于用于编译MySQL的SSL库。</font><font style="vertical-align: inherit;">有关详细信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-protocols-ciphers" title="6.4.6加密的连接协议和密码"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.6节“加密连接协议和密码”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该选项已添加到MySQL 5.7.10中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器端，改用
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="creating-ssl-rsa-files"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3创建SSL和RSA证书和密钥</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3.1使用MySQL创建SSL和RSA证书和密钥</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#creating-ssl-files-using-openssl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3.2创建SSL证书和密钥使用openssl</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#creating-rsa-files-using-openssl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3.3使用openssl创建RSA密钥</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下讨论描述如何在MySQL中创建SSL和RSA支持所需的文件。</font><font style="vertical-align: inherit;">文件创建可以使用MySQL本身提供的工具来执行，也可以通过</font><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">调用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来执行。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      SSL证书和密钥文件使MySQL能够支持使用SSL的加密连接。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      RSA密钥文件使MySQL能够通过</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">验证帐户的未加密连接支持安全密码交换
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#sha256-pluggable-authentication" title="6.5.1.4 SHA-256可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.4节“SHA-256可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-ssl-rsa-files-using-mysql"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3.1使用MySQL创建SSL和RSA证书和密钥</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL提供这些方法来创建支持使用SSL的加密连接所需的SSL证书和密钥文件以及RSA密钥对文件，并在未加密的连接上使用RSA安全地进行密码交换（如果缺少这些文件）：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器可以在启动时自动生成这些文件，用于使用OpenSSL编译的MySQL发行版。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用户可以</font><font style="vertical-align: inherit;">
            手动</font><font style="vertical-align: inherit;">调用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于某些分发类型（例如RPM软件包），
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用在数据目录初始化期间发生。</font><font style="vertical-align: inherit;">在这种情况下，只要</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令可用</font><font style="vertical-align: inherit;">，MySQL发行版就不需要使用OpenSSL进行编译</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器自动生成和
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过更容易地生成所需文件来帮助降低使用SSL的障碍。</font><font style="vertical-align: inherit;">但是，这些方法生成的证书是自签名的，可能不太安全。</font><font style="vertical-align: inherit;">在获得使用此类文件的经验后，请考虑从注册证书颁发机构获取证书/密钥材料。
</font></font></p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql-automatic" title="自动SSL和RSA文件生成"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动SSL和RSA文件生成</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql-manual-using-mysql-ssl-rsa-setup" title="使用mysql_ssl_rsa_setup手动生成SSL和RSA文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用mysql_ssl_rsa_setup手动生成SSL和RSA文件</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql-ssl-and-rsa-file-characteristics" title="SSL和RSA文件特征"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL和RSA文件特征</font></font></a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-automatic"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动SSL和RSA文件生成</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于使用OpenSSL编译的MySQL发行版，MySQL服务器能够在启动时自动生成缺失的SSL和RSA文件。</font><font style="vertical-align: inherit;">该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_auto_generate_certs"><code class="literal">auto_generate_certs</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量控制自动生成这些文件。</font><font style="vertical-align: inherit;">这两个变量都默认启用。</font><font style="vertical-align: inherit;">它们可以在启动时启用并进行检查，但不能在运行时设置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          启动时，如果</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_auto_generate_certs"><code class="literal">auto_generate_certs</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">系统变量，未</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl"><code class="option">--ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">SSL选项
           </font><font style="vertical-align: inherit;">以及数据中缺少服务器端SSL文件</font><font style="vertical-align: inherit;">，则服务器会自动在数据目录中生成服务器端和客户端SSL证书和密钥文件
           </font><font style="vertical-align: inherit;">目录。</font><font style="vertical-align: inherit;">这些文件使用SSL启用加密的客户端连接; </font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器使用以下名称检查数据目录中的SSL文件：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务器cert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务器key.pem</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果存在任何这些文件，则服务器不会创建SSL文件。</font><font style="vertical-align: inherit;">否则，它创建它们，再加上一些额外的文件：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca.pem自签名的CA证书</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ca-key.pem CA私钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
server-cert.pem服务器证书</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
server-key.pem服务器私钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
client-cert.pem客户端证书</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
client-key.pem客户端私钥</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果服务器自动生成SSL文件，它使用的名称</font></font><code class="filename">ca.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="filename">server-cert.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
               </font></font><code class="filename">server-key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件来设置相应的系统变量（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ssl_ca"><code class="literal">ssl_ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ssl_cert"><code class="literal">ssl_cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ssl_key"><code class="literal">ssl_key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在启动时，如果所有这些条件都成立，服务器将自动在数据目录中生成RSA专用/公用密钥对文件：
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量已启用; </font><font style="vertical-align: inherit;">没有指定RSA选项; </font><font style="vertical-align: inherit;">数据目录中缺少RSA文件。</font><font style="vertical-align: inherit;">这些密钥对文件通过使用RSA通过未加密连接为通过</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">验证的帐户启用安全密码交换
           </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#sha256-pluggable-authentication" title="6.5.1.4 SHA-256可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.4节“SHA-256可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器使用以下名称检查数据目录中的RSA文件：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">private_key.pem私人/公钥对的私人成员</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
public_key.pem私钥/公钥对的公共成员</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果存在这些文件中的任何一个，则服务器不会创建RSA文件。</font><font style="vertical-align: inherit;">否则，它会创建它们。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果服务器自动生成RSA文件，它将使用它们的名称来设置相应的系统变量（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-manual-using-mysql-ssl-rsa-setup"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用mysql_ssl_rsa_setup手动生成SSL和RSA文件</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL发行版包含一个</font><font style="vertical-align: inherit;">可以手动调用以生成SSL和RSA文件</font><font style="vertical-align: inherit;">的
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序。</font><font style="vertical-align: inherit;">该实用程序包含在所有MySQL发行版中（不管是使用OpenSSL还是yaSSL编译），但它确实需要
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令可用。</font><font style="vertical-align: inherit;">有关使用说明，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.4.5节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 创建SSL / RSA文件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-ssl-and-rsa-file-characteristics"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL和RSA文件特征</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          由服务器或调用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动创建的SSL和RSA文件</font><font style="vertical-align: inherit;">具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              SSL和RSA密钥的大小为2048位。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              SSL CA证书是自签名的。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              SSL服务器和客户端证书使用</font></font><code class="literal">sha256WithRSAEncryption</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">签名算法</font><font style="vertical-align: inherit;">对CA证书和密钥进行
               </font><font style="vertical-align: inherit;">签名。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              SSL证书使用这些通用名称（CN）值和相应的证书类型（CA，服务器，客户端）：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca.pem：MySQL_Server_ </font></font><em class="replaceable"><code>suffix</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Auto_Generated_CA_Certificate</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
server-cert.pm：MySQL_Server_ </font></font><em class="replaceable"><code>suffix</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Auto_Generated_Server_Certificate</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
client-cert.pm：MySQL_Server_ </font></font><em class="replaceable"><code>suffix</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Auto_Generated_Client_Certificate
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><em class="replaceable"><code>suffix</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值基于MySQL版本号。</font><font style="vertical-align: inherit;">对于由</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的文件
               </font><font style="vertical-align: inherit;">，可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_ssl_rsa_setup_suffix"><code class="option">--suffix</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选项</font><font style="vertical-align: inherit;">明确指定后缀
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于由服务器生成的文件，如果生成的CN值超过64个字符，</font><font style="vertical-align: inherit;">
              名称</font><font style="vertical-align: inherit;">的
               </font><font style="vertical-align: inherit;">部分被省略。
            </font></font><code class="literal">_<em class="replaceable"><code>suffix</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              SSL文件对于国家（C），州或省（ST），组织（O），组织单位名称（OU）和电子邮件地址具有空白值。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由服务器或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的SSL文件
               </font><font style="vertical-align: inherit;">从生成时起有效期为十年。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              RSA文件不会过期。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              SSL文件对于每个证书/密钥对具有不同的序列号（1个用于CA，2个用于服务器，3个用于客户端）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由服务器自动创建的文件属于运行服务器的帐户。</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的文件
               </font><font style="vertical-align: inherit;">由调用该程序的用户拥有。</font></font><code class="literal">chown()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果程序被调用，那么</font><font style="vertical-align: inherit;">可以在支持</font><font style="vertical-align: inherit;">系统调用</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">系统</font><font style="vertical-align: inherit;">上更改</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_ssl_rsa_setup_uid"><code class="option">--uid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选项</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">并且该</font><font style="vertical-align: inherit;">选项用于指定应拥有文件的用户。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在Unix和类Unix系统上，证书文件的文件访问模式为644（即世界可读），密钥文件为600（即只能由运行服务器的帐户访问）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要查看SSL证书的内容（例如，检查它的有效日期范围），请</font><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">调用
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl x509 -text -in ca.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl x509 -text -in server-cert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl x509 -text -in client-cert.pem</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          也可以使用此SQL语句检查SSL证书过期信息：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW STATUS LIKE 'Ssl_server_not%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------------------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------------------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Ssl_server_not_after | </font><font style="vertical-align: inherit;">4月28日14:16:39 2027 GMT |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Ssl_server_not_before | </font><font style="vertical-align: inherit;">5月1日14:16:39 2017年GMT |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------------------------- -  +</font></font><font></font>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-ssl-files-using-openssl"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3.2创建SSL证书和密钥使用openssl</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何使用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        命令设置供MySQL服务器和客户端使用的SSL证书和密钥文件。</font><font style="vertical-align: inherit;">第一个示例显示了一个简化的过程，例如您可以从命令行使用该过程。</font><font style="vertical-align: inherit;">第二个显示了一个包含更多细节的脚本。</font><font style="vertical-align: inherit;">前两个示例旨在用于Unix，都使用
         </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenSSL中的openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">第三个例子描述了如何在Windows上设置SSL文件。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          生成SSL所需的文件比这里描述的过程更容易：让服务器自动生成它们或使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql" title="6.4.3.1使用MySQL创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3.1节“使用MySQL创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          无论您使用哪种方法生成证书和密钥文件，用于服务器和客户端证书/密钥的通用名称值都必须与用于CA证书的通用名称值不同。</font><font style="vertical-align: inherit;">否则，证书和密钥文件将不适用于使用OpenSSL编译的服务器。</font><font style="vertical-align: inherit;">这种情况下的典型错误是：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误2026（HY000）：SSL连接错误：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误：00000001：LIB（0）：函数（0）：原因（1）</font></font><font></font>
</pre>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-files-using-openssl-unix-command-line" title="示例1：在Unix上从命令行创建SSL文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例1：在Unix上从命令行创建SSL文件</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-files-using-openssl-unix-script" title="示例2：在Unix上使用脚本创建SSL文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2：在Unix上使用脚本创建SSL文件</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-files-using-openssl-windows" title="示例3：在Windows上创建SSL文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例3：在Windows上创建SSL文件</font></font></a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-files-using-openssl-unix-command-line"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例1：在Unix上从命令行创建SSL文件</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下示例显示了一组用于创建MySQL服务器和客户端证书以及密钥文件的命令。</font><font style="vertical-align: inherit;">您将需要通过</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          命令</font><font style="vertical-align: inherit;">响应多个提示</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要生成测试文件，您可以按Enter键进行所有提示。</font><font style="vertical-align: inherit;">要生成供生产使用的文件，您应该提供非空的响应。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃创建干净的环境</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rm -rf newcerts</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mkdir newcerts &amp;&amp; cd newcerts</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建CA证书</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl genrsa 2048&gt; ca-key.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl req -new -x509 -nodes -days 3600 \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        -key ca-key.pem -out ca.pem</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建服务器证书，删除密码并签名</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃server-cert.pem =公钥，server-key.pem =私钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl req -newkey rsa：2048-days 3600 \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        -nodes -keyout server-key.pem -out server-req.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl rsa -in服务器密钥.pem -out服务器密钥.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl x509 -req -in server-req.pem -days 3600 \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建客户端证书，删除密码并签名</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃client-cert.pem =公钥，client-key.pem =私钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl req -newkey rsa：2048-days 3600 \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        -nodes -keyout client-key.pem -out client-req.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl rsa -in client-key.pem -out client-key.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl x509 -req -in client-req.pem -days 3600 \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out client-cert.pem</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          生成证书后，验证它们：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl验证-CA文件ca.pem server-cert.pem client-cert.pem
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          你应该看到这样的回应：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server-cert.pem：好的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
client-cert.pem：好的</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要查看证书的内容（例如，检查证书有效的日期范围），请</font><font style="vertical-align: inherit;">像这样</font><font style="vertical-align: inherit;">调用
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl x509 -text -in ca.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl x509 -text -in server-cert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl x509 -text -in client-cert.pem</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在你有一组文件可以使用，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">ca.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：将其用作</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端和客户端</font><font style="vertical-align: inherit;">的参数
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（如果使用的话，CA证书必须两侧相同。）
            </font></font></p></li><li class="listitem"><p>
              <code class="filename">server-cert.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="filename">server-key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：使用这些作为参数</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ，并</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器端。
            </font></font></p></li><li class="listitem"><p>
              <code class="filename">client-cert.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="filename">client-key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：使用这些作为参数</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ，并</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在客户端。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关其他用法说明，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-files-using-openssl-unix-script"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2：在Unix上使用脚本创建SSL文件</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下是一个示例脚本，显示如何为MySQL设置SSL证书和密钥文件。</font><font style="vertical-align: inherit;">执行脚本后，按</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，使用SSL连接文件
           </font><font style="vertical-align: inherit;">。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIR =`pwd` / OpenSSL的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PRIV = $ DIR /私有</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mkdir $ DIR $ PRIV $ DIR / newcerts</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cp /usr/share/ssl/openssl.cnf $ DIR</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
替换./demoCA $ DIR  -  $ DIR / openssl.cnf</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建必要的文件：$ database，$ serial和$ new_certs_dir</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃目录（可选）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
触摸$ DIR / index.txt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo“01”&gt; $ DIR / serial</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃生成证书颁发机构（CA）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl req -new -x509 -keyout $ PRIV / cakey.pem -out $ DIR / ca.pem \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    -days 3600 -config $ DIR / openssl.cnf</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃示例输出：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃使用/home/finley/openssl/openssl.cnf中的配置</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃生成一个1024位的RSA私钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃................ ++++++</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃......... ++++++</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃将新私钥写入'/home/finley/openssl/private/cakey.pem'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃验证密码 - 输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃-----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃你将被要求输入信息</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃纳入您的证书申请。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃你要输入的是所谓的专有名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃或一个DN。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃有相当多的领域，但你可以留下一些空白</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃对于某些字段会有一个默认值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃如果输入'。'，该字段将留空。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃-----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃国名（2字母代码）[AU]：FI</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃州或省名称（全名）[某国] :.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃地点名称（例如城市）[]：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃组织名称（例如公司）[Internet Widgits Pty Ltd]：MySQL AB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃组织单位名称（例如，部分）[]：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃通用名称（例如，你的名字）[]：MySQL管理员</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃ 电子邮件地址 []：</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建服务器请求和密钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl req -new -keyout $ DIR / server-key.pem -out \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    $ DIR / server-req.pem -days 3600 -config $ DIR / openssl.cnf</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃示例输出：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃使用/home/finley/openssl/openssl.cnf中的配置</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃生成一个1024位的RSA私钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃.. ++++++</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃.......... ++++++</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃将新私钥写入'/home/finley/openssl/server-key.pem'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃验证密码 - 输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃-----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃你将被要求输入信息</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃纳入您的证书申请。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃你要输入的是所谓的专有名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃或一个DN。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃有相当多的领域，但你可以留下一些空白</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃对于某些字段会有一个默认值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃如果输入'。'，该字段将留空。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃-----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃国名（2字母代码）[AU]：FI</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃州或省名称（全名）[某国] :.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃地点名称（例如城市）[]：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃组织名称（例如公司）[Internet Widgits Pty Ltd]：MySQL AB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃组织单位名称（例如，部分）[]：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃通用名称（例如，你的名字）[]：MySQL服务器</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃ 电子邮件地址 []：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃请输入以下'额外'属性</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃与您的证书请求一起发送</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃挑战密码[]：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃可选公司名称[]：</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃从密钥中删除密码</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl rsa -in $ DIR / server-key.pem -out $ DIR / server-key.pem</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃签署服务器证书</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl ca -cert $ DIR / ca.pem -policy policy_anything \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    -out $ DIR / server-cert.pem -config $ DIR / openssl.cnf \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    -infiles $ DIR / server-req.pem</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃示例输出：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃使用/home/finley/openssl/openssl.cnf中的配置</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃检查请求是否与签名匹配</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃签名确定</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃主题专有名称如下</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃countryName：PRINTABLE：'FI'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃organizationName：PRINTABLE：'MySQL AB'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃commonName：PRINTABLE：'MySQL管理员'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃证书直到9月13日14:22:46 2003 GMT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃（365天）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃签署证书？</font><font style="vertical-align: inherit;">[Y / N]：Y</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1证书请求中有1证书认证，提交？</font><font style="vertical-align: inherit;">[Y / N  - ] Y</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃用1个新条目写出数据库</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃数据库已更新</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建客户端请求和密钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl req -new -keyout $ DIR / client-key.pem -out \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    $ DIR / client-req.pem -days 3600 -config $ DIR / openssl.cnf</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃示例输出：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃使用/home/finley/openssl/openssl.cnf中的配置</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃生成一个1024位的RSA私钥</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃..................................... ++++++</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃............................................. ++++ ++</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃将新私钥写入'/home/finley/openssl/client-key.pem'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃验证密码 - 输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃-----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃你将被要求输入信息</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃纳入您的证书申请。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃你要输入的是所谓的专有名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃或一个DN。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃有相当多的领域，但你可以留下一些空白</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃对于某些字段会有一个默认值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃如果输入'。'，该字段将留空。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃-----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃国名（2字母代码）[AU]：FI</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃州或省名称（全名）[某国] :.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃地点名称（例如城市）[]：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃组织名称（例如公司）[Internet Widgits Pty Ltd]：MySQL AB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃组织单位名称（例如，部分）[]：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃通用名称（例如，你的名字）[]：MySQL用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃ 电子邮件地址 []：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃请输入以下'额外'属性</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃与您的证书请求一起发送</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃挑战密码[]：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃可选公司名称[]：</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃从密钥中删除密码</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl rsa -in $ DIR / client-key.pem -out $ DIR / client-key.pem</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃签署客户证书</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl ca -cert $ DIR / ca.pem -policy policy_anything \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    -out $ DIR / client-cert.pem -config $ DIR / openssl.cnf \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    -infiles $ DIR / client-req.pem</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃示例输出：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃使用/home/finley/openssl/openssl.cnf中的配置</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃检查请求是否与签名匹配</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃签名确定</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃主题专有名称如下</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃countryName：PRINTABLE：'FI'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃organizationName：PRINTABLE：'MySQL AB'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃commonName：PRINTABLE：'MySQL用户'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃证书将被认证至9月13日16:45:17 2003 GMT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃（365天）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃签署证书？</font><font style="vertical-align: inherit;">[Y / N]：Y</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1证书请求中有1证书认证，提交？</font><font style="vertical-align: inherit;">[Y / N  - ] Y</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃用1个新条目写出数据库</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃数据库已更新</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建一个my.cnf文件，您可以使用它来测试证书</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cat &lt;&lt; EOF&gt; $ DIR / my.cnf</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[客户]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL-CA = $ DIR / ca.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL证书= $ DIR /客户cert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL密钥= $ DIR /客户key.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL-CA = $ DIR / ca.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL证书= $ DIR /服务器cert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL密钥= $ DIR /服务器key.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EOF</font></font><font></font>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-files-using-openssl-windows"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例3：在Windows上创建SSL文件</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果未安装在您的系统上，请下载OpenSSL for Windows。</font><font style="vertical-align: inherit;">这里可以看到可用软件包的概述：
        </font></font></p><pre data-lang="ini" class="programlisting"><a class="ulink" href="http://www.slproweb.com/products/Win32OpenSSL.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.slproweb.com/products/Win32OpenSSL.html</font></font></a>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          根据您的体系结构（32位或64位）选择Win32 OpenSSL Light或Win64 OpenSSL Light软件包。</font><font style="vertical-align: inherit;">默认安装位置将为
           </font></font><code class="literal">C:\OpenSSL-Win32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><code class="literal">C:\OpenSSL-Win64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，取决于您下载的包。</font><font style="vertical-align: inherit;">以下说明假设默认位置为</font></font><code class="literal">C:\OpenSSL-Win32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您使用的是64位软件包，请根据需要进行修改。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果在安装过程中出现消息
           </font></font><code class="literal">'...critical component is missing: Microsoft Visual
          C++ 2008 Redistributables'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请取消安装并下载以下软件包之一，具体取决于您的体系结构（32位或64位）：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Visual C ++ 2008 Redistributables（x86），可在以下位置获得：
            </font></font></p><pre data-lang="ini" class="programlisting"><a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF</font></font></a>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Visual C ++ 2008 Redistributables（x64），可在以下位置获得：
            </font></font></p><pre data-lang="ini" class="programlisting"><a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6</font></font></a>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          安装附加软件包后，重新启动OpenSSL安装程序。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在安装过程中，保留缺省值
           </font></font><code class="filename">C:\OpenSSL-Win32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为安装路径，同时保留默认选项</font></font><code class="literal">'Copy OpenSSL DLL files
          to the Windows system directory'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          安装完成后，添加
           </font></font><code class="filename">C:\OpenSSL-Win32\bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到服务器的Windows系统路径变量中（取决于您的Windows版本，以下路径设置说明可能略有不同）：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在Windows桌面上，右键单击</font></font><span class="guiicon"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的电脑</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图标，然后选择
               </font></font><span class="guimenuitem"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从出现的</font><span class="guimenu"><font style="vertical-align: inherit;">系统属性</font></span><font style="vertical-align: inherit;">菜单中</font><font style="vertical-align: inherit;">
              选择</font></font><span class="guimenuitem"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡</font><font style="vertical-align: inherit;">，然后单击</font><span class="guibutton"><font style="vertical-align: inherit;">环境变量</font></span><font style="vertical-align: inherit;">按钮。
            </font></font><span class="guimenu"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font><span class="guibutton"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在</font></font><span class="guilabel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量下</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，选择
               </font></font><span class="guimenuitem"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后单击
               </font></font><span class="guibutton"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编辑</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮。</font><font style="vertical-align: inherit;">在</font></font><span class="guimenu"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编辑系统变量</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对话框应该会出现。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              添加</font></font><code class="literal">';C:\OpenSSL-Win32\bin'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到最后（注意分号）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              按OK 3次。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过打开一个新的命令控制台（</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始&gt;运行&gt; cmd.exe</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并验证OpenSSL是否可用，检查OpenSSL是否</font><font style="vertical-align: inherit;">已正确集成到Path变量中</font><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本...]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
版权所有（c）2006 Microsoft Corporation。</font><font style="vertical-align: inherit;">版权所有。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C：\ Windows \ System32下&gt;</font></font><strong class="userinput"><code>cd \</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C：\&gt; </font></font><strong class="userinput"><code>openssl</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenSSL&gt; </font></font><strong class="userinput"><code>exit</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt;&lt;如果看到OpenSSL提示，安装成功。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C：\&gt;</font></font><font></font>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          安装OpenSSL之后，使用类似于示例1（本节前面所示）的说明，并进行以下更改：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              更改以下Unix命令：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃创建干净的环境</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rm -rf newcerts</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mkdir newcerts &amp;&amp; cd newcerts</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在Windows上，请改用这些命令：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃创建干净的环境</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
md c：\ newcerts</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cd c：\ newcerts</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当</font></font><code class="literal">'\'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在命令行末尾显示一个</font></font><code class="literal">'\'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              字符时，必须删除</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">字符，并将命令行全部输入到一行中。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          生成证书和密钥文件后，要将它们用于SSL连接，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-rsa-files-using-openssl"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.3.3使用openssl创建RSA密钥</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何使用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        命令设置RSA密钥文件，以使MySQL支持通过</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插件</font><font style="vertical-align: inherit;">验证帐户的未加密连接进行安全密码交换</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          生成RSA所需文件比这里描述的过程更容易：让服务器自动生成它们或使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-ssl-rsa-setup" title="4.4.5 mysql_ssl_rsa_setup  - 创建SSL / RSA文件"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_ssl_rsa_setup</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql" title="6.4.3.1使用MySQL创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3.1节“使用MySQL创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要创建RSA专用和公用密钥对文件，请在登录到用于运行MySQL服务器的系统帐户时运行这些命令，以使这些文件由该帐户拥有：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl genrsa -out private_key.pem 2048</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openssl rsa -in private_key.pem -pubout -out public_key.pem</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些命令创建2,048位密钥。</font><font style="vertical-align: inherit;">要创建更强大的按键，请使用较大的值。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        然后设置密钥文件的访问模式。</font><font style="vertical-align: inherit;">私钥只能由服务器读取，而公钥可以自由分发给客户端用户：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chmod 400 private_key.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chmod 444 public_key.pem</font></font><font></font>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="ssl-libraries"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.4 OpenSSL与yaSSL</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116957232"></a><a class="indexterm" name="idm140528116955808"></a><a class="indexterm" name="idm140528116954320"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可以使用OpenSSL或yaSSL编译MySQL，这两者都可以基于OpenSSL API实现加密连接：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业版二进制分发版使用OpenSSL进行编译。</font><font style="vertical-align: inherit;">MySQL企业版不能使用yaSSL。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL社区版二进制发行版使用yaSSL进行编译。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL Community Edition源代码发行版可以使用OpenSSL或yaSSL进行编译（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#building-with-encrypted-connection-support" title="6.4.5构建支持加密连接的MySQL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.5节“使用支持加密连接构建MySQL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      OpenSSL和yaSSL提供了相同的基本功能，但使用OpenSSL编译的MySQL发行版具有其他功能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          OpenSSL支持TLSv1，TLSv1.1和TLSv1.2协议。</font><font style="vertical-align: inherit;">yaSSL仅支持TLSv1和TLSv1.1协议。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          OpenSSL支持更广泛的加密密码，从中选择该
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">OpenSSL的支持</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connection-options" title="6.4.2加密连接的命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.2节“加密连接的命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用该</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件进行</font><font style="vertical-align: inherit;">身份验证的帐户
           </font><font style="vertical-align: inherit;">可以使用RSA密钥文件通过未加密的连接进行安全密码交换。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#sha256-pluggable-authentication" title="6.5.1.4 SHA-256可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.4节“SHA-256可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器可以在启动时自动生成缺失的SSL和RSA证书和密钥文件。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files-using-mysql" title="6.4.3.1使用MySQL创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3.1节“使用MySQL创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          OpenSSL支持更多的加密模式
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_aes-encrypt"><code class="literal">AES_ENCRYPT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_aes-decrypt"><code class="literal">AES_DECRYPT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#encryption-functions" title="12.13加密和压缩函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.13节“加密和压缩函数”</font></font></a>
</p></li></ul>
</div>
<a class="indexterm" name="idm140528116932848"></a><a class="indexterm" name="idm140528116931392"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      只有在使用OpenSSL编译MySQL时，才会出现某些与OpenSSL相关的系统和状态变量：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_auto_generate_certs"><code class="literal">auto_generate_certs</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要确定服务器是否使用OpenSSL进行编译，请测试任何这些变量的存在。</font><font style="vertical-align: inherit;">例如，如果使用OpenSSL，则此语句返回一行，如果使用了yaSSL，则返回空结果：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW STATUS LIKE'Rsa_public_key';
</font></font></pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="building-with-encrypted-connection-support"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.5构建支持加密连接的MySQL</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116916032"></a><a class="indexterm" name="idm140528116914544"></a><a class="indexterm" name="idm140528116913088"></a><a class="indexterm" name="idm140528116912016"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要使用MySQL服务器和客户端程序之间的加密连接，您的系统必须支持OpenSSL或yaSSL：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业版二进制分发版使用OpenSSL进行编译。</font><font style="vertical-align: inherit;">MySQL企业版不能使用yaSSL。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL社区版二进制发行版使用yaSSL进行编译。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL Community Edition源代码发行版可以使用OpenSSL或yaSSL进行编译。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果你从一个源代码发行版编译MySQL </font><font style="vertical-align: inherit;">，默认情况下</font><font style="vertical-align: inherit;">，
       </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置发行版使用yaSSL。</font><font style="vertical-align: inherit;">要使用OpenSSL进行编译，请使用以下过程：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          确保您的系统上安装了OpenSSL 1.0.1或更高版本。</font><font style="vertical-align: inherit;">如果安装的OpenSSL版本低于1.0.1，则
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会在MySQL配置时产生错误。</font><font style="vertical-align: inherit;">如果需要获得OpenSSL，请访问</font></font><a class="ulink" href="http://www.openssl.org/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.openssl.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font><span class="command"><strong><font style="vertical-align: inherit;">CMake的</font></strong></span><font style="vertical-align: inherit;">选项确定为编译MySQL使用的SSL库（参见
           </font><a class="xref" href="/mysql-5.7-google-zh/installing.html#source-configuration-options" title="2.9.4 MySQL源配置选项"><font style="vertical-align: inherit;">第2.9.4“MySQL的源代码，配置选项”</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">默认是</font><font style="vertical-align: inherit;">，它使用yaSSL。</font><font style="vertical-align: inherit;">要使用OpenSSL，请将</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">添加
           </font><font style="vertical-align: inherit;">到</font><font style="vertical-align: inherit;">通常用于配置MySQL源代码分发</font><font style="vertical-align: inherit;">的
           </font><span class="command"><strong><font style="vertical-align: inherit;">CMake</font></strong></span><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">例如：
        </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_with_ssl"><code class="option">WITH_SSL</code></a>
          <span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#source-configuration-options" title="2.9.4 MySQL源配置选项"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_with_ssl"><code class="option">-DWITH_SSL=bundled</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_with_ssl"><code class="option">-DWITH_SSL=system</code></a><font style="vertical-align: inherit;"></font><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake。</font><font style="vertical-align: inherit;">-DWITH_SSL =系统
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该命令将分发配置为使用已安装的OpenSSL库。</font><font style="vertical-align: inherit;">或者，要显式指定OpenSSL安装的路径名称，请使用以下语法。</font><font style="vertical-align: inherit;">如果您安装了多个版本的OpenSSL，这可能很有用，以防止</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择错误的版本：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake。</font><font style="vertical-align: inherit;">-DWITH_SSL =</font></font><em class="replaceable"><code>path_name</code></em>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          编译并安装该分发。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要检查一个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font><font style="vertical-align: inherit;">是否</font><font style="vertical-align: inherit;">支持加密连接，请检查</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_have_ssl"><code class="literal">have_ssl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'have_ssl';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">have_ssl | </font><font style="vertical-align: inherit;">是|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果值是</font></font><code class="literal">YES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则服务器支持加密连接。</font><font style="vertical-align: inherit;">如果值为
       </font></font><code class="literal">DISABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则服务器能够支持加密连接，但未</font><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">相应
       </font><font style="vertical-align: inherit;">选项以启用加密连接; </font><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></a><font style="vertical-align: inherit;">。
    </font></font><code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要确定服务器是使用OpenSSL还是yaSSL编译的，请检查是否存在仅存在于OpenSSL中的任何系统或状态变量。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ssl-libraries" title="6.4.4 OpenSSL与yaSSL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.4节“OpenSSL与yaSSL”</font></font></a>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="encrypted-connection-protocols-ciphers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.6加密的连接协议和密码</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要确定哪个加密协议和密码用于加密连接，请使用以下语句来检查</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Ssl_version"><code class="literal">Ssl_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Ssl_cipher"><code class="literal">Ssl_cipher</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量的值：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW SESSION STATUS LIKE 'Ssl_version';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Ssl_version | </font><font style="vertical-align: inherit;">TLSv1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW SESSION STATUS LIKE 'Ssl_cipher';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + --------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + --------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Ssl_cipher | </font><font style="vertical-align: inherit;">DHE-RSA-AES128-GCM-SHA256 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + --------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果连接未加密，则两个变量都有一个空值。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL支持使用TLS协议的加密连接：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用OpenSSL 1.0.1或更高版本进行编译时，MySQL支持TLSv1，TLSv1.1和TLSv1.2协议。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用捆绑版本的yaSSL进行编译时，MySQL支持TLSv1和TLSv1.1协议。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      系统变量</font><font style="vertical-align: inherit;">
      的值</font><font style="vertical-align: inherit;">决定哪些协议允许服务器使用那些可用的协议。</font><font style="vertical-align: inherit;">该
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是一个逗号分隔的列表，其中包含一个或多个这些协议（不区分大小写）：TLSv1，TLSv1.1，TLSv1.2。</font><font style="vertical-align: inherit;">默认情况下，此变量列出用于编译MySQL的SSL库支持的所有协议（</font></font><code class="literal">TLSv1,TLSv1.1,TLSv1.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于OpenSSL，</font></font><code class="literal">TLSv1,TLSv1.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于yaSSL）。</font><font style="vertical-align: inherit;">要确定</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">，请使用以下语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW GLOBAL VARIABLES LIKE 'tls_version';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ----------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ----------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">tls_version | </font><font style="vertical-align: inherit;">TLSv1，TLSv1.1，TLSv1.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ----------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要更改该值
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请在服务器启动时进行设置。</font><font style="vertical-align: inherit;">例如，要禁止使用安全性较低的TLSv1协议的连接，请在服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用以下行
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tls_version = TLSv1.1，TLSv1.2工作</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了进一步限制并允许仅允许TLSv1.2连接，请</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像这样</font><font style="vertical-align: inherit;">设置
       </font><font style="vertical-align: inherit;">（假设您的服务器使用OpenSSL进行编译，因为yaSSL不支持TLSv1.2）：
    </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tls_version = TLSv1.2工作</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于客户端程序，该
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_tls-version"><code class="option">--tls-version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项可以指定每个客户端调用允许的TLS协议。</font><font style="vertical-align: inherit;">值格式与for相同
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      默认情况下，MySQL会尝试使用可用的最高TLS协议版本，具体取决于使用哪个SSL库来编译服务器和客户端，使用哪种密钥大小以及服务器或客户端是否受限于使用某些协议; </font><font style="vertical-align: inherit;">例如，借助于
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_tls-version"><code class="option">--tls-version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果使用OpenSSL编译服务器和客户端，则尽可能使用TLSv1.2。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果使用yaSSL编译服务器和客户端中的一个或两个，则尽可能使用TLSv1.1。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          TLSv1.2不适用于所有密钥大小为512位或更少的密码。</font><font style="vertical-align: inherit;">要将此协议与此密钥一起使用，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以明确指定密码名称：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES256-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CAMELLIA128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CAMELLIA256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DES-CBC3-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RC4，MD5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RC4-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SEED-SHA</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了获得更好的安全性，请使用RSA密钥长度至少为2048位的证书。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7.10之前，MySQL仅支持用于OpenSSL和yaSSL的TLSv1，并且不存在用于指定允许哪些TLS协议的系统变量或客户机选项。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果服务器和客户端协议功能没有共同的协议，则服务器终止连接请求。</font><font style="vertical-align: inherit;">例如，如果服务器配置
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tls_version"><code class="literal">tls_version=TLSv1.1,TLSv1.2</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_tls-version"><code class="option">--tls-version=TLSv1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，对于不支持该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_general_tls-version"><code class="option">--tls-version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项的</font><font style="vertical-align: inherit;">客户端
       </font><font style="vertical-align: inherit;">以及仅隐式支持TLSv1的</font><font style="vertical-align: inherit;">客户端，连接尝试将失败
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要确定给定服务器支持的密码，请使用以下语句来检查</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Ssl_cipher_list"><code class="literal">Ssl_cipher_list</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font><font style="vertical-align: inherit;">的值
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW SESSION STATUS LIKE'Ssl_cipher_list';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可用密码集取决于您的MySQL版本，以及MySQL是使用OpenSSL还是yaSSL编译的，以及（对于OpenSSL）用于编译MySQL的库版本。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从MySQL 5.7.10开始，MySQL传递给SSL库的密码顺序非常重要。</font><font style="vertical-align: inherit;">列表中首先提到更安全的密码，并选择所提供的证书支持的第一密码。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL将这个密码列表传递给OpenSSL：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECDHE-ECDSA-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-ECDSA-AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-RSA-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-RSA-AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-ECDSA-AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-RSA-AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-ECDSA-AES256-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-RSA-AES256-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-DSS-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-DSS-AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-DSS-AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES256-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-DSS-AES256-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-RSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-ECDSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-RSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-ECDSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-DSS-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TLS_DHE_DSS_WITH_AES_256_CBC_SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-DSS-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-ECDSA-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-DSS-AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-ECDSA-AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-DSS-AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-ECDSA-AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES256-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-DSS-AES256-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-ECDSA-AES256-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-DSS-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-ECDSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-DSS-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-ECDSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-RSA-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-RSA-AES128-GCM-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-RSA-AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-RSA-AES256-GCM-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-RSA-AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-RSA-AES128-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-RSA-AES256-SHA256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-RSA-AES256-SHA384</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-RSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-ECDSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-RSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDHE-ECDSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-DSS-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TLS_DHE_DSS_WITH_AES_256_CBC_SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-DSS-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-ECDSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-DSS-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-ECDSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-RSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-RSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DH-RSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECDH-RSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DES-CBC3-SHA</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL将这个密码列表传递给yaSSL：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHE-RSA-AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES128-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES128-RMD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DES-CBC3-RMD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES256-RMD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-AES128-RMD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DHE-RSA-DES-CBC3-RMD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES256-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RC4-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RC4，MD5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DES-CBC3-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DES-CBC-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EDH-RSA-DES-CBC3-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EDH-RSA-DES-CBC-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AES128-SHA：AES256-RMD</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从MySQL 5.7.10开始，这些密码限制已经到位：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下密码被永久限制：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！DHE-DSS-DES-CBC3-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！DHE-RSA-DES-CBC3-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！ECDH-RSA-DES-CBC3-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！ECDH-ECDSA-DES-CBC3-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！ECDHE-RSA-DES-CBC3-SHA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！ECDHE-ECDSA-DES-CBC3-SHA</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下类别的密码永久受限制：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！A零位</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！ENULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！出口</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！低</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！MD5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！DES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！RC2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！RC4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！PSK</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
！的SSLv3</font></font><font></font>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果服务器使用兼容证书启动，而该证书使用任何上述受限密码或密码类别，则服务器将启动禁用加密连接的支持。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="windows-and-ssh"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.7通过SSH从Windows远程连接到MySQL</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116826352"></a><a class="indexterm" name="idm140528116825344"></a><a class="indexterm" name="idm140528116823856"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何使用SSH获取到远程MySQL服务器的加密连接。</font><font style="vertical-align: inherit;">这些信息由David Carlson提供</font><font style="vertical-align: inherit;">。
</font></font><code class="email">&lt;<a class="email" href="mailto:dcarlson@mplcomm.com">dcarlson@mplcomm.com</a>&gt;</code><font style="vertical-align: inherit;"></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Windows机器上安装SSH客户端。</font><font style="vertical-align: inherit;">有关SSH客户端的比较，请参阅
           </font></font><a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          启动您的Windows SSH客户端。</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">
          登录到您的服务器。</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">值可能与您的MySQL帐户的用户名不同。
        </font></font><code class="literal">Host_Name =
          <em class="replaceable"><code>yourmysqlserver_URL_or_IP</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">userid=<em class="replaceable"><code>your_userid</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">userid</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置端口转发。</font><font style="vertical-align: inherit;">要么是遥控前进（设置
           </font></font><code class="literal">local_port: 3306</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">，
           </font><font style="vertical-align: inherit;">）或本地转发（设置
           </font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">）。
        </font></font><code class="literal">remote_host:
          <em class="replaceable"><code>yourmysqlservername_or_ip</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">remote_port: 3306</code><font style="vertical-align: inherit;"></font><code class="literal">port: 3306</code><font style="vertical-align: inherit;"></font><code class="literal">host:
          localhost</code><font style="vertical-align: inherit;"></font><code class="literal">remote port: 3306</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          保存所有内容，否则你将不得不在下次重做。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用刚刚创建的SSH会话登录到您的服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Windows机器上，启动一些ODBC应用程序（如Access）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Windows中创建一个新文件并使用ODBC驱动程序链接到MySQL，就像通常一样，除了输入
           </font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL主机服务器外，不是
           </font></font><em class="replaceable"><code>yourmysqlservername</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      此时，您应该有一个到MySQL的ODBC连接，使用SSH进行加密。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="security-plugins"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5安全插件</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#authentication-plugins"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1身份验证插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#connection-control"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.2连接控制插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#validate-password"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.3密码验证插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4 MySQL Keyring</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5 MySQL企业审计</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#firewall"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6 MySQL企业防火墙</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528116803632"></a><a class="indexterm" name="idm140528116802144"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL包含几个实现安全功能的插件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        用于验证客户端连接到MySQL服务器的尝试的插件。</font><font style="vertical-align: inherit;">插件可用于多种认证协议。</font><font style="vertical-align: inherit;">有关认证过程的一般性讨论，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关特定身份验证插件的特性，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#authentication-plugins" title="6.5.1身份验证插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1节“身份验证插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        用于实施密码强度策略并评估潜在密码强度的密码验证插件。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#validate-password" title="6.5.3密码验证插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.3节“密码验证插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥环插件，为敏感信息提供安全存储。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring" title="6.5.4 MySQL Keyring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4节“MySQL Keyring”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （仅适用于MySQL企业版）使用服务器插件实现的MySQL企业审计使用开放式MySQL审核API来启用在特定MySQL服务器上执行的标准的，基于策略的监视和记录连接和查询活动。</font><font style="vertical-align: inherit;">旨在满足Oracle审计规范的需求，MySQL企业审计为受内部和外部监管准则管理的应用程序提供了一款即装即用，易于使用的审计和合规性解决方案。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （仅适用于MySQL企业版）MySQL企业防火墙，一种应用程序级防火墙，支持数据库管理员根据与接受的语句模式的白名单进行匹配来允许或拒绝执行SQL语句。</font><font style="vertical-align: inherit;">这有助于强化MySQL服务器免受SQL注入等攻击，或尝试在合法查询工作负载特性之外使用它们。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="authentication-plugins"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1身份验证插件</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#native-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.1本地可插拔认证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#old-native-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.2旧本地可插拔认证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#account-upgrades"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.3从4.1之前的密码散列和mysql_old_password插件迁移</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#sha256-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.4 SHA-256可插入式验证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#cleartext-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.5客户端明文可插入认证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.6 PAM可插入式验证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#windows-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.7 Windows可插入验证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.8 LDAP可插入验证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#no-login-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.9无登录可插入认证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#socket-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.10套接字对等凭证可插拔认证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#test-pluggable-authentication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.11测试可插入认证</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#pluggable-authentication-system-variables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.12可插入的身份验证系统变量</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下各节描述了MySQL中可用的可插入身份验证方法以及实现这些方法的插件。</font><font style="vertical-align: inherit;">有关认证过程的一般性讨论，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      默认插件由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_authentication_plugin"><code class="literal">default_authentication_plugin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      系统变量</font><font style="vertical-align: inherit;">的值指示
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="native-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.1本地可插拔认证</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528116786320"></a><a class="indexterm" name="idm140528116785216"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL包含两个实现本地认证的插件; </font><font style="vertical-align: inherit;">即在引入可插入认证之前基于使用的密码散列方法的认证。</font><font style="vertical-align: inherit;">本部分描述</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用本机密码散列方法</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">表进行</font><font style="vertical-align: inherit;">身份验证的情况
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用旧（4.1之前）本机密码散列方法实现认证的</font><font style="vertical-align: inherit;">信息
         </font><font style="vertical-align: inherit;">，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#old-native-pluggable-authentication" title="6.5.1.2旧本地可插拔认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.2节“旧本机可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关这些密码哈希方法的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-hashing" title="6.1.2.4 MySQL中的密码散列"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.4节“MySQL中的密码哈希”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了服务器和客户端的插件名称。
</font></font></p>
<div class="table">
<a name="idm140528116778752"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.9本机密码认证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for native password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><code class="literal">mysql_native_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><code class="literal">mysql_native_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无（插件内置）</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下部分提供特定于本机可插入验证的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#native-pluggable-authentication-installation" title="安装本地可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装本地可插入身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#native-pluggable-authentication-usage" title="使用本地可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用本地可插入身份验证</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="native-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装本地可插入身份验证</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件以服务器和客户端的形式存在：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器端插件内置到服务器中，不需要显式加载，也不能通过卸载来禁用它。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              客户端插件内置于
               </font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端库中，可供任何链接的程序使用
               </font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="native-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用本地可插入身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL客户端程序</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font><font style="vertical-align: inherit;">使用
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_default-auth"><code class="option">--default-auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项可以用作提示程序可以使用哪个客户端插件的提示：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql --default-auth=mysql_native_password ...</code></strong>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="old-native-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.2旧本地可插拔认证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116747648"></a><a class="indexterm" name="idm140528116746544"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL包含两个实现本地认证的插件; </font><font style="vertical-align: inherit;">即在引入可插入认证之前基于使用的密码散列方法的认证。</font><font style="vertical-align: inherit;">本节描述</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用旧的（4.1之前的）本机密码散列方法</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">表进行</font><font style="vertical-align: inherit;">身份验证的情况
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用本机密码散列方法实现认证的</font><font style="vertical-align: inherit;">信息
         </font><font style="vertical-align: inherit;">，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#native-pluggable-authentication" title="6.5.1.1本地可插拔认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.1节“本机可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关这些密码哈希方法的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-hashing" title="6.1.2.4 MySQL中的密码散列"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.4节“MySQL中的密码哈希”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用4.1以前的哈希方法的密码比使用本机密码散列方法并应避免的密码的安全性要低。</font><font style="vertical-align: inherit;">4.1之前的密码被弃用，并且</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL 5.7.5中删除了</font><font style="vertical-align: inherit;">对它们的支持（包括
           </font><font style="vertical-align: inherit;">插件）。</font><font style="vertical-align: inherit;">有关帐户升级说明，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#account-upgrades" title="6.5.1.3从4.1之前的密码散列和mysql_old_password插件迁移"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.3节“从4.1之前的密码散列和mysql_old_password插件迁移”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了服务器和客户端的插件名称。
</font></font></p>
<div class="table">
<a name="idm140528116737568"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.10旧本机密码身份验证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for old native password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><code class="literal">mysql_old_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><code class="literal">mysql_old_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无（插件内置）</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下部分提供了特定于旧的本地可插入验证的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#old-native-pluggable-authentication-installation" title="安装旧的本地可插拔认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装旧的本地可插拔认证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#old-native-pluggable-authentication-usage" title="使用旧的本地可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用旧的本地可插入身份验证</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="old-native-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装旧的本地可插拔认证</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件以服务器和客户端的形式存在：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器端插件内置到服务器中，不需要显式加载，也不能通过卸载来禁用它。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              客户端插件内置于
               </font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端库中，可供任何链接的程序使用
               </font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="old-native-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用旧的本地可插入身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL客户端程序可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_default-auth"><code class="option">--default-auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来指定</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件作为关于</font><font style="vertical-align: inherit;">程序可以使用
           </font><font style="vertical-align: inherit;">哪个客户端插件的提示：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql --default-auth=mysql_old_password ...</code></strong>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="account-upgrades"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.3从4.1之前的密码散列和mysql_old_password插件迁移</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL服务器</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">列中指定</font><font style="vertical-align: inherit;">的身份验证插件</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">列出的每个帐户的连接尝试进行</font><font style="vertical-align: inherit;">身份验证</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        。</font><font style="vertical-align: inherit;">如果该</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列为空，则服务器按以下方式对帐户进行身份验证：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7之前，服务器会</font><font style="vertical-align: inherit;">隐式</font><font style="vertical-align: inherit;">使用
             </font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，具体取决于</font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">密码哈希的格式
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果该
             </font></font><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为空或4.1密码哈希（41个字符），则服务器使用
             </font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果密码值是4.1之前的密码哈希（16个字符），则服务器使用</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（有关这些哈希格式的更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-hashing" title="6.1.2.4 MySQL中的密码散列"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.4节“MySQL中的密码哈希”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7开始，服务器要求该
             </font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列非空，并禁用具有空</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        4.1之前的密码哈希和
         </font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件在MySQL 5.6中已弃用，并且在MySQL 5.7中删除了对它们的支持。</font><font style="vertical-align: inherit;">它们提供的安全级别低于4.1密码散列和</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">提供的级别
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        鉴于MySQL 5.7中的要求，该
         </font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列必须是非空的，除去</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持，建议DBA升级账户如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            升级</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐式使用的</font><font style="vertical-align: inherit;">帐户
             </font><font style="vertical-align: inherit;">以明确使用它
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            升级使用</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（隐式或显式）</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            明确
 </font><font style="vertical-align: inherit;">使用的帐户
            </font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节中的说明介绍如何执行这些升级。</font><font style="vertical-align: inherit;">结果是没有帐户具有空
         </font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，并且没有帐户使用4.1之前的密码散列或</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插件。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        作为这些指令的一个变种，DBA可以为用户提供升级到</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插件</font><font style="vertical-align: inherit;">的选择，该</font><font style="vertical-align: inherit;">插件使用SHA-256密码散列进行认证。</font><font style="vertical-align: inherit;">有关此插件的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#sha256-pluggable-authentication" title="6.5.1.4 SHA-256可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.4节“SHA-256可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表列出了</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本次讨论中考虑</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">类型
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="informaltable">
<table summary="Characteristics of MySQL accounts and what must be done to upgrade them."><colgroup><col width="30%"><col width="20%"><col width="30%"><col width="20%"></colgroup><thead><tr>
            <th scope="col"><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 柱</font></font></th>
            <th scope="col"><code class="literal">Password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 柱</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认证结果</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级操作</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐含使用 </font></font><code class="literal">mysql_native_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定插件</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1哈希</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐含使用 </font></font><code class="literal">mysql_native_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定插件</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1之前的散列</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐含使用 </font></font><code class="literal">mysql_old_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配插件，重新密码</font></font></td>
          </tr><tr>
            <td scope="row"><code class="literal">mysql_native_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确使用 </font></font><code class="literal">mysql_native_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
          </tr><tr>
            <td scope="row"><code class="literal">mysql_native_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1哈希</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确使用 </font></font><code class="literal">mysql_native_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
          </tr><tr>
            <td scope="row"><code class="literal">mysql_old_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确使用 </font></font><code class="literal">mysql_old_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级插件</font></font></td>
          </tr><tr>
            <td scope="row"><code class="literal">mysql_old_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1之前的散列</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确使用 </font></font><code class="literal">mysql_old_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级插件，重新密码</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对应于</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">行的帐户
         </font><font style="vertical-align: inherit;">不需要升级操作（因为不需要更改插件或散列格式）。</font><font style="vertical-align: inherit;">对于与密码为空的行相对应的帐户，可考虑要求帐户所有者选择密码（或要求使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER
        USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过期的空帐户密码）。
</font></font></p>
<h5><a name="idm140528116632976"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将帐户从隐式升级到显式mysql_native_password使用</font></font></h5>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        具有空插件和4.1密码散列的帐户</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐式</font><font style="vertical-align: inherit;">使用
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要将这些帐户升级为</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        明确</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">，请执行以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE mysql.user SET plugin ='mysql_native_password'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE plugin =''AND（密码='或ORLENGTH（密码）= 41）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH PRIVILEGES;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7之前，您可以执行这些语句来主动升级帐户。</font><font style="vertical-align: inherit;">从MySQL 5.7开始，您可以运行
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它在其升级操作中执行相同的操作。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        笔记：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            刚刚描述的升级操作随时可以安全执行，因为它使
             </font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件仅针对已隐式使用它的帐户显式。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此操作不需要更改密码，因此可以在不影响用户或要求其参与升级过程的情况下执行此操作。
</font></font></p></li></ul>
</div>
<h5><a name="idm140528116623824"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将帐户从mysql_old_password升级到mysql_native_password</font></font></h5>
<p><font style="vertical-align: inherit;"></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该将</font><font style="vertical-align: inherit;">
        使用</font><font style="vertical-align: inherit;">（隐式或显式）</font><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">升级为</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确</font><font style="vertical-align: inherit;">使用
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这需要更改插件</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码从4.1之前更改为4.1哈希格式。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于此步骤中必须升级的帐户，其中一个条件是正确的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该帐户</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            隐式</font><font style="vertical-align: inherit;">使用，</font><font style="vertical-align: inherit;">因为该</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列为空，并且密码具有4.1之前的散列格式（16个字符）。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该帐户</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            明确</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要识别这些帐户，请使用以下查询：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择用户，主机，密码从mysql.user</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE（插件=''和长度（密码）= 16）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OR plugin ='mysql_old_password';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下讨论提供了更新该组帐户的两种方法。</font><font style="vertical-align: inherit;">它们具有不同的特征，所以请仔细阅读并决定哪一个最适合给定的MySQL安装。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法1。</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这种方法的特点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            它要求运行服务器和客户端，
             </font></font><code class="literal">secure_auth=0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直到所有用户都升级为止</font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（否则，为了升级到新格式的散列，用户无法使用其旧格式密码散列连接到服务器。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            它适用于MySQL 5.5和5.6。</font><font style="vertical-align: inherit;">在5.7中，它不起作用，因为服务器需要帐户有一个非空插件，否则禁用它们。</font><font style="vertical-align: inherit;">因此，如果您已经升级到5.7，请选择稍后介绍的方法2。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您应该确保服务器正在运行
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><code class="literal">mysql_old_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        明确</font><font style="vertical-align: inherit;">使用的所有帐户</font><font style="vertical-align: inherit;">，请将它们设置为空插件：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE mysql.user SET plugin =''</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE plugin ='mysql_old_password';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH PRIVILEGES;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了也使受影响账户的密码失效，请使用以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE mysql.user SET plugin =''，password_expired ='Y'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE plugin ='mysql_old_password';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH PRIVILEGES;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        现在受影响的用户可以重置密码以使用4.1哈希。</font><font style="vertical-align: inherit;">询问每个现在有空插件的用户连接到服务器并执行这些语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET old_passwords = 0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET PASSWORD = PASSWORD（' </font></font><em class="replaceable"><code>user-chosen-password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'）;
</font></font></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          客户端</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_secure-auth"><code class="option">--secure-auth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项在默认情况下</font><font style="vertical-align: inherit;">处于</font><font style="vertical-align: inherit;">启用状态，因此提醒用户禁用它，否则它们将无法连接：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -u <em class="replaceable"><code>user_name</code></em> -p --secure-auth=0</code></strong>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在受影响的用户执行完这些语句后，您可以设置相应的帐户插件以
         </font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确插件。</font><font style="vertical-align: inherit;">或者，您可以定期运行这些语句来查找和修复受影响的用户重置密码的任何帐户：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE mysql.user SET plugin ='mysql_native_password'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE plugin =''AND（密码='或ORLENGTH（密码）= 41）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH PRIVILEGES;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当没有更多的帐户使用空插件时，此查询返回空结果：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择用户，主机，密码从mysql.user</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE plugin =''AND LENGTH（Password）= 16;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此时，所有帐户都已经从4.1之前的密码散列中移除，并且服务器不再需要运行
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法2。</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这种方法的特点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            它会为每个受影响的帐户分配一个新密码，因此您必须告知每个此类用户新密码并要求用户选择一个新密码。</font><font style="vertical-align: inherit;">密码与用户的沟通超出了MySQL的范围，但应该谨慎对待。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            它不需要运行服务器或客户端
             </font></font><code class="literal">secure_auth=0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            它适用于任何版本的MySQL 5.5或更高版本（5.7版本有一个更简单的变体）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用此方法，由于需要单独设置密码，因此需要分别更新每个帐户。</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个帐户选择不同的密码。</font></font></em></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设这</font></font><code class="literal">'user1'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是要升级的帐户之一。</font><font style="vertical-align: inherit;">修改如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7中，</font></font><code class="literal">ALTER USER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了修改帐户密码及其身份验证插件的功能，因此您无需</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">修改
             </font><font style="vertical-align: inherit;">表格：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER USER'user1'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用mysql_native_password IDENTIFIED BY' </font></font><em class="replaceable"><code>DBA-chosen-password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了还过期帐户密码，请使用以下语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER USER'user1'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用mysql_native_password标识BY'</font></font><em class="replaceable"><code>DBA-chosen-password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PASSWORD EXPIRE;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            然后告诉用户新的密码并要求用户使用该密码连接到服务器并执行以下语句以选择一个新密码：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER USER USER（）IDENTIFIED BY' </font></font><em class="replaceable"><code>user-chosen-password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7之前，您必须</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下语句直接</font><font style="vertical-align: inherit;">修改
             </font><font style="vertical-align: inherit;">表：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET old_passwords = 0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE mysql.user SET plugin ='mysql_native_password'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
密码=密码（' </font></font><em class="replaceable"><code>DBA-chosen-password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE（User，Host）=（'user1'，'localhost'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH PRIVILEGES;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了还过期帐户密码，请使用以下语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET old_passwords = 0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE mysql.user SET plugin ='mysql_native_password'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
密码=密码（'</font></font><em class="replaceable"><code>DBA-chosen-password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '），密码表达式='Y'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE（User，Host）=（'user1'，'localhost'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH PRIVILEGES;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            然后告诉用户新的密码并要求用户使用该密码连接到服务器并执行以下语句以选择一个新密码：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET old_passwords = 0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET PASSWORD = PASSWORD（' </font></font><em class="replaceable"><code>user-chosen-password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'）;
</font></font></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        重复每个帐户升级。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sha256-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.4 SHA-256可插入式验证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116566336"></a><a class="indexterm" name="idm140528116565248"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL提供了一个认证插件，用于为用户帐户密码实现SHA-256散列。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用通过</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件进行</font><font style="vertical-align: inherit;">身份验证的帐户连接到服务器</font><font style="vertical-align: inherit;">，必须使用TLS连接或使用RSA密钥对支持密码交换的未加密连接，如本节后面所述。</font><font style="vertical-align: inherit;">无论哪种方式，
           </font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件使用MySQL的加密功能。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connections" title="6.4使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4节“使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了服务器和客户端的插件名称。
</font></font></p>
<div class="table">
<a name="idm140528116559488"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.11 SHA-256身份验证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for SHA-256 password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><code class="literal">sha256_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><code class="literal">sha256_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无（插件内置）</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下部分提供了特定于SHA-256可插入验证的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#sha256-pluggable-authentication-installation" title="安装SHA-256可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装SHA-256可插入验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#sha256-pluggable-authentication-usage" title="使用SHA-256可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用SHA-256可插入身份验证</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="sha256-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装SHA-256可插入验证</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件以服务器和客户端的形式存在：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器端插件内置到服务器中，不需要显式加载，也不能通过卸载来禁用它。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              客户端插件内置于
               </font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端库中，可供任何链接的程序使用
               </font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="sha256-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用SHA-256可插入身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要设置使用</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件进行SHA-256密码散列</font><font style="vertical-align: inherit;">的帐户，请使用
           </font><font style="vertical-align: inherit;">以下语句，其中
           </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是所需的帐户密码：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'sha256user'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用sha256_password BY'识别</font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器将该</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件</font><font style="vertical-align: inherit;">分配给</font><font style="vertical-align: inherit;">帐户，并使用它来使用SHA-256加密密码，将这些值存储
           </font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">系统表的</font><font style="vertical-align: inherit;">列</font></font><code class="literal">plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中
           </font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          前面的说明不认为这
           </font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是默认的身份验证插件。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          是默认身份验证插件，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则可以使用</font><font style="vertical-align: inherit;">更简单的
           </font><font style="vertical-align: inherit;">语法。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用默认身份验证插件设置为启动服务器</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请将这些行放在服务器选项文件中：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
default_authentication_plugin = sha256_password</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这会导致该</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件默认用于新帐户。</font><font style="vertical-align: inherit;">因此，可以创建帐户并设置其密码，而无需明确指定插件名称：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'sha256user'@'localhost'IDENTIFIED BY' </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_authentication_plugin"><code class="literal">default_authentication_plugin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为的</font><font style="vertical-align: inherit;">另一个结果
           </font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是，要使用其他插件创建帐户，您必须明确指定该插件。</font><font style="vertical-align: inherit;">例如，要使用该
           </font></font><code class="literal">mysql_native_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，请使用以下语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'nativeuser'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用mysql_native_password IDENTIFIED BY' </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以使用OpenSSL或yaSSL编译MySQL（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ssl-libraries" title="6.4.4 OpenSSL与yaSSL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.4节“OpenSSL与yaSSL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">该
           </font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件适用于使用任一软件包编译的发行版，但如果使用OpenSSL编译MySQL，则</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          支持使用RSA加密。</font><font style="vertical-align: inherit;">（要启用此功能，您必须遵循本节后面给出的RSA配置过程。）RSA支持具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              两个系统变量命名RSA专用和公用密钥对文件：
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果要使用的密钥文件的名称与系统变量缺省值不同，则数据库管理员必须在服务器启动时设置这些变量。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量来确定是否自动生成RSA密钥对文件。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files" title="6.4.3创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3节“创建SSL和RSA证书和密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              状态变量显示由使用的RSA公钥值</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认证插件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如后所述，拥有RSA公钥的客户端可以在连接过程中与服务器进行基于RSA密钥对的密码交换。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于使用</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于RSA公钥对的密码交换进行</font><font style="vertical-align: inherit;">身份验证的帐户进行连接
               </font><font style="vertical-align: inherit;">，服务器根据需要将RSA公钥发送给客户端。</font><font style="vertical-align: inherit;">但是，如果公钥的副本在客户端主机上可用，则客户端可以使用它来保存客户端/服务器协议中的往返行程：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  对于这些命令行客户端，使用该
                   </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  选项指定RSA公钥文件：
                   </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                   </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqltest</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  对于使用C API的程序，调用
                   </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-options" title="27.8.7.50 mysql_options（）"><code class="literal">mysql_options()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过传递</font></font><code class="literal">MYSQL_SERVER_PUBLIC_KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项和文件名称</font><font style="vertical-align: inherit;">来指定RSA公钥
                   </font><font style="vertical-align: inherit;">文件。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  对于复制从站，基于RSA密钥对的密码交换不能用于连接到用于与</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件进行</font><font style="vertical-align: inherit;">身份验证的帐户的主服务器
                   </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于这些帐户，只能使用安全连接。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于使用该</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件的</font><font style="vertical-align: inherit;">客户端，</font><font style="vertical-align: inherit;">连接到服务器时密码从不暴露为明文。</font><font style="vertical-align: inherit;">密码传输如何发生取决于是使用安全连接还是使用RSA加密：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果连接安全，则不需要使用RSA密钥对。</font><font style="vertical-align: inherit;">这适用于使用TLS的加密连接。</font><font style="vertical-align: inherit;">密码以明文形式发送，但由于连接安全，因此无法窥探。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果连接不安全，并且RSA密钥对可用，则连接保持未加密状态。</font><font style="vertical-align: inherit;">这适用于没有TLS的未加密连接。</font><font style="vertical-align: inherit;">RSA仅用于客户端和服务器之间的密码交换，以防止密码窥探。</font><font style="vertical-align: inherit;">当服务器收到加密的密码时，它解密它。</font><font style="vertical-align: inherit;">加密中使用争夺以防止重复攻击。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果未使用安全连接并且RSA加密不可用，则连接尝试失败，因为密码不能以明文形式公开。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如前所述，只有在使用OpenSSL编译MySQL时，RSA密码加密才可用。</font><font style="vertical-align: inherit;">使用yaSSL编译的MySQL发行版的含义是，要使用SHA-256密码，客户端</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用加密连接来访问服务器。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要使用RSA密码加密
             </font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，客户端和服务器都必须使用OpenSSL进行编译，而不仅仅是其中之一。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设MySQL已经使用OpenSSL进行编译，请使用以下过程在客户端连接过程中使用RSA密钥对进行密码交换：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#creating-ssl-rsa-files" title="6.4.3创建SSL和RSA证书和密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.3节“创建SSL和RSA证书和密钥”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的说明创建RSA专用和公用密钥对文件</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果私钥和公钥文件位于数据目录中并且被命名
               </font></font><code class="filename">private_key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
               </font></font><code class="filename">public_key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">的默认值
               </font><font style="vertical-align: inherit;">），则服务器在启动时自动使用它们。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              否则，要显式命名密钥文件，请将系统变量设置为服务器选项文件中的密钥文件名。</font><font style="vertical-align: inherit;">如果文件位于服务器数据目录中，则不需要指定完整的路径名称：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sha256_password_private_key_path = myprivkey.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sha256_password_public_key_path = mypubkey.pem</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果密钥文件不在数据目录中，或者在系统变量值中显示其位置，请使用完整路径名称：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sha256_password_private_key_path =的/ usr /本地/ MySQL的/ myprivkey.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sha256_password_public_key_path =的/ usr /本地/ MySQL的/ mypubkey.pem</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              重新启动服务器，然后连接到它并检查
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量值。</font><font style="vertical-align: inherit;">该值与此处显示的值不同，但应该不是空格：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW STATUS LIKE 'Rsa_public_key'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变量名称：Rsa_public_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        价值：-----开始公钥-----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO9nRUDd + KvSZgY7cNBZMNpwX6</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MvE1PbJFXO7u18nJ9lwc99Du / E7lw6CVXw7VKrXPeHbVQUzGyUNkf45Nz / ckaaJa</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aLgJOBCIDmNVnyU54OT / 1lcs2xiyfaDMe8fCJ64ZwTnKbY2gkt1IMjUAB5Ogd5kJ</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
g8aV7EtKwyhHb0c30QIDAQAB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-----结束公钥-----</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果该值为空，则服务器发现密钥文件存在问题。</font><font style="vertical-align: inherit;">检查错误日志以获取诊断信息。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在使用RSA密钥文件配置了服务器后</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用插件进行</font><font style="vertical-align: inherit;">身份验证的帐户可以
           </font><font style="vertical-align: inherit;">选择使用这些密钥文件连接到服务器。</font><font style="vertical-align: inherit;">如前所述，此类帐户可以使用安全连接（在这种情况下不使用RSA）或使用RSA执行密码交换的未加密连接。</font><font style="vertical-align: inherit;">假设使用未加密的连接。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha256user -p</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><em class="replaceable"><code>password</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于这种连接尝试</font></font><code class="literal">sha256user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，服务器确定这</font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          是适当的认证插件并调用它（因为那是在指定的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间</font><font style="vertical-align: inherit;">插件
           </font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">该插件发现连接未加密，因此要求使用RSA加密传输密码。</font><font style="vertical-align: inherit;">在这种情况下，插件将RSA公钥发送给客户端，客户端使用它来加密密码并将结果返回给服务器。</font><font style="vertical-align: inherit;">该插件使用服务器端的RSA私钥解密密码，并根据密码是否正确接受或拒绝连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器根据需要将RSA公钥发送给客户端。</font><font style="vertical-align: inherit;">但是，如果客户端具有包含服务器所需的RSA公钥本地副本的文件，则可以使用以下</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">指定文件
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
输入密码：</font></font><strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha256user -p --server-public-key-path=<em class="replaceable"><code>file_name</code></em></code></strong><font style="vertical-align: inherit;"></font><em class="replaceable"><code>password</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">指定的文件中的公钥值
           </font><font style="vertical-align: inherit;">应该与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量所</font><font style="vertical-align: inherit;">指定的服务器端文件中的键值相同
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果密钥文件包含有效的公钥值但该值不正确，则会发生访问被拒绝的错误。</font><font style="vertical-align: inherit;">如果密钥文件不包含有效的公钥，客户端程序将无法使用它。</font><font style="vertical-align: inherit;">在这种情况下，
           </font></font><code class="literal">sha256_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件将公钥发送给客户端，就像没有</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">任何
           </font><font style="vertical-align: inherit;">选项一样。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          客户端用户可以通过两种方式获得RSA公钥：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              数据库管理员可以提供公钥文件的副本。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可以通过其他方式连接到服务器的客户端用户可以使用</font></font><code class="literal">SHOW STATUS LIKE
              'Rsa_public_key'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句并将返回的键值保存到文件中。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="cleartext-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.5客户端明文可插入认证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116443328"></a><a class="indexterm" name="idm140528116442224"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        客户端身份验证插件可用于将密码发送到服务器，而不进行散列或加密。</font><font style="vertical-align: inherit;">这个插件内置到MySQL客户端库中。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了插件名称。
</font></font></p>
<div class="table">
<a name="idm140528116439664"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.12 Cleartext身份验证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for cleartext password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有，请参阅讨论</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无（插件内置）</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用许多MySQL身份验证方法，客户端在将密码发送到服务器之前执行散列或加密密码。</font><font style="vertical-align: inherit;">这使客户端可以避免以明文形式发送密码。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于需要服务器接收在客户端输入的密码的认证方案，无法进行散列或加密。</font><font style="vertical-align: inherit;">在这种情况下，客户端
         </font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件用于以明文形式将密码发送到服务器。</font><font style="vertical-align: inherit;">没有相应的服务器端插件。</font><font style="vertical-align: inherit;">相反，客户端插件可以被任何需要明文密码的服务器端插件使用。</font><font style="vertical-align: inherit;">（例子是PAM和简单的LDAP认证插件;参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication" title="6.5.1.6 PAM可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.6节“PAM可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication" title="6.5.1.8 LDAP可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.8节“LDAP可插入认证”）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下讨论提供了特定于明文可插入验证的使用信息。</font><font style="vertical-align: inherit;">有关MySQL中可插入认证的一般信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入认证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以明文发送密码可能是某些配置中的安全问题。</font><font style="vertical-align: inherit;">为了避免出现问题，如果可能会拦截密码，客户端应使用保护密码的方法连接到MySQL服务器。</font><font style="vertical-align: inherit;">可能性包括SSL（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connections" title="6.4使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4节“使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），IPsec或专用网络。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不太可能</font><font style="vertical-align: inherit;">使用
         </font><font style="vertical-align: inherit;">插件，MySQL客户端必须明确地启用它。</font><font style="vertical-align: inherit;">这可以通过几种方式完成：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在设置</font></font><code class="literal">LIBMYSQL_ENABLE_CLEARTEXT_PLUGIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            环境变量，且开头的值
             </font></font><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这使插件可用于所有客户端连接。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中mysqladmin</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlslap" title="4.5.9 mysqlslap  - 加载仿真客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlslap</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端程序（也
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlcheck" title="4.5.3 mysqlcheck  - 一个表维护程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlcheck的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlshow" title="4.5.8 mysqlshow  - 显示数据库，表和列信息"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlshow</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为MySQL 5.7.10及更高版本）支持</font></font><code class="option">--enable-cleartext-plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使在每调用基础的插件选项。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-options" title="27.8.7.50 mysql_options（）"><code class="literal">mysql_options()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C API函数支持
             </font></font><code class="literal">MYSQL_ENABLE_CLEARTEXT_PLUGIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，使在每个连接的基础插件。</font><font style="vertical-align: inherit;">此外，任何使用</font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和读取选项文件的程序都可以</font></font><code class="literal">enable-cleartext-plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过在客户端库读取的选项组中</font><font style="vertical-align: inherit;">包含一个</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">来启用插件
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="pam-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.6 PAM可插入式验证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116399376"></a><a class="indexterm" name="idm140528116398272"></a><a class="indexterm" name="idm140528116396784"></a><a class="indexterm" name="idm140528116395312"></a><a class="indexterm" name="idm140528116393840"></a><a class="indexterm" name="idm140528116392752"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          PAM可插入认证是包含在MySQL企业版（一种商业产品）中的扩展。</font><font style="vertical-align: inherit;">要了解有关商业产品的更多信息，请</font></font><a class="ulink" href="http://www.mysql.com/products/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问http://www.mysql.com/products/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL企业版支持一种认证方法，使MySQL服务器能够使用PAM（可插入认证模块）来认证MySQL用户。</font><font style="vertical-align: inherit;">PAM使系统能够使用标准接口访问各种身份验证方法，例如Unix密码或LDAP目录。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PAM可插拔认证提供了以下功能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            外部身份验证：PAM身份验证使MySQL服务器可以接受来自MySQL授权表以外定义的用户的连接，并使用PAM支持的方法进行身份验证。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代理用户支持：根据外部用户所在的组和提供的验证字符串，PAM验证可以向MySQL返回与登录用户不同的用户名。</font><font style="vertical-align: inherit;">这意味着插件可以返回定义外部PAM认证用户应具有的权限的MySQL用户。</font><font style="vertical-align: inherit;">例如，名为的用户</font></font><code class="literal">joe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以连接并具有名为的用户的特权</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PAM可插拔认证已在Linux和MacOS上测试过。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PAM插件使用由MySQL服务器传递给它的信息（例如用户名，主机名，密码和认证字符串）以及用于PAM查找的任何方法。</font><font style="vertical-align: inherit;">该插件根据PAM检查用户凭证并返回
         </font><font style="vertical-align: inherit;">或
         </font><font style="vertical-align: inherit;">。
      </font></font><code class="literal">'Authentication succeeded, Username is
        <em class="replaceable"><code>user_name</code></em>'</code><font style="vertical-align: inherit;"></font><code class="literal">'Authentication failed'</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了插件和库文件名。</font><font style="vertical-align: inherit;">文件名后缀可能在您的系统上有所不同。</font><font style="vertical-align: inherit;">该文件必须位于由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录中
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关安装信息，请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication-installation" title="安装PAM可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装PAM可插入验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528116378528"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.13 PAM认证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for PAM password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><code class="literal">authentication_pam</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><code class="filename">authentication_pam.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与服务器端PAM插件通信的客户端明文插件已内置到
         </font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端库中，并包含在所有发行版中，包括社区发行版。</font><font style="vertical-align: inherit;">在所有MySQL发行版中包含客户端明文插件，可使来自任何发行版的客户端连接到装有服务器端插件的服务器。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下各节提供PAM可插拔认证特有的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication-installation" title="安装PAM可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装PAM可插入验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication-uninstallation" title="卸载PAM可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载PAM可插入式验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication-usage" title="使用PAM可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用PAM可插入验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-authentication-unix-without-proxy" title="没有代理用户的Unix密码认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有代理用户的Unix密码认证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-authentication-ldap-without-proxy" title="没有代理用户的LDAP认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有代理用户的LDAP认证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-authentication-unix-with-proxy" title="使用代理用户和组映射的Unix密码身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用代理用户和组映射的Unix密码身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication-debugging" title="PAM可插拔认证调试"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAM可插拔认证调试</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关该</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件的</font><font style="vertical-align: inherit;">信息</font><font style="vertical-align: inherit;">，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#cleartext-pluggable-authentication" title="6.5.1.5客户端明文可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.5节“客户端Cleartext可插入式身份验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关代理用户信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装PAM可插入验证</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何安装PAM认证插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件库文件的基本名称是
           </font></font><code class="literal">authentication_pam</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个平台的文件名后缀都不相同（例如，</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于Unix和类Unix系统，</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Windows）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在服务器启动时加载插件，请使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它的库文件。</font><font style="vertical-align: inherit;">使用这种插件加载方法，每次服务器启动时都必须给出选项。</font><font style="vertical-align: inherit;">例如，将这些行放在
           </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">平台</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= authentication_pam.so</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，要在运行时注册插件，请使用以下语句（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL PLUGIN authentication_pam SONAME'authentication_pam.so';
</font></font></pre><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载一个插件，并且将它注册到</font></font><code class="literal">mysql.plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统表中，以使该插件被加载用于每个​​随后的正常服务器启动。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证插件安装，请检查该
           </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%pam%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">authentication_pam | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将MySQL帐户与PAM插件相关联，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication-usage" title="使用PAM可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用PAM可插入验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-uninstallation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载PAM可插入式验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于卸载PAM身份验证插件的方法取决于您如何安装它：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在服务器启动时使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">安装插件，请在
               </font><font style="vertical-align: inherit;">没有选项的情况下重新启动服务器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在运行时使用插件</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它将在服务器重新启动</font><font style="vertical-align: inherit;">时
               </font><font style="vertical-align: inherit;">保持安装状态。</font><font style="vertical-align: inherit;">要卸载它，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN authentication_pam;
</font></font></pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用PAM可插入验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何使用PAM认证插件从MySQL客户端程序连接到服务器。</font><font style="vertical-align: inherit;">假定服务器在启用服务器端插件的情况下运行，如
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication-installation" title="安装PAM可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装PAM Pluggable Authentication中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font></font><code class="literal">IDENTIFIED WITH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中
           </font><font style="vertical-align: inherit;">引用PAM身份验证插件
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用该名称</font></font><code class="literal">authentication_pam</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户 </font></font><em class="replaceable"><code>user</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用authentication_pam识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS' </font></font><em class="replaceable"><code>authentication_string</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          认证字符串指定以下类型的信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              PAM支持</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务名称</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的概念，</font><font style="vertical-align: inherit;">
              该名称是系统管理员可以用来配置特定应用程序的身份验证方法的名称。</font><font style="vertical-align: inherit;">可以有几个这样的
               </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与单个数据库服务器实例关联，因此服务名称的选择留给SQL应用程序开发人员。</font><font style="vertical-align: inherit;">定义应使用PAM进行认证的帐户时，请在认证字符串中指定服务名称。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              PAM为PAM模块提供了一种方法，可以在登录时向服务器返回除登录名之外的MySQL用户名。</font><font style="vertical-align: inherit;">使用认证字符串来控制登录名和MySQL用户名之间的映射。</font><font style="vertical-align: inherit;">如果您想利用代理用户功能，则认证字符串必须包含这种映射。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例如，如果服务名称是</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ，</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
           </font></font><code class="literal">users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAM组</font><font style="vertical-align: inherit;">中的用户</font><font style="vertical-align: inherit;">应该分别映射到
           </font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">data_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL用户，请使用类似下面的语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户 </font></font><em class="replaceable"><code>user</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用authentication_pam识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS'mysql，root = developer，users = data_entry';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          PAM认证插件的认证字符串语法遵循以下规则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该字符串由一个PAM服务名称组成，可选地后跟一个组映射列表，该列表由一个或多个关键字/值对组成，每个关键字/值对指定一个组名和一个MySQL用户名：
            </font></font></p><pre data-lang="none" class="programlisting"><em class="replaceable"><code>pam_service_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>group_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>mysql_user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该插件会在每次登录检查时分析验证字符串。</font><font style="vertical-align: inherit;">为了尽量减少开销，请尽量缩短字符串。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              每一
               </font><font style="vertical-align: inherit;">
              对都必须以逗号开头。
            </font></font><code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>mysql_user_name</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              不在双引号内的前导和尾随空格将被忽略。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              未加引号</font></font><em class="replaceable"><code>pam_service_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><em class="replaceable"><code>group_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><em class="replaceable"><code>mysql_user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值可包含除等号，逗号或空间什么。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果a </font></font><em class="replaceable"><code>pam_service_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><em class="replaceable"><code>group_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><em class="replaceable"><code>mysql_user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值用双引号引起来，则引号之间的所有内容都是该值的一部分。</font><font style="vertical-align: inherit;">例如，如果该值包含空格字符，则这是必需的。</font><font style="vertical-align: inherit;">除双引号和反斜杠（</font></font><code class="literal">\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">外，所有字符都是合法的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要包含任何字符，请使用反斜杠进行转义。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件成功认证登录名，它将在认证字符串中查找组映射列表，如果存在，则根据外部用户所属的组使用它来向MySQL服务器返回不同的用户名：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果认证字符串不包含组映射列表，则插件将返回登录名称。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果验证字符串确实包含组映射列表，插件检查每个
               </font><font style="vertical-align: inherit;">
              列表中对由左到右，并试图找到一个匹配</font><font style="vertical-align: inherit;">分配给经过身份验证的用户群体和收益的非MySQL目录值
               </font><font style="vertical-align: inherit;">的首先找到匹配。</font><font style="vertical-align: inherit;">如果插件找不到任何组的匹配项，则返回登录名。</font><font style="vertical-align: inherit;">如果插件无法在目录中查找组，它将忽略组映射列表并返回登录名。
</font></font><code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>mysql_user_name</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>group_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>mysql_user_name</code></em><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下各节介绍如何设置多个使用PAM认证插件的认证方案：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有代理用户。</font><font style="vertical-align: inherit;">这仅使用PAM来检查登录名和密码。</font><font style="vertical-align: inherit;">允许连接到MySQL服务器的每个外部用户都应该有一个匹配的MySQL帐户，该帐户被定义为使用外部PAM认证。</font><font style="vertical-align: inherit;">（对于</font><font style="vertical-align: inherit;">
              与外部用户匹配的</font><font style="vertical-align: inherit;">MySQL帐户
               </font><font style="vertical-align: inherit;">，
               </font><font style="vertical-align: inherit;">必须是登录名，并且</font><font style="vertical-align: inherit;">必须与客户端连接的主机相匹配。）可以通过各种PAM支持的方法执行验证。</font><font style="vertical-align: inherit;">讨论显示了如何使用传统的Unix密码和LDAP。
            </font></font><code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果不通过代理用户或组进行PAM认证，则需要MySQL帐户具有与Unix帐户相同的用户名。</font><font style="vertical-align: inherit;">MySQL用户名被限制为32个字符（参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#grant-tables" title="6.2.2授予表格"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.2节“授权表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），这限制了PAM非代理认证为Unix与至多32个字符的名称帐户。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              仅代理登录和组映射。</font><font style="vertical-align: inherit;">在这种情况下，创建一个或几个定义不同权限集的MySQL帐户。</font><font style="vertical-align: inherit;">（理想情况下，任何人都不应直接连接使用这些帐户。）然后定义使用一些映射方案（通常由外部团体的用户在）默认的用户通过PAM认证到所有外部登录到几个MySQL的映射帐户持有的特权集。</font><font style="vertical-align: inherit;">任何登录的用户都将映射到其中一个MySQL帐户并使用其权限。</font><font style="vertical-align: inherit;">讨论显示了如何使用Unix密码进行设置，但也可以使用其他PAM方法（如LDAP）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些情况的变化是可能的。</font><font style="vertical-align: inherit;">例如，您可以允许一些用户直接登录（无需代理），但需要其他用户通过代理用户进行连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些例子做出以下假设。</font><font style="vertical-align: inherit;">如果您的系统设置不同，则可能需要进行一些调整。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              PAM配置目录是
               </font></font><code class="filename">/etc/pam.d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              PAM服务名称是</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着您必须</font></font><code class="filename">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在PAM配置目录中创建</font><font style="vertical-align: inherit;">一个名为PAM文件
               </font><font style="vertical-align: inherit;">（如果该文件不存在，则创建该文件）。</font><font style="vertical-align: inherit;">如果您使用的服务名称与之不同
               </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则文件名称会有所不同，您必须在</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">使用不同的名称</font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">AS
              '<em class="replaceable"><code>auth_string</code></em>'</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些示例使用登录名
               </font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和密码
               </font></font><code class="literal">verysecret</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将这些更改为与您要验证的用户相对应。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          PAM验证插件在初始化时检查是否</font></font><code class="literal">AUTHENTICATION_PAM_LOG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器的启动环境中设置</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">环境值。</font><font style="vertical-align: inherit;">如果是这样，该插件可以将诊断消息记录到标准输出。</font><font style="vertical-align: inherit;">根据您的服务器启动方式，消息可能会出现在控制台或错误日志中。</font><font style="vertical-align: inherit;">这些消息对于调试插件执行身份验证时发生的PAM相关问题可能会有所帮助。</font><font style="vertical-align: inherit;">有关更多信息，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication-debugging" title="PAM可插拔认证调试"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAM Pluggable Authentication Debugging</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-authentication-unix-without-proxy"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有代理用户的Unix密码认证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此验证方案仅使用PAM来检查Unix用户登录名和密码。</font><font style="vertical-align: inherit;">允许连接到MySQL服务器的每个外部用户都应该有一个匹配的MySQL帐户，该帐户被定义为使用外部PAM认证。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              验证PAM中的Unix身份验证允许您</font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用密码登录
               </font></font><code class="literal">verysecret</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过创建一个名为的文件</font><font style="vertical-align: inherit;">
              来设置PAM来验证</font><font style="vertical-align: inherit;">服务
               </font></font><code class="filename">/etc/pam.d/mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">文件内容与系统有关，因此请检查目录中现有的与登录相关的文件</font></font><code class="filename">/etc/pam.d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以查看它们的外观。</font><font style="vertical-align: inherit;">在Linux上，该
               </font></font><code class="filename">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件可能如下所示：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃％PAM-1.0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
auth包含password-auth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
帐户包括密码认证</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于Gentoo Linux，使用</font></font><code class="literal">system-login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              而不是</font></font><code class="literal">password-auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于macOS，使用</font></font><code class="literal">login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是
               </font></font><code class="literal">password-auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              某些系统上的PAM文件格式可能有所不同。</font><font style="vertical-align: inherit;">例如，在Ubuntu和其他基于Debian的系统上，请改用这些文件内容：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@include common-auth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@包括共同帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@include common-session-noninteractive</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用与Unix登录名称相同的用户名创建一个MySQL帐户，并将其定义为使用PAM插件进行验证：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'antonio'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用authentication_pam AS'mysql'识别;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予所有特权在mydb。* TO'antonio'@'localhost';</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行客户端</font><font style="vertical-align: inherit;">连接到MySQL服务器
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --user = antonio --password --enable -cleartext-plugin mydb</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码： </font></font><strong class="userinput"><code>verysecret</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器应该允许连接，并且以下查询应该返回输出，如下所示：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- ------------------- + --------- + ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）| </font><font style="vertical-align: inherit;">@@ proxy_user |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- ------------------- + --------- + ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">antonio @ localhost | </font><font style="vertical-align: inherit;">antonio @ localhost | </font><font style="vertical-align: inherit;">NULL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- ------------------- + --------- + ----- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这表明</font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用授予</font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL帐户</font><font style="vertical-align: inherit;">的权限</font><font style="vertical-align: inherit;">，并且没有发生代理。
</font></font></p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与服务器端PAM插件通信</font><font style="vertical-align: inherit;">
            的客户端</font><font style="vertical-align: inherit;">插件以明文形式将密码发送到MySQL服务器，以便将其传递给PAM。</font><font style="vertical-align: inherit;">这对于使用服务器端PAM库是必要的，但在某些配置中可能是安全问题。</font><font style="vertical-align: inherit;">这些措施将风险降至最低：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为了</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不太可能</font><font style="vertical-align: inherit;">使用
                 </font><font style="vertical-align: inherit;">插件，MySQL客户端必须明确地启用它; </font><font style="vertical-align: inherit;">例如，可以
                 </font></font><code class="option">--enable-cleartext-plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为了避免</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用插件时的</font><font style="vertical-align: inherit;">密码
                 </font><font style="vertical-align: inherit;">泄漏，MySQL客户端应该使用安全连接连接到MySQL服务器。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关附加信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#cleartext-pluggable-authentication" title="6.5.1.5客户端明文可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.5节“客户端Cleartext可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在某些系统上，Unix身份验证使用
             </font></font><code class="filename">/etc/shadow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常具有受限访问权限的文件。</font><font style="vertical-align: inherit;">这可能会导致基于MySQL的PAM验证失败。</font><font style="vertical-align: inherit;">不幸的是，PAM的实现不允许区分
             </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></span><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><span class="quote"><span class="quote"><font style="vertical-align: inherit;">不匹配</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”</font></span><font style="vertical-align: inherit;">（例如，由于无法读取
             </font></font><code class="filename">/etc/shadow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码不匹配”。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果你的系统使用了
             </font></font><code class="filename">/etc/shadow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你可以使用这种方法使MySQL能够访问它（假设MySQL服务器是从</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统帐户</font><font style="vertical-align: inherit;">运行的</font><font style="vertical-align: inherit;">）：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在中创建一个</font></font><code class="literal">shadow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组
                 </font></font><code class="filename">/etc/group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                将</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到
                 </font></font><code class="literal">shadow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组中
                 </font></font><code class="filename">/etc/group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                分配</font></font><code class="filename">/etc/group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给
                 </font></font><code class="literal">shadow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组并启用组读取权限：
              </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chgrp阴影/ etc / shadow</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chmod g + r / etc / shadow</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                重新启动MySQL服务器。
</font></font></p></li></ol>
</div>

</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-authentication-ldap-without-proxy"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有代理用户的LDAP认证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此身份验证方案仅使用PAM来检查LDAP用户登录名和密码。</font><font style="vertical-align: inherit;">允许连接到MySQL服务器的每个外部用户都应该有一个匹配的MySQL帐户，该帐户被定义为使用外部PAM认证。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              验证PAM中的LDAP身份验证允许您</font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用密码登录
               </font></font><code class="literal">verysecret</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              设置PAM以</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过创建名为的文件通过LDAP </font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">服务
               </font><font style="vertical-align: inherit;">进行身份验证</font></font><code class="filename">/etc/pam.d/mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">文件内容与系统有关，因此请检查目录中现有的与登录相关的文件</font></font><code class="filename">/etc/pam.d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以查看它们的外观。</font><font style="vertical-align: inherit;">在Linux上，该
               </font></font><code class="filename">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件可能如下所示：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃％PAM-1.0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
auth需要pam_ldap.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
帐户需要pam_ldap.so</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果PAM对象文件的后缀与</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您系统中</font><font style="vertical-align: inherit;">的后缀不同
               </font><font style="vertical-align: inherit;">，请替换正确的后缀。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              某些系统上的PAM文件格式可能有所不同。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              创建MySQL帐户并连接到服务器的方法与在</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-authentication-unix-without-proxy" title="没有代理用户的Unix密码认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有代理用户的Unix密码身份验证中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的相同
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-authentication-unix-with-proxy"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用代理用户和组映射的Unix密码身份验证</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116194416"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此处描述的身份验证方案使用代理和组映射将使用PAM进行身份验证的连接MySQL用户映射到定义不同权限集的其他MySQL账户。</font><font style="vertical-align: inherit;">用户不通过定义特权的帐户直接连接。</font><font style="vertical-align: inherit;">相反，他们通过使用PAM进行身份验证的默认代理用户进行连接，以便所有外部登录都映射到拥有这些权限的MySQL帐户。</font><font style="vertical-align: inherit;">任何连接的用户都将映射到其中一个MySQL帐户，这些帐户的权限决定了允许外部用户使用的数据库操作。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此处显示的过程使用Unix密码认证。</font><font style="vertical-align: inherit;">要改用LDAP，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-authentication-ldap-without-proxy" title="没有代理用户的LDAP认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有代理用户</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-authentication-ldap-without-proxy" title="没有代理用户的LDAP认证"><font style="vertical-align: inherit;">LDAP身份验证</font></a><font style="vertical-align: inherit;">的早期步骤
           </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关与可能相关的问题的信息
             </font></font><code class="filename">/etc/shadow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-authentication-unix-without-proxy" title="没有代理用户的Unix密码认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有代理用户的Unix密码身份验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              验证PAM中的Unix身份验证允许您</font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用密码</font><font style="vertical-align: inherit;">登录，</font></font><code class="literal">verysecret</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且该
               </font><font style="vertical-align: inherit;">密码
               </font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font><font style="vertical-align: inherit;">的成员
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              设置PAM来验证</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务。</font><font style="vertical-align: inherit;">把以下内容放在
               </font></font><code class="filename">/etc/pam.d/mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃％PAM-1.0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
auth包含password-auth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
帐户包括密码认证</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于Gentoo Linux，使用</font></font><code class="literal">system-login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              而不是</font></font><code class="literal">password-auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于macOS，使用</font></font><code class="literal">login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是
               </font></font><code class="literal">password-auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              某些系统上的PAM文件格式可能有所不同。</font><font style="vertical-align: inherit;">例如，在Ubuntu和其他基于Debian的系统上，请改用这些文件内容：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@include common-auth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@包括共同帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@include common-session-noninteractive</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              创建一个默认代理用户（</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），将外部PAM用户映射到代理帐户。</font><font style="vertical-align: inherit;">它将外部用户从</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              PAM组</font><font style="vertical-align: inherit;">映射</font><font style="vertical-align: inherit;">到</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL帐户，并将外部用户从
               </font></font><code class="literal">users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAM组</font><font style="vertical-align: inherit;">映射</font><font style="vertical-align: inherit;">到
               </font></font><code class="literal">data_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL帐户：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户 ''@''</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用authentication_pam识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS'mysql，root = developer，users = data_entry';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              设置代理用户时，需要服务名称后面的映射列表。</font><font style="vertical-align: inherit;">否则，插件无法告诉如何将PAM组的名称映射到正确的代理用户名。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果你的MySQL安装有匿名用户，他们可能会与默认代理用户发生冲突。</font><font style="vertical-align: inherit;">有关此问题的更多信息以及处理方法，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-conflicts" title="默认代理用户和匿名用户冲突"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认代理用户和匿名用户冲突</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              创建将用于访问数据库的代理帐户：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'developer'@'localhost'IDENTIFIED BY' </font></font><em class="replaceable"><code>very secret password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予mydevdb上的所有特权*到'developer'@'localhost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'data_entry'@'localhost'IDENTIFIED BY' </font></font><em class="replaceable"><code>very secret password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予所有特权在mydb。*到'data_entry'@'localhost';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您不让任何人知道这些帐户的密码，其他用户不能使用它们直接连接到MySQL服务器。</font><font style="vertical-align: inherit;">相反，预计用户将使用PAM进行身份验证，并且他们将</font><font style="vertical-align: inherit;">基于他们的PAM组</font><font style="vertical-align: inherit;">使用
               </font><font style="vertical-align: inherit;">代理</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">data_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理帐户的代理帐户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">特权：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRANT PROXY ON'developer'@'localhost'TO'''';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT PROXY ON'data_entry'@'localhost'TO'''';</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行客户端</font><font style="vertical-align: inherit;">连接到MySQL服务器
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --user = antonio --password --enable -cleartext-plugin mydb</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码： </font></font><strong class="userinput"><code>verysecret</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器使用该</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">验证连接
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特权
               </font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将取决于他是哪个PAM组的成员。</font><font style="vertical-align: inherit;">如果</font></font><code class="option">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAM组</font><font style="vertical-align: inherit;">的成员</font><font style="vertical-align: inherit;">，则PAM插件将映射</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到
               </font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL用户名并将该名称返回给服务器。</font><font style="vertical-align: inherit;">服务器验证是否
               </font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限
               </font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并允许连接。</font><font style="vertical-align: inherit;">以下查询应返回如下所示的输出：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + --------------------- + ------- ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）| </font><font style="vertical-align: inherit;">@@ proxy_user |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + --------------------- + ------- ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">antonio @ localhost | </font><font style="vertical-align: inherit;">developer @ localhost | </font><font style="vertical-align: inherit;">''@''|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + --------------------- + ------- ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这表明</font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用授予</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL帐户</font><font style="vertical-align: inherit;">的权限</font><font style="vertical-align: inherit;">，并通过默认的代理用户帐户进行代理。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是
               </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAM组的成员
               </font></font><code class="literal">users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是该</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组的成员，</font><font style="vertical-align: inherit;">则会发生类似的过程，但插件将</font><font style="vertical-align: inherit;">组成员资格</font><font style="vertical-align: inherit;">映射</font><font style="vertical-align: inherit;">到</font></font><code class="literal">data_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL用户名并将该名称返回给服务器。</font><font style="vertical-align: inherit;">在这种情况下，
               </font></font><code class="literal">antonio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="literal">data_entry</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL帐户</font><font style="vertical-align: inherit;">的权限
               </font><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + ---------------------- + ------ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）| </font><font style="vertical-align: inherit;">@@ proxy_user |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + ---------------------- + ------ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">antonio @ localhost | </font><font style="vertical-align: inherit;">data_entry @ localhost | </font><font style="vertical-align: inherit;">''@''|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + ---------------------- + ------ -------- +</font></font><font></font>
</pre></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与服务器端PAM插件通信</font><font style="vertical-align: inherit;">
            的客户端</font><font style="vertical-align: inherit;">插件以明文形式将密码发送到MySQL服务器，以便将其传递给PAM。</font><font style="vertical-align: inherit;">这对于使用服务器端PAM库是必要的，但在某些配置中可能是安全问题。</font><font style="vertical-align: inherit;">这些措施将风险降至最低：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为了</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不太可能</font><font style="vertical-align: inherit;">使用
                 </font><font style="vertical-align: inherit;">插件，MySQL客户端必须明确地启用它; </font><font style="vertical-align: inherit;">例如，可以
                 </font></font><code class="option">--enable-cleartext-plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为了避免</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用插件时的</font><font style="vertical-align: inherit;">密码
                 </font><font style="vertical-align: inherit;">泄漏，MySQL客户端应该使用安全连接连接到MySQL服务器。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关附加信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#cleartext-pluggable-authentication" title="6.5.1.5客户端明文可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.5节“客户端Cleartext可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-debugging"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAM可插拔认证调试</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116126064"></a><a class="indexterm" name="idm140528116124960"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          PAM认证插件在初始化时检查是否</font></font><code class="literal">AUTHENTICATION_PAM_LOG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">环境值（值无关紧要）。</font><font style="vertical-align: inherit;">如果是这样，该插件可以将诊断消息记录到标准输出。</font><font style="vertical-align: inherit;">这些消息可能对调试插件执行身份验证时发生的PAM相关问题有帮助。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一些消息包括对PAM插件源文件和行号的引用，这使得插件操作可以更紧密地绑定到它们发生的代码中的位置。
</font></font></p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="windows-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.7 Windows可插入验证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528116119952"></a><a class="indexterm" name="idm140528116118848"></a><a class="indexterm" name="idm140528116117360"></a><a class="indexterm" name="idm140528116116256"></a><a class="indexterm" name="idm140528116114752"></a><a class="indexterm" name="idm140528116113248"></a><a class="indexterm" name="idm140528116111744"></a><a class="indexterm" name="idm140528116110656"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Windows可插入认证是包含在MySQL企业版（一种商业产品）中的扩展。</font><font style="vertical-align: inherit;">要了解有关商业产品的更多信息，请</font></font><a class="ulink" href="http://www.mysql.com/products/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问http://www.mysql.com/products/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        用于Windows的MySQL企业版支持在Windows上执行外部认证的认证方法，使MySQL服务器能够使用本地Windows服务来认证客户端连接。</font><font style="vertical-align: inherit;">登录到Windows的用户可以根据其环境中的信息从MySQL客户端程序连接到服务器，无需指定额外的密码。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        客户端和服务器在认证握手中交换数据包。</font><font style="vertical-align: inherit;">作为此交换的结果，服务器创建一个安全上下文对象，该对象表示Windows操作系统中客户端的身份。</font><font style="vertical-align: inherit;">该身份包括客户帐户的名称。</font><font style="vertical-align: inherit;">Windows可插拔认证使用客户端的身份来检查它是给定的帐户还是组的成员。</font><font style="vertical-align: inherit;">默认情况下，协商使用Kerberos进行身份验证，如果Kerberos不可用，则使用NTLM。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        Windows可插拔认证提供了以下功能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            外部身份验证：Windows身份验证使MySQL服务器能够接受来自在MySQL授权表之外登录到Windows的用户定义的连接。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代理用户支持：Windows身份验证可以向MySQL返回与客户端用户不同的用户名。</font><font style="vertical-align: inherit;">这意味着插件可以返回定义外部Windows认证用户应具有的权限的MySQL用户。</font><font style="vertical-align: inherit;">例如，名为的用户</font></font><code class="literal">joe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以连接并具有名为的用户的特权
             </font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了插件和库文件名。</font><font style="vertical-align: inherit;">该文件必须位于由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录中
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528116099536"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.14 Windows身份验证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for Windows password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><code class="literal">authentication_windows</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><code class="literal">authentication_windows_client</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><code class="filename">authentication_windows.dll</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        库文件只包含服务器端插件。</font><font style="vertical-align: inherit;">客户端插件内置于
         </font></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端库中。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器端Windows身份验证插件仅包含在MySQL企业版中。</font><font style="vertical-align: inherit;">它不包含在MySQL社区发行版中。</font><font style="vertical-align: inherit;">客户端插件包含在所有发行版中，包括社区发行版。</font><font style="vertical-align: inherit;">这允许来自任何分发的客户端连接到装有服务器端插件的服务器。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL 5.7支持的任何版本的Windows都支持Windows身份验证插件（请参阅
         </font></font><a class="ulink" href="http://www.mysql.com/support/supportedplatforms/database.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.mysql.com/support/supportedplatforms/database.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下各节提供了特定于Windows可插入验证的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#windows-pluggable-authentication-installation" title="安装Windows可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装Windows可插入身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#windows-pluggable-authentication-uninstallation" title="卸载Windows可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载Windows可插入身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#windows-pluggable-authentication-usage" title="使用Windows可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Windows可插入身份验证</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关代理用户信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="windows-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装Windows可插入身份验证</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何安装Windows身份验证插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在服务器启动时加载插件，请使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它的库文件。</font><font style="vertical-align: inherit;">使用这种插件加载方法，每次服务器启动时都必须给出选项。</font><font style="vertical-align: inherit;">例如，将这些行放在
           </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= authentication_windows.dll</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，要在运行时注册插件，请使用以下语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL PLUGIN authentication_windows SONAME'authentication_windows.dll';
</font></font></pre><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载一个插件，并且将它注册到</font></font><code class="literal">mysql.plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统表中，以使该插件被加载用于每个​​随后的正常服务器启动。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证插件安装，请检查该
           </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%windows%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">authentication_windows | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ + --------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将MySQL帐户与Windows身份验证插件相关联，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#windows-pluggable-authentication-usage" title="使用Windows可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Windows可插入身份验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="windows-pluggable-authentication-uninstallation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载Windows可插入身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于卸载Windows身份验证插件的方法取决于您如何安装它：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在服务器启动时使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">安装插件，请在
               </font><font style="vertical-align: inherit;">没有选项的情况下重新启动服务器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在运行时使用插件</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它将在服务器重新启动</font><font style="vertical-align: inherit;">时
               </font><font style="vertical-align: inherit;">保持安装状态。</font><font style="vertical-align: inherit;">要卸载它，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN authentication_windows;
</font></font></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另外，删除设置Windows插件相关系统变量的任何启动选项。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="windows-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Windows可插入身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Windows身份验证插件支持使用MySQL帐户，以便登录到Windows的用户可以连接到MySQL服务器而无需指定其他密码。</font><font style="vertical-align: inherit;">假定服务器在启用服务器端插件的情况下运行，如
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#windows-pluggable-authentication-installation" title="安装Windows可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装Windows可插入验证中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一旦DBA启用了服务器端插件并设置帐户来使用它，客户端就可以使用这些帐户进行连接，而无需其他设置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font></font><code class="literal">IDENTIFIED WITH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中
           </font><font style="vertical-align: inherit;">引用Windows身份验证插件
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用该名称</font></font><code class="literal">authentication_windows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设Windows用户</font></font><code class="literal">Rafal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
           </font></font><code class="literal">Tasha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应允许连接到MySQL，以及任何用户的
           </font></font><code class="literal">Administrators</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">Power
          Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组。</font><font style="vertical-align: inherit;">要设置它，请创建一个名为</font></font><code class="literal">sql_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的Windows </font><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">使用Windows插件进行身份验证：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户sql_admin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  通过authentication_windows进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS'Rafal，Tasha，管理员，“高级用户”;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件名称是</font></font><code class="literal">authentication_windows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="literal">AS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">后面的字符串</font><font style="vertical-align: inherit;">是认证字符串。</font><font style="vertical-align: inherit;">它指定的Windows用户命名</font></font><code class="literal">Rafal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">Tasha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许验证服务器的MySQL用户
           </font></font><code class="literal">sql_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为是在任何Windows用户
           </font></font><code class="literal">Administrators</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">Power
          Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组。</font><font style="vertical-align: inherit;">后面的组名包含空格，所以它必须用双引号字符引用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          创建</font></font><code class="literal">sql_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户后，登录到Windows的用户可以尝试使用该帐户连接到服务器：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\&gt; </font></font><strong class="userinput"><code>mysql --user=sql_admin</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这里不需要密码。</font><font style="vertical-align: inherit;">该
           </font></font><code class="literal">authentication_windows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件使用Windows安全API来检查哪个Windows用户正在连接。</font><font style="vertical-align: inherit;">如果该用户被命名为</font></font><code class="literal">Rafal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><code class="literal">Tasha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者是在
           </font></font><code class="literal">Administrators</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">Power
          Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组，服务器授予访问权限和客户端进行身份验证为</font></font><code class="literal">sql_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，有什么权限授予
           </font></font><code class="literal">sql_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户。</font><font style="vertical-align: inherit;">否则，服务器拒绝访问。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Windows身份验证插件的身份验证字符串语法遵循以下规则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该字符串由一个或多个由逗号分隔的用户映射组成。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              每个用户映射都将Windows用户或组名与MySQL用户名关联起来：
            </font></font></p><pre data-lang="none" class="programlisting"><em class="replaceable"><code>win_user_or_group_name=mysql_user_name</code></em>
<em class="replaceable"><code>win_user_or_group_name</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于后面的语法，没有</font></font><em class="replaceable"><code>mysql_user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出</font><font style="vertical-align: inherit;">任何
               </font><font style="vertical-align: inherit;">值，隐式值是由</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">创建的MySQL用户
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，这些陈述是等同的：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户sql_admin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  通过authentication_windows进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS'Rafal，Tasha，管理员，“高级用户”;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建用户sql_admin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  通过authentication_windows进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS'Rafal = sql_admin，Tasha = sql_admin，Administrators = sql_admin，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “Power Users”= sql_admin';</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">'\'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于反斜杠是MySQL字符串中的转义字符，因此值中的</font><font style="vertical-align: inherit;">
              每个反斜杠（</font><font style="vertical-align: inherit;">）都必须加倍。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              不在双引号内的前导和尾随空格将被忽略。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              未加引号</font></font><em class="replaceable"><code>win_user_or_group_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和</font></font><em class="replaceable"><code>mysql_user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值可以包含除等号，逗号或空格以外的任何内容。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><em class="replaceable"><code>win_user_or_group_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和或</font></font><em class="replaceable"><code>mysql_user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值用双引号引起来，引号之间的所有内容都是该值的一部分。</font><font style="vertical-align: inherit;">例如，如果名称包含空格字符，则这是必需的。</font><font style="vertical-align: inherit;">双引号内的所有字符都是合法的，除了双引号和反斜杠。</font><font style="vertical-align: inherit;">要包含任何字符，请使用反斜杠进行转义。
            </font></font></p></li><li class="listitem"><p>
              <em class="replaceable"><code>win_user_or_group_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值使用Windows主体的常规语法，无论是本地还是域。</font><font style="vertical-align: inherit;">示例（注意反斜杠加倍）：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域\\用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。\\用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
域\\组</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。\\组</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BUILTIN \\ WellKnownGroup</font></font><font></font>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当由服务器调用来验证客户端时，插件会将用户或组匹配的验证字符串扫描到Windows用户。</font><font style="vertical-align: inherit;">如果匹配，插件将返回相应
           </font></font><em class="replaceable"><code>mysql_user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的MySQL服务器。</font><font style="vertical-align: inherit;">如果不匹配，认证失败。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用户名匹配优先于组名匹配。</font><font style="vertical-align: inherit;">假设名为Windows的用户
           </font></font><code class="literal">win_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是成员，
           </font></font><code class="literal">win_group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且认证字符串如下所示：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'win_group = sql_user1，win_user = sql_user2'
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当</font></font><code class="literal">win_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到MySQL服务器，有一个匹配既</font></font><code class="literal">win_group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">win_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该插件会对用户进行身份验证，</font></font><code class="literal">sql_user2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为更具体的用户匹配优先于组匹配，即使该组首先列在身份验证字符串中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Windows身份验证始终适用于运行服务器的同一台计算机的连接。</font><font style="vertical-align: inherit;">对于跨计算机连接，两台计算机都必须注册Windows Active Directory。</font><font style="vertical-align: inherit;">如果它们位于相同的Windows域中，则不需要指定域名。</font><font style="vertical-align: inherit;">也可以允许来自不同域的连接，如下例所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER sql_accounting</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  通过authentication_windows进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS'SomeDomain \\ Accounting';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这</font></font><code class="literal">SomeDomain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是另一个域的名称。</font><font style="vertical-align: inherit;">反斜杠字符翻倍，因为它是字符串中的MySQL转义字符。
        </font></font></p><a class="indexterm" name="idm140528115990992"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL支持代理用户的概念，即客户端可以使用一个帐户连接和验证MySQL服务器，但连接时具有另一个帐户的权限（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">假设您希望Windows用户使用单个用户名进行连接，但要根据其Windows用户名和组名映射到特定的MySQL帐户，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在</font></font><code class="literal">local_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
               </font></font><code class="literal">MyDomain\domain_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地和域Windows用户应该映射到
               </font></font><code class="literal">local_wlad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL账户。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">MyDomain\Developers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域组</font><font style="vertical-align: inherit;">
              中的用户</font><font style="vertical-align: inherit;">应映射到</font></font><code class="literal">local_dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL帐户。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              本地机器管理员应该映射到
               </font></font><code class="literal">local_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL帐户。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用此功能，为Windows用户创建连接到代理帐户，并配置该帐户，使用户和用户组映射到相应的MySQL账户（</font></font><code class="literal">local_wlad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">local_dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">local_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">另外，授予MySQL账户适合他们需要执行的操作的权限。</font><font style="vertical-align: inherit;">下面的说明使用
           </font></font><code class="literal">win_proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的代理帐户，和
           </font></font><code class="literal">local_wlad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">local_dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">local_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为代理账户。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              创建代理MySQL帐户：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户win_proxy</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  通过authentication_windows进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS'local_user = local_wlad，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MyDomain \\ domain_user = local_wlad，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MyDomain \\ Developers = local_dev，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      BUILTIN \\ Administrators = local_admin';</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果你的MySQL安装有匿名用户，他们可能会与默认代理用户发生冲突。</font><font style="vertical-align: inherit;">有关此问题的更多信息以及处理方法，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-conflicts" title="默认代理用户和匿名用户冲突"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认代理用户和匿名用户冲突</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为了代理工作，代理帐户必须存在，因此创建它们：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER local_wlad IDENTIFIED BY'wlad_pass';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER local_dev IDENTIFIED BY'dev_pass';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER local_admin IDENTIFIED BY'admin_pass';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您不让任何人知道这些帐户的密码，则其他用户无法使用它们直接连接到MySQL服务器。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您还应该发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              声明（未显示），以授予每个代理帐户所需的权限。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代理帐户必须具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个</font><font style="vertical-align: inherit;">代理帐户的
               </font><font style="vertical-align: inherit;">权限：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRANT PROXY ON local_wlad TO win_proxy;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT PROXY ON local_dev TO win_proxy;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT PROXY ON local_admin TO win_proxy;</font></font><font></font>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在的Windows用户</font></font><code class="literal">local_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
           </font></font><code class="literal">MyDomain\domain_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以连接到MySQL服务器</font></font><code class="literal">win_proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和身份验证时，必须在验证字符串，在这种情况下，考虑到帐户的权限，
           </font></font><code class="literal">local_wlad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="literal">MyDomain\Developers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组中连接的
           </font><font style="vertical-align: inherit;">用户
           </font></font><code class="literal">win_proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有该</font></font><code class="literal">local_dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">的特权
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">BUILTIN\Administrators</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组中的</font><font style="vertical-align: inherit;">用户
           </font><font style="vertical-align: inherit;">具有该</font></font><code class="literal">local_admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">的特权</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要配置身份验证，以便所有没有自己的MySQL帐户的Windows用户都通过代理帐户，请</font><font style="vertical-align: inherit;">在前面的说明中</font><font style="vertical-align: inherit;">替换默认代理用户（</font></font><code class="literal">''@''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><code class="literal">win_proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关默认代理用户的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在Connection / Net 6.4.4及更高版本中使用Windows身份验证插件和连接器/网络连接字符串，请参阅
           </font></font><a class="ulink" href="http://dev.mysql.com/doc/connector-net/en/connector-net-programming-authentication-windows-native.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Windows本机身份验证插件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Windows身份验证插件提供更多的控制由提供
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_authentication_windows_use_principal_name"><code class="literal">authentication_windows_use_principal_name</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_authentication_windows_log_level"><code class="literal">authentication_windows_log_level</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="ldap-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.8 LDAP可插入验证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528115946128"></a><a class="indexterm" name="idm140528115944624"></a><a class="indexterm" name="idm140528115943120"></a><a class="indexterm" name="idm140528115941616"></a><a class="indexterm" name="idm140528115940128"></a><a class="indexterm" name="idm140528115939040"></a><a class="indexterm" name="idm140528115937536"></a><a class="indexterm" name="idm140528115936048"></a><a class="indexterm" name="idm140528115934560"></a><a class="indexterm" name="idm140528115933072"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          LDAP可插入认证是包含在MySQL企业版中的一种扩展，这是一种商业产品。</font><font style="vertical-align: inherit;">要了解有关商业产品的更多信息，请</font></font><a class="ulink" href="http://www.mysql.com/products/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问http://www.mysql.com/products/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从MySQL 5.7.19开始，MySQL企业版支持一种认证方法，使MySQL服务器能够使用LDAP（轻量级目录访问协议）通过访问目录服务（如X.500）来认证MySQL用户。</font><font style="vertical-align: inherit;">MySQL使用LDAP来获取用户，凭证和组信息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        LDAP可插拔认证提供了以下功能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            外部身份验证：LDAP身份验证使MySQL服务器可以接受来自LDAP目录中MySQL授权表之外定义的用户的连接。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代理用户支持：根据外部用户的LDAP组，LDAP认证可以向MySQL返回与登录用户不同的用户名。</font><font style="vertical-align: inherit;">这意味着LDAP插件可以返回定义外部LDAP认证用户应具有的权限的MySQL用户。</font><font style="vertical-align: inherit;">例如，名为的LDAP用户</font></font><code class="literal">joe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以连接，并且具有名为的MySQL用户的权限（
             </font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果LDAP组为
             </font></font><code class="literal">joe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is）</font></font><code class="literal">developer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            安全性：使用TLS，连接到LDAP服务器可以是安全的。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了插件和库文件名。</font><font style="vertical-align: inherit;">文件名后缀可能在您的系统上有所不同。</font><font style="vertical-align: inherit;">这些文件必须位于由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录中
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528115920640"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.15 LDAP认证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for LDAP password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件名称</font></font></td>
            <td><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
              </font></font><code class="literal">authentication_ldap_simple</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件名称</font></font></td>
            <td><code class="literal">authentication_ldap_sasl_client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
              </font></font><code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件名称</font></font></td>
            <td><code class="filename">authentication_ldap_sasl.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="filename">authentication_ldap_sasl_client.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
              </font></font><code class="filename">authentication_ldap_simple.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        库文件只包含
         </font><font style="vertical-align: inherit;">
        插件。</font><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">
        插件内置于</font><font style="vertical-align: inherit;">
        客户端库中。
      </font></font><code class="literal">authentication_ldap_<em class="replaceable"><code>XXX</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"></font><code class="literal">libmysqlclient</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有两个服务器端LDAP插件，每个插件都与一个特定的客户端插件一起工作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器端
             </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件执行简单的LDAP认证。</font><font style="vertical-align: inherit;">对于使用此插件的帐户进行连接，客户端程序使用客户端</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，该插件以明文形式将密码发送到服务器。</font><font style="vertical-align: inherit;">不使用密码散列或加密，因此推荐MySQL客户端和服务器之间的安全连接以防止密码泄漏。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器端</font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            插件执行基于SASL的LDAP认证。</font><font style="vertical-align: inherit;">对于使用此插件的帐户进行连接，客户端程序使用客户端
             </font></font><code class="literal">authentication_ldap_sasl_client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">客户端和服务器端SASL LDAP插件使用SASL消息在LDAP协议内安全传输凭证，以避免在MySQL客户端和服务器之间发送明文密码。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下部分提供特定于LDAP可插入验证的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-prerequisites" title="LDAP可插入验证的先决条件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP可插入验证的先决条件</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-how-it-works" title="MySQL用户的LDAP身份验证如何工作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL用户的LDAP身份验证如何工作</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-installation" title="安装LDAP可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装LDAP可插入验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-uninstallation" title="卸载LDAP可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载LDAP可插入验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-usage" title="使用LDAP可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用LDAP可插入验证</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关该</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件的</font><font style="vertical-align: inherit;">信息</font><font style="vertical-align: inherit;">，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#cleartext-pluggable-authentication" title="6.5.1.5客户端明文可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.5节“客户端Cleartext可插入式身份验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关代理用户信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您的系统支持PAM并允许将LDAP用作PAM验证方法，则另一种使用LDAP进行MySQL用户验证的方法是使用服务器端
           </font></font><code class="literal">authentication_pam</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pam-pluggable-authentication" title="6.5.1.6 PAM可插入式验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.6节“PAM可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-prerequisites"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP可插入验证的先决条件</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要为MySQL使用LDAP可插入认证，必须满足以下先决条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LDAP服务器必须可供LDAP身份验证插件进行通信。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LDAP认证的LDAP用户必须存在于LDAP服务器管理的目录中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在使用服务器端</font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件的</font><font style="vertical-align: inherit;">系统上，LDAP客户端库必须可用
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">目前，受支持的库是Windows本机LDAP库，或非Windows系统上的OpenLDAP库。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要使用基于SASL的LDAP认证：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  LDAP服务器必须配置为与SASL服务器进行通信。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  必须在使用客户端</font></font><code class="literal">authentication_ldap_sasl_client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  插件的</font><font style="vertical-align: inherit;">系统上使用SASL客户端库
                   </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">目前，唯一支持的库是Cyrus SASL库。
</font></font></p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-how-it-works"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL用户的LDAP身份验证如何工作</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节概述了MySQL和LDAP如何协同工作来验证MySQL用户。</font><font style="vertical-align: inherit;">有关如何设置MySQL帐户以使用特定LDAP认证插件的示例，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-usage" title="使用LDAP可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用LDAP可插入认证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          客户端连接到MySQL服务器，提供MySQL客户端用户名和LDAP密码：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于简单的LDAP验证，客户端和服务器端插件以明文形式传递插件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于基于SASL的LDAP身份验证，客户端和服务器端插件使用SASL消息在LDAP协议内安全传输凭证，以避免在MySQL客户端和服务器之间发送明文密码。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果客户端用户名和主机名不匹配MySQL帐户，则连接被拒绝。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果存在匹配的MySQL帐户，则会发生针对LDAP的身份验证。</font><font style="vertical-align: inherit;">LDAP服务器查找与用户匹配的条目并根据密码验证条目：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果MySQL帐户命名LDAP用户专有名称（DN），LDAP认证使用该值和客户端提供的LDAP密码。</font><font style="vertical-align: inherit;">（要将LDAP用户DN与MySQL帐户相关联，请</font></font><code class="literal">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建该帐户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">包含一个
               </font><font style="vertical-align: inherit;">子句
               </font><font style="vertical-align: inherit;">。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果MySQL帐户不命名LDAP用户DN，则LDAP验证使用客户端提供的用户名和LDAP密码。</font><font style="vertical-align: inherit;">在这种情况下，身份验证插件首先使用根DN和密码作为凭据绑定到LDAP服务器，以根据客户端用户名查找用户DN，然后根据LDAP密码验证用户DN。</font><font style="vertical-align: inherit;">如果设置了根DN和密码，但使用了根凭据的绑定会失败，或者为空（未设置），并且LDAP服务器不允许匿名连接。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果LDAP服务器找不到匹配或多个匹配项，则认证失败，客户端连接被拒绝。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果LDAP服务器找到单个匹配项，则LDAP验证成功（假设密码正确），LDAP服务器将返回LDAP条目，并且验证插件将根据该条目确定已验证用户的名称：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果LDAP条目具有组属性（默认情况下
               </font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性），则该插件将返回其值作为经过身份验证的用户名。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果LDAP条目没有组属性，则认证插件将返回客户端用户名作为认证用户名。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL服务器将客户端用户名与经过身份验证的用户名进行比较，以确定是否针对客户端会话进行代理：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果名称相同，则不会发生代理：与客户端用户名匹配的MySQL帐户用于特权检查。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果名称不同，则会发生代理：MySQL会查找与经过身份验证的用户名相匹配的帐户。</font><font style="vertical-align: inherit;">该帐户成为代理用户，用于特权检查。</font><font style="vertical-align: inherit;">匹配客户端用户名的MySQL帐户被视为外部代理用户。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装LDAP可插入验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何安装LDAP认证插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器端插件库文件基名是
           </font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个平台的文件名后缀都不相同（例如，
           </font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Unix和类Unix系统，
           </font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Windows）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在服务器启动时加载插件，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它们的库文件。</font><font style="vertical-align: inherit;">使用这种插件加载方法，每次服务器启动时都必须给出选项。</font><font style="vertical-align: inherit;">另外，为您希望配置的任何插件提供的系统变量指定值。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个服务器端LDAP插件都公开了一组系统变量，可以对其操作进行配置。</font><font style="vertical-align: inherit;">设置其中大部分是可选的，但您必须设置指定LDAP服务器主机的变量（以便插件知道连接的位置），并为LDAP绑定操作（限制搜索范围并获得更快的搜索）设置基础专有名称。</font><font style="vertical-align: inherit;">有关所有LDAP系统变量的详细信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication-system-variables" title="6.5.1.12可插入的身份验证系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.12节“可插入的身份验证系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要加载插件并为LDAP绑定操作设置LDAP服务器主机和基本专有名称，请在您的</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">放置这些行</font><font style="vertical-align: inherit;">（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要为您的平台</font><font style="vertical-align: inherit;">调整
           </font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= authentication_ldap_sasl.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authentication_ldap_sasl_server_host = 127.0.0.1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authentication_ldap_sasl_bind_base_dn = “DC =例如，DC = COM”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= authentication_ldap_simple.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authentication_ldap_simple_server_host = 127.0.0.1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authentication_ldap_simple_bind_base_dn = “DC =例如，DC = COM”</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，要在运行时注册插件，请使用以下语句（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL PLUGIN authentication_ldap_sasl SONAME'authentication_ldap_sasl.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSTALL PLUGIN authentication_ldap_simple SONAME'authentication_ldap_simple.so';</font></font><font></font>
</pre><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载一个插件，并且将它注册到</font></font><code class="literal">mysql.plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统表中，以使该插件被加载用于每个​​随后的正常服务器启动。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在运行时安装插件后，它们的系统变量将变为可用，您可以将它们的设置添加到</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中，以配置插件以便后续重新启动。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authentication_ldap_sasl_server_host = 127.0.0.1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authentication_ldap_sasl_bind_base_dn = “DC =例如，DC = COM”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authentication_ldap_simple_server_host = 127.0.0.1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authentication_ldap_simple_bind_base_dn = “DC =例如，DC = COM”</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证插件安装，请检查该
           </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%ldap%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">authentication_ldap_sasl | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">authentication_ldap_simple | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + -------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件未能初始化，请检查服务器错误日志以获取诊断消息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将MySQL帐户与LDAP插件关联，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-usage" title="使用LDAP可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用LDAP可插入验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-uninstallation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载LDAP可插入验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于卸载LDAP认证插件的方法取决于您如何安装它们：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">在服务器启动时安装插件，请在
               </font><font style="vertical-align: inherit;">没有这些选项的情况下重新启动服务器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在运行时使用插件</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它们将在服务器重新启动</font><font style="vertical-align: inherit;">时
               </font><font style="vertical-align: inherit;">保持安装状态。</font><font style="vertical-align: inherit;">要卸载它们，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN authentication_ldap_sasl;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNINSTALL PLUGIN authentication_ldap_simple;</font></font><font></font>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另外，从</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">删除</font><font style="vertical-align: inherit;">设置与LDAP插件相关的系统变量的任何启动选项。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用LDAP可插入验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何使用LDAP可插入验证来启用MySQL帐户以连接到MySQL服务器。</font><font style="vertical-align: inherit;">假定服务器在启用适当的服务器端插件的情况下运行，如
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-installation" title="安装LDAP可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装LDAP可插入验证中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且客户端主机上提供了相应的客户端插件。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节不介绍LDAP配置或管理。</font><font style="vertical-align: inherit;">假定您熟悉这些主题。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有两个服务器端LDAP插件，每个插件都与一个特定的客户端插件一起工作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器端
               </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件执行简单的LDAP认证。</font><font style="vertical-align: inherit;">对于使用此插件的帐户进行连接，客户端程序使用客户端</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              插件，该插件以明文形式将密码发送到服务器。</font><font style="vertical-align: inherit;">不使用密码散列或加密，因此推荐MySQL客户端和服务器之间的安全连接以防止密码泄露。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器端
               </font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件执行基于SASL的LDAP认证。</font><font style="vertical-align: inherit;">对于使用此插件的帐户进行连接，客户端程序使用客户端
               </font></font><code class="literal">authentication_ldap_sasl_client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">客户端和服务器端SASL LDAP插件使用SASL消息在LDAP协议内安全传输凭证，以避免在MySQL客户端和服务器之间发送明文密码。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL用户LDAP身份验证的总体要求：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              每个用户都必须有一个LDAP目录条目进行认证。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              必须有一个MySQL用户帐户，它指定了服务器端LDAP身份验证插件，并且可选地命名关联的LDAP用户专有名称（DN）。</font><font style="vertical-align: inherit;">（要将LDAP用户DN与MySQL帐户相关联，请</font></font><code class="literal">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建该帐户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">包含一个</font><font style="vertical-align: inherit;">子句
               </font><font style="vertical-align: inherit;">。）如果某个帐户不指定LDAP字符串，LDAP认证将使用客户端指定的用户名来查找LDAP条目。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              客户端程序使用适合于MySQL帐户使用的服务器端身份验证插件的连接方法进行连接。</font><font style="vertical-align: inherit;">对于LDAP认证，连接需要MySQL用户名和LDAP密码。</font><font style="vertical-align: inherit;">此外，对于使用服务器端</font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件的</font><font style="vertical-align: inherit;">帐户，请使用
               </font></font><code class="option">--enable-cleartext-plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用客户端</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项
               </font><font style="vertical-align: inherit;">调用客户端程序
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这里的说明假定以下情形：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL用户</font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
               </font><font style="vertical-align: inherit;">分别</font></font><code class="literal">boris</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向LDAP </font></font><code class="literal">betsy_ldap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">LDAP进行身份验证</font></font><code class="literal">boris_ldap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（不需要MySQL和LDAP用户名不同，但在此使用不同的名称有助于说明操作上下文是MySQL还是LDAP。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LDAP条目使用该</font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性来指定用户名。</font><font style="vertical-align: inherit;">（这可能会因LDAP服务器而异，有些LDAP服务器使用</font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              用户名称而不是
               </font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些LDAP条目在LDAP服务器管理的目录中可用，以提供唯一标识每个用户的专有名称值：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UID = betsy_ldap，PWD = pwd1，OU =人，DC =例如，DC = com的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UID = boris_ldap，PWD = pwd2，OU =人，DC =例如，DC = com的</font></font><font></font>
</pre></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建MySQL帐户的语句在</font></font><code class="literal">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">命名LDAP用户
               </font><font style="vertical-align: inherit;">，以指示MySQL帐户认证哪个LDAP条目。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置使用LDAP认证的帐户的说明取决于使用哪个服务器端LDAP插件。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-usage-simple" title="简单的LDAP认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单的LDAP认证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-usage-sasl" title="基于SASL的LDAP认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于SASL的LDAP认证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-usage-user-dn-suffix" title="LDAP认证用户DN后缀"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP认证用户DN后缀</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-usage-proxying" title="使用代理的LDAP身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用代理的LDAP身份验证</font></font></a></p></li></ul>
</div>
<h6><a name="ldap-pluggable-authentication-usage-simple"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单的LDAP认证</font></font></h6><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要为简单LDAP身份验证配置MySQL帐户，该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句应指定
           </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，并可选择命名LDAP用户专有名称（DN）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户 </font></font><em class="replaceable"><code>user</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  使用authentication_ldap_simple进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  [BY' </font></font><em class="replaceable"><code>LDAP user DN</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'];
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设一个MySQL用户</font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在LDAP目录中有这个条目：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UID = betsy_ldap，PWD = pwd1，OU =人，DC =例如，DC = com的
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          然后，创建MySQL帐户的语句
           </font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'betsy'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  使用authentication_ldap_simple进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BY'uid = betsy_ldap，ou = People，dc = example，dc = com';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">指定的认证字符串
           </font><font style="vertical-align: inherit;">不包含LDAP密码。</font><font style="vertical-align: inherit;">这必须由客户端用户在连接时提供。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过提供MySQL用户名和LDAP密码以及启用客户端</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">，客户端连接到MySQL服务器
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql --user=betsy --password --enable-cleartext-plugin</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><strong class="userinput"><code>pwd1</code></strong> <em class="replaceable"><code>(betsy_ldap LDAP password)</code></em>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与服务器端</font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件通信</font><font style="vertical-align: inherit;">
            的客户端</font><font style="vertical-align: inherit;">插件以
             </font><font style="vertical-align: inherit;">明文形式将密码发送到MySQL服务器，以便它可以按原样传递给LDAP服务器。</font><font style="vertical-align: inherit;">在没有SASL的情况下使用服务器端LDAP库是必要的，但在某些配置中可能是安全问题。</font><font style="vertical-align: inherit;">这些措施将风险降至最低：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为了</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不太可能</font><font style="vertical-align: inherit;">使用
                 </font><font style="vertical-align: inherit;">插件，MySQL客户端必须明确地启用它; </font><font style="vertical-align: inherit;">例如，可以
                 </font></font><code class="option">--enable-cleartext-plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为了避免</font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用插件时的</font><font style="vertical-align: inherit;">密码
                 </font><font style="vertical-align: inherit;">泄漏，MySQL客户端应该使用安全连接连接到MySQL服务器。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#cleartext-pluggable-authentication" title="6.5.1.5客户端明文可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.1.5节“客户端Cleartext可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          身份验证过程如下所示：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该客户端插件将</font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">pwd1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为到MySQL服务器的客户端的用户名和密码，LDAP。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              连接尝试与</font></font><code class="literal">'betsy'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">匹配
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">服务器端LDAP插件发现该帐户具有一个</font></font><code class="literal">'uid=betsy_ldap,ou=People,dc=example,dc=com'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              用于命名LDAP用户DN </font><font style="vertical-align: inherit;">的验证字符串
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该插件将此字符串和LDAP密码发送到LDAP服务器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LDAP服务器查找LDAP条目
               </font></font><code class="literal">betsy_ldap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和密码匹配，因此LDAP验证成功。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LDAP条目没有组属性，所以服务器端插件返回客户端用户名（</font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）作为经过身份验证的用户。</font><font style="vertical-align: inherit;">这是客户端提供的相同用户名，因此没有代理发生，客户端会话使用该
               </font></font><code class="literal">'betsy'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户进行特权检查。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果匹配的LDAP条目包含组属性，则该属性值应该是经过身份验证的用户名，如果值不同</font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则会发生代理。</font><font style="vertical-align: inherit;">有关使用组属性的示例，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#ldap-pluggable-authentication-usage-proxying" title="使用代理的LDAP身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用代理的LDAP身份验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句不包含</font></font><code class="literal">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font></font><code class="literal">betsy_ldap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP专有名称的</font><font style="vertical-align: inherit;">子句
           </font><font style="vertical-align: inherit;">，则认证尝试将使用客户端提供的用户名（在本例中为</font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在没有LDAP条目的情况下</font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，身份验证将失败。
        </font></font></p><h6><a name="ldap-pluggable-authentication-usage-sasl"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于SASL的LDAP认证</font></font></h6><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要为SASL LDAP身份验证配置MySQL帐户，该
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句应指定该</font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件，并可选择命名LDAP用户专有名称（DN）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户 </font></font><em class="replaceable"><code>user</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用authentication_ldap_sasl进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  [BY' </font></font><em class="replaceable"><code>LDAP user DN</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'];
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设一个MySQL用户</font></font><code class="literal">boris</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在LDAP目录中有这个条目：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UID = boris_ldap，PWD = pwd2，OU =人，DC =例如，DC = com的
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          然后，创建MySQL帐户的语句
           </font></font><code class="literal">boris</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'boris'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用authentication_ldap_sasl进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BY'uid = boris_ldap，ou = People，dc = example，dc = com';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">指定的认证字符串
           </font><font style="vertical-align: inherit;">不包含LDAP密码。</font><font style="vertical-align: inherit;">这必须由客户端用户在连接时提供。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过提供MySQL用户名和LDAP密码，客户端连接到MySQL服务器：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql --user=boris --password</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><strong class="userinput"><code>pwd2</code></strong> <em class="replaceable"><code>(boris_ldap LDAP password)</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于服务器端
           </font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，客户端使用客户端
           </font></font><code class="literal">authentication_ldap_sasl_client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">如果客户端程序没有找到客户端插件，请指定一个</font></font><code class="option">--plugin-dir</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来指定插件库文件的安装目录。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了客户端和服务器端SASL LDAP插件使用SASL消息在LDAP协议内安全传输凭据以避免发送明文密码之外，</font><font style="vertical-align: inherit;">
          身份验证过程</font></font><code class="literal">boris</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与之前介绍的</font></font><code class="literal">betsy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用简单LDAP身份</font><font style="vertical-align: inherit;">验证的过程</font><font style="vertical-align: inherit;">类似
           </font><font style="vertical-align: inherit;">在MySQL客户端和服务器之间。
        </font></font></p><h6><a name="ldap-pluggable-authentication-usage-user-dn-suffix"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP认证用户DN后缀</font></font></h6><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从MySQL 5.7.21开始，LDAP身份验证插件允许提供用户DN信息的身份验证字符串以</font></font><code class="literal">+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符</font><font style="vertical-align: inherit;">开头</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在没有这个字符的情况下，认证字符串值被视为未经修改，因为它已经在5.7.21之前。</font><font style="vertical-align: inherit;">如果身份验证字符串以该身份开始</font></font><code class="literal">+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则该插件</font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会将身份</font><font style="vertical-align: inherit;">用户名中的完整用户DN值</font><font style="vertical-align: inherit;">与身份验证字符串（</font></font><code class="literal">+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除后）</font><font style="vertical-align: inherit;">一起</font><font style="vertical-align: inherit;">构造为</font><font style="vertical-align: inherit;">属性值
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">认证字符串按照</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统表中</font><font style="vertical-align: inherit;">给出的方式存储</font><font style="vertical-align: inherit;">，完整的用户DN在认证之前即时构建。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该帐户身份验证字符串</font></font><code class="literal">+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在开始时</font><font style="vertical-align: inherit;">不具有
           </font><font style="vertical-align: inherit;">，因此将其视为完整用户DN：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'admin'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  使用authentication_ldap_simple进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BY“cn = admin，ou = People，dc = example，dc = com”;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此帐户身份验证字符串
           </font></font><code class="literal">+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在开始处具有，因此仅作为完整用户DN的一部分：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户'会计'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  使用authentication_ldap_simple进行身份识别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BY“+ ou = People，dc = example，dc = com”;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下，完整的用户DN使用</font></font><code class="literal">accounting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          属性连同认证字符串来</font><font style="vertical-align: inherit;">构造
           </font><font style="vertical-align: inherit;">，以产生
           </font></font><code class="literal">"cn=accounting,ou=People,dc=example,dc=com"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于包含主机名称部分的帐户名称，用户名称取自客户端发送的用户名称。</font><font style="vertical-align: inherit;">（实际上，这是帐户名称的用户名部分，忽略主机名部分。）
        </font></font></p><h6><a name="ldap-pluggable-authentication-usage-proxying"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用代理的LDAP身份验证</font></font></h6><a class="indexterm" name="idm140528115692656"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此处描述的身份验证方案使用基于LDAP组属性值的代理，将使用LDAP进行身份验证的连接MySQL用户映射到定义不同权限集的其他MySQL账户。</font><font style="vertical-align: inherit;">用户不通过定义特权的帐户直接连接。</font><font style="vertical-align: inherit;">相反，它们通过使用LDAP进行身份验证的默认代理用户进行连接，以便所有外部登录都映射到拥有这些权限的MySQL帐户。</font><font style="vertical-align: inherit;">任何连接的用户都将映射到其中一个MySQL帐户，这些帐户的权限决定了允许外部用户使用的数据库操作。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这里的说明假定以下情形：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LDAP条目分别使用</font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性来指定用户名和组值。</font><font style="vertical-align: inherit;">要使用不同的用户和组属性名称，请设置相应的系统变量以配置插件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  适用于</font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Set
                   </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_user_search_attr"><code class="literal">authentication_ldap_simple_user_search_attr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  和
                   </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_group_search_attr"><code class="literal">authentication_ldap_simple_group_search_attr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  适用于</font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Set
                   </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_user_search_attr"><code class="literal">authentication_ldap_sasl_user_search_attr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  和
                   </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_group_search_attr"><code class="literal">authentication_ldap_sasl_group_search_attr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些LDAP条目在LDAP服务器管理的目录中可用，以提供唯一标识每个用户的专有名称值：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UID =芭莎，PWD = pwd3，OU =人民，DC =例如，DC = COM，CN =会计</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UID =罗勒，PWD = pwd4，OU =人民，DC =例如，DC = COM，CN = front_office</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              组属性值将成为经过身份验证的用户名，因此他们命名代理帐户
               </font></font><code class="literal">accounting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">front_office</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些示例假定使用SASL LDAP身份验证。</font><font style="vertical-align: inherit;">为简单的LDAP认证做适当的调整。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          创建默认代理MySQL帐户：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户 ''@'％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用authentication_ldap_sasl标识;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          代理帐户定义没有</font><font style="vertical-align: inherit;">为LDAP用户DN命名的子句，因此当客户端连接时，客户端用户名将用作LDAP用户名进行搜索。</font><font style="vertical-align: inherit;">预期匹配的LDAP条目将包含一个用于定义客户端应具有的特权的代理MySQL帐户的组属性。
</font></font><code class="literal">BY
          '<em class="replaceable"><code>auth_string</code></em>'</code><font style="vertical-align: inherit;"></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果你的MySQL安装有匿名用户，他们可能会与默认代理用户发生冲突。</font><font style="vertical-align: inherit;">有关此问题的更多信息以及处理方法，请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users-conflicts" title="默认代理用户和匿名用户冲突"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认代理用户和匿名用户冲突</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          创建代理帐户并授予他们的权限：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'会计'@'localhost'ACCOUNT LOCK;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'front_office'@'localhost'ACCOUNT LOCK;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予所有特权</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ON accountingdb。*</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  到'会计'@'本地主机';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予所有特权</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ON frontdb。*</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  TO'front_office'@'localhost';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_proxy"><code class="literal">PROXY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理帐户的代理帐户</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">特权：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予代理</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ON'会计'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  至 ''@'％';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予代理</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  开'front_office'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  至 ''@'％';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">basha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行客户端</font><font style="vertical-align: inherit;">
          连接到MySQL服务器</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql --user=basha --password</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><strong class="userinput"><code>pwd3</code></strong> <em class="replaceable"><code>(basha LDAP password)</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器使用该</font></font><code class="literal">''@'%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户为客户端用户
           </font><font style="vertical-align: inherit;">验证连接
           </font></font><code class="literal">basha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">匹配的LDAP条目具有组属性</font></font><code class="literal">cn=accounting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此
           </font></font><code class="literal">accounting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成为经过身份验证的用户。</font><font style="vertical-align: inherit;">这与客户端用户名有所不同
           </font></font><code class="literal">basha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其结果
           </font></font><code class="literal">basha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被视为代理
           </font></font><code class="literal">accounting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">basha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设该</font></font><code class="literal">accounting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          帐户</font><font style="vertical-align: inherit;">的特权</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下查询应该返回如下所示的输出：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ---------------------- + -------- ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）| </font><font style="vertical-align: inherit;">@@ proxy_user |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ---------------------- + -------- ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">basha @ localhost | </font><font style="vertical-align: inherit;">accounting @ localhost | </font><font style="vertical-align: inherit;">''@'％'|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ---------------------- + -------- ------ +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这表明</font></font><code class="literal">basha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用授予</font></font><code class="literal">accounting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL帐户</font><font style="vertical-align: inherit;">的权限</font><font style="vertical-align: inherit;">，并通过默认的代理用户帐户进行代理。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在连接，</font></font><code class="literal">basil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql --user=basil --password</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><strong class="userinput"><code>pwd4</code></strong> <em class="replaceable"><code>(basil LDAP password)</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          身份验证过程</font></font><code class="literal">basil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与之前描述的相似
           </font></font><code class="literal">basha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，匹配的LDAP条目具有组属性</font></font><code class="literal">cn=front_office</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此</font></font><code class="literal">front_office</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成为经过身份验证的用户。</font><font style="vertical-align: inherit;">这与客户端用户名有所不同
           </font></font><code class="literal">basil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其结果
           </font></font><code class="literal">basil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被视为代理
           </font></font><code class="literal">front_office</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">basil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设该</font></font><code class="literal">front_office</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          帐户</font><font style="vertical-align: inherit;">的特权</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下查询应该返回如下所示的输出：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ------------------------ + ------ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">USER（）| </font><font style="vertical-align: inherit;">CURRENT_USER（）| </font><font style="vertical-align: inherit;">@@ proxy_user |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ------------------------ + ------ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">罗勒@本地主机| </font><font style="vertical-align: inherit;">front_office @ localhost | </font><font style="vertical-align: inherit;">''@'％'|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ------------------------ + ------ -------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这表明</font></font><code class="literal">basil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用授予</font></font><code class="literal">front_office</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL帐户</font><font style="vertical-align: inherit;">的权限</font><font style="vertical-align: inherit;">，并通过默认的代理用户帐户进行代理。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="no-login-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.9无登录可插入认证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528115630720"></a><a class="indexterm" name="idm140528115629632"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在</font></font><code class="literal">mysql_no_login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端身份验证插件阻止所有客户端连接到使用它的任何账户。</font><font style="vertical-align: inherit;">这种插件的使用案例包括代理帐户，绝对不应允许直接登录，但只能通过代理帐户和必须能够使用提升特权执行存储程序和视图的帐户进行访问，而不向普通用户公开这些特权。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了插件和库文件名。</font><font style="vertical-align: inherit;">文件名后缀可能在您的系统上有所不同。</font><font style="vertical-align: inherit;">该文件必须位于由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录中
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528115624752"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.16无登录验证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for no-login password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><code class="literal">mysql_no_login</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><code class="filename">mysql_no_login.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下各节提供了特定于不可登录可插拔认证的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#no-login-pluggable-authentication-installation" title="安装无登录可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装无登录可插入身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#no-login-pluggable-authentication-uninstallation" title="卸载无登录可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载无登录可插入身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#no-login-pluggable-authentication-usage" title="使用无登录可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用无登录可插入验证</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关代理用户信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="no-login-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装无登录可插入身份验证</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何安装无登录身份验证插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件库文件的基本名称是
           </font></font><code class="literal">mysql_no_login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个平台的文件名后缀都不相同（例如，</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于Unix和类Unix系统，</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Windows）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在服务器启动时加载插件，请使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它的库文件。</font><font style="vertical-align: inherit;">使用这种插件加载方法，每次服务器启动时都必须给出选项。</font><font style="vertical-align: inherit;">例如，将这些行放在
           </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">平台</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= mysql_no_login.so</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，要在运行时注册插件，请使用以下语句（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装PLUGIN mysql_no_login SONAME'mysql_no_login.so';
</font></font></pre><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载一个插件，并且将它注册到</font></font><code class="literal">mysql.plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统表中，以使该插件被加载用于每个​​随后的正常服务器启动。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证插件安装，请检查该
           </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%login%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">mysql_no_login | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + --------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将MySQL帐户与无登录插件相关联，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#no-login-pluggable-authentication-usage" title="使用无登录可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用无登录可插入验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="no-login-pluggable-authentication-uninstallation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载无登录可插入身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于卸载无登录身份验证插件的方法取决于您如何安装它：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在服务器启动时使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">安装插件，请在
               </font><font style="vertical-align: inherit;">没有选项的情况下重新启动服务器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在运行时使用插件</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它将在服务器重新启动</font><font style="vertical-align: inherit;">时
               </font><font style="vertical-align: inherit;">保持安装状态。</font><font style="vertical-align: inherit;">要卸载它，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN mysql_no_login;
</font></font></pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="no-login-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用无登录可插入验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何使用no-login认证插件来阻止从MySQL客户端程序到服务器的连接。</font><font style="vertical-align: inherit;">假定服务器在启用服务器端插件的情况下运行，如
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#no-login-pluggable-authentication-installation" title="安装无登录可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装无登录可插入验证中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font></font><code class="literal">IDENTIFIED WITH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中
           </font><font style="vertical-align: inherit;">引用无登录身份验证插件
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用该名称</font></font><code class="literal">mysql_no_login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用身份验证的帐户
           </font></font><code class="literal">mysql_no_login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用作
           </font></font><code class="literal">DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储程序和查看对象。</font><font style="vertical-align: inherit;">如果这样的对象定义也包括在内
           </font></font><code class="literal">SQL SECURITY DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将以该账户的权限执行。</font><font style="vertical-align: inherit;">DBA可以使用此行为来访问仅通过良好控制的接口才能公开的机密或敏感数据。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下示例提供了这些原理的简单说明。</font><font style="vertical-align: inherit;">它定义了一个不允许客户端连接的帐户，并将其关联到仅公开</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">特定列的视图</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE DATABASE nologindb;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'nologin'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用mysql_no_login标识;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT ALL ON nologindb。*</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  TO'nologin'@'localhost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON mysql.user</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  TO'nologin'@'localhost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE DEFINER ='nologin'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SQL安全定义器</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  查看nologindb.myview</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS SELECT用户，主机从mysql.user;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要为普通用户提供对视图的受保护访问，请执行以下操作：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRANT SELECT ON nologindb.myview</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  TO'普通用户'@'localhost';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在，普通用户可以使用该视图来访问它呈现的有限信息：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM nologindb.myview;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用户尝试访问视图所公开的列以外的列会导致错误，所有尝试从用户未被授予访问权的视图中进行选择都会导致错误。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于该</font></font><code class="literal">nologin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户不能直接使用，因此设置其使用的对象所需的操作必须由</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有创建对象和设置</font></font><code class="literal">DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">所需特权的帐户或类似帐户</font><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用身份验证的帐户
           </font></font><code class="literal">mysql_no_login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用作代理帐户的代理基本用户：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 创建代理帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER'proxy_base'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  用mysql_no_login标识;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 授予代理帐户权限</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
授予...'proxy_base'@'localhost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 允许real_user代理代理帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT PROXY ON'proxy_base'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  TO'real_user'@'localhost';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这使客户端可以通过代理帐户访问MySQL（</font></font><code class="literal">real_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">但不能通过直接作为代理用户（</font></font><code class="literal">proxy_base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">连接来绕过代理机制</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="socket-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.10套接字对等凭证可插拔认证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528115545264"></a><a class="indexterm" name="idm140528115544224"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器端</font></font><code class="literal">auth_socket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证插件对通过Unix套接字文件从本地主机连接的客户</font><font style="vertical-align: inherit;">端进行</font><font style="vertical-align: inherit;">身份验证。</font><font style="vertical-align: inherit;">该插件使用
         </font></font><code class="literal">SO_PEERCRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">套接字选项来获取有关运行客户端程序的用户的信息。</font><font style="vertical-align: inherit;">因此，插件只能在支持该</font></font><code class="literal">SO_PEERCRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项的</font><font style="vertical-align: inherit;">系统上使用
         </font><font style="vertical-align: inherit;">，例如Linux。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这个插件的源代码可以作为一个相对简单的例子来演示如何编写一个可加载的认证插件。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了插件和库文件名。</font><font style="vertical-align: inherit;">该文件必须位于由。命名的目录中
        </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528115537472"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.17插座对等证书认证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for socket peer-credential password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><code class="literal">auth_socket</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有，请参阅讨论</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><code class="filename">auth_socket.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下部分提供特定于套接字可插入验证的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#socket-pluggable-authentication-installation" title="安装套接字可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装套接字可插入身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#socket-pluggable-authentication-uninstallation" title="卸载套接字可插入身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载套接字可插入身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#socket-pluggable-authentication-usage" title="使用套接字可插入的身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用套接字可插入的身份验证</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="socket-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装套接字可插入身份验证</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何安装套接字身份验证插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在服务器启动时加载插件，请使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它的库文件。</font><font style="vertical-align: inherit;">使用这种插件加载方法，每次服务器启动时都必须给出选项。</font><font style="vertical-align: inherit;">例如，将这些行放在
           </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= auth_socket.so</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，要在运行时注册插件，请使用以下语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装插件auth_socket SONAME'auth_socket.so';
</font></font></pre><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载一个插件，并且将它注册到</font></font><code class="literal">mysql.plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统表中，以使该插件被加载用于每个​​随后的正常服务器启动。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证插件安装，请检查该
           </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%socket%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auth_socket | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将MySQL帐户与套接字插件相关联，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#socket-pluggable-authentication-usage" title="使用套接字可插入的身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用套接字可插入验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="socket-pluggable-authentication-uninstallation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载套接字可插入身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于卸载套接字身份验证插件的方法取决于您如何安装它：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在服务器启动时使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">安装插件，请在
               </font><font style="vertical-align: inherit;">没有选项的情况下重新启动服务器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在运行时使用插件</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它将在服务器重新启动</font><font style="vertical-align: inherit;">时
               </font><font style="vertical-align: inherit;">保持安装状态。</font><font style="vertical-align: inherit;">要卸载它，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN auth_socket;
</font></font></pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="socket-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用套接字可插入的身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          套接字插件检查套接字用户名是否与客户端程序指定的MySQL用户名匹配到服务器。</font><font style="vertical-align: inherit;">如果名称不匹配，插件还会检查套接字用户名是否</font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
           </font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表行列中</font><font style="vertical-align: inherit;">指定的名称匹配
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果找到匹配项，插件允许连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设为名</font></font><code class="literal">valerie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为谁的
           </font></font><code class="literal">auth_socket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">的用户创建了一个MySQL帐户，用于
           </font><font style="vertical-align: inherit;">通过套接字文件从本地主机进行连接：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'valerie'@'localhost'IDENTIFIED WITH auth_socket;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果本地主机上的用户使用登录名称
           </font></font><code class="literal">stefanie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invokes </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          并选择</font></font><code class="option">--user=valerie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过套接字文件进行连接，则服务器将使用该服务器
           </font></font><code class="literal">auth_socket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对客户端进行身份验证。</font><font style="vertical-align: inherit;">该插件确定</font></font><code class="option">--user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项value（</font></font><code class="literal">valerie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）与客户端用户的名称（</font></font><code class="literal">stephanie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）不同并拒绝连接。</font><font style="vertical-align: inherit;">如果名为的用户</font></font><code class="literal">valerie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试同样的事情，插件会发现用户名和MySQL用户名都是</font></font><code class="literal">valerie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且允许连接。</font><font style="vertical-align: inherit;">但是，即使</font></font><code class="literal">valerie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接是使用其他协议（例如TCP / IP）</font><font style="vertical-align: inherit;">建立的，插件也会拒绝连接</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="test-pluggable-authentication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.11测试可插入认证</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528115470928"></a><a class="indexterm" name="idm140528115469824"></a><a class="indexterm" name="idm140528115468336"></a><a class="indexterm" name="idm140528115467248"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL包含一个测试插件，用于检查帐户凭证并将成功或失败日志记录到服务器错误日志中。</font><font style="vertical-align: inherit;">这是一个可装入的插件（不是内置的），必须在使用之前安装。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与内置原生插件不同，测试插件源代码与服务器源分离，因此可以将其作为演示如何编写可加载认证插件的相对简单示例进行检查。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此插件旨在用于测试和开发目的，不适用于生产环境或暴露于公共网络的服务器。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表显示了插件和库文件名。</font><font style="vertical-align: inherit;">文件名后缀可能在您的系统上有所不同。</font><font style="vertical-align: inherit;">该文件必须位于由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录中
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528115461664"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.18测试验证的插件和库名称</font></font></b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for test password authentication."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件或文件名</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端插件</font></font></td>
            <td><code class="literal">test_plugin_server</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端插件</font></font></td>
            <td><code class="literal">auth_test_plugin</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库文件</font></font></td>
            <td><code class="filename">auth_test_plugin.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下各节提供了特定于测试可插入身份验证的安装和使用信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#test-pluggable-authentication-installation" title="安装测试可插入验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装测试可插入验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#test-pluggable-authentication-uninstallation" title="卸载测试可插入的身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载测试可插入的身份验证</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#test-pluggable-authentication-usage" title="使用测试可插入的身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用测试可插入的身份验证</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL中可插入验证的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#pluggable-authentication" title="6.3.9可插入认证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.9节“可插入验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="test-pluggable-authentication-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装测试可插入验证</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何安装测试身份验证插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在服务器启动时加载插件，请使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它的库文件。</font><font style="vertical-align: inherit;">使用这种插件加载方法，每次服务器启动时都必须给出选项。</font><font style="vertical-align: inherit;">例如，将这些行放在
           </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">平台</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= auth_test_plugin.so</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，要在运行时注册插件，请使用以下语句（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装插件test_plugin_server SONAME'auth_test_plugin.so';
</font></font></pre><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载一个插件，并且将它注册到</font></font><code class="literal">mysql.plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统表中，以使该插件被加载用于每个​​随后的正常服务器启动。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证插件安装，请检查该
           </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%test_plugin%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test_plugin_server | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将MySQL帐户与测试插件相关联，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#test-pluggable-authentication-usage" title="使用测试可插入的身份验证"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用测试可插入式身份验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="test-pluggable-authentication-uninstallation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载测试可插入的身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于卸载测试身份验证插件的方法取决于您如何安装它：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在服务器启动时使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">安装插件，请在
               </font><font style="vertical-align: inherit;">没有选项的情况下重新启动服务器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您在运行时使用插件</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它将在服务器重新启动</font><font style="vertical-align: inherit;">时
               </font><font style="vertical-align: inherit;">保持安装状态。</font><font style="vertical-align: inherit;">要卸载它，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN test_plugin_server;
</font></font></pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="test-pluggable-authentication-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用测试可插入的身份验证</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用测试认证插件，请创建一个帐户并在该</font></font><code class="literal">IDENTIFIED WITH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          子句中</font><font style="vertical-align: inherit;">为该插件命名</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE USER'testuser'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过test_plugin_server进行身份验证</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BY'testpassword';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          然后</font><font style="vertical-align: inherit;">在连接到服务器时为该帐户</font><font style="vertical-align: inherit;">提供</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_user"><code class="option">--user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_password"><code class="option">--password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql --user=testuser --password</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><strong class="userinput"><code>testpassword</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该插件提取从客户端收到的密码，并将其与存储在</font><font style="vertical-align: inherit;">表中</font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户行列中的</font><font style="vertical-align: inherit;">值进行比较
           </font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果两个值匹配，则插件将返回该
           </font></font><code class="literal">authentication_string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值作为新的有效用户标识。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以在服务器错误日志中查找指示认证是否成功的消息（请注意，密码报告为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[注]插件test_plugin_server报告：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'成功验证用户testpassword'</font></font><font></font>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="pluggable-authentication-system-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.1.12可插入的身份验证系统变量</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        除非安装了适当的服务器端插件，否则这些变量不可用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 用于具有表单名称的系统变量
            </font></font><code class="literal">authentication_ldap_sasl_<em class="replaceable"><code>xxx</code></em></code>
          </p></li><li class="listitem"><p>
            <code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 用于具有表单名称的系统变量
            </font></font><code class="literal">authentication_ldap_simple_<em class="replaceable"><code>xxx</code></em></code>
</p></li></ul>
</div>
<div class="table">
<a name="idm140528115388688"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.19身份验证插件系统变量摘要</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Reference for authentication plugin system variables."><colgroup><col width="20%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMD线</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项文件</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Var范围</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_auth_method_name"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_auth_method_name</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_base_dn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_bind_base_dn</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_dn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_bind_root_dn</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_pwd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_bind_root_pwd</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_ca_path"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_ca_path</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_group_search_attr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_group_search_attr</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_init_pool_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_init_pool_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_log_status"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_log_status</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_max_pool_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_max_pool_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_server_host"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_server_host</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_server_port"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_server_port</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_tls"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_tls</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_user_search_attr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_sasl_user_search_attr</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_auth_method_name"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_auth_method_name</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_base_dn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_bind_base_dn</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_dn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_bind_root_dn</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_pwd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_bind_root_pwd</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_ca_path"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_ca_path</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_group_search_attr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_group_search_attr</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_init_pool_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_init_pool_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_log_status"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_log_status</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_max_pool_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_max_pool_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_server_host"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_server_host</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_server_port"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_server_port</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_tls"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_tls</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_user_search_attr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentication_ldap_simple_user_search_attr</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_auth_method_name"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_auth_method_name"><code class="literal">authentication_ldap_sasl_auth_method_name</code></a>
</p><a class="indexterm" name="idm140528115186336"></a><a class="indexterm" name="idm140528115185216"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_auth_method_name"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-auth-method-name=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_auth_method_name">authentication_ldap_sasl_auth_method_name</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">SCRAM-SHA-1</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，认证方法名称。</font><font style="vertical-align: inherit;">身份验证插件和LDAP服务器之间的通信根据此身份验证方法进行。</font><font style="vertical-align: inherit;">这些认证方法值是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">SCRAM-SHA-1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：身份验证使用SASL质询 - 响应机制来确保密码安全。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                客户端
                 </font></font><code class="literal">authentication_ldap_sasl_client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                插件与SASL服务器通信，使用密码创建质询并获得SASL请求缓冲区，然后将此缓冲区传递给服务器端
                 </font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">客户端和服务器端SASL LDAP插件使用SASL消息在LDAP协议内安全传输凭证，以避免在MySQL客户端和服务器之间发送明文密码。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_base_dn"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_base_dn"><code class="literal">authentication_ldap_sasl_bind_base_dn</code></a>
</p><a class="indexterm" name="idm140528115149424"></a><a class="indexterm" name="idm140528115148384"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_base_dn"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-bind-base-dn=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_base_dn">authentication_ldap_sasl_bind_base_dn</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，基本专有名称（DN）。</font><font style="vertical-align: inherit;">通过将这些变量锚定在</font><font style="vertical-align: inherit;">搜索树</font><font style="vertical-align: inherit;">中的某个位置（</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基础</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font><font style="vertical-align: inherit;">可以使用此变量来限制搜索范围
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设一组LDAP用户条目的成员都有这种形式：
          </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uid = </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，pwd = </font></font><em class="replaceable"><code>user_password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，ou = People，dc = example，dc = com
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            另一组LDAP用户条目的成员都有这种形式：
          </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uid = </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，pwd = </font></font><em class="replaceable"><code>user_password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，ou = Admin，dc = example，dc = com
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            然后搜索就像这样处理不同的基本DN值：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果基本DN是
                 </font></font><code class="literal">ou=People,dc=example,dc=com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：搜索仅在第一组中查找用户条目。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果基本DN是
                 </font></font><code class="literal">ou=Admin,dc=example,dc=com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：搜索仅在第二组中查找用户条目。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果基本DN是
                 </font></font><code class="literal">ou=dc=example,dc=com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：搜索查找第一组或第二组中的用户条目。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常，更具体的基准DN值会导致更快的搜索，因为它们会更多地限制搜索范围。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_root_dn"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_dn"><code class="literal">authentication_ldap_sasl_bind_root_dn</code></a>
</p><a class="indexterm" name="idm140528115105664"></a><a class="indexterm" name="idm140528115104624"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_root_dn"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-bind-root-dn=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_dn">authentication_ldap_sasl_bind_root_dn</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，根专有名称（DN）。</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_pwd"><code class="literal">authentication_ldap_sasl_bind_root_pwd</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了执行搜索，</font><font style="vertical-align: inherit;">此变量与</font><font style="vertical-align: inherit;">用于向LDAP服务器进行身份验证的凭据</font><font style="vertical-align: inherit;">一起使用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">身份验证使用一个或两个LDAP绑定操作，具体取决于MySQL帐户是否命名LDAP用户DN：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果该帐户未命名用户DN：
                 </font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_dn"><code class="literal">authentication_ldap_sasl_bind_root_dn</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                和
                 </font><font style="vertical-align: inherit;">执行初始LDAP绑定
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_pwd"><code class="literal">authentication_ldap_sasl_bind_root_pwd</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这些默认情况下都是空的，所以如果它们没有设置，那么LDAP服务器必须允许匿名连接。）得到的绑定LDAP句柄用于根据客户端用户名搜索用户DN。
                </font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户DN和客户端提供的密码执行第二个绑定。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果帐户名称为用户DN：在这种情况下，第一次绑定操作是不必要的。
                </font></font><code class="literal">authentication_ldap_sasl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户DN和客户端提供的密码执行单一绑定。</font><font style="vertical-align: inherit;">这比如果MySQL帐户没有指定LDAP用户DN更快。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_root_pwd"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_pwd"><code class="literal">authentication_ldap_sasl_bind_root_pwd</code></a>
</p><a class="indexterm" name="idm140528115064192"></a><a class="indexterm" name="idm140528115063152"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_root_pwd"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-bind-root-pwd=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_pwd">authentication_ldap_sasl_bind_root_pwd</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，根专有名称的密码。</font><font style="vertical-align: inherit;">这个变量与...一起使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_bind_root_dn"><code class="literal">authentication_ldap_sasl_bind_root_dn</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅该变量的说明。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_ca_path"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_ca_path"><code class="literal">authentication_ldap_sasl_ca_path</code></a>
</p><a class="indexterm" name="idm140528115030704"></a><a class="indexterm" name="idm140528115029600"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_ca_path"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-ca-path=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_ca_path">authentication_ldap_sasl_ca_path</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP身份验证，证书颁发机构文件的绝对路径。</font><font style="vertical-align: inherit;">如果需要身份验证插件执行LDAP服务器证书验证，请指定此文件。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              除了将</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_ca_path"><code class="literal">authentication_ldap_sasl_ca_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              变量</font><font style="vertical-align: inherit;">设置为
               </font><font style="vertical-align: inherit;">文件名之外，还必须将相应的证书颁发机构证书添加到文件并启用
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_tls"><code class="literal">authentication_ldap_sasl_tls</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_group_search_attr"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_group_search_attr"><code class="literal">authentication_ldap_sasl_group_search_attr</code></a>
</p><a class="indexterm" name="idm140528114994832"></a><a class="indexterm" name="idm140528114993712"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_group_search_attr"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-group-search-attr=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_group_search_attr">authentication_ldap_sasl_group_search_attr</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">cn</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，指定在LDAP目录条目中指定组名称的属性的名称。</font><font style="vertical-align: inherit;">如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_group_search_attr"><code class="literal">authentication_ldap_sasl_group_search_attr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有其默认值</font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，搜索将返回</font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值作为组名称。</font><font style="vertical-align: inherit;">例如，如果有一个LDAP项</font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的值</font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有
             </font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的属性
             </font></font><code class="literal">mygroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，搜索
             </font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><code class="literal">mygroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的组名。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您不需要组或代理身份验证，则此变量应为空字符串。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7.21开始，如果组搜索属性是
             </font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP身份验证，则直接检索用户属性</font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值并将其分配为组信息。</font><font style="vertical-align: inherit;">如果组搜索属性不是</font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，LDAP认证会搜索用户所属的所有组。</font><font style="vertical-align: inherit;">（后者是缺省行为。）此行为基于如何以两种方式存储LDAP组信息：1）组条目可以具有名为的属性
             </font></font><code class="literal">memberUid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">member</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            具有用户名值; </font><font style="vertical-align: inherit;">2）用户条目可以有一个属性</font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其值是组名。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_group_search_filter"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_group_search_filter"><code class="literal">authentication_ldap_sasl_group_search_filter</code></a>
</p><a class="indexterm" name="idm140528114949600"></a><a class="indexterm" name="idm140528114948480"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_group_search_filter"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-group-search-filter=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_group_search_filter">authentication_ldap_sasl_group_search_filter</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">(|(&amp;(objectClass=posixGroup)(memberUid=%s))(&amp;(objectClass=group)(member=%s)))</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，自定义组搜索过滤器。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7.22开始，搜索过滤器值现在可以包含
             </font></font><code class="literal">{UA}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">{UD}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记以表示用户名和完整用户DN。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">{UA}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用一个用户名</font><font style="vertical-align: inherit;">替换</font></font><code class="literal">"admin"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而
             </font></font><code class="literal">{UD}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用一个使用完整的DN代替，例如
             </font></font><code class="literal">"uid=admin,ou=People,dc=example,dc=com"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下值是默认值，它同时支持OpenLDAP和Active Directory：
          </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（|（＆（objectClass的= posixGroup）（memberUid = {UA}））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （＆（objectClass的=基团）（成员= {} UD）））</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以前，如果组搜索属性是
             </font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">memberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则将其视为具有组信息的用户属性。</font><font style="vertical-align: inherit;">但是，在某些情况下，对于用户场景，</font></font><code class="literal">memberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个不包含组信息的简单用户属性。</font><font style="vertical-align: inherit;">为了获得更大的灵活性，</font></font><code class="literal">{GA}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            现在可以为组搜索属性使用</font><font style="vertical-align: inherit;">可选的</font><font style="vertical-align: inherit;">前缀。</font><font style="vertical-align: inherit;">（以前假设如果组搜索属性是</font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的，现在任何带有{GA}前缀的组属性被视为具有组名称的用户属性）。例如，值为
            </font></font><code class="literal">{GA}MemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果组值是DN，则组DN的第一个属性值将作为组名返回。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.21中，搜索过滤器使用了
             </font></font><code class="literal">%s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符号，将其扩展为用于OpenLDAP（</font></font><code class="literal">&amp;(objectClass=posixGroup)(memberUid=%s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的用户名</font><font style="vertical-align: inherit;">和用于Active Directory（</font></font><code class="literal">&amp;(objectClass=group)(member=%s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的完整用户DN </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_init_pool_size"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_init_pool_size"><code class="literal">authentication_ldap_sasl_init_pool_size</code></a>
</p><a class="indexterm" name="idm140528114902752"></a><a class="indexterm" name="idm140528114901712"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_init_pool_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-init-pool-size=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_init_pool_size">authentication_ldap_sasl_init_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">32767</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，连接到LDAP服务器的池的初始大小。</font><font style="vertical-align: inherit;">根据到LDAP服务器的并发身份验证请求的平均数选择此变量的值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该插件使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_init_pool_size"><code class="literal">authentication_ldap_sasl_init_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一起进行连接池管理：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当身份验证插件初始化时，它会创建
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_init_pool_size"><code class="literal">authentication_ldap_sasl_init_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                连接，除非
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                禁用池。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果插件在当前连接池中没有空闲连接时收到一个身份验证请求，则该插件可以创建一个新连接，直到达到最大连接池大小为止
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果插件在池大小已达到最大值且没有空闲连接时收到请求，则认证失败。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当插件卸载时，它会关闭所有连接池。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            插件系统变量设置的更改可能不会影响池中已有的连接。</font><font style="vertical-align: inherit;">例如，修改LDAP服务器主机，端口或TLS设置不会影响现有连接。</font><font style="vertical-align: inherit;">但是，如果原始变量值无效并且无法初始化连接缓冲池，则插件会尝试重新初始化下一个LDAP请求的缓冲池。</font><font style="vertical-align: inherit;">在这种情况下，新的系统变量值用于重新初始化尝试。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            禁用池化，插件打开的每个LDAP连接都使用系统变量当时具有的值。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_log_status"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_log_status"><code class="literal">authentication_ldap_sasl_log_status</code></a>
</p><a class="indexterm" name="idm140528114850032"></a><a class="indexterm" name="idm140528114848992"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_log_status"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-log-status=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_log_status">authentication_ldap_sasl_log_status</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">5</code></td>
</tr></tbody></table>
</div>
<a class="indexterm" name="idm140528114814800"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，记录级别。</font><font style="vertical-align: inherit;">下表显示了允许的等级值及其含义。
</font></font></p>
<div class="table">
<a name="idm140528114812736"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.20 authentication_ldap_sasl_log_status的日志级别</font></font></b></p>
<div class="table-contents">
<table summary="authentication_ldap_sasl_log_status system variable option values and types of messages logged per value."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期权价值</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录的消息类型</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">1</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有消息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">2</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">3</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误和警告消息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">4</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误，警告和信息消息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">5</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有消息</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><a class="indexterm" name="idm140528114792720"></a><a class="indexterm" name="idm140528114791232"></a><a class="indexterm" name="idm140528114790128"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在客户端，可以通过设置</font></font><code class="literal">AUTHENTICATION_LDAP_CLIENT_LOG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            环境变量</font><font style="vertical-align: inherit;">将消息记录到标准输出中
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">允许值和默认值与for相同
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_log_status"><code class="literal">authentication_ldap_sasl_log_status</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">AUTHENTICATION_LDAP_CLIENT_LOG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            环境变量仅适用于SASL LDAP身份验证。</font><font style="vertical-align: inherit;">它对简单的LDAP认证没有效果，因为这种情况下的客户端插件
             </font></font><code class="literal">mysql_clear_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对LDAP操作一无所知。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_max_pool_size"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size</code></a>
</p><a class="indexterm" name="idm140528114781312"></a><a class="indexterm" name="idm140528114780272"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_max_pool_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-max-pool-size=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_max_pool_size">authentication_ldap_sasl_max_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">32767</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，连接到LDAP服务器的池的最大大小。</font><font style="vertical-align: inherit;">要禁用连接池，请将此变量设置为0。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量与...一起使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_init_pool_size"><code class="literal">authentication_ldap_sasl_init_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅该变量的说明。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_server_host"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_server_host"><code class="literal">authentication_ldap_sasl_server_host</code></a>
</p><a class="indexterm" name="idm140528114741056"></a><a class="indexterm" name="idm140528114740016"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_server_host"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-server-host=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_server_host">authentication_ldap_sasl_server_host</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，LDAP服务器主机。</font><font style="vertical-align: inherit;">此变量的允许值取决于身份验证方法：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_auth_method_name"><code class="literal">authentication_ldap_sasl_auth_method_name=SCRAM-SHA-1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：LDAP服务器主机可以是主机名或IP地址。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_server_port"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_server_port"><code class="literal">authentication_ldap_sasl_server_port</code></a>
</p><a class="indexterm" name="idm140528114709280"></a><a class="indexterm" name="idm140528114708240"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_server_port"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-server-port=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_server_port">authentication_ldap_sasl_server_port</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">389</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">32376</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，LDAP服务器TCP / IP端口号。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_tls"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_tls"><code class="literal">authentication_ldap_sasl_tls</code></a>
</p><a class="indexterm" name="idm140528114671104"></a><a class="indexterm" name="idm140528114670000"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_tls"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-tls=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_tls">authentication_ldap_sasl_tls</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，插件到LDAP服务器的连接是否安全。</font><font style="vertical-align: inherit;">如果启用此变量，则该插件使用TLS安全地连接到LDAP服务器。</font><font style="vertical-align: inherit;">如果你启用这个变量，你可能也希望设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_ca_path"><code class="literal">authentication_ldap_sasl_ca_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            变量。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL LDAP插件支持StartTLS方法，它在普通的LDAP连接之上初始化TLS。</font><font style="vertical-align: inherit;">该
             </font></font><code class="literal">ldaps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法已被弃用，MySQL不支持它。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_user_search_attr"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_user_search_attr"><code class="literal">authentication_ldap_sasl_user_search_attr</code></a>
</p><a class="indexterm" name="idm140528114636128"></a><a class="indexterm" name="idm140528114635008"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_user_search_attr"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-user-search-attr=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_user_search_attr">authentication_ldap_sasl_user_search_attr</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">uid</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于SASL LDAP认证，指定在LDAP目录条目中指定用户名的属性的名称。</font><font style="vertical-align: inherit;">如果未提供用户专有名称，则身份验证插件将使用此属性搜索名称。</font><font style="vertical-align: inherit;">例如，如果该
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_sasl_user_search_attr"><code class="literal">authentication_ldap_sasl_user_search_attr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值为</font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则搜索用户名将
             </font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找</font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为的</font><font style="vertical-align: inherit;">条目
             </font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_auth_method_name"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_auth_method_name"><code class="literal">authentication_ldap_simple_auth_method_name</code></a>
</p><a class="indexterm" name="idm140528114599472"></a><a class="indexterm" name="idm140528114598352"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_auth_method_name"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-auth-method-name=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_auth_method_name">authentication_ldap_simple_auth_method_name</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">SIMPLE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP认证，认证方法名称。</font><font style="vertical-align: inherit;">身份验证插件和LDAP服务器之间的通信根据此身份验证方法进行。</font><font style="vertical-align: inherit;">这些认证方法值是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">SIMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：此验证方法使用一个或两个LDAP绑定操作，具体取决于MySQL帐户是否命名LDAP用户专有名称。</font><font style="vertical-align: inherit;">请参阅说明
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_dn"><code class="literal">authentication_ldap_simple_bind_root_dn</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">AD-FOREST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
                 </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索Active Directory林中的所有域，对每个Active Directory域执行LDAP绑定，直到在某个域中找到用户。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于简单的LDAP验证，建议还要设置TLS参数，以要求通过安全连接与LDAP服务器进行通信。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_base_dn"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_base_dn"><code class="literal">authentication_ldap_simple_bind_base_dn</code></a>
</p><a class="indexterm" name="idm140528114560112"></a><a class="indexterm" name="idm140528114559072"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_base_dn"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-bind-base-dn=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_base_dn">authentication_ldap_simple_bind_base_dn</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单LDAP身份验证，基本专有名称（DN）。</font><font style="vertical-align: inherit;">通过将这些变量锚定在</font><font style="vertical-align: inherit;">搜索树</font><font style="vertical-align: inherit;">中的某个位置（</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基础</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font><font style="vertical-align: inherit;">可以使用此变量来限制搜索范围
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设一组LDAP用户条目的成员都有这种形式：
          </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uid = </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，pwd = </font></font><em class="replaceable"><code>user_password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，ou = People，dc = example，dc = com
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            另一组LDAP用户条目的成员都有这种形式：
          </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uid = </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，pwd = </font></font><em class="replaceable"><code>user_password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，ou = Admin，dc = example，dc = com
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            然后搜索就像这样处理不同的基本DN值：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果基本DN是
                 </font></font><code class="literal">ou=People,dc=example,dc=com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：搜索仅在第一组中查找用户条目。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果基本DN是
                 </font></font><code class="literal">ou=Admin,dc=example,dc=com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：搜索仅在第二组中查找用户条目。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果基本DN是
                 </font></font><code class="literal">ou=dc=example,dc=com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：搜索查找第一组或第二组中的用户条目。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常，更具体的基准DN值会导致更快的搜索，因为它们会更多地限制搜索范围。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_root_dn"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_dn"><code class="literal">authentication_ldap_simple_bind_root_dn</code></a>
</p><a class="indexterm" name="idm140528114516336"></a><a class="indexterm" name="idm140528114515296"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_root_dn"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-bind-root-dn=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_dn">authentication_ldap_simple_bind_root_dn</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP认证，根专有名称（DN）。</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_pwd"><code class="literal">authentication_ldap_simple_bind_root_pwd</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了执行搜索，</font><font style="vertical-align: inherit;">此变量与</font><font style="vertical-align: inherit;">用于向LDAP服务器进行身份验证的凭据</font><font style="vertical-align: inherit;">一起使用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">身份验证使用一个或两个LDAP绑定操作，具体取决于MySQL帐户是否命名LDAP用户DN：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果该帐户未命名用户DN：
                 </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_dn"><code class="literal">authentication_ldap_simple_bind_root_dn</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                和
                 </font><font style="vertical-align: inherit;">执行初始LDAP绑定
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_pwd"><code class="literal">authentication_ldap_simple_bind_root_pwd</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这些默认情况下都是空的，所以如果它们没有设置，那么LDAP服务器必须允许匿名连接。）得到的绑定LDAP句柄用于根据客户端用户名搜索用户DN。
                </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户DN和客户端提供的密码执行第二个绑定。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果帐户名称为用户DN：在这种情况下，第一次绑定操作是不必要的。
                </font></font><code class="literal">authentication_ldap_simple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户DN和客户端提供的密码执行单一绑定。</font><font style="vertical-align: inherit;">这比如果MySQL帐户没有指定LDAP用户DN更快。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_root_pwd"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_pwd"><code class="literal">authentication_ldap_simple_bind_root_pwd</code></a>
</p><a class="indexterm" name="idm140528114474944"></a><a class="indexterm" name="idm140528114473824"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_root_pwd"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-bind-root-pwd=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_pwd">authentication_ldap_simple_bind_root_pwd</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单LDAP身份验证，使用根专有名称的密码。</font><font style="vertical-align: inherit;">这个变量与...一起使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_bind_root_dn"><code class="literal">authentication_ldap_simple_bind_root_dn</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅该变量的说明。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_ca_path"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_ca_path"><code class="literal">authentication_ldap_simple_ca_path</code></a>
</p><a class="indexterm" name="idm140528114441200"></a><a class="indexterm" name="idm140528114440160"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_ca_path"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-ca-path=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_ca_path">authentication_ldap_simple_ca_path</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP验证，证书颁发机构文件的绝对路径。</font><font style="vertical-align: inherit;">如果需要身份验证插件执行LDAP服务器证书验证，请指定此文件。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              除了将</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_ca_path"><code class="literal">authentication_ldap_simple_ca_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              变量</font><font style="vertical-align: inherit;">设置为
               </font><font style="vertical-align: inherit;">文件名之外，还必须将相应的证书颁发机构证书添加到文件并启用
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_tls"><code class="literal">authentication_ldap_simple_tls</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_group_search_attr"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_group_search_attr"><code class="literal">authentication_ldap_simple_group_search_attr</code></a>
</p><a class="indexterm" name="idm140528114405264"></a><a class="indexterm" name="idm140528114404144"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_group_search_attr"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-group-search-attr=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_group_search_attr">authentication_ldap_simple_group_search_attr</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">cn</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单LDAP身份验证，指定在LDAP目录条目中指定组名称的属性的名称。</font><font style="vertical-align: inherit;">如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_group_search_attr"><code class="literal">authentication_ldap_simple_group_search_attr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有其默认值</font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，搜索将返回</font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值作为组名称。</font><font style="vertical-align: inherit;">例如，如果有一个LDAP项</font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的值</font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有
             </font></font><code class="literal">cn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的属性
             </font></font><code class="literal">mygroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，搜索
             </font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><code class="literal">mygroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的组名。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7.21开始，如果组搜索属性是
             </font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP身份验证，则直接检索用户属性</font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值并将其分配为组信息。</font><font style="vertical-align: inherit;">如果组搜索属性不是</font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，LDAP认证会搜索用户所属的所有组。</font><font style="vertical-align: inherit;">（后者是缺省行为。）此行为基于如何以两种方式存储LDAP组信息：1）组条目可以具有名为的属性
             </font></font><code class="literal">memberUid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">member</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            具有用户名值; </font><font style="vertical-align: inherit;">2）用户条目可以有一个属性</font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其值是组名。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_group_search_filter"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_group_search_filter"><code class="literal">authentication_ldap_simple_group_search_filter</code></a>
</p><a class="indexterm" name="idm140528114360480"></a><a class="indexterm" name="idm140528114359360"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_group_search_filter"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-group-search-filter=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_group_search_filter">authentication_ldap_simple_group_search_filter</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">(|(&amp;(objectClass=posixGroup)(memberUid=%s))(&amp;(objectClass=group)(member=%s)))</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP认证，自定义组搜索过滤器。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7.22开始，搜索过滤器值现在可以包含
             </font></font><code class="literal">{UA}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">{UD}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记以表示用户名和完整用户DN。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">{UA}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用一个用户名</font><font style="vertical-align: inherit;">替换</font></font><code class="literal">"admin"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而
             </font></font><code class="literal">{UD}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用一个使用完整的DN代替，例如
             </font></font><code class="literal">"uid=admin,ou=People,dc=example,dc=com"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下值是默认值，它同时支持OpenLDAP和Active Directory：
          </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（|（＆（objectClass的= posixGroup）（memberUid = {UA}））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （＆（objectClass的=基团）（成员= {} UD）））</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以前，如果组搜索属性是
             </font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">memberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则将其视为具有组信息的用户属性。</font><font style="vertical-align: inherit;">但是，在某些情况下，对于用户场景，</font></font><code class="literal">memberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个不包含组信息的简单用户属性。</font><font style="vertical-align: inherit;">为了获得更大的灵活性，</font></font><code class="literal">{GA}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            现在可以为组搜索属性使用</font><font style="vertical-align: inherit;">可选的</font><font style="vertical-align: inherit;">前缀。</font><font style="vertical-align: inherit;">（以前，假设如果组搜索属性是</font><font style="vertical-align: inherit;">，如果组值是DN，则组DN的第一个属性值作为组名返回。
          </font></font><code class="literal">isMemberOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的，现在任何带有{GA}前缀的组属性被视为具有组名称的用户属性）。例如，值为
            </font></font><code class="literal">{GA}MemberOf</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.21中，搜索过滤器使用了
             </font></font><code class="literal">%s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符号，将其扩展为用于OpenLDAP（</font></font><code class="literal">&amp;(objectClass=posixGroup)(memberUid=%s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的用户名</font><font style="vertical-align: inherit;">和用于Active Directory（</font></font><code class="literal">&amp;(objectClass=group)(member=%s)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的完整用户DN </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_init_pool_size"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_init_pool_size"><code class="literal">authentication_ldap_simple_init_pool_size</code></a>
</p><a class="indexterm" name="idm140528114313744"></a><a class="indexterm" name="idm140528114312624"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_init_pool_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-init-pool-size=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_init_pool_size">authentication_ldap_simple_init_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">32767</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP验证，LDAP服务器连接池的初始大小。</font><font style="vertical-align: inherit;">根据到LDAP服务器的并发身份验证请求的平均数选择此变量的值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该插件使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_init_pool_size"><code class="literal">authentication_ldap_simple_init_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一起进行连接池管理：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当身份验证插件初始化时，它会创建
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_init_pool_size"><code class="literal">authentication_ldap_simple_init_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                连接，除非
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                禁用池。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果插件在当前连接池中没有空闲连接时收到一个身份验证请求，则该插件可以创建一个新连接，直到达到最大连接池大小为止
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果插件在池大小已达到最大值且没有空闲连接时收到请求，则认证失败。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当插件卸载时，它会关闭所有连接池。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            插件系统变量设置的更改可能不会影响池中已有的连接。</font><font style="vertical-align: inherit;">例如，修改LDAP服务器主机，端口或TLS设置不会影响现有连接。</font><font style="vertical-align: inherit;">但是，如果原始变量值无效并且无法初始化连接缓冲池，则插件会尝试重新初始化下一个LDAP请求的缓冲池。</font><font style="vertical-align: inherit;">在这种情况下，新的系统变量值用于重新初始化尝试。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            禁用池化，插件打开的每个LDAP连接都使用系统变量当时具有的值。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_log_status"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_log_status"><code class="literal">authentication_ldap_simple_log_status</code></a>
</p><a class="indexterm" name="idm140528114260832"></a><a class="indexterm" name="idm140528114259792"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_log_status"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-log-status=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_log_status">authentication_ldap_simple_log_status</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">5</code></td>
</tr></tbody></table>
</div>
<a class="indexterm" name="idm140528114225664"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP认证，日志级别。</font><font style="vertical-align: inherit;">下表显示了允许的等级值及其含义。
</font></font></p>
<div class="table">
<a name="idm140528114223600"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.21 authentication_ldap_simple_log_status的日志级别</font></font></b></p>
<div class="table-contents">
<table summary="authentication_ldap_simple_log_status system variable option values and types of messages logged per value."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期权价值</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录的消息类型</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">1</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有消息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">2</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">3</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误和警告消息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">4</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误，警告和信息消息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">5</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有消息</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_max_pool_size"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size</code></a>
</p><a class="indexterm" name="idm140528114200960"></a><a class="indexterm" name="idm140528114199840"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_max_pool_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-max-pool-size=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_max_pool_size">authentication_ldap_simple_max_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">32767</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP认证，连接到LDAP服务器的池的最大大小。</font><font style="vertical-align: inherit;">要禁用连接池，请将此变量设置为0。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量与...一起使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_init_pool_size"><code class="literal">authentication_ldap_simple_init_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅该变量的说明。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_server_host"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_server_host"><code class="literal">authentication_ldap_simple_server_host</code></a>
</p><a class="indexterm" name="idm140528114160576"></a><a class="indexterm" name="idm140528114159536"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_server_host"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-server-host=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_server_host">authentication_ldap_simple_server_host</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP认证，LDAP服务器主机。</font><font style="vertical-align: inherit;">此变量的允许值取决于身份验证方法：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_auth_method_name"><code class="literal">authentication_ldap_simple_auth_method_name=SIMPLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：LDAP服务器主机可以是主机名或IP地址。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                因为
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_auth_method_name"><code class="literal">authentication_ldap_simple_auth_method_name=AD-FOREST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">LDAP服务器主机可以是Active Directory域名。</font><font style="vertical-align: inherit;">例如，对于LDAP服务器的URL
                 </font></font><code class="literal">ldap://example.mem.local:389</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，服务器名称可以是</font></font><code class="literal">mem.local</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Active Directory林设置可以具有多个域（LDAP服务器IP），可以使用DNS发现这些域。</font><font style="vertical-align: inherit;">在Unix和类似Unix的系统上，可能需要一些额外的设置来为您的DNS服务器配置指定Active Directory域的LDAP服务器的SRV记录。</font><font style="vertical-align: inherit;">假设你的配置有这些属性：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    提供有关Active Directory域的信息的名称服务器具有IP地址
                     </font></font><code class="literal">10.172.166.100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                  </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    该LDAP服务器都有名称
                     </font></font><code class="literal">ldap1.mem.local</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过
                     </font></font><code class="literal">ldap3.mem.local</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和IP地址
                     </font></font><code class="literal">10.172.166.101</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过
                     </font></font><code class="literal">10.172.166.103</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                您希望使用SRV搜索来发现LDAP服务器。</font><font style="vertical-align: inherit;">例如，在命令行中，像这样的命令应该列出LDAP服务器：
              </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">host -t SRV _ldap._tcp.mem.local
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                按如下所示执行DNS配置：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    添加一行以</font></font><code class="filename">/etc/resolv.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    指定提供有关Active Directory域信息的名称服务器：
                  </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称服务器10.172.166.100
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    使用LDAP服务器的SRV记录为名称服务器配置适当的区域文件：
                  </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_ldap._tcp.mem.local。</font><font style="vertical-align: inherit;">86400 IN SRV 0 100 389 ldap1.mem.local。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
_ldap._tcp.mem.local。</font><font style="vertical-align: inherit;">86400 IN SRV 0 100 389 ldap2.mem.local。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
_ldap._tcp.mem.local。</font><font style="vertical-align: inherit;">86400 IN SRV 0 100 389 ldap3.mem.local。</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="filename">/etc/hosts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果无法解析服务器主机</font><font style="vertical-align: inherit;">
                    ，</font><font style="vertical-align: inherit;">则</font><font style="vertical-align: inherit;">可能还需要指定LDAP服务器的IP地址
                     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，将如下所示的行添加到文件中：
                  </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.172.166.101 ldap1.mem.local</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10.172.166.102 ldap2.mem.local</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10.172.166.103 ldap3.mem.local</font></font><font></font>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                通过刚刚描述的DNS配置，服务器端LDAP插件可以发现LDAP服务器，并将尝试在所有域中进行身份验证，直到身份验证成功或没有更多服务器。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Windows不需要如上所述的设置。</font><font style="vertical-align: inherit;">给定值中的LDAP服务器主机
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_server_host"><code class="literal">authentication_ldap_simple_server_host</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ，Windows LDAP库将搜索所有域并尝试进行身份验证。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_server_port"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_server_port"><code class="literal">authentication_ldap_simple_server_port</code></a>
</p><a class="indexterm" name="idm140528114104896"></a><a class="indexterm" name="idm140528114103856"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_server_port"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-server-port=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_server_port">authentication_ldap_simple_server_port</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">389</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">32376</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP认证，LDAP服务器的TCP / IP端口号。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_tls"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_tls"><code class="literal">authentication_ldap_simple_tls</code></a>
</p><a class="indexterm" name="idm140528114066720"></a><a class="indexterm" name="idm140528114065616"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_tls"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-tls=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_tls">authentication_ldap_simple_tls</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单的LDAP认证，插件与LDAP服务器的连接是否安全。</font><font style="vertical-align: inherit;">如果启用此变量，则该插件使用TLS安全地连接到LDAP服务器。</font><font style="vertical-align: inherit;">如果你启用这个变量，你可能也希望设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_ca_path"><code class="literal">authentication_ldap_simple_ca_path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            变量。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL LDAP插件支持StartTLS方法，它在普通的LDAP连接之上初始化TLS。</font><font style="vertical-align: inherit;">该
             </font></font><code class="literal">ldaps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法已被弃用，MySQL不支持它。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_user_search_attr"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_user_search_attr"><code class="literal">authentication_ldap_simple_user_search_attr</code></a>
</p><a class="indexterm" name="idm140528114031776"></a><a class="indexterm" name="idm140528114030656"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_user_search_attr"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--authentication-ldap-simple-user-search-attr=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_user_search_attr">authentication_ldap_simple_user_search_attr</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">uid</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于简单LDAP认证，指定在LDAP目录条目中指定用户名的属性的名称。</font><font style="vertical-align: inherit;">如果未提供用户专有名称，则身份验证插件将使用此属性搜索名称。</font><font style="vertical-align: inherit;">例如，如果该
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_authentication_ldap_simple_user_search_attr"><code class="literal">authentication_ldap_simple_user_search_attr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值为</font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则搜索用户名将
             </font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找</font></font><code class="literal">uid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为的</font><font style="vertical-align: inherit;">条目
             </font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="connection-control"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.2连接控制插件</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#connection-control-installation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.2.1连接控制插件安装</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#connection-control-variables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.2.2连接控制系统和状态变量</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从MySQL 5.7.17开始，MySQL服务器包含一个插件库，使管理员能够在一定数量的连续失败的连接尝试后，为客户端引入服务器响应的延迟。</font><font style="vertical-align: inherit;">这种能力提供了一种威慑力，可以减缓企图访问MySQL用户帐户的强力攻击。</font><font style="vertical-align: inherit;">插件库包含两个插件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查传入连接并根据需要向服务器响应添加延迟。</font><font style="vertical-align: inherit;">这个插件还公开了系统变量，使其操作能够被配置，并提供一个状态变量来提供基本的监视信息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件使用审计插件界面（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#writing-audit-plugins" title="28.2.4.8编写审计插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.2.4.8节“编写审计插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">为了收集信息，它订阅了
           </font></font><code class="literal">MYSQL_AUDIT_CONNECTION_CLASSMASK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件类以及进程
           </font></font><code class="literal">MYSQL_AUDIT_CONNECTION_CONNECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和子
           </font></font><code class="literal">MYSQL_AUDIT_CONNECTION_CHANGE_USER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          事件，以检查服务器是否应该在响应客户端连接尝试之前引入延迟。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          实现了一个</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">表格公开了连接尝试失败的更详细的监视信息。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下部分提供了有关连接控制插件安装和配置的信息。</font><font style="vertical-align: inherit;">有关该</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#connection-control-failed-login-attempts-table" title="24.33.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表的</font><font style="vertical-align: inherit;">信息
       </font><font style="vertical-align: inherit;">，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/information-schema.html#connection-control-failed-login-attempts-table" title="24.33.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第24.33.1节“INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="connection-control-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.2.1连接控制插件安装</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528113982336"></a><a class="indexterm" name="idm140528113980832"></a><a class="indexterm" name="idm140528113979344"></a><a class="indexterm" name="idm140528113977824"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何安装连接控制插件，</font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
         </font></font><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果打算将密钥环用户定义函数（UDF）与密钥环插件配合使用，请使用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理函数”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的说明安装密钥环安装后的UDF
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插件库文件的基本名称是
         </font></font><code class="literal">connection_control</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个平台的文件名后缀都不相同（例如，</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Unix和类Unix系统，</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Windows）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在服务器启动时加载插件，请使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它们的库文件。</font><font style="vertical-align: inherit;">使用这种插件加载方法，每次服务器启动时都必须给出选项。</font><font style="vertical-align: inherit;">例如，将这些行放在</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        文件中（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">平台</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">后缀）：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= connection_control.so</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或者，要在运行时注册插件，请使用以下语句（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装插件CONNECTION_CONTROL SONAME'connection_control.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装插件CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS SONAME'connection_control.so';</font></font><font></font>
</pre><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载一个插件，并且将它注册到</font></font><code class="literal">mysql.plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统表中，以使该插件被加载用于每个​​随后的正常服务器启动。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要验证插件安装，请检查该
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'connection%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
------------------------------------------ + ------ + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
------------------------------------------ + ------ + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CONNECTION_CONTROL | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
------------------------------------------ + ------ + --------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果插件未能初始化，请检查服务器错误日志以获取诊断消息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果插件之前已经注册
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者已经加载
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以</font><font style="vertical-align: inherit;">
        在服务器启动时</font><font style="vertical-align: inherit;">使用</font></font><code class="option">--connection-control</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="option">--connection-control-failed-login-attempts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来控制插件激活。</font><font style="vertical-align: inherit;">例如，要在启动时加载插件并防止它们在运行时被删除，请使用以下选项：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= connection_control.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
连接控制= FORCE_PLUS_PERMANENT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
连接控制失败的登录者试图= FORCE_PLUS_PERMANENT</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果希望在没有给定连接控制插件的情况下防止服务器运行，请使用选项值
         </font></font><code class="literal">FORCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">FORCE_PLUS_PERMANENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制插件未成功初始化时服务器启动失败。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以安装一个没有其他插件的插件，但两者都必须安装完全的连接控制功能。</font><font style="vertical-align: inherit;">特别是，仅安装
           </font></font><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件几乎没有用处，因为如果
           </font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件没有提供填充</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#connection-control-failed-login-attempts-table" title="24.33.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表</font><font style="vertical-align: inherit;">的数据，则
           </font><font style="vertical-align: inherit;">表中的检索将始终为空。
</font></font></p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-control-plugin-delay-configuration" title="连接延迟配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接延迟配置</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-control-plugin-failure-assessment" title="连接失败评估"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接失败评估</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-control-plugin-failure-monitoring" title="连接失败监控"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接失败监控</font></font></a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="connection-control-plugin-delay-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接延迟配置</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了使您能够配置其操作，该
           </font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件公开了几个系统变量：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：在服务器为后续连接尝试添加延迟之前，允许客户端连续失败的连接尝试次数。
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：每个超过阈值的连续连接失败添加的延迟量。
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：要添加的最大延迟时间。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要完全禁用连接尝试失败检查，请将其设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为零。</font><font style="vertical-align: inherit;">如果
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不为零，则通过连续多次失败的连接尝试延迟量为零。</font><font style="vertical-align: inherit;">此后，延迟量是超过阈值的失败尝试次数乘以
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          毫秒。</font><font style="vertical-align: inherit;">例如，用默认
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和
          </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值分别为3和1000，客户端的前三次连续失败连接尝试没有延迟，第四次失败尝试延迟1000毫秒，第五次失败尝试延迟2000毫秒等等，直到由...允许的最大延迟
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以</font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动或运行时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">假设您希望在服务器启动延迟其响应之前允许连续四次失败的连接尝试，并且之后每增加一次失败，延迟时间将增加1500毫秒。</font><font style="vertical-align: inherit;">要在服务器启动时设置相关变量，请将这些行放在</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= connection_control.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
connection_control_failed_connections_threshold = 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
connection_control_min_connection_delay = 1500</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在运行时设置变量，请使用以下语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL connection_control_failed_connections_threshold = 4;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL connection_control_min_connection_delay = 1500;</font></font><font></font>
</pre><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET
          GLOBAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置正在运行的MySQL实例的值。</font><font style="vertical-align: inherit;">要使更改永久化，请在</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">添加一行
           </font><font style="vertical-align: inherit;">，如前所示。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          的
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量具有固定的最小和的分别在1000和2147483647，最大值。</font><font style="vertical-align: inherit;">另外，每个变量的允许值范围还取决于另一个变量的当前值：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              不能大于当前值
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              不能小于当前值
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因此，要进行某些配置所需的更改，可能需要按特定顺序设置变量。</font><font style="vertical-align: inherit;">假设当前的最小和最大延迟是1000和2000，并且您希望将它们设置为3000和5000.您不能先设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为3000，因为它大于当前
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值2000.而是设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为5000，然后设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          到3000。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="connection-control-plugin-failure-assessment"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接失败评估</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当</font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装插件，它会检查连接尝试，并跟踪他们是否成功或失败。</font><font style="vertical-align: inherit;">为此，失败的连接尝试是客户端用户和主机与已知MySQL帐户匹配的连接尝试，但提供的凭据不正确或与任何已知帐户不匹配。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          失败连接计数基于每次连接尝试的用户/主机组合。</font><font style="vertical-align: inherit;">确定适用的用户名和主机名需要考虑代理并发生如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果客户端用户代理另一个用户，则使用代理用户的信息。</font><font style="vertical-align: inherit;">例如，如果
               </font></font><code class="literal">external_user@example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理
               </font></font><code class="literal">proxy_user@example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，连接计数使用代理用户
               </font></font><code class="literal">external_user@example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是代理用户，
               </font></font><code class="literal">proxy_user@example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">双方
               </font></font><code class="literal">external_user@example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
               </font></font><code class="literal">proxy_user@example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须拥有有效的条目中的</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统表和它们之间的代理关系，必须在定义</font></font><code class="literal">mysql.proxies_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统表（见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10，“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果客户端用户不代理另一个用户，但与</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目</font><font style="vertical-align: inherit;">匹配</font><font style="vertical-align: inherit;">，则counting使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与该条目相对应</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">例如，如果</font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从主机连接
               </font><font style="vertical-align: inherit;">的用户
               </font></font><code class="literal">host1.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配
               </font></font><code class="literal">user1@host1.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目，则使用计数</font></font><code class="literal">user1@host1.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果用户相匹配的</font></font><code class="literal">user1@%.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">user1@%.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">user1@%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入相反，统计用途
               </font></font><code class="literal">user1@%.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">user1@%.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
               </font></font><code class="literal">user1@%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于刚描述的情况，连接尝试匹配某个</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目，并且请求是成功还是失败取决于客户端是否提供了正确的身份验证凭证。</font><font style="vertical-align: inherit;">例如，如果客户端显示的密码不正确，则连接尝试失败。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果连接尝试不匹配任何
           </font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目，则尝试失败。</font><font style="vertical-align: inherit;">在这种情况下，没有</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值可用，并且连接失败计数使用由服务器确定的由客户端和客户端主机提供的用户名。</font><font style="vertical-align: inherit;">例如，如果客户端尝试以用户身份</font></font><code class="literal">user2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从主机
           </font><font style="vertical-align: inherit;">连接</font></font><code class="literal">host2.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则用户名部分在客户端请求中可用，并且服务器确定主机信息。</font><font style="vertical-align: inherit;">用于计数的用户/主机组合是</font></font><code class="literal">user2@host2.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器维护关于哪些客户端主机可能连接到服务器的信息（实质上是</font></font><code class="literal">mysql.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目</font><font style="vertical-align: inherit;">主机值的联合</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果客户端尝试从任何其他主机连接，则服务器会在连接建立的早期阶段拒绝尝试：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1130（HY000）：主机' </font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'不是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
允许连接到这个MySQL服务器</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            因为这种拒绝发生得如此之早，
             </font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有看到它，也没有数过它。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="connection-control-plugin-failure-monitoring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接失败监控</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要监视失败的连接，请使用以下信息来源：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Connection_control_delay_generated"><code class="literal">Connection_control_delay_generated</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              状态变量表示的次数增加服务器的延迟到其失败的连接尝试的响应。</font><font style="vertical-align: inherit;">这不会计算在达到由</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">定义的阈值之前发生的尝试次数
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">INFORMATION_SCHEMA</code>
              <a class="link" href="/mysql-5.7-google-zh/information-schema.html#connection-control-failed-login-attempts-table" title="24.33.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表提供有关每个客户端用户/主机组合的连续失败连接尝试次数的信息。</font><font style="vertical-align: inherit;">这个计算所有失败的尝试，不管它们是否延迟。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在运行时</font><font style="vertical-align: inherit;">
          分配一个值可将
           </font><font style="vertical-align: inherit;">所有累计失效连接计数器重置为零，这具有以下可见效果：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Connection_control_delay_generated"><code class="literal">Connection_control_delay_generated</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              状态变量被重置为零。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该
               </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#connection-control-failed-login-attempts-table" title="24.33.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表变为空。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="connection-control-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.2.2连接控制系统和状态变量</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍</font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件提供</font><font style="vertical-align: inherit;">的系统和状态变量，
         </font><font style="vertical-align: inherit;">以便对其操作进行配置和监控。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-control-plugin-system-variables" title="连接控制系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接控制系统变量</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-control-plugin-status-variables" title="连接控制状态变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接控制状态变量</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="connection-control-plugin-system-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接控制系统变量</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113837088"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件已安装，它会公开这些系统变量：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_connection_control_failed_connections_threshold"></a>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
</p><a class="indexterm" name="idm140528113831824"></a><a class="indexterm" name="idm140528113830704"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for connection_control_failed_connections_threshold"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--connection-control-failed-connections-threshold=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.17</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold">connection_control_failed_connections_threshold</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">3</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">2147483647</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在服务器为后续连接尝试添加延迟之前，客户端连续尝试失败的连接尝试次数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  如果该变量具有非零值
                   </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则服务器将以连续失败尝试</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+1 </font><font style="vertical-align: inherit;">开始添加延迟
                   </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果客户端已达到连接响应延迟的时间点，则延迟也会发生在下一次后续成功连接。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  将此变量设置为零将禁用失败连接计数。</font><font style="vertical-align: inherit;">在这种情况下，服务器永远不会增加延迟。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关如何</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与其他连接控制系统和状态变量交互的</font><font style="vertical-align: inherit;">信息
               </font><font style="vertical-align: inherit;">，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-control-installation" title="6.5.2.1连接控制插件安装"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.2.1节“连接控制插件安装”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_connection_control_max_connection_delay"></a>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>
</p><a class="indexterm" name="idm140528113787248"></a><a class="indexterm" name="idm140528113786208"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for connection_control_max_connection_delay"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--connection-control-max-connection-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.17</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay">connection_control_max_connection_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">2147483647</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">2147483647</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器对连接尝试失败的响应的最大延迟（毫秒）（如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              大于零）。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关如何</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与其他连接控制系统和状态变量交互的</font><font style="vertical-align: inherit;">信息
               </font><font style="vertical-align: inherit;">，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-control-installation" title="6.5.2.1连接控制插件安装"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.2.1节“连接控制插件安装”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_connection_control_min_connection_delay"></a>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
</p><a class="indexterm" name="idm140528113744992"></a><a class="indexterm" name="idm140528113743952"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for connection_control_min_connection_delay"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--connection-control-min-connection-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.17</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay">connection_control_min_connection_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">2147483647</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器对连接尝试失败的响应的最小延迟（毫秒）（如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              大于零）。</font><font style="vertical-align: inherit;">这也是服务器一旦开始延迟就增加延迟以增加连续失败的数量。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关如何</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与其他连接控制系统和状态变量交互的</font><font style="vertical-align: inherit;">信息
               </font><font style="vertical-align: inherit;">，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#connection-control-installation" title="6.5.2.1连接控制插件安装"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.2.1节“连接控制插件安装”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="connection-control-plugin-status-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接控制状态变量</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113703488"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">CONNECTION_CONTROL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件已安装，则会显示此状态变量：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Connection_control_delay_generated"></a>
              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Connection_control_delay_generated"><code class="literal">Connection_control_delay_generated</code></a>
            </p><a class="indexterm" name="idm140528113698176"></a><a class="indexterm" name="idm140528113697136"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器为连接尝试失败响应添加延迟的次数。</font><font style="vertical-align: inherit;">这不会计算在达到由</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">定义的阈值之前发生的尝试次数
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这个变量提供一个简单的计数器 </font><font style="vertical-align: inherit;">有关更详细的连接控制监视信息，请查看
               </font></font><code class="literal">INFORMATION_SCHEMA</code>
              <a class="link" href="/mysql-5.7-google-zh/information-schema.html#connection-control-failed-login-attempts-table" title="24.33.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表格; </font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/information-schema.html#connection-control-failed-login-attempts-table" title="24.33.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第24.33.1节“INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在运行时</font><font style="vertical-align: inherit;">
              分配一个值
               </font><font style="vertical-align: inherit;">重置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Connection_control_delay_generated"><code class="literal">Connection_control_delay_generated</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为零。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这个变量是在MySQL 5.7.17中添加的。
</font></font></p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="validate-password"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.3密码验证插件</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#validate-password-installation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.3.1密码验证插件安装</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#validate-password-options-variables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.3.2密码验证插件选项和变量</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528113684880"></a><a class="indexterm" name="idm140528113683824"></a><a class="indexterm" name="idm140528113682752"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件用于测试密码并提高安全性。</font><font style="vertical-align: inherit;">该插件公开了一组系统变量，使您可以定义密码策略。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件实现了这些功能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在指定提供作为明文值的密码的SQL语句中，插件会根据当前密码策略检查密码，并在密码较弱时拒绝该密码（该语句返回
           </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_not_valid_password"><code class="literal">ER_NOT_VALID_PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误）。</font><font style="vertical-align: inherit;">这适用于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句和密码参数中所给的
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          SQL函数评估潜在的密码强度。</font><font style="vertical-align: inherit;">该函数接受一个密码参数并返回一个从0（弱）到100（强）的整数。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      例如，</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下语句中检查明文密码。</font><font style="vertical-align: inherit;">在缺省密码策略下，要求密码长度至少为8个字符，密码较弱，并且该语句会产生错误：
    </font></font></p><a class="indexterm" name="idm140528113665136"></a><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER USER USER() IDENTIFIED BY 'abc';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1819（HY000）：您的密码不符合当前</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
政策要求</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      由于原始密码值不可用于检查，因此未检查指定为哈希值的密码：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER USER 'jeffrey'@'localhost'</code></strong>
       <strong class="userinput"><code>IDENTIFIED WITH mysql_native_password</code></strong>
       <strong class="userinput"><code>AS '*0D3CED9BEC10A777AEC23CCC353A8C08A633045E';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.01秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要配置密码检查，请修改具有表单名称的系统变量
       </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这些是控制密码策略的参数。</font><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/security.html#validate-password-options-variables" title="6.5.3.2密码验证插件选项和变量"><font style="vertical-align: inherit;">第6.5.3.2节“密码验证插件选项和变量”</font></a><font style="vertical-align: inherit;">。
    </font></font><code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/security.html#validate-password-options-variables" title="6.5.3.2密码验证插件选项和变量"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未安装，则
       </font><font style="vertical-align: inherit;">
      系统变量不可用，未检查语句中的密码，并且该
       </font><font style="vertical-align: inherit;">
      函数始终返回0.例如，如果未安装插件，则可以为帐户分配短于8个字符的密码。
    </font></font><code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      假设</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装后，它会执行三个级别口令检查的：
       </font></font><code class="literal">LOW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">MEDIUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
       </font></font><code class="literal">STRONG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认是
       </font></font><code class="literal">MEDIUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">改变这一点，修改值
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些政策实施日益严格的密码测试。</font><font style="vertical-align: inherit;">以下描述涉及默认参数值，可通过更改相应的系统变量来修改这些参数值。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">LOW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">政策只测试密码长度。</font><font style="vertical-align: inherit;">密码必须至少8个字符。</font><font style="vertical-align: inherit;">要更改此长度，请修改
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">MEDIUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略添加了密码必须至少包含1个数字字符，1个小写字符，1个大写字符和1个特殊（非字母数字）字符的条件。</font><font style="vertical-align: inherit;">要改变这些值，修改
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_number_count"><code class="literal">validate_password_number_count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_mixed_case_count"><code class="literal">validate_password_mixed_case_count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_special_char_count"><code class="literal">validate_password_special_char_count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">STRONG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略添加了长度为4或更长的密码子字符串必须与字典文件中的单词不匹配（如果已指定）的条件。</font><font style="vertical-align: inherit;">要指定字典文件，请修改
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_dictionary_file"><code class="literal">validate_password_dictionary_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      此外，从MySQL 5.7.15开始，
       </font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持拒绝与当前会话的有效用户帐户的用户名部分相匹配的密码，无论是正向还是反向。</font><font style="vertical-align: inherit;">为了提供对此功能的控制，
       </font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将显示一个</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_check_user_name"><code class="literal">validate_password_check_user_name</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      默认启用</font><font style="vertical-align: inherit;">的
       </font><font style="vertical-align: inherit;">系统变量。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="validate-password-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.3.1密码验证插件安装</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528113630208"></a><a class="indexterm" name="idm140528113628704"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何安装
         </font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码验证插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你安装了MySQL 5.7使用
           </font></font><a class="ulink" href="http://dev.mysql.com/downloads/repo/yum/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的百胜库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="ulink" href="http://dev.mysql.com/downloads/repo/suse/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的SLES库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
           </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#linux-installation-rpm" title="2.5.5在Linux上安装MySQL使用Oracle的RPM软件包"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPM包Oracle提供的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，你开始你的MySQL服务器的第一次后使能。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插件库文件的基本名称是
         </font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个平台的文件名后缀都不相同（例如，</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Unix和类Unix系统，</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Windows）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在服务器启动时加载插件，请使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它的库文件。</font><font style="vertical-align: inherit;">使用这种插件加载方法，每次服务器启动时都必须给出选项。</font><font style="vertical-align: inherit;">例如，将这些行放在</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        文件中（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">平台</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">后缀）：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= validate_password.so</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        修改后</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新启动服务器以使新设置生效。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或者，要在运行时注册插件，请使用以下语句（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL PLUGIN validate_password SONAME'validate_password.so';
</font></font></pre><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载插件，并将其注册到</font></font><code class="literal">mysql.plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统表中，以使插件在每个后续正常服务器启动时加载。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要验证插件安装，请检查该
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'validate%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------- + --------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果插件之前已经注册
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者已经加载
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以</font></font><code class="option">--validate-password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时</font><font style="vertical-align: inherit;">使用该</font><font style="vertical-align: inherit;">选项来控制插件激活。</font><font style="vertical-align: inherit;">例如，要在启动时加载插件并防止在运行时将其删除，请使用以下选项：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插件的负载加= validate_password.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
验证密码= FORCE_PLUS_PERMANENT</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果希望防止服务器在没有密码验证插件的情况下运行，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_validate-password"><code class="option">--validate-password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><code class="literal">FORCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">FORCE_PLUS_PERMANENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制插件未成功初始化时强制服务器启动失败。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="validate-password-options-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.3.2密码验证插件选项和变量</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113589408"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍提供的选项，系统变量和状态变量，</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以使其操作能够进行配置和监控。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#validate-password-options" title="密码验证插件选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码验证插件选项</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#validate-password-system-variables" title="密码验证插件系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码验证插件系统变量</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#validate-password-status-variables" title="密码验证插件状态变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码验证插件状态变量</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="validate-password-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码验证插件选项</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113581952"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">的激活
           </font><font style="vertical-align: inherit;">，请使用此选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_validate-password"></a>
              <a class="indexterm" name="idm140528113577984"></a>

              <a class="indexterm" name="idm140528113576528"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_validate-password"><code class="option">--validate-password[=<em class="replaceable"><code>value</code></em>]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate-password"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--validate-password[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ON</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">FORCE</code></p><p class="valid-value"><code class="literal">FORCE_PLUS_PERMANENT</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该选项控制服务器</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启动时</font><font style="vertical-align: inherit;">加载
               </font><font style="vertical-align: inherit;">插件的方式。</font><font style="vertical-align: inherit;">该值应该是可用于插件加载选项的值之一，如
               </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_validate-password"><code class="option">--validate-password=FORCE_PLUS_PERMANENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通知服务器在启动时加载插件，并防止服务器在运行时被删除。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此选项仅在</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件先前已注册</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL
              PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或已加载
               </font><font style="vertical-align: inherit;">时才可用
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#validate-password-installation" title="6.5.3.1密码验证插件安装"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.3.1节“密码验证插件安装”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="validate-password-system-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码验证插件系统变量</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113543344"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件已启用，它会公开几个系统变量，以启用配置密码检查：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'validate_password%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_check_user_name | </font><font style="vertical-align: inherit;">OFF |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_dictionary_file | </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_length | </font><font style="vertical-align: inherit;">8 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_mixed_case_count | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_number_count | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_policy | </font><font style="vertical-align: inherit;">MEDIUM |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_special_char_count | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------- + -------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要更改密码的检查方式，可以在服务器启动时或运行时设置这些系统变量。</font><font style="vertical-align: inherit;">以下列表描述了每个变量的含义。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_validate_password_check_user_name"></a>
              <a class="indexterm" name="idm140528113536496"></a>

              <a class="indexterm" name="idm140528113535456"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_check_user_name"><code class="literal">validate_password_check_user_name</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_check_user_name"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--validate-password-check-user-name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.15</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_check_user_name">validate_password_check_user_name</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是否</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将密码与当前会话的有效用户帐户的用户名部分进行比较，如果匹配则拒绝它们。</font><font style="vertical-align: inherit;">除非</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装，</font><font style="vertical-align: inherit;">否则此变量不可用
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              默认情况下，
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_check_user_name"><code class="literal">validate_password_check_user_name</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              被禁用。</font><font style="vertical-align: inherit;">这个变量控制用户名称的匹配，而不依赖于值
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_check_user_name"><code class="literal">validate_password_check_user_name</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启用时，它具有以下作用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  检查发生在</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被调用的</font><font style="vertical-align: inherit;">所有上下文中
                   </font><font style="vertical-align: inherit;">，其中包括使用诸如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER语法"><code class="literal">ALTER USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                   </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改当前用户密码</font><font style="vertical-align: inherit;">之类的语句
                   </font><font style="vertical-align: inherit;">以及调用诸如</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
                   </font><font style="vertical-align: inherit;">之类的函数
                   </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  用于比较的用户名取自</font><font style="vertical-align: inherit;">
                  当前会话的函数</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  和</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">含义是，拥有足够权限设置其他用户密码的用户可以将密码设置为该用户的名称，并且不能将该用户的密码设置为执行该语句的用户的名称。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">'root'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以设定密码
                   </font></font><code class="literal">'jeffrey'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来
                   </font></font><code class="literal">'jeffrey'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但不能设置密码</font></font><code class="literal">'root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  仅使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数值</font><font style="vertical-align: inherit;">的用户名部分，
                   </font><font style="vertical-align: inherit;">而
                   </font><font style="vertical-align: inherit;">不是主机名部分。</font><font style="vertical-align: inherit;">如果用户名为空，则不会进行比较。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  如果密码与用户名或其相反，则会发生匹配并且密码被拒绝。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  用户名匹配区分大小写。</font><font style="vertical-align: inherit;">密码和用户名值按字节逐字节比较为二进制字符串。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  如果密码与用户名匹配，则</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  不管其他</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量的设置</font><font style="vertical-align: inherit;">如何</font><font style="vertical-align: inherit;">，都
                   </font><font style="vertical-align: inherit;">返回0
                   </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_validate_password_dictionary_file"></a>
              <a class="indexterm" name="idm140528113475696"></a>

              <a class="indexterm" name="idm140528113474656"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_dictionary_file"><code class="literal">validate_password_dictionary_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_dictionary_file"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_dictionary_file">validate_password_dictionary_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.8）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.7）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于检查密码</font><font style="vertical-align: inherit;">
              的字典文件的路径名称
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装，</font><font style="vertical-align: inherit;">否则此变量不可用
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              默认情况下，该变量具有空值，并且不执行字典检查。</font><font style="vertical-align: inherit;">为了进行字典检查，变量值必须是非空的。</font><font style="vertical-align: inherit;">如果文件被命名为相对路径，则相对于服务器数据目录进行解释。</font><font style="vertical-align: inherit;">文件内容应该是小写，每行一个字。</font><font style="vertical-align: inherit;">内容被视为有一个字符集</font></font><code class="literal">utf8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最大允许的文件大小为1MB。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于在密码检查过程中使用的字典文件，密码策略必须设置为2（</font></font><code class="literal">STRONG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）; </font><font style="vertical-align: inherit;">请参阅</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">的说明
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设这是真的，将长度为4到100的密码的每个子字符串与字典文件中的字进行比较。</font><font style="vertical-align: inherit;">任何匹配都会导致密码被拒绝。</font><font style="vertical-align: inherit;">比较不区分大小写。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              因为
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码是根据所有策略进行检查的
               </font></font><code class="literal">STRONG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以包括强度评估在内的词典检查都会包含字典检查，而不管其</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              值</font><font style="vertical-align: inherit;">如何
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_dictionary_file"><code class="literal">validate_password_dictionary_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可以在运行时设置并分配一个值，使得读取指定文件时无需重新启动服务器。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_validate_password_length"></a>
              <a class="indexterm" name="idm140528113437728"></a>

              <a class="indexterm" name="idm140528113436624"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_length"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_length">validate_password_length</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">8</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要密码</font><font style="vertical-align: inherit;">
              的最少字符数
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装，</font><font style="vertical-align: inherit;">否则此变量不可用
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              最小值是其他几个相关的系统变量的函数。</font><font style="vertical-align: inherit;">该值不能小于该表达式的值：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validate_password_number_count</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ validate_password_special_char_count</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+（2 * validate_password_mixed_case_count）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调整</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于前面的约束而产生</font><font style="vertical-align: inherit;">的值
               </font><font style="vertical-align: inherit;">，它会将消息写入错误日志。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_validate_password_mixed_case_count"></a>
              <a class="indexterm" name="idm140528113401456"></a>

              <a class="indexterm" name="idm140528113400416"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_mixed_case_count"><code class="literal">validate_password_mixed_case_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_mixed_case_count"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_mixed_case_count">validate_password_mixed_case_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果密码策略为</font></font><code class="literal">MEDIUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或更强</font><font style="vertical-align: inherit;">
              ，则</font><font style="vertical-align: inherit;">需要密码
               </font><font style="vertical-align: inherit;">的最小数量的小写字符和大写字符</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装，</font><font style="vertical-align: inherit;">否则此变量不可用</font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于给定
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_mixed_case_count"><code class="literal">validate_password_mixed_case_count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              值，密码必须包含许多小写字符以及许多大写字符。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_validate_password_number_count"></a>
              <a class="indexterm" name="idm140528113367904"></a>

              <a class="indexterm" name="idm140528113366800"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_number_count"><code class="literal">validate_password_number_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_number_count"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_number_count">validate_password_number_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码策略为</font></font><code class="literal">MEDIUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              或更强时</font><font style="vertical-align: inherit;">需要密码</font><font style="vertical-align: inherit;">
              的数字（数字）字符的最小数量
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装，</font><font style="vertical-align: inherit;">否则此变量不可用
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_validate_password_policy"></a>
              <a class="indexterm" name="idm140528113336320"></a>

              <a class="indexterm" name="idm140528113335216"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_policy"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_policy">validate_password_policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              密码策略由
               </font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装，</font><font style="vertical-align: inherit;">否则此变量不可用</font><font style="vertical-align: inherit;">。
            </font></font></p><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              影响如何</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用其他策略设置系统变量，除了检查由用户名独立控制的用户名密码外
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_check_user_name"><code class="literal">validate_password_check_user_name</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可使用的数值0，1，2，或相应的符号值来指定值</font></font><code class="literal">LOW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">MEDIUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">STRONG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">下表介绍了针对每个策略执行的测试。</font><font style="vertical-align: inherit;">对于长度测试，所需的长度是</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">的值
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同样，其他测试所需的值由其他</font><font style="vertical-align: inherit;">
              变量</font><font style="vertical-align: inherit;">给出
               </font><font style="vertical-align: inherit;">。
</font></font><code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font></p>
<div class="informaltable">
<table summary="Password policies enforced by the validate_password plugin and the tests performed for each policy."><colgroup><col width="20%"><col width="80%"></colgroup><thead><tr>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">政策</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试已执行</font></font></th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">LOW</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长度</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">MEDIUM</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长度; </font><font style="vertical-align: inherit;">数字，小写/大写和特殊字符</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">STRONG</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长度; </font><font style="vertical-align: inherit;">数字，小写/大写和特殊字符; </font><font style="vertical-align: inherit;">字典文件</font></font></td>
</tr></tbody></table>
</div>
</li><li class="listitem"><p><a name="sysvar_validate_password_special_char_count"></a>
              <a class="indexterm" name="idm140528113276624"></a>

              <a class="indexterm" name="idm140528113275584"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_special_char_count"><code class="literal">validate_password_special_char_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_special_char_count"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_validate_password_special_char_count">validate_password_special_char_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果密码策略为</font></font><code class="literal">MEDIUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              或更强</font><font style="vertical-align: inherit;">
              ，则</font><font style="vertical-align: inherit;">需要密码</font><font style="vertical-align: inherit;">的非字母数字字符的最小数量
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装，</font><font style="vertical-align: inherit;">否则此变量不可用
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="validate-password-status-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码验证插件状态变量</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113244544"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">validate_password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件已启用，它将公开提供操作信息的状态变量：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW STATUS LIKE 'validate_password%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------------------- +  - -------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------------------- +  - -------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_dictionary_file_last_parsed | </font><font style="vertical-align: inherit;">2015-06-29 11:08:51 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">validate_password_dictionary_file_words_count | </font><font style="vertical-align: inherit;">1902 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------------------- +  - -------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下列表描述了每个状态变量的含义。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_validate_password_dictionary_file_last_parsed"></a>
              <a class="indexterm" name="idm140528113237952"></a>

              <a class="indexterm" name="idm140528113236832"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_validate_password_dictionary_file_last_parsed"><code class="literal">validate_password_dictionary_file_last_parsed</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              字典文件最后被解析时。
            </font></font></p></li><li class="listitem"><p><a name="statvar_validate_password_dictionary_file_words_count"></a>
              <a class="indexterm" name="idm140528113232288"></a>

              <a class="indexterm" name="idm140528113231168"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_validate_password_dictionary_file_words_count"><code class="literal">validate_password_dictionary_file_words_count</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从字典文件中读取的单词数量。
</font></font></p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="keyring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4 MySQL Keyring</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-installation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.1安装Keyring插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-file-plugin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.2使用keyring_file基于文件的插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-encrypted-file-plugin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.3使用keyring_encrypted_file Keyring插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-okv-plugin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.4使用keyring_okv KMIP插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-aws-plugin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.5使用keyring_aws Amazon Web Services Keyring插件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-key-migration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.6在密钥环密钥库之间迁移密钥</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-key-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.7支持的密钥环密钥类型</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.8通用密钥环密钥管理功能</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-udfs-plugin-specific"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.9特定于插件的密钥环密钥管理功能</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.10密钥环命令选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#keyring-system-variables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.11钥匙圈系统变量</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528113226064"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL服务器支持密钥环服务，可以使内部服务器组件和插件安全地存储敏感信息以供日后检索。</font><font style="vertical-align: inherit;">该实现是基于插件的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL 5.7.11及更高版本包含一个密钥环插件，
           </font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于将密钥环数据存储在服务器主机本地的文件中。</font><font style="vertical-align: inherit;">该插件适用于所有MySQL发行版，包括Community Edition和Enterprise Edition。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-file-plugin" title="6.5.4.2使用keyring_file基于文件的插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.2节“使用keyring_file基于文件的插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL 5.7.21及更高版本包含一个密钥环插件，
           </font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将密钥环数据存储在服务器主机本地的加密文件中。</font><font style="vertical-align: inherit;">这个插件在MySQL企业版分发版中可用。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-encrypted-file-plugin" title="6.5.4.3使用keyring_encrypted_file Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.3节“使用keyring_encrypted_file Keyring插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL 5.7.12及更高版本包括
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个KMIP 1.1插件，可用于与KMIP兼容的后端密钥环存储产品，如Oracle Key Vault和Gemalto SafeNet KeySecure设备。</font><font style="vertical-align: inherit;">这个插件在MySQL企业版分发版中可用。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-plugin" title="6.5.4.4使用keyring_okv KMIP插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.4节“使用keyring_okv KMIP插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL 5.7.19及更高版本包含
           </font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个插件，该插件与亚马逊网络服务密钥管理服务进行通信以生成密钥并将本地文件用于密钥存储。</font><font style="vertical-align: inherit;">这个插件在MySQL企业版分发版中可用。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-aws-plugin" title="6.5.4.5使用keyring_aws Amazon Web Services Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.5节“使用keyring_aws Amazon Web Services Keyring插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL 5.7.21及更高版本支持服务器操作模式，该模式支持在底层密钥环密钥库之间迁移密钥。</font><font style="vertical-align: inherit;">这使DBA能够将MySQL安装从一个密钥环插件切换到另一个。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL 5.7.13及更高版本包含用于密钥环密钥管理的SQL接口，实现为一组用户定义的函数（UDF）。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密密钥管理插件不打算作为一个合规性解决方案。</font><font style="vertical-align: inherit;">诸如PCI，FIPS和其他安全标准要求使用密钥管理系统来保护，管理和保护密钥库或硬件安全模块（HSM）中的加密密钥。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL中的密钥环的用途包括：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎使用密钥环存储它的表空间加密密钥。
          </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用任何支持的密钥环插件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业审计使用密钥环来存储审计日志文件加密密码。</font><font style="vertical-align: inherit;">审计日志插件可以使用任何支持的密钥环插件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关一般钥匙圈安装说明，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-installation" title="6.5.4.1安装Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.1节“钥匙扣插件安装”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关特定密钥环插件的信息，请参阅描述该插件的部分。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关使用密钥环UDF的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      密钥环插件和UDF访问密钥环服务，为密钥环提供服务器组件的接口。</font><font style="vertical-align: inherit;">有关访问密钥环插件服务和编写密钥环插件的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#writing-keyring-plugins" title="28.2.4.12编写密钥环插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.2.4.12节“编写密钥环插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.1安装Keyring插件</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528113197520"></a><a class="indexterm" name="idm140528113196064"></a><a class="indexterm" name="idm140528113194576"></a><a class="indexterm" name="idm140528113193088"></a><a class="indexterm" name="idm140528113191600"></a><a class="indexterm" name="idm140528113190112"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        钥匙圈服务消费者需要安装密钥环插件。</font><font style="vertical-align: inherit;">MySQL提供了这些插件选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：将密钥环数据存储在服务器主机本地文件中的插件。</font><font style="vertical-align: inherit;">自MySQL 5.7.11起可用于所有MySQL发行版。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：使用KMIP兼容的后端密钥环存储产品（例如Oracle Key Vault和Gemalto SafeNet KeySecure设备）的插件。</font><font style="vertical-align: inherit;">从MySQL 5.7.12开始可用于MySQL企业版分发版。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：一种与亚马逊网络服务密钥管理服务通信的插件，作为密钥生成的后端，并使用本地文件存储密钥。</font><font style="vertical-align: inherit;">从MySQL 5.7.19起可用于MySQL企业版分发版。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何安装您选择的密钥环插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个钥匙圈插件的安装都是类似的。</font><font style="vertical-align: inherit;">以下说明使用</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不同的钥匙环插件的用户可以替换其名称
         </font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件的库文件基本名称是</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个平台的文件名后缀都不相同（例如，</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Unix和类Unix系统，</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Windows）。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一次只能启用一个密钥环插件。</font><font style="vertical-align: inherit;">启用多个密钥环插件不受支持，结果可能不如预期。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        钥匙圈插件必须在服务器启动过程中尽早加载，以便服务器组件在其初始化期间可以根据需要进行访问。</font><font style="vertical-align: inherit;">例如，
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎使用密钥环进行表空间加密，因此密钥环插件必须在</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font><font style="vertical-align: inherit;">之前加载并可用</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要加载插件，请使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项命名包含它的插件库文件。</font><font style="vertical-align: inherit;">例如，在插件库文件后缀所在的平台上
         </font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用这些行
         </font><font style="vertical-align: inherit;">（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要为您的平台</font><font style="vertical-align: inherit;">调整
         </font><font style="vertical-align: inherit;">后缀）：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
早期插件负荷= keyring_file.so</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从MySQL 5.7.12开始，默认
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为空。</font><font style="vertical-align: inherit;">要加载密钥环插件，必须使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有非空值</font><font style="vertical-align: inherit;">的显式
         </font><font style="vertical-align: inherit;">选项。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL 5.7.11中，默认
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件库文件</font><font style="vertical-align: inherit;">的名称</font><font style="vertical-align: inherit;">，所以该插件默认加载。
          </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表空间加密需要在
           </font><font style="vertical-align: inherit;">初始化</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前加载插件
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此这种默认</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值的</font><font style="vertical-align: inherit;">更改会导致</font><font style="vertical-align: inherit;">从5.7.11升级到5.7.12或更高版本时的不兼容性。</font><font style="vertical-align: inherit;">已加密</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表空间的</font><font style="vertical-align: inherit;">管理员
           </font><font style="vertical-align: inherit;">必须采取明确措施确保持续加载
           </font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件：使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名插件库文件</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在启动服务器之前，请检查所选密钥环插件的注释以查看它是否允许或需要额外配置：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-file-plugin" title="6.5.4.2使用keyring_file基于文件的插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.2节“使用keyring_file基于文件的插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-plugin" title="6.5.4.4使用keyring_okv KMIP插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.4节“使用keyring_okv KMIP插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-aws-plugin" title="6.5.4.5使用keyring_aws Amazon Web Services Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.5节“使用keyring_aws Amazon Web服务密钥环插件”</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在执行任何特定于插件的配置后，请验证插件安装。</font><font style="vertical-align: inherit;">运行MySQL服务器时，检查
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'keyring%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_file | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + --------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果服务器组件尝试访问密钥环服务时没有密钥环插件可用，则该组件不能使用该服务。</font><font style="vertical-align: inherit;">因此，组件可能无法初始化或可能使用有限的功能进行初始化。</font><font style="vertical-align: inherit;">例如，如果</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在初始化时发现有加密的表空间，它将尝试访问密钥环。</font><font style="vertical-align: inherit;">如果密钥环不可用，则
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只能访问未加密的表空间。</font><font style="vertical-align: inherit;">为确保</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以访问加密的表空间，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载密钥环插件。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插件可以通过其他方法加载，例如
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">但是，使用这些方法加载的密钥环插件在某些服务器组件的服务器启动顺序中可能太迟，例如</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            插件加载使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font><font style="vertical-align: inherit;">后发生</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用安装的插件</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL
            PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会在</font></font><code class="literal">mysql.plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统表</font><font style="vertical-align: inherit;">中注册
             </font><font style="vertical-align: inherit;">并自动加载，以便后续的服务器重新启动。</font><font style="vertical-align: inherit;">但是，因为</font></font><code class="literal">mysql.plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，所以只有在</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font><font style="vertical-align: inherit;">后才能在启动时加载其中命名的任何插件
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-file-plugin"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.2使用keyring_file基于文件的插件</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113119792"></a><a class="indexterm" name="idm140528113118736"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件是一个钥匙圈插件，用于将密钥环数据存储在服务器主机本地的文件中。
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于加密密钥管理</font><font style="vertical-align: inherit;">
          的</font><font style="vertical-align: inherit;">插件不是用作法规遵从性解决方案。</font><font style="vertical-align: inherit;">诸如PCI，FIPS和其他安全标准要求使用密钥管理系统来保护，管理和保护密钥库或硬件安全模块（HSM）中的加密密钥。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要安装</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，请使用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-installation" title="6.5.4.1安装Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.1节“Keyring插件安装”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的常规密钥环安装说明
         </font><font style="vertical-align: inherit;">，以及特定于</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font><font style="vertical-align: inherit;">的配置信息
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在服务器启动过程中使用，
         </font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">加载
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所述
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量任选配置由所使用的文件的位置</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的插件用于数据存储。</font><font style="vertical-align: inherit;">默认值是平台特定的。</font><font style="vertical-align: inherit;">要显式配置文件位置，请在启动时设置变量值。</font><font style="vertical-align: inherit;">例如，在服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用这些行
         </font><font style="vertical-align: inherit;">（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要为您的平台</font><font style="vertical-align: inherit;">调整
         </font><font style="vertical-align: inherit;">后缀和文件位置）：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
早期插件负荷= keyring_file.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
keyring_file_data =的/ usr /本地/ MySQL的/ MySQL的-钥匙圈/钥匙圈</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥环操作是事务性的：
         </font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件在写入操作期间使用备份文件以确保在操作失败时它可以回滚到原始文件。</font><font style="vertical-align: inherit;">备份文件的名称与</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同
         </font><font style="vertical-align: inherit;">，后缀为</font></font><code class="filename">.backup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-system-variables" title="6.5.4.11钥匙圈系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.11节“密钥环系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从MySQL 5.7.17开始，为了确保只有存在正确的密钥环存储文件时才刷新密钥，请将密钥环
         </font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的SHA-256校验和存储在文件中。</font><font style="vertical-align: inherit;">在更新文件之前，插件会验证它是否包含预期的校验和。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件支持构成标准密钥环服务接口的功能。</font><font style="vertical-align: inherit;">这些功能执行的钥匙圈操作可以在两个级别访问：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SQL接口：在SQL语句中，调用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理函数”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的用户定义函数（UDF）
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            C接口：在C语言代码中，调用</font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的密钥环服务功能</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        示例（使用UDF）：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT keyring_key_generate（'MyKey'，'AES'，32）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT keyring_key_remove（'MyKey'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;">第6.5.4.7节“支持的密钥环密钥类型”</font></a></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中介绍了</font><font style="vertical-align: inherit;">
        允许的</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-encrypted-file-plugin"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.3使用keyring_encrypted_file Keyring插件</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113087696"></a><a class="indexterm" name="idm140528113086656"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件是包含在商业产品MySQL Enterprise Edition中的一个扩展。</font><font style="vertical-align: inherit;">要了解有关商业产品的更多信息，请
           </font></font><a class="ulink" href="http://www.mysql.com/products/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问http://www.mysql.com/products/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件是一个钥匙环插件，用于将密钥环数据存储在服务器主机本地的加密文件中。</font><font style="vertical-align: inherit;">这个插件从MySQL 5.7.21开始可用。
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于加密密钥管理</font><font style="vertical-align: inherit;">
          的</font><font style="vertical-align: inherit;">插件不是用作法规遵从性解决方案。</font><font style="vertical-align: inherit;">诸如PCI，FIPS和其他安全标准要求使用密钥管理系统来保护，管理和保护密钥库或硬件安全模块（HSM）中的加密密钥。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要安装</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，请使用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-installation" title="6.5.4.1安装Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.1节“Keyring插件安装”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的常规密钥环安装说明
         </font><font style="vertical-align: inherit;">，以及特定于</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font><font style="vertical-align: inherit;">的配置信息
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在服务器启动过程中使用，
         </font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">加载</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要指定加密密钥环数据文件的密码，请设置
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_password"><code class="literal">keyring_encrypted_file_password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量。</font><font style="vertical-align: inherit;">（密码是必需的;如果在服务器启动时未指定，则</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        初始化失败。）
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量可选地配置</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件用于数据存储</font><font style="vertical-align: inherit;">的文件的位置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认值是平台特定的。</font><font style="vertical-align: inherit;">要显式配置文件位置，请在启动时设置变量值。</font><font style="vertical-align: inherit;">例如，在服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用这些行
         </font><font style="vertical-align: inherit;">（调整
        </font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 后缀和文件位置，并替换您选择的密码）：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
早期插件负荷= keyring_encrypted_file.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
keyring_encrypted_file_data =的/ usr /本地/ MySQL的/ MySQL的-钥匙圈/钥匙圈加密</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
keyring_encrypted_file_password =</font></font><em class="replaceable"><code>password</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于该</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件按所示方式存储密码，因此应具有限制性模式，并且只能由用于运行MySQL服务器的帐户访问。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥环操作是事务性的：
         </font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件在写入操作期间使用备份文件以确保在操作失败时它可以回滚到原始文件。</font><font style="vertical-align: inherit;">备份文件的名称与</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量</font><font style="vertical-align: inherit;">的值相同
         </font><font style="vertical-align: inherit;">，后缀为</font></font><code class="filename">.backup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关用于配置</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">的系统变量的更多信息</font><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-system-variables" title="6.5.4.11钥匙圈系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.11节“Keyring System Variables”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为确保只有存在正确的密钥环存储文件时才刷新</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥，请在文件中存储</font><font style="vertical-align: inherit;">密钥环</font><font style="vertical-align: inherit;">的SHA-256校验和。</font><font style="vertical-align: inherit;">在更新文件之前，插件会验证它是否包含预期的校验和。</font><font style="vertical-align: inherit;">另外，
         </font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在写入文件之前使用AES加密文件内容，并在读取文件后解密文件内容。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件支持构成标准密钥环服务接口的功能。</font><font style="vertical-align: inherit;">这些功能执行的钥匙圈操作可以在两个级别访问：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SQL接口：在SQL语句中，调用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理函数”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的用户定义函数（UDF）
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            C接口：在C语言代码中，调用</font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的密钥环服务功能</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        示例（使用UDF）：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT keyring_key_generate（'MyKey'，'AES'，32）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT keyring_key_remove（'MyKey'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;">第6.5.4.7节“支持的密钥环密钥类型”</font></a></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中介绍了
         </font><font style="vertical-align: inherit;">
        允许的
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-okv-plugin"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.4使用keyring_okv KMIP插件</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113049152"></a><a class="indexterm" name="idm140528113048096"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件是包含在商业产品MySQL Enterprise Edition中的一个扩展。</font><font style="vertical-align: inherit;">要了解有关商业产品的更多信息，请</font></font><a class="ulink" href="http://www.mysql.com/products/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问http://www.mysql.com/products/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥管理互操作性协议（KMIP）支持密钥管理服务器与其客户端之间的密钥的通信。</font><font style="vertical-align: inherit;">的</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥环插件使用KMIP 1.1协议作为一个KMIP后端的一个客户端安全地通信。</font><font style="vertical-align: inherit;">钥匙环材料仅由后端生成，而不是由后端生成
         </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该插件适用于这些兼容KMIP的产品：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            Oracle密钥库
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            金雅拓SafeNet KeySecure设备
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件支持构成标准密钥环服务接口的功能。</font><font style="vertical-align: inherit;">这些功能执行的钥匙圈操作可以在两个级别访问：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SQL接口：在SQL语句中，调用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理函数”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的用户定义函数（UDF）
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            C接口：在C语言代码中，调用</font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的密钥环服务功能</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        示例（使用UDF）：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT keyring_key_generate（'MyKey'，'AES'，32）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT keyring_key_remove（'MyKey'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;">第6.5.4.7节“支持的密钥环密钥类型”</font></a></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中介绍了</font><font style="vertical-align: inherit;">
        允许的</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要安装</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，请使用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-installation" title="6.5.4.1安装Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.1节“Keyring插件安装”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的常规密钥环安装说明
         </font><font style="vertical-align: inherit;">，以及特定于</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font><font style="vertical-align: inherit;">的配置信息
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-configuration" title="一般keyring_okv配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般keyring_okv配置</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-oracle-key-vault" title="为Oracle密钥保管库配置keyring_okv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为Oracle密钥保管库配置keyring_okv</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-keysecure" title="为金雅拓SafeNet KeySecure设备配置keyring_okv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为金雅拓SafeNet KeySecure设备配置keyring_okv</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-encrypt-key-file" title="密码保护keyring_okv密钥文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码保护keyring_okv密钥文件</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="keyring-okv-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般keyring_okv配置</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528113023536"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          无论哪个KMIP后端
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件用于密钥环存储，
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量都会配置</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其支持文件</font><font style="vertical-align: inherit;">所使用的目录的位置
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认值为空，所以您必须设置变量以在插件可以与KMIP后端进行通信之前命名正确配置的目录。</font><font style="vertical-align: inherit;">除非您这样做，否则
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动期间向错误日志中写入消息无法通信：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Warning]插件keyring_okv报告：'用于keyring_okv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初始化后，请将keyring_okv_conf_dir变量指向一个目录</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
包含Oracle Key Vault配置文件和ssl资料'</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          变量必须命名包含以下项目的目录：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：包含KMIP后端与其进行</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通信的</font><font style="vertical-align: inherit;">详细信息的文件
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：包含证书，并建立与KMIP后端的安全连接所需的密钥文件的目录
               </font></font><code class="filename">CA.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="filename">cert.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="filename">key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从MySQL 5.7.20开始，如果密钥文件受密码保护，则该
               </font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录可以包含一个单行文本文件，
               </font></font><code class="filename">password.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中包含解密密钥文件所需的密码。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这两个</font></font><code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件和
           </font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录与证书和密钥文件所需的</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常工作。</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如其他位置所述，</font><font style="vertical-align: inherit;">用于使用这些文件填充配置目录的过程取决于所使用的KMIP后端</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为其支持文件位置</font><font style="vertical-align: inherit;">
          使用的配置目录
           </font><font style="vertical-align: inherit;">应具有限制性模式，并且只能由用于运行MySQL服务器的帐户访问。</font><font style="vertical-align: inherit;">例如，在Unix和类Unix系统上，要使用该
           </font></font><code class="filename">/usr/local/mysql/mysql-keyring-okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          目录，以下命令（执行为
           </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）会创建该目录并设置其模式和所有权：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd / usr / local / mysql</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mkdir mysql-keyring-okv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chmod 750 mysql-keyring-okv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chown mysql mysql-keyring-okv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chgrp mysql mysql-keyring-okv</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在服务器启动过程中使用，
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">加载
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另外，设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量以告诉</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪里可以找到它的配置目录。</font><font style="vertical-align: inherit;">例如，在服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用这些行</font><font style="vertical-align: inherit;">（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">调整平台的
           </font><font style="vertical-align: inherit;">后缀和目录位置）：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
早期插件负荷= keyring_okv.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
keyring_okv_conf_dir =的/ usr /本地/ MySQL的/ MySQL的-钥匙圈 -  OKV</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关更多信息
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-system-variables" title="6.5.4.11钥匙圈系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.11节“密钥环系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-okv-oracle-key-vault"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为Oracle密钥保管库配置keyring_okv</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528112988688"></a><a class="indexterm" name="idm140528112987232"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此处的讨论假定您熟悉Oracle Key Vault。</font><font style="vertical-align: inherit;">一些相关的信息来源：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/overview/index.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle Key Vault站点</font></font></a>
            </p></li><li class="listitem"><p>
              <a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/documentation/index.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle密钥保管库文档</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Oracle Key Vault术语中，使用Oracle Key Vault存储和检索安全对象的客户端称为端点。</font><font style="vertical-align: inherit;">要与Oracle Key Vault通信，需要注册为端点并通过下载和安装端点支持文件进行注册。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下过程简要概述了设置</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与Oracle密钥保险库一起使用</font><font style="vertical-align: inherit;">的过程</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              创建</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">的配置目录以供
               </font><font style="vertical-align: inherit;">使用。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用Oracle Key Vault注册端点以获取注册令牌。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用注册令牌获取
               </font></font><code class="filename">okvclient.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端软件下载。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              安装客户端软件以填充</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含Oracle Key Vault支持文件</font><font style="vertical-align: inherit;">的
               </font><font style="vertical-align: inherit;">配置目录。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用以下过程来配置
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和Oracle密钥保管库一起工作。</font><font style="vertical-align: inherit;">此说明仅概述如何与Oracle密钥保管库进行交互。</font><font style="vertical-align: inherit;">有关详细信息，请访问
           </font></font><a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/overview/index.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle Key Vault</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">站点并参阅Oracle Key Vault管理员指南。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              创建将包含Oracle Key Vault支持文件的配置目录，并确保将
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量设置为命名该目录（有关详细信息，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-configuration" title="一般keyring_okv配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常规keyring_okv配置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              以具有系统管理员角色的用户身份登录到Oracle Key Vault管理控制台。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选择Endpoints选项卡以到达Endpoints页面。</font><font style="vertical-align: inherit;">在端点页面上，单击添加。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              提供所需的端点信息并单击注册。</font><font style="vertical-align: inherit;">端点类型应该是Other。</font><font style="vertical-align: inherit;">成功注册会生成注册令牌。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从Oracle密钥保管库服务器注销。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              再次连接到Oracle Key Vault服务器，这次不登录。使用端点注册令牌进行注册并请求</font></font><code class="filename">okvclient.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              软件下载。</font><font style="vertical-align: inherit;">将此文件保存到您的系统。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="filename">okvclient.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下命令</font><font style="vertical-align: inherit;">
              安装</font><font style="vertical-align: inherit;">文件（您必须具有JDK 1.4或更高版本）：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java -jar okvclient.jar -d </font></font><em class="replaceable"><code>dir_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-v]
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="option">-d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选项</font><font style="vertical-align: inherit;">后面的目录名称</font><font style="vertical-align: inherit;">是安装提取文件的位置。</font></font><code class="option">-v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果给出</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">选项，则会生成日志信息，如果该命令失败可能会有用。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当该命令要求提供Oracle密钥保管库端点密码时，请不要提供一个密码。</font><font style="vertical-align: inherit;">相反，请按Enter键。</font><font style="vertical-align: inherit;">（结果是端点连接到Oracle密钥保管库时不需要密码。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上述命令会生成一个
               </font></font><code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，该文件应</font></font><code class="option">-d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于前面的</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java -jar</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项所</font><font style="vertical-align: inherit;">指定的目录下的此位置中
               </font><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL_DIR / CONF / okvclient.ora
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              文件内容包含如下所示的行：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SERVER = </font></font><em class="replaceable"><code>host_ip</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><em class="replaceable"><code>port_num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STANDBY_SERVER = </font></font><em class="replaceable"><code>host_ip</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><em class="replaceable"><code>port_num</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件尝试与</font></font><code class="literal">SERVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量所</font><font style="vertical-align: inherit;">指定的主机上运行的服务器进行通信，</font></font><code class="literal">STANDBY_SERVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果失败</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">则</font><font style="vertical-align: inherit;">返回到
               </font><font style="vertical-align: inherit;">该主机</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  对于</font></font><code class="literal">SERVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量，</font></font><code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">的设置</font><font style="vertical-align: inherit;">是强制性的。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  对于</font></font><code class="literal">STANDBY_SERVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量，</font></font><code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从MySQL 5.7.19开始，文件中</font><font style="vertical-align: inherit;">的设置</font><font style="vertical-align: inherit;">是可选的。</font><font style="vertical-align: inherit;">在MySQL 5.7.19之前，一个设置
                   </font></font><code class="literal">STANDBY_SERVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是强制性的; </font><font style="vertical-align: inherit;">如果
                   </font></font><code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有设置生成</font></font><code class="literal">STANDBY_SERVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则
                   </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法初始化。</font><font style="vertical-align: inherit;">解决方法是检查
                   </font></font><code class="filename">oraclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并添加一个
                   </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置
                   </font></font><code class="literal">STANDBY_SERVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果缺少的话。</font><font style="vertical-align: inherit;">例如：
                </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STANDBY_SERVER = 127.0.0.1：5696
</font></font></pre></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              转到Oracle Key Vault安装程序目录并通过运行以下命令来测试安装程序：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">okvutil / bin / okvutil列表
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              输出应该看起来像这样：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一的ID类型标识符</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
255AB8DE-C97F-482C-E053-0100007F28B9对称密钥 - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
264BF6E0-A20E-7C42-E053-0100007FB29C对称密钥 - </font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于新的Oracle Key Vault服务器（没有任何密钥的服务器），输出结果如下所示，以指示Vault中没有密钥：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找不到对象
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用此命令</font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从</font></font><code class="filename">okvclient.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">提取</font><font style="vertical-align: inherit;">包含SSL资料的
               </font><font style="vertical-align: inherit;">目录：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jar xf okvclient.jar ssl
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将Oracle Key Vault支持文件（</font></font><code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件和
               </font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录）</font><font style="vertical-align: inherit;">复制
               </font><font style="vertical-align: inherit;">到配置目录中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （可选）如果您希望密码保护密钥文件，请使用
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-encrypt-key-file" title="密码保护keyring_okv密钥文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码保护keyring_okv密钥文件中的说明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          完成上述过程后，重新启动MySQL服务器。</font><font style="vertical-align: inherit;">它加载</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件并
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用其配置目录中的文件与Oracle密钥保管库通信。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-okv-keysecure"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为金雅拓SafeNet KeySecure设备配置keyring_okv</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528112919984"></a><a class="indexterm" name="idm140528112918544"></a><a class="indexterm" name="idm140528112917024"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          金雅拓SafeNet KeySecure设备使用KMIP协议（版本1.1或1.2）。</font><font style="vertical-align: inherit;">从MySQL 5.7.18开始，
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyring插件（支持KMIP 1.1）可以使用KeySecure作为其KMIP后端进行密钥环存储。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用以下过程来配置
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和KeySecure一起工作。</font><font style="vertical-align: inherit;">描述仅概述如何与KeySecure交互。</font><font style="vertical-align: inherit;">有关详细信息，请参阅</font></font><a class="ulink" href="https://safenet.gemalto.com/uploadedFiles/Support_and_Downloads/AWS/007-012362-001-keysecure-appliance-user-guide-v7.1.0.pdf" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KeySecure用户指南中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为添加KMIP服务器的部分
           </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              创建将包含KeySecure支持文件的配置目录，并确保将
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量设置为指定该目录（有关详细信息，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-configuration" title="一般keyring_okv配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常规keyring_okv配置</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在配置目录中，创建一个名为</font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于存储所需的SSL证书和密钥文件</font><font style="vertical-align: inherit;">的子目录</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在配置目录中，创建一个名为的文件
               </font></font><code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它应该有以下格式：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SERVER = </font></font><em class="replaceable"><code>host_ip</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><em class="replaceable"><code>port_num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STANDBY_SERVER = </font></font><em class="replaceable"><code>host_ip</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><em class="replaceable"><code>port_num</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例如，如果KeySecure在主机198.51.100.20上运行并在端口9002上侦听，则该
               </font></font><code class="filename">okvclient.ora</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件如下所示：
            </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SERVER = 198.51.100.20：9002</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STANDBY_SERVER = 198.51.100.20：9002</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              以管理员身份连接到KeySecure管理控制台，并使用证书颁发机构访问权限的凭证。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              导航到安全&gt;&gt;本地CA并创建本地证书颁发机构（CA）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              转到可信CA列表。</font><font style="vertical-align: inherit;">选择默认并点击属性。</font><font style="vertical-align: inherit;">然后选择编辑信任的证书颁发机构列表并添加刚刚创建的CA.
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              下载CA并将其</font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为名为的文件</font><font style="vertical-align: inherit;">保存在
               </font><font style="vertical-align: inherit;">目录中
               </font></font><code class="filename">CA.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              导航到安全&gt;&gt;证书请求并创建证书。</font><font style="vertical-align: inherit;">然后您将能够下载</font><font style="vertical-align: inherit;">包含证书PEM文件</font><font style="vertical-align: inherit;">的压缩</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tar</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从下载的文件中提取PEM文件。</font><font style="vertical-align: inherit;">例如，如果文件名是
               </font></font><code class="filename">csr_w_pk_pkcs8.gz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用以下命令对其进行解压缩和解压缩：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tar zxvf csr_w_pk_pkcs8.gz
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              两个文件来自提取操作：
               </font></font><code class="filename">certificate_request.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="filename">private_key_pkcs8.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用此</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令解密私钥并创建一个名为
               </font></font><code class="filename">key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl pkcs8 -in private_key_pkcs8.pem -out key.pem
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将</font></font><code class="filename">key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">复制</font><font style="vertical-align: inherit;">到
               </font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将证书请求复制
               </font></font><code class="filename">certificate_request.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到剪贴板中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              导航到安全&gt;&gt;本地CA. </font><font style="vertical-align: inherit;">选择您之前创建的相同的CA（您下载的创建该</font></font><code class="filename">CA.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件的</font><font style="vertical-align: inherit;">那个</font><font style="vertical-align: inherit;">），然后单击Sign Request。</font><font style="vertical-align: inherit;">从剪贴板粘贴证书请求，选择客户端的证书目的（密钥环是KeySecure的客户端），然后单击Sign Request。</font><font style="vertical-align: inherit;">结果是在新页面中使用所选CA签署的证书。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              签名的证书复制到剪贴板，然后将剪贴板中的内容保存为一个文件名为
               </font></font><code class="filename">cert.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
               </font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （可选）如果您希望密码保护密钥文件，请使用
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-encrypt-key-file" title="密码保护keyring_okv密钥文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码保护keyring_okv密钥文件中的说明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          完成上述过程后，重新启动MySQL服务器。</font><font style="vertical-align: inherit;">它加载</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件并
           </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用其配置目录中的文件与KeySecure进行通信。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-okv-encrypt-key-file"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码保护keyring_okv密钥文件</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从MySQL 5.7.20开始，您可以选择使用密码保护密钥文件，并提供包含密码的文件以使密钥文件能够解密。</font><font style="vertical-align: inherit;">为此，请将位置更改为</font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录并执行以下步骤：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              加密</font></font><code class="filename">key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥文件。</font><font style="vertical-align: inherit;">例如，使用这样的命令，并在提示符处输入加密密码：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>openssl rsa -des3 -in key.pem -out key.pem.new</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入PEM密码短语：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
验证 - 输入PEM密码短语：</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将加密密码保存</font></font><code class="filename">password.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录中</font><font style="vertical-align: inherit;">指定的单行文本文件</font><font style="vertical-align: inherit;">中
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              验证使用以下命令可以解密加密的密钥文件。</font><font style="vertical-align: inherit;">解密后的文件应该显示在控制台上：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>openssl rsa -in key.pem.new -passin file:password.txt</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              删除原始</font></font><code class="filename">key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件并重命名</font></font><code class="filename">key.pem.new</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为
               </font></font><code class="filename">key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              根据需要更改新</font></font><code class="filename">key.pem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件和
               </font></font><code class="filename">password.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">的所有权和访问模式，
               </font><font style="vertical-align: inherit;">以确保它们与</font></font><code class="filename">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录中的</font><font style="vertical-align: inherit;">其他文件具有相同的限制</font><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-aws-plugin"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.5使用keyring_aws Amazon Web Services Keyring插件</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528112853088"></a><a class="indexterm" name="idm140528112852032"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件是包含在商业产品MySQL Enterprise Edition中的一个扩展。</font><font style="vertical-align: inherit;">要了解有关商业产品的更多信息，请</font></font><a class="ulink" href="http://www.mysql.com/products/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问http://www.mysql.com/products/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件是一个密钥环插件，与亚马逊网络服务密钥管理服务（AWS KMS）通信，作为密钥生成的后端，并使用本地文件进行密钥存储。</font><font style="vertical-align: inherit;">所有密钥环材料均由AWS服务器专门生成，而不是通过
         </font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p>
        <code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在这些平台上可用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            Debian 8
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            EL7
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            macOS 10.12
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            OS X 10.10和10.11
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SLES 12
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            Ubuntu 14.04和16.04
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            视窗
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这里的讨论假定您熟悉AWS，特别是KMS。</font><font style="vertical-align: inherit;">一些相关的信息来源：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="ulink" href="https://aws.amazon.com/kms/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS网站</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.aws.amazon.com/kms/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KMS文档</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下各节提供了</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥环插件的</font><font style="vertical-align: inherit;">配置和使用信息</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-aws-plugin-configuration" title="keyring_aws配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyring_aws配置</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-aws-plugin-operation" title="keyring_aws操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyring_aws操作</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-aws-plugin-credential-changes" title="keyring_aws凭证更改"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyring_aws凭证更改</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="keyring-aws-plugin-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyring_aws配置</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要安装</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，请使用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-installation" title="6.5.4.1安装Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.1节“Keyring插件安装”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的一般安装说明
           </font><font style="vertical-align: inherit;">，以及此处找到的插件特定配置信息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件库文件包含
           </font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件和两个用户定义函数（UDF），</font></font><code class="literal">keyring_aws_rotate_cmk()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以及</font></font><code class="literal">keyring_aws_rotate_keys()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要进行配置</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您必须获得一个秘密访问密钥，以提供与AWS KMS通信的凭据并将其写入配置文件：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              创建一个AWS KMS帐户。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用AWS KMS创建一个秘密访问密钥ID和秘密访问密钥。</font><font style="vertical-align: inherit;">访问密钥用于验证您的身份和应用程序的身份。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用AWS KMS帐户创建客户主密钥（CMK）ID。</font><font style="vertical-align: inherit;">在MySQL启动时，将
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量设置为CMK ID值。</font><font style="vertical-align: inherit;">这个变量是强制性的，没有默认值。</font><font style="vertical-align: inherit;">（如果需要，可以在运行时更改其值
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET
              GLOBAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如有必要，创建配置文件所在的目录。</font><font style="vertical-align: inherit;">该目录应该具有限制模式，并且只能由用于运行MySQL服务器的帐户访问。</font><font style="vertical-align: inherit;">例如，在Unix和类Unix系统上，要
               </font></font><code class="filename">/usr/local/mysql/mysql-keyring/keyring_aws_conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              用作文件名，以下命令（执行为
               </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）创建其父目录并设置目录模式和所有权：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>cd /usr/local/mysql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt; </font></font><strong class="userinput"><code>mkdir mysql-keyring</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt; </font></font><strong class="userinput"><code>chmod 750 mysql-keyring</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt; </font></font><strong class="userinput"><code>chown mysql mysql-keyring</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>chgrp mysql mysql-keyring</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在MySQL启动时，将
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_conf_file"><code class="literal">keyring_aws_conf_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量设置
               </font></font><code class="filename">/usr/local/mysql/mysql-keyring/keyring_aws_conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为指示服务器的配置文件位置。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              准备</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置文件，其中应包含两行：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  第1行：秘密访问密钥ID
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  第2行：秘密访问密钥
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例如，如果密钥ID
               </font></font><code class="literal">wwwwwwwwwwwwwEXAMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和密钥是
               </font></font><code class="literal">xxxxxxxxxxxxx/yyyyyyy/zzzzzzzzEXAMPLEKEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则配置文件如下所示：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wwwwwwwwwwwwwEXAMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XXXXXXXXXXXXX / YYYYYYY / zzzzzzzzEXAMPLEKEY</font></font><font></font>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在服务器启动过程中使用，
           </font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">加载
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所述
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量是强制性的，构成从AWS KMS服务器获得的顾客主密钥（CMK）的标识。</font><font style="vertical-align: inherit;">的
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_conf_file"><code class="literal">keyring_aws_conf_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_data_file"><code class="literal">keyring_aws_data_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量有选择地配置由所使用的文件的位置</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件配置信息和数据的存储。</font><font style="vertical-align: inherit;">文件位置变量默认值是平台特定的。</font><font style="vertical-align: inherit;">要显式配置位置，请在启动时设置变量值。</font><font style="vertical-align: inherit;">例如，在服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用这些行
           </font><font style="vertical-align: inherit;">（调整
          </font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 根据需要为您的平台添加后缀和文件位置）：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
早期插件负荷= keyring_aws.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
keyring_aws_cmk_id = '阿尔恩：AWS：公里：美西2：111122223333：键/ ABCD1234-ef56-AB12-CD34-ef56abcd1234'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
keyring_aws_conf_file =的/ usr /本地/ MySQL的/ MySQL的-钥匙圈/ keyring_aws_conf</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
keyring_aws_data_file =的/ usr /本地/ MySQL的/ MySQL的-钥匙圈/ keyring_aws_data</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为使</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件成功启动，配置文件必须存在并包含有效的秘密访问密钥信息，如前所述进行初始化。</font><font style="vertical-align: inherit;">存储文件不需要存在。</font><font style="vertical-align: inherit;">如果没有，则
           </font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试创建它（以及必要时的父目录）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关用于配置</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">的系统变量的更多信息</font><font style="vertical-align: inherit;">，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-system-variables" title="6.5.4.11钥匙圈系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.11节“Keyring System Variables”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          启动MySQL服务器并安装与</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">关联的UDF </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一次性操作，通过执行以下语句执行（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要为您的平台</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE FUNCTION keyring_aws_rotate_cmk RETURNS INTEGER SONAME'keyring_aws.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE FUNCTION keyring_aws_rotate_keys RETURNS INTEGER SONAME'keyring_aws.so';</font></font><font></font>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-aws-plugin-operation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyring_aws操作</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在插件启动时，</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件会从其配置文件中读取AWS秘密访问密钥ID和密钥。</font><font style="vertical-align: inherit;">它还将其存储文件中包含的所有加密密钥读入其内存中缓存。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在操作期间，</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将加密密钥维护在内存中缓存中，并将该存储文件用作本地永久存储。</font><font style="vertical-align: inherit;">每个密钥环操作都是事务性的：</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要么成功更改内存中的密钥缓存和密钥环存储文件，要么操作失败并且密钥环状态保持不变。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为确保只有存在正确的密钥环存储文件时才刷新</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥，请在文件中存储</font><font style="vertical-align: inherit;">密钥环</font><font style="vertical-align: inherit;">的SHA-256校验和。</font><font style="vertical-align: inherit;">在更新文件之前，插件会验证它是否包含预期的校验和。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件支持构成标准密钥环服务接口的功能。</font><font style="vertical-align: inherit;">由这些功能执行的钥匙圈操作可以在两个级别访问：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              C接口：在C语言代码中，调用</font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的密钥环服务功能</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              SQL接口：在SQL语句中，调用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理函数”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的用户定义函数（UDF）
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          示例（使用UDF）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT keyring_key_generate（'MyKey'，'AES'，32）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT keyring_key_remove（'MyKey'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此外，</font></font><code class="literal">keyring_aws_rotate_cmk()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和</font></font><code class="literal">keyring_aws_rotate_keys()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDF的
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的钥匙圈插件接口提供不属于标准的钥匙圈服务接口AWS相关的功能。</font><font style="vertical-align: inherit;">这些功能只能通过调用UDF来访问。</font><font style="vertical-align: inherit;">没有相应的C语言密钥服务功能。
        </font></font></p><p><font style="vertical-align: inherit;"><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;">第6.5.4.7节“支持的密钥环密钥类型”</font></a></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中介绍了</font><font style="vertical-align: inherit;">
          允许的</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-aws-plugin-credential-changes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyring_aws凭证更改</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件已在服务器启动时正确初始化，则可以更改用于与AWS KMS通信的凭证：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用AWS KMS创建新的秘密访问密钥ID和秘密访问密钥。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将新凭证存储在配置文件（由</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_conf_file"><code class="literal">keyring_aws_conf_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">命名的文件
               </font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">文件格式如前所述。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              重新初始化</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，以便重新读取配置文件。</font><font style="vertical-align: inherit;">假设新凭证有效，插件应该成功初始化。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有两种方法可以重新初始化插件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  重新启动服务器。</font><font style="vertical-align: inherit;">这更简单，没有副作用，但不适合安装需要最少的服务器停机时间和尽可能少的重启。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  通过执行以下语句重新初始化插件而不重新启动服务器（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要为您的平台</font><font style="vertical-align: inherit;">调整
                   </font><font style="vertical-align: inherit;">后缀）：
                </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN keyring_aws;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装插件keyring_aws SONAME'keyring_aws.so';</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    除了在运行时加载插件之外，
                     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还具有在</font></font><code class="literal">mysql.plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统表</font><font style="vertical-align: inherit;">中注册插件的副作用
                     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，如果您决定停止使用
                     </font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    仅从用于启动服务器的一组选项中</font><font style="vertical-align: inherit;">删除</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">是不够
                     </font><font style="vertical-align: inherit;">的。</font><font style="vertical-align: inherit;">这会阻止插件提前加载，但服务器在启动顺序中加载已注册的插件时仍会尝试加载它
                     </font></font><code class="literal">mysql.plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    因此，如果您执行</font><font style="vertical-align: inherit;">
                    刚刚描述</font><font style="vertical-align: inherit;">的
                     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加号
                     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序列来更改AWS KMS凭证，然后停止使用
                     </font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL
                    PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了删除</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    选项</font><font style="vertical-align: inherit;">之外</font><font style="vertical-align: inherit;">，还需要</font><font style="vertical-align: inherit;">再次</font><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">注销插件
                     </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li></ul>
</div>
</li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-key-migration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.6在密钥环密钥库之间迁移密钥</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从MySQL 5.7.21开始，MySQL服务器支持一种操作模式，可以在底层密钥环密钥库之间迁移密钥。</font><font style="vertical-align: inherit;">这使DBA能够将MySQL安装从一个密钥环插件切换到另一个。</font><font style="vertical-align: inherit;">迁移服务器（即以密钥迁移模式启动的服务器）不接受客户端连接。</font><font style="vertical-align: inherit;">相反，它只运行足够长的时间来迁移密钥，然后退出。</font><font style="vertical-align: inherit;">迁移服务器向控制台报告错误（标准错误输出）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可以执行脱机或在线密钥迁移：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您确定本地主机上没有正在运行的服务器正在使用源或目标密钥库，则可以执行脱机迁移。</font><font style="vertical-align: inherit;">在这种情况下，迁移服务器可以在迁移过程中修改密钥库，而不必运行服务器修改密钥库内容。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果本地主机上的正在运行的服务器正在使用源或目标密钥库，则必须执行联机迁移。</font><font style="vertical-align: inherit;">在这种情况下，迁移服务器连接到正在运行的服务器，并指示它在密钥迁移过程中暂停密钥环操作。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥迁移操作的结果是目标密钥库包含迁移之前的密钥以及源密钥库中的密钥。</font><font style="vertical-align: inherit;">源密钥库在迁移前后是相同的，因为密钥被复制，而不是被移动。</font><font style="vertical-align: inherit;">如果要复制的密钥已存在于目标密钥库中，则会发生错误，并且目标密钥库会恢复到其预迁移状态。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要执行密钥迁移操作，请确定需要哪些密钥迁移选项。</font><font style="vertical-align: inherit;">迁移选项指示涉及哪些密钥环插件，以及是否执行脱机或联机迁移：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要指示源和目标密钥环插件，请指定以下选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：管理要迁移的密钥的源密钥环插件。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-destination"><code class="option">--keyring-migration-destination</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：迁移密钥将被复制到的目标密钥环插件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些选项告诉服务器以密钥迁移模式运行。</font><font style="vertical-align: inherit;">这两个选项对所有重要的迁移操作都是强制性的 </font><font style="vertical-align: inherit;">源插件和目标插件必须不同，并且迁移服务器必须同时支持两种插件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于离线迁移，不需要其他密钥迁移选项。
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              不要执行涉及正在运行的服务器正在使用的密钥库的脱机迁移。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于联机迁移，当前某个正在运行的服务器正在使用源或目标密钥库。</font><font style="vertical-align: inherit;">指定指示如何连接到正在运行的服务器的密钥迁移选项。</font><font style="vertical-align: inherit;">这是必要的，以便迁移服务器可以连接到正在运行的服务器并告诉它在迁移操作期间暂停密钥环的使用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用以下任何选项都表示在线迁移：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-host"><code class="option">--keyring-migration-host</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：运行服务器所在的主机。</font><font style="vertical-align: inherit;">这始终是本地主机。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-user"><code class="option">--keyring-migration-user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-password"><code class="option">--keyring-migration-password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用于连接到正在运行的服务器的帐户的用户名和密码。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-port"><code class="option">--keyring-migration-port</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：对于TCP / IP连接，在正在运行的服务器上连接的端口号。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-socket"><code class="option">--keyring-migration-socket</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：对于Unix套接字文件或Windows命名管道连接，要在正在运行的服务器上连接的套接字文件或命名管道。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关密钥迁移选项的更多详细信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-options" title="6.5.4.10密钥环命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.10节“密钥环命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可能使用其他选项，使用刚刚描述的关键迁移选项启动迁移服务器。</font><font style="vertical-align: inherit;">牢记以下几点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            其他服务器选项可能是必需的，例如两个密钥环插件的其他配置参数。</font><font style="vertical-align: inherit;">例如，如果</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是其中一个插件，</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则如果密钥环数据文件位置不是默认位置</font><font style="vertical-align: inherit;">，则必须设置
             </font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">其他非钥匙圈选项也可能需要。</font><font style="vertical-align: inherit;">指定这些选项的一种方法是使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_defaults-file"><code class="option">--defaults-file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名包含所需选项的选项文件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您从与通常用于运行MySQL的系统帐户不同的系统帐户调用迁移服务器，则它可能会创建密钥环目录或正常操作期间服务器无法访问的文件。</font><font style="vertical-align: inherit;">假设
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常以</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统用户</font><font style="vertical-align: inherit;">身份运行
             </font><font style="vertical-align: inherit;">，但您在登录时调用迁移服务器
             </font></font><code class="literal">isabel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由迁移服务器创建的任何新目录或文件将归属于
             </font></font><code class="literal">isabel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统用户尝试访问拥有的文件系统对象
             </font><font style="vertical-align: inherit;">时，后续启动将失败</font></font><code class="literal">isabel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为避免此问题，请以</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统用户</font><font style="vertical-align: inherit;">身份启动迁移服务器
             </font><font style="vertical-align: inherit;">并提供一个
             </font><font style="vertical-align: inherit;">
            选项，</font><font style="vertical-align: inherit;">系统帐户通常用于运行MySQL。
          </font></font><code class="option">--user=<em class="replaceable"><code>user_name</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            迁移服务器期望路径名选项值为完整路径。</font><font style="vertical-align: inherit;">相对路径名称可能无法按预期解析。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        用于脱机密钥迁移的示例命令行：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld --defaults-file = / usr / local / mysql / etc / my.cnf</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --key迁移源= keyring_file.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --key迁移目的地= keyring_encrypted_file.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --keyring_encrypted_file_password =</font></font><em class="replaceable"><code>password</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        联机密钥迁移示例命令行：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld --defaults-file = / usr / local / mysql / etc / my.cnf</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --key迁移源= keyring_file.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --key迁移目的地= keyring_encrypted_file.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --keyring_encrypted_file_password =</font></font><em class="replaceable"><code>password</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --key迁移主机=本地主机</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --key迁移用户=根</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --key迁移密码=</font></font><em class="replaceable"><code>root_password</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥迁移服务器按如下方式执行迁移操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （仅限在线迁移）使用连接选项连接到正在运行的服务器。</font><font style="vertical-align: inherit;">用于连接的帐户必须具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改全局</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">所需</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">权限
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （仅限在线迁移）</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行的服务器上</font><font style="vertical-align: inherit;">禁用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（正在运行的服务器必须支持
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着它必须来自MySQL 5.7.21或更高版本。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            加载源和目标密钥环插件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将密钥从源密钥环复制到目标密钥环。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            卸载钥匙圈插件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （仅限在线迁移）</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行的服务器上</font><font style="vertical-align: inherit;">启用
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （仅限在线迁移）断开正在运行的服务器。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            出口。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果在密钥迁移过程中发生错误，则将删除复制到目标插件的任何密钥，使目标密钥库保持不变。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于联机迁移操作，迁移服务器负责</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行的服务器上</font><font style="vertical-align: inherit;">启用和禁用
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，如果迁移服务器异常退出（例如，如果有人强行终止迁移），则有可能
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行的服务器上不会重新启用迁移服务器，从而无法执行密钥环操作。</font><font style="vertical-align: inherit;">在这种情况下，可能需要连接到正在运行的服务器并</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动</font><font style="vertical-align: inherit;">启用
           </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        成功执行联机密钥迁移操作后，可能需要重新启动正在运行的服务器：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果正在运行的服务器正在使用源密钥库，则在迁移后不需要重新启动它。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果正在运行的服务器在迁移前使用源密钥库，但在迁移后应使用目标密钥库，则必须重新配置它以使用目标密钥环插件并重新启动。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果正在运行的服务器正在使用目标密钥库并将继续使用它，则应在迁移后重新启动它，以加载迁移到目标密钥库中的所有密钥。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL服务器密钥迁移模式支持暂停单个正在运行的服务器。</font><font style="vertical-align: inherit;">要在多个密钥服务器正在使用涉及的密钥库时执行密钥迁移，请使用以下过程：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              手动连接到每个正在运行的服务器，并设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用迁移服务器执行脱机密钥迁移。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              手动连接到每个正在运行的服务器，并设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          所有运行的服务器都必须支持
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-key-types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.7支持的密钥环密钥类型</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL Keyring支持生成不同类型（加密算法）和长度的密钥。</font><font style="vertical-align: inherit;">可用的密钥类型取决于安装哪个密钥环插件。</font><font style="vertical-align: inherit;">给定的插件也可能对每种密钥类型的密钥长度施加约束。
      </font></font></p><p>
        <a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types-table" title="表6.22 Keyring插件密钥类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.22“密钥环插件密钥类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇总了每个密钥环插件允许的密钥类型。</font><font style="vertical-align: inherit;">长度以字节为单位。</font><font style="vertical-align: inherit;">对于使用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理函数”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的密钥环用户定义函数（UDF）中的一个生成的密钥
         </font><font style="vertical-align: inherit;">，由于UDF的限制，长度不能超过2048字节接口。
</font></font></p>
<div class="table">
<a name="keyring-key-types-table"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.22 Keyring插件密钥类型</font></font></b></p>
<div class="table-contents">
<table summary="Key types and lengths supported by keyring plugins."><colgroup><col width="30%"><col width="20%"><col width="50%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件名称</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许的密钥类型</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥类型允许的密钥长度</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row" valign="top"><code class="literal">keyring_encrypted_file</code></td>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">DSA</code>
              </p><p class="valid-value">
                <code class="literal">RSA</code>
              </p></td>
            <td><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有特别的限制
              </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有特别的限制
              </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有特别的限制
              </font></font></p></td>
          </tr><tr>
            <td scope="row" valign="top"><code class="literal">keyring_file</code></td>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">DSA</code>
              </p><p class="valid-value">
                <code class="literal">RSA</code>
              </p></td>
            <td><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有特别的限制
              </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有特别的限制
              </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有特别的限制
              </font></font></p></td>
          </tr><tr>
            <td valign="top" scope="row"><code class="literal">keyring_okv</code></td>
            <td><code class="literal">AES</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16，24，32</font></font></td>
          </tr><tr>
            <td valign="top" scope="row"><code class="literal">keyring_aws</code></td>
            <td><code class="literal">AES</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16，24，32</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-udfs-general-purpose"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.8通用密钥环密钥管理功能</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528112621328"></a><a class="indexterm" name="idm140528112619840"></a><a class="indexterm" name="idm140528112618384"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL服务器支持密钥环服务，可以使内部服务器组件和插件安全地存储敏感信息以供日后检索。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从MySQL 5.7.13开始，MySQL服务器包含一个用于密钥环密钥管理的SQL接口，实现为一组通用用户定义函数（UDF），用于访问内部密钥环服务提供的功能。</font><font style="vertical-align: inherit;">密钥环UDF包含在一个插件库文件中，该文件还包含一个</font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在UDF调用之前启用</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">对于要使用的这些UDF，</font><font style="vertical-align: inherit;">必须启用</font><font style="vertical-align: inherit;">诸如</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须启用</font><font style="vertical-align: inherit;">的密钥环插件</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这里描述的UDF是通用的，旨在用于任何钥匙圈插件。</font><font style="vertical-align: inherit;">给定的钥匙扣插件可能有自己的UDF，它们只能用于该插件; </font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-plugin-specific" title="6.5.4.9特定于插件的密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.9节“特定于插件的密钥环密钥管理功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下各节提供了密钥环UDF的安装说明并演示了如何使用它们。</font><font style="vertical-align: inherit;">有关由UDF调用的密钥环服务函数的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关一般密钥环信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring" title="6.5.4 MySQL Keyring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4节“MySQL密钥环”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="keyring-udf-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.8.1安装或卸载通用键盘功能</font></font></h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140528112608608"></a><a class="indexterm" name="idm140528112607120"></a><a class="indexterm" name="idm140528112605632"></a><a class="indexterm" name="idm140528112604144"></a><a class="indexterm" name="idm140528112602656"></a><a class="indexterm" name="idm140528112601168"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何安装或卸载在包含</font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">的插件库文件中实现的密钥环用户定义函数（UDF）
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关安装或卸载插件和UDF的一般信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
           </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#udf-compiling" title="28.4.2.5 UDF编译和安装"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.4.2.5节“UDF编译和安装”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          密钥环UDF启用密钥环密钥管理操作，但该</font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件也必须安装，因为如果没有它，UDF将无法正常工作。</font><font style="vertical-align: inherit;">试图在没有</font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件的</font><font style="vertical-align: inherit;">情况下使用UDF会
           </font><font style="vertical-align: inherit;">导致错误。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件库文件的基本名称是
           </font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个平台的文件名后缀都不相同（例如，</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Unix和类Unix系统，</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Windows）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要安装</font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件和UDF，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-function" title="13.1.13 CREATE FUNCTION语法"><code class="literal">CREATE FUNCTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要为您的平台</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL PLUGIN keyring_udf SONAME'keyring_udf.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE FUNCTION keyring_key_generate RETURNS INTEGER SONAME'keyring_udf.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE FUNCTION keyring_key_fetch RETURNS STRING SONAME'keyring_udf.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE FUNCTION keyring_key_length_fetch RETURNS INTEGER SONAME'keyring_udf.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE FUNCTION keyring_key_type_fetch RETURNS STRING SONAME'keyring_udf.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE FUNCTION keyring_key_store RETURNS INTEGER SONAME'keyring_udf.so';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE FUNCTION keyring_key_remove RETURNS INTEGER SONAME'keyring_udf.so';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果插件和UDF在主复制服务器上使用，请将它们安装在所有从属服务器上以避免复制问题。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          按照刚刚描述的方式安装后，
           </font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件和UDF将保持安装状态直到卸载。</font><font style="vertical-align: inherit;">要删除它们，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-function" title="13.1.24 DROP FUNCTION语法"><code class="literal">DROP FUNCTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN keyring_udf;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION keyring_key_generate;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION keyring_key_fetch;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION keyring_key_length_fetch;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION keyring_key_type_fetch;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION keyring_key_store;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION keyring_key_remove;</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="keyring-udf-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.8.2使用通用密钥环函数</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528112576512"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在使用密钥环用户定义函数（UDF）之前，请按照</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udf-installation" title="6.5.4.8.1安装或卸载通用键盘功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8.1节“安装或卸载通用密钥环函数”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的说明进行
           </font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udf-installation" title="6.5.4.8.1安装或卸载通用键盘功能"><font style="vertical-align: inherit;">安装</font></a><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          密钥环UDF受到这些限制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要使用任何密钥环UDF，</font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              必须启用</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">否则，会发生错误：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1123（HY000）：无法初始化函数'keyring_key_generate';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该功能需要未安装的keyring_udf插件。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请安装</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要安装该</font></font><code class="literal">keyring_udf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udf-installation" title="6.5.4.8.1安装或卸载通用键盘功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8.1节“安装或卸载通用钥匙环功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              密钥环UDF调用密钥环服务函数（请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">服务函数反过来使用安装的任何密钥环插件（例如</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">因此，要使用任何密钥环UDF，必须启用某个基础密钥环插件。</font><font style="vertical-align: inherit;">否则，会发生错误：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误3188（HY000）：功能'keyring_key_generate'失败，因为</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基础密钥环服务返回错误。</font><font style="vertical-align: inherit;">请检查一下</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
密钥环插件已安装，并且提供的参数是有效的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
你正在使用的钥匙圈。</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要安装密钥环插件，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-installation" title="6.5.4.1安装Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.1节“密钥环插件安装”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要使用任何密钥环UDF，用户必须拥有全局
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。</font><font style="vertical-align: inherit;">否则，会发生错误：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1123（HY000）：无法初始化函数'keyring_key_generate';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用户没有执行此功能的权限。</font><font style="vertical-align: inherit;">用户需要</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有EXECUTE</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要将全局</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              特权</font><font style="vertical-align: inherit;">授予</font><font style="vertical-align: inherit;">用户，请使用以下语句：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRANT EXECUTE ON *。* TO </font></font><em class="replaceable"><code>user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              或者，如果您希望避免授予全局</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权，同时仍允许用户访问特定的密钥管理操作，</font><font style="vertical-align: inherit;">则可以定义</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装器</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储的程序（本节后面介绍的一种技术）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由特定用户存储在密钥环中的密钥可以稍后由同一用户操纵。</font><font style="vertical-align: inherit;">也就是说，</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              键操作时函数</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">必须与键存储在键环中时的值相同。</font><font style="vertical-align: inherit;">（该约束排除了使用密钥环UDF来操作实例范围的密钥，例如为</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持表空间加密</font><font style="vertical-align: inherit;">而创建的</font><font style="vertical-align: inherit;">密钥环。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为了使多个用户能够对同一个键执行操作，</font><font style="vertical-align: inherit;">可以定义</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装器</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储的程序（本节后面将介绍一种技术）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于UDF接口的限制，密钥环UDF支持底层密钥环插件支持的密钥类型和长度，并且还有一个额外的约束，即密钥长度不能超过2048字节（16,384位）。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.7节“支持的密钥环密钥类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要创建一个新的随机密钥并将其存储在密钥环中，请调用
           </font></font><code class="literal">keyring_key_generate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该密钥，并将密钥的ID，密钥类型（加密方法）及其长度（以字节为单位）传递给它。</font><font style="vertical-align: inherit;">以下调用将创建一个名为为</font></font><code class="literal">MyKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">2,048位DSA加密的密钥</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_generate('MyKey', 'DSA', 256);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_generate（'MyKey'，'DSA'，256）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          返回值1表示成功。</font><font style="vertical-align: inherit;">如果无法创建密钥，则返回值为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并发生错误。</font><font style="vertical-align: inherit;">这可能的一个原因是基础密钥环插件不支持密钥类型和密钥长度的指定组合; </font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-types" title="6.5.4.7支持的密钥环密钥类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.7节“支持的密钥环密钥类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了能够检查返回类型而不管是否发生错误，请使用</font><font style="vertical-align: inherit;">并测试变量值：
        </font></font><code class="literal">SELECT ... INTO
          @<em class="replaceable"><code>var_name</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_generate('', '', -1) INTO @x;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误3188（HY000）：功能'keyring_key_generate'失败，因为</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基础密钥环服务返回错误。</font><font style="vertical-align: inherit;">请检查一下</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
密钥环插件已安装，并且提供的参数是有效的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
你正在使用的钥匙圈。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @x;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@x |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NULL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_generate('x', 'AES', 16) INTO @x;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SELECT @x;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@x |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这种技术也适用于其他关键环境UDF，这些关键环境失败返回一个值和一个错误。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          传递的ID </font></font><code class="literal">keyring_key_generate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提供了在后续UDF调用中引用密钥的方法。</font><font style="vertical-align: inherit;">例如，使用密钥ID将其类型检索为字符串或以字节为单位的整数长度：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_type_fetch('MyKey');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_type_fetch（'MyKey'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">DSA |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_length_fetch('MyKey');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_length_fetch（'MyKey'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">256 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要检索密钥值，请将密钥ID传递给
           </font></font><code class="literal">keyring_key_fetch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_hex"><code class="literal">HEX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示键值，因为它可能包含不可打印的字符。</font><font style="vertical-align: inherit;">为了简洁，该示例还使用了一个简短键，但请注意，较长的键可提供更好的安全性：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_generate('MyShortKey', 'DSA', 8);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_generate（'MyShortKey'，'DSA'，8）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT HEX(keyring_key_fetch('MyShortKey'));</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">HEX（keyring_key_fetch（'MyShortKey'））|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1DB3B0FC3328A24C |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          密钥环UDF将密钥ID，类型和值视为二进制字符串，因此比较区分大小写。</font><font style="vertical-align: inherit;">例如，ID </font></font><code class="literal">MyKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">mykey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用不同的密钥。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要删除密钥，请将密钥ID传递给
           </font></font><code class="literal">keyring_key_remove()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_remove('MyKey');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_remove（'MyKey'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要混淆和存储您提供的密钥，请将密钥ID，类型和值传递给</font></font><code class="literal">keyring_key_store()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_store('AES_key', 'AES', 'Secret string');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_store（'AES_key'，'AES'，'Secret string'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ----- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如前所述，用户必须具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用密钥环UDF </font><font style="vertical-align: inherit;">的全局
           </font><font style="vertical-align: inherit;">特权，并且最初将密钥存储在密钥环中的用户必须是稍后对密钥执行后续操作的相同用户，如根据
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个UDF调用。</font><font style="vertical-align: inherit;">为了允许不具有全局</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          特权的用户或者可能不是关键</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有者</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”的用户</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用这种技术：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              定义</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">封装了必要的按键操作，并有一个存储方案
               </font></font><code class="literal">DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于密钥所有者值。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为特定的存储程序授予应该能够调用它们的个人用户</font><font style="vertical-align: inherit;">
              的</font><font style="vertical-align: inherit;">特权。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果由包装存储程序实现的操作不包含密钥创建，则应使用</font></font><code class="literal">DEFINER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在存储的程序定义中</font><font style="vertical-align: inherit;">指定的帐户预先创建任何必需的密钥
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这种技术可以使用户在用户之间共享密钥，并为DBA提供更加细致的控制，以便谁可以使用密钥做什么，而无需授予全局特权。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下示例显示如何设置</font></font><code class="literal">SharedKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由DBA拥有的</font><font style="vertical-align: inherit;">名为的共享密钥
           </font><font style="vertical-align: inherit;">以及</font></font><code class="literal">get_shared_key()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供对当前密钥值的访问</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">存储函数。</font><font style="vertical-align: inherit;">该值可以由具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="literal">key_schema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式中</font><font style="vertical-align: inherit;">创建的该功能</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">特权
           </font><font style="vertical-align: inherit;">的任何用户检索
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从MySQL管理帐户（</font></font><code class="literal">'root'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本例中），创建管理模式和存储的函数以访问密钥：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>CREATE SCHEMA key_schema;</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>CREATE DEFINER = 'root'@'localhost'</code></strong>
       <strong class="userinput"><code>FUNCTION key_schema.get_shared_key()</code></strong>
       <strong class="userinput"><code>RETURNS BLOB READS SQL DATA</code></strong>
       <strong class="userinput"><code>RETURN keyring_key_fetch('SharedKey');</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从管理帐户中，确保共享密钥存在：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_generate('SharedKey', 'DSA', 8);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_generate（'SharedKey'，'DSA'，8）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从管理帐户中，创建要授予密钥访问权限的普通用户帐户：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>CREATE USER 'key_user'@'localhost'</code></strong>
       <strong class="userinput"><code>IDENTIFIED BY 'key_user_pwd';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从</font></font><code class="literal">key_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户中，验证没有适当的</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          权限，新帐户无法访问共享密钥：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT HEX(key_schema.get_shared_key());</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1370（42000）：执行命令拒绝用户'key_user'@'localhost'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例程'key_schema.get_shared_key'</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从管理帐户，授
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_execute"><code class="literal">EXECUTE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给
           </font></font><code class="literal">key_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了存储功能：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>GRANT EXECUTE ON FUNCTION key_schema.get_shared_key</code></strong>
       <strong class="userinput"><code>TO 'key_user'@'localhost';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从</font></font><code class="literal">key_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户中，确认密钥现在可以访问：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT HEX(key_schema.get_shared_key());</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">HEX（key_schema.get_shared_key（））|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">9BAFB9E75CEEB013 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------- +</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="keyring-udf-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.8.3通用密钥环功能参考</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于每个通用密钥环用户定义函数（UDF），本节描述其用途，调用顺序和返回值。</font><font style="vertical-align: inherit;">有关可以调用这些UDF的条件的信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udf-usage" title="6.5.4.8.2使用通用密钥环函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8.2节“使用通用键控函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">keyring_key_fetch()</code>
            </p><a class="indexterm" name="idm140528112473184"></a><a class="indexterm" name="idm140528112472096"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              给定密钥ID，反混淆并返回密钥值。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING keyring_key_fetch（STRING key_id）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">key_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：密钥ID作为字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果密钥不存在，则</font><font style="vertical-align: inherit;">
              返回成功的关键值</font><font style="vertical-align: inherit;">，或返回</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败的错误。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">keyring_key_fetch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于UDF界面的限制，</font><font style="vertical-align: inherit;">
                使用检索的密钥环值
                 </font><font style="vertical-align: inherit;">限制为2,048字节。</font><font style="vertical-align: inherit;">可以使用密钥环服务函数（见</font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">存储长度超过该长度的密钥环值
                 </font><font style="vertical-align: inherit;">，但是如果使用检索</font></font><code class="literal">keyring_key_fetch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则截断为2048字节。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_generate('RSA_key', 'RSA', 16);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_generate（'RSA_key'，'RSA'，16）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT HEX(keyring_key_fetch('RSA_key'));</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">HEX（keyring_key_fetch（'RSA_key'））|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">91C2253B696064D3556984B6630F891A |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_type_fetch('RSA_key');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_type_fetch（'RSA_key'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">RSA |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_length_fetch('RSA_key');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_length_fetch（'RSA_key'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">16 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该示例使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_hex"><code class="literal">HEX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示键值，因为它可能包含不可打印的字符。</font><font style="vertical-align: inherit;">为了简洁，该示例还使用了一个简短键，但请注意，较长的键提供更好的安全性。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">keyring_key_generate()</code>
            </p><a class="indexterm" name="idm140528112451600"></a><a class="indexterm" name="idm140528112450512"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              生成具有给定ID，类型和长度的新随机密钥，并将其存储在密钥环中。</font><font style="vertical-align: inherit;">由于UDF接口的限制，类型和长度值必须与基础密钥环插件支持的值一致，并且附加约束条件是密钥长度不能超过2,048字节（16,384位）。</font><font style="vertical-align: inherit;">有关每个插件允许的类型，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#keyring-service" title="28.3.2钥匙圈服务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.3.2节“密钥环服务”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING keyring_key_generate（STRING key_id，STRING key_type，INTEGER key_length）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">key_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：密钥ID作为字符串。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">key_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：键类型为字符串。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">key_length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：以字节为单位的密钥长度为整数。</font><font style="vertical-align: inherit;">最大长度是2,048。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回1表示成功，或者</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_generate('RSA_key', 'RSA', 384);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_generate（'RSA_key'，'RSA'，384）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">keyring_key_length_fetch()</code>
            </p><a class="indexterm" name="idm140528112435136"></a><a class="indexterm" name="idm140528112434048"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              给定密钥ID，返回密钥长度。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTEGER keyring_key_length_fetch（STRING key_id）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">key_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：密钥ID作为字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果密钥不存在，则</font><font style="vertical-align: inherit;">
              返回以字节为单位的密钥长度，
               </font><font style="vertical-align: inherit;">如果
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败则返回错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              请参阅说明
               </font></font><code class="literal">keyring_key_fetch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">keyring_key_remove()</code>
            </p><a class="indexterm" name="idm140528112422832"></a><a class="indexterm" name="idm140528112421744"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从密钥环中删除具有给定ID的密钥。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTEGER keyring_key_remove（STRING key_id）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">key_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：密钥ID作为字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回1表示成功或</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_remove('AES_key');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_remove（'AES_key'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">keyring_key_store()</code>
            </p><a class="indexterm" name="idm140528112410656"></a><a class="indexterm" name="idm140528112409568"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              混淆并存储密钥环中的密钥。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTEGER keyring_key_store（STRING key_id，STRING key_type，STRING键）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">key_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：密钥ID作为字符串。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">key_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：键类型为字符串。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：键值作为字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回1表示成功，或者</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT keyring_key_store('new key', 'DSA', 'My key value');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">keyring_key_store（'新密钥'，'DSA'，'我的密钥值'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">keyring_key_type_fetch()</code>
            </p><a class="indexterm" name="idm140528112395312"></a><a class="indexterm" name="idm140528112394224"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              给定密钥ID，返回密钥类型。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING keyring_key_type_fetch（STRING key_id）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">key_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：密钥ID作为字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果密钥不存在，则</font><font style="vertical-align: inherit;">
              返回键类型作为成功的字符串
               </font><font style="vertical-align: inherit;">，或者返回
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败的错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              请参阅说明
               </font></font><code class="literal">keyring_key_fetch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-udfs-plugin-specific"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.9特定于插件的密钥环密钥管理功能</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528112382752"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于每个特定于钥匙圈插件的用户定义函数（UDF），本节描述其用途，调用顺序和返回值。</font><font style="vertical-align: inherit;">有关通用密钥环UDF的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udfs-general-purpose" title="6.5.4.8通用密钥环密钥管理功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8节“通用密钥环密钥管理功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">keyring_aws_rotate_cmk()</code>
          </p><a class="indexterm" name="idm140528112378384"></a><a class="indexterm" name="idm140528112377280"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个UDF与</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">相关联
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它的使用需要
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。
          </font></font></p><p>
            <code class="literal">keyring_aws_rotate_cmk()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旋转客户主密钥（CMK）。</font><font style="vertical-align: inherit;">轮换仅更改AWS KMS用于后续数据密钥加密操作的密钥。</font><font style="vertical-align: inherit;">AWS KMS保留了以前的CMK版本，因此使用以前的CMK生成的密钥在轮换后仍保持可解密状态。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            旋转会更改AWS KMS中使用的CMK值，但不会更改用于引用它的ID，因此</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用后</font><font style="vertical-align: inherit;">无需更改
             </font><font style="vertical-align: inherit;">系统变量
             </font></font><code class="literal">keyring_aws_rotate_cmk()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            句法：
          </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTEGER keyring_aws_rotate_cmk（）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            参数：
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            没有。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            返回值：
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            返回1表示成功，或者</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">错误。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">keyring_aws_rotate_keys()</code>
          </p><a class="indexterm" name="idm140528112363936"></a><a class="indexterm" name="idm140528112362832"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个UDF与</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">相关联
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它的使用需要
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。
          </font></font></p><p>
            <code class="literal">keyring_aws_rotate_keys()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旋转存储在</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_data_file"><code class="literal">keyring_aws_data_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量</font><font style="vertical-align: inherit;">命名</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">存储文件
             </font><font style="vertical-align: inherit;">中的密钥</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Rotation会使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量的值作为CMK值</font><font style="vertical-align: inherit;">将文件中存储的每个密钥发送到AWS KMS进行重新加密
             </font><font style="vertical-align: inherit;">，并将新加密的密钥存储在文件中。
          </font></font></p><p>
            <code class="literal">keyring_aws_rotate_keys()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在这些情况下对密钥重新加密很有用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                旋转CMK后; </font><font style="vertical-align: inherit;">也就是在调用
                 </font></font><code class="literal">keyring_aws_rotate_cmk()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDF之后
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                将
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量更改为其他键值后
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            句法：
          </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTEGER keyring_aws_rotate_keys（）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            参数：
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            没有。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            返回值：
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            返回1表示成功，或者</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败</font><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">错误。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.10密钥环命令选项</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL支持以下与密钥环相关的命令行选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_keyring-migration-destination"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-destination"><code class="option">--keyring-migration-destination=<em class="replaceable"><code>plugin</code></em></code></a>
</p><a class="indexterm" name="idm140528112340272"></a><a class="indexterm" name="idm140528112338768"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-destination"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-migration-destination=plugin_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            密钥迁移的目标密钥环插件。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">期权价值的格式和解释与该期权所描述的相同
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              并且
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-destination"><code class="option">--keyring-migration-destination</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于所有密钥环迁移操作都是强制性的。</font><font style="vertical-align: inherit;">源插件和目标插件必须不同，并且迁移服务器必须同时支持两种插件。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_keyring-migration-host"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-host"><code class="option">--keyring-migration-host=<em class="replaceable"><code>host_name</code></em></code></a>
</p><a class="indexterm" name="idm140528112315088"></a><a class="indexterm" name="idm140528112313584"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-host"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-migration-host=host_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">localhost</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            正在使用其中一个密钥迁移密钥库的正在运行的服务器的主机位置。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">迁移总是发生在本地主机上，因此该选项始终指定用于连接到本地服务器，如值
             </font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">127.0.0.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或本地主机IP地址或主机名。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-password"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-password"><code class="option">--keyring-migration-password[=<em class="replaceable"><code>password</code></em>]</code></a>
</p><a class="indexterm" name="idm140528112288400"></a><a class="indexterm" name="idm140528112286896"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-password"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-migration-password[=password]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于连接到当前正在使用其中一个密钥迁移密钥库的正在运行的服务器的密码。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在命令行中</font><font style="vertical-align: inherit;">省略</font><font style="vertical-align: inherit;">选项名称后面</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">值，则服务器会提示输入一个值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在命令行中指定密码应被视为不安全。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-security-user" title="6.1.2.1密码安全的最终用户指南"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.1节“密码安全的最终用户指南”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以使用选项文件来避免在命令行上输入密码。</font><font style="vertical-align: inherit;">在这种情况下，文件应具有限制模式，并且只能由用于运行迁移服务器的帐户访问。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-port"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-port"><code class="option">--keyring-migration-port=<em class="replaceable"><code>port_num</code></em></code></a>
</p><a class="indexterm" name="idm140528112265344"></a><a class="indexterm" name="idm140528112263840"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-port"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-migration-port=port_num</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">3306</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于TCP / IP连接，用于连接到当前正在使用其中一个密钥迁移密钥库的正在运行的服务器的端口号。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-socket"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-socket"><code class="option">--keyring-migration-socket=<em class="replaceable"><code>path</code></em></code></a>
</p><a class="indexterm" name="idm140528112241088"></a><a class="indexterm" name="idm140528112239584"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-socket"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-migration-socket={file_name|pipe_name}</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于Unix套接字文件或Windows命名的管道连接，套接字文件或命名管道用于连接到当前正在使用其中一个密钥迁移密钥库的正在运行的服务器。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-source"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source=<em class="replaceable"><code>plugin</code></em></code></a>
</p><a class="indexterm" name="idm140528112219920"></a><a class="indexterm" name="idm140528112218416"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-source"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-migration-source=plugin_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于密钥迁移的源密钥环插件。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项的值类似于
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，除了只能指定一个插件库。</font><font style="vertical-align: inherit;">该值以</font><font style="vertical-align: inherit;">
            或者</font><font style="vertical-align: inherit;">给出
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这
             </font><font style="vertical-align: inherit;">是要加载的插件的名称，并且</font><font style="vertical-align: inherit;">是包含插件代码的库文件的名称。</font><font style="vertical-align: inherit;">如果插件库的名称没有任何前面的插件名称，则服务器会加载库中的所有插件。</font><font style="vertical-align: inherit;">服务器在由</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录中查找插件库文件</font><font style="vertical-align: inherit;">。
</font></font><em class="replaceable"><code>name</code></em><code class="literal">=</code><em class="replaceable"><code>plugin_library</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>plugin_library</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>plugin_library</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              并且
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-destination"><code class="option">--keyring-migration-destination</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于所有密钥环迁移操作都是强制性的。</font><font style="vertical-align: inherit;">源插件和目标插件必须不同，并且迁移服务器必须同时支持两种插件。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_keyring-migration-user"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_keyring-migration-user"><code class="option">--keyring-migration-user=<em class="replaceable"><code>user_name</code></em></code></a>
</p><a class="indexterm" name="idm140528112190096"></a><a class="indexterm" name="idm140528112188592"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-user"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-migration-user=user_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于连接到当前正在使用其中一个密钥迁移密钥库的正在运行的服务器的用户名。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-system-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4.11钥匙圈系统变量</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528112169920"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL Keyring插件支持以下系统变量。</font><font style="vertical-align: inherit;">使用它们来配置密钥环插件操作。</font><font style="vertical-align: inherit;">除非安装了相应的密钥环插件，否则这些变量不可用（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-installation" title="6.5.4.1安装Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.1节“安装Keyring插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_keyring_aws_cmk_id"></a>
            <a class="indexterm" name="idm140528112166256"></a>

            <a class="indexterm" name="idm140528112165216"></a>

            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_aws_cmk_id"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-aws-cmk-id</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_cmk_id">keyring_aws_cmk_id</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从AWS KMS服务器获取并由</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            插件</font><font style="vertical-align: inherit;">使用的客户主密钥（CMK）ID </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非安装了该插件，否则此变量不可用，但如果安装了该变量，则必须为此变量赋值。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_keyring_aws_conf_file"></a>
            <a class="indexterm" name="idm140528112136464"></a>

            <a class="indexterm" name="idm140528112135424"></a>

            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_conf_file"><code class="literal">keyring_aws_conf_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_aws_conf_file"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-aws-conf-file</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_conf_file">keyring_aws_conf_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥环插件</font><font style="vertical-align: inherit;">
            的配置文件的位置
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非安装了该插件，否则此变量不可用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在插件启动时，</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从配置文件中读取AWS秘密访问密钥ID和密钥。</font><font style="vertical-align: inherit;">为使</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件成功启动，配置文件必须存在并包含有效的秘密访问密钥信息，如</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-aws-plugin" title="6.5.4.5使用keyring_aws Amazon Web Services Keyring插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.5节“使用keyring_aws Amazon Web Services Keyring插件”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述进行初始化</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认文件名称
             </font></font><code class="literal">keyring_aws_conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于默认的密钥环文件目录中。</font><font style="vertical-align: inherit;">此默认目录的位置与</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的位置相同
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关详细信息，请参阅该变量的说明，以及在手动创建目录时要考虑的注意事项。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_keyring_aws_data_file"></a>
            <a class="indexterm" name="idm140528112098144"></a>

            <a class="indexterm" name="idm140528112097104"></a>

            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_data_file"><code class="literal">keyring_aws_data_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_aws_data_file"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-aws-data-file</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_data_file">keyring_aws_data_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥环插件</font><font style="vertical-align: inherit;">
            的存储文件的位置
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非安装了该插件，否则此变量不可用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在插件启动时，如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_data_file"><code class="literal">keyring_aws_data_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            指定</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">指定了不存在的文件，
             </font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件会尝试创建它（以及必要时的父目录）。</font><font style="vertical-align: inherit;">如果该文件存在，则将该文件中</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含的所有加密密钥读入其内存中缓存。</font></font><code class="literal">keyring_aws</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会在内存中缓存未加密的密钥。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认文件名称
             </font></font><code class="literal">keyring_aws_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于默认的密钥环文件目录中。</font><font style="vertical-align: inherit;">此默认目录的位置与</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的位置相同
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关详细信息，请参阅该变量的说明，以及在手动创建目录时要考虑的注意事项。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_keyring_aws_region"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_region"><code class="literal">keyring_aws_region</code></a>
</p><a class="indexterm" name="idm140528112057088"></a><a class="indexterm" name="idm140528112056048"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_aws_region"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-aws-region</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_aws_region">keyring_aws_region</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">us-east-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">ap-northheast-1</code></p><p class="valid-value"><code class="literal">ap-northheast-2</code></p><p class="valid-value"><code class="literal">ap-south-1</code></p><p class="valid-value"><code class="literal">ap-southeast-1</code></p><p class="valid-value"><code class="literal">ap-southeast-2</code></p><p class="valid-value"><code class="literal">eu-central-1</code></p><p class="valid-value"><code class="literal">eu-west-1</code></p><p class="valid-value"><code class="literal">sa-east-1</code></p><p class="valid-value"><code class="literal">us-east-1</code></p><p class="valid-value"><code class="literal">us-west-1</code></p><p class="valid-value"><code class="literal">us-west-2</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            AWS地区。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_keyring_encrypted_file_data"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
</p><a class="indexterm" name="idm140528112012112"></a><a class="indexterm" name="idm140528112011008"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_encrypted_file_data"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-encrypted-file-data=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_data">keyring_encrypted_file_data</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">安全数据存储的数据文件的路径名称</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非安装了该插件，否则此变量不可用。</font><font style="vertical-align: inherit;">文件位置应该位于仅供密钥环插件使用的目录中。</font><font style="vertical-align: inherit;">例如，不要在数据目录下找到该文件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            密钥环操作是事务性的：
             </font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件在写入操作期间使用备份文件以确保在操作失败时它可以回滚到原始文件。</font><font style="vertical-align: inherit;">备份文件的名称与</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量</font><font style="vertical-align: inherit;">的值相同
             </font><font style="vertical-align: inherit;">，后缀为
             </font></font><code class="filename">.backup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不要</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为多个MySQL实例</font><font style="vertical-align: inherit;">使用相同的
             </font><font style="vertical-align: inherit;">数据文件。</font><font style="vertical-align: inherit;">每个实例都应该有自己独特的数据文件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认文件名
             </font></font><code class="filename">keyring_encrypted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于特定于平台的目录中，并且取决于</font><span class="command"><strong><font style="vertical-align: inherit;">CMake</font></strong></span><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的值，</font><font style="vertical-align: inherit;">如下表所示。</font><font style="vertical-align: inherit;">要明确指定文件的默认目录（如果从源代码构建），请使用
             </font><span class="command"><strong><font style="vertical-align: inherit;">CMake</font></strong></span><font style="vertical-align: inherit;">选项。
</font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_install_layout"><code class="option">INSTALL_LAYOUT</code></a>
            <span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_install_mysqlkeyringdir"><code class="option">INSTALL_MYSQLKEYRINGDIR</code></a>
            <span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font></p>
<div class="informaltable">
<table summary="The default keyring_encrypted_file_data value for different INSTALL_LAYOUT values."><colgroup><col width="35%"><col width="65%"></colgroup><thead><tr>
                <th scope="col"><code class="literal">INSTALL_LAYOUT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 值</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font><code class="literal">keyring_encrypted_file_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">DEB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">RPM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">SLES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                  </font></font><code class="literal">SVR4</code></td>
                <td><code class="filename">/var/lib/mysql-keyring/keyring_encrypted</code></td>
              </tr><tr>
                <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除此以外</font></font></td>
                <td><code class="filename">keyring/keyring_encrypted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低于
                   </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_cmake_install_prefix"><code class="option">CMAKE_INSTALL_PREFIX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  价值</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在插件启动时，如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            指定</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">指定了不存在的文件，
             </font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件会尝试创建它（以及必要时的父目录）。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您手动创建目录，则它应该具有限制模式，并且只能由用于运行MySQL服务器的帐户访问。</font><font style="vertical-align: inherit;">例如，在Unix和类Unix系统上，要使用该
             </font></font><code class="filename">/usr/local/mysql/mysql-keyring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            目录，以下命令（执行为
             </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）会创建该目录并设置其模式和所有权：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd / usr / local / mysql</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mkdir mysql-keyring</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chmod 750 mysql-keyring</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chown mysql mysql-keyring</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chgrp mysql mysql-keyring</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件无法创建或访问其数据文件，则会向错误日志写入错误消息。</font><font style="vertical-align: inherit;">如果尝试运行时分配
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            导致错误，则变量值保持不变。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一旦</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件创建了它的数据文件并开始使用它，重要的是不要删除文件。</font><font style="vertical-align: inherit;">文件丢失将导致使用其密钥加密的数据变得无法访问。</font><font style="vertical-align: inherit;">（只要您更改值</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              以匹配</font><font style="vertical-align: inherit;">，就可以重命名或移动文件
               </font><font style="vertical-align: inherit;">。）
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_keyring_encrypted_file_password"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_password"><code class="literal">keyring_encrypted_file_password</code></a>
</p><a class="indexterm" name="idm140528111941712"></a><a class="indexterm" name="idm140528111940608"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_encrypted_file_password"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-encrypted-file-password=password</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_encrypted_file_password">keyring_encrypted_file_password</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">
            使用的密码
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非安装了该插件，否则此变量不可用。</font><font style="vertical-align: inherit;">插件操作必须输入密码; </font><font style="vertical-align: inherit;">如果在服务器启动时未指定，则</font></font><code class="literal">keyring_encrypted_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            初始化失败。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果在选项文件中指定了此变量，则该文件应具有限制模式，并且只能由用于运行MySQL服务器的帐户访问。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于显示值被混淆</font><font style="vertical-align: inherit;">
            ，密码值无法在运行时使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-variables" title="13.7.5.39 SHOW VARIABLES语法"><code class="literal">SHOW VARIABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance Schena
             </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-system-variable-tables" title="25.11.13性能模式系统变量表"><code class="literal">global_variables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表显示。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_keyring_file_data"></a>
            <a class="indexterm" name="idm140528111911488"></a>

            <a class="indexterm" name="idm140528111910448"></a>

            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_file_data"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-file-data=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.11</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data">keyring_file_data</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">安全数据存储的数据文件的路径名称</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非安装了该插件，否则此变量不可用。</font><font style="vertical-align: inherit;">文件位置应该位于仅供密钥环插件使用的目录中。</font><font style="vertical-align: inherit;">例如，不要在数据目录下找到该文件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            密钥环操作是事务性的：
             </font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件在写入操作期间使用备份文件以确保在操作失败时它可以回滚到原始文件。</font><font style="vertical-align: inherit;">备份文件的名称与</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同
             </font><font style="vertical-align: inherit;">，后缀为</font></font><code class="filename">.backup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不要</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为多个MySQL实例</font><font style="vertical-align: inherit;">使用相同的</font><font style="vertical-align: inherit;">数据文件。</font><font style="vertical-align: inherit;">每个实例都应该有自己独特的数据文件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认文件名</font></font><code class="filename">keyring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于特定于平台的目录中，并且取决于</font><span class="command"><strong><font style="vertical-align: inherit;">CMake</font></strong></span><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的值，
             </font><font style="vertical-align: inherit;">如下表所示。</font><font style="vertical-align: inherit;">要明确指定文件的默认目录（如果从源代码构建），请使用
             </font><span class="command"><strong><font style="vertical-align: inherit;">CMake</font></strong></span><font style="vertical-align: inherit;">选项。
</font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_install_layout"><code class="option">INSTALL_LAYOUT</code></a>
            <span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_install_mysqlkeyringdir"><code class="option">INSTALL_MYSQLKEYRINGDIR</code></a>
            <span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font></p>
<div class="informaltable">
<table summary="The default keyring_file_data value for different INSTALL_LAYOUT values."><colgroup><col width="35%"><col width="65%"></colgroup><thead><tr>
                <th scope="col"><code class="literal">INSTALL_LAYOUT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 值</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font><code class="literal">keyring_file_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">DEB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">RPM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">SLES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                  </font></font><code class="literal">SVR4</code></td>
                <td><code class="filename">/var/lib/mysql-keyring/keyring</code></td>
              </tr><tr>
                <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除此以外</font></font></td>
                <td><code class="filename">keyring/keyring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低于
                   </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_cmake_install_prefix"><code class="option">CMAKE_INSTALL_PREFIX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  价值</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在插件启动时，如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">指定了不存在的文件，
             </font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件会尝试创建它（以及必要时的父目录）。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您手动创建目录，则它应该具有限制模式，并且只能由用于运行MySQL服务器的帐户访问。</font><font style="vertical-align: inherit;">例如，在Unix和类Unix系统上，要使用该
             </font></font><code class="filename">/usr/local/mysql/mysql-keyring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            目录，以下命令（执行为
             </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）会创建该目录并设置其模式和所有权：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd / usr / local / mysql</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mkdir mysql-keyring</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chmod 750 mysql-keyring</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chown mysql mysql-keyring</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chgrp mysql mysql-keyring</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件无法创建或访问其数据文件，则会向错误日志写入错误消息。</font><font style="vertical-align: inherit;">如果尝试运行时分配
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致错误，则变量值保持不变。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一旦</font></font><code class="literal">keyring_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件创建了它的数据文件并开始使用它，重要的是不要删除文件。</font><font style="vertical-align: inherit;">例如，
               </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该文件将用于解密数据的主密钥存储在使用表空间加密的表中; </font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-tablespace-encryption" title="14.7.10 InnoDB表空间加密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.7.10节“InnoDB表空间加密”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">文件丢失将导致此类表中的数据无法访问。</font><font style="vertical-align: inherit;">（只要您改变文件的值，就可以重命名或移动文件
              </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 以匹配）。建议您在创建第一个加密表之后以及主密钥轮换之前和之后立即创建密钥环数据文件的单独备份。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_keyring_okv_conf_dir"></a>
            <a class="indexterm" name="idm140528111839552"></a>

            <a class="indexterm" name="idm140528111838512"></a>

            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_okv_conf_dir"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--keyring-okv-conf-dir=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.12</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir">keyring_okv_conf_dir</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录名称</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">empty string</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            存储</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            插件</font><font style="vertical-align: inherit;">使用的配置信息的目录的路径名</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非安装了该插件，否则此变量不可用。</font><font style="vertical-align: inherit;">该位置应该是仅供</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">使用的目录</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，不要在数据目录下找到该目录。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为空。</font><font style="vertical-align: inherit;">为使</font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件能够访问Oracle Key Vault，必须将该值设置为包含Oracle Key Vault配置和SSL材料的目录。</font><font style="vertical-align: inherit;">有关设置此目录的说明，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-okv-plugin" title="6.5.4.4使用keyring_okv KMIP插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.4节“使用keyring_okv KMIP插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该目录应该具有限制模式，并且只能由用于运行MySQL服务器的帐户访问。</font><font style="vertical-align: inherit;">例如，在Unix和类Unix系统上，要使用该
             </font></font><code class="filename">/usr/local/mysql/mysql-keyring-okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            目录，以下命令（执行为
             </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）会创建该目录并设置其模式和所有权：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd / usr / local / mysql</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mkdir mysql-keyring-okv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chmod 750 mysql-keyring-okv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chown mysql mysql-keyring-okv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
chgrp mysql mysql-keyring-okv</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果分配的值指定
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不存在的目录，或者不包含启用与Oracle密钥保管库连接的配置信息，
             </font></font><code class="literal">keyring_okv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则会将错误消息写入错误日志。</font><font style="vertical-align: inherit;">如果尝试运行时分配
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            导致错误，则变量值和密钥环操作保持不变。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_keyring_operations"></a>
            <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a>
</p><a class="indexterm" name="idm140528111793776"></a><a class="indexterm" name="idm140528111792736"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_operations"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_keyring_operations">keyring_operations</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是否启用密钥环操作。</font><font style="vertical-align: inherit;">此密钥在密钥迁移操作中使用。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-key-migration" title="6.5.4.6在密钥环密钥库之间迁移密钥"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.6节“在Keyring密钥库之间迁移密钥”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="audit-log"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5 MySQL企业审计</font></font></h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-components"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.1审计日志组件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-installation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.2安装或卸载MySQL企业审计</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-security"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.3 MySQL企业审计安全注意事项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-file-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.4审计日志文件格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-logging-control"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.5审计日志记录控制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-filtering"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.6审计日志过滤</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.7传统模式审计日志过滤</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.8审计日志参考</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#audit-log-restrictions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.9审计日志限制</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528111765152"></a><a class="indexterm" name="idm140528111764080"></a><a class="indexterm" name="idm140528111762592"></a><a class="indexterm" name="idm140528111761520"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL企业审计是MySQL企业版（一种商业产品）中的扩展。</font><font style="vertical-align: inherit;">要了解有关商业产品的更多信息，请
         </font></font><a class="ulink" href="http://www.mysql.com/products/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问http://www.mysql.com/products/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL企业版包括MySQL企业审计，使用名为服务器的插件实现
       </font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQL企业审计使用开放的MySQL审计API来实现标准的，基于策略的监视，记录和阻止在特定MySQL服务器上执行的连接和查询活动。</font><font style="vertical-align: inherit;">旨在满足Oracle审计规范的需求，MySQL企业审计为受内部和外部监管准则管理的应用程序提供了一款即装即用，易于使用的审计和合规性解决方案。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      安装时，审计插件使MySQL服务器能够生成包含服务器活动审计记录的日志文件。</font><font style="vertical-align: inherit;">日志内容包括客户端连接和断开连接以及连接时执行的操作，如访问哪些数据库和表。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      安装审计插件后（请参阅
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-installation" title="6.5.5.2安装或卸载MySQL企业审计"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.2节“安装或卸载MySQL企业审计”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），它会写入一个审计日志文件。</font><font style="vertical-align: inherit;">默认情况下，该文件是</font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在服务器数据目录中</font><font style="vertical-align: inherit;">命名</font><font style="vertical-align: inherit;">的。</font><font style="vertical-align: inherit;">要更改文件的名称，请</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">系统变量。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      默认情况下，审计日志文件内容以新式XML格式编写，无需压缩或加密。</font><font style="vertical-align: inherit;">要选择文件格式，请</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在服务器启动时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">有关文件格式和内容的详细信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-formats" title="6.5.5.4审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.4节“审核日志文件格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关控制记录方式的更多信息，包括审计日志文件命名和格式选择，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要执行审核事件的过滤，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering" title="6.5.5.6审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.6节“审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关用于配置审计日志插件的参数的说明，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-options-variables" title="6.5.5.8.4审计日志选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.4节“审计日志选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果启用审计日志插件，则性能模式（请参阅
       </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html" title="第25章MySQL性能模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL性能模式</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）具有检测工具。</font><font style="vertical-align: inherit;">要识别相关仪器，请使用以下查询：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从performance_schema.setup_instruments中选择名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名称如'％/ alog /％';</font></font><font></font>
</pre>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-components"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.1审计日志组件</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL企业审计基于审计日志插件和相关组件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个名为服务器端的插件</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            检查可审计事件并确定是否将它们写入审计日志。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用户定义的函数可以对控制日志行为，加密密码和日志文件读取的过滤定义进行操作。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库</font><font style="vertical-align: inherit;">
            中的表格</font><font style="vertical-align: inherit;">提供过滤器和用户帐户数据的持久存储。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量启用审计日志配置，状态变量提供运行时操作信息。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL 5.7.13之前，MySQL企业审计只包含
           </font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件并以传统模式运行。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“传统模式审计日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.2安装或卸载MySQL企业审计</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528111731328"></a><a class="indexterm" name="idm140528111729872"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何安装或卸载MySQL企业审计，该审计是使用</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-components" title="6.5.5.1审计日志组件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.1节“审计日志组件”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的审计日志插件和相关组件实现的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果安装，</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件即使在禁用时也会涉及一些最小开销。</font><font style="vertical-align: inherit;">为了避免这种开销，除非您打算使用它，否则不要安装MySQL企业审计。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了供服务器使用，插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录</font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这里的说明适用于MySQL 5.7.13或更高版本。</font><font style="vertical-align: inherit;">对于5.7.13之前的MySQL版本，请参阅
           </font><font style="vertical-align: inherit;">在
           </font><a class="ulink" href="http://dev.mysql.com/doc/refman/5.6/en/" target="_top"><font style="vertical-align: inherit;">MySQL 5.6参考手册中</font></a></font><a class="ulink" href="http://dev.mysql.com/doc/refman/5.6/en/audit-log-installation.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装MySQL企业审计</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font><a class="ulink" href="http://dev.mysql.com/doc/refman/5.6/en/" target="_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此外，在MySQL 5.7.13之前，MySQL企业审计仅
           </font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含插件，并且不包含</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-components" title="6.5.5.1审计日志组件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.1节“审核日志组件”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的其他组件
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从MySQL 5.7.13开始，如果</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件已经从5.7.13之前的MySQL版本安装，请使用以下语句将其卸载，然后在安装当前版本之前重新启动服务器：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL PLUGIN audit_log;
</font></font></pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要安装MySQL企业审计，请查看</font></font><code class="filename">share</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您的MySQL安装目录并选择适合您的平台的脚本。</font><font style="vertical-align: inherit;">可用的脚本在用于引用插件库文件的后缀中有所不同：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename">audit_log_filter_win_install.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：为</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作文件名后缀的</font><font style="vertical-align: inherit;">Windows系统选择此脚本
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="filename">audit_log_filter_linux_install.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：选择此脚本用于Linux以及</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作文件名后缀的</font><font style="vertical-align: inherit;">类似系统
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        按如下所示运行脚本。</font><font style="vertical-align: inherit;">这里的例子使用Linux安装脚本。</font><font style="vertical-align: inherit;">为您的系统做适当的替换。
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql -u root -p &lt; audit_log_filter_linux_install.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><em class="replaceable"><code>(enter root password here)</code></em>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从MySQL 5.7.21开始，使用MySQL Enterprise Audit的新安装，
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于审计日志表。</font><font style="vertical-align: inherit;">对于已安装MySQL企业审计的安装的升级，建议您更改审计日志表以使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE mysql.audit_log_user ENGINE = InnoDB;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE mysql.audit_log_filter ENGINE = InnoDB;</font></font><font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要验证插件安装，请检查该
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'audit%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        安装MySQL企业审计后，您可以使用该
         </font></font><code class="option">--audit-log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项进行后续服务器启动，以控制</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件激活。</font><font style="vertical-align: inherit;">例如，要防止插件在运行时被删除，请使用以下选项：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
审计日志= FORCE_PLUS_PERMANENT</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果希望防止服务器在没有审计插件的情况下运行，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_audit-log"><code class="option">--audit-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        值</font></font><code class="literal">FORCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">FORCE_PLUS_PERMANENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制插件未成功初始化时强制服务器启动失败。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          默认情况下，基于规则的审计日志过滤不记录任何用户的可审计事件。</font><font style="vertical-align: inherit;">这与传统审计日志行为（在MySQL 5.7.13之前）不同，后者记录所有用户的所有可审计事件。</font><font style="vertical-align: inherit;">如果您希望通过基于规则的过滤来生成日志 - 所有行为，请创建一个简单的过滤器来启用日志记录并将其分配给默认帐户：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT audit_log_filter_set_filter（'log_all'，'{“filter”：{“log”：true}}'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT audit_log_filter_set_user（'％'，'log_all'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分配给的过滤器</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于来自任何没有明确分配过滤器的账户的连接（最初对所有账户均为真）。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一旦按照刚刚描述的方式安装，MySQL企业审计保持安装状态直到卸载。</font><font style="vertical-align: inherit;">要删除它，请执行以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP TABLE IF EXISTS mysql.audit_log_filter;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP TABLE IF EXISTS mysql.audit_log_user;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNINSTALL PLUGIN audit_log;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_filter_set_filter;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_filter_remove_filter;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_filter_set_user;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_filter_remove_user;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_filter_flush;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_encryption_password_get;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_encryption_password_set;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_read;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION audit_log_read_bookmark;</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-security"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.3 MySQL企业审计安全注意事项</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        默认情况下，审计日志插件生成的审计日志文件的内容未加密，并且可能包含敏感信息，例如SQL语句的文本。</font><font style="vertical-align: inherit;">出于安全考虑，应将审计日志文件写入只能由MySQL服务器访问的目录以及有合法理由查看日志的用户。</font><font style="vertical-align: inherit;">默认文件名
         </font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据目录中。</font><font style="vertical-align: inherit;">这可以通过</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">来更改
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">其他审核日志文件可能因日志旋转而存在。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了增加安全性，请启用审计日志文件加密。</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-encryption" title="审计日志文件加密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件加密</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-file-formats"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.4审计日志文件格式</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL服务器调用审计日志插件在审计事件发生时将审计记录写入其日志文件。</font><font style="vertical-align: inherit;">通常，插件启动后编写的第一个审计记录包含服务器描述和启动选项。</font><font style="vertical-align: inherit;">接下来的元素代表事件，例如客户端连接和断开事件，执行的SQL语句等等。</font><font style="vertical-align: inherit;">只记录顶级语句，而不是存储程序（如触发器或存储过程）中的语句。</font><font style="vertical-align: inherit;">由诸如此类的语句引用的文件的内容
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未被记录。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要选择审计日志插件用于写入其日志文件的日志记录格式，请</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时</font><font style="vertical-align: inherit;">设置
         </font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">这些格式可用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            旧式XML格式（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=OLD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：旧版MySQL系列中默认使用的原始审计日志记录格式。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            新式XML格式（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=NEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：与旧式XML格式相比，与Oracle Audit Vault具有更好兼容性的XML格式。</font><font style="vertical-align: inherit;">MySQL 5.7默认使用新式的XML格式。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            JSON格式（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        默认情况下，审计日志文件内容以新式XML格式编写，无需压缩或加密。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关更改日志格式时要考虑的问题的信息，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-format" title="审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件格式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下各节介绍可用的审计日志记录格式：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-old-style-xml-format" title="旧式的XML审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旧式的XML审计日志文件格式</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-new-style-xml-format" title="新式XML审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新式XML审计日志文件格式</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-json-format" title="JSON审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON审计日志文件格式</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="audit-log-file-old-style-xml-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旧式的XML审计日志文件格式</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这是一个旧式XML格式（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=OLD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的示例日志文件，</font><font style="vertical-align: inherit;">为了便于阅读，稍作重新格式化：
        </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;？xml version =“1.0”encoding =“utf-8”？&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;AUDIT&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;AUDIT_RECORD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    TIMESTAMP =“2017-10-16T14：25:00 UTC”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    RECORD_ID = “1_2017-10-16T14：25：00”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    NAME = “审计”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    SERVER_ID = “1”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    VERSION = “1”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    STARTUP_OPTIONS = “ - 端口= 3306”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    OS_VERSION = “i686的Linux的”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MYSQL_VERSION = “21年5月7日日志”/&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;AUDIT_RECORD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    TIMESTAMP =“2017-10-16T14：25：24 UTC”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    RECORD_ID = “2_2017-10-16T14：25：00”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    NAME = “连接”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    CONNECTION_ID = “4”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    STATUS = “0”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    STATUS_CODE = “0”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    USER = “根”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    OS_LOGIN = “”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    HOST = “本地主机”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IP = “127.0.0.1”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    COMMAND_CLASS = “连接”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    CONNECTION_TYPE = “SSL / TLS”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIV_USER = “根”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PROXY_USER = “”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    DB = “测试”/&gt;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;AUDIT_RECORD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    TIMESTAMP =“2017-10-16T14：25：24 UTC”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    RECORD_ID = “6_2017-10-16T14：25：00”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    NAME = “查询”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    CONNECTION_ID = “4”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    STATUS = “0”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    STATUS_CODE = “0”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    USER =“root [root] @ localhost [127.0.0.1]”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    OS_LOGIN = “”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    HOST = “本地主机”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IP = “127.0.0.1”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    COMMAND_CLASS = “drop_table”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    SQLTEXT =“DROP TABLE IF EXISTS t”/&gt;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;AUDIT_RECORD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    TIMESTAMP =“2017-10-16T14：25：24 UTC”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    RECORD_ID = “8_2017-10-16T14：25：00”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    NAME = “退出”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    CONNECTION_ID = “4”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    STATUS = “0”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    STATUS_CODE = “0”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    USER = “根”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    OS_LOGIN = “”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    HOST = “本地主机”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IP = “127.0.0.1”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    COMMAND_CLASS = “连接”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    CONNECTION_TYPE = “SSL / TLS”/&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;AUDIT_RECORD</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    TIMESTAMP =“2017-10-16T14：25：32 UTC”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    RECORD_ID = “12_2017-10-16T14：25：00”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    NAME = “NOAUDIT”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    SERVER_ID = “1”/&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;/ AUDIT&gt;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志文件使用UTF-8编写为XML（每个字符最多4个字节）。</font><font style="vertical-align: inherit;">根元素是
           </font></font><code class="literal">&lt;AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">根元素包含
           </font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素，每个元素提供有关审核事件的信息。</font><font style="vertical-align: inherit;">当审计日志插件开始编写新的日志文件时，它会写入XML声明并打开</font></font><code class="literal">&lt;AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          根元素标记。</font><font style="vertical-align: inherit;">当插件关闭日志文件时，它会写入结束</font></font><code class="literal">&lt;/AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根元素标记。</font><font style="vertical-align: inherit;">文件打开时结束标记不存在。
        </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素的</font><font style="vertical-align: inherit;">
          属性</font><font style="vertical-align: inherit;">具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              某些属性出现在每个
               </font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素中。</font><font style="vertical-align: inherit;">其他是可选的，可能会根据审计记录类型显示。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不保证元素</font><font style="vertical-align: inherit;">
              内的属性顺序
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              属性值不是固定的长度。</font><font style="vertical-align: inherit;">长的值可能会被截断，如后面给出的属性描述中所示。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的</font></font><code class="literal">&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">&amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              字符被编码为</font></font><code class="literal">&amp;lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">&amp;gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">&amp;quot;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><code class="literal">&amp;amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，分别。</font><font style="vertical-align: inherit;">NUL字节（U + 00）被编码为</font></font><code class="literal">?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              作为XML字符无效的字符使用数字字符引用进行编码。</font><font style="vertical-align: inherit;">有效的XML字符是：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃x9 | </font><font style="vertical-align: inherit;">#xA | </font><font style="vertical-align: inherit;">#xD | </font><font style="vertical-align: inherit;">[＃x20-＃xD7FF] | </font><font style="vertical-align: inherit;">[＃xE000-＃xFFFD] | </font><font style="vertical-align: inherit;">[＃x10000-＃x10FFFF]
</font></font></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下属性在每个</font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素中</font><font style="vertical-align: inherit;">都是必需的
           </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NAME</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示生成审计事件的指令类型的字符串，例如服务器从客户端接收的命令。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">NAME="Query"</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一些常见</font></font><code class="literal">NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计开始审计时，可能是服务器启动时间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
连接当客户端连接时，也称为登录</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询SQL语句（直接执行）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
准备SQL语句的准备; </font><font style="vertical-align: inherit;">通常后面是Execute</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
执行SQL语句的执行; </font><font style="vertical-align: inherit;">通常在Prepare后面</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关机服务器关机</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
退出客户端断开连接时</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NoAudit Auditing已关闭</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可能的值是</font></font><code class="literal">Audit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Binlog Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Change
              user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Close stmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Connect Out</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Create DB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Daemon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Debug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Delayed insert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Drop
              DB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Execute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Fetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Field List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Init DB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Kill</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Long Data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">NoAudit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Ping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Processlist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Quit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Register Slave</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Reset
              stmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Set option</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Shutdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Sleep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Statistics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Table
              Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              除了</font></font><code class="literal">"Audit"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和以外
               </font></font><code class="literal">"NoAudit"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这些值与</font><font style="vertical-align: inherit;">头文件中</font><font style="vertical-align: inherit;">
              列出</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">命令值
               </font><font style="vertical-align: inherit;">相对应</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，</font><font style="vertical-align: inherit;">与
               </font><font style="vertical-align: inherit;">对应于
               </font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">分别。
            </font></font><code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><code class="filename">my_command.h</code><font style="vertical-align: inherit;"></font><code class="literal">"Create DB"</code><font style="vertical-align: inherit;"></font><code class="literal">"Change user"</code><font style="vertical-align: inherit;"></font><code class="literal">COM_CREATE_DB</code><font style="vertical-align: inherit;"></font><code class="literal">COM_CHANGE_USER</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <code class="literal">RECORD_ID</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计记录的唯一标识符。</font><font style="vertical-align: inherit;">该值由格式中的序列号和时间戳组成
               </font></font><code class="literal"><em class="replaceable"><code>SEQ_TIMESTAMP</code></em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当审计日志插件打开审计日志文件时，它会将序列号初始化为审计日志文件的大小，然后将记录的每个记录的序列增加1。</font><font style="vertical-align: inherit;">时间戳是</font><font style="vertical-align: inherit;">
              格式</font><font style="vertical-align: inherit;">的UTC值，
               </font><font style="vertical-align: inherit;">指示审计日​​志插件打开文件的日期和时间。
            </font></font><code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
              </font></font><code class="literal">RECORD_ID="12_2017-10-16T14:25:00"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">TIMESTAMP</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表</font><font style="vertical-align: inherit;">格式</font><font style="vertical-align: inherit;">的UTC值的字符串，
               </font><font style="vertical-align: inherit;">指示生成审计事件的日期和时间。</font><font style="vertical-align: inherit;">例如，与从客户端接收的SQL语句的执行相对应的事件</font><font style="vertical-align: inherit;">在语句结束后发生，而不是在收到语句时发生。
            </font></font><code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em>
              UTC</code><font style="vertical-align: inherit;"></font><code class="literal">TIMESTAMP</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">TIMESTAMP="2017-10-16T14:25:32
              UTC"</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下属性在</font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素中</font><font style="vertical-align: inherit;">是可选的
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们中的很多只会出现在具有特定</font></font><code class="literal">NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">值的元素上
           </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">COMMAND_CLASS</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个字符串，表示所执行的操作的类型。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">COMMAND_CLASS="drop_table"</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些值对应于
               </font><font style="vertical-align: inherit;">
              命令计数器; </font><font style="vertical-align: inherit;">例如，分别
               </font><font style="vertical-align: inherit;">是
               </font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">for </font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">
              语句。</font><font style="vertical-align: inherit;">以下语句显示可能的名称：
            </font></font><code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>xxx</code></em><font style="vertical-align: inherit;"></font><code class="literal">drop_table</code><font style="vertical-align: inherit;"></font><code class="literal">select</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP
              TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT REPLACE（EVENT_NAME，'statement / sql /'，''）AS名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM performance_schema.events_statements_summary_global_by_event_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE EVENT_NAME LIKE'statement / sql /％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ORDER BY名称;</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">CONNECTION_ID</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示客户端连接标识符的无符号整数。</font><font style="vertical-align: inherit;">这</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与会话中函数</font><font style="vertical-align: inherit;">返回的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">CONNECTION_ID="127"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">CONNECTION_TYPE</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与服务器的连接的安全状态。</font><font style="vertical-align: inherit;">允许的值为</font></font><code class="literal">TCP/IP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（建立TCP / IP连接而不加密），
               </font></font><code class="literal">SSL/TLS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（使用加密建立的TCP / IP连接），</font></font><code class="literal">Socket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Unix套接字文件连接），</font></font><code class="literal">Named Pipe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Windows命名管道连接）和</font></font><code class="literal">Shared
              Memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Windows共享内存连接）。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">CONNECTION_TYPE="SSL/TLS"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">DB</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表默认数据库名称的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">DB="test"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">HOST</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表客户端主机名的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">HOST="localhost"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">IP</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表客户端IP地址的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">IP="127.0.0.1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">MYSQL_VERSION</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表MySQL服务器版本的字符串。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_version"><code class="literal">VERSION()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数或
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_version"><code class="literal">version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">MYSQL_VERSION="5.7.21-log"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">OS_LOGIN</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示认证过程中使用的外部用户名的字符串，由用于认证客户端的插件设置。</font><font style="vertical-align: inherit;">使用本地（内置）MySQL身份验证，或者如果插件未设置值，则此属性为空。</font><font style="vertical-align: inherit;">该值与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">OS_LOGIN="jeffrey"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">OS_VERSION</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示构建或运行服务器的操作系统的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">OS_VERSION="x86_64-Linux"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">PRIV_USER</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示服务器认证客户端的用户的字符串。</font><font style="vertical-align: inherit;">这是服务器用于特权检查的用户名，它可能与该</font></font><code class="literal">USER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">不同</font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">PRIV_USER="jeffrey"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">PROXY_USER</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表代理用户的字符串（请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果用户代理不生效，则该值为空。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">PROXY_USER="developer"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">SERVER_ID</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示服务器标识的无符号整数。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">SERVER_ID="1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">SQLTEXT</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表SQL语句文本的字符串。</font><font style="vertical-align: inherit;">该值可以是空的。</font><font style="vertical-align: inherit;">长值可能会被截断。</font><font style="vertical-align: inherit;">该字符串与审计日志文件本身一样，是使用UTF-8编写的（每个字符最多4个字节），因此该值可能是转换的结果。</font><font style="vertical-align: inherit;">例如，原始语句可能已经作为SJIS字符串从客户端收到。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">SQLTEXT="DELETE FROM t1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STARTUP_OPTIONS</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个字符串，代表在启动MySQL服务器时在命令行或选项文件中给出的选项。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">STARTUP_OPTIONS="--port=3306
              --log-output=FILE"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STATUS</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示命令状态的无符号整数：成功时为0，如果发生错误则为非零。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-errno" title="27.8.7.14 mysql_errno（）"><code class="literal">mysql_errno()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C API函数</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅说明以
               </font></font><code class="literal">STATUS_CODE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取有关它与不同之处的信息</font></font><code class="literal">STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志不包含SQLSTATE值或错误消息。</font><font style="vertical-align: inherit;">要查看错误代码，SQLSTATE值和消息之间的关联，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#error-messages-server" title="B.3服务器错误代码和消息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.3节“服务器错误代码和消息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              警告没有被记录。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">STATUS="1051"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STATUS_CODE</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示命令状态的无符号整数：0表示成功，1表示发生错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">STATUS_CODE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不同于
               </font></font><code class="literal">STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值：
               </font></font><code class="literal">STATUS_CODE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为错误，这是与EZ_collector消费者对审计阀门兼容0表示成功和1。</font></font><code class="literal">STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-errno" title="27.8.7.14 mysql_errno（）"><code class="literal">mysql_errno()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C API函数</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这对于成功是0，对于错误是非零，因此对于错误不一定是1。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">STATUS_CODE="0"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">USER</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示客户端发送的用户名的字符串。</font><font style="vertical-align: inherit;">这可能与</font></font><code class="literal">PRIV_USER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              价值</font><font style="vertical-align: inherit;">不同</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">VERSION</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示审计日志文件格式版本的无符号整数。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例： </font></font><code class="literal">VERSION="1"</code>
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-new-style-xml-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新式XML审计日志文件格式</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这是一个采用新式XML格式（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=NEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的示例日志文件，</font><font style="vertical-align: inherit;">为了便于阅读，稍作重新格式化：
        </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;？xml version =“1.0”encoding =“utf-8”？&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;AUDIT&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;TIMESTAMP&gt; 2017-10-16T14：06：33 UTC &lt;/ TIMESTAMP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;RECORD_ID&gt; 1_2017-10-16T14：06：33 &lt;/ RECORD_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;NAME&gt;审核&lt;/ NAME&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;SERVER_ID&gt; 1 &lt;/ SERVER_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;VERSION&gt; 1 &lt;/ VERSION&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STARTUP_OPTIONS&gt;的/ usr /本地/ MySQL的/斌/ mysqld的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    --socket =的/ usr /本地/ MySQL的/的mysql.sock</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    --port = 3306 &lt;/ STARTUP_OPTIONS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;OS_VERSION&gt; i686的Linux的&lt;/ OS_VERSION&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;MYSQL_VERSION&gt; 21年5月7日日志&lt;/ MYSQL_VERSION&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;/ AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;TIMESTAMP&gt; 2017-10-16T14：09：38 UTC &lt;/ TIMESTAMP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;RECORD_ID&gt; 2_2017-10-16T14：06：33 &lt;/ RECORD_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;名称&gt;连接&lt;/ NAME&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;CONNECTION_ID&gt; 5 &lt;/ CONNECTION_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STATUS&gt; 0 &lt;/ STATUS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STATUS_CODE&gt; 0 &lt;/ STATUS_CODE&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;USER&gt;根&lt;/ USER&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;OS_LOGIN /&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;HOST&gt;本地主机&lt;/ HOST&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;IP&gt; 127.0.0.1 &lt;/ IP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;COMMAND_CLASS&gt;连接&lt;/ COMMAND_CLASS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;CONNECTION_TYPE&gt; SSL / TLS &lt;/ CONNECTION_TYPE&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;PRIV_USER&gt;根&lt;/ PRIV_USER&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;PROXY_USER /&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;DB&gt;测试&lt;/ DB&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;/ AUDIT_RECORD&gt;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;TIMESTAMP&gt; 2017-10-16T14：09：38 UTC &lt;/ TIMESTAMP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;RECORD_ID&gt; 6_2017-10-16T14：06：33 &lt;/ RECORD_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;NAME&gt;查询&lt;/ NAME&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;CONNECTION_ID&gt; 5 &lt;/ CONNECTION_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STATUS&gt; 0 &lt;/ STATUS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STATUS_CODE&gt; 0 &lt;/ STATUS_CODE&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;USER&gt; root [root] @ localhost [127.0.0.1] &lt;/ USER&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;OS_LOGIN /&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;HOST&gt;本地主机&lt;/ HOST&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;IP&gt; 127.0.0.1 &lt;/ IP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;COMMAND_CLASS&gt; drop_table &lt;/ COMMAND_CLASS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;SQLTEXT&gt; DROP TABLE IF EXISTS t &lt;/ SQLTEXT&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;/ AUDIT_RECORD&gt;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;TIMESTAMP&gt; 2017-10-16T14：09：39 UTC &lt;/ TIMESTAMP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;RECORD_ID&gt; 8_2017-10-16T14：06：33 &lt;/ RECORD_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;NAME&gt;退出&lt;/ NAME&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;CONNECTION_ID&gt; 5 &lt;/ CONNECTION_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STATUS&gt; 0 &lt;/ STATUS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STATUS_CODE&gt; 0 &lt;/ STATUS_CODE&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;USER&gt;根&lt;/ USER&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;OS_LOGIN /&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;HOST&gt;本地主机&lt;/ HOST&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;IP&gt; 127.0.0.1 &lt;/ IP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;COMMAND_CLASS&gt;连接&lt;/ COMMAND_CLASS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;CONNECTION_TYPE&gt; SSL / TLS &lt;/ CONNECTION_TYPE&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;/ AUDIT_RECORD&gt;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;TIMESTAMP&gt; 2017-10-16T14：09：43 UTC &lt;/ TIMESTAMP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;RECORD_ID&gt; 11_2017-10-16T14：06：33 &lt;/ RECORD_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;NAME&gt;退出&lt;/ NAME&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;CONNECTION_ID&gt; 6 &lt;/ CONNECTION_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STATUS&gt; 0 &lt;/ STATUS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;STATUS_CODE&gt; 0 &lt;/ STATUS_CODE&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;USER&gt;根&lt;/ USER&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;OS_LOGIN /&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;HOST&gt;本地主机&lt;/ HOST&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;IP&gt; 127.0.0.1 &lt;/ IP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;COMMAND_CLASS&gt;连接&lt;/ COMMAND_CLASS&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;CONNECTION_TYPE&gt; SSL / TLS &lt;/ CONNECTION_TYPE&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;/ AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;TIMESTAMP&gt; 2017-10-16T14：09：45 UTC &lt;/ TIMESTAMP&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;RECORD_ID&gt; 12_2017-10-16T14：06：33 &lt;/ RECORD_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;NAME&gt; NOAUDIT &lt;/ NAME&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;SERVER_ID&gt; 1 &lt;/ SERVER_ID&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;/ AUDIT_RECORD&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;/ AUDIT&gt;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志文件使用UTF-8编写为XML（每个字符最多4个字节）。</font><font style="vertical-align: inherit;">根元素是
           </font></font><code class="literal">&lt;AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">根元素包含
           </font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素，每个元素提供有关审核事件的信息。</font><font style="vertical-align: inherit;">当审计日志插件开始编写新的日志文件时，它会写入XML声明并打开</font></font><code class="literal">&lt;AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          根元素标记。</font><font style="vertical-align: inherit;">当插件关闭日志文件时，它会写入结束</font></font><code class="literal">&lt;/AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根元素标记。</font><font style="vertical-align: inherit;">文件打开时结束标记不存在。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          元素内的</font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          元素具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一些元素出现在每个
               </font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素中。</font><font style="vertical-align: inherit;">其他是可选的，可能会根据审计记录类型显示。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不保证</font><font style="vertical-align: inherit;">
              元素内的</font><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">顺序
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              元素值不是固定的长度。</font><font style="vertical-align: inherit;">长的值可能会被截断，如后面给出的元素描述中所示。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的</font></font><code class="literal">&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">&amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              字符被编码为</font></font><code class="literal">&amp;lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">&amp;gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">&amp;quot;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><code class="literal">&amp;amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，分别。</font><font style="vertical-align: inherit;">NUL字节（U + 00）被编码为</font></font><code class="literal">?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              作为XML字符无效的字符使用数字字符引用进行编码。</font><font style="vertical-align: inherit;">有效的XML字符是：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃x9 | </font><font style="vertical-align: inherit;">#xA | </font><font style="vertical-align: inherit;">#xD | </font><font style="vertical-align: inherit;">[＃x20-＃xD7FF] | </font><font style="vertical-align: inherit;">[＃xE000-＃xFFFD] | </font><font style="vertical-align: inherit;">[＃x10000-＃x10FFFF]
</font></font></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下元素在每个元素中都是必需的
           </font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">&lt;NAME&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示生成审计事件的指令类型的字符串，例如服务器从客户端接收的命令。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;NAME&gt;查询&lt;/ NAME&gt;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一些常见</font></font><code class="literal">&lt;NAME&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计开始审计时，可能是服务器启动时间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
连接当客户端连接时，也称为登录</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询SQL语句（直接执行）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
准备SQL语句的准备; </font><font style="vertical-align: inherit;">通常后面是Execute</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
执行SQL语句的执行; </font><font style="vertical-align: inherit;">通常在Prepare后面</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关机服务器关机</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
退出客户端断开连接时</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NoAudit Auditing已关闭</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可能的值是</font></font><code class="literal">Audit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Binlog Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Change
              user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Close stmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Connect Out</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Create DB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Daemon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Debug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Delayed insert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Drop
              DB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Execute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Fetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Field List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Init DB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Kill</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Long Data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">NoAudit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Ping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Processlist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Quit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Register Slave</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Reset
              stmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Set option</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Shutdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Sleep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Statistics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Table
              Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              除了</font></font><code class="literal">Audit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和以外
               </font></font><code class="literal">NoAudit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这些值与</font><font style="vertical-align: inherit;">头文件中</font><font style="vertical-align: inherit;">
              列出</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">命令值
               </font><font style="vertical-align: inherit;">相对应
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，</font><font style="vertical-align: inherit;">与</font><font style="vertical-align: inherit;">对应于
               </font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">分别。
            </font></font><code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><code class="filename">my_command.h</code><font style="vertical-align: inherit;"></font><code class="literal">Create DB</code><font style="vertical-align: inherit;"></font><code class="literal">Change
              user</code><font style="vertical-align: inherit;"></font><code class="literal">COM_CREATE_DB</code><font style="vertical-align: inherit;"></font><code class="literal">COM_CHANGE_USER</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <code class="literal">&lt;RECORD_ID&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计记录的唯一标识符。</font><font style="vertical-align: inherit;">该值由格式中的序列号和时间戳组成
               </font></font><code class="literal"><em class="replaceable"><code>SEQ_TIMESTAMP</code></em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当审计日志插件打开审计日志文件时，它会将序列号初始化为审计日志文件的大小，然后将记录的每个记录的序列增加1。</font><font style="vertical-align: inherit;">时间戳是</font><font style="vertical-align: inherit;">
              格式</font><font style="vertical-align: inherit;">的UTC值，
               </font><font style="vertical-align: inherit;">指示审计日​​志插件打开文件的日期和时间。
            </font></font><code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;RECORD_ID&gt; 12_2017-10-16T14：06：33 &lt;/ RECORD_ID&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;TIMESTAMP&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表</font><font style="vertical-align: inherit;">格式</font><font style="vertical-align: inherit;">的UTC值的字符串，
               </font><font style="vertical-align: inherit;">指示生成审计事件的日期和时间。</font><font style="vertical-align: inherit;">例如，与从客户端接收的SQL语句的执行相对应的事件</font><font style="vertical-align: inherit;">
              在语句结束后发生，而不是在收到语句时发生。
            </font></font><code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em>
              UTC</code><font style="vertical-align: inherit;"></font><code class="literal">&lt;TIMESTAMP&gt;</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;TIMESTAMP&gt; 2017-10-16T14：09：45 UTC &lt;/ TIMESTAMP&gt;
</font></font></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          元素中以下元素是可选的
           </font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们中的许多只会出现在特定的</font></font><code class="literal">&lt;NAME&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          元素值中。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">&lt;COMMAND_CLASS&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个字符串，表示所执行的操作的类型。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;COMMAND_CLASS&gt; drop_table &lt;/ COMMAND_CLASS&gt;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些值对应于
               </font><font style="vertical-align: inherit;">
              命令计数器; </font><font style="vertical-align: inherit;">例如，分别
               </font><font style="vertical-align: inherit;">是
               </font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">for </font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">
              语句。</font><font style="vertical-align: inherit;">以下语句显示可能的名称：
            </font></font><code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>xxx</code></em><font style="vertical-align: inherit;"></font><code class="literal">drop_table</code><font style="vertical-align: inherit;"></font><code class="literal">select</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP
              TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT REPLACE（EVENT_NAME，'statement / sql /'，''）AS名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM performance_schema.events_statements_summary_global_by_event_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE EVENT_NAME LIKE'statement / sql /％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ORDER BY名称;</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;CONNECTION_ID&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示客户端连接标识符的无符号整数。</font><font style="vertical-align: inherit;">这</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与会话中函数</font><font style="vertical-align: inherit;">返回的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;CONNECTION_ID&gt; 127 &lt;/ CONNECTION_ID&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;CONNECTION_TYPE&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与服务器的连接的安全状态。</font><font style="vertical-align: inherit;">允许的值为</font></font><code class="literal">TCP/IP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（建立TCP / IP连接而不加密），
               </font></font><code class="literal">SSL/TLS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（使用加密建立的TCP / IP连接），</font></font><code class="literal">Socket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Unix套接字文件连接），</font></font><code class="literal">Named Pipe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Windows命名管道连接）和</font></font><code class="literal">Shared
              Memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Windows共享内存连接）。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;CONNECTION_TYPE&gt; SSL / TLS &lt;/ CONNECTION_TYPE&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;DB&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表默认数据库名称的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;DB&gt;测试&lt;/ DB&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;HOST&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表客户端主机名的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;HOST&gt;本地主机&lt;/ HOST&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;IP&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表客户端IP地址的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;IP&gt; 127.0.0.1 &lt;/ IP&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;MYSQL_VERSION&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表MySQL服务器版本的字符串。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_version"><code class="literal">VERSION()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数或
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_version"><code class="literal">version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;MYSQL_VERSION&gt; 21年5月7日日志&lt;/ MYSQL_VERSION&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;OS_LOGIN&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示认证过程中使用的外部用户名的字符串，由用于认证客户端的插件设置。</font><font style="vertical-align: inherit;">使用本地（内置）MySQL身份验证，或者如果插件未设置该值，则此元素为空。</font><font style="vertical-align: inherit;">该值与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;OS_LOGIN&gt;杰弗里&lt;/ OS_LOGIN&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;OS_VERSION&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示构建或运行服务器的操作系统的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;OS_VERSION&gt; x86_64的Linux的&lt;/ OS_VERSION&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;PRIV_USER&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示服务器认证客户端的用户的字符串。</font><font style="vertical-align: inherit;">这是服务器用于特权检查的用户名，可能与该</font></font><code class="literal">&lt;USER&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">不同</font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;PRIV_USER&gt;杰弗里&lt;/ PRIV_USER&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;PROXY_USER&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表代理用户的字符串（请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果用户代理不生效，则该值为空。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;PROXY_USER&gt;显影剂&lt;/ PROXY_USER&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;SERVER_ID&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示服务器标识的无符号整数。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;SERVER_ID&gt; 1 &lt;/ SERVER_ID&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;SQLTEXT&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表SQL语句文本的字符串。</font><font style="vertical-align: inherit;">该值可以是空的。</font><font style="vertical-align: inherit;">长值可能会被截断。</font><font style="vertical-align: inherit;">该字符串与审计日志文件本身一样，是使用UTF-8编写的（每个字符最多4个字节），因此该值可能是转换的结果。</font><font style="vertical-align: inherit;">例如，原始语句可能已经作为SJIS字符串从客户端收到。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;SQLTEXT&gt; DELETE FROM t1 &lt;/ SQLTEXT&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;STARTUP_OPTIONS&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个字符串，代表在启动MySQL服务器时在命令行或选项文件中给出的选项。</font><font style="vertical-align: inherit;">第一个选项是服务器可执行文件的路径。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;STARTUP_OPTIONS&gt;的/ usr /本地/ MySQL的/斌/ mysqld的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  --port = 3306 --log-output = FILE &lt;/ STARTUP_OPTIONS&gt;</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;STATUS&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示命令状态的无符号整数：成功时为0，如果发生错误则为非零。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-errno" title="27.8.7.14 mysql_errno（）"><code class="literal">mysql_errno()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C API函数</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅说明以
               </font></font><code class="literal">&lt;STATUS_CODE&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取有关它与不同之处的信息
               </font></font><code class="literal">&lt;STATUS&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志不包含SQLSTATE值或错误消息。</font><font style="vertical-align: inherit;">要查看错误代码，SQLSTATE值和消息之间的关联，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#error-messages-server" title="B.3服务器错误代码和消息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.3节“服务器错误代码和消息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              警告没有被记录。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;STATUS&gt; 1051 &lt;/ STATUS&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;STATUS_CODE&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示命令状态的无符号整数：0表示成功，1表示发生错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">STATUS_CODE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不同于
               </font></font><code class="literal">STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值：
               </font></font><code class="literal">STATUS_CODE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为错误，这是与EZ_collector消费者对审计阀门兼容0表示成功和1。</font></font><code class="literal">STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-errno" title="27.8.7.14 mysql_errno（）"><code class="literal">mysql_errno()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C API函数</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这对于成功是0，对于错误是非零，因此对于错误不一定是1。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;STATUS_CODE&gt; 0 &lt;/ STATUS_CODE&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;USER&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示客户端发送的用户名的字符串。</font><font style="vertical-align: inherit;">这可能与</font></font><code class="literal">&lt;PRIV_USER&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值</font><font style="vertical-align: inherit;">不同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;USER&gt; root [root] @ localhost [127.0.0.1] &lt;/ USER&gt;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">&lt;VERSION&gt;</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示审计日志文件格式版本的无符号整数。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="xml" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;VERSION&gt; 1 &lt;/ VERSION&gt;
</font></font></pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-json-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON审计日志文件格式</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于JSON格式的审计日志记录（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），日志文件内容形成一个</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          数组，每个数组元素代表一个审计事件作为</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键/值对</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">散列。</font><font style="vertical-align: inherit;">完整事件记录的例子在本节后面出现。</font><font style="vertical-align: inherit;">以下是部分事件的摘录：
        </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “timestamp”：“2018-01-15 13:50:01”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “id”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “班级”：“审计”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “事件”：“启动”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “timestamp”：“2018-01-15 15:02:32”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “id”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “事件”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “timestamp”：“2018-01-15 17:37:26”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “id”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：“table_access”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “事件”：“插入”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
]</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志文件使用UTF-8编写（每个字符最多4个字节）。</font><font style="vertical-align: inherit;">当审计日志插件开始写入新的日志文件时，它会写入开始</font></font><code class="literal">[</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组标记。</font><font style="vertical-align: inherit;">当插件关闭日志文件时，它会写入关闭
           </font></font><code class="literal">]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组标记。</font><font style="vertical-align: inherit;">文件打开时，关闭标记不存在。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计记录中的项目具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有些项目出现在每个审计记录中。</font><font style="vertical-align: inherit;">其他是可选的，并且可能出现取决于审计记录类型。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              无法保证审计记录中项目的顺序。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              项目值不是固定的长度。</font><font style="vertical-align: inherit;">长的值可能会被截断，如后面给出的项目描述中所示。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的</font></font><code class="literal">"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              字符被编码为</font></font><code class="literal">\"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
               </font></font><code class="literal">\\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下示例显示了不同事件类型（如</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目所示）</font><font style="vertical-align: inherit;">的JSON对象格式，为了
           </font><font style="vertical-align: inherit;">便于阅读，略微重新格式化：
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计启动事件：
        </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 14:21:56”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “id”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “班级”：“审计”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “事件”：“启动”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “connection_id”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “startup_data”：{“server_id”：1，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    “os_version”：“i686-Linux”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    “mysql_version”：“5.7.21-log”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    “args”：[“/ usr / local / mysql / bin / mysqld”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             “--loose审计日志格式= JSON”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             “--log误差= LOG.ERR”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             “--pid文件= mysqld.pid”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             “--port = 3306”]}}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当审计日志插件开始作为服务器启动的结果（而不是在运行时被启用），
           </font></font><code class="literal">connection_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被设置为0，并且
           </font></font><code class="literal">account</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="literal">login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不存在。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审核关机事件：
        </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 14:28:20”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “id”：3，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “班级”：“审计”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “事件”：“关机”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “connection_id”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “shutdown_data”：{“server_id”：1}}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当审计日志插件被卸载为服务器关闭的结果（而不是在运行时被禁用），
           </font></font><code class="literal">connection_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被设置为0，并且
           </font></font><code class="literal">account</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="literal">login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不存在。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          连接或更改用户事件：
        </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 14:23:18”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “id”：1，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “class”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “事件”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “connection_id”：5，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “account”：{“user”：“root”，“host”：“localhost”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “login”：{“user”：“root”，“os”：“”，“ip”：“:: 1”，“proxy”：“”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “connection_data”：{“connection_type”：“ssl”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       “状态”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       “db”：“test”}}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          断开事件：
        </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 14:24:45”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “id”：3，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “class”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “事件”：“断开”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “connection_id”：5，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “account”：{“user”：“root”，“host”：“localhost”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “login”：{“user”：“root”，“os”：“”，“ip”：“:: 1”，“proxy”：“”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “connection_data”：{“connection_type”：“ssl”}}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询事件：
        </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 14:23:35”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “id”：2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “班级”：“一般”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “事件”：“状态”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “connection_id”：5，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “account”：{“user”：“root”，“host”：“localhost”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “login”：{“user”：“root”，“os”：“”，“ip”：“:: 1”，“proxy”：“”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “general_data”：{“command”：“Query”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    “sql_command”：“show_variables”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    “查询”：“SHOW VARIABLES”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    “状态”：0}}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表访问事件（读取，删除，插入，更新）：
        </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 14:23:41”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “id”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “class”：“table_access”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “事件”：“插入”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “connection_id”：5，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “account”：{“user”：“root”，“host”：“localhost”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “login”：{“user”：“root”，“os”：“”，“ip”：“127.0.0.1”，“proxy”：“”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “table_access_data”：{“db”：“test”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                         “table”：“t1”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                         “查询”：“INSERT INTO t1（i）VALUES（1），（2），（3）”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                         “sql_command”：“insert”}}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下列表中的项目出现在JSON格式审计记录的顶层：每个项目值都是标量或</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列。</font><font style="vertical-align: inherit;">对于具有散列值的项目，说明仅列出该散列内的项目名称。</font><font style="vertical-align: inherit;">有关二级散列项目的更完整说明，请参阅本节后面的内容。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">account</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与该事件关联的MySQL帐户。</font><font style="vertical-align: inherit;">该值是一个包含这些项目的哈希值，等同</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于该部分</font><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">：</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“account”：{“user”：“root”，“host”：“localhost”}
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">class</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示事件类的字符串。</font><font style="vertical-align: inherit;">该类定义了事件的类型，并与</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定事件子类</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">项目</font><font style="vertical-align: inherit;">一起使用
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“class”：“连接”
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              下表显示了允许的组合
               </font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              值。
</font></font></p>
<div class="table">
<a name="audit-log-class-event-combinations"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.23审计日志类和事件组合</font></font></b></p>
<div class="table-contents">
<table summary="Permitted combinations of audit log class and event values."><colgroup><col width="30%"><col width="40%"></colgroup><thead><tr>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类价值</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许的事件值</font></font></th>
                </tr></thead><tbody><tr>
                  <th scope="row" align="left"><code class="literal">audit</code></th>
                  <td><code class="literal">startup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， </font></font><code class="literal">shutdown</code></td>
                </tr><tr>
                  <th scope="row" align="left"><code class="literal">connection</code></th>
                  <td><code class="literal">connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">change_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                    </font></font><code class="literal">disconnect</code></td>
                </tr><tr>
                  <th scope="row" align="left"><code class="literal">general</code></th>
                  <td><code class="literal">status</code></td>
                </tr><tr>
                  <th scope="row" align="left"><code class="literal">table_access_data</code></th>
                  <td><code class="literal">read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                     </font></font><code class="literal">insert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">update</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p>
              <code class="literal">connection_data</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关客户端连接的信息。</font><font style="vertical-align: inherit;">的值是包含这些项目的哈希：
               </font></font><code class="literal">connection_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该项目仅出现在</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为的</font><font style="vertical-align: inherit;">审计记录
               </font><font style="vertical-align: inherit;">中
               </font></font><code class="literal">connection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“connection_data”：{“connection_type”：“ssl”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     “状态”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     “db”：“test”}</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">connection_id</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示客户端连接标识符的无符号整数。</font><font style="vertical-align: inherit;">这</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与会话中函数</font><font style="vertical-align: inherit;">返回的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“connection_id”：5
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">event</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示事件类的子类的字符串。</font><font style="vertical-align: inherit;">子类与</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定事件类</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">项目</font><font style="vertical-align: inherit;">一起定义</font><font style="vertical-align: inherit;">了事件的类型。</font><font style="vertical-align: inherit;">有关更多信息，请参阅
               </font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目说明。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“事件”：“连接”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">general_data</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关于执行的语句或命令的信息。</font><font style="vertical-align: inherit;">的值是包含这些项目的哈希：
               </font></font><code class="literal">command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">sql_command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该项目仅出现在</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为的</font><font style="vertical-align: inherit;">审计记录</font><font style="vertical-align: inherit;">中
               </font></font><code class="literal">general</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“general_data”：{“command”：“Query”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  “sql_command”：“show_variables”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  “查询”：“SHOW VARIABLES”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  “状态”：0}</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">id</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示事件ID的无符号整数。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“id”：2
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于具有相同</font></font><code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">审计记录
               </font><font style="vertical-align: inherit;">，其
               </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值会区分它们并形成一个序列。</font><font style="vertical-align: inherit;">在审计日志中，
               </font></font><code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对是唯一的。</font><font style="vertical-align: inherit;">这些对是用于标识日志中事件位置的书签。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">login</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              指示客户端如何连接到服务器的信息。</font><font style="vertical-align: inherit;">的值是包含这些项目的哈希：
               </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">os</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“login”：{“user”：“root”，“os”：“”，“ip”：“:: 1”，“proxy”：“”}
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">shutdown_data</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关审计日志插件终止的信息。</font><font style="vertical-align: inherit;">的值是包含这些项目的哈希：
               </font></font><code class="literal">server_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅用于与审计记录发生此产品</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
               </font></font><code class="literal">audit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">shutdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“shutdown_data”：{“server_id”：1}
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">startup_data</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关审计日志插件初始化的信息。</font><font style="vertical-align: inherit;">的值是包含这些项目的哈希：
               </font></font><code class="literal">server_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">os_version</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">mysql_version</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">args</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此产品仅适用于审计记录出现
               </font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              值</font></font><code class="literal">audit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">startup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“startup_data”：{“server_id”：1，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  “os_version”：“i686-Linux”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  “mysql_version”：“5.7.21-log”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  “args”：[“/ usr / local / mysql / bin / mysqld”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           “--loose审计日志格式= JSON”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           “--log误差= LOG.ERR”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           “--pid文件= mysqld.pid”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           “--port = 3306”]}</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">table_access_data</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关访问表格的信息。</font><font style="vertical-align: inherit;">该值是包含这些项目的哈希：</font></font><code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">sql_command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，此产品仅适用于一个审计记录发生</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的价值
               </font></font><code class="literal">table_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“table_access_data”：{“db”：“test”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       “table”：“t1”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       “查询”：“INSERT INTO t1（i）VALUES（1），（2），（3）”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       “sql_command”：“插入”}</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">timestamp</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表</font></font><em class="replaceable"><code>YYYY-MM-DD hh:mm:ss</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式</font><font style="vertical-align: inherit;">的UTC值的字符串，
               </font><font style="vertical-align: inherit;">指示生成审计事件的日期和时间。</font><font style="vertical-align: inherit;">例如，与从客户端接收的SQL语句的执行相对应的事件
               </font></font><code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在语句结束后发生，而不是在收到语句时发生。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“timestamp”：“2018-01-15 13:50:01”
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于具有相同</font></font><code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">审计记录
               </font><font style="vertical-align: inherit;">，其
               </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值会区分它们并形成一个序列。</font><font style="vertical-align: inherit;">在审计日志中，
               </font></font><code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对是唯一的。</font><font style="vertical-align: inherit;">这些对是用于标识日志中事件位置的书签。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些项目显示在与JSON格式审计记录的顶级项目关联的哈希值中：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">args</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在MySQL服务器启动时在命令行或选项文件中给出的一组选项。</font><font style="vertical-align: inherit;">第一个选项是服务器可执行文件的路径。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“args”：[“/ usr / local / mysql / bin / mysqld”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         “--loose审计日志格式= JSON”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         “--log误差= LOG.ERR”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         “--pid文件= mysqld.pid”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         “--port = 3306”]</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">command</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示生成审计事件的指令类型的字符串，例如服务器从客户端接收的命令。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“命令”：“查询”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">connection_type</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与服务器的连接的安全状态。</font><font style="vertical-align: inherit;">允许的值为</font></font><code class="literal">tcp/ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（建立TCP / IP连接而不加密），
               </font></font><code class="literal">ssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（使用加密建立的TCP / IP连接），</font></font><code class="literal">socket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Unix套接字文件连接），</font></font><code class="literal">named_pipe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Windows命名管道连接）和</font></font><code class="literal">shared_memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （Windows共享内存连接）。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“connection_type”：“tcp / tcp”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">db</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表数据库名称的字符串。</font><font style="vertical-align: inherit;">因为
               </font></font><code class="literal">connection_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是默认的数据库。</font><font style="vertical-align: inherit;">因为</font></font><code class="literal">table_access_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是表格数据库。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“db”：“test”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">host</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表客户端主机名的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“主机”：“本地主机”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">ip</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表客户端IP地址的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ip”：“:: 1”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">mysql_version</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表MySQL服务器版本的字符串。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_version"><code class="literal">VERSION()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数或
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_version"><code class="literal">version</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“mysql_version”：“5.7.21-log”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">os</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示认证过程中使用的外部用户名的字符串，由用于认证客户端的插件设置。</font><font style="vertical-align: inherit;">使用本地（内置）MySQL身份验证，或者如果插件未设置值，则此属性为空。</font><font style="vertical-align: inherit;">该值与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“os”：“jeffrey”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">os_version</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示构建或运行服务器的操作系统的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“os_version”：“i686-Linux”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">proxy</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表代理用户的字符串（请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#proxy-users" title="6.3.10代理用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3.10节“代理用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果用户代理不生效，则该值为空。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“代理”：“开发者”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">query</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表SQL语句文本的字符串。</font><font style="vertical-align: inherit;">该值可以是空的。</font><font style="vertical-align: inherit;">长值可能会被截断。</font><font style="vertical-align: inherit;">该字符串与审计日志文件本身一样，是使用UTF-8编写的（每个字符最多4个字节），因此该值可能是转换的结果。</font><font style="vertical-align: inherit;">例如，原始语句可能已经作为SJIS字符串从客户端收到。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“query”：“DELETE FROM t1”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">server_id</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示服务器标识的无符号整数。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“server_id”：1
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">sql_command</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个表示SQL语句类型的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“sql_command”：“插入”
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些值对应于
               </font><font style="vertical-align: inherit;">
              命令计数器; </font><font style="vertical-align: inherit;">例如，分别
               </font><font style="vertical-align: inherit;">是
               </font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">for </font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">
              语句。</font><font style="vertical-align: inherit;">以下语句显示可能的名称：
            </font></font><code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>xxx</code></em><font style="vertical-align: inherit;"></font><code class="literal">drop_table</code><font style="vertical-align: inherit;"></font><code class="literal">select</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP
              TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT REPLACE（EVENT_NAME，'statement / sql /'，''）AS名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM performance_schema.events_statements_summary_global_by_event_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE EVENT_NAME LIKE'statement / sql /％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ORDER BY名称;</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">status</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示命令状态的无符号整数：成功时为0，如果发生错误则为非零。</font><font style="vertical-align: inherit;">这与</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-errno" title="27.8.7.14 mysql_errno（）"><code class="literal">mysql_errno()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C API函数</font><font style="vertical-align: inherit;">的值相同
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志不包含SQLSTATE值或错误消息。</font><font style="vertical-align: inherit;">要查看错误代码，SQLSTATE值和消息之间的关联，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#error-messages-server" title="B.3服务器错误代码和消息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.3节“服务器错误代码和消息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              警告没有被记录。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“状态”：1051
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">table</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表表名称的字符串。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“表”：“t1”
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">user</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示用户名的字符串。</font><font style="vertical-align: inherit;">含义因所</font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              发生</font><font style="vertical-align: inherit;">的项目而异</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  在</font></font><code class="literal">account</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目内，
                   </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个字符串，表示服务器认证客户端的用户。</font><font style="vertical-align: inherit;">这是服务器用于特权检查的用户名。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  在</font></font><code class="literal">login</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目中，
                   </font></font><code class="literal">user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个表示客户端发送的用户名的字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“用户”：“根”
</font></font></pre></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-logging-control"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.5审计日志记录控制</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何控制审计日志记录的一般特性，例如审计日志插件写入事件的文件，写入事件的格式以及是否启用压缩和加密。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-name" title="审核日志文件名称"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件名称</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-format" title="审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件格式</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-compression" title="审计日志文件压缩"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件压缩</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-encryption" title="审计日志文件加密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件加密</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-uncompression-decryption" title="审计日志文件手动解压缩和解密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件手动解压缩和解密</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-strategy" title="审计日志写入策略"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志写入策略</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-space-management" title="审计日志文件空间管理和名称轮换"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件空间管理和名称轮换</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-reading" title="审计日志文件读取"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件读取</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关影响审计日志记录的用户定义函数和系统变量的更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-routines" title="6.5.5.8.2审计日志功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.2节“审计日志函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-options-variables" title="6.5.5.8.4审计日志选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.4节“审计日志选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        审计日志插件还可以根据事件发生的帐户或事件内容，控制将哪些审计事件写入审计日志文件。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering" title="6.5.5.6审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.6节“审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="audit-log-file-name"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件名称</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制审计日志文件名，请</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">默认情况下，该名称
           </font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于服务器数据目录中。</font><font style="vertical-align: inherit;">出于安全原因，审计日志文件应写入只能由MySQL服务器访问的目录，并且应该有合法理由查看日志。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从MySQL 5.7.21开始，插件将该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">解释
           </font><font style="vertical-align: inherit;">为由基本名称和可选后缀组成。</font><font style="vertical-align: inherit;">如果启用压缩或加密，则有效文件名（实际用于创建日志文件的名称）与配置的文件名不同，因为它具有其他后缀：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果启用压缩，则插件会添加后缀
               </font></font><code class="filename">.gz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果启用加密，插件会添加后缀
               </font></font><code class="filename">.enc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有效的审计日志文件名称是在为配置的文件名添加可能的压缩和加密后缀后得到的名称。</font><font style="vertical-align: inherit;">例如，如果配置的
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是
           </font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则有效文件名是以下值之一：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit.log未压缩或加密</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
audit.log.gz压缩</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
audit.log.enc加密</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
audit.log.gz.enc压缩和加密</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL 5.7.21之前，配置的和有效的日志文件名称是相同的。</font><font style="vertical-align: inherit;">例如，如果配置的
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是
           </font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，审计日志插件写入
           </font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志插件根据审计日志文件名在初始化和终止时执行某些操作：
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从MySQL 5.7.21开始：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在初始化期间，插件会检查具有审计日志文件名的文件是否已经存在，如果是，则重命名它。</font><font style="vertical-align: inherit;">（在这种情况下，插件假定在运行审计日志插件的情况下，以前的服务器调用意外退出）。插件然后写入新的空审计日志文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在终止时，插件会重命名审计日志文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              发生重命名时（无论是在插件初始化还是终止时），重命名文件的基本名称后面都会插入一个时间戳。</font><font style="vertical-align: inherit;">例如，如果文件名是</font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，插件将其重命名为一个值，如
               </font></font><code class="filename">audit.20180115T140633.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">时间戳是</font><font style="vertical-align: inherit;">
              格式中</font><font style="vertical-align: inherit;">的UTC值
               </font><font style="vertical-align: inherit;">。
</font></font><code class="literal"><em class="replaceable"><code>YYYYMMDD</code></em>T<em class="replaceable"><code>hhmmss</code></em></code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL 5.7.21之前，只有XML日志格式可用，插件执行基本的完整性检查：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在初始化期间，插件检查文件是否以</font></font><code class="literal">&lt;/AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font><font style="vertical-align: inherit;">结尾，</font><font style="vertical-align: inherit;">并在写入任何</font></font><code class="literal">&lt;AUDIT_RECORD&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">之前截断标签
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果日志文件存在但不以结尾
               </font></font><code class="literal">&lt;/AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">&lt;/AUDIT&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记不能被截断，插件认为该文件格式不正确并重命名该文件。</font><font style="vertical-align: inherit;">（如果服务器在审计日志插件运行时意外退出，则会发生这种重命名。）插件然后写入新的空审计日志文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              终止时，不会发生文件重命名。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在插件初始化时发生重命名时，重命名的文件具有</font></font><code class="filename">.corrupted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个时间戳并
               </font></font><code class="filename">.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加到结尾。</font><font style="vertical-align: inherit;">例如，如果文件名是</font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，插件将其重命名为一个值，如
               </font></font><code class="filename">audit.log.corrupted.15081807937726520.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">时间戳值与Unix时间戳相似，最后7位数字代表小数第二部分。</font><font style="vertical-align: inherit;">有关解释时间戳记的信息，请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-space-management" title="审计日志文件空间管理和名称轮换"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件空间管理和名称轮换</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件格式</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制审计日志文件格式，请</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">默认情况下，格式是
           </font></font><code class="literal">NEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（新式XML格式）。</font><font style="vertical-align: inherit;">有关每种格式的详细信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-formats" title="6.5.5.4审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.4节“审核日志文件格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你改变了
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，建议你也改变
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，将会有两套具有相同基本名称但格式不同的日志文件。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.21之前，更改值
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能导致以一种格式将日志条目写入包含不同格式条目的现有日志文件。</font><font style="vertical-align: inherit;">要避免此问题，请使用以下过程：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                停止服务器。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                请更改</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值，
                 </font><font style="vertical-align: inherit;">以便插件写入其他文件，或手动重命名当前审计日志文件。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                用新的值重新启动服务器
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">审计日志插件会创建一个新的日志文件并以选定的格式将条目写入它。
</font></font></p></li></ol>
</div>

</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-compression"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件压缩</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志文件压缩自MySQL 5.7.21开始提供。</font><font style="vertical-align: inherit;">可以为任何记录格式启用压缩。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制是否启用审核日志文件压缩，请</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_compression"><code class="literal">audit_log_compression</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器启动时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">允许的值是
           </font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不压缩;默认值）和
           </font></font><code class="literal">GZIP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（GNU Zip压缩）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果启用了压缩和加密，则在加密之前进行压缩。</font><font style="vertical-align: inherit;">要手动恢复原始文件，首先将其解密，然后解压缩。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-uncompression-decryption" title="审计日志文件手动解压缩和解密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件手动解压缩和解密</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-encryption"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件加密</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志文件加密从MySQL 5.7.21起可用。</font><font style="vertical-align: inherit;">可以为任何日志记录格式启用加密。</font><font style="vertical-align: inherit;">加密基于用户定义的密码。</font><font style="vertical-align: inherit;">要使用此功能，必须启用MySQL密钥环，因为审计日志记录将其用于密码存储。</font><font style="vertical-align: inherit;">任何钥匙圈插件都可以使用; </font><font style="vertical-align: inherit;">有关说明，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring" title="6.5.4 MySQL Keyring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4节“MySQL Keyring”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制是否启用审计日志文件加密，请</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_encryption"><code class="literal">audit_log_encryption</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器启动时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">允许的值是
           </font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不加密;默认值）和
           </font></font><code class="literal">AES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（AES-256-CBC密码加密）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要设置或获取加密密码，请使用这些用户定义的函数（UDF）：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要设置加密密码，调用
               </font></font><code class="literal">audit_log_encryption_password_set()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将密码存储在密钥环中，重命名当前日志文件，并开始用新密码加密的新日志文件。</font><font style="vertical-align: inherit;">重命名的文件的基本名称后面插入了时间戳。</font><font style="vertical-align: inherit;">例如，如果文件名是
               </font></font><code class="filename">audit.log.enc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，插件将其重命名为一个值，如
               </font></font><code class="filename">audit.20180115T140633.log.enc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">时间戳是</font><font style="vertical-align: inherit;">
              格式中</font><font style="vertical-align: inherit;">的UTC值
               </font><font style="vertical-align: inherit;">。
            </font></font><code class="literal"><em class="replaceable"><code>YYYYMMDD</code></em>T<em class="replaceable"><code>hhmmss</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              以前编写的审计日志文件不会使用新密码重新加密。</font><font style="vertical-align: inherit;">如果您需要解密这些文件，请记住以前的密码。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要获取当前加密密码，请调用
               </font></font><code class="literal">audit_log_encryption_password_get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从密钥环检索密码。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于启用审计日志加密后的第一次服务器启动，审计日志插件会自动生成初始加密密码并将其存储在密钥环中。</font><font style="vertical-align: inherit;">要发现此密码，请调用
           </font></font><code class="literal">audit_log_encryption_password_get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关审计日志加密函数的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-routines" title="6.5.5.8.2审计日志功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.2节“审计日志函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果启用了压缩和加密，则在加密之前进行压缩。</font><font style="vertical-align: inherit;">要手动恢复原始文件，首先将其解密，然后解压缩。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-uncompression-decryption" title="审计日志文件手动解压缩和解密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件手动解压缩和解密</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-uncompression-decryption"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件手动解压缩和解密</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志文件可以使用标准工具进行解压缩和解密。</font><font style="vertical-align: inherit;">这应该只对已关闭且不再使用的日志文件进行，而不适用于审计日志插件当前正在编写的日志文件。</font><font style="vertical-align: inherit;">您可以识别已关闭的日志文件，因为它们将被审计日志插件重命名为在文件名中包含时间戳。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于这个讨论，假设
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为
           </font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，关闭的审计日志文件具有以下名称之一：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log未压缩或加密</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log.gz压缩</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log.enc加密</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log.gz.enc压缩和加密
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要手动解压压缩的日志文件，请使用
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gunzip</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gzip -d</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或等效命令。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gunzip -c审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log.gz&gt;审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.LOG
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要手动解密加密的日志文件，请使用
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl enc -d -aes-256-cbc </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pass </font><font style="vertical-align: inherit;">pass：</font><font style="vertical-align: inherit;">-md sha256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log.enc -out审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.LOG
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果为审计日志记录启用压缩和加密，则会在加密之前进行压缩。</font><font style="vertical-align: inherit;">在这种情况下，文件名具有</font></font><code class="filename">.gz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="filename">.enc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后缀添加，对应于其中出现这些操作的顺序。</font><font style="vertical-align: inherit;">要手动恢复原始文件，请反向执行操作。</font><font style="vertical-align: inherit;">也就是说，首先解密文件，然后解压缩它：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl enc -d -aes-256-cbc </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pass </font><font style="vertical-align: inherit;">pass：</font><font style="vertical-align: inherit;">-md sha256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log.gz.enc -out审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log.gz</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gunzip -c审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.log.gz&gt;审计。</font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.LOG
</font></font></pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-strategy"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志写入策略</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志插件可以使用多种策略中的任何一种来进行日志写入。</font><font style="vertical-align: inherit;">无论采取何种策略，采取尽力而为的方式都是日志记录，不保证一致性。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要指定写入策略，请</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">默认情况下，策略值是
           </font></font><code class="literal">ASYNCHRONOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和插件异步记录到缓冲区，等待缓冲区是否已满。</font><font style="vertical-align: inherit;">可以</font></font><code class="literal">PERFORMANCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用文件系统缓存（</font></font><code class="literal">SEMISYNCHRONOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或者</font></font><code class="literal">sync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每次写入请求（</font></font><code class="literal">SYNCHRONOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">后</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">强制输出
           </font><font style="vertical-align: inherit;">来告诉插件不要等待（</font><font style="vertical-align: inherit;">）或同步记录</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于异步写策略，
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量是以字节为单位的缓冲区大小。</font><font style="vertical-align: inherit;">在服务器启动时设置此变量以更改缓冲区大小。</font><font style="vertical-align: inherit;">插件使用一个单独的缓冲区，它在初始化时分配，在终止时分配。</font><font style="vertical-align: inherit;">插件不会为非同步写入策略分配此缓冲区。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          异步记录策略具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对服务器性能和可伸缩性的影响最小。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              阻塞在最短的时间内生成审计事件的线程; </font><font style="vertical-align: inherit;">即分配缓冲区和时间以将事件复制到缓冲区的时间。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              输出进入缓冲区。</font><font style="vertical-align: inherit;">一个单独的线程处理从缓冲区写入日志文件的操作。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用异步日志记录时，如果在写入文件期间发生问题或者插件未完全关闭（例如，如果服务器主机意外退出），则日志文件的完整性可能会受到影响。</font><font style="vertical-align: inherit;">要降低此风险，请设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为使用同步日志记录。
        </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">PERFORMANCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略的</font><font style="vertical-align: inherit;">
          一个缺点</font><font style="vertical-align: inherit;">是，当缓冲区已满时它会丢弃事件。</font><font style="vertical-align: inherit;">对于负载过重的服务器，审核日志可能缺少事件。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-space-management"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件空间管理和名称轮换</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志文件可能会变得非常大，并占用大量的磁盘空间。</font><font style="vertical-align: inherit;">为了能够通过其日志文件中使用的空间管理，审计日志插件提供
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量，它们控制审计日志文件旋转和冲洗。</font><font style="vertical-align: inherit;">旋转可以手动完成，也可以根据文件大小自动完成。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动审计日志文件轮换。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认情况下，
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            除了手动执行的操作之外，没有日志轮转。</font><font style="vertical-align: inherit;">在这种情况下，审计日志插件关闭并在</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值从禁用变为启用</font><font style="vertical-align: inherit;">时重新打开日志文件
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">日志文件重命名必须在服务器外部完成。</font><font style="vertical-align: inherit;">假设日志文件名</font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并要保持三个最近的日志文件，通过名称循环</font></font><code class="filename">audit.log.1.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过
             </font></font><code class="filename">audit.log.3.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在Unix上，像这样手动执行旋转操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从命令行重命名当前日志文件：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mv audit.log.2.xml audit.log.3.xml</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mv audit.log.1.xml audit.log.2.xml</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mv audit.log audit.log.1.xml</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此时，插件仍在写入当前日志文件，该文件已被重命名为
               </font></font><code class="filename">audit.log.1.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              连接到服务器并刷新日志文件，以便插件关闭它并重新打开一个新</font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              文件：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL audit_log_flush = ON;
</font></font></pre></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于JSON格式的日志记录，由于审计日志插件不再可以确定它们是日志文件序列的一部分（请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-reading" title="审计日志文件读取"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件读取</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">，所以手动重命名审计日志文件使它们不能用于日志读取功能
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">考虑设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            大于0以代替使用基于大小的旋转。
</font></font></p>
</div>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动基于大小的审计日志文件轮换。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            大于0，则设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效。</font><font style="vertical-align: inherit;">相反，只要对日志文件的写入导致其大小超过该
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值，审计日志插件将关闭该文件，重命名该文件并打开一个新的日志文件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该插件按如下方式重命名原始文件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从MySQL 5.7.21开始，重命名的文件的基本名称后面插入了时间戳。</font><font style="vertical-align: inherit;">例如，如果文件名是
               </font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，插件将其重命名为一个值，如
               </font></font><code class="filename">audit.20180115T140633.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">时间戳是</font><font style="vertical-align: inherit;">
              格式中</font><font style="vertical-align: inherit;">的UTC值
               </font><font style="vertical-align: inherit;">。
            </font></font><code class="literal"><em class="replaceable"><code>YYYYMMDD</code></em>T<em class="replaceable"><code>hhmmss</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在MySQL 5.7.21之前，重命名的文件有一个时间戳并</font></font><code class="filename">.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加到最后。</font><font style="vertical-align: inherit;">例如，如果文件名是
               </font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，插件将其重命名为一个值，如
               </font></font><code class="filename">audit.log.15159344437726520.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">时间戳值与Unix时间戳相似，最后7位数字代表小数第二部分。</font><font style="vertical-align: inherit;">通过插入小数点，可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_from-unixtime"><code class="literal">FROM_UNIXTIME()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              函数</font><font style="vertical-align: inherit;">来解释该值</font><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT FROM_UNIXTIME(1515934443.7726520);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">FROM_UNIXTIME（1515934443.7726520）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-14 06：54：03.772652 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------- +</font></font><font></font>
</pre></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用基于大小的日志文件轮换时，重命名的日志文件不会在名称序列的末尾旋转。</font><font style="vertical-align: inherit;">相反，它们具有独特的名称并且无限期地积累。</font><font style="vertical-align: inherit;">为避免空间使用过多，请定期移除旧文件，并根据需要首先进行备份。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-reading"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件读取</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志插件允许书签和读取JSON格式的审计日志文件。</font><font style="vertical-align: inherit;">（这些功能不适用于以其他日志格式编写的文件。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当审计日志插件初始化并为JSON日志记录进行配置时，它将使用包含审计日志文件（根据该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">确定
           </font><font style="vertical-align: inherit;">）的目录作为搜索可读审计日志文件的位置。</font><font style="vertical-align: inherit;">为此，它使用值
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来确定文件基本名称和后缀值，然后查找名称与以下模式匹配的</font></font><code class="literal">[...]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，其中
           </font><font style="vertical-align: inherit;">表示可选的文件名部分：
        </font></font></p><pre data-lang="none" class="programlisting"><em class="replaceable"><code>basename</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><em class="replaceable"><code>timestamp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]。</font></font><em class="replaceable"><code>suffix</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[。广州] [ENC]
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该插件打开每个匹配的文件，检查它是否真的包含JSON审计记录，并使用来自每个文件的第一条记录的时间戳对它们进行排序，以构建可用于日志读取功能的日志文件列表。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该插件不能包含在手动重命名的序列文件中，并且不匹配前面的模式，或者使用与当前密码不同的密码加密。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要从审计日志中读取事件，请使用这些用户定义的函数（UDF）：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_read_bookmark()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示最近编写的审计日志事件的书签</font><font style="vertical-align: inherit;">的
               </font><font style="vertical-align: inherit;">字符串。</font><font style="vertical-align: inherit;">此书签适合传递以
               </font></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示该功能从何处开始阅读。</font><font style="vertical-align: inherit;">示例书签：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 21:03:44”，“id”：0}
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从审计日志中读取事件并返回一个
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含审计事件数组的字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用当前书签的</font><font style="vertical-align: inherit;">
          示例</font><font style="vertical-align: inherit;">调用：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_read(audit_log_read_bookmark());</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_read（audit_log_read_bookmark（））|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">[{“timestamp”：“2018-01-15 22:41:24”，“id”：0，“class”：“连接”，... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回值</font><font style="vertical-align: inherit;">
          中的每个事件</font><font style="vertical-align: inherit;">都是</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列，但最后一个数组元素可能是一个
           </font><font style="vertical-align: inherit;">
          值，表示没有以下事件可供读取。</font><font style="vertical-align: inherit;">例如：
        </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a> <code class="literal">null</code><font style="vertical-align: inherit;"></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {“timestamp”：“2018-01-15 22:08:08”，“id”：10，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “班级”：“一般”，“事件”：“状态”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “timestamp”：“2018-01-15 22:08:08”，“id”：11，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：“连接”，“事件”：“断开”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “timestamp”：“2018-01-15 13:39:33”，“id”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：“连接”，“事件”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “timestamp”：“2018-01-15 13:39:33”，“id”：1，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “班级”：“一般”，“事件”：“状态”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “timestamp”：“2018-01-15 13:39:33”，“id”：2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：“连接”，“事件”：“断开”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  空值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
]</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像这样</font><font style="vertical-align: inherit;">
          使用</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              会话中</font><font style="vertical-align: inherit;">的第一次通话</font><font style="vertical-align: inherit;">，传递一个书签指示从何处开始阅读。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果返回的数组的最终值不是一个
               </font><font style="vertical-align: inherit;">值，那么刚刚读取的事件之后会有更多事件，并且
               </font><font style="vertical-align: inherit;">可以在没有或带有书签参数的情况下调用它们。</font><font style="vertical-align: inherit;">没有争论，阅读继续下一个未读的事件。</font><font style="vertical-align: inherit;">通过书签参数，可以从书签继续阅读。
            </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
              <code class="literal">null</code><font style="vertical-align: inherit;"></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果返回数组的最终值是一个
               </font><font style="vertical-align: inherit;">值，则不会再有事件要读取，下一次调用
               </font><font style="vertical-align: inherit;">必须包含书签参数。
</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
              <code class="literal">null</code><font style="vertical-align: inherit;"></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          书签是</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示阅读地点和阅读</font><font style="vertical-align: inherit;">量的</font><font style="vertical-align: inherit;">散列。</font><font style="vertical-align: inherit;">以下项目在书签值中很重要（其他项目被忽略）：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：要读取的第一个事件的审核日志中的位置。</font><font style="vertical-align: inherit;">这两个项目必须存在才能完全指定一个位置。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">max_array_length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：从日志中读取的最大事件数量。</font><font style="vertical-align: inherit;">如果省略，则默认为读取到日志末尾或直到读取缓冲区已满，以先到者为准。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从日志读取功能返回的结果是一个二进制字符串。</font><font style="vertical-align: inherit;">要将字符串用于需要非二进制字符串的函数（例如操作</font></font><code class="literal">JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">的函数
           </font><font style="vertical-align: inherit;">），请将其转换为
           </font></font><code class="literal">utf8mb4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设一个书签有这个值：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @mark := audit_log_read_bookmark() AS mark;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">mark |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 16:10:28”，“id”：2} |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该书签</font><font style="vertical-align: inherit;">
          调用</font><font style="vertical-align: inherit;">可以返回多个事件。</font><font style="vertical-align: inherit;">要设置对读取的事件数量的限制</font></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请将书签转换为</font></font><code class="literal">utf8mb4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后添加</font></font><code class="literal">max_array_length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为1 </font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">项目。例如，使用上一个书签，按以下方式转换和修改它：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SET @mark = CONVERT(@mark USING utf8mb4);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SET @mark := JSON_SET(@mark, '$.max_array_length', 1);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SELECT @mark;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@mark |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">{“id”：2，“timestamp”：“2018-01-15 16:10:28”，“max_array_length”：1} |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改后的书签在传递给它
           </font></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时产生单个审计记录的结果。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要设置</font></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取</font><font style="vertical-align: inherit;">的字节数限制，请
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_read_buffer_size"><code class="literal">audit_log_read_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器启动时</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">系统变量。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关审计日志读取功能的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-routines" title="6.5.5.8.2审计日志功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.2节“审计日志功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-filtering"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.6审计日志过滤</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528110878192"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何安装审计日志插件以及随附的审计表和UDF，如何从MySQL 5.7.13开始审计日志过滤。</font><font style="vertical-align: inherit;">如果插件已安装，但没有附带的审计表和UDF，则该插件将以旧式过滤模式运行，如
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“旧模式审核日志过滤”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">传统模式是过滤行为，因为它在MySQL 5.7.13之前; </font><font style="vertical-align: inherit;">也就是在引入基于规则的过滤之前。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7.13之前，审计日志插件能够通过基于事件发生的帐户或事件状态对它们进行过滤来控制审计事件的记录。</font><font style="vertical-align: inherit;">从MySQL 5.7.13开始，过滤功能得到了扩展：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            审计事件可以使用以下特征进行过滤：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                用户帐号
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                审计事件类
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                审计事件子类
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                事件字段的值，如指示操作状态或执行的SQL语句的值
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            审计筛选基于规则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                过滤器定义会创建一组审核规则。</font><font style="vertical-align: inherit;">定义可以配置为包含或排除基于刚才描述的特征进行记录的事件。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                从MySQL 5.7.20开始，除了现有的事件记录功能外，过滤规则还具有阻止（中止）限定事件执行的功能。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                可以定义多个过滤器，并且可以将任何给定的过滤器分配给任意数量的用户帐户。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                可以定义默认过滤器，以便与任何没有明确分配过滤器的用户帐户一起使用。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以使用基于用户定义函数（UDF）的SQL接口定义，显示和修改审计筛选器。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            审计过滤器定义存储在</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库</font><font style="vertical-align: inherit;">的表中
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在给定会话中，只读
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量的值指示是否为会话分配了过滤器。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          默认情况下，基于规则的审计日志过滤不记录任何用户的可审计事件。</font><font style="vertical-align: inherit;">要记录所有用户的所有可审计事件，请使用以下语句，这些语句创建一个简单的过滤器来启用日志记录并将其分配给默认帐户：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT audit_log_filter_set_filter（'log_all'，'{“filter”：{“log”：true}}'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT audit_log_filter_set_user（'％'，'log_all'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分配给的过滤器</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于来自任何没有明确分配过滤器的账户的连接（最初对所有账户均为真）。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表简要总结了实现用于审计筛选控制的SQL接口的UDF：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_filter_set_filter()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：定义一个过滤器
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">audit_log_filter_remove_filter()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：删除一个过滤器
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">audit_log_filter_set_user()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：开始过滤用户帐户
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">audit_log_filter_remove_user()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：停止过滤用户帐户
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">audit_log_filter_flush()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：刷新过滤表的手动更改以影响正在进行的过滤
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关过滤功能的用法示例和完整详细信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-functions" title="6.5.5.6.1使用审计日志过滤功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.6.1节“使用审核日志过滤功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-routines" title="6.5.5.8.2审计日志功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.2节“审核日志功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        审计日志过滤功能受以下限制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要使用任何过滤功能，</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须启用</font><font style="vertical-align: inherit;">该
             </font><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">否则，会发生错误：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; SELECT audit_log_filter_flush（）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_filter_flush（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">错误：audit_log插件尚未使用INSTALL PLUGIN语法安装。</font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            审核表也必须存在或发生错误：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; SELECT audit_log_filter_flush（）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_filter_flush（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">错误：无法重新初始化审计日志过滤器。</font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- -  +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要安装</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-installation" title="6.5.5.2安装或卸载MySQL企业审计"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.2节“安装或卸载MySQL企业审核”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要使用任何过滤功能，用户必须拥有该
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限。</font><font style="vertical-align: inherit;">否则，会发生错误：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_filter_flush()\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
audit_log_filter_flush（）：错误：请求忽略'user1'@'localhost'。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          SUPER_ACL需要执行操作</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要授予</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户权限，请使用以下语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予超级* * * TO </font></font><em class="replaceable"><code>user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或者，如果您希望避免授予
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权，同时仍允许用户访问特定的过滤功能，
             </font><font style="vertical-align: inherit;">则可以定义</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装器</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储的程序。</font><font style="vertical-align: inherit;">该技术在</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring-udf-usage" title="6.5.4.8.2使用通用密钥环函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4.8.2节“使用通用密钥环函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的密钥环UDF的上下文中进行了描述
             </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">它可以适用于过滤UDF。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果已安装</font><font style="vertical-align: inherit;">
            该</font><font style="vertical-align: inherit;">插件，则</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">插件将以传统模式运行，但不会创建附带的审计表和功能。</font><font style="vertical-align: inherit;">插件在服务器启动时将这些消息写入错误日志中：
          </font></font></p><a class="indexterm" name="idm140528110825328"></a><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Warning]插件audit_log报告：'无法打开审核日志过滤器表'。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[Warning]插件audit_log报告：'审核日志插件支持过滤，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尚未安装。</font><font style="vertical-align: inherit;">审计日志插件将运行在旧版本中</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
模式，这将在下一个版本中被禁用。'</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在传统模式下，只能根据事件帐户或状态进行过滤。</font><font style="vertical-align: inherit;">有关详细信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“传统模式审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-filtering-functions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.6.1使用审计日志过滤功能</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在使用审计日志用户定义函数（UDF）之前，请按照</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-installation" title="6.5.5.2安装或卸载MySQL企业审计"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.2节“安装或卸载MySQL企业审计”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的说明进行
           </font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-installation" title="6.5.5.2安装或卸载MySQL企业审计"><font style="vertical-align: inherit;">安装</font></a><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要使用这些功能</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">特权。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          审计日志过滤功能通过提供一个界面来创建，修改和删除过滤器定义并为用户帐户分配过滤器来启用过滤控制。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          过滤器定义是</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值。</font><font style="vertical-align: inherit;">有关</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL中</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">数据的</font><font style="vertical-align: inherit;">信息
           </font><font style="vertical-align: inherit;">，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第11.6节“JSON数据类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">本节介绍一些简单的过滤器定义。</font><font style="vertical-align: inherit;">有关过滤器定义的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filter-definitions" title="6.5.5.6.2编写审计日志过滤器定义"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.6.2节“编写审计日志过滤器定义”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当连接到达时，审计日志插件通过在当前过滤器分配中搜索用户帐户名称来确定用于新会话的过滤器：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果为用户分配了过滤器，审核日志将使用该过滤器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              否则，如果不存在特定于用户的过滤器分配，但会为默认帐户（</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">分配过滤器</font><font style="vertical-align: inherit;">，则审核日志将使用默认过滤器。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              否则，审计日志不会从会话中选择任何审计事件进行处理。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果在会话期间发生更改用户操作（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-change-user" title="27.8.7.3 mysql_change_user（）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第27.8.7.3节“mysql_change_user（）”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），则会话的过滤器分配会使用相同的规则进行更新，但对于新用户会进行更新。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          默认情况下，没有帐户分配过滤器，因此任何帐户都不会处理可审计事件。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设您希望默认设置为只记录与连接相关的活动（例如，查看连接，更改用户和断开连接事件，而不是用户在连接时执行的SQL语句）。</font><font style="vertical-align: inherit;">要实现这一点，请定义一个过滤器（此处以named命名</font></font><code class="literal">log_conn_events</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），仅允许记录</font></font><code class="literal">connection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该类中</font><font style="vertical-align: inherit;">的事件
           </font><font style="vertical-align: inherit;">，并将该过滤器分配给以</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          帐户名称</font><font style="vertical-align: inherit;">表示的默认帐户</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @f ='{“filter”：{“class”：{“name”：“connection”}}}';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT audit_log_filter_set_filter（'log_conn_events'，@f）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT audit_log_filter_set_user（'％'，'log_conn_events'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在，审计日志使用此默认帐户过滤器来处理来自没有明确定义的过滤器的任何帐户的连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要为特定用户帐户明确分配过滤器，请定义过滤器，然后将其分配给相关帐户：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT audit_log_filter_set_filter（'log_all'，'{“filter”：{“log”：true}}'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT audit_log_filter_set_user（'user1 @ localhost'，'log_all'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT audit_log_filter_set_user（'user2 @ localhost'，'log_all'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在为</font></font><code class="literal">user1@localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font><font style="vertical-align: inherit;">启用了完整日志记录
           </font></font><code class="literal">user2@localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">来自其他帐户的连接继续使用默认帐户过滤器进行过滤。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要从当前过滤器中取消关联用户帐户，请取消分配过滤器或分配不同的过滤器：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从用户帐户取消分配过滤器：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT audit_log_filter_remove_user（'user1 @ localhost'）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为帐户过滤当前会话不受影响。</font><font style="vertical-align: inherit;">如果有帐户，则帐户的后续连接将使用默认帐户过滤器进行过滤，否则不会进行记录。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为用户帐户分配一个不同的过滤器：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT audit_log_filter_set_filter（'log_nothing'，'{“filter”：{“log”：false}}'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT audit_log_filter_set_user（'user1 @ localhost'，'log_nothing'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为帐户过滤当前会话不受影响。</font><font style="vertical-align: inherit;">帐户的后续连接将使用新过滤器进行过滤。</font><font style="vertical-align: inherit;">对于此处显示的过滤器，这意味着不记录新的连接
               </font></font><code class="literal">user1@localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于审计日志过滤，用户名和主机名比较区分大小写。</font><font style="vertical-align: inherit;">这与特权检查的比较不同，主机名比较不区分大小写。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要删除过滤器，请执行以下操作：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT audit_log_filter_remove_filter（'log_nothing'）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          删除过滤器也会将其从任何已分配给它的用户取消分配，包括这些用户的任何当前会话。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          刚刚描述的过滤UDF会立即影响审计过滤，并更新
           </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库中用于存储过滤器和用户帐户的</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-tables" title="6.5.5.8.1审计日志表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见</font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-tables" title="6.5.5.8.1审计日志表"><font style="vertical-align: inherit;">第6.5.5.8.1节“审计日志表”</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">也可以直接使用语句，如修改审计日志表</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但这样的变化不影响立即过滤。</font><font style="vertical-align: inherit;">要刷新您的更改并使其可用，请致电
           </font></font><code class="literal">audit_log_filter_flush()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT audit_log_filter_flush（）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要确定过滤器是否已分配给当前会话，请检查只读</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的会话值
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果值为0，则不分配过滤器。</font><font style="vertical-align: inherit;">非零值表示分配的过滤器的内部维护ID：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@audit_log_filter_id;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ audit_log_filter_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- +</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-filter-definitions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.6.2编写审计日志过滤器定义</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          过滤器定义是</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值。</font><font style="vertical-align: inherit;">有关</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL中</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">数据的</font><font style="vertical-align: inherit;">信息
           </font><font style="vertical-align: inherit;">，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第11.6节“JSON数据类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          过滤器定义具有这种形式，其中
           </font></font><em class="replaceable"><code>actions</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示如何进行过滤：
        </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{“filter”：</font></font><em class="replaceable"><code>actions</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下讨论描述了过滤器定义中允许的结构。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-enabling-logging" title="记录所有事件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录所有事件</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-class-logging" title="记录特定事件类"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录特定事件类</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-subclass-logging" title="记录特定事件子类"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录特定事件子类</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-inclusive-exclusive" title="包含和独占记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含和独占记录</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-event-fields" title="测试事件字段值"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试事件字段值</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-blocking-events" title="阻止执行特定事件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止执行特定事件</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-logical-operators" title="逻辑运算符"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逻辑运算符</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-predefined-variables" title="引用预定义的变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用预定义的变量</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-predefined-functions" title="引用预定义的函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用预定义的函数</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-filter-replacement" title="替换用户过滤器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替换用户过滤器</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h6 class="title"><a name="audit-log-filtering-enabling-logging"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录所有事件</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要明确启用或禁用所有事件的记录，请使用</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤器中</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">元素：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “filter”：{“log”：true}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值可以是
             </font></font><code class="literal">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            上述过滤器可以记录所有事件。</font><font style="vertical-align: inherit;">它相当于：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            日志记录行为取决于</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值和</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">是否</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定的情况下，使用其给定值。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果没有</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定，日志记录
                 </font></font><code class="literal">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果没有</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                或</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目中指定，
                 </font></font><code class="literal">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否则（在这种情况下，
                 </font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可包括自己的</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目）。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-class-logging"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录特定事件类</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要记录特定类的事件，请使用</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤器中</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">元素，其中的
             </font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段表示要记录的类的名称：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{“name”：“连接”}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值可以是
             </font></font><code class="literal">connection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">general</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">table_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别记录连接，常规或表访问事件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            上面的过滤器可以记录</font></font><code class="literal">connection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类中</font><font style="vertical-align: inherit;">的事件
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它相当于以下</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显式</font><font style="vertical-align: inherit;">过滤条件</font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “log”：false，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{“log”：true，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               “name”：“连接”}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要启用多个类的日志记录，请将该</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">定义
             </font><font style="vertical-align: inherit;">为</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名这些类</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">数组元素：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “班级”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {“name”：“连接”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {“name”：“general”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {“name”：“table_access”}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当给定项目的多个实例出现在过滤器定义中的同一级别时，可以将项目值合并到数组值的单个实例中。</font><font style="vertical-align: inherit;">前面的定义可以这样写：
            </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “班级”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {“name”：[“connection”，“general”，“table_access”]}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-subclass-logging"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录特定事件子类</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要选择特定的事件子类，请使用</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名子类</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">项目的
             </font><font style="vertical-align: inherit;">项目。</font><font style="vertical-align: inherit;">项目选择的事件的默认操作
             </font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是记录它们。</font><font style="vertical-align: inherit;">例如，此筛选器可以记录指定的事件子类：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “班级”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “name”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “事件”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“connect”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“disconnect”}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {“name”：“general”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “name”：“table_access”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “事件”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“insert”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“delete”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“更新”}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目还可以包含显式
             </font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目以指示是否要记录符合条件的事件。</font><font style="vertical-align: inherit;">此</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目选择多个事件并明确指示它们的日志记录行为：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“事件”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {“name”：“select”，“log”：false}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {“name”：“insert”，“log”：true}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {“name”：“delete”，“log”：true}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  {“name”：“update”，“log”：true}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
]</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7.20开始，该</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目还可以指示是否阻止符合条件的事件，如果它包含</font></font><code class="literal">abort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目。</font><font style="vertical-align: inherit;">有关详细信息，请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering-blocking-events" title="阻止执行特定事件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止执行特定事件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-event-subclass-combinations" title="表6.24事件类和子类组合"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.24“事件类和子类组合”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            描述了每个事件类的允许子类值。
</font></font></p>
<div class="table">
<a name="audit-log-event-subclass-combinations"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.24事件类和子类组合</font></font></b></p>
<div class="table-contents">
<table summary="Permitted combiniations of event class and subclass values."><colgroup><col width="20%"><col width="20%"><col width="60%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件类</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件子类</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">connect</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接启动（成功或失败）</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">change_user</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话期间用户使用不同的用户/密码进行重新认证</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">disconnect</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接终止</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general</code></td>
                <td><code class="literal">status</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般操作信息</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">read</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表读取语句，如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                  </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT
                  INTO ... SELECT</code></a></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">delete</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表删除语句，如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">insert</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表插入语句，如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">update</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表更新语句，如 </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-event-subclass-log-abort" title="表6.25每个事件类别和子类别组合的日志和中止特征"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.25“每个事件类和子类组合的记录和中止特征”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            描述了每个事件子类是否可以记录或中止。
</font></font></p>
<div class="table">
<a name="audit-log-event-subclass-log-abort"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.25每个事件类别和子类别组合的日志和中止特征</font></font></b></p>
<div class="table-contents">
<table summary="Log and abort characteristics for event class and subclass combinations."><colgroup><col width="20%"><col width="20%"><col width="30%"><col width="30%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件类</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件子类</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以被记录</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以中止</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">connect</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">change_user</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">disconnect</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general</code></td>
                <td><code class="literal">status</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">read</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">delete</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">insert</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">update</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-inclusive-exclusive"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含和独占记录</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            过滤器可以定义为包容或独占模式：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                包含模式仅记录明确指定的项目。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                独占模式记录所有内容，但显式指定项目
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要执行兼容性日志记录，请全局禁用日志记录并启用特定类的日志记录 </font><font style="vertical-align: inherit;">此过滤器记录</font><font style="vertical-align: inherit;">课程</font><font style="vertical-align: inherit;">
            中的</font><font style="vertical-align: inherit;">日志
             </font></font><code class="literal">connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">disconnect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件以及</font></font><code class="literal">connection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">课程中的事件</font></font><code class="literal">general</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “log”：false，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “班级”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “name”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “事件”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“connect”，“log”：true}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“disconnect”，“log”：true}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {“name”：“general”，“log”：true}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要执行独占记录，请启用全局记录并禁用特定类的记录。</font><font style="vertical-align: inherit;">该过滤器记录除</font></font><code class="literal">general</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            类别中的</font><font style="vertical-align: inherit;">事件外的所有内容</font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “log”：true，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “类”：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {“name”：“general”，“log”：false}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该过滤器记录</font></font><code class="literal">change_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的事件</font></font><code class="literal">connection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类和
             </font></font><code class="literal">table_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “log”：true，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “班级”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “name”：“连接”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “事件”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“connect”，“log”：false}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          {“name”：“disconnect”，“log”：false}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      {“name”：“general”，“log”：false}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-event-fields"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试事件字段值</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要根据特定事件字段值启用日志记录，请在</font></font><code class="literal">field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目内
             </font><font style="vertical-align: inherit;">指定一个</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目以指示字段名称及其期望值：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “名称”：“一般”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “事件”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “名称”：“状态”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “log”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          “field”：{“name”：“general_command.str”，“value”：“查询”}}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每个事件都包含可以在过滤器中访问的事件类特定字段，以执行自定义过滤。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            连接事件指示会话期间何时发生与连接相关的活动，例如用户连接到服务器或与服务器断开连接。
            </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-connection-event-fields" title="表6.26连接事件字段"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.26“连接事件字段”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            表示</font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-connection-event-fields" title="表6.26连接事件字段"><font style="vertical-align: inherit;">连接事件</font></a><font style="vertical-align: inherit;">的允许字段。
</font></font></p>
<div class="table">
<a name="audit-log-connection-event-fields"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.26连接事件字段</font></font></b></p>
<div class="table-contents">
<table summary="Permitted fields for connection events."><colgroup><col width="35%"><col width="20%"><col width="45%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段名称</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段类型</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">status</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
                <td><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    活动状态：
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    0：好
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    否则：失败
                  </font></font></p></td>
              </tr><tr>
                <td scope="row"><code class="literal">connection_id</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接ID</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">user.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在认证期间指定的用户名</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">user.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">priv_user.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经过身份验证的用户名（帐户用户名）</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">priv_user.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经过验证的用户名长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">external_user.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部用户名（由第三方认证插件提供）</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">external_user.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部用户名长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">proxy_user.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户名</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">proxy_user.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理用户名长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">host.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接的用户主机</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">host.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接的用户主机长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">ip.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接的用户IP地址</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">ip.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接的用户IP地址长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">database.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库名称在连接时指定</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">database.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库名称长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">connection_type</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
                <td><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    连接类型：
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    或者</font></font><code class="literal">"::undefined"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：未定义
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    或者</font></font><code class="literal">"::tcp/ip"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：TCP / IP
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    或者</font></font><code class="literal">"::socket"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Socket
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    或者</font></font><code class="literal">"::named_pipe"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：命名管道
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    或者</font></font><code class="literal">"::ssl"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：带有加密的TCP / IP
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    或者</font></font><code class="literal">"::shared_memory"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：共享内存
                  </font></font></p></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些</font><font style="vertical-align: inherit;">
            值是可以给出的符号伪常量，而不是文字数字值。</font><font style="vertical-align: inherit;">它们必须以字符串引用并区分大小写。
          </font></font><code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一般事件表示操作的状态代码及其详细信息。
            </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-general-event-fields" title="表6.27一般事件字段"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.27“常规事件字段”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示一般事件的允许字段。
</font></font></p>
<div class="table">
<a name="audit-log-general-event-fields"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.27一般事件字段</font></font></b></p>
<div class="table-contents">
<table summary="Permitted field types for general events."><colgroup><col width="35%"><col width="20%"><col width="45%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段名称</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段类型</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">general_error_code</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
                <td><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    活动状态：
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    0：好
                  </font></font></p><p class="valid-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    否则：失败
                  </font></font></p></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_thread_id</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接/线程ID</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_user.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在认证期间指定的用户名</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_user.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_command.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令名称</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_command.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令名称长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_query.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语句文本</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_query.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语句文本的长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_host.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_host.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_sql_command.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL命令类型名称</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_sql_command.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL命令类型名称长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_external_user.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部用户名（由第三方认证插件提供）</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_external_user.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部用户名长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_ip.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接的用户IP地址</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_ip.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接用户IP地址长度</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
            <code class="literal">general_command.str</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示命令名：</font></font><code class="literal">Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Execute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">Quit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font><code class="literal">Change user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与一般的事件
             </font></font><code class="literal">general_command.str</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段设置为
             </font></font><code class="literal">Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">Execute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            包含</font></font><code class="literal">general_sql_command.str</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为指定SQL命令的类型的值：
             </font></font><code class="literal">alter_db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">alter_db_upgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">admin_commands</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，等等。</font><font style="vertical-align: inherit;">这些值可以看作是此语句显示的性能模式工具的最后组件：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT NAME FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE 'statement/sql/%' ORDER BY NAME;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NAME |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">statement / sql / alter_db |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">statement / sql / alter_db_upgrade |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">statement / sql / alter_event |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">statement / sql / alter_function |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">statement / sql / alter_instance |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">statement / sql / alter_procedure |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">statement / sql / alter_server |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表访问事件提供有关特定表访问的信息。
            </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-table-access-event-fields" title="表6.28表访问事件字段"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.28“表访问事件字段”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            表示</font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-table-access-event-fields" title="表6.28表访问事件字段"><font style="vertical-align: inherit;">表访问事件</font></a><font style="vertical-align: inherit;">的允许字段。
</font></font></p>
<div class="table">
<a name="audit-log-table-access-event-fields"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.28表访问事件字段</font></font></b></p>
<div class="table-contents">
<table summary="Permitted fields for table-access events."><colgroup><col width="35%"><col width="20%"><col width="45%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段名称</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段类型</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">connection_id</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件连接ID</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">sql_command_id</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL命令ID</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">query.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语句文本</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">query.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语句文本的长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_database.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与事件关联的数据库名称</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_database.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库名称长度</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_name.str</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与事件关联的表名</font></font></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_name.length</code></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号整数</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表名长度</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下列表显示哪些语句产生哪些表访问事件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 事件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">SELECT</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">INSERT ... SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（对于在</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">引用的表</font><font style="vertical-align: inherit;">）
                  </font></font></p></li><li class="listitem"><p>
                    <code class="literal">REPLACE ... SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（对于在</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">引用的表</font><font style="vertical-align: inherit;">）
                  </font></font></p></li><li class="listitem"><p>
                    <code class="literal">UPDATE ... WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（对于在</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">引用的表</font><font style="vertical-align: inherit;">）
                  </font></font></p></li><li class="listitem"><p>
                    <code class="literal">HANDLER ... READ</code>
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 事件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">DELETE</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">TRUNCATE TABLE</code>
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">insert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 事件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">INSERT</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">INSERT ... SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（对于在</font></font><code class="literal">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">中引用的表</font><font style="vertical-align: inherit;">）
                  </font></font></p></li><li class="listitem"><p>
                    <code class="literal">REPLACE</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">REPLACE ... SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（用于在</font></font><code class="literal">REPLACE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句
                   </font><font style="vertical-align: inherit;">中引用的表</font></font></p></li><li class="listitem"><p>
                    <code class="literal">LOAD DATA INFILE</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">LOAD XML INFILE</code>
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 事件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">UPDATE</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">UPDATE ... WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（对于在</font></font><code class="literal">UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">引用的表</font><font style="vertical-align: inherit;">）
</font></font></p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-blocking-events"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止执行特定事件</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7.20开始，</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目可以包含一个</font></font><code class="literal">abort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目，用于指示是否阻止执行合格事件。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">abort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用阻止执行特定SQL语句的规则。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">abort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目必须出现在一个
             </font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目中。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“事件”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “名称”：</font></font><em class="replaceable"><code>qualifying event subclass names</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “中止”：</font></font><em class="replaceable"><code>condition</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            项目</font><font style="vertical-align: inherit;">选择的事件子类</font></font><code class="literal">abort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，取决于</font></font><em class="replaceable"><code>condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            评估</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">操作是true或false </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果条件评估为真，则该事件被阻止。</font><font style="vertical-align: inherit;">否则，事件继续执行。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            所述</font></font><em class="replaceable"><code>condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规范可以是一样简单</font></font><code class="literal">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者它可以是更复杂的，使得评价取决于事件特性。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该过滤块</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “name”：“table_access”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “事件”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “名称”：[“插入”，“更新”，“删除”]，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “中止”：是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个更复杂的过滤器会阻止相同的语句，但仅限于特定的表（</font></font><code class="literal">finances.bank_account</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “name”：“table_access”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “事件”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “名称”：[“插入”，“更新”，“删除”]，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “中止”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          “和”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            {“field”：{“name”：“table_database.str”，“value”：“finances”}}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            {“field”：{“name”：“table_name.str”，“value”：“bank_account”}}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            过滤器匹配并阻止的语句向客户端返回错误：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1045（28000）：语句被审计日志过滤器中止
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并非所有事件都可以被阻止（
             </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-event-subclass-log-abort" title="表6.25每个事件类别和子类别组合的日志和中止特征"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">见表6.25，“每个事件类别和子类别组合的记录和中止特征”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">对于不能的事件，审计日志会向错误日志写入警告而不是阻止它。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于尝试定义</font></font><code class="literal">abort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目出现在</font></font><code class="literal">event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font><font style="vertical-align: inherit;">以外
             </font><font style="vertical-align: inherit;">的过滤器时，
             </font><font style="vertical-align: inherit;">会发生错误。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-logical-operators"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逻辑运算符</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            逻辑运算符（</font></font><code class="literal">and</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">or</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">not</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）可被用</font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物品。</font><font style="vertical-align: inherit;">这允许构建更高级的过滤配置：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “名称”：“一般”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “事件”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “名称”：“状态”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “log”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          “要么”： [</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              “和”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                {“field”：{“name”：“general_command.str”，“value”：“Query”}}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                {“field”：{“name”：“general_command.length”，“value”：5}}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              “和”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                {“field”：{“name”：“general_command.str”，“value”：“Execute”}}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                {“field”：{“name”：“general_command.length”，“value”：7}}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-predefined-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用预定义的变量</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要引用条件中的预定义变量
             </font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用
             </font></font><code class="literal">variable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目，该项目针对给定值测试相等性：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “名称”：“一般”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “事件”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “名称”：“状态”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “log”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          “变量”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “name”：“audit_log_connection_policy_value”，“value”：“:: none”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每个预定义变量对应于一个系统变量。</font><font style="vertical-align: inherit;">通过编写测试预定义变量的过滤器，您可以通过设置相应的系统变量来修改过滤器操作，而无需重新定义过滤器。</font><font style="vertical-align: inherit;">例如，通过编写一个过滤器来测试</font></font><code class="literal">audit_log_connection_policy_value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            预定义变量</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">，您可以通过更改</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量</font><font style="vertical-align: inherit;">的值来修改过滤器操作
             </font><font style="vertical-align: inherit;">。
          </font></font></p><a class="indexterm" name="idm140528110304464"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该
             </font><font style="vertical-align: inherit;">
            系统变量用于遗留模式审计日志（见
             </font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;">第6.5.5.7，“传统模式下的审计日志过滤”</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">使用基于规则的审计日志过滤时，这些变量保持可见（例如使用</font><font style="vertical-align: inherit;">），但除非您编写包含引用它们的结构的过滤器，否则对它们所做的更改不起作用。
          </font></font><code class="literal">audit_log_<em class="replaceable"><code>xxx</code></em>_policy</code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-variables" title="13.7.5.39 SHOW VARIABLES语法"><code class="literal">SHOW
            VARIABLES</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下列表描述了</font></font><code class="literal">variable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font><font style="vertical-align: inherit;">允许的预定义变量</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">audit_log_connection_policy_value</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这个变量对应于</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量</font><font style="vertical-align: inherit;">的值
                 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该值是一个无符号整数。
                </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-connection-policy-value-values" title="表6.29 audit_log_connection_policy_value值"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.29“audit_log_connection_policy_value值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                显示允许的值和相应的
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                值。
</font></font></p>
<div class="table">
<a name="audit-log-connection-policy-value-values"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.29 audit_log_connection_policy_value值</font></font></b></p>
<div class="table-contents">
<table summary="Permitted audit_log_connection_policy_value values and the corresponding audit_log_connection_policy values."><colgroup><col width="20%"><col width="80%"></colgroup><thead><tr>
                    <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
                    <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对应的audit_log_connection_policy值</font></font></th>
                  </tr></thead><tbody><tr>
                    <td scope="row"><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::none"</code></td>
                    <td><code class="literal">NONE</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::errors"</code></td>
                    <td><code class="literal">ERRORS</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::all"</code></td>
                    <td><code class="literal">ALL</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这些
                 </font><font style="vertical-align: inherit;">
                值是可以给出的符号伪常量，而不是文字数字值。</font><font style="vertical-align: inherit;">它们必须以字符串引用并区分大小写。
              </font></font><code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
                <code class="literal">audit_log_policy_value</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这个变量对应于</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
                 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该值是一个无符号整数。
                </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-policy-value-values" title="表6.30 audit_log_policy_value值"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.30，“audit_log_policy_value值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示允许的值和相应的
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                值。
</font></font></p>
<div class="table">
<a name="audit-log-policy-value-values"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.30 audit_log_policy_value值</font></font></b></p>
<div class="table-contents">
<table summary="Permitted audit_log_policy_value values and the corresponding audit_log_policy values."><colgroup><col width="20%"><col width="80%"></colgroup><thead><tr>
                    <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
                    <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对应的audit_log_policy值</font></font></th>
                  </tr></thead><tbody><tr>
                    <td scope="row"><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::none"</code></td>
                    <td><code class="literal">NONE</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::logins"</code></td>
                    <td><code class="literal">LOGINS</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::all"</code></td>
                    <td><code class="literal">ALL</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::queries"</code></td>
                    <td><code class="literal">QUERIES</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这些
                 </font><font style="vertical-align: inherit;">
                值是可以给出的符号伪常量，而不是文字数字值。</font><font style="vertical-align: inherit;">它们必须以字符串引用并区分大小写。
              </font></font><code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
                <code class="literal">audit_log_statement_policy_value</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这个变量对应于</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量</font><font style="vertical-align: inherit;">的值
                 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该值是一个无符号整数。
                </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-statement-policy-value-values" title="表6.31 audit_log_statement_policy_value值"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.31“audit_log_statement_policy_value值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                显示允许的值和相应的
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                值。
</font></font></p>
<div class="table">
<a name="audit-log-statement-policy-value-values"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.31 audit_log_statement_policy_value值</font></font></b></p>
<div class="table-contents">
<table summary="Permitted audit_log_statement_policy_value values and the corresponding audit_log_statement_policy values."><colgroup><col width="20%"><col width="80%"></colgroup><thead><tr>
                    <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
                    <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对应的audit_log_statement_policy值</font></font></th>
                  </tr></thead><tbody><tr>
                    <td scope="row"><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::none"</code></td>
                    <td><code class="literal">NONE</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::errors"</code></td>
                    <td><code class="literal">ERRORS</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么 </font></font><code class="literal">"::all"</code></td>
                    <td><code class="literal">ALL</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这些
                 </font><font style="vertical-align: inherit;">
                值是可以给出的符号伪常量，而不是文字数字值。</font><font style="vertical-align: inherit;">它们必须以字符串引用并区分大小写。
</font></font><code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-predefined-functions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用预定义的函数</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要引用条件中的预定义函数
             </font></font><code class="literal">log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请使用一个</font></font><code class="literal">function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目，它
             </font><font style="vertical-align: inherit;">使用
             </font><font style="vertical-align: inherit;">值</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">args</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值分别指定函数名称及其参数：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “名称”：“一般”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “事件”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “名称”：“状态”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “log”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          “功能”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “name”：“find_in_include_list”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “args”：[{“string”：[{“field”：“user.str”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                                    {“string”：“@”}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                                    {“field”：“host.str”}]}]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该项中指定</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的函数应该只是函数名称，不包含圆括号或参数列表。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">args</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目中的</font><font style="vertical-align: inherit;">参数
             </font><font style="vertical-align: inherit;">（如果有的话）必须按照功能描述中列出的顺序给出。</font><font style="vertical-align: inherit;">参数可以引用预定义变量，事件字段或字符串或数字常量。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            前面的过滤器根据是否</font><font style="vertical-align: inherit;">
            在</font><font style="vertical-align: inherit;">
            系统变量中</font><font style="vertical-align: inherit;">找到当前用户</font><font style="vertical-align: inherit;">来确定是否记录
             </font></font><code class="literal">general</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font><code class="literal">status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该用户是使用事件中的字段构造的。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下列表描述了</font></font><code class="literal">function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font><font style="vertical-align: inherit;">允许的预定义功能</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">audit_log_exclude_accounts_is_null()</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                检查
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量是否</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">定义与旧版审计日志实施相对应的过滤器时，此功能会很有帮助。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                参数：
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">audit_log_include_accounts_is_null()</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                检查
                 </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量是否</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">定义与旧版审计日志实施相对应的过滤器时，此功能会很有帮助。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                参数：
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">debug_sleep(millisec)</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                睡觉给定的毫秒数。</font><font style="vertical-align: inherit;">在性能测量过程中使用此功能。
              </font></font></p><p>
                <code class="literal">debug_sleep()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 仅适用于调试版本。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">millisec</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：作为无符号整数睡眠的毫秒数。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">find_in_exclude_list(account)</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                检查审计日志排除列表中是否存在帐户字符串（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量</font><font style="vertical-align: inherit;">的值
                 </font><font style="vertical-align: inherit;">）。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">account</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用户帐户名称作为字符串。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">find_in_include_list(account)</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                检查审计日志包含列表中是否存在帐户字符串（</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量</font><font style="vertical-align: inherit;">的值
                 </font><font style="vertical-align: inherit;">）。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">account</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用户帐户名称作为字符串。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">string_find(text, substr)</code>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                检查</font></font><code class="literal">substr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是否包含在</font></font><code class="literal">text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值中。</font><font style="vertical-align: inherit;">此搜索区分大小写。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：要搜索的文本字符串。
                  </font></font></p></li><li class="listitem"><p>
                    <code class="literal">substr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：要搜索的子字符串</font></font><code class="literal">text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-filter-replacement"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替换用户过滤器</font></font></h6>
</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在某些情况下，过滤器定义可以动态更改。</font><font style="vertical-align: inherit;">为此，请</font></font><code class="literal">filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在现有</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">配置中</font><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">配置</font></font><code class="literal">filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “id”：“主”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “class”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “name”：“table_access”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “事件”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “name”：[“update”，“delete”]，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “log”：false，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “过滤器”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          “class”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “名称”：“一般”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “event”：{“name”：“status”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                        “filter”：{“ref”：“main”}}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          “启用”： {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “要么”： [</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              {“field”：{“name”：“table_name.str”，“value”：“temp_1”}}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              {“field”：{“name”：“table_name.str”，“value”：“temp_2”}}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当子过滤器中的</font></font><code class="literal">activate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素评估</font><font style="vertical-align: inherit;">时，将激活新的过滤器
             </font></font><code class="literal">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不允许</font></font><code class="literal">activate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在顶层
             </font><font style="vertical-align: inherit;">使用
             </font></font><code class="literal">filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过使用子</font></font><code class="literal">ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤器内的项目来引用原始过滤</font><font style="vertical-align: inherit;">器，可以将新过滤器替换</font><font style="vertical-align: inherit;">为原始过滤器</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            显示的过滤器如下操作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该</font></font><code class="literal">main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤器等待
                 </font></font><code class="literal">table_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的事件，无论是
                 </font></font><code class="literal">update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果</font></font><code class="literal">update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
                 </font></font><code class="literal">delete</code>
                <code class="literal">table_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件发生在
                 </font></font><code class="literal">temp_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">temp_2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                表上，过滤器被替换为内部过滤器（没有</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为没有必要明确指出它）。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果命令结束（</font></font><code class="literal">general</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code class="literal">status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                事件），则会将条目写入审核日志文件，并使用过滤器替换</font></font><code class="literal">main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                过滤器。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该过滤器用于记录更新或删除</font></font><code class="literal">temp_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">temp_2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">任何内容的语句</font><font style="vertical-align: inherit;">，例如：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE temp_1，temp_3 SET temp_1.a = 21，temp_3.a = 23;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该语句会生成多个
             </font></font><code class="literal">table_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件，但审计日志文件将仅包含</font></font><code class="literal">general</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/
             </font></font><code class="literal">status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义中使用的</font><font style="vertical-align: inherit;">
              任何</font><font style="vertical-align: inherit;">值均仅针对该定义进行评估。</font><font style="vertical-align: inherit;">它们与</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">的值无关
               </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-legacy-filtering"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.7传统模式审计日志过滤</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528110135136"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍旧版审计日志过滤，适用于以下任一情况：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在MySQL 5.7.13之前，也就是在</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering" title="6.5.5.6审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.6节“审计日志过滤”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍的基于规则的审计日志过滤之前
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从MySQL 5.7.13开始，如果</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              插件已安装，但没有附带的基于规则的过滤所需的审计表和UDF。
</font></font></p></li></ul>
</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        审计日志插件可以过滤审计的事件。</font><font style="vertical-align: inherit;">这使您可以根据事件发生的帐户或事件状态来控制审计事件是否写入审计日志文件。</font><font style="vertical-align: inherit;">状态过滤分别针对连接事件和语句事件发生。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-account-filtering" title="按帐户筛选事件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按帐户筛选事件</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-status-filtering" title="按状态筛选事件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按状态筛选事件</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="audit-log-account-filtering"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按帐户筛选事件</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要根据原始帐户过滤审核的事件，请在服务器启动或运行时设置其中一个系统变量：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：要包含在审计日志中的帐户。</font><font style="vertical-align: inherit;">如果设置了此变量，则只审计这些帐户。
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：要从审计日志中排除的帐户。</font><font style="vertical-align: inherit;">如果设置了此变量，则除审计这些帐户外的所有帐户。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          任一变量的值可以是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个包含一个或多个以逗号分隔的帐户名称的字符串，每个帐户名称的</font><font style="vertical-align: inherit;">
          格式</font><font style="vertical-align: inherit;">均为
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，这两个变量都是
           </font><font style="vertical-align: inherit;">，在这种情况下，不进行帐户过滤，并对所有帐户进行审计。
        </font></font><code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          仅影响</font><font style="vertical-align: inherit;">修改后
           </font><font style="vertical-align: inherit;">创建的连接，不影响现有连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          示例：要启用审核日志记录只为
           </font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="literal">user2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地主机帐户帐户，设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这样的系统变量：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL audit_log_include_accounts ='user1 @ localhost，user2 @ localhost';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          只有一个
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以不是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，服务器设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果尝试设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则会出现错误，除非
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，您必须先将</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              其设置为</font><font style="vertical-align: inherit;">清除
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 这将audit_log_exclude_accounts设置为NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL audit_log_include_accounts = </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 由于audit_log_include_accounts不为NULL而失败</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL audit_log_exclude_accounts = </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 要设置audit_log_exclude_accounts，请首先设置</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-  audit_log_include_accounts为NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL audit_log_include_accounts = NULL;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL audit_log_exclude_accounts = </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您检查任一变量的值，请注意
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-variables" title="13.7.5.39 SHOW VARIABLES语法"><code class="literal">SHOW VARIABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空字符串。</font><font style="vertical-align: inherit;">为了避免这种情况，请
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改用：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log_include_accounts';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_include_accounts | </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@audit_log_include_accounts;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ audit_log_include_accounts |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NULL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------ +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果用户名或主机名需要引用，因为它包含逗号，空格或其他特殊字符，请使用单引号引用它。</font><font style="vertical-align: inherit;">如果变量值本身用单引号括起来，则加倍每个内部单引号或用反斜杠将其转义。</font><font style="vertical-align: inherit;">以下声明各自为本地</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">启用审计日志记录，</font><font style="vertical-align: inherit;">并且是等同的，即使引用样式不同：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL audit_log_include_accounts ='root @ localhost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL audit_log_include_accounts ='''root''''localhost''';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL audit_log_include_accounts ='\'root \'@ \'localhost \'';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL audit_log_include_accounts =“'root'@'localhost'”;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">ANSI_QUOTES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">SQL模式，则</font><font style="vertical-align: inherit;">最后一条语句将不起作用，
           </font><font style="vertical-align: inherit;">因为在该模式下，双引号表示标识符引用，而不是字符串引用。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-status-filtering"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按状态筛选事件</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要根据状态过滤审核的事件，请在服务器启动或运行时设置以下系统变量。</font><font style="vertical-align: inherit;">这些变量仅适用于传统的审计日志过滤。</font><font style="vertical-align: inherit;">对于JSON审计日志过滤，应用不同的状态变量; </font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-options-variables" title="6.5.5.8.4审计日志选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.4节“审核日志选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：记录连接事件的策略
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：为语句事件记录策略
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个变量都取值为</font></font><code class="literal">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（记录所有相关事件;这是默认值），
           </font></font><code class="literal">ERRORS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（仅记录失败事件）或
           </font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不记录事件）。</font><font style="vertical-align: inherit;">例如，要记录所有语句事件但只记录失败的连接事件，请使用以下设置：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL audit_log_statement_policy = ALL;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL audit_log_connection_policy = ERRORS;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另一项政策系统变量，
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是可用的，但不提供尽可能多的控制，
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和
           </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它只能在服务器启动时设置。</font><font style="vertical-align: inherit;">在运行时，它是一个只读变量。</font><font style="vertical-align: inherit;">它取值为</font></font><code class="literal">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          （记录所有事件;这是默认值），
           </font></font><code class="literal">LOGINS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（日志连接事件），
           </font></font><code class="literal">QUERIES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（日志语句事件）或
           </font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不记录事件）。</font><font style="vertical-align: inherit;">对于任何这些值，审计日志插件都记录所有选定的事件，而不区分成功或失败。</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启动时</font><font style="vertical-align: inherit;">使用
           </font><font style="vertical-align: inherit;">如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您未设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或将其设置为其默认设置，则会</font><font style="vertical-align: inherit;">
              按照指定</font></font><code class="literal">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行任何显式设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              或
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用。</font><font style="vertical-align: inherit;">如果未指定，则默认为
               </font></font><code class="literal">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为一个非</font></font><code class="literal">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，该值优于并可用于设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下表所示。</font><font style="vertical-align: inherit;">如果您还将这些变量中的任何一个设置为默认值以外的值</font></font><code class="literal">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则服务器会将消息写入错误日志以指示其值正在被覆盖。
</font></font></p>
<div class="informaltable">
<table summary="How the server uses audit_log_policy to set audit_log_connection_policy and audit_log_statement_policy at startup."><colgroup><col width="33%"><col width="33%"><col width="33%"></colgroup><thead><tr>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动audit_log_policy值</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的audit_log_connection_policy值</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的audit_log_statement_policy值</font></font></th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">LOGINS</code></td>
                  <td><code class="literal">ALL</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">QUERIES</code></td>
                  <td><code class="literal">NONE</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">NONE</code></td>
                  <td><code class="literal">NONE</code></td>
                  <td><code class="literal">NONE</code></td>
</tr></tbody></table>
</div>
</li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.8审计日志参考</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下讨论可作为MySQL企业审计组件的参考：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-tables" title="6.5.5.8.1审计日志表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.1节“审核日志表”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-routines" title="6.5.5.8.2审计日志功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.2节“审核日志功能”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-option-variable-reference" title="6.5.5.8.3审计日志选项和变量引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.3节“审核日志选项和变量参考”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-options-variables" title="6.5.5.8.4审计日志选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.4节“审核日志选项和变量”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-status-variables" title="6.5.5.8.5审计日志状态变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.8.5节“审核日志状态变量”</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要安装审计日志表和函数，请使用
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-installation" title="6.5.5.2安装或卸载MySQL企业审计"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.2节“安装或卸载MySQL企业审计”中提供的说明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非安装了这些组件，否则</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插件将以传统模式运行。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“传统模式审计日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.8.1审计日志表</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业审计使用</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库中的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">来永久存储过滤器和用户帐户数据。</font><font style="vertical-align: inherit;">这些表只能由具有该数据库特权的用户访问。</font><font style="vertical-align: inherit;">这些表使用
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎（</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL 5.7.21之前）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果缺少这些表格，</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插件将以传统模式运行。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“传统模式审计日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">audit_log_filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表存储过滤器定义。</font><font style="vertical-align: inherit;">该表具有以下列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NAME</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              过滤器名称。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">FILTER</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与过滤器名称关联的过滤器定义。</font><font style="vertical-align: inherit;">定义被存储为
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">audit_log_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表存储用户帐户信息。</font><font style="vertical-align: inherit;">该表具有以下列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USER</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              帐户的用户名部分。</font><font style="vertical-align: inherit;">对于一个帐户
               </font></font><code class="literal">user1@localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该
               </font></font><code class="literal">USER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分是</font></font><code class="literal">user1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">HOST</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              帐户的主机名部分。</font><font style="vertical-align: inherit;">对于一个帐户
               </font></font><code class="literal">user1@localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该
               </font></font><code class="literal">HOST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分是
               </font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">FILTERNAME</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              分配给帐户的过滤器的名称。</font><font style="vertical-align: inherit;">过滤器名称将帐户与</font></font><code class="literal">audit_log_filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">定义的过滤器相关联
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-routines"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.8.2审计日志功能</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节描述了每个审计日志用户定义函数（UDF）的用途，调用顺序和返回值。</font><font style="vertical-align: inherit;">有关可以调用这些UDF的条件的信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering" title="6.5.5.6审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.6节“审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个审计日志UDF都返回</font><font style="vertical-align: inherit;">
          失败的</font></font><code class="literal">OK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功
           </font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">ERROR: <em class="replaceable"><code>message</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些审计日志UDF可用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_encryption_password_get()</code>
            </p><a class="indexterm" name="idm140528109982832"></a><a class="indexterm" name="idm140528109981712"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              以二进制字符串形式检索当前审核日志加密密码。</font><font style="vertical-align: inherit;">密码是从MySQL密钥环中获取的，必须启用或发生错误。</font><font style="vertical-align: inherit;">任何钥匙圈插件都可以使用; </font><font style="vertical-align: inherit;">有关说明，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring" title="6.5.4 MySQL Keyring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4节“MySQL Keyring”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关审计日志加密的其他信息，请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-encryption" title="审计日志文件加密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件加密</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING audit_log_encryption_password_get（）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              成功密码字符串（最多766字节），或者
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_encryption_password_get();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_encryption_password_get（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">秘密|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">audit_log_encryption_password_set()</code>
            </p><a class="indexterm" name="idm140528109969904"></a><a class="indexterm" name="idm140528109968784"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              设置审计日志加密密码并将其存储在MySQL密钥环中，该密钥环必须启用或发生错误。</font><font style="vertical-align: inherit;">任何钥匙圈插件都可以使用; </font><font style="vertical-align: inherit;">有关说明，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#keyring" title="6.5.4 MySQL Keyring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.4节“MySQL Keyring”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关审计日志加密的其他信息，请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-encryption" title="审计日志文件加密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件加密</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTEGER audit_log_encryption_password_set（）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              密码字符串。</font><font style="vertical-align: inherit;">最大允许长度是766字节。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1表示成功，0表示失败。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_encryption_password_set(<em class="replaceable"><code>password</code></em>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_encryption_password_set（</font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">audit_log_filter_flush()</code>
            </p><a class="indexterm" name="idm140528109956848"></a><a class="indexterm" name="idm140528109955744"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              调用任何其他过滤UDF会立即影响操作审核日志过滤并更新审核日志表。</font><font style="vertical-align: inherit;">相反，如果你修改这些表的内容，直接使用语句，例如
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所做的更改不会影响立即过滤。</font><font style="vertical-align: inherit;">要刷新您的更改并使其可用，请致电
               </font></font><code class="literal">audit_log_filter_flush()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p>
              <code class="literal">audit_log_filter_flush()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会影响当前的所有会话并将它们从以前的过滤器中分离出来 </font><font style="vertical-align: inherit;">当前会话不会被记录，除非它们断开并重新连接，或执行更改用户操作。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果此函数失败，则会返回错误消息，直到下一次成功调用为止，审计日志才会被禁用</font></font><code class="literal">audit_log_filter_flush()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING audit_log_filter_flush（）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p>
              <code class="literal">OK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为成功</font><font style="vertical-align: inherit;">而失败。
            </font></font><code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_filter_flush();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_filter_flush（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">audit_log_filter_remove_filter()</code>
            </p><a class="indexterm" name="idm140528109937808"></a><a class="indexterm" name="idm140528109936688"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              给定一个过滤器名称，从当前的过滤器集合中删除过滤器。</font><font style="vertical-align: inherit;">这不是过滤器不存在的错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果将删除的过滤器分配给任何用户帐户，则这些用户将停止过滤（将其从</font></font><code class="literal">audit_log_user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">中删除
               </font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">终止过滤包括针对这些用户的任何当前会话：它们从过滤器分离并不再记录。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING audit_log_filter_remove_filter（STRING filter_name）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">filter_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：过滤器名称作为字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p>
              <code class="literal">OK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为成功</font><font style="vertical-align: inherit;">而失败。
            </font></font><code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_filter_remove_filter('SomeFilter');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_filter_remove_filter（'SomeFilter'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">audit_log_filter_remove_user()</code>
            </p><a class="indexterm" name="idm140528109923008"></a><a class="indexterm" name="idm140528109921904"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              给定用户帐户名称，导致用户不再分配给过滤器。</font><font style="vertical-align: inherit;">如果用户没有分配过滤器，则不会发生错误。</font><font style="vertical-align: inherit;">为用户过滤当前会话不受影响。</font><font style="vertical-align: inherit;">用户的新连接将使用默认帐户过滤器进行过滤（如果有），否则不会进行记录。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果名称是</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则该函数将删除用于任何没有明确分配过滤器的用户帐户的默认帐户过滤器。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING audit_log_filter_remove_user（STRING user_name）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">user_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用户帐户名称</font><font style="vertical-align: inherit;">
                  格式</font><font style="vertical-align: inherit;">为字符串
                   </font><font style="vertical-align: inherit;">，或</font><font style="vertical-align: inherit;">表示默认帐户。
</font></font><code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">%</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p>
              <code class="literal">OK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为成功</font><font style="vertical-align: inherit;">而失败。
            </font></font><code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_filter_remove_user('user1@localhost');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_filter_remove_user（'user1 @ localhost'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">audit_log_filter_set_filter()</code>
            </p><a class="indexterm" name="idm140528109906128"></a><a class="indexterm" name="idm140528109905024"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              给定过滤器名称和定义，将过滤器添加到当前的过滤器组。</font><font style="vertical-align: inherit;">如果过滤器已经存在并被任何当前会话使用，则这些会话将从过滤器分离并不再记录。</font><font style="vertical-align: inherit;">发生这种情况是因为新的过滤器定义具有与其以前的ID不同的新过滤器ID。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING audit_log_filter_set_filter（STRING filter_name，STRING定义）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">filter_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：过滤器名称作为字符串。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">definition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：将过滤器定义为</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p>
              <code class="literal">OK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为成功</font><font style="vertical-align: inherit;">而失败。
            </font></font><code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SET @f = '{ "filter": { "log": false } }';</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SELECT audit_log_filter_set_filter('SomeFilter', @f);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_filter_set_filter（'SomeFilter'，@f）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">audit_log_filter_set_user()</code>
            </p><a class="indexterm" name="idm140528109888992"></a><a class="indexterm" name="idm140528109887888"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              给定用户帐户名称和过滤器名称，将筛选器分配给用户。</font><font style="vertical-align: inherit;">用户只能分配一个过滤器，所以如果用户已经被分配了一个过滤器，那么分配将被替换。</font><font style="vertical-align: inherit;">为用户过滤当前会话不受影响。</font><font style="vertical-align: inherit;">新的连接使用新的过滤器进行过滤。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              作为特殊情况，名称</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              代表默认帐户。</font><font style="vertical-align: inherit;">该过滤器用于来自没有明确分配过滤器的任何用户帐户的连接。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING audit_log_filter_set_user（STRING user_name，STRING filter_name）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">user_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用户帐户名称</font><font style="vertical-align: inherit;">
                  格式</font><font style="vertical-align: inherit;">为字符串
                   </font><font style="vertical-align: inherit;">，或</font><font style="vertical-align: inherit;">表示默认帐户。
                </font></font><code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">%</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
                  <code class="literal">filter_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：过滤器名称作为字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p>
              <code class="literal">OK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为成功</font><font style="vertical-align: inherit;">而失败。
            </font></font><code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_filter_set_user('user1@localhost', 'SomeFilter');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ----------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_filter_set_user（'user1 @ localhost'，'SomeFilter'）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ----------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ----------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">audit_log_read()</code>
            </p><a class="indexterm" name="idm140528109870448"></a><a class="indexterm" name="idm140528109869344"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从审计日志中读取事件并返回</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含审计事件数组的</font><font style="vertical-align: inherit;">二进制
               </font><font style="vertical-align: inherit;">字符串。</font><font style="vertical-align: inherit;">如果审计日志格式不是
               </font></font><code class="literal">JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则会发生错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值中的每个事件都是
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列，但最后一个数组元素可能是一个
               </font><font style="vertical-align: inherit;">值，表示没有以下事件可供读取。
            </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
              <code class="literal">null</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              会话中</font><font style="vertical-align: inherit;">的第一次通话</font><font style="vertical-align: inherit;">，传递一个书签指示从何处开始阅读。</font><font style="vertical-align: inherit;">如果返回的数组的最终值不是一个</font><font style="vertical-align: inherit;">值，那么刚刚读取的事件之后会有更多事件，并且
               </font><font style="vertical-align: inherit;">可以在没有或带有书签参数的情况下调用它们。</font><font style="vertical-align: inherit;">没有争论，阅读继续下一个未读的事件。</font><font style="vertical-align: inherit;">通过书签参数，可以从书签继续阅读。
            </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
              <code class="literal">null</code><font style="vertical-align: inherit;"></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果返回数组的最终值是一个
               </font><font style="vertical-align: inherit;">值，则不会再有事件要读取，下一次调用
               </font><font style="vertical-align: inherit;">必须包含书签参数。
            </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
              <code class="literal">null</code><font style="vertical-align: inherit;"></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要获取最近写入的事件的书签，请致电</font></font><code class="literal">audit_log_read_bookmark()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关审计日志读取功能的其他信息，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-reading" title="审计日志文件读取"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件读取</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING audit_log_read（[STRING arg]）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
            </font></font></p><p>
              <code class="literal">arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：可选书签，表示为包含</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列</font><font style="vertical-align: inherit;">的字符串，该
               </font><font style="vertical-align: inherit;">散列指示阅读地点和阅读量。</font><font style="vertical-align: inherit;">以下项目在</font></font><code class="literal">arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值中</font><font style="vertical-align: inherit;">很重要</font><font style="vertical-align: inherit;">（其他项目被忽略）：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：要读取的第一个事件的审核日志中的位置。</font><font style="vertical-align: inherit;">这两个项目必须存在才能完全指定一个位置。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">max_array_length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：从日志中读取的最大事件数量。</font><font style="vertical-align: inherit;">如果省略，则默认为读取到日志末尾或直到读取缓冲区已满，以先到者为准。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含成功的审计事件数组的</font><font style="vertical-align: inherit;">
              二进制</font><font style="vertical-align: inherit;">字符串，或
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败的错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_read(audit_log_read_bookmark());</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_read（audit_log_read_bookmark（））|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">[{“timestamp”：“2018-01-15 22:41:24”，“id”：0，“class”：“连接”，... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- ---------------------- +</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">audit_log_read_bookmark()</code>
            </p><a class="indexterm" name="idm140528109835296"></a><a class="indexterm" name="idm140528109834192"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表示最近编写的审计日志事件的书签</font><font style="vertical-align: inherit;">的二进制</font><font style="vertical-align: inherit;">字符串。</font><font style="vertical-align: inherit;">如果审计日志格式不是
               </font></font><code class="literal">JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则会发生错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              书签是一个</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列，</font></font><code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中的
               </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目指示审核日志中的事件位置。</font><font style="vertical-align: inherit;">它适合于传递以
               </font></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示该功能从何处开始阅读。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关审计日志读取功能的其他信息，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-reading" title="审计日志文件读取"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件读取</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              句法：
            </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STRING audit_log_read_bookmark（）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参数：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              返回值：
            </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含成功书签的</font><font style="vertical-align: inherit;">
              二进制</font><font style="vertical-align: inherit;">字符串，
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及失败的错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT audit_log_read_bookmark();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_read_bookmark（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">{“timestamp”：“2018-01-15 21:03:44”，“id”：0} |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- +</font></font><font></font>
</pre></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-option-variable-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.8.3审计日志选项和变量引用</font></font></h5>

</div>

</div>

</div>

<div class="table">
<a name="idm140528109815936"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表6.32审计日志选项和变量引用</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Reference for audit log command-line options, system variables, and status variables."><colgroup><col width="20%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMD线</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项文件</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Var范围</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_audit-log"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_buffer_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_buffer_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_connection_policy</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_current_session"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_current_session</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_current_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit_log_current_size</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_event_max_drop_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit_log_event_max_drop_size</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_events"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit_log_events</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_events_filtered"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit_log_events_filtered</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_events_lost"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit_log_events_lost</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_events_written"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit_log_events_written</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_exclude_accounts</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_file</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_flush"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_flush</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_format</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_include_accounts</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_policy</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_rotate_on_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_statement_policy</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_strategy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audit_log_strategy</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_total_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit_log_total_size</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_write_waits"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit_log_write_waits</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-options-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.8.4审计日志选项和变量</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍控制MySQL企业审计操作的命令选项和系统变量。</font><font style="vertical-align: inherit;">如果启动时指定的值不正确，则
           </font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件可能无法正确初始化，并且服务器不会加载它。</font><font style="vertical-align: inherit;">在这种情况下，服务器也可能为其他审计日志设置生成错误消息，因为它不会识别它们。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制审计日志插件的激活，请使用以下选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_audit-log"></a>
              <a class="indexterm" name="idm140528109651104"></a>

              <a class="indexterm" name="idm140528109649648"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_audit-log"><code class="option">--audit-log[=<em class="replaceable"><code>value</code></em>]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit-log"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ON</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">FORCE</code></p><p class="valid-value"><code class="literal">FORCE_PLUS_PERMANENT</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该选项控制服务器</font></font><code class="literal">audit_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启动时</font><font style="vertical-align: inherit;">加载
               </font><font style="vertical-align: inherit;">插件的方式。</font><font style="vertical-align: inherit;">只有当插件先前已经注册</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL
              PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者已经加载
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
               </font><font style="vertical-align: inherit;">时才可用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-installation" title="6.5.5.2安装或卸载MySQL企业审计"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.2节“安装或卸载MySQL企业审计”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，选项值应该是可用于插件加载选项的选项值之一
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#option_mysqld_audit-log"><code class="option">--audit-log=FORCE_PLUS_PERMANENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              告诉服务器加载插件并防止服务器在运行时被删除。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果审计日志插件已启用，它会公开几个允许控制日志记录的系统变量：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------- + -------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------- + -------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_buffer_size | </font><font style="vertical-align: inherit;">1048576 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_connection_policy | </font><font style="vertical-align: inherit;">ALL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_current_session | </font><font style="vertical-align: inherit;">OFF |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_exclude_accounts | </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_file | </font><font style="vertical-align: inherit;">audit.log |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_filter_id | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_flush | </font><font style="vertical-align: inherit;">OFF |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_format | </font><font style="vertical-align: inherit;">新| |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_include_accounts | </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_policy | </font><font style="vertical-align: inherit;">ALL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_rotate_on_size | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_statement_policy | </font><font style="vertical-align: inherit;">ALL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">audit_log_strategy | </font><font style="vertical-align: inherit;">异步|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------------- + -------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以在服务器启动时设置这些变量中的任何一个，并在运行时设置其中一些变量 </font><font style="vertical-align: inherit;">那些仅适用于传统模式审计日志过滤的应用程序如此注意。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_audit_log_buffer_size"></a>
              <a class="indexterm" name="idm140528109610272"></a>

              <a class="indexterm" name="idm140528109609232"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_buffer_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-buffer-size=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709547520</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当审计日志插件异步地将事件写入日志时，它会在写入事件之前使用缓冲区来存储事件内容。</font><font style="vertical-align: inherit;">该变量控制该缓冲区的大小，以字节为单位。</font><font style="vertical-align: inherit;">服务器将值调整为4096的倍数。插件使用单个缓冲区，它在初始化时分配，在终止时分配。</font><font style="vertical-align: inherit;">仅当日志记录异步时，插件才会分配此缓冲区。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_compression"></a>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_compression"><code class="literal">audit_log_compression</code></a>
</p><a class="indexterm" name="idm140528109557056"></a><a class="indexterm" name="idm140528109556016"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_compression"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-compression=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_compression">audit_log_compression</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NONE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">NONE</code></p><p class="valid-value"><code class="literal">GZIP</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志文件的压缩类型。</font><font style="vertical-align: inherit;">允许的值是</font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不压缩;默认值）和</font></font><code class="literal">GZIP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（GNU Zip压缩）。</font><font style="vertical-align: inherit;">有关更多信息，请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-compression" title="审计日志文件压缩"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件压缩</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_connection_policy"></a>
              <a class="indexterm" name="idm140528109519792"></a>

              <a class="indexterm" name="idm140528109518688"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_connection_policy"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-connection-policy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ALL</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">ERRORS</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                此变量仅适用于旧式审核日志过滤（请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“旧式审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该策略控制审计日志插件如何将连接事件写入其日志文件。</font><font style="vertical-align: inherit;">下表显示了允许的值。
</font></font></p>
<div class="informaltable">
<table summary="Permitted values for the audit_log_connection_policy variable."><colgroup><col width="15%"><col width="85%"></colgroup><thead><tr>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">ALL</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录所有连接事件</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">ERRORS</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只记录失败的连接事件</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">NONE</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要记录连接事件</font></font></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在服务器启动时，</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还指定了</font><font style="vertical-align: inherit;">任何显式值，
                 </font><font style="vertical-align: inherit;">则可以重写
                 </font><font style="vertical-align: inherit;">，如
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_audit_log_current_session"></a>
              <a class="indexterm" name="idm140528109462464"></a>

              <a class="indexterm" name="idm140528109461360"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_current_session"><code class="literal">audit_log_current_session</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_current_session"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_current_session">audit_log_current_session</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">depends on filtering policy</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是否为当前会话启用审计日志记录。</font><font style="vertical-align: inherit;">此变量的会话值是只读的。</font><font style="vertical-align: inherit;">它是在会话开始基于该值设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量。</font><font style="vertical-align: inherit;">审计日志插件使用会话值来确定是否审计会话的事件。</font><font style="vertical-align: inherit;">（有一个全局值，但该插件不使用它。）
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_encryption"></a>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_encryption"><code class="literal">audit_log_encryption</code></a>
</p><a class="indexterm" name="idm140528109429248"></a><a class="indexterm" name="idm140528109428208"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_encryption"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-encryption=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_encryption">audit_log_encryption</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NONE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">NONE</code></p><p class="valid-value"><code class="literal">AES</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志文件的加密类型。</font><font style="vertical-align: inherit;">允许的值是</font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不加密;默认值）和</font></font><code class="literal">AES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（AES-256-CBC密码加密）。</font><font style="vertical-align: inherit;">有关更多信息，请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-encryption" title="审计日志文件加密"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件加密</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_exclude_accounts"></a>
              <a class="indexterm" name="idm140528109392032"></a>

              <a class="indexterm" name="idm140528109390928"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_exclude_accounts"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-exclude-accounts=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                此变量仅适用于旧式审核日志过滤（请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“旧式审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              不应记录事件的帐户。</font><font style="vertical-align: inherit;">该值应该是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含一个或多个逗号分隔帐户名称列表的字符串。</font><font style="vertical-align: inherit;">有关更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering" title="6.5.5.6审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.6节“审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              修改</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              仅影响</font><font style="vertical-align: inherit;">修改后
               </font><font style="vertical-align: inherit;">创建的连接，不影响现有连接。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_file"></a>
              <a class="indexterm" name="idm140528109355040"></a>

              <a class="indexterm" name="idm140528109353984"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_file"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-file=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file">audit_log_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">audit.log</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志插件写入事件的文件的基本名称和后缀。</font></font><code class="filename">audit.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论日志格式如何，</font><font style="vertical-align: inherit;">默认值都是
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要使名称后缀对应于格式，请明确设置名称，选择不同的后缀（例如，</font></font><code class="filename">audit.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于XML格式，
               </font></font><code class="filename">audit.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于JSON格式）。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果值
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个相对路径名，则该插件将相对于数据目录进行解释。</font><font style="vertical-align: inherit;">如果该值是完整路径名称，则该插件将按原样使用该值。</font><font style="vertical-align: inherit;">如果需要将审计文件放置在单独的文件系统或目录上，则完整路径名称可能很有用。</font><font style="vertical-align: inherit;">出于安全原因，审计日志文件应写入只能由MySQL服务器访问的目录，并且应该有合法理由查看日志。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关审计日志插件如何解释</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件初始化和终止时发生的文件重命名</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">值和规则的</font><font style="vertical-align: inherit;">详细信息
               </font><font style="vertical-align: inherit;">，请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-name" title="审核日志文件名称"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件名</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从MySQL 5.7.21开始，审计日志插件使用包含审计日志文件的目录（根据</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">确定</font><font style="vertical-align: inherit;">）作为搜索可读审计日志文件的位置。</font><font style="vertical-align: inherit;">从这些日志文件和当前文件中，插件构建了可用于审核日志书签和阅读功能的列表。</font><font style="vertical-align: inherit;">请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-reading" title="审计日志文件读取"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件读取</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_filter_id"></a>
              <a class="indexterm" name="idm140528109313200"></a>

              <a class="indexterm" name="idm140528109312160"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_filter_id"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.13</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_filter_id">audit_log_filter_id</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此变量的会话值指示当前会话的审核过滤器的内部维护标识。</font><font style="vertical-align: inherit;">值为0意味着会话没有分配过滤器。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_flush"></a>
              <a class="indexterm" name="idm140528109286512"></a>

              <a class="indexterm" name="idm140528109285504"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_flush"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_flush">audit_log_flush</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当此变量设置为启用（1或
               </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）时，审计日志插件关闭并重新打开其日志文件以刷新它。</font><font style="vertical-align: inherit;">（该值保持不变，
               </font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便在再次启用它以执行另一次刷新之前，不需要明确禁用它。）除非</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为0，</font><font style="vertical-align: inherit;">否则启用此变量不起作用。
               </font><font style="vertical-align: inherit;">有关更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审核日志记录控制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_format"></a>
              <a class="indexterm" name="idm140528109254096"></a>

              <a class="indexterm" name="idm140528109253088"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_format"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-format=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_format">audit_log_format</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.9）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.9）</font></font></td>
<td><code class="literal">NEW</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.21）</font></font></td>
<td><p class="valid-value"><code class="literal">OLD</code></p><p class="valid-value"><code class="literal">NEW</code></p><p class="valid-value"><code class="literal">JSON</code></p></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.9，&lt;= 5.7.20）</font></font></td>
<td><p class="valid-value"><code class="literal">OLD</code></p><p class="valid-value"><code class="literal">NEW</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志文件格式。</font><font style="vertical-align: inherit;">允许的值是
               </font></font><code class="literal">OLD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（旧式XML），
               </font></font><code class="literal">NEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（新式XML;默认值）和（从MySQL 5.7.21开始）</font></font><code class="literal">JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关每种格式的详细信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-formats" title="6.5.5.4审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.4节“审核日志文件格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                有关更改日志格式时要考虑的问题的信息，请参阅
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-format" title="审计日志文件格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审核日志文件格式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_audit_log_include_accounts"></a>
              <a class="indexterm" name="idm140528109207344"></a>

              <a class="indexterm" name="idm140528109206240"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_include_accounts"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-include-accounts=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                此变量仅适用于旧式审核日志过滤（请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“旧式审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              应记录事件的帐户。</font><font style="vertical-align: inherit;">该值应该是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含一个或多个逗号分隔帐户名称列表的字符串。</font><font style="vertical-align: inherit;">有关更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-filtering" title="6.5.5.6审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.6节“审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              修改</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              仅影响</font><font style="vertical-align: inherit;">修改后
               </font><font style="vertical-align: inherit;">创建的连接，不影响现有连接。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_policy"></a>
              <a class="indexterm" name="idm140528109170352"></a>

              <a class="indexterm" name="idm140528109169296"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_policy"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-policy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy">audit_log_policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ALL</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">LOGINS</code></p><p class="valid-value"><code class="literal">QUERIES</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                此变量仅适用于旧式审核日志过滤（请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“旧式审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该策略控制审计日志插件如何将事件写入其日志文件。</font><font style="vertical-align: inherit;">下表显示了允许的值。
</font></font></p>
<div class="informaltable">
<table summary="Permitted values for the audit_log_policy variable."><colgroup><col width="15%"><col width="85%"></colgroup><thead><tr>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">ALL</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录所有事件</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">LOGINS</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只记录登录事件</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">QUERIES</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅记录查询事件</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">NONE</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么都不记录（禁用审计流）</font></font></td>
</tr></tbody></table>
</div>
<p>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只能在服务器启动时设置。</font><font style="vertical-align: inherit;">在运行时，它是一个只读变量。</font><font style="vertical-align: inherit;">其他两个系统变量，
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              并
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供对日志策略的更好控制，并且可以在启动时或运行时进行设置。</font><font style="vertical-align: inherit;">如果您</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启动时</font><font style="vertical-align: inherit;">使用
               </font><font style="vertical-align: inherit;">而不是其他两个变量，则服务器使用其值来设置这些变量。</font><font style="vertical-align: inherit;">有关策略变量及其交互的更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_read_buffer_size"></a>
              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_read_buffer_size"><code class="literal">audit_log_read_buffer_size</code></a>
</p><a class="indexterm" name="idm140528109105648"></a><a class="indexterm" name="idm140528109104544"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_read_buffer_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-read-buffer-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21年7月5日</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_read_buffer_size">audit_log_read_buffer_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">524288</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">524288</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709547520</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从审计日志文件中读取的缓冲区大小（以字节为单位）。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">audit_log_read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数只读取这么多字节。</font><font style="vertical-align: inherit;">日志文件读取仅支持JSON日志记录格式。</font><font style="vertical-align: inherit;">有关更多信息，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-file-reading" title="审计日志文件读取"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件读取</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_rotate_on_size"></a>
              <a class="indexterm" name="idm140528109053936"></a>

              <a class="indexterm" name="idm140528109052832"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_rotate_on_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-rotate-on-size=N</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              值为0，则审计日志插件不执行自动日志文件旋转。</font><font style="vertical-align: inherit;">而是使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭并重新打开登录请求。</font><font style="vertical-align: inherit;">在这种情况下，请在刷新文件之前手动将文件外部重命名为服务器。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果该
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              值大于0，则会发生基于大小的自动日志文件旋转。</font><font style="vertical-align: inherit;">无论何时写入日志文件都会导致其大小超过该
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              值，审计日志插件将关闭当前日志文件，重命名该日志文件并打开新的日志文件。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关审计日志文件轮换的更多信息，请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-space-management" title="审计日志文件空间管理和名称轮换"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">审计日志文件空间管理和名称轮换</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果将此变量设置为不是4096倍数的值，则会将其截断为最接近的倍数。</font><font style="vertical-align: inherit;">（因此，将其设置为小于4096的值会将其设置为0，除手动外，不会发生旋转。）
            </font></font></p></li><li class="listitem"><p><a name="sysvar_audit_log_statement_policy"></a>
              <a class="indexterm" name="idm140528109014000"></a>

              <a class="indexterm" name="idm140528109012896"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_statement_policy"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-statement-policy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ALL</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">ERRORS</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                此变量仅适用于旧式审核日志过滤（请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-legacy-filtering" title="6.5.5.7传统模式审计日志过滤"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.7节“旧式审核日志过滤”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该策略控制审计日志插件如何将语句事件写入其日志文件。</font><font style="vertical-align: inherit;">下表显示了允许的值。
</font></font></p>
<div class="informaltable">
<table summary="Permitted values for the audit_log_statement_policy variable."><colgroup><col width="15%"><col width="85%"></colgroup><thead><tr>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">ALL</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录所有语句事件</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">ERRORS</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅记录失败的语句事件</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">NONE</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要记录声明事件</font></font></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在服务器启动时，</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还指定了</font><font style="vertical-align: inherit;">任何显式值，
                 </font><font style="vertical-align: inherit;">则可以重写
                 </font><font style="vertical-align: inherit;">，如
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_audit_log_strategy"></a>
              <a class="indexterm" name="idm140528108956704"></a>

              <a class="indexterm" name="idm140528108955664"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_strategy"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--audit-log-strategy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_strategy">audit_log_strategy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ASYNCHRONOUS</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">ASYNCHRONOUS</code></p><p class="valid-value"><code class="literal">PERFORMANCE</code></p><p class="valid-value"><code class="literal">SEMISYNCHRONOUS</code></p><p class="valid-value"><code class="literal">SYNCHRONOUS</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志插件使用的日志记录方法。</font><font style="vertical-align: inherit;">这些策略值是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">ASYNCHRONOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：异步记录。</font><font style="vertical-align: inherit;">等待输出缓冲区中的空间。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">PERFORMANCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：异步记录。</font><font style="vertical-align: inherit;">删除输出缓冲区中空间不足的请求。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">SEMISYNCHRONOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：同步记录。</font><font style="vertical-align: inherit;">允许操作系统进行缓存。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">SYNCHRONOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：同步记录。</font></font><code class="filename">sync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次请求后</font><font style="vertical-align: inherit;">打电话</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-status-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.8.5审计日志状态变量</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果审计日志插件已启用，它会公开几个提供操作信息的状态变量。</font><font style="vertical-align: inherit;">这些变量可用于遗留模式审计筛选和JSON模式审计筛选。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Audit_log_current_size"></a>
              <a class="indexterm" name="idm140528108908592"></a>

              <a class="indexterm" name="idm140528108907552"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_current_size"><code class="literal">Audit_log_current_size</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当前审计日志文件的大小。</font><font style="vertical-align: inherit;">事件写入日志时值增加，并且日志旋转时重置为0。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Audit_log_event_max_drop_size"></a>
              <a class="indexterm" name="idm140528108902960"></a>

              <a class="indexterm" name="idm140528108901856"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_event_max_drop_size"><code class="literal">Audit_log_event_max_drop_size</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              性能记录模式下最大的丢弃事件的大小。</font><font style="vertical-align: inherit;">有关日志记录模式的说明，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Audit_log_events"></a>
              <a class="indexterm" name="idm140528108896624"></a>

              <a class="indexterm" name="idm140528108895584"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_events"><code class="literal">Audit_log_events</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志插件处理的事件数量，不管它们是否根据过滤策略写入日志（请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Audit_log_events_filtered"></a>
              <a class="indexterm" name="idm140528108890352"></a>

              <a class="indexterm" name="idm140528108889248"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_events_filtered"><code class="literal">Audit_log_events_filtered</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              审计日志插件处理的事件数量，这些事件基于过滤策略进行了过滤（未写入日志）（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Audit_log_events_lost"></a>
              <a class="indexterm" name="idm140528108884048"></a>

              <a class="indexterm" name="idm140528108883008"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_events_lost"><code class="literal">Audit_log_events_lost</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于事件大于可用审计日志缓冲区空间，因此性能日志记录模式中丢失的事件数量。</font><font style="vertical-align: inherit;">此值可用于评估如何设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能模式的缓冲区大小。</font><font style="vertical-align: inherit;">有关日志记录模式的说明，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Audit_log_events_written"></a>
              <a class="indexterm" name="idm140528108876272"></a>

              <a class="indexterm" name="idm140528108875168"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_events_written"><code class="literal">Audit_log_events_written</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              写入审计日志的事件数量。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Audit_log_total_size"></a>
              <a class="indexterm" name="idm140528108870768"></a>

              <a class="indexterm" name="idm140528108869728"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_total_size"><code class="literal">Audit_log_total_size</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              写入所有审计日志文件的事件总大小。</font><font style="vertical-align: inherit;">不同的是
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_current_size"><code class="literal">Audit_log_current_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_total_size"><code class="literal">Audit_log_total_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              即使日志被旋转</font><font style="vertical-align: inherit;">，值
               </font><font style="vertical-align: inherit;">也会增加。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Audit_log_write_waits"></a>
              <a class="indexterm" name="idm140528108862608"></a>

              <a class="indexterm" name="idm140528108861568"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Audit_log_write_waits"><code class="literal">Audit_log_write_waits</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              事件在异步记录模式下必须在审计日志缓冲区中等待空间的次数。</font><font style="vertical-align: inherit;">有关日志记录模式的说明，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#audit-log-logging-control" title="6.5.5.5审计日志记录控制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.5.5节“审计日志记录控制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-restrictions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.5.9审计日志限制</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL企业审计受这些一般限制的约束：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            只有SQL语句被记录。</font><font style="vertical-align: inherit;">不会记录no-SQL API（例如memcached，Node.JS和NDB API）所做的更改。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            只记录顶级语句，而不是存储程序（如触发器或存储过程）中的语句。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由诸如此类的语句引用的文件的内容
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未被记录。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.21之前，MySQL企业审计使用
             </font><font style="vertical-align: inherit;">系统数据库中的</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表
             </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">组复制不支持</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。</font><font style="vertical-align: inherit;">因此，MySQL企业审计和组复制不能一起使用。
</font></font></p><a class="indexterm" name="idm140528108848000"></a><a class="indexterm" name="idm140528108846512"></a></li></ul>
</div>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDB群集。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以将MySQL企业审计与MySQL NDB集群一起使用，但需满足以下条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            所有要记录的更改必须使用SQL界面完成。</font><font style="vertical-align: inherit;">使用非SQL接口（例如由NDB API，memcached或ClusterJ提供的接口）的更改不会被记录。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该插件必须安装在每个用于在集群上执行SQL的MySQL服务器上。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            审核插件数据必须在群集中使用的所有MySQL服务器之间进行汇总。</font><font style="vertical-align: inherit;">这种聚合是应用程序或用户的责任。
</font></font></p></li></ul>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="firewall"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6 MySQL企业防火墙</font></font></h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#firewall-components"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.1 MySQL企业防火墙组件</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#firewall-installation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.2安装或卸载MySQL企业防火墙</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#firewall-usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.3使用MySQL企业防火墙</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/security.html#firewall-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.4 MySQL企业防火墙参考</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528108838720"></a><a class="indexterm" name="idm140528108837664"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL企业防火墙是MySQL企业版中的一个扩展，这是一个商业产品。</font><font style="vertical-align: inherit;">要了解有关商业产品的更多信息，请
         </font></font><a class="ulink" href="http://www.mysql.com/products/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问http://www.mysql.com/products/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL企业版包含MySQL企业防火墙，这是一种应用程序级防火墙，它允许数据库管理员根据与接受的语句模式的白名单进行匹配来允许或拒绝执行SQL语句。</font><font style="vertical-align: inherit;">这有助于强化MySQL服务器免受SQL注入等攻击，或尝试在合法查询工作负载特性之外使用它们。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个在防火墙注册的MySQL帐户都有自己的声明白名单，从而可以为每个帐户量身定制保护。</font><font style="vertical-align: inherit;">对于给定帐户，防火墙可以在录制，保护或检测模式下运行，以便在接受的语句模式下进行培训，主动防范不可接受的语句或被动检测不可接受的语句。</font><font style="vertical-align: inherit;">该图说明了防火墙如何在每种模式下处理传入语句。
</font></font></p>
<div class="figure">
<a name="firewall-diagram"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图6.1 MySQL企业防火墙操作</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/firewall-diagram-1.png" width="682" height="481" alt="显示MySQL企业防火墙在录制，保护和检测模式时如何处理传入SQL语句的流程图。">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下各节介绍MySQL企业防火墙的组件，讨论如何安装和使用它，并提供组件的参考信息。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-components"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.1 MySQL企业防火墙组件</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL企业级防火墙基于实现这些组件的插件库：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个名为服务器端的插件</font></font><code class="literal">MYSQL_FIREWALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在执行之前会检查SQL语句，并根据其内存中的高速缓存呈现是否执行或拒绝每个语句的决定。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器端插件命名
             </font></font><code class="literal">MYSQL_FIREWALL_USERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
             </font></font><code class="literal">MYSQL_FIREWALL_WHITELIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现
             </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，提供到防火墙数据缓存中的视图。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            名为</font></font><code class="literal">firewall_users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font><font style="vertical-align: inherit;">数据库</font></font><code class="literal">firewall_whitelist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的
             </font><font style="vertical-align: inherit;">系统表</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供持久的防火墙数据存储。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            存储过程命名
             </font></font><code class="literal">sp_set_firewall_mode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
             </font></font><code class="literal">sp_reload_firewall_rules()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行诸如向防火墙注册MySQL帐户，建立其操作模式以及管理缓存和底层系统表之间的防火墙数据传输等任务。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一组用户定义的函数为较低级别的任务提供SQL级别的API，例如将缓存与底层系统表同步。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量使防火墙配置和状态变量提供运行时操作信息。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.2安装或卸载MySQL企业防火墙</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528108807680"></a><a class="indexterm" name="idm140528108806208"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL企业防火墙安装是一次性操作，可以安装</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-components" title="6.5.6.1 MySQL企业防火墙组件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.1节“MySQL企业防火墙组件”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的</font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-components" title="6.5.6.1 MySQL企业防火墙组件"><font style="vertical-align: inherit;">组件</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可以使用图形界面或手动执行安装：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在Windows上，MySQL安装程序包含一个为您启用MySQL企业防火墙的选项。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL Workbench 6.3.4或更高版本可以安装MySQL企业防火墙，启用或禁用已安装的防火墙，或者卸载防火墙。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            手动安装MySQL企业防火墙包括运行位于</font></font><code class="filename">share</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL安装目录中</font><font style="vertical-align: inherit;">的脚本</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果安装，MySQL企业防火墙即使在禁用时也会涉及一些最小开销。</font><font style="vertical-align: inherit;">为了避免这种开销，除非您打算使用它，否则不要安装防火墙。
</font></font></p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业防火墙不能与查询缓存一起工作。</font><font style="vertical-align: inherit;">如果查询缓存已启用，请在安装防火墙之前将其禁用（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache-configuration" title="8.10.3.3查询缓存配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3.3节“查询缓存配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关使用说明，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-usage" title="6.5.6.3使用MySQL企业防火墙"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.3节“使用MySQL企业防火墙”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关参考信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-reference" title="6.5.6.4 MySQL企业防火墙参考"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.4节“MySQL企业防火墙参考”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-install" title="安装MySQL企业防火墙"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装MySQL企业防火墙</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-uninstall" title="卸载MySQL企业防火墙"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载MySQL企业防火墙</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="firewall-install"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装MySQL企业防火墙</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果MySQL Enterprise Firewall已经从旧版本的MySQL中安装，请使用本节后面给出的说明进行卸载，然后在安装当前版本之前重新启动服务器。</font><font style="vertical-align: inherit;">在这种情况下，还需要重新注册配置。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Windows上，您可以使用MySQL安装程序来安装MySQL企业防火墙，
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-installation-windows-installer" title="图6.2 Windows上的MySQL企业防火墙安装"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图6.2“Windows上的MySQL企业防火墙安装”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">选中</font></font><span class="guilabel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用企业防火墙</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          复选框。</font><font style="vertical-align: inherit;">（</font></font><span class="guilabel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于网络访问的开放防火墙端口</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有不同的目的，它指的是Windows防火墙，并控制Windows是否阻止MySQL服务器侦听客户端连接的TCP / IP端口。）
</font></font></p>
<div class="figure">
<a name="firewall-installation-windows-installer"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图6.2 Windows上的MySQL企业防火墙安装</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/firewall-windows-installer-option.png" width="801" height="602" alt="内容在周围文本中描述。">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用MySQL Workbench 6.3.4或更高版本安装MySQL企业防火墙，请参阅
           </font></font><a class="ulink" href="http://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL企业防火墙接口</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要手动安装MySQL Enterprise Firewall，请查看
           </font></font><code class="filename">share</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL安装目录并选择适合您平台的脚本。</font><font style="vertical-align: inherit;">可用的脚本在用于引用插件库文件的后缀中有所不同：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">win_install_firewall.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：为</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作文件名后缀的</font><font style="vertical-align: inherit;">Windows系统选择此脚本
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="filename">linux_install_firewall.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：选择此脚本用于Linux以及</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作文件名后缀的</font><font style="vertical-align: inherit;">类似系统
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          安装脚本在默认数据库中创建存储过程，因此请选择要使用的数据库。</font><font style="vertical-align: inherit;">然后按照以下步骤运行脚本，在命令行上命名选定的数据库。</font><font style="vertical-align: inherit;">这里的示例使用</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          数据库和Linux安装脚本。</font><font style="vertical-align: inherit;">为您的系统做适当的替换。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql -u root -p mysql &lt; linux_install_firewall.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码：</font></font><em class="replaceable"><code>(enter root password here)</code></em>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7.21开始，使用MySQL Enterprise Firewall的新安装
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替
             </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙表。</font><font style="vertical-align: inherit;">要升级已安装MySQL企业防火墙的安装，建议您更改防火墙表以使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE mysql.firewall_users ENGINE = InnoDB;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE mysql.firewall_whitelist ENGINE = InnoDB;</font></font><font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用图形界面或手动安装MySQL企业防火墙应启用防火墙。</font><font style="vertical-align: inherit;">要验证，请连接到服务器并执行以下语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW GLOBAL VARIABLES LIKE 'mysql_firewall_mode';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">mysql_firewall_mode | </font><font style="vertical-align: inherit;">ON |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- + ------- +</font></font><font></font>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="firewall-uninstall"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载MySQL企业防火墙</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业防火墙可以使用MySQL Workbench或手动卸载。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用MySQL Workbench 6.3.4或更高版本卸载MySQL企业防火墙，请参阅
           </font></font><a class="ulink" href="http://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL企业防火墙接口</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要手动卸载MySQL Enterprise Firewall，请执行以下语句。</font><font style="vertical-align: inherit;">假定存储过程是在</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">中创建的</font><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-procedure" title="13.1.27 DROP程序和DROP FUNCTION语法"><code class="literal">DROP PROCEDURE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果程序是在不同的数据库中创建的，则适当地</font><font style="vertical-align: inherit;">调整
           </font><font style="vertical-align: inherit;">陈述。
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP TABLE mysql.firewall_whitelist;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP TABLE mysql.firewall_users;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNINSTALL PLUGIN mysql_firewall;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNINSTALL PLUGIN mysql_firewall_whitelist;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNINSTALL PLUGIN mysql_firewall_users;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION set_firewall_mode;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION normalize_statement;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION read_firewall_whitelist;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION read_firewall_users;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP FUNCTION mysql_firewall_flush_status;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP PROCEDURE mysql.sp_set_firewall_mode;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP PROCEDURE mysql.sp_reload_firewall_rules;</font></font><font></font>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.3使用MySQL企业防火墙</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528108754016"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在使用MySQL企业防火墙之前，请按照</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-installation" title="6.5.6.2安装或卸载MySQL企业防火墙"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.2节“安装或卸载MySQL企业防火墙”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的说明进行</font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-installation" title="6.5.6.2安装或卸载MySQL企业防火墙"><font style="vertical-align: inherit;">安装</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此外，MySQL企业防火墙不能与查询缓存一起工作; </font><font style="vertical-align: inherit;">禁用查询缓存（如果已启用）（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache-configuration" title="8.10.3.3查询缓存配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3.3节“查询缓存配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何使用SQL语句配置MySQL企业防火墙。</font><font style="vertical-align: inherit;">或者，MySQL Workbench 6.3.4或更高版本为防火墙控制提供了一个图形界面。</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="ulink" href="http://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL企业防火墙接口</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要启用或禁用防火墙，请设置
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_mysql_firewall_mode"><code class="literal">mysql_firewall_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">默认情况下，在安装防火墙时启用此变量。</font><font style="vertical-align: inherit;">要明确控制初始防火墙状态，可以在服务器启动时设置变量。</font><font style="vertical-align: inherit;">例如，要在选项文件中启用防火墙，请使用以下这些行：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql_firewall_mode = ON</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在运行时也可以禁用或启用防火墙：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SET GLOBAL mysql_firewall_mode = OFF;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SET GLOBAL mysql_firewall_mode = ON;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        除了全局开/关防火墙模式之外，每个向防火墙注册的帐户都有自己的操作模式。</font><font style="vertical-align: inherit;">对于处于录制模式的帐户，防火墙会学习应用程序的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指纹</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即可接受的语句模式，它们一起构成白名单。</font><font style="vertical-align: inherit;">训练之后，将防火墙切换到保护模式，以强化MySQL，防止与指纹不同的语句访问。</font><font style="vertical-align: inherit;">要进行其他培训，请根据需要将防火墙切换回录制模式，以使用新语句模式更新白名单。</font><font style="vertical-align: inherit;">入侵检测模式可用于将可疑语句写入错误日志，但不会拒绝访问。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        防火墙在每个帐户的基础上保留白名单规则，从而实现如下保护策略：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于具有唯一保护要求的应用程序，请将其配置为使用不用于任何其他目的的帐户。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于相关和共享保护要求的应用程序，请将它们配置为一组以使用相同的帐户。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        防火墙操作基于将SQL语句转换为规范化的摘要格式。</font><font style="vertical-align: inherit;">防火墙摘要就像性能模式使用的语句摘要一样（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-statement-digests" title="25.9性能架构语句摘要"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.9节“性能架构语句摘要”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">然而，与性能模式不同，相关的摘要相关系统变量是
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_digest_length"><code class="literal">max_digest_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于来自注册帐户的连接，防火墙将每个传入语句转换为规范化表单并根据帐户模式进行处理：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在记录模式下，防火墙将规范化语句添加到帐户白名单规则。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在保护模式下，防火墙将规范化语句与帐户白名单规则进行比较。</font><font style="vertical-align: inherit;">如果匹配，则语句通过，服务器继续处理它。</font><font style="vertical-align: inherit;">否则，服务器拒绝该语句并向客户端返回错误。</font><font style="vertical-align: inherit;">如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">，防火墙还会将被拒绝的语句写入错误日志
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在检测模式下，防火墙会按照保护模式匹配语句，但会在不拒绝访问的情况下将不匹配的语句写入错误日志。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        具有</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙</font><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">或未注册防火墙的</font><font style="vertical-align: inherit;">帐户将</font><font style="vertical-align: inherit;">被忽略。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要使用MySQL企业防火墙保护帐户，请按照以下步骤操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            注册该帐户并将其置于录制模式。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用注册帐户连接到MySQL服务器并执行要学习的语句。</font><font style="vertical-align: inherit;">这将建立帐户的接受语句的白名单。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将注册帐户切换到保护模式。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下示例显示如何向防火墙注册帐户，使用防火墙来学习该帐户的可接受语句，并保护帐户免于执行不可接受的语句。</font><font style="vertical-align: inherit;">示例帐户
         </font></font><code class="literal">'fwuser'@'localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于访问</font></font><code class="literal">sakila</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中的</font><font style="vertical-align: inherit;">表的应用程序
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（该数据库位于</font></font><a class="ulink" href="http://dev.mysql.com/doc/index-other.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://dev.mysql.com/doc/index-other.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          帐户名称的用户和主机部分针对诸如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE
          USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和之类的</font><font style="vertical-align: inherit;">语句单独引用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而为了指定用于防火墙组件的帐户，将其命名为单引号字符串
           </font></font><code class="literal">'fwuser@localhost'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将帐户命名为防火墙组件的单引号字符串的约定意味着您不能使用</font></font><code class="literal">@</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在用户名</font><font style="vertical-align: inherit;">中包含嵌入</font><font style="vertical-align: inherit;">字符的</font><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用管理MySQL帐户执行以下过程中的步骤，但由防火墙注册的帐户指定的帐户除外。</font><font style="vertical-align: inherit;">默认数据库应该</font></font><code class="literal">sakila</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于使用注册帐户执行的语句。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如有必要，创建要保护的帐户（选择适当的密码）并授予</font></font><code class="literal">sakila</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">权限
             </font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE USER 'fwuser'@'localhost' IDENTIFIED BY 'fWp@3sw0rd';</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>GRANT ALL ON sakila.* TO 'fwuser'@'localhost';</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><code class="literal">sp_set_firewall_mode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储过程向防火墙注册帐户并将其置于录制模式（如果该过程位于数据库以外的其他数据库中</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则相应地调整该语句）：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'RECORDING');</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在执行过程中，存储过程会调用防火墙用户定义的函数，这些函数可能会产生自己的输出。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用注册的帐户，连接到服务器，然后执行一些合法的语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = 1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>UPDATE rental SET return_date = NOW() WHERE rental_id = 1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SELECT get_customer_balance(1, NOW());</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            防火墙将这些语句转换为摘要表单并将它们记录在帐户白名单中。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              直到帐户在录制模式下执行语句，其白名单才为空，相当于</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拒绝全部”。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果切换到保护模式，帐户将被有效禁止执行语句。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此时，用户和白名单信息被缓存，并可以在防火墙</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">看到
             </font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT MODE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code></strong>
       <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MODE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">录制|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT RULE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code></strong>
       <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">RULE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SELECT`first_name`，`last_name` FROM`customer` WHERE`customer_id` =？</font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SELECT`get_customer_balance`（？，NOW（））|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">UPDATE`rental` SET`return_date` = NOW（）WHERE`rental_id` =？</font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SELECT @@`version_comment` LIMIT？</font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------------- +</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">@@version_comment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则来自于</font><font style="vertical-align: inherit;">当您以注册用户身份连接到服务器时</font><font style="vertical-align: inherit;">由</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">自动发送的语句
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在符合应用程序使用的条件下训练防火墙很重要。</font><font style="vertical-align: inherit;">例如，给定的MySQL连接器可能在连接开始时向服务器发送语句以确定服务器特性和功能。</font><font style="vertical-align: inherit;">如果通过该连接器正常使用应用程序，则也可以使用这种方式训练防火墙。</font><font style="vertical-align: inherit;">这使得这些初始语句成为与应用程序关联的帐户的白名单的一部分。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用存储过程将注册用户切换到保护模式：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'PROTECTING');</code></strong>
</pre>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将帐户切换为</font></font><code class="literal">RECORDING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              模式将其防火墙缓存数据同步到底层</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库表以进行永久存储。</font><font style="vertical-align: inherit;">如果您没有为正在录制的用户切换模式，则高速缓存的白名单数据不会写入系统表，并且在重新启动服务器时会丢失。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用注册账户，执行一些可接受和不可接受的声明。</font><font style="vertical-align: inherit;">防火墙将每个防火墙与白名单进行匹配，并接受或拒绝该白名单。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该声明与培训陈述不同，但与其中一个声明产生相同的规范化陈述，因此防火墙接受它：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = '48';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ----------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">first_name | </font><font style="vertical-align: inherit;">last_name |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ----------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ANN | </font><font style="vertical-align: inherit;">EVANS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ----------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些语句与白名单中的任何内容都不匹配，并且每个语句都会导致错误：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = 1 OR TRUE;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1045（28000）：语句被防火墙阻止</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1045（28000）：语句被防火墙阻止</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>TRUNCATE TABLE mysql.slow_log;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1045（28000）：语句被防火墙阻止</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">，防火墙还会将拒绝的语句写入错误日志
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[注] MYSQL_FIREWALL插件报道：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'访问被拒绝fwuser @ localhost。</font><font style="vertical-align: inherit;">原因：白名单中没有匹配项。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声明：TRUNCATE TABLE'mysql`。</font><font style="vertical-align: inherit;">`slow_log`'</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以使用这些日志消息来确定攻击的来源。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以将不匹配的语句记录为可疑，而不会拒绝访问。</font><font style="vertical-align: inherit;">为此，请将帐户置入入侵检测模式：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'DETECTING');</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用注册帐户连接到服务器，然后执行与白名单不匹配的语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Tables_in_sakila（客户％）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">客户|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">customer_list |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------ +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在检测模式下，防火墙允许执行不匹配的语句，但将消息写入错误日志：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[注] MYSQL_FIREWALL插件报道：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
''fwuser @ localhost'的可疑声明。</font><font style="vertical-align: inherit;">原因：白名单中没有匹配项。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
声明：SHOW TABLES LIKE？</font><font style="vertical-align: inherit;">“</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要评估防火墙活动，请检查其状态变量：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Firewall%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Firewall_access_denied | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Firewall_access_granted | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Firewall_access_suspicious | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Firewall_cached_entries | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- + ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些变量分别表示被拒绝，接受，记录为可疑并被添加到缓存中的语句的数量。</font><font style="vertical-align: inherit;">该
             </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Firewall_access_granted"><code class="literal">Firewall_access_granted</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            数是4，因为中
             </font></font><code class="literal">@@version_comment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过发送声明
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你们每个人都用它来连接为注册用户三个时间客户端，再加上
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-tables" title="13.7.5.37 SHOW TABLES语法"><code class="literal">SHOW TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是不会被阻止在声明</font></font><code class="literal">DETECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果需要对帐户进行额外培训，请再次将其切换到录制模式，然后在执行要添加到白名单中的语句后返回到保护模式。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.4 MySQL企业防火墙参考</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下讨论可作为MySQL企业防火墙组件的参考：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-tables" title="6.5.6.4.1 MySQL企业防火墙表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.4.1节“MySQL企业防火墙表”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-routines" title="6.5.6.4.2 MySQL企业防火墙程序和功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.4.2节“MySQL企业防火墙过程和函数”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-system-variables" title="6.5.6.4.3 MySQL企业防火墙系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.4.3节“MySQL企业防火墙系统变量”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-status-variables" title="6.5.6.4.4 MySQL企业防火墙状态变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.4.4节“MySQL企业防火墙状态变量”</font></font></a>
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.4.1 MySQL企业防火墙表</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业防火墙维护帐户和白名单信息。</font><font style="vertical-align: inherit;">它使用
           </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表来提供缓存数据的视图，以及</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统数据库中的</font><font style="vertical-align: inherit;">表，</font><font style="vertical-align: inherit;">以永久形式存储这些数据。</font><font style="vertical-align: inherit;">启用时，防火墙将其操作决策基于缓存数据。
        </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何人都可以访问</font><font style="vertical-align: inherit;">
          这些</font><font style="vertical-align: inherit;">表格。</font><font style="vertical-align: inherit;">这些</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表只能由具有该数据库特权的用户访问。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><code class="literal">INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          与</font></font><code class="literal">mysql.firewall_users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表列表中注册的防火墙账户和他们的操作模式。</font><font style="vertical-align: inherit;">这些表格有这些列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在防火墙上注册的帐户。</font><font style="vertical-align: inherit;">每个帐户都有格式，
               </font><font style="vertical-align: inherit;">
              并代表服务器验证的实际用户名和主机名。</font><font style="vertical-align: inherit;">注册用户时不应使用模式和网络掩码。
            </font></font><code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <code class="literal">MODE</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              帐户当前的防火墙操作模式。</font><font style="vertical-align: inherit;">允许的模式值</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">DETECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">PROTECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">RECORDING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><code class="literal">RESET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关其含义的详细信息，请参阅的描述
               </font></font><code class="literal">sp_set_firewall_mode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
               </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-routines" title="6.5.6.4.2 MySQL企业防火墙程序和功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.4.2，“MySQL企业防火墙程序和功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在
           </font></font><code class="literal">INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          与</font></font><code class="literal">mysql.firewall_whitelist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表列表中注册的防火墙账户和他们的白名单。</font><font style="vertical-align: inherit;">这些表格有这些列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在防火墙上注册的帐户。</font><font style="vertical-align: inherit;">格式与用户帐户表格相同。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">RULE</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              标准化语句表示帐户可接受的语句模式。</font><font style="vertical-align: inherit;">帐户白名单是其规则的联合。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-routines"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.4.2 MySQL企业防火墙程序和功能</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业防火墙存储了执行任务的过程，例如向防火墙注册MySQL帐户，建立其操作模式以及管理缓存与底层系统表之间的防火墙数据传输。</font><font style="vertical-align: inherit;">它还具有一组用户定义的函数（UDF），为较低级别的任务提供SQL级别的API，例如将缓存与底层系统表同步。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在正常操作下，存储过程实现用户界面。</font><font style="vertical-align: inherit;">UDF由存储过程调用，而不是由用户直接调用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在默认数据库不是包含该过程的数据库时调用存储过程，请使用数据库名称限定过程名称。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CALL mysql.sp_set_firewall_mode（</font></font><em class="replaceable"><code>user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>mode</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下列表描述了每个防火墙存储过程和UDF：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">sp_reload_firewall_rules(<em class="replaceable"><code>user</code></em>)</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此存储过程使用防火墙UDF重置已注册的帐户，并从存储在</font></font><code class="literal">mysql.firewall_whitelist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的规则中重新载入它的内存中规则
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此过程可控制个人帐户的防火墙操作。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><em class="replaceable"><code>user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数名受影响的帐户，作为一个字符串
               </font><font style="vertical-align: inherit;">
              格式。
            </font></font><code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CALL mysql.sp_reload_firewall_rules（'fwuser @ localhost'）;
</font></font></pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                此过程将帐户模式设置为
                 </font></font><code class="literal">RESET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，清除帐户白名单并将其模式设置为</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果帐号模式不在</font><font style="vertical-align: inherit;">
                呼叫</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前，</font></font><code class="literal">sp_reload_firewall_rules()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请</font></font><code class="literal">sp_set_firewall_mode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在重新加载规则后</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">该模式恢复其先前的模式。</font><font style="vertical-align: inherit;">例如，如果帐户处于
                 </font></font><code class="literal">PROTECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式，那么在调用后不再是真实的，
                 </font></font><code class="literal">sp_reload_firewall_rules()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且您必须将其</font></font><code class="literal">PROTECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确</font><font style="vertical-align: inherit;">设置为</font><font style="vertical-align: inherit;">再次。
</font></font></p>
</div>
</li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该存储过程向防火墙注册一个MySQL帐户并建立其操作模式。</font><font style="vertical-align: inherit;">该过程还根据需要调用防火墙UDF以在缓存和底层系统表之间传输防火墙数据。</font><font style="vertical-align: inherit;">即使</font></font><code class="literal">mysql_firewall_mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量为</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">也可以调用此过程</font><font style="vertical-align: inherit;">，但在禁用防火墙时设置帐户的模式不起作用。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><em class="replaceable"><code>user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数名受影响的帐户，作为一个字符串
               </font><font style="vertical-align: inherit;">
              格式。
            </font></font><code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这</font></font><em class="replaceable"><code>mode</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用户的操作模式，作为一个字符串。</font><font style="vertical-align: inherit;">这些模式值是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：为该帐户禁用防火墙。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">DETECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：入侵检测模式：将可疑（不匹配）语句写入错误日志，但不拒绝访问。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">PROTECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：通过将传入语句与帐户白名单进行匹配来保护帐户。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">RECORDING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：培训模式：记录帐户的可接受语句。</font><font style="vertical-align: inherit;">记录不会立即失败并带有语法错误的传入语句成为帐户白名单规则的一部分。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">RESET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：清除帐户白名单并将帐户模式设置为</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将帐户的模式切换到任何模式，但
               </font></font><code class="literal">RECORDING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将防火墙高速缓存数据同步到底层</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统数据库表以进行永久存储。</font><font style="vertical-align: inherit;">切换模式</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以
               </font></font><code class="literal">RECORDING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将白名单从</font></font><code class="literal">mysql.firewall_whitelist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">重新加载</font><font style="vertical-align: inherit;">到缓存中。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果某个帐户有一个空的白名单，</font></font><code class="literal">PROTECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请将</font><font style="vertical-align: inherit;">其模式设置为
               </font><font style="vertical-align: inherit;">生成在结果集中返回但不是SQL错误的错误消息：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('a@b','PROTECTING');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">set_firewall_mode（arg_userhost，arg_mode）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">错误：为@ b请求的保护模式，但白名单为空。</font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------------- --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.02秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.02秒）</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">mysql_firewall_flush_status()</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该UDF将几个防火墙状态变量重置为0：
            </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firewall_access_denied</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Firewall_access_granted</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Firewall_access_suspicious</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mysql_firewall_flush_status（）;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">normalize_statement(<em class="replaceable"><code>stmt</code></em>)</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此UDF将SQL语句标准化为用于白名单规则的摘要格式。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT normalize_statement（'SELECT * FROM t1 WHERE c1&gt; 2'）;
</font></font></pre></li><li class="listitem"><p>
              <code class="literal">read_firewall_users(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此集合UDF通过</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上的语句
               </font><font style="vertical-align: inherit;">更新防火墙用户缓存</font></font><code class="literal">mysql.firewall_users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT read_firewall_users（'fwuser @ localhost'，'RECORDING'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM mysql.firewall_users;</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">read_firewall_whitelist(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>rule</code></em>)</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此集合UDF通过</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上的
               </font><font style="vertical-align: inherit;">语句更新记录的语句高速缓存</font></font><code class="literal">mysql.firewall_whitelist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT read_firewall_whitelist（'fwuser @ localhost'，'RECORDING'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM mysql.firewall_whitelist;</font></font><font></font>
</pre></li><li class="listitem"><p>
              <code class="literal">set_firewall_mode(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该UDF管理用户缓存并建立用户操作模式。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT set_firewall_mode（'fwuser @ localhost'，'RECORDING'）;
</font></font></pre></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-system-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.4.3 MySQL企业防火墙系统变量</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业防火墙支持以下系统变量。</font><font style="vertical-align: inherit;">使用它们来配置防火墙操作。</font><font style="vertical-align: inherit;">除非安装了防火墙，否则这些变量不可用（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-installation" title="6.5.6.2安装或卸载MySQL企业防火墙"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.2节“安装或卸载MySQL企业防火墙”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_mysql_firewall_mode"></a>
              <a class="indexterm" name="idm140528108552272"></a>

              <a class="indexterm" name="idm140528108551232"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_mysql_firewall_mode"><code class="literal">mysql_firewall_mode</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for mysql_firewall_mode"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--mysql-firewall-mode={OFF|ON}</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_mysql_firewall_mode">mysql_firewall_mode</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是否启用MySQL企业防火墙（默认）或禁用。
            </font></font></p></li><li class="listitem"><p><a name="sysvar_mysql_firewall_trace"></a>
              <a class="indexterm" name="idm140528108520368"></a>

              <a class="indexterm" name="idm140528108519328"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for mysql_firewall_trace"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--mysql-firewall-trace={OFF|ON}</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_mysql_firewall_trace">mysql_firewall_trace</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL企业防火墙跟踪是启用还是禁用（默认）。</font><font style="vertical-align: inherit;">当
               </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用时，为</font></font><code class="literal">PROTECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式，防火墙写入拒绝语句错误日志。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-status-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.6.4.4 MySQL企业防火墙状态变量</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL企业防火墙支持以下状态变量。</font><font style="vertical-align: inherit;">使用它们获取有关防火墙运行状态的信息。</font><font style="vertical-align: inherit;">除非安装了防火墙，否则这些变量不可用（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-installation" title="6.5.6.2安装或卸载MySQL企业防火墙"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.2节“安装或卸载MySQL企业防火墙”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">无论何时</font></font><code class="literal">MYSQL_FIREWALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装插件或服务器启动，</font><font style="vertical-align: inherit;">防火墙状态变量都将设置为0
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们中的很多都被</font></font><code class="literal">mysql_firewall_flush_status()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDF </font><font style="vertical-align: inherit;">重置为零
           </font><font style="vertical-align: inherit;">（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#firewall-routines" title="6.5.6.4.2 MySQL企业防火墙程序和功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.5.6.4.2节“MySQL企业级防火墙过程和函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Firewall_access_denied"></a>
              <a class="indexterm" name="idm140528108481008"></a>

              <a class="indexterm" name="idm140528108479968"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Firewall_access_denied"><code class="literal">Firewall_access_denied</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL企业防火墙拒绝的语句数量。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Firewall_access_granted"></a>
              <a class="indexterm" name="idm140528108475472"></a>

              <a class="indexterm" name="idm140528108474432"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Firewall_access_granted"><code class="literal">Firewall_access_granted</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL企业防火墙接受的语句数量。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Firewall_access_suspicious"></a>
              <a class="indexterm" name="idm140528108469888"></a>

              <a class="indexterm" name="idm140528108468784"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Firewall_access_suspicious"><code class="literal">Firewall_access_suspicious</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于处于</font></font><code class="literal">DETECTING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式的</font><font style="vertical-align: inherit;">用户，MySQL Enterprise Firewall记录的语句数量可疑</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="statvar_Firewall_cached_entries"></a>
              <a class="indexterm" name="idm140528108463424"></a>

              <a class="indexterm" name="idm140528108462384"></a>

              <a class="link" href="/mysql-5.7-google-zh/security.html#statvar_Firewall_cached_entries"><code class="literal">Firewall_cached_entries</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL企业防火墙记录的语句数量，包括重复数据。
</font></font></p></li></ul>
</div>

</div>

</div>

</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tbody><tr>
<td width="40%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/server-administration.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a></td>
<td width="20%" align="center"><a accesskey="u" href="/mysql-5.7-google-zh/security.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向上</font></font></a></td>
<td width="40%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/backup-and-recovery.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章MySQL服务器管理</font></font></td>
<td width="20%" align="center"><a accesskey="h" href="/mysql-5.7-google-zh/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家</font></font></a></td>
<td width="40%" align="right" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7章备份和恢复</font></font></td>
</tr>
</tbody></table>
</div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./images/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>