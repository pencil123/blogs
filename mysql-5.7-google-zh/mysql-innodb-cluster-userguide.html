<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0079)/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>第20章InnoDB集群</title>
<link rel="stylesheet" href="./mysql-innodb-cluster-userguide_files/mvl.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
<link rel="start" href="/mysql-5.7-google-zh/index.html" title="{书名}">
<link rel="up" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html" title="">
<link rel="prev" href="/mysql-5.7-google-zh/document-store.html" title="第19章使用MySQL作为文档存储">
<link rel="next" href="/mysql-5.7-google-zh/mysql-cluster.html" title="Chapter 21 MySQL NDB Cluster 7.5 and NDB Cluster 7.6">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./mysql-innodb-cluster-userguide_files/translateelement.css"></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tbody><tr>
<th colspan="3" align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20章InnoDB集群</font></font></th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/document-store.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a>&nbsp;</td>
<th width="60%" align="center"></th>
<td width="20%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/mysql-cluster.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
</tbody></table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="mysql-innodb-cluster-userguide"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20章InnoDB集群</font></font></h1>

</div>

</div>

</div>
<div class="toc">
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></b></p><dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-introduction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.1 InnoDB集群简介</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-creating"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2创建InnoDB集群</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-deployment-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.1部署方案</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-requirements"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.2 InnoDB集群要求</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-methods-installing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.3安装方法</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.4 InnoDB集群的沙箱部署</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.5 InnoDB集群的生产部署</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-from-group-replication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.6采用组复制部署</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-using-router"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.3在InnoDB集群中使用MySQL路由器</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-working-with-cluster"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.4使用InnoDB集群</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-limitations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.5已知限制</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本章介绍MySQL InnoDB集群，它结合了MySQL技术，使您能够创建高度可用的MySQL服务器实例集群。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-introduction"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.1 InnoDB集群简介</font></font></h2>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL InnoDB集群为MySQL提供了一个完整的高可用性解决方案。
      </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-shell.html" title="第18章MySQL Shell用户指南"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Shell</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含AdminAPI，它使您可以轻松配置和管理一组至少三个MySQL服务器实例，以充当InnoDB集群。</font><font style="vertical-align: inherit;">每个MySQL服务器实例都运行MySQL组复制，它提供了在InnoDB集群中复制数据的机制，并具有内置的故障转移功能。</font><font style="vertical-align: inherit;">AdminAPI不需要直接处理InnoDB集群中的组复制，但是有关更多信息，请参阅
       </font></font><a class="xref" href="/mysql-5.7-google-zh/group-replication.html" title="第17章组复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解释详细信息的</font><a class="xref" href="/mysql-5.7-google-zh/group-replication.html" title="Chapter 17 Group Replication"><i><font style="vertical-align: inherit;">组复制</font></i></a><font style="vertical-align: inherit;">。
      </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL路由器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以根据您部署的集群自动配置自身，将客户端应用程序透明地连接到服务器实例。</font><font style="vertical-align: inherit;">如果服务器实例发生意外故障，群集将自动重新配置。</font><font style="vertical-align: inherit;">在默认的单主模式下，InnoDB集群有一个读写服务器实例 - 主服务器实例。</font><font style="vertical-align: inherit;">多个辅助服务器实例是主要的副本。</font><font style="vertical-align: inherit;">如果主服务器失败，则辅助服务器会自动提升为主服务器的角色。</font><font style="vertical-align: inherit;">MySQL路由器检测到这一点并将客户端应用程序转发到新的主要应用程序 </font><font style="vertical-align: inherit;">高级用户还可以将群集配置为具有多个主区域。

      
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        InnoDB集群不提供对MySQL NDB集群的支持。</font><font style="vertical-align: inherit;">NDB集群取决于</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎以及一些特定于NDB集群的程序，这些程序没有提供MySQL Server 5.7;
        </font></font><code class="literal">NDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅作为MySQL NDB集群分发的一部分提供。</font><font style="vertical-align: inherit;">此外，</font><font style="vertical-align: inherit;">MySQL Server 5.7提供</font><font style="vertical-align: inherit;">的MySQL服务器二进制文件（</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）不能与NDB群集一起使用。</font><font style="vertical-align: inherit;">有关MySQL NDB集群的更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL NDB集群7.5和NDB集群7.6</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-compared" title="21.1.5使用InnoDB的MySQL服务器与NDB集群的比较"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21.1.5节“使用InnoDB与NDB集群相比较的MySQL服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了有关两者之间差异的信息</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">NDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      下图显示了这些技术如何一起工作的概述：
</font></font></p>
<div class="figure">
<a name="innodb-cluster-overview-image"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图20.1 InnoDB集群概述</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./mysql-innodb-cluster-userguide_files/innodb_cluster_overview.png" width="600" height="753" alt="三台MySQL服务器组合为一个高可用性群集。 其中一个服务器是读/写主实例，另外两个是只读辅助实例。 组复制用于将数据从主实例复制到辅助实例。 MySQL路由器将客户端应用程序（在本例中为MySQL连接器）连接到主实例。 MySQL Shell中的集群管理功能可以使用MySQL X AdminAPI直接连接到主实例，也可以像其他客户端应用程序一样通过MySQL路由器连接。">
</div>

</div>

</div>
<br class="figure-break">
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h3 class="title"><a name="admin-api"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用AdminAPI</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL Shell包含AdminAPI，通过</font></font><code class="literal">dba</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局变量及其关联方法</font><font style="vertical-align: inherit;">访问AdminAPI </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">dba</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的方法使您能够部署，配置和管理InnoDB的集群。</font><font style="vertical-align: inherit;">例如，使用该
         </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法创建一个InnoDB集群。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL Shell允许您通过套接字连接连接到服务器，但AdminAPI需要到服务器实例的TCP连接。</font><font style="vertical-align: inherit;">不要使用基于套接字的AdminAPI连接。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL Shell为AdminAPI提供在线帮助。</font><font style="vertical-align: inherit;">要列出所有可用的</font></font><code class="literal">dba</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，请使用该
         </font></font><code class="literal">dba.help()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font><font style="vertical-align: inherit;">有关特定方法的联机帮助，请使用常规格式
         </font></font><code class="literal">object.help('methodname')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>dba.help('getCluster')</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从Metadata Store中检索集群。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
句法</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  &lt;DBA&gt; .getCluster（[名称]）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
哪里</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  name：用于指定要返回的集群的名称的参数。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
描述</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果未指定名称，则会返回默认群集。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果指定了名称，并且找不到具有指定名称的集群，则会显示错误</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将会被提出。</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        除此文档外，</font></font><a class="ulink" href="http://dev.mysql.com/doc/dev//mysqlsh-api-javascript/8.0/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        和
         </font></font><a class="ulink" href="http://dev.mysql.com/doc/dev//mysqlsh-api-python/8.0/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        开发人员文档中</font><font style="vertical-align: inherit;">还有针对所有AdminAPI方法的
         </font><font style="vertical-align: inherit;">开发人员文档。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-creating"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2创建InnoDB集群</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-deployment-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.1部署方案</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-requirements"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.2 InnoDB集群要求</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-methods-installing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.3安装方法</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.4 InnoDB集群的沙箱部署</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.5 InnoDB集群的生产部署</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-from-group-replication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.6采用组复制部署</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍您可以创建InnoDB集群的不同方式，服务器实例的需求以及您需要安装以部署集群的软件。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-innodb-cluster-deployment-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.1部署方案</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        InnoDB集群支持以下部署方案：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沙盒部署：</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要在提交完整生产部署之前测试InnoDB集群，则提供的沙箱功能可让您在本地计算机上快速设置集群。</font><font style="vertical-align: inherit;">沙箱服务器实例是使用所需的配置创建的，您可以试用InnoDB集群以熟悉所使用的技术。</font><font style="vertical-align: inherit;">有关说明</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment" title="20.2.4 InnoDB集群的沙箱部署"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
            </font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment" title="20.2.4 InnoDB集群的沙箱部署"><font style="vertical-align: inherit;">第20.2.4节“InnoDB集群的沙箱部署”</font></a><font style="vertical-align: inherit;"> 
            。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生产部署：</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要在完整生产环境中使用InnoDB集群，则需要配置所需数量的计算机，然后将服务器实例部署到计算机。</font><font style="vertical-align: inherit;">生产部署使您能够充分利用InnoDB集群的高可用性功能。</font><font style="vertical-align: inherit;">有关说明</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment" title="20.2.5 InnoDB集群的生产部署"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
            </font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment" title="20.2.5 InnoDB集群的生产部署"><font style="vertical-align: inherit;">第20.2.5节“InnoDB集群的生产部署”</font></a><font style="vertical-align: inherit;"> 
            。
</font></font></p></li></ul>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          沙盒部署不适合在完整的生产环境中使用。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-innodb-cluster-requirements"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.2 InnoDB集群要求</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在安装InnoDB集群的生产部署之前，请确保您打算使用的服务器实例符合以下要求。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            InnoDB集群使用组复制，因此您的服务器实例必须满足相同的要求。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/group-replication.html#group-replication-requirements" title="17.7.1组复制要求"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17.7.1节“组复制要求”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">AdminAPI提供
             </font></font><code class="literal">dba.checkInstanceConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证实例是否满足组复制要求的</font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">，以及
             </font><font style="vertical-align: inherit;">如何配置实例以满足要求的方法。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在使用沙箱部署时，实例会自动配置为满足这些要求。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL Shell用来配置服务器以供InnoDB集群使用的供应脚本需要访问Python版本2.7。</font><font style="vertical-align: inherit;">对于沙箱部署，在用于部署的单台机器上需要Python，生产部署需要在每个服务器实例上使用Python。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在Windows上，MySQL Shell包含Python，不需要用户配置。</font><font style="vertical-align: inherit;">在Unix上，必须找到Python作为shell环境的一部分。</font><font style="vertical-align: inherit;">检查您的系统是否正确配置了Python问题：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ </font></font><strong class="userinput"><code>/usr/bin/env python</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果Python解释器启动，则不需要进一步的操作。</font><font style="vertical-align: inherit;">如果以前的命令失败，请在</font></font><code class="literal">/usr/bin/python</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您所选的Python二进制文件</font><font style="vertical-align: inherit;">之间创建一个软链接</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-innodb-cluster-methods-installing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.3安装方法</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您用来安装InnoDB集群的方法取决于您打算使用的部署类型。</font><font style="vertical-align: inherit;">对于沙箱部署，将InnoDB集群的组件安装到单台机器上。</font><font style="vertical-align: inherit;">沙盒部署对于单台计算机是本地的，因此安装只需在本地计算机上执行一次。</font><font style="vertical-align: inherit;">同样，不需要单独连接到实例进行配置，沙盒实例是本地的。</font><font style="vertical-align: inherit;">对于生产部署，将组件安装到要添加到群集中的每台计算机上。</font><font style="vertical-align: inherit;">生产部署使用多台运行MySQL服务器实例的远程主机，</font><font style="vertical-align: inherit;">因此您需要使用SSH或Windows远程桌面等工具连接到每台计算机，以执行诸如安装组件和配置服务器实例等任务。</font><font style="vertical-align: inherit;">以下安装InnoDB集群的方法可用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用以下文档下载和安装组件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                MySQL服务器 - 请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html" title="第2章安装和升级MySQL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和升级MySQL</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                MySQL Shell  - 请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/document-store.html#document-store-shell-install" title="19.3.1安装MySQL Shell"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第19.3.1节“安装MySQL Shell”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                MySQL路由器 - 请参阅
                 </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-installation.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装MySQL路由器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在Windows上，您可以使用Windows的MySQL安装程序进行沙盒部署。</font><font style="vertical-align: inherit;">有关详细信息，请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#mysql-installer-workflow-innodb-cluster" title="组复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组复制</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一旦安装了InnoDB集群所需的软件，请选择遵循
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment" title="20.2.4 InnoDB集群的沙箱部署"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20.2.4节“InnoDB集群的沙盒部署”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment" title="20.2.5 InnoDB集群的生产部署"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20.2.5节“InnoDB集群的生产部署”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-innodb-cluster-sandbox-deployment"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.4 InnoDB集群的沙箱部署</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何设置沙盒InnoDB集群部署。</font><font style="vertical-align: inherit;">您可以使用包含AdminAPI的MySQL Shell来创建和管理您的InnoDB集群。</font><font style="vertical-align: inherit;">本节假定您熟悉MySQL Shell，请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-shell.html" title="第18章MySQL Shell用户指南"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第18章“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Shell用户指南”</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        最初部署和使用MySQL的本地沙箱实例是开始探索InnoDB集群的好方法。</font><font style="vertical-align: inherit;">在部署到生产服务器之前，您可以在本地完全测试InnoDB集群。</font><font style="vertical-align: inherit;">MySQL Shell具有内置的功能，用于创建正确配置为在本地部署的场景中使用组复制的沙箱实例。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Sandbox实例仅适用于在本地计算机上进行部署和运行以进行测试。</font><font style="vertical-align: inherit;">在生产环境中，MySQL服务器实例被部署到网络上的各种主机上。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">
          更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment" title="20.2.5 InnoDB集群的生产部署"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment" title="20.2.5 InnoDB集群的生产部署"><font style="vertical-align: inherit;">第20.2.5节“InnoDB集群的生产部署”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本教程演示如何使用MySQL Shell创建由三个MySQL服务器实例组成的InnoDB集群。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#deploy-sandbox-instances" title="部署沙箱实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部署沙箱实例</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#create-innodb-cluster" title="创建Sandbox InnoDB集群"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建Sandbox InnoDB集群</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#add-instances-innodb-cluster" title="将实例添加到InnoDB集群"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将实例添加到InnoDB集群</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#persist-configuration-innodb-cluster" title="坚持配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坚持配置</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="deploy-sandbox-instances"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部署沙箱实例</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL Shell包含AdminAPI，它添加了
           </font></font><code class="literal">dba</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局变量，该变量提供了用于管理沙箱实例的功能。</font><font style="vertical-align: inherit;">在此示例设置中，您将使用创建三个沙箱实例
           </font></font><code class="literal">dba.deploySandboxInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过发出以下命令从命令提示符启动MySQL Shell：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlsh</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          除了原生SQL模式外，MySQL Shell还提供了两种脚本语言模式，JavaScript和Python。</font><font style="vertical-align: inherit;">在本指南中，MySQL Shell主要用于JavaScript模式。</font><font style="vertical-align: inherit;">当MySQL Shell启动时，它默认处于JavaScript模式。</font><font style="vertical-align: inherit;">通过发出</font></font><code class="literal">\js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript模式，</font></font><code class="literal">\py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python模式和
           </font></font><code class="literal">\sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL模式来</font><font style="vertical-align: inherit;">切换</font><font style="vertical-align: inherit;">模式。</font><font style="vertical-align: inherit;">通过发出</font></font><code class="literal">\js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">确保您处于JavaScript模式</font><font style="vertical-align: inherit;">，然后执行：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>dba.deploySandboxInstance(3310)</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在JavaScript和Python模式下，不需要用分号终止命令。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          传递给的参数
           </font></font><code class="literal">deploySandboxInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是MySQL服务器实例侦听连接的TCP端口号。</font><font style="vertical-align: inherit;">默认情况下，沙箱是</font><font style="vertical-align: inherit;">
          在Unix系统上</font><font style="vertical-align: inherit;">命名的目录中创建的
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于Microsoft Windows系统，目录是
           </font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">$HOME/mysql-sandboxes/<em class="replaceable"><code>port</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">%userprofile%\MySQL\mysql-sandboxes\<em class="replaceable"><code>port</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统会提示该实例的root密码。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每个实例都有自己的密码。</font><font style="vertical-align: inherit;">在本教程中为所有沙箱定义相同的密码使其更容易，但请记住在生产部署中为每个实例使用不同的密码。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要部署更多沙箱服务器实例，请在端口3310处重复沙箱实例的步骤，并选择不同的端口号。</font><font style="vertical-align: inherit;">对于每个额外的沙箱实例问题：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>dba.deploySandboxInstance(<em class="replaceable"><code>port_number</code></em>)</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要学习本教程，请为三个沙箱服务器实例使用端口号3310,3320和3330。</font><font style="vertical-align: inherit;">问题：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql-js&gt; </font><font style="vertical-align: inherit;">
mysql-js&gt;</font></font><strong class="userinput"><code>dba.deploySandboxInstance(<em class="replaceable"><code>3320</code></em>)</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>dba.deploySandboxInstance(<em class="replaceable"><code>3330</code></em>)</code></strong>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="create-innodb-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建Sandbox InnoDB集群</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          下一步是在连接到种子MySQL服务器实例时创建InnoDB集群。</font><font style="vertical-align: inherit;">种子实例包含要复制到其他实例的数据。</font><font style="vertical-align: inherit;">在这个例子中，沙盒实例是空白的，因此我们可以选择任何实例。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将MySQL Shell连接到种子实例，在本例中是3310端口：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>\connect root@localhost:3310</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          的</font></font><code class="literal">\connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的Shell命令是针对一个快捷方式</font></font><code class="literal">shell.connect()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方法：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>shell.connect('root@localhost:3310')</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一旦连接，AdminAPI可以写入本地实例的选项文件。</font><font style="vertical-align: inherit;">这与使用生产部署不同，在生产部署中，需要连接到远程实例并在AdminAPI可写入实例的选项文件之前在实例上本地运行MySQL Shell应用程序。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用该</font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法以当前连接的实例作为种子创建InnoDB集群：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>var cluster = dba.createCluster('testCluster')</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法将InnoDB集群元数据部署到选定实例，并将当前连接的实例添加为种子实例。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法返回创建的集群，在上面的例子中，这个分配给</font></font><code class="literal">cluster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量。</font></font><code class="literal">createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下，</font><font style="vertical-align: inherit;">传递给该</font><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">的参数</font><font style="vertical-align: inherit;">是给这个InnoDB集群的符号名称</font></font><code class="literal">testCluster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果实例有，
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么您可能需要确认AdminAPI可以设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="超级只读和实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="add-instances-innodb-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将实例添加到InnoDB集群</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          下一步是向InnoDB集群添加更多实例。</font><font style="vertical-align: inherit;">由种子实例执行的任何事务由每个辅助实例在添加时重新执行。</font><font style="vertical-align: inherit;">本教程使用先前在端口3320和3330创建的沙箱实例。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这个例子中的种子实例最近被创建，所以它几乎是空的。</font><font style="vertical-align: inherit;">因此，很少有数据需要从种子实例复制到次要实例。</font><font style="vertical-align: inherit;">在生产环境中，在种子实例上有现有数据库的情况下，可以使用MySQL Enterprise Backup之类的工具来确保在复制开始前辅助数据库具有匹配的数据。</font><font style="vertical-align: inherit;">这样可以避免数据从主服务器复制到备用服务器时长时间延迟的可能性。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/group-replication.html#group-replication-enterprise-backup" title="17.4.4使用MySQL企业备份与组复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17.4.4节“通过组复制使用MySQL Enterprise Backup”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将第二个实例添加到InnoDB集群：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.addInstance('root@localhost:3320')</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提示输入root用户的密码。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          添加第三个实例：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.addInstance('root@localhost:3330')</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提示输入root用户的密码。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此时您创建了一个具有三个实例的集群：一个主集群和两个副集群。
</font></font></p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            只能</font></font><code class="literal">localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
             </font></font><code class="literal">addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例是沙箱实例的情况下</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这也适用于</font></font><code class="literal">addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布后
             </font><font style="vertical-align: inherit;">的隐式
             </font></font><code class="literal">createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="persist-configuration-innodb-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坚持配置</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将沙箱实例添加到群集后，必须将InnoDB群集所需的配置持久保存到每个实例的选项文件中。</font><font style="vertical-align: inherit;">连接到每个实例。
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>\connect <em class="replaceable"><code>instance</code></em></code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          问题
           </font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">dba.configureLocalInstance(<em class="replaceable"><code>instance</code></em>)</code><font style="vertical-align: inherit;"></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>dba.configureLocalInstance('<em class="replaceable"><code>instance</code></em>')</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统会提示您输入实例的密码。</font><font style="vertical-align: inherit;">配置更改将持久保存到实例中。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在连接到实例时未发出，则配置不会持久保存到选项文件中。</font><font style="vertical-align: inherit;">这不会阻止最初加入群集的实例，但它确实意味着实例无法自动重新加入群集，例如停止后。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          重复连接到您添加到群集中的每个沙箱实例并持久保存配置的过程。</font><font style="vertical-align: inherit;">对于这个例子，我们在端口3310,3320和3330处添加了沙盒实例。因此，对于端口3320和3330发出这个问题：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql-js&gt; </font><font style="vertical-align: inherit;">
mysql-js&gt;</font></font><strong class="userinput"><code>\connect root@localhost:<em class="replaceable"><code>port_number</code></em>)</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>dba.configureLocalInstance('root@localhost:<em class="replaceable"><code>port_number</code></em>)</code></strong>
 </pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要检查群集是否已创建，请使用群集实例的</font></font><code class="literal">status()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#check-innodb-cluster-status" title="检查InnoDB群集状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查InnoDB群集状态</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          部署集群后，可以配置MySQL路由器以提供高可用性，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-using-router" title="20.3在InnoDB集群中使用MySQL路由器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20.3节“在InnoDB集群中使用MySQL路由器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。

          
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-innodb-cluster-production-deployment"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.5 InnoDB集群的生产部署</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在生产环境中工作时，构成InnoDB集群的MySQL服务器实例作为网络的一部分运行在多台主机上，而不是单个机器上，如
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment" title="20.2.4 InnoDB集群的沙箱部署"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20.2.4节“InnoDB集群的沙盒部署”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在继续这些说明之前，您必须将所需的软件安装到您打算作为服务器实例添加到群集的每台计算机上，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-methods-installing" title="20.2.3安装方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20.2.3节“安装方法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下图说明了您在本节中使用的方案：
</font></font></p>
<div class="figure">
<a name="production-servers-image"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图20.2生产部署</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./mysql-innodb-cluster-userguide_files/production_servers.png" width="600" height="837" alt="三台MySQL服务器被组合在一起作为一个生产InnoDB集群。 其中一台服务器是主要实例，另外两台是次要实例。 主服务器的IP地址为139.59.177.10，两个备份实例的IP地址分别为139.59.177.11和139.59.177.12。 MySQL路由器将客户端应用程序连接到主实例。 MySQL Shell中的管理功能直接与生产InnoDB集群交互。">
</div>

</div>

</div>
<br class="figure-break">
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          与沙箱部署不同，在沙箱部署中，所有实例都在本地部署到一台计算机上，对于生产部署，您必须连接到每台计算机并</font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实例上执行</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">本地运行MySQL Shell </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可确保任何配置更改都会持久保存到实例的选项文件中。</font><font style="vertical-align: inherit;">这也要求您有权访问服务器以及执行MySQL Shell所需的权限。

          
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要将服务器的连接信息传递给AdminAPI，请使用URI类型字符串。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-shell.html#mysql-shell-connection-using-uri" title="18.2.1.1使用URI字符串进行连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/mysql-shell.html#mysql-shell-connection-using-uri" title="18.2.1.1使用URI字符串进行连接"><font style="vertical-align: inherit;">第18.2.1.1节“使用URI字符串</font></a><font style="vertical-align: inherit;">进行</font><a class="xref" href="/mysql-5.7-google-zh/mysql-shell.html#mysql-shell-connection-using-uri" title="18.2.1.1使用URI字符串进行连接"><font style="vertical-align: inherit;">连接”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="mysql-innodb-cluster-user-privileges"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户权限</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于管理实例的用户帐户不必是root帐户，但用户需要分配全读，除了全面的MySQL管理员特权写在InnoDB的集群的元数据表的权限（</font></font><code class="literal">SUPER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">GRANT
          OPTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">DROP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等） 。</font><font style="vertical-align: inherit;">为用户
           </font></font><em class="replaceable"><code>your_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供管理InnoDB集群问题所需的权限：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予mysql_innodb_cluster_metadata的所有特权。* TO your_user @'％'WITH GRANT OPTION;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT RELOAD，SHUTDOWN，PROCESS，FILE，SUPER，REPLICATION SLAVE，REPLICATION CLIENT，\</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE USER ON *。* TO your_user @'％'WITH GRANT OPTION;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON *。* TO your_user @'％'WITH GRANT OPTION;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果只需要读取操作（例如用于监视目的），则可以使用具有更多受限权限的帐户。</font><font style="vertical-align: inherit;">为用户</font></font><em class="replaceable"><code>your_user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提供监控InnoDB集群问题所需的权限：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRANT SELECT ON mysql_innodb_cluster_metadata。* TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.global_status TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.replication_applier_configuration TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.replication_applier_status TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.replication_applier_status_by_coordinator TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.replication_applier_status_by_worker TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.replication_connection_configuration TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.replication_connection_status TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.replication_group_member_stats TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT SELECT ON performance_schema.replication_group_members TO </font></font><em class="replaceable"><code>your_user@'%'</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这个过程中，用户</font></font><code class="literal">ic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在示例中使用。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="mysql-innodb-cluster-production-hostname"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置主机名</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          构成群集的生产实例在不同的机器上运行，因此每台机器必须具有唯一的主机名，并且能够解析在群集中运行服务器实例的其他机器的主机名。</font><font style="vertical-align: inherit;">如果情况并非如此，您可以：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              配置每台机器将每台其他机器的IP映射到主机名。</font><font style="vertical-align: inherit;">详细信息请参阅您的操作系统文档。</font><font style="vertical-align: inherit;">这是推荐的解决方案。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              建立一个DNS服务
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_report_host"><code class="literal">report_host</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在每个实例的MySQL配置中</font><font style="vertical-align: inherit;">
              配置</font><font style="vertical-align: inherit;">变量
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这个过程中，主机名
           </font><font style="vertical-align: inherit;">在示例中使用。
</font></font><code class="literal">ic-<em class="replaceable"><code>number</code></em></code><font style="vertical-align: inherit;"></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="mysql-innodb-cluster-logging"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细记录</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在使用生产部署时，配置MySQL Shell的详细日志记录可能很有用，日志中的信息可帮助您查找和解决在准备服务器实例以作为InnoDB群集一部分工作时可能发生的任何问题。</font><font style="vertical-align: inherit;">要使用详细日志记录级别启动MySQL Shell，请使用以下
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlsh_log-level"><code class="option">--log-level</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlsh --log-level=DEBUG3</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这</font></font><code class="literal">DEBUG3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是建议，见
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlsh_log-level"><code class="option">--log-level</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多信息。</font><font style="vertical-align: inherit;">何时</font></font><code class="literal">DEBUG3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置MySQL Shell日志文件包含行，例如</font></font><code class="literal">Debug:
          execute_sql( ... )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪些行包含作为每个AdminAPI调用的一部分执行的SQL查询。</font><font style="vertical-align: inherit;">由MySQL Shell生成的日志文件位于
           </font></font><code class="filename">~/.mysqlsh/mysqlsh.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于Unix的系统中; </font><font style="vertical-align: inherit;">在它位于的Microsoft Windows系统上
           </font></font><code class="filename">%APPDATA%\MySQL\mysqlsh\mysqlsh.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-shell.html#mysql-shell-application-log" title="18.5 MySQL Shell应用程序日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/mysql-shell.html#mysql-shell-application-log" title="18.5 MySQL Shell应用程序日志"><font style="vertical-align: inherit;">第18.5节“MySQL Shell应用程序日志”</font></a><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          除了启用MySQL Shell日志级别之外，您还可以配置每次调用API后AdminPaI在MySQL Shell中提供的输出量。</font><font style="vertical-align: inherit;">要在MySQL Shell中启用AdminAPI输出的数量问题：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql-js&gt; dba.verbose = 2</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这将启用AdminAPI调用的最大输出。</font><font style="vertical-align: inherit;">可用的输出级别是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0或OFF是默认值。</font><font style="vertical-align: inherit;">这提供了最小的输出，并且在不排除故障时是推荐的水平。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1或ON将每个调用的详细输出添加到AdminAPI。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              2将调试输出添加到详细输出中，提供关于每次调用AdminAPI时执行的全部信息。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="check-instance-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查实例配置</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在从服务器实例创建生产部署之前，您需要检查每个实例上的MySQL是否使用该</font></font><code class="literal">dba.checkInstanceConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">正确配置
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这确保实例满足
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-requirements" title="20.2.2 InnoDB集群要求"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20.2.2节“InnoDB集群要求”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这不</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#check-instance-state" title="检查实例状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的任何数据，请参阅
           </font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#check-instance-state" title="检查实例状态"><font style="vertical-align: inherit;">检查实例状态</font></a><font style="vertical-align: inherit;">以获取更多信息。</font><font style="vertical-align: inherit;">以下演示在运行的MySQL Shell中发布：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>dba.checkInstanceConfiguration('ic@ic-1:3306')</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请提供'ic @ ic-1：3306'的密码：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
验证实例...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实例'ic-1：3306'对群集用法无效。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遇到以下问题：</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 某些配置选项需要修复。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------- + -------------- -  + ---------------- + ------------------------------- ------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量| </font><font style="vertical-align: inherit;">当前值| </font><font style="vertical-align: inherit;">必需的值| </font><font style="vertical-align: inherit;">注意|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------- + -------------- -  + ---------------- + ------------------------------- ------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">binlog_checksum | </font><font style="vertical-align: inherit;">CRC32 | </font><font style="vertical-align: inherit;">NONE | </font><font style="vertical-align: inherit;">更新服务器变量或重新启动服务器|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">enforce_gtid_consistency | </font><font style="vertical-align: inherit;">OFF | </font><font style="vertical-align: inherit;">ON | </font><font style="vertical-align: inherit;">重新启动服务器|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">gtid_mode | </font><font style="vertical-align: inherit;">OFF | </font><font style="vertical-align: inherit;">ON | </font><font style="vertical-align: inherit;">重新启动服务器|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">log_bin | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">重新启动服务器|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">log_slave_updates | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">ON | </font><font style="vertical-align: inherit;">重新启动服务器|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">master_info_repository | </font><font style="vertical-align: inherit;">FILE | </font><font style="vertical-align: inherit;">TABLE | </font><font style="vertical-align: inherit;">重新启动服务器|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">relay_log_info_repository | </font><font style="vertical-align: inherit;">FILE | </font><font style="vertical-align: inherit;">TABLE | </font><font style="vertical-align: inherit;">重新启动服务器|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">transaction_write_set_extraction | </font><font style="vertical-align: inherit;">OFF | </font><font style="vertical-align: inherit;">XXHASH64 | </font><font style="vertical-align: inherit;">重新启动服务器|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------------- + -------------- -  + ---------------- + ------------------------------- ------------------- +</font></font><font></font>
<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请解决这些问题，重新启动服务器并重试。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “config_errors”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “action”：“server_update”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“CRC32”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “option”：“binlog_checksum”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“无”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“关闭”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“enforce_gtid_consistency”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“开”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“关闭”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “option”：“gtid_mode”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“开”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“0”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“log_bin”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“1”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“0”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“log_slave_updates”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“开”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“文件”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“master_info_repository”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“TABLE”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“文件”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “option”：“relay_log_info_repository”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“TABLE”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“关闭”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“transaction_write_set_extraction”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“XXHASH64”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “错误”：[]，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “restart_required”：true，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “状态”：“错误”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的-JS&gt;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对计划用作群集一部分的每个服务器实例重复此过程。</font><font style="vertical-align: inherit;">运行后生成的报告</font></font><code class="literal">dba.checkInstanceConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提供了有关所需的任何配置更改的信息，然后才能继续。</font></font><code class="literal">restart_required</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告最后部分</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">字段告诉您实例上的MySQL是否需要重新启动以检测对配置文件所做的任何更改。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="configuring-the-instance-id"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置实例</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果在</font></font><code class="literal">dba.checkInstanceConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对实例</font><font style="vertical-align: inherit;">运行生成的报告中发现配置问题
           </font><font style="vertical-align: inherit;">，则不符合
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-requirements" title="20.2.2 InnoDB集群要求"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20.2.2节“InnoDB集群要求”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此您需要连接到本机并重新配置服务器实例。</font><font style="vertical-align: inherit;">AdminAPI提供</font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找MySQL服务器选项文件</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">功能，并修改它以确保InnoDB集群正确配置实例。</font><font style="vertical-align: inherit;">或者根据报告中的信息手动更改实例的选项文件。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.6节“使用选项文件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解更多信息。</font><font style="vertical-align: inherit;">无论您如何进行配置更改，都可能需要重新启动MySQL以确保检测到配置更改。

          
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          推荐的方法是登录到远程机器，以root用户身份运行MySQL Shell，然后连接到本地MySQL服务器：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>sudo -i mysqlsh --log-level=DEBUG3</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法验证适合的用户是否可用于群集使用，用于群集成员之间的连接。</font><font style="vertical-align: inherit;">root用户默认情况下不能进行远程登录，因此您有三个选项可以继续进行配置：为root用户启用远程连接，创建一个新用户或者这两个以前的选项。</font><font style="vertical-align: inherit;">以下示例演示了第二个选项，为集群使用创建一个新用户。</font><font style="vertical-align: inherit;">接受的用户名格式遵循标准的MySQL帐户名称格式，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#account-names" title="6.2.3指定帐户名称"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.3节“指定帐户名称”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	
MySQL的-JS&gt; </font></font><strong class="userinput"><code>dba.configureLocalInstance('root@localhost:3306')</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请提供“root @ localhost：3306”的密码：</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请指定MySQL配置文件的路径：/etc/mysql/mysql.conf.d/mysqld.cnf</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
验证实例...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配置已更新，但需要重新启动服务器。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “config_errors”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“关闭”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“enforce_gtid_consistency”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“开”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“关闭”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “option”：“gtid_mode”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“开”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“0”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“log_bin”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“1”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“0”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“log_slave_updates”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“开”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“文件”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“master_info_repository”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“TABLE”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“文件”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “option”：“relay_log_info_repository”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“TABLE”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “行动”：“重启”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “当前”：“关闭”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “选项”：“transaction_write_set_extraction”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      “必需”：“XXHASH64”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “错误”：[]，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “restart_required”：true，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “状态”：“错误”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的-JS&gt;</font></font><font></font>
</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果实例有，
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么您可能需要确认AdminAPI可以设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="超级只读和实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          与之一样</font></font><code class="literal">dba.checkInstanceConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，配置要求已确定，但这次所选的配置文件已被修改。</font><font style="vertical-align: inherit;">要使配置更改生效，您可能需要重新启动MySQL服务器。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数还接受</font></font><code class="literal">clusterAdmin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">clusterAdminPassword</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，使您可以在调用函数时配置群集用户和密码。</font></font><code class="literal">clusterAdmin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持用户名和主机名的标识符或字符串。</font><font style="vertical-align: inherit;">默认情况下，如果未加引号，则假定输入是一个字符串。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql-js&gt; dba.configureLocalInstance（'ic @ ic-1：3306'，\ </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	      {clusterAdmin：'icadmin @ ic-1％'，clusterAdminPassword：'secret'}）;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此用户被授予在</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-user-privileges" title="用户权限"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户权限中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的管理
           </font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-user-privileges" title="用户权限"><font style="vertical-align: inherit;">用户的权限</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="create-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建群集</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          准备好实例后，使用该
           </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能创建群集。</font><font style="vertical-align: inherit;">您正在运行MySQL Shell的机器将用作群集的种子实例。</font><font style="vertical-align: inherit;">将种子实例复制到您添加到群集中的其他实例，使其成为种子实例的副本。</font><font style="vertical-align: inherit;">登录到实例并在本地运行MySQL Shell。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">      
外壳&gt; </font></font><strong class="userinput"><code>mysqlsh --uri ic@ic-1:3306</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建会话到'ic @ ic-1：3306'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
输入密码： *********</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
经典会议成功建立。</font><font style="vertical-align: inherit;">没有选择默认模式。</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在创建集群之前，MySQL Shell必须连接到一个实例，因为当您发出
           </font><font style="vertical-align: inherit;">
          MySQL Shell时，会创建一个MySQL协议会话连接到MySQL Shell当前全局会话的服务器实例。</font><font style="vertical-align: inherit;">使用该
           </font><font style="vertical-align: inherit;">
          函数创建群集并将返回的群集分配给一个名为</font><font style="vertical-align: inherit;">：
        </font></font><code class="literal">dba.createCluster(<em class="replaceable"><code>name</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">dba.createCluster(<em class="replaceable"><code>name</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">cluster</code><font style="vertical-align: inherit;"></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">      
MySQL的-JS&gt; </font></font><strong class="userinput"><code>var cluster = dba.createCluster('prodCluster')</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      将在实例'ic @ ic-1：3306'上创建一个新的InnoDB集群。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在'ic @ ic-1：3306'上创建InnoDB集群'prodCluster'...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      添加种子实例...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      集群成功创建。</font><font style="vertical-align: inherit;">使用Cluster.addInstance（）添加MySQL实例。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      至少需要3个实例才能使群集能够承受高达</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一台服务器故障。</font></font><font></font>
</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果实例有，
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么您可能需要确认AdminAPI可以设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="超级只读和实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
</font></font></p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果遇到与元数据无法访问有关的错误，则可能会配置回送网络接口。</font><font style="vertical-align: inherit;">为了正确使用InnoDB集群，请禁用回送接口。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要检查群集是否已创建，请使用群集实例的</font></font><code class="literal">status()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#check-innodb-cluster-status" title="检查InnoDB群集状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查InnoDB群集状态</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一旦服务器实例属于集群，仅使用MySQL Shell和AdminAPI管理它们非常重要。</font><font style="vertical-align: inherit;">不支持尝试在实例上添加群集时手动更改群组复制的配置。</font><font style="vertical-align: inherit;">同样，不支持修改对InnoDB群集至关重要的服务器变量，例如
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用AdminAPI配置实例之后。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用该
           </font><font style="vertical-align: inherit;">
          函数向集群添加更多实例，其中
           </font><font style="vertical-align: inherit;">是连接到本地实例的URI类型字符串。</font><font style="vertical-align: inherit;">这些实例必须已配置为使用群集。</font><font style="vertical-align: inherit;">群集中至少需要三个实例才能容忍一个实例的失败。</font><font style="vertical-align: inherit;">添加更多的实例会增加对实例故障的容忍度。</font><font style="vertical-align: inherit;">向群集问题添加实例：
        </font></font><code class="literal">cluster.addInstance(<em class="replaceable"><code>instance</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>instance</code></em><font style="vertical-align: inherit;"></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.addInstance('ic@ic-2:3306');</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证实例是否已添加，请使用群集实例的</font></font><code class="literal">status()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。

          
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在此阶段，服务器实例已添加到群集，但对InnoDB群集元数据的更改只能在当前连接的实例上进行。</font><font style="vertical-align: inherit;">要使配置更改对群集中的所有实例保持持久性，您必须连接到每个实例并</font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您添加的每个实例</font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">本地</font><font style="vertical-align: inherit;">发出
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这对于确保在离开集群时实例重新加入集群至关重要。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要为所有实例保存InnoDB集群元数据，请登录到您添加到集群中的每个实例并在本地运行MySQL Shell。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlsh</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用该</font></font><code class="literal">\connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令登录到MySQL服务器。</font><font style="vertical-align: inherit;">执行该
           </font><font style="vertical-align: inherit;">
          函数，其中</font><font style="vertical-align: inherit;">是连接到本地实例的URI类型字符串。</font><font style="vertical-align: inherit;">例如：
        </font></font><code class="literal">dba.configureLocalInstance('<em class="replaceable"><code>instance</code></em>')</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>instance</code></em><font style="vertical-align: inherit;"></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql-js&gt; dba.configureLocalInstance（'ic @ ic-2：3306'）
</font></font></pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果实例有，
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么您可能需要确认AdminAPI可以设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="超级只读和实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对添加到群集的每个服务器实例重复此过程。</font><font style="vertical-align: inherit;">同样，如果修改集群结构（例如更改实例数量），则需要为每个服务器实例重复此过程，以相应地为集群中的每个实例更新InnoDB集群元数据。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          部署集群后，可以配置MySQL路由器以提供高可用性，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-using-router" title="20.3在InnoDB集群中使用MySQL路由器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第20.3节“在InnoDB集群中使用MySQL路由器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。

          
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-innodb-cluster-from-group-replication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.6采用组复制部署</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您有一个现有的组复制部署，并且想要使用它来创建一个集群，请将该</font></font><code class="literal">adoptFromGR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">传递
         </font><font style="vertical-align: inherit;">给该
         </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">创建的InnoDB群集与复制组是以单主还是多主运行相匹配。</font><font style="vertical-align: inherit;">这意味着您不能将该</font></font><code class="literal">multiPrimary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项与该</font></font><code class="literal">adoptFromGR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">结合使用</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          组复制成员可能包含
           </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">将所有这些表转换为</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将该组采用到InnoDB集群之前。

          
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要采用现有的组复制组，请使用MySQL Shell连接到组成员。</font><font style="vertical-align: inherit;">在下面的例子中，采用了单主组。</font><font style="vertical-align: inherit;">我们连接到
         </font></font><code class="literal">gr-member-2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助实例，同时
         </font></font><code class="literal">gr-member-1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为组的主要工作。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递
         </font></font><code class="literal">adoptFromGR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">创建一个集群
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  
MySQL的-JS&gt; </font></font><strong class="userinput"><code>var cluster = dba.createCluster('prodCluster', {adoptFromGR: true});</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将在实例'root @ gr-member-2：3306'上创建一个新的InnoDB集群。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在'root @ gr-member-2：3306'上创建InnoDB集群'prodCluster'...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
添加种子实例...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
集群成功创建。</font><font style="vertical-align: inherit;">使用cluster.addInstance（）添加MySQL实例。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
至少需要3个实例才能使群集能够承受高达</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一台服务器故障。</font></font><font></font>
</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果实例有，
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么您可能需要确认AdminAPI可以设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="超级只读和实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        新群集与组的模式相匹配。</font><font style="vertical-align: inherit;">如果采用的组以单主模式运行，则会创建单主集群。</font><font style="vertical-align: inherit;">如果采用的组运行在多主模式下，则会创建一个多主集群。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.status();</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “clusterName”：“prodCluster”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “defaultReplicaSet”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “name”：“默认”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “primary”：“gr-member-1：3306”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “ssl”：“需要”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “状态”：“确定”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “statusText”：“群集处于联机状态，并且最多可容忍一次故障。”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “拓扑”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “gr-member-2：3306”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “地址”：“gr-member-2：3306”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “模式”：“R / O”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “readReplicas”：{}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “状态”：“在线”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “gr-member-1：3306”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “地址”：“gr-member-1：3306”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “mode”：“R / W”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “readReplicas”：{}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “状态”：“在线”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “gr-member-3：3306”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “地址”：“gr-member-3：3306”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “模式”：“R / O”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “readReplicas”：{}，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “状态”：“在线”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
<font></font>
	</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如上所示，新创建的群集是单主群集，并用作主群集</font></font><code class="literal">gr-member-1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-using-router"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.3在InnoDB集群中使用MySQL路由器</font></font></h2>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何使用MySQL Router与InnoDB集群来实现高可用性。</font><font style="vertical-align: inherit;">无论您是否部署了沙箱或生产集群，MySQL路由器都可以使用该</font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">根据InnoDB集群的元数据进行自我配置
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将自动配置MySQL路由器以将连接路由到群集的服务器实例。</font><font style="vertical-align: inherit;">客户端应用程序连接到MySQL路由器提供的端口，而不需要了解InnoDB集群拓扑。</font><font style="vertical-align: inherit;">如果发生意外故障，InnoDB集群将自动进行自我调整，并且MySQL路由器检测到更改。</font><font style="vertical-align: inherit;">这消除了您的客户端应用程序处理故障转移的需要。</font><font style="vertical-align: inherit;">有关更多信息，请参阅
       </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-innodb-cluster.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL InnoDB群集的路由</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不要尝试手动配置MySQL路由器重定向到InnoDB集群的端口。</font><font style="vertical-align: inherit;">始终使用该
         </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，因为这可以确保MySQL路由器从InnoDB集群的元数据中获取其配置。</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-general-metadata.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">群集元数据和状态</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      建议的MySQL路由器部署与应用程序位于同一主机上。</font><font style="vertical-align: inherit;">在使用沙箱部署时，所有内容都在单个主机上运行，​​因此您将MySQL路由器部署到同一主机。</font><font style="vertical-align: inherit;">在使用生产部署时，我们建议将一个MySQL路由器实例部署到每台用于托管客户端应用程序的计算机。</font><font style="vertical-align: inherit;">也可以将MySQL路由器部署到应用程序实例连接的通用计算机。</font><font style="vertical-align: inherit;">您需要InnoDB集群的MASTER键来自动配置MySQL路由器。

      
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      假设已经</font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-installation.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装了MySQL路由器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参阅
       </font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-installation.html" target="_top"><font style="vertical-align: inherit;">安装MySQL路由器</font></a><font style="vertical-align: inherit;">），请使用该
       </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项提供属于InnoDB集群的服务器实例的位置。</font><font style="vertical-align: inherit;">MySQL路由器使用包含的元数据缓存插件来检索InnoDB群集的元数据，该元数据由组成InnoDB群集的服务器实例地址列表及其在群集中的角色组成。</font><font style="vertical-align: inherit;">您传递MySQL路由器应从中检索InnoDB集群元数据的服务器的URI类型字符串。</font><font style="vertical-align: inherit;">例如：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlrouter --bootstrap ic@ic-1:3306 --user=mysqlrouter </code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      系统会提示您输入MySQL路由器使用的实例密码和加密密钥。</font><font style="vertical-align: inherit;">此加密密钥用于加密MySQL路由器连接到群集所使用的实例密码。</font><font style="vertical-align: inherit;">您还可以显示可用于连接到InnoDB群集的端口。</font><font style="vertical-align: inherit;">在上面的例子中，</font><font style="vertical-align: inherit;">MySQL路由器引导进程创建一个
       </font></font><code class="filename">mysqlrouter.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，其中基于从传递给</font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的地址中检索的群集元数据的设置</font></font><code class="literal">ic@ic-1:3306</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">根据检索到的InnoDB集群元数据，MySQL路由器自动创建一个配置文件，其中包含一个</font><font style="vertical-align: inherit;">
      包含集群中所有服务器实例地址</font><font style="vertical-align: inherit;">的
       </font></font><code class="literal">metadata_cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分
       </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-conf-options.html#option_mysqlrouter_bootstrap_server_addresses" target="_top"><code class="option">bootstrap_server_addresses</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
    </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[metadata_cache：prodCluster]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Router_ID与= 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bootstrap_server_addresses = MySQL的：// IC @ IC-1：3306，MySQL的：// IC @ IC-2：3306，MySQL的：// IC @ IC-3：3306</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用户= mysql_router1_jy95yozko3k2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
metadata_cluster = prodCluster</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TTL = 300</font></font><font></font>
</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在引导MySQL路由器后通过添加另一个服务器实例更改集群拓扑时，需要
         </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-conf-options.html#option_mysqlrouter_bootstrap_server_addresses" target="_top"><code class="option">bootstrap_server_addresses</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        根据更新的元数据进行更新。</font><font style="vertical-align: inherit;">使用该</font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">重新启动MySQL路由器
         </font><font style="vertical-align: inherit;">，或手动编辑</font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-conf-options.html#option_mysqlrouter_bootstrap_server_addresses" target="_top"><code class="option">bootstrap_server_addresses</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="filename">mysqlrouter.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">并重新启动MySQL路由器。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      生成的MySQL路由器配置会创建用于连接到群集的TCP端口。</font><font style="vertical-align: inherit;">创建使用Classic MySQL协议和X协议与集群通信的端口。</font><font style="vertical-align: inherit;">要使用X协议，服务器实例必须安装并配置X插件。</font><font style="vertical-align: inherit;">对于沙箱部署，实例会自动设置X插件。</font><font style="vertical-align: inherit;">对于生产部署，如果要使用X协议，则需要在每个实例上安装和配置X插件，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/document-store.html#document-store-setting-up" title="19.3将MySQL设置为文档存储"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第19.3节“将MySQL设置为文档存储”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认的可用TCP端口是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">6446</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  - 用于经典MySQL协议读写会话，其中MySQL路由器将传入连接重定向到主服务器实例。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">6447</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  - 用于经典MySQL协议只读会话，其中MySQL路由器将传入连接重定向到其中一个辅助服务器实例。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">64460</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  - 用于X协议读写会话，其中MySQL路由器将传入连接重定向到主服务器实例。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">64470</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  - 用于X协议只读会话，其中MySQL路由器将传入连接重定向到其中一个辅助服务器实例。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      根据您的MySQL路由器配置，端口号可能与上述不同。</font><font style="vertical-align: inherit;">例如，如果您使用该
       </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysqlrouter.html#option_mysqlrouter_conf-base-port" target="_top"><code class="option">--conf-base-port</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项或
       </font></font><a class="link" href="/mysql-5.7-google-zh/group-replication.html#sysvar_group_replication_single_primary_mode"><code class="literal">group_replication_single_primary_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      变量。</font><font style="vertical-align: inherit;">当您启动MySQL路由器时会列出确切的端口。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      传入连接重定向的方式取决于正在使用的群集类型。</font><font style="vertical-align: inherit;">使用单主群集时，读写会话将重定向到单个主群集，并将多主群集读写会话重定向到其中一个主实例。</font><font style="vertical-align: inherit;">对于传入的只读连接，MySQL路由器以循环方式将连接重定向到其中一个辅助实例。

      
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一旦引导和配置，启动MySQL路由器：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlrouter &amp;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      或者，设置一项服务以在系统引导时自动启动MySQL路由器，请参阅
       </font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysql-router-server-starting.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动MySQL路由器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在，您可以将MySQL客户端（如MySQL Shell）连接到上述的一个传入MySQL路由器端口，并查看客户端如何透明地连接到其中一个InnoDB集群实例。
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlsh --uri root@localhost:6442</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要验证您实际连接的是哪个实例，只需针对</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_port"><code class="literal">port</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font><font style="vertical-align: inherit;">发出SQL查询即可
       </font><font style="vertical-align: inherit;">。

      
    </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>\sql</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
切换到SQL模式...命令以...结尾;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的-SQL&gt; </font></font><strong class="userinput"><code>select @@port;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ port |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3310 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------- +</font></font><font></font>
</pre>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h3 class="title"><a name="test-failover"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试高可用性</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要测试高可用性是否有效，请通过杀死一个实例来模拟意外中断。</font><font style="vertical-align: inherit;">群集检测到实例离开群集并重新配置自身的事实。</font><font style="vertical-align: inherit;">集群如何自行重新配置取决于您使用的是单主集群还是多主集群，以及实例在集群中的角色。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在单主模式下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果当前主节点离开集群，则其中一个辅助节点被选为新的主节点，实例按照最低优先级排序
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQL路由器将读写连接重定向到新选择的主连接。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果当前的辅助节点离开集群，MySQL路由器会停止将只读连接重定向到实例。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/group-replication.html#group-replication-single-primary-mode" title="17.4.1.1单主模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17.4.1.1节“单主模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在多主模式下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果当前的“R / W”实例离开集群，MySQL路由器会将读写连接重定向到其他主节点。

            
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果当前的“R / O”实例离开集群，

            
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/group-replication.html#group-replication-multi-primary-mode" title="17.4.1.2多主模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17.4.1.2节“多主模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有多种方法可以模拟离开集群的实例，例如，您可以强制停止实例上的MySQL服务器，或者在</font></font><code class="literal">dba.killSandboxInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试沙盒部署时</font><font style="vertical-align: inherit;">使用AdminAPI
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在此示例中，假设存在具有三个服务器实例的单主沙箱集群部署，并且侦听端口3310的实例是当前的主实例。</font><font style="vertical-align: inherit;">模拟意外离开集群的实例：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>dba.killSandboxInstance(3310)</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用该</font></font><code class="literal">\sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">在MySQL Shell中切换到SQL模式，
         </font><font style="vertical-align: inherit;">并验证
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_port"><code class="literal">port</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量以检查您连接的是哪个实例。</font><font style="vertical-align: inherit;">请注意，由于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与原始主连接的连接丢失</font><font style="vertical-align: inherit;">，第一条</font><font style="vertical-align: inherit;">语句失败。</font><font style="vertical-align: inherit;">这意味着当前会话已关闭，MySQL Shell将自动为您重新连接，并且当您再次发出命令时，新端口将得到确认。
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>\sql</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
切换到SQL模式...命令以...结尾;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的-SQL&gt; </font></font><strong class="userinput"><code>SELECT @@port;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误：2013（HY000）：在查询期间与MySQL服务器失去连接</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全球会议断开连接。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
试图重新连接到'root @ localhost：6446'...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全球会议已成功重新连接。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的-SQL&gt; </font></font><strong class="userinput"><code>SELECT @@port;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ port |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3330 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这表明InnoDB集群为我们提供了自动故障转移，MySQL路由器已将我们自动重新连接到新的主实例，并且我们具有高可用性。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="router-and-metadata-servers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL路由器和元数据服务器</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当MySQL路由器针对集群进行引导时，它将服务器实例的地址记录在其配置文件中。</font><font style="vertical-align: inherit;">如果在引导MySQL路由器后将任何其他实例添加到群集，它们不会自动检测到，因此</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于连接路由。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为确保新添加的实例正确路由，必须针对集群引导MySQL路由器以读取更新后的元数据。</font><font style="vertical-align: inherit;">这意味着您必须重新启动MySQL路由器并包含该</font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-router/2.1/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-working-with-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.4使用InnoDB集群</font></font></h2>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何使用InnoDB集群，以及如何处理常见的管理任务。

      
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#retrieving-an-innodb-cluster" title="检索InnoDB集群"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索InnoDB集群</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#check-innodb-cluster-status" title="检查InnoDB群集状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查InnoDB群集状态</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#describe-structure-innodb-cluster" title="描述InnoDB集群的结构"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述InnoDB集群的结构</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="超级只读和实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#manage-sandbox-instances" title="管理沙箱实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理沙箱实例</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#remove-instances-from-innodb-cluster" title="从InnoDB集群中删除实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从InnoDB集群中删除实例</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#customize-your-cluster" title="定制InnoDB集群"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定制InnoDB集群</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#rejoin-cluster" title="重新加入群集"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新加入群集</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#restore-cluster-from-quorum-loss" title="从法定人数损失恢复集群"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从法定人数损失恢复集群</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#reboot-outage" title="从重大中断重新启动群集"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从重大中断重新启动群集</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#rescan-cluster" title="重新扫描群集"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新扫描群集</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#check-instance-state" title="检查实例状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查实例状态</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#dissolve-innodb-cluster" title="分解InnoDB集群"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分解InnoDB集群</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-securing" title="保护您的群集"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护您的群集</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#create-whitelist-servers" title="创建服务器白名单"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建服务器白名单</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#use-mysql-shell-execute-script" title="使用MySQL Shell执行脚本"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用MySQL Shell执行脚本</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h3 class="title"><a name="retrieving-an-innodb-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索InnoDB集群</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当您使用创建集群时
         </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，操作返回可以分配给变量的Cluster对象。</font><font style="vertical-align: inherit;">您可以使用此对象来处理群集，例如添加实例或检查群集的状态。</font><font style="vertical-align: inherit;">如果您想在以后再次检索集群，例如在重新启动MySQL Shell之后，请使用该
         </font><font style="vertical-align: inherit;">函数。</font><font style="vertical-align: inherit;">例如：
      </font></font><code class="literal">dba.getCluster(<em class="replaceable"><code>name</code></em>,
        [<em class="replaceable"><code>options</code></em>])</code><font style="vertical-align: inherit;"></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>var cluster1 = dba.getCluster()</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您未指定</font></font><em class="replaceable"><code>name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        群集，则返回默认群集。</font><font style="vertical-align: inherit;">如果MySQL Shell全局会话当前连接的服务器实例的InnoDB集群元数据中存储了多个集群，请指定</font></font><em class="replaceable"><code>name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要检索的集群。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="check-innodb-cluster-status"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查InnoDB群集状态</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        群集对象提供了</font></font><code class="literal">status()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使您能够检查群集如何运行的方法。</font><font style="vertical-align: inherit;">在您可以检查InnoDB集群的状态之前，您需要通过连接到它的任何实例来获取对InnoDB集群对象的引用。</font><font style="vertical-align: inherit;">但是，如果要更改群集的配置，则必须连接到“R / W”实例。</font><font style="vertical-align: inherit;">颁发</font></font><code class="literal">status()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将根据您连接的服务器实例知道的群集视图检索群集的状态，并输出状态报告。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          集群中的实例状态直接影响状态报告中提供的信息。</font><font style="vertical-align: inherit;">与属于集群的实例相比，离开集群的实例提供了集群的不同视图。</font><font style="vertical-align: inherit;">因此，请确保您连接的实例具有状态
           </font></font><code class="literal">ONLINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。

          
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关InnoDB群集如何运行的信息，请使用群集的</font></font><code class="literal">status()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql-js&gt; </font></font><strong class="userinput"><code>var cluster = dba.getCluster()</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql-js&gt;</font></font><strong class="userinput"><code>cluster.status()</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “clusterName”：“testCluster”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “defaultReplicaSet”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “name”：“默认”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “primary”：“localhost：3320”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	“ssl”：“需要”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “状态”：“确定”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “statusText”：“群集处于联机状态，并且最多可容忍一次故障。”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “拓扑”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “localhost：3310”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “address”：“localhost：3310”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “模式”：“R / O”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “readReplicas”：{}， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “状态”：“在线”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “localhost：3320”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “address”：“localhost：3320”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “mode”：“R / W”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “readReplicas”：{}， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “状态”：“在线”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            “localhost：3330”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “address”：“localhost：3330”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “模式”：“R / O”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “readReplicas”：{}， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “状态”：“在线”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        输出的信息</font></font><code class="literal">cluster.status()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        提供以下信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            clusterName：在此期间分配给此群集的名称
             </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            defaultReplicaSet：属于InnoDB集群并包含数据集的服务器实例。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            主要：当集群仅以单主模式运行时显示。</font><font style="vertical-align: inherit;">显示当前主实例的地址。</font><font style="vertical-align: inherit;">如果此字段未显示，则群集正在以多主模式运行。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            ssl：集群是否使用安全连接。</font><font style="vertical-align: inherit;">显示的值</font></font><code class="literal">REQUIRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
             </font></font><code class="literal">DISABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这取决于如何
             </font></font><code class="literal">memberSslMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择在过程中，可以配置</font></font><code class="literal">createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此参数返回的值对应于</font></font><a class="link" href="/mysql-5.7-google-zh/group-replication.html#sysvar_group_replication_ssl_mode"><code class="literal">group_replication_ssl_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            实例上的服务器变量</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-securing" title="保护您的群集"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护您的群集</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            状态：群集的此元素的状态。</font><font style="vertical-align: inherit;">对于整个集群来说，这描述了该集群提供的高可用性。</font><font style="vertical-align: inherit;">状态是以下之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">ONLINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：实例在线并参与集群。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">OFFLINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：该实例与其他实例失去连接。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">RECOVERING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：实例正试图通过在它成为</font></font><code class="literal">ONLINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员</font><font style="vertical-align: inherit;">之前检索它需要的事务来与集群同步
                 </font><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">UNREACHABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：该实例已失去与群集的通信。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">ERROR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：实例在恢复阶段或应用事务时遇到错误。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  一旦一个实例进入</font></font><code class="literal">ERROR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  状态，该
                   </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  选项被设置为</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要离开
                   </font></font><code class="literal">ERROR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态，您必须手动配置实例
                   </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p>
                <code class="literal">(MISSING)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：作为配置集群一部分的实例的状态，但当前不可用。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  该</font></font><code class="literal">MISSING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态特定于InnoDB群集，它不是由组复制生成的状态。</font><font style="vertical-align: inherit;">MySQL Shell使用此状态来指示在元数据中注册的实例，但在实时集群视图中找不到该实例。
</font></font></p>
</div>
</li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            拓扑：已添加到集群的实例。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            实例的主机名：实例的主机名，例如localhost：3310。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            角色：此实例在集群中提供了什么功能。</font><font style="vertical-align: inherit;">目前只有HA，用于高可用性。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            模式：服务器是读写（“R / W”）还是只读（“R / O”）。</font><font style="vertical-align: inherit;">该模式指示</font></font><code class="literal">R/W</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （可读写）或</font></font><code class="literal">R/O</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（只读）。</font><font style="vertical-align: inherit;">在单主模式下，只有标有“R / W”的实例才能执行更新数据库的事务，因此它是主要的。</font><font style="vertical-align: inherit;">如果由于某种原因（例如意外停止）导致该实例无法访问，其余“R / O”实例之一会自动替换其位置并成为新的“R / W”主节点。</font><font style="vertical-align: inherit;">在多主模式下，所有实例都标记为“R / W”并且没有单个选举的主要实例。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="describe-structure-innodb-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述InnoDB集群的结构</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要获得有关InnoDB集群本身结构的信息，请使用以下</font></font><code class="literal">cluster.describe()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.describe();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “clusterName”：“test”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “adminType”：“本地”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    “defaultReplicaSet”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “name”：“默认”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        “实例”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “name”：“localhost：3310”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “host”：“localhost：3310”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “name”：“localhost：3320”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “host”：“localhost：3320”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “name”：“localhost：3330”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “host”：“localhost：3330”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                “角色”：“HA”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该函数的输出显示InnoDB集群的结构，包括其所有配置信息等。

        
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="super-read-only-on-instance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只要组复制停止，该
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量就设置</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为确保不向该实例写入数据。</font><font style="vertical-align: inherit;">当您尝试通过以下AdminAPI命令使用此类实例时，您可以选择</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实例</font><font style="vertical-align: inherit;">上设置
         </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">dba.configureLocalInstance()</code>
          </p></li><li class="listitem"><p>
            <code class="literal">dba.createCluster()</code>
          </p></li><li class="listitem"><p>
            <code class="literal">dba.rebootClusterFromCompleteOutage()</code>
          </p></li><li class="listitem"><p>
            <code class="literal">dba.dropMetadataSchema()</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当AdminAPI遇到具有</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互模式</font><font style="vertical-align: inherit;">的实例时，
         </font><font style="vertical-align: inherit;">您可以选择设置
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql-js&gt; var myCluster = dba.createCluster（'testCluster'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将在实例'ic @ ic-1：3306'上创建一个新的InnoDB集群。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'ic @ ic-1：3306'的MySQL实例目前拥有super_read_only </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
系统变量设置为保护它免受应用程序的无意更新。 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您必须先取消设置才能对此实例执行任何更改。 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有关更多信息，请参阅：https：//dev.mysql.com/doc/refman/en/server-system-variables.html#sysvar_super_read_only。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意：有'ic @ ic-1：3306'的开放会话。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可能想要终止这些会话以防止它们执行意外的更新： </font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1个公开课“ic @ ic-1：3306”。 </font></font><font></font>
<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
你想禁用super_read_only并继续吗？</font><font style="vertical-align: inherit;">[Y | N]：</font></font><font></font>
	</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        显示实例当前活动会话的数量。</font><font style="vertical-align: inherit;">您必须确保没有应用程序可能无意中写入实例。</font><font style="vertical-align: inherit;">通过回答</font></font><code class="literal">y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认AdminAPI可以写入实例。</font><font style="vertical-align: inherit;">如果列出的实例有多个打开的会话，请在允许AdminAPI设置之前小心操作
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要强制该功能</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在脚本中</font><font style="vertical-align: inherit;">设置
         </font><font style="vertical-align: inherit;">，请将</font></font><code class="literal">clearReadOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项设置为
         </font></font><code class="literal">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如
        </font></font><code class="literal">dba.configureLocalInstance(instance, {clearReadOnly:
        true}).</code>
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="manage-sandbox-instances"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理沙箱实例</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一旦沙箱实例正在运行，可以随时使用以下方式更改其状态：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            停止使用沙箱实例
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不同于此，这会优雅地停止实例
             </font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">dba.stopSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">dba.killSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            开始使用沙箱实例
             </font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">dba.startSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            杀死一个沙箱实例使用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将停止实例而不会正常停止它，并且可用于模拟意外的暂停。
          </font></font><code class="literal">dba.killSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            删除沙箱实例使用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将完全从您的文件系统中删除沙箱实例。
</font></font><code class="literal">dba.deleteSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="remove-instances-from-innodb-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从InnoDB集群中删除实例</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您愿意，可以随时从群集中删除实例。</font><font style="vertical-align: inherit;">这可以通过该</font></font><code class="literal">removeInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">完成，
         </font><font style="vertical-align: inherit;">如下例所示：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.removeInstance('root@localhost:3310')</code></strong>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="customize-your-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定制InnoDB集群</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        创建群集并向其添加实例时，组名，本地地址和种子实例等值由AdminAPI自动配置。</font><font style="vertical-align: inherit;">这些默认值是大多数部署的推荐值，但高级用户可以通过将以下选项传递给</font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
         </font><font style="vertical-align: inherit;">来覆盖这些默认值</font></font><code class="literal">cluster.addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要自定义由InnoDB集群创建的复制组的名称，请将该</font></font><code class="literal">groupName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">给该</font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">这设置了
         </font></font><a class="link" href="/mysql-5.7-google-zh/group-replication.html#sysvar_group_replication_group_name"><code class="literal">group_replication_group_name</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量。</font><font style="vertical-align: inherit;">该名称必须是有效的UUID。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要定制实例为其他实例的连接提供的地址，请将该</font></font><code class="literal">localAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">传递
         </font><font style="vertical-align: inherit;">给
         </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
         </font></font><code class="literal">cluster.addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">以格式指定地址
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将</font><font style="vertical-align: inherit;">
        在实例上</font><font style="vertical-align: inherit;">设置
         </font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">该地址必须可供群集中的所有实例访问，并且必须仅用于内部群集通信。</font><font style="vertical-align: inherit;">换句话说，不要使用此地址与实例进行通信。
      </font></font><code class="literal"><em class="replaceable"><code>host</code></em>:<em class="replaceable"><code>port</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/group-replication.html#sysvar_group_replication_local_address"><code class="literal">group_replication_local_address</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在实例加入集群时自定义用作种子的实例，请将该</font></font><code class="literal">groupSeeds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">给</font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
         </font></font><code class="literal">cluster.addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">当新实例加入集群并用于向新实例提供数据时，联系种子实例。</font><font style="vertical-align: inherit;">地址被指定为逗号分隔的列表，例如
         </font></font><code class="literal">host1:port1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">host2:port2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这配置了
         </font></font><a class="link" href="/mysql-5.7-google-zh/group-replication.html#sysvar_group_replication_group_seeds"><code class="literal">group_replication_group_seeds</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参阅由这些AdminAPI选项配置的系统变量的文档。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="rejoin-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新加入群集</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果一个实例离开集群，例如因为它失去了连接并且没有或不能自动重新加入集群，那么可能需要在稍后阶段重新加入集群。</font><font style="vertical-align: inherit;">重新加入一个实例到集群问题
         </font></font><code class="literal">cluster.rejoinInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在一个实例没有配置持久化的情况下，例如当你没有</font></font><code class="literal">dba.configureLocalInstance()</code>
        <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本地</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布
         </font><font style="vertical-align: inherit;">实例但是它已经被添加到一个集群时，重启后实例不会自动重新加入集群。</font><font style="vertical-align: inherit;">解决方案是发布
         </font></font><code class="literal">cluster.rejoinInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便实例再次添加到集群。</font><font style="vertical-align: inherit;">然后连接到实例，在本地运行MySQL Shell并发出
         </font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可确保InnoDB集群配置持久化到实例的选项文件，以使其自动重新加入集群。
</font></font></p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果实例有，
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么您可能需要确认AdminAPI可以设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="超级只读和实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="restore-cluster-from-quorum-loss"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从法定人数损失恢复集群</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果一个或多个实例发生故障，则集群可能会失去法定人数，这就是投票给新的主服务器的能力。</font><font style="vertical-align: inherit;">在这种情况下，您可以使用该方法重新建立仲裁
         </font></font><code class="literal">cluster.forceQuorumUsingPartitionOf()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下MySQL Shell示例所示：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  //打开集群的会话</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster = dba.getCluster("prodCluster")</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  //集群失去法定人数并显示其状态</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  //“状态”：“NO_QUORUM”</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.forceQuorumUsingPartitionOf("localhost:3310")</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  通过使用由[localhost：3310]组成的分区，从法定数的丢失中恢复replicaset'default'</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  请提供“root @ localhost：3310”的密码：******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  恢复InnoDB集群...</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  InnoDB集群使用实例“root @ localhost：3310”中的分区成功恢复。</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  警告：为避免裂脑情形，请确保复制集的所有其他成员</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  将被删除或加入已恢复的组。</font></font><font></font>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="reboot-outage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从重大中断重新启动群集</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        

        如果您的集群遭受完全中断，则可以确保使用正确的重新配置
         </font></font><code class="literal">dba.rebootClusterFromCompleteOutage()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在集群完全停止的情况下，必须启动实例，然后才能启动集群。</font><font style="vertical-align: inherit;">例如，如果沙箱集群正在运行的计算机已重新启动，且实例位于端口3310,3320和3330，则问题如下：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql-js&gt; dba.startSandboxInstance（3310）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql-js&gt; dba.startSandboxInstance（3320）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql-js&gt; dba.startSandboxInstance（3330）</font></font><font></font>
    </pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这可确保沙箱实例正在运行。</font><font style="vertical-align: inherit;">在生产部署的情况下，您将不得不在MySQL Shell之外启动实例。</font><font style="vertical-align: inherit;">一旦实例启动，连接到一个实例并运行MySQL Shell。</font><font style="vertical-align: inherit;">然后发出以下命令重新启动集群
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><strong class="userinput"><code>        
mysql-js&gt; <strong class="userinput"><code>shell.connect('root@localhost:3310');</code></strong>
mysql-js&gt; <strong class="userinput"><code>var cluster = dba.rebootClusterFromCompleteOutage();</code></strong>
</code></strong>
</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
小费
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果实例有，
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么您可能需要确认AdminAPI可以设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="超级只读和实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级只读和实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这可确保在完全停机后正确重新配置群集。</font><font style="vertical-align: inherit;">它使用MySQL Shell连接的实例作为新的种子实例，并根据该实例的现有元数据恢复集群。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果此过程失败，并且群集元数据已严重损坏，则可能需要删除元数据并重新创建群集。</font><font style="vertical-align: inherit;">您可以使用删除群集元数据</font></font><code class="literal">dba.dropMetadataSchema()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">dba.dropMetadataSchema()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有在无法恢复集群的情况下，</font><font style="vertical-align: inherit;">
          该</font><font style="vertical-align: inherit;">方法才应作为最后的手段。</font><font style="vertical-align: inherit;">它不能被撤消。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="rescan-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新扫描群集</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果在不使用AdminAPI的情况下更改实例配置，则需要重新扫描群集以更新InnoDB群集元数据。</font><font style="vertical-align: inherit;">例如，如果您手动将新实例添加到组复制组，则不会根据此群集更改来修改InnoDB群集元数据，因为未使用MySQL Shell。</font><font style="vertical-align: inherit;">在这种情况下，需要重新扫描群集
         </font></font><code class="literal">cluster.rescan()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以更新InnoDB群集元数据。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在命令</font></font><code class="literal">cluster.rescan()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行后，会识别出新发现的实例。</font><font style="vertical-align: inherit;">系统会提示您根据需要将每个新发现的实例添加到群集中，或者可以选择忽略它们。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        还报告不再属于群集或不可用的实例。</font><font style="vertical-align: inherit;">在这种情况下，系统会提示您删除实例，或者以后可以尝试使用类似命令将其添加回群集中
         </font></font><code class="literal">cluster.rejoin('ic@ic-4:3306')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="check-instance-state"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查实例状态</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">cluster.checkInstanceState()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数可用于验证实例上的现有数据不会阻止其加入群集。</font><font style="vertical-align: inherit;">此过程通过验证实例的全局事务标识符（GTID）状态与群集已处理的GTID进行比较。</font><font style="vertical-align: inherit;">有关</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-concepts" title="16.1.3.1 GTID概念"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GTID的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多信息，请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-concepts" title="16.1.3.1 GTID概念"><font style="vertical-align: inherit;">第16.1.3.1节“GTID概念”</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过此检查，您可以确定已处理事务的实例是否可以添加到群集中。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下演示在运行的MySQL Shell中发布：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.checkInstanceState('ic@ic-4:3306')</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        

        该功能的输出可以是以下之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            OK new：实例未执行任何GTID事务，因此它不会与群集执行的GTID冲突
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            OK可恢复：实例执行了与群集种子实例的已执行GTID不冲突的GTID
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            ERROR diverged：实例执行了GTID，它与集群种子实例的已执行GTID分歧
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            ERROR lost_transactions：实例比集群种子实例的已执行GTID执行的GTID更多
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        具有OK状态的实例可以添加到群集，因为实例上的任何数据都与群集一致。</font><font style="vertical-align: inherit;">换句话说，被检查的实例没有执行任何与群集执行的GTID冲突的事务，并且可以恢复到与其他群集实例相同的状态。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="dissolve-innodb-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分解InnoDB集群</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要解散InnoDB集群，请连接到读写实例，例如单主集群中的主集群，然后使用该</font></font><code class="literal">Cluster.dissolve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">这将删除与群集关联的所有元数据和配置，并禁用实例上的群组复制。</font><font style="vertical-align: inherit;">任何在实例之间复制的数据都不会被删除。</font><font style="vertical-align: inherit;">无法撤销群集的解散，因此您必须通过</font></font><code class="literal">force: true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认您想要解散群集。</font><font style="vertical-align: inherit;">例如：再次使用它来创建它
         </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt; </font></font><strong class="userinput"><code>session</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;ClassicSession：根@本地：3310&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的-JS&gt; </font></font><strong class="userinput"><code>cluster.dissolve({force:true})</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该集群已成功解散。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
复制被禁用，但用户数据保持不变。</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          发出后</font></font><code class="literal">cluster.dissolve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，分配给该</font></font><code class="literal">Cluster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象的</font><font style="vertical-align: inherit;">任何变量</font><font style="vertical-align: inherit;">不再有效。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="mysql-innodb-cluster-securing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护您的群集</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器实例可以配置为使用安全连接。</font><font style="vertical-align: inherit;">有关在MySQL中使用SSL的一般信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#encrypted-connections" title="6.4使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4节“使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">本节介绍如何配置群集以使用SSL。</font><font style="vertical-align: inherit;">另外一个安全可能性是配置哪些服务器可以访问集群，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#create-whitelist-servers" title="创建服务器白名单"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建服务器白名单</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          配置群集以使用SSL后，您必须将服务器添加到</font></font><code class="literal">ipWhitelist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当</font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于设置群集时，如果服务器实例提供SSL加密，则会在种子实例上自动启用它。</font><font style="vertical-align: inherit;">将该</font></font><code class="literal">memberSslMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">传递
         </font><font style="vertical-align: inherit;">给该
         </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法以指定不同的SSL模式。</font><font style="vertical-align: inherit;">集群的SSL模式只能在创建时进行设置。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">memberSslMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项是一个字符串，用于配置要使用的SSL模式，默认为</font></font><code class="literal">AUTO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">允许的值为
         </font></font><code class="literal">DISABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">REQUIRED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><code class="literal">AUTO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些模式被定义为：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置
             </font></font><code class="literal">createCluster({memberSslMode:'DISABLED'})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可确保群集中的种子实例禁用SSL加密。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置
             </font></font><code class="literal">createCluster({memberSslMode:'REQUIRED'})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            然后SSL加密对于集群中的种子实例启用。</font><font style="vertical-align: inherit;">如果无法启用，则会引发错误。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置
             </font></font><code class="literal">createCluster({memberSslMode:'AUTO'})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （默认），然后SSL加密在服务器实例支持时自动启用，如果服务器不支持，则禁用SSL加密。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用商业版本的MySQL时，默认启用SSL，您可能需要为所有实例配置白名单。</font><font style="vertical-align: inherit;">请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html#create-whitelist-servers" title="创建服务器白名单"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建服务器的白名单</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        发出</font></font><code class="literal">cluster.addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">cluster.rejoinInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令时，将根据为种子实例找到的设置启用或禁用实例上的SSL加密。</font><font style="vertical-align: inherit;">对于更多控制，该
         </font><font style="vertical-align: inherit;">命令</font></font><code class="literal">cluster.addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">cluster.rejoinInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令接受该
         </font></font><code class="literal">memberSslMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">这可用于在实例加入时测试群集的SSL设置。</font><font style="vertical-align: inherit;">在这种情况下命令的行为是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置</font></font><code class="literal">memberSslMode:'DISABLED'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可确保集群中的实例禁用SSL加密。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置</font></font><code class="literal">memberSslMode:'REQUIRED'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制为集群中的实例启用SSL加密。

            
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置</font></font><code class="literal">memberSslMode:'AUTO'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认），然后根据种子实例（群集的其他成员）使用的设置和实例本身提供的可用SSL支持自动启用或禁用SSL加密。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当使用</font></font><code class="literal">createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
         </font></font><code class="literal">adoptFromGR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择采用现有的组复制组，无SSL设置改变所采用的集群：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">memberSslMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能用于
             </font></font><code class="literal">adoptFromGR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果采用的集群的SSL设置与MySQL Shell支持的不同，换句话说，用于组复制恢复和组通信的SSL，则两个设置都不会被修改。</font><font style="vertical-align: inherit;">这意味着您无法将新实例添加到群集，除非您为采用的群集手动更改设置。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于群组复制恢复和群组通信，MySQL Shell始终为群集启用或禁用SSL，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/group-replication.html#group-replication-secure-socket-layer-support-ssl" title="17.5.2安全套接字层支持（SSL）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17.5.2节“安全套接字层支持（SSL）”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">被执行的验证并且如果发出错误这些设置是用于种子实例（例如作为的结果不同</font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
         </font></font><code class="literal">adoptFromGR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加一个新的实例给集群时）。</font><font style="vertical-align: inherit;">必须为群集中的所有实例启用或禁用SSL加密。</font><font style="vertical-align: inherit;">执行验证以确保在将新实例添加到群集时保持此不变量。

        
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">deploySandboxInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令默认尝试部署带有SSL加密支持的沙箱实例。</font><font style="vertical-align: inherit;">如果不可行，则服务器实例部署时不支持SSL。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">ignoreSslError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项设置为false以确保沙盒实例部署时支持SSL，如果无法提供SSL支持，则发出错误。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">ignoreSslError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为true，那么这是缺省情况，如果无法提供SSL支持并且服务器实例未部署SSL支持，则在操作期间不会发出错误。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="create-whitelist-servers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建服务器白名单</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        

        在使用群集的</font></font><code class="literal">createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，，
         </font></font><code class="literal">addInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">rejoinInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法时，您可以选择指定属于群集的已批准服务器的列表（称为白名单）。</font><font style="vertical-align: inherit;">通过以这种方式明确指定白名单，您可以提高群集的安全性，因为只有白名单中的服务器才能连接到群集。</font><font style="vertical-align: inherit;">默认情况下，如果未明确指定，白名单将自动设置为服务器具有网络接口的专用网络地址。</font><font style="vertical-align: inherit;">要配置白名单，请</font></font><code class="literal">ipWhitelist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用该方法时</font><font style="vertical-align: inherit;">指定要添加</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的服务器
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将服务器作为逗号分隔的列表传递，并用引号括起来。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">ipWhitelist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项配置
         </font></font><a class="link" href="/mysql-5.7-google-zh/group-replication.html#sysvar_group_replication_ip_whitelist"><code class="literal">group_replication_ip_whitelist</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        实例上的系统变量。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="mysqlsh" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的-JS&gt;</font></font><strong class="userinput"><code> cluster.addInstance("ic@ic-3:3306", {ipWhitelist: "203.0.113.0/24, 198.51.100.110"})</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这将实例配置为只接受来自地址</font></font><code class="literal">203.0.113.0/24</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font><font style="vertical-align: inherit;">服务器的连接</font></font><code class="literal">198.51.100.110</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从MySQL 5.7.21开始，白名单还可以包含主机名，只有当另一台服务器发出连接请求时才会解析主机名。
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          主机名本来就不如白名单中的IP地址安全。</font><font style="vertical-align: inherit;">MySQL执行FCrDNS验证，该验证提供了良好的保护级别，但可能受到某些类型攻击的影响。</font><font style="vertical-align: inherit;">仅在严格需要时才在白名单中指定主机名称，并确保用于名称解析的所有组件（如DNS服务器）均受您的控制。</font><font style="vertical-align: inherit;">您还可以使用hosts文件在本地实施名称解析，以避免使用外部组件。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="use-mysql-shell-execute-script"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用MySQL Shell执行脚本</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以使用脚本自动执行群集配置。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlsh -f <em class="replaceable"><code>setup-innodb-cluster.js</code></em></code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在脚本文件名后指定的任何命令行选项都被传递给脚本，而</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MySQL Shell。</font><font style="vertical-align: inherit;">您可以使用</font></font><code class="literal">os.argv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript中的</font></font><code class="literal">sys.argv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">Python中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">数组
           </font><font style="vertical-align: inherit;">访问这些选项
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这两种情况下，数组中第一个选项都是脚本名称。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        示例脚本文件的内容如下所示：
      </font></font></p><pre data-lang="js" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  print（'MySQL InnoDB集群沙箱设置\ n'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  打印（ '================================== \ n'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  print（'使用3个MySQL服务器沙盒实例设置MySQL InnoDB集群。\ n'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  print（'实例将被安装在〜/ mysql-sandboxes中。\ n'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  print（'他们将在端口3310,3320和3330上运行。\ n \ n'）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  var dbPass = shell.prompt（'请输入MySQL根帐户的密码：'，{type：“password”}）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  尝试{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     print（'\ nDeploying the sandbox instances。'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     dba.deploySandboxInstance（3310，{password：dbPass}）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     打印（'。'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     dba.deploySandboxInstance（3320，{password：dbPass}）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     打印（'。'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     dba.deploySandboxInstance（3330，{password：dbPass}）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     print（'。\ n已成功部署Sandbox实例。\ n \ n'）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     print（'设置InnoDB集群... \ n'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     shell.connect（'root @ localhost：3310'，dbPass）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     var cluster = dba.createCluster（“prodCluster”）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     打印（'将实例添加到群集'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     cluster.addInstance（{user：“root”，host：“localhost”，port：3320，password：dbPass}）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     打印（'。'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     cluster.addInstance（{user：“root”，host：“localhost”，port：3330，password：dbPass}）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     print（'。\ nInstances成功添加到群集'）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     print（'\ nInnoDB集群部署成功。\ n'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  } catch（e）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     print（'\ n InnoDB集群无法创建。\ n \ n错误：'+</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     + e.message +'\ n'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-limitations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.5已知限制</font></font></h2>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍InnoDB集群的已知限制。</font><font style="vertical-align: inherit;">由于InnoDB集群使用组复制，因此您应该了解其局限性，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/group-replication.html#group-replication-limitations" title="17.7.2组复制限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17.7.2节“组复制限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          



          

          包含多字节字符的结果的格式化有时没有正确对齐的列。</font><font style="vertical-align: inherit;">同样，非标准字符集的结果也被破坏。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          AdminAPI不支持Unix套接字连接。</font><font style="vertical-align: inherit;">MySQL Shell目前不会阻止您尝试使用套接字连接到群集，并尝试使用套接字连接到群集可能会导致意外的结果。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          MySQL Shell帮助描述了一个无效的URI：

</font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户[：PASS] @ :: SOCKET [/ DB]。</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

          这是无效的，因为</font></font><code class="literal">@</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果没有提供用户信息</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">符号不能出现。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          如果在创建全局会话时未指定会话类型，则MySQL Shell会提供自动协议检测功能，尝试首先创建NodeSession，如果失败则尝试创建ClassicSession。</font><font style="vertical-align: inherit;">使用由三个服务器实例组成的InnoDB集群，其中有一个读写端口和两个只读端口，这可能会导致MySQL Shell仅连接到其中一个只读实例。</font><font style="vertical-align: inherit;">因此，建议在创建全局会话时始终指定会话类型。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          将非沙箱服务器实例（您已手动配置而非使用的实例
           </font></font><code class="literal">dba.deploySandboxInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）添加到群集时，MySQL Shell无法在实例的配置文件中保留任何配置更改。</font><font style="vertical-align: inherit;">这导致以下一种或两种情况：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              组复制配置不会保存在实例的配置文件中，重新启动时实例不会重新加入群集。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该实例对群集使用无效。</font><font style="vertical-align: inherit;">虽然实例可以通过验证
               </font></font><code class="literal">dba.checkInstanceConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且MySQL Shell为了使实例为集群使用做好准备而进行必要的配置更改，但这些更改不会保留在配置文件中，因此一旦重新启动就会丢失。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果只</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生，那么实例在重新启动后不会重新加入群集。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还发生，并且您发现该实例在重新启动后没有重新加入群集，则无法</font></font><code class="literal">dba.rebootClusterFromCompleteOutage()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此情况下</font><font style="vertical-align: inherit;">使用推荐的方法
           </font><font style="vertical-align: inherit;">使群集重新联机。</font><font style="vertical-align: inherit;">这是因为实例失去了MySQL Shell所做的任何配置更改，并且因为它们未被保留，所以在为群集配置之前，实例将恢复到之前的状态。</font><font style="vertical-align: inherit;">这会导致组复制停止响应，并最终命令超时。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为避免此问题，强烈建议</font></font><code class="literal">dba.configureLocalInstance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在将实例添加到群集之前</font><font style="vertical-align: inherit;">使用
           </font><font style="vertical-align: inherit;">，以便保持配置更改。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          使用配置了validate_password插件和密码策略的MySQL服务器实例设置为
           </font></font><code class="literal">STRONG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致InnoDB集群
           </font></font><code class="literal">createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和MySQL路由器引导操作失败。</font><font style="vertical-align: inherit;">这是因为无法验证访问服务器实例所需的内部用户。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          MySQL路由器</font></font><code class="option">--bootstrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行选项不接受IPv6地址。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          商业版本的MySQL路由器没有适用于AppArmor的设置。</font><font style="vertical-align: inherit;">例如，解决方法是编辑AppArmor配置文件配置文件
           </font></font><code class="filename">/etc/apparmor.d/usr.sbin.mysqlrouter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并修改包含的路线</font></font><code class="literal">/usr/sbin/mysqld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以使用MySQL路由器的路径
           </font></font><code class="literal">/usr/sbin/mysqlrouter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          使用此</font><font style="vertical-align: inherit;">功能</font><font style="vertical-align: inherit;">的</font></font><code class="literal">adoptFromGR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
           </font></font><code class="literal">dba.createCluster()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据组复制的现有部署创建集群失败，并显示实例已经是复制组的一部分的错误。</font><font style="vertical-align: inherit;">这仅在MySQL Shell的默认向导模式下发生。</font><font style="vertical-align: inherit;">解决方法是通过</font><font style="vertical-align: inherit;">使用
           </font><font style="vertical-align: inherit;">命令选项</font><font style="vertical-align: inherit;">启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlsh" title="4.5.7 mysqlsh  -  MySQL Shell"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlsh</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来禁用向导模式</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlsh_no-wizard"><code class="option">--no-wizard</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_defaults-extra-file"><code class="option">--defaults-extra-file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InnoDB集群服务器实例不支持</font><font style="vertical-align: inherit;">
          

          使用该
           </font><font style="vertical-align: inherit;">选项指定选项文件。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tbody><tr>
<td width="40%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/document-store.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a></td>
<td width="20%" align="center"><a accesskey="u" href="/mysql-5.7-google-zh/mysql-innodb-cluster-userguide.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向上</font></font></a></td>
<td width="40%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/mysql-cluster.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第19章使用MySQL作为文档存储</font></font></td>
<td width="20%" align="center"><a accesskey="h" href="/mysql-5.7-google-zh/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家</font></font></a></td>
<td width="40%" align="right" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21章MySQL NDB集群7.5和NDB集群7.6</font></font></td>
</tr>
</tbody></table>
</div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./mysql-innodb-cluster-userguide_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>