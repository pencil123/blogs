<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>第16章复制</title>
<link rel="stylesheet" href="./images/mvl.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
<link rel="start" href="/mysql-5.7-google-zh/index.html" title="{书名}">
<link rel="up" href="/mysql-5.7-google-zh/replication.html" title="">
<link rel="prev" href="/mysql-5.7-google-zh/storage-engines.html" title="第15章备用存储引擎">
<link rel="next" href="/mysql-5.7-google-zh/group-replication.html" title="第17章组复制">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./images/translateelement.css"></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tbody><tr>
<th colspan="3" align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16章复制</font></font></th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/storage-engines.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a>&nbsp;</td>
<th width="60%" align="center"></th>
<td width="20%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/group-replication.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
</tbody></table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="replication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16章复制</font></font></h1>

</div>

</div>

</div>
<div class="toc">
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></b></p><dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1配置复制</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#binlog-replication-configuration-overview"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.1基于二进制日志文件位置的复制配置概述</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-howto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2设置基于二进制日志文件位置的复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-gtids"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3使用全局事务标识符进行复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-multi-source"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4 MySQL多源复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5更改联机服务器上的复制模式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6复制和二进制日志记录选项和变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-administration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.7常用复制管理任务</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-implementation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2复制实现</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1复制格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-implementation-details"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.2复制实现细节</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-channels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3复制通道</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#slave-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.4复制中继和状态日志</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-rules"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5服务器如何评估复制过滤规则</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3复制解决方案</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1使用复制进行备份</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.2处理意外的复制从站暂停</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-diffengines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.3使用不同的主存储引擎和从属存储引擎进行复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-scaleout"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.4使用复制进行扩展</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-partitioning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.5将不同的数据库复制到不同的从站</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-performance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.6提高复制性能</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-switch"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.7在故障转移期间切换主站</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-encrypted-connections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.8设置复制以使用加密连接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-semisync"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9半同步复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-delayed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.10延迟复制</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-notes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4复制注释和提示</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1复制功能和问题</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-compatibility"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.2 MySQL版本之间的复制兼容性</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-upgrade"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.3升级复制设置</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-problems"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.4复制故障排除</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-bugs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.5如何报告复制错误或问题</font></font></a></span></dt></dl></dd></dl>
</div>
<a class="indexterm" name="idm140528034786400"></a><a class="indexterm" name="idm140528034785328"></a><a class="indexterm" name="idm140528034783840"></a><a class="indexterm" name="idm140528034782336"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    复制功能可将来自一台MySQL数据库服务器（主服务器）的数据复制到一台或多台MySQL数据库服务器（从服务器）。</font><font style="vertical-align: inherit;">默认情况下复制是异步的; </font><font style="vertical-align: inherit;">从属设备不需要永久连接以接收来自主设备的更新。</font><font style="vertical-align: inherit;">根据配置，您可以复制数据库中的所有数据库，选定数据库或甚至选定的表。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL中复制的优点包括：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        横向扩展解决方案 - 将负载分散到多个从站以提高性能。</font><font style="vertical-align: inherit;">在此环境中，所有写入和更新都必须在主服务器上进行。</font><font style="vertical-align: inherit;">然而，阅读可能发生在一个或多个奴隶身上。</font><font style="vertical-align: inherit;">该模型可以提高写入性能（因为主机专门用于更新），同时显着提高越来越多的从机的读取速度。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        数据安全性 - 因为数据被复制到从属设备，并且从属设备可以暂停复制过程，所以可以在从属设备上运行备份服务而不会破坏相应的主数据。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分析 - 可以在主设备上创建实时数据，而信息分析可以在从设备上进行，而不会影响主设备的性能。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        远程数据分发 - 您可以使用复制为远程站点创建本地数据副本，而无需永久访问主数据。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关如何在这种情况下使用复制的信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions" title="16.3复制解决方案"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3节“复制解决方案”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL 5.7支持不同的复制方法。</font><font style="vertical-align: inherit;">传统方法基于从主站的二进制日志中复制事件，并要求主站和从站之间的日志文件和位置同步。</font><font style="vertical-align: inherit;">基于</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局事务标识符</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（GTID）</font><font style="vertical-align: inherit;">的更新方法</font><font style="vertical-align: inherit;">是事务性的，因此不需要使用这些文件中的日志文件或位置，这大大简化了许多常见的复制任务。</font><font style="vertical-align: inherit;">只要在主站上提交的所有事务都已应用于从站，使用GTID的复制保证了主站和从站之间的一致性。</font><font style="vertical-align: inherit;">有关MySQL中GTID和基于GTID的复制的更多信息，请参见</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;">第</font></a><font style="vertical-align: inherit;"> 16.1.3 </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节“使用全局事务标识符进行复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关使用基于二进制日志文件位置的复制的信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-configuration" title="16.1配置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1节“配置复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL中的复制支持不同类型的同步。</font><font style="vertical-align: inherit;">原始类型的同步是单向异步复制，其中一台服务器充当主服务器，另一台服务器充当从服务器。</font><font style="vertical-align: inherit;">这与</font><font style="vertical-align: inherit;">作为NDB集群特征</font><font style="vertical-align: inherit;">的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font><font style="vertical-align: inherit;">相反
     </font><font style="vertical-align: inherit;">（参见</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL NDB集群7.5和NDB集群7.6</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在MySQL 5.7中，除了内置的异步复制以外，还支持半同步复制。</font><font style="vertical-align: inherit;">使用半同步复制，在返回执行事务的会话之前在主块上执行的提交，直到至少一个从服务器确认它已接收并记录事务的事件; </font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-semisync" title="16.3.9半同步复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.9节“半同步复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQL 5.7还支持延迟复制，使得从服务器故意在主服务器后面至少延迟一段指定的时间; </font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-delayed" title="16.3.10延迟复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.10节“延迟复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于</font><font style="vertical-align: inherit;">需要</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制的</font><font style="vertical-align: inherit;">场景
     </font><font style="vertical-align: inherit;">，请使用NDB群集（请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL NDB Cluster 7.5和NDB Cluster 7.6</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有许多解决方案可用于设置服务器之间的复制，最佳使用方法取决于数据的存在以及您正在使用的引擎类型。</font><font style="vertical-align: inherit;">有关可用选项的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto" title="16.1.2设置基于二进制日志文件位置的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2节“设置基于二进制日志文件的位置复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有两种核心类型的复制格式：复制整个SQL语句的基于语句的复制（SBR）和仅复制已更改行的基于行的复制（RBR）。</font><font style="vertical-align: inherit;">您还可以使用第三种混合基复制（MBR）。</font><font style="vertical-align: inherit;">有关不同复制格式的更多信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    复制通过许多不同的选项和变量进行控制。</font><font style="vertical-align: inherit;">有关更多信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    您可以使用复制来解决许多不同的问题，包括性能，支持不同数据库的备份，以及作为缓解系统故障的更大解决方案的一部分。</font><font style="vertical-align: inherit;">有关如何解决这些问题的信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions" title="16.3复制解决方案"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3节“复制解决方案”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关复制期间如何处理不同数据类型和语句的说明和提示，包括复制功能，版本兼容性，升级以及潜在问题及其解决方法的详细信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-notes" title="16.4复制注释和提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4节“复制注释和提示”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关MySQL Replication新手经常问到的一些问题的答案，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/faqs.html#faqs-replication" title="A.13 MySQL 5.7 FAQ：复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第A.13节“MySQL 5.7 FAQ：复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关复制实施的详细信息，复制如何工作，二进制日志的过程和内容，后台线程以及用于决定语句如何记录和复制的规则，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-implementation" title="16.2复制实现"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2节“复制实现”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="replication-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1配置复制</font></font></h2>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#binlog-replication-configuration-overview"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.1基于二进制日志文件位置的复制配置概述</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-howto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2设置基于二进制日志文件位置的复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-gtids"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3使用全局事务标识符进行复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-multi-source"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4 MySQL多源复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5更改联机服务器上的复制模式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6复制和二进制日志记录选项和变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-administration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.7常用复制管理任务</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本节介绍如何配置MySQL中可用的不同类型的复制，并包括复制环境所需的设置和配置，包括创建新复制环境的分步说明。</font><font style="vertical-align: inherit;">本节的主要内容是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关使用二进制日志文件位置设置两个或两个以上服务器进行复制的指南，
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto" title="16.1.2设置基于二进制日志文件位置的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2节“设置基于二进制日志文件位置的复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理服务器的配置，并提供在主服务器和奴隶。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关使用GTID事务设置两个或更多服务器进行复制的指导，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3节“使用全局事务标识符进行复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理服务器的配置。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        二进制日志中的事件使用多种格式记录。</font><font style="vertical-align: inherit;">这些被称为基于声明的复制（SBR）或基于行的复制（RBR）。</font><font style="vertical-align: inherit;">第三种混合格式复制（MIXED）会自动使用SBR或RBR复制，以在适当时利用SBR和RBR格式的优点。</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中讨论了不同的格式
         </font><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关适用于复制的不同配置选项和变量的详细信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一旦开始，复制过程应该只需要很少的管理或监控。</font><font style="vertical-align: inherit;">但是，有关您可能想要执行的常见任务的建议，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-administration" title="16.1.7常用复制管理任务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.7节“常见复制管理任务”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="binlog-replication-configuration-overview"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.1基于二进制日志文件位置的复制配置概述</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍基于二进制日志文件位置方法的MySQL服务器之间的复制，其中作为主服务器运行的MySQL实例（数据库更改源）将更新和更改作为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入</font><font style="vertical-align: inherit;">二进制日志。</font><font style="vertical-align: inherit;">根据记录的数据库更改，二进制日志中的信息以不同的日志记录格式存储。</font><font style="vertical-align: inherit;">从站被配置为从主站读取二进制日志，并在从站的本地数据库中执行二进制日志中的事件。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个从设备都会收到二进制日志的全部内容的副本。</font><font style="vertical-align: inherit;">从属人员有责任决定执行二进制日志中的哪些语句。</font><font style="vertical-align: inherit;">除非另有说明，否则主站二进制日志中的所有事件都将在从站上执行。</font><font style="vertical-align: inherit;">如果需要，您可以将从站配置为仅处理适用于特定数据库或表的事件。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您无法将主设备配置为仅记录特定事件。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个从机都保存二进制日志坐标的记录：文件名称和它从主机读取并处理的文件内的位置。</font><font style="vertical-align: inherit;">这意味着可以将多个从站连接到主站并执行相同二进制日志的不同部分。</font><font style="vertical-align: inherit;">由于从站控制此过程，因此各个从站可以与服务器连接和断开连接，而不会影响主站的操作。</font><font style="vertical-align: inherit;">另外，由于每个从站都记录二进制日志中的当前位置，因此可能会断开从站的连接，重新连接并恢复处理。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      主站和每个从站必须配置一个唯一的ID（使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项）。</font><font style="vertical-align: inherit;">另外，每个从站都必须配置有关主站名称，日志文件名以及该文件中的位置的信息。</font><font style="vertical-align: inherit;">这些细节可以使用从机上的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句在</font><font style="vertical-align: inherit;">MySQL会话中进行控制</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">详细信息存储在从站的主信息库中，可以是文件或表（请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-howto"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2设置基于二进制日志文件位置的复制</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-howto-masterbaseconfig"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.1设置复制主配置</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-howto-repuser"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.2创建复制用户</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-howto-masterstatus"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.3获取复制主二进制日志坐标</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-snapshot-method"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.4选择数据快照的方法</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-setup-slaves"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.5设置复制从站</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-howto-additionalslaves"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.6将从站添加到复制环境</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何设置MySQL服务器以使用基于二进制日志文件位置的复制。</font><font style="vertical-align: inherit;">有多种不同的设置复制方法，使用的确切方法取决于您如何设置复制，以及您的主数据库中是否已有数据。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有一些通用任务对所有设置都是通用的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在主设备上，您必须启用二进制日志记录并配置唯一的服务器标识。</font><font style="vertical-align: inherit;">这可能需要重新启动服务器。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterbaseconfig" title="16.1.2.1设置复制主配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.1节“设置复制主配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在要连接到主站的每个从站上，您必须配置一个唯一的服务器ID。</font><font style="vertical-align: inherit;">这可能需要重新启动服务器。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-slavebaseconfig" title="16.1.2.5.1设置复制从站配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.5.1节“设置复制从站配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，在读取二进制日志进行复制时，为主服务器创建一个单独的用户，以便在与主服务器进行身份验证时使用它 </font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-repuser" title="16.1.2.2创建复制用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.2节“创建复制用户”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在创建数据快照或启动复制过程之前，在主数据库上应记录二进制日志中的当前位置。</font><font style="vertical-align: inherit;">在配置从站时需要此信息，以便从站知道二进制日志内的哪个位置开始执行事件。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterstatus" title="16.1.2.3获取复制主二进制日志坐标"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.3节“获取复制主二进制日志坐标”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果主服务器上已有数据并希望使用它来同步从服务器，则需要创建数据快照以将数据复制到从服务器。</font><font style="vertical-align: inherit;">您正在使用的存储引擎会影响您创建快照的方式。</font><font style="vertical-align: inherit;">在使用时</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，必须停止处理主服务器上的语句以获取读锁定，然后获取其当前二进制日志坐标并转储其数据，然后再允许主服务器继续执行语句。</font><font style="vertical-align: inherit;">如果不停止语句的执行，数据转储和主状态信息将不匹配，从而导致从服务器上的数据库不一致或损坏。</font><font style="vertical-align: inherit;">有关复制</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">母版的</font><font style="vertical-align: inherit;">更多信息
           </font><font style="vertical-align: inherit;">，请参阅
          </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterstatus" title="16.1.2.3获取复制主二进制日志坐标"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.3节“获取复制主二进制日志坐标”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您正在使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则不需要读取锁定，并且足够长的传输数据快照的事务已足够。</font><font style="vertical-align: inherit;">有关更多信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-and-mysql-replication" title="14.19 InnoDB和MySQL复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.19节“InnoDB和MySQL复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用连接到主站的设置来配置从站，例如主机名，登录凭证和二进制日志文件的名称和位置。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-slaveinit" title="16.1.2.5.2在从站上设置主站配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.5.2节“在从站上设置主站配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        设置过程中的某些步骤需要
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。</font><font style="vertical-align: inherit;">如果您没有此权限，则可能无法启用复制。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      配置基本选项后，选择您的方案：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要设置全新安装主站和不包含数据的</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-newservers" title="16.1.2.5.3设置新主站和从站之间的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站的复制</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-newservers" title="16.1.2.5.3设置新主站和从站之间的复制"><font style="vertical-align: inherit;">第16.1.2.5.3节“设置新主站和从站之间的复制”</font></a><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用来自现有MySQL服务器的数据</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-existingdata" title="16.1.2.5.4使用现有数据设置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置新主数据库的复制</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-existingdata" title="16.1.2.5.4使用现有数据设置复制"><font style="vertical-align: inherit;">第16.1.2.5.4节“使用现有数据设置复制”</font></a><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将复制从服务器添加到现有复制环境，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-additionalslaves" title="16.1.2.6将从站添加到复制环境"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.6节“将从服务器添加到复制环境”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在管理MySQL复制服务器之前，请阅读完整章节并尝试</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#replication-master-sql" title="13.4.1用于控制主服务器的SQL语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.4.1节“控制主服务器的SQL语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#replication-slave-sql" title="13.4.2用于控制从服务器的SQL语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.4.2节“控制从服务器的SQL语句</font></font></a><font style="vertical-align: inherit;"><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#replication-master-sql" title="13.4.1用于控制主服务器的SQL语句"><font style="vertical-align: inherit;">”中</font></a><font style="vertical-align: inherit;">提到的所有语句
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">还要熟悉</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍的复制启动选项
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-howto-masterbaseconfig"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.1设置复制主配置</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要将主服务器配置为使用基于二进制日志文件位置的复制，您必须启用二进制日志记录并建立唯一的服务器ID。</font><font style="vertical-align: inherit;">如果尚未完成，则需要重新启动服务器。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        二进制日志记录</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器上启用，因为二进制日志是将主服务器的更改复制到其从服务器的基础。</font><font style="vertical-align: inherit;">如果在主服务器上未使用该</font></font><code class="literal">log-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">启用二进制日志记录</font><font style="vertical-align: inherit;">，则复制是不可能的。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        复制组中的每个服务器都必须配置唯一的服务器标识。</font><font style="vertical-align: inherit;">此ID用于标识组中的单个服务器，并且必须是1到（2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）-1 </font><font style="vertical-align: inherit;">之间的正整数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您如何组织和选择数字是您的选择。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要配置二进制日志和服务器ID选项，请关闭MySQL服务器并编辑</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="filename">my.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">在</font></font><code class="literal">[mysqld]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置文件</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">部分中，添加</font></font><code class="literal">log-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">server-id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">如果这些选项已经存在，但已被注释掉，请取消注释选项并根据您的需要更改它们。</font><font style="vertical-align: inherit;">例如，要使用日志文件名称前缀为</font></font><code class="literal">mysql-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">启用二进制日志记录
         </font><font style="vertical-align: inherit;">，并将服务器ID配置为1，请使用以下行：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
登录斌= mysql的斌</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务器ID = 1</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        进行更改后，重新启动服务器。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下选项对此过程有影响：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果你省略</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或明确地将其设置为其默认值0），主设备将拒绝来自从设备的任何连接。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于使用尽可能大的耐用性和一致性复制设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与交易，你应该使用
               </font></font><code class="literal">innodb_flush_log_at_trx_commit=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">sync_binlog=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主的
               </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              确保</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-networking"><code class="option">skip-networking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制主机上未启用</font><font style="vertical-align: inherit;">该
               </font><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">如果网络已禁用，则从站无法与主站通信，复制失败。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-howto-repuser"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.2创建复制用户</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个从设备都使用MySQL用户名和密码连接到主设备，因此主设备上必须有一个用户帐户，以便从设备可以使用该帐户进行连接。</font><font style="vertical-align: inherit;">任何帐户都可以用于此操作，只要它已被授予
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权即可。</font><font style="vertical-align: inherit;">您可以选择为每个从站创建一个不同的帐户，或者使用每个从站的相同帐户连接到主站。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        虽然您不必专门为复制创建帐户，但应该知道复制用户名和密码以纯文本形式存储在主信息存储库文件或表中（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs-status" title="16.2.4.2从站状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4.2节“从属状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">） 。</font><font style="vertical-align: inherit;">因此，您可能希望创建一个仅具有复制过程权限的单独帐户，以最大限度地减少对其他帐户造成危害的可能性。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要创建一个新帐户，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE
        USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要授予此帐户复制所需的权限，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句。</font><font style="vertical-align: inherit;">如果您仅为复制目的创建帐户，则该帐户只需要
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        特权。</font><font style="vertical-align: inherit;">例如，要设置一个</font></font><code class="literal">repl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以连接到</font></font><code class="literal">example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域中</font><font style="vertical-align: inherit;">任何主机进行复制</font><font style="vertical-align: inherit;">的新用户，请
         </font><font style="vertical-align: inherit;">在主服务器上发出以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>CREATE USER 'repl'@'%.example.com' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%.example.com';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关</font><font style="vertical-align: inherit;">操纵用户帐户的语句的更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#account-management-sql" title="13.7.1账户管理陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#account-management-sql" title="13.7.1账户管理陈述"><font style="vertical-align: inherit;">第13.7.1节“帐户管理语句”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-howto-masterstatus"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.3获取复制主二进制日志坐标</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要将从站配置为在正确的位置启动复制过程，您需要主站的二进制日志中的当前坐标。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果主服务器先前没有启用二进制日志记录，则由</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS语法"><code class="literal">SHOW MASTER STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump --master-data</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示的日志文件名称和位置值为
         </font><font style="vertical-align: inherit;">空。</font><font style="vertical-align: inherit;">在这种情况下，稍后在指定从站的日志文件和位置时需要使用的值是空字符串（</font></font><code class="literal">''</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和</font></font><code class="literal">4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果以前主服务器进行了二进制日志记录，则使用此过程获取主日志二进制日志坐标：
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此过程使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH TABLES WITH
          READ LOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止
           </font><font style="vertical-align: inherit;">表</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作的
           </font><font style="vertical-align: inherit;">过程</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过使用命令行客户端连接主服务器来启动主服务器上的会话，然后通过执行语句来清除所有表并阻止写入</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH
            TABLES WITH READ LOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>FLUSH TABLES WITH READ LOCK;</code></strong>
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              让您从中发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的客户端保持
               </font><font style="vertical-align: inherit;">运行，以便读取锁保持有效。</font><font style="vertical-align: inherit;">如果您退出客户端，则锁定被释放。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在master上的不同会话中，使用该
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS语法"><code class="literal">SHOW MASTER STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句确定当前的二进制日志文件的名称和位置：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SHOW MASTER STATUS;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ---------- + -------------- + ---- -------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">文件| </font><font style="vertical-align: inherit;">位置| </font><font style="vertical-align: inherit;">Binlog_Do_DB | </font><font style="vertical-align: inherit;">Binlog_Ignore_DB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ---------- + -------------- + ---- -------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">mysql-bin.000003 | </font><font style="vertical-align: inherit;">73 | </font><font style="vertical-align: inherit;">测试| </font><font style="vertical-align: inherit;">手动，mysql |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ---------- + -------------- + ---- -------------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列显示日志文件的名称，列显示文件</font></font><code class="literal">Position</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的位置。</font><font style="vertical-align: inherit;">在这个例子中，二进制日志文件是</font></font><code class="literal">mysql-bin.000003</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，位置是73.记录这些值。</font><font style="vertical-align: inherit;">您在设置从站时稍后需要它们。</font><font style="vertical-align: inherit;">它们表示从站应该开始处理来自主站的新更新的复制坐标。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您现在拥有了所需的信息，可以使从服务器从正确位置的二进制日志中开始读取以开始复制。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下一步取决于您是否拥有主数据。</font><font style="vertical-align: inherit;">选择以下选项之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您在开始复制之前已有数据需要与从属设备同步，请保持客户端运行，以便锁定保持原位。</font><font style="vertical-align: inherit;">这样可以防止进行任何进一步的更改，以便复制到从站的数据与主站同步。</font><font style="vertical-align: inherit;">继续
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-snapshot-method" title="16.1.2.4选择数据快照的方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.4节“选择数据快照的方法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您正在设置新的主从复制组，则可以退出第一个会话以释放读锁。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">如何继续</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-newservers" title="16.1.2.5.3设置新主站和从站之间的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-newservers" title="16.1.2.5.3设置新主站和从站之间的复制"><font style="vertical-align: inherit;">第16.1.2.5.3节“设置新主站和从站之间的复制”</font></a><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-snapshot-method"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.4选择数据快照的方法</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果主数据库包含现有数据，则需要将此数据复制到每个从属设备。</font><font style="vertical-align: inherit;">有多种方法可以从主数据库转储数据。</font><font style="vertical-align: inherit;">以下各节介绍可能的选项。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要选择转储数据库的适当方法，请在以下选项中进行选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具来创建您想要复制的所有数据库的转储。</font><font style="vertical-align: inherit;">这是推荐的方法，特别是在使用时
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您的数据库存储在二进制可移植文件中，则可以将原始数据文件复制到从站。</font><font style="vertical-align: inherit;">这可以比使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在每个从属设备上导入文件</font><font style="vertical-align: inherit;">更有效</font><font style="vertical-align: inherit;">，因为它会</font></font><code class="literal">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在重播语句</font><font style="vertical-align: inherit;">时跳过更新索引的开销
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于像</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这样的</font><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">是不推荐的。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-howto-mysqldump"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.4.1使用mysqldump创建数据快照</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要在现有主数据库中创建数据的快照，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具。</font><font style="vertical-align: inherit;">数据转储完成后，在开始复制过程之前将该数据导入到从属设备中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下示例将所有数据库转储到名为的文件
           </font></font><code class="filename">dbdump.db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并包含
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_master-data"><code class="option">--master-data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动附加</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
          TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站上所需</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句以启动复制过程的选项：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --all-databases --master-data &gt; dbdump.db</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您不使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_master-data"><code class="option">--master-data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则需要手动将所有表锁定在单独的会话中。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterstatus" title="16.1.2.3获取复制主二进制日志坐标"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.3节“获取复制主二进制日志坐标”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具</font><font style="vertical-align: inherit;">从转储中排除某些数据库</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您想选择要包含在转储中的数据库，请勿使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_all-databases"><code class="option">--all-databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">选择以下选项之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              排除数据库中的所有表格使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_ignore-table"><code class="option">--ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。

              
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">仅命名要转储的那些数据库
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分4.5.4，“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 数据库备份程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要导入数据，请将转储文件复制到从站，或者在远程连接到从站时从主站访问该文件。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-howto-rawdata"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.4.2使用原始数据文件创建数据快照</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何使用组成数据库的原始文件创建数据快照。</font><font style="vertical-align: inherit;">将此方法与使用具有复杂缓存或日志记录算法的存储引擎的表配合使用时，需要执行额外的步骤才能生成完美的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间点</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快照：即使您获得了</font><font style="vertical-align: inherit;">一个完整的</font><span class="quote"><font style="vertical-align: inherit;">“ </font></span><span class="quote"><span class="quote"><font style="vertical-align: inherit;">时间点</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”</font></span><font style="vertical-align: inherit;">快照，初始复制命令也可能会遗漏高速缓存信息和日志记录更新全局读锁。</font><font style="vertical-align: inherit;">存储引擎对此的响应取决于其崩溃恢复能力。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，则可以使用</font><font style="vertical-align: inherit;">MySQL Enterprise Backup组件中</font><font style="vertical-align: inherit;">的</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbackup</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来生成一致的快照。</font><font style="vertical-align: inherit;">该命令记录从站上使用的快照对应的日志名称和偏移量。</font><font style="vertical-align: inherit;">MySQL企业备份是作为MySQL企业订阅的一部分包含的商业产品。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-enterprise.html#mysql-enterprise-backup" title="29.2 MySQL企业备份概述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/mysql-enterprise.html#mysql-enterprise-backup" title="29.2 MySQL企业备份概述"><font style="vertical-align: inherit;">第29.2节“MySQL企业备份概述”</font></a><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          

          如果主设备和从设备具有不同的值</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ft_stopword_file"><code class="literal">ft_stopword_file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font><font style="vertical-align: inherit;">则此方法也无法可靠工作
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ft_min_word_len"><code class="literal">ft_min_word_len</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_ft_max_word_len"><code class="literal">ft_max_word_len</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您正在复制具有全文索引的表。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设上述例外情况不适用于您的数据库，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_cold_backup" title="冷备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冷备份</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          技术获取</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的可靠二进制快照
           </font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">对MySQL服务器</font><font style="vertical-align: inherit;">执行
           </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_slow_shutdown" title="慢关机"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓慢关闭</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后手动复制数据文件。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在单个文件系统上存在MySQL数据文件时</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">的原始数据快照
           </font><font style="vertical-align: inherit;">，可以使用标准文件复制工具（例如</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">copy）</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，远程复制工具（如
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scp</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rsync）</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，归档工具（如</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zip</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tar</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等文件系统快照工具
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您只复制某些数据库，则只复制与这些表相关的文件。</font><font style="vertical-align: inherit;">因为</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有数据库中的所有表都存储在</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_system_tablespace" title="系统表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统表空间中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，除非您已</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="option">innodb_file_per_table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">该
           </font><font style="vertical-align: inherit;">选项。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下文件不需要复制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">相关的</font><font style="vertical-align: inherit;">文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              主信息存储库文件（如果使用的话）（请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              主人的二进制日志文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何中继日志文件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          根据您是否使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表格，选择以下选项之一：
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您正在使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，并且为了通过原始数据快照获得最一致的结果，请在此过程中关闭主服务器，如下所示：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              获取读取锁定并获取主人的状态。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterstatus" title="16.1.2.3获取复制主二进制日志坐标"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.3节“获取复制主二进制日志坐标”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在单独的会话中，关闭主服务器：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin shutdown</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              制作MySQL数据文件的副本。</font><font style="vertical-align: inherit;">以下示例显示了执行此操作的常用方法。</font><font style="vertical-align: inherit;">你只需要选择其中的一个：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt; </font><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>tar cf <em class="replaceable"><code>/tmp/db.tar</code></em> <em class="replaceable"><code>./data</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>zip -r <em class="replaceable"><code>/tmp/db.zip</code></em> <em class="replaceable"><code>./data</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>rsync --recursive <em class="replaceable"><code>./data</code></em> <em class="replaceable"><code>/tmp/dbdata</code></em></code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              重新启动主服务器。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您不使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表格，则可以按照以下步骤中的描述从主服务器获取系统快照而无需关闭服务器：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              获取读取锁定并获取主人的状态。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterstatus" title="16.1.2.3获取复制主二进制日志坐标"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.3节“获取复制主二进制日志坐标”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              制作MySQL数据文件的副本。</font><font style="vertical-align: inherit;">以下示例显示了执行此操作的常用方法。</font><font style="vertical-align: inherit;">你只需要选择其中的一个：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt; </font><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>tar cf <em class="replaceable"><code>/tmp/db.tar</code></em> <em class="replaceable"><code>./data</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>zip -r <em class="replaceable"><code>/tmp/db.zip</code></em> <em class="replaceable"><code>./data</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>rsync --recursive <em class="replaceable"><code>./data</code></em> <em class="replaceable"><code>/tmp/dbdata</code></em></code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在您获取读锁的客户端，释放锁：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一旦创建了数据库的存档或副本，请在开始从属复制过程之前将这些文件复制到每个从属设备。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-setup-slaves"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.5设置复制从站</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下各节介绍如何设置从站。</font><font style="vertical-align: inherit;">在继续之前，请确保您拥有：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用必要的配置属性配置MySQL主服务器。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterbaseconfig" title="16.1.2.1设置复制主配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.1节“设置复制主配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            获取主状态信息。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterstatus" title="16.1.2.3获取复制主二进制日志坐标"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.3节“获取复制主二进制日志坐标”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在主设备上，释放读锁：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-howto-slavebaseconfig"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.5.1设置复制从站配置</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个复制从站都</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有唯一的服务器标识。</font><font style="vertical-align: inherit;">如果还没有完成，则这部分从属设置需要服务器重新启动。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果从服务器ID尚未设置，或者当前值与您为主服务器选择的值冲突，请关闭从服务器并编辑</font></font><code class="literal">[mysqld]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置文件</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">部分以指定唯一的服务器ID。</font><font style="vertical-align: inherit;">例如：

          
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务器ID = 2</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          进行更改后，重新启动服务器。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您要设置多个从站，则每个从站必须具有</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与主站和其他从站不同</font><font style="vertical-align: inherit;">的唯一</font><font style="vertical-align: inherit;">值。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您省略</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或将其明确设置为默认值0），则从站拒绝连接到主站。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您不必在从站上启用二进制日志记录即可设置复制。</font><font style="vertical-align: inherit;">但是，如果在从服务器上启用二进制日志记录，则可以使用从服务器的二进制日志进行数据备份和崩溃恢复，还可以将从服务器用作更复杂的复制拓扑的一部分。</font><font style="vertical-align: inherit;">例如，这个奴隶作为其他奴隶的主人。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-howto-slaveinit"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.5.2在从站上设置主站配置</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要设置从站与主站进行通信以进行复制，请使用必要的连接信息配置从站。</font><font style="vertical-align: inherit;">为此，请在从站上执行以下语句，将选项值替换为与系统相关的实际值：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CHANGE MASTER TO</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font><font style="vertical-align: inherit;">
    - &gt;      </font><font style="vertical-align: inherit;">
    - &gt;      </font><font style="vertical-align: inherit;">
    - &gt;      </font><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>MASTER_HOST='<em class="replaceable"><code>master_host_name</code></em>',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_USER='<em class="replaceable"><code>replication_user_name</code></em>',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_PASSWORD='<em class="replaceable"><code>replication_password</code></em>',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_LOG_FILE='<em class="replaceable"><code>recorded_log_file_name</code></em>',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_LOG_POS=<em class="replaceable"><code>recorded_log_position</code></em>;</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            复制不能使用Unix套接字文件。</font><font style="vertical-align: inherit;">您必须能够使用TCP / IP连接到主MySQL服务器。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明有其他选择。</font><font style="vertical-align: inherit;">例如，可以使用SSL设置安全复制。</font><font style="vertical-align: inherit;">有关选项的完整列表以及有关字符串值选项的最大允许长度的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.4.2.1节“将主语句更改为”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          接下来的步骤取决于您是否有现成的数据导入到从站。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-snapshot-method" title="16.1.2.4选择数据快照的方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-snapshot-method" title="16.1.2.4选择数据快照的方法"><font style="vertical-align: inherit;">第16.1.2.4节“为数据快照选择方法”</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">选择下列之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您没有要导入的数据库快照，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-newservers" title="16.1.2.5.3设置新主站和从站之间的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.5.3节“设置新主站和从站之间的复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您有要导入的数据库快照，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-existingdata" title="16.1.2.5.4使用现有数据设置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.5.4节“使用现有数据设置复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-howto-newservers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.5.3设置新主站和从站之间的复制</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果没有要导入的以前数据库的快照，请将从站配置为从新主站启动复制。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要设置主站和新站之间的复制，请执行以下操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启动MySQL从站并连接到它。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句来设置主复制服务器配置。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-slaveinit" title="16.1.2.5.2在从站上设置主站配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.5.2节“在从站上设置主站配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每个从站上执行这些从站设置步骤。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您正在设置新服务器，但是却要从要加载到复制配置中的其他服务器中获取数据库的现有转储，则也可以使用此方法。</font><font style="vertical-align: inherit;">通过将数据加载到新的主数据中，数据会自动复制到从服务器。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您使用来自其他现有数据库服务器的数据设置新的复制环境以创建新的主数据库，请在新主数据库上运行该服务器生成的转储文件。</font><font style="vertical-align: inherit;">数据库更新会自动传播到从站：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -h master &lt; fulldb.dump</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-howto-existingdata"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.5.4使用现有数据设置复制</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用现有数据设置复制时，请在开始复制之前将快照从主服务器传输到从服务器。</font><font style="vertical-align: inherit;">将数据导入从服务器的过程取决于您如何在主服务器上创建数据快照。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选择下列之一：
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动从站，
               </font><font style="vertical-align: inherit;">以便复制不会启动。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              导入转储文件：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql &lt; fulldb.dump</code></strong>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您使用原始数据文件创建快照：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将数据文件解压缩到您的从站数据目录中。</font><font style="vertical-align: inherit;">例如：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>tar xvf dbdump.tar</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您可能需要设置文件的权限和所有权，以便从服务器可以访问和修改它们。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动从站，
               </font><font style="vertical-align: inherit;">以便复制不会启动。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用主站的复制坐标配置从站。</font><font style="vertical-align: inherit;">这告诉从属二进制日志文件和位置在需要启动复制的文件中。</font><font style="vertical-align: inherit;">另外，使用主设备的登录凭证和主机名称来配置从设备。</font><font style="vertical-align: inherit;">有关</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需语句的</font><font style="vertical-align: inherit;">更多信息
               </font><font style="vertical-align: inherit;">，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-slaveinit" title="16.1.2.5.2在从站上设置主站配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.5.2节“在从站上设置主站配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启动从属线程：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>START SLAVE;</code></strong>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          执行此过程后，从属服务器连接到主服务器，并复制自从创建快照以来在主服务器上发生的所有更新。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主站</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项没有正确设置，则从站无法连接到它。</font><font style="vertical-align: inherit;">同样，如果您没有</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正确</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">从站</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">选项，则从站的错误日志中会出现以下错误：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：如果master_host，您应该将server-id设置为非0值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
已设定; </font><font style="vertical-align: inherit;">我们会强制服务器id为2，但是这个MySQL服务器会</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不作为奴隶。</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果由于任何其他原因无法复制，您也可以在从站的错误日志中找到错误消息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从站存储有关您在主信息存储库中配置的主站的信息。</font><font style="vertical-align: inherit;">主信息库可以采用文件或表格的形式，由设置的值确定
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-repository"><code class="option">--master-info-repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当从机使用时</font></font><code class="option">--master-info-repository=FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，两个文件存储在数据目录中，名为
           </font></font><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="option">--master-info-repository=TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相反，</font><font style="vertical-align: inherit;">如果
           </font><font style="vertical-align: inherit;">将此信息保存在</font><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">的
           </font></font><code class="literal">master_slave_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中
           </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这两种情况下，都
           </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除或编辑文件或表格。</font><font style="vertical-align: inherit;">始终使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句来更改复制参数。</font><font style="vertical-align: inherit;">从站可以使用语句中指定的值自动更新状态文件。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            主信息存储库的内容会覆盖命令行或中指定的一些服务器选项
             </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          主机的一个快照足以满足多个从机的需求。</font><font style="vertical-align: inherit;">要设置更多的从站，请使用相同的主站快照，并按照上述过程的从站部分进行操作。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-howto-additionalslaves"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2.6将从站添加到复制环境</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以将另一个从站添加到现有的复制配置，而无需停止主站。</font><font style="vertical-align: inherit;">相反，通过复制一个现有的从站来设置新的从站，除了您使用不同的</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">配置新的从站
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要复制现有的从站：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            关闭现有的从站：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin shutdown</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将数据目录从现有的从站复制到新的从站。</font><font style="vertical-align: inherit;">您可以通过使用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tar</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建存档
             </font><font style="vertical-align: inherit;">或</font></font><code class="literal">WinZip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rsync</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等工具执行直接复制来完成此操作
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">确保您也复制日志文件和中继日志文件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            添加新复制从服务器时遇到的一个常见问题是，新从服务器失败，并显示如下一系列警告和错误消息：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">071118 16:44:10 [警告]既不使用--relay-log也不使用--relay-log-index; </font><font style="vertical-align: inherit;">所以</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当这个MySQL服务器充当奴隶并拥有他的主机名时，复制可能会中断</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
变！</font><font style="vertical-align: inherit;">请使用'--relay-log = </font></font><em class="replaceable"><code>new_slave_hostname</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-relay-bin'来避免这个问题。
</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">071118 16:44:10 [错误]无法打开中继日志'./ </font></font><em class="replaceable"><code>old_slave_hostname</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-relay-bin.003525'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（relay_log_pos 22940879）</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
071118 16:44:10 </font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[错误]无法在中继日志初始化期间找到目标日志</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
071118 16:44:10 </font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[错误]未能初始化主信息结构</font></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">选项，</font><font style="vertical-align: inherit;">则会出现这种情况
             </font><font style="vertical-align: inherit;">，因为中继日志文件包含主机名作为其文件名的一部分。</font><font style="vertical-align: inherit;">如果</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-index"><code class="option">--relay-log-index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不使用</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">，则中继日志索引文件也是如此
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关这些选项的更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></a><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为避免此问题，请</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在现有从站上使用的新从站上</font><font style="vertical-align: inherit;">使用相同的值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此选项未在现有从站上明确设置，请使用
             </font></font><code class="literal"><em class="replaceable"><code>existing_slave_hostname</code></em>-relay-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果这不可行，请将现有从站的中继日志索引文件复制到新的从站，并在新的从站上设置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-index"><code class="option">--relay-log-index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项以匹配现有从站上使用</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">如果此选项未在现有从站上明确设置，请使用
            </font></font><code class="literal"><em class="replaceable"><code>existing_slave_hostname</code></em>-relay-bin.index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，如果您已按照本节中的其余步骤尝试启动新的从站，并遇到类似前面所述的错误，请执行以下步骤：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="a"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果您尚未这样做，请</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在新的从站上</font><font style="vertical-align: inherit;">发出一个
                 </font><font style="vertical-align: inherit;">。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果您已经重新启动了现有的从站，请</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在现有的从站上</font><font style="vertical-align: inherit;">发出一个</font><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                将现有从站的中继日志索引文件的内容复制到新的从站的中继日志索引文件中，确保覆盖文件中已有的任何内容。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                继续本节中的其余步骤。
</font></font></p></li></ol>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将</font><font style="vertical-align: inherit;">现有从站</font><font style="vertical-align: inherit;">的主信息和中继日志信息存储库（请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;">复制</font></a><font style="vertical-align: inherit;">到新从站。</font><font style="vertical-align: inherit;">这些保存主设备二进制日志和从设备中继日志的当前日志坐标。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启动现有的从站。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在新的从站上，编辑配置并为新的从站指定一个</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不被主站或任何现有从站使用</font><font style="vertical-align: inherit;">的唯一值</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            开始新的奴隶。</font><font style="vertical-align: inherit;">从站使用其主信息库中的信息来启动复制过程。
</font></font></p></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-gtids"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3使用全局事务标识符进行复制</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-gtids-concepts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.1 GTID概念</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.2使用GTID设置复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.3使用GTID进行故障转移和扩展</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-gtids-restrictions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.4使用GTID复制的限制</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528034427696"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本节介绍使用</font><span class="firstterm"><font style="vertical-align: inherit;">全局事务标识符</font></span><font style="vertical-align: inherit;">的基于事务的复制
    </font></font><span class="firstterm"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （GTIDs）。</font><font style="vertical-align: inherit;">在使用GTID时，每个事务都可以被识别和跟踪，因为它是在始发服务器上提交并由任何从服务器应用的; </font><font style="vertical-align: inherit;">这意味着在启动新的从站或故障转移到新的主站时使用GTID来引用日志文件或这些文件中的位置是没有必要的，这极大地简化了这些任务。</font><font style="vertical-align: inherit;">因为基于GTID的复制是完全基于事务的，所以很容易确定主机和从机是否一致; </font><font style="vertical-align: inherit;">只要在主设备上承诺的所有事务也都在从设备上进行，两者之间的一致性就能得到保证。</font><font style="vertical-align: inherit;">您可以对GTID使用基于语句或基于行的复制（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）; </font><font style="vertical-align: inherit;">但是，为获得最佳结果，我们建议您使用基于行的格式。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本节讨论以下主题：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如何定义和创建GTID，以及它们在MySQL服务器中的表示方式（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-concepts" title="16.1.3.1 GTID概念"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.1节“GTID概念”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        设置和启动基于GTID的复制的一般过程（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.2节“使用GTID设置复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用GTID时配置新复制服务器的建议方法（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover" title="16.1.3.3使用GTID进行故障转移和扩展"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.3节“将GTID用于故障转移和扩展”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用基于GTID的复制时应注意的限制和限制（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-restrictions" title="16.1.3.4使用GTID复制的限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.4节“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用GTID进行复制的
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-restrictions" title="16.1.3.4使用GTID复制的限制"><font style="vertical-align: inherit;">限制”</font></a><font style="vertical-align: inherit;">）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关MySQL服务器选项和与基于GTID复制相关的变量的信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-gtids" title="16.1.6.5全局事务ID选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.5节“全局事务ID选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#gtid-functions" title="12.17用于全局事务ID的函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.17节“用于全局事务ID的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><a class="xref" href="/mysql-5.7-google-zh/functions.html#gtid-functions" title="12.17用于全局事务ID的函数"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">，该函数描述了MySQL 5.7支持的用于GTID的SQL函数。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-gtids-concepts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.1 GTID概念</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528034413008"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      全局事务标识符（GTID）是创建的唯一标识符，并与源（主）服务器上提交的每个事务相关联。</font><font style="vertical-align: inherit;">此标识符不仅是其源自的服务器唯一的，而且在给定的复制设置中的所有服务器上都是唯一的。</font><font style="vertical-align: inherit;">所有交易和所有GTID之间都有一对一的映射关系。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下段落提供了GTID的基本描述。</font><font style="vertical-align: inherit;">更高级的概念将在后面的章节中介绍：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-concepts-gtid-sets" title="GTID集"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GTID集</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-gtid-executed-table" title="mysql.gtid_executed表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql.gtid_executed表</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-gtid-executed-table-compression" title="mysql.gtid_executed表压缩"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql.gtid_executed表压缩</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      GTID表示为一对坐标，由冒号（</font></font><code class="literal">:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">分隔</font><font style="vertical-align: inherit;">，如下所示：
    </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GTID = </font></font><em class="replaceable"><code>source_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><em class="replaceable"><code>transaction_id</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><em class="replaceable"><code>source_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标识的源服务器。</font><font style="vertical-align: inherit;">通常，服务器
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于此目的。</font><font style="vertical-align: inherit;">这</font></font><em class="replaceable"><code>transaction_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个序号，由该服务器上提交事务的顺序决定; </font><font style="vertical-align: inherit;">例如，要提交的第一个事务具有</font></font><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其
       </font></font><em class="replaceable"><code>transaction_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且被分配一个相同的始发服务器上被提交第十交易</font></font><em class="replaceable"><code>transaction_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
       </font></font><code class="literal">10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">交易</font></font><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在GTID中</font><font style="vertical-align: inherit;">不可能具有</font><font style="vertical-align: inherit;">序列号。</font><font style="vertical-align: inherit;">例如，原来在UUID服务器上提交的第二十三个事务
       </font></font><code class="literal">3E11FA47-71CA-11E1-9E33-C80AA9429562</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有这个GTID：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562：23
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这种格式用于在语句输出中</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及在二进制日志中</font><font style="vertical-align: inherit;">表示GTID </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a>
      <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看日志文件</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_base64-output"><code class="option">--base64-output=DECODE-ROWS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或输出</font><font style="vertical-align: inherit;">时，也可以看到它们</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-binlog-events" title="13.7.5.2 SHOW BINLOG EVENTS句法"><code class="literal">SHOW BINLOG
      EVENTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      正如这些语句的输出中所写的那样，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS语法"><code class="literal">SHOW MASTER STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">SHOW
      SLAVE STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源自相同服务器的一系列GTID可能会被合并为一个表达式，如下所示。
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562：1-5
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      只是显示的例子代表了第一个通过原产MySQL服务器，其上的第五个交易
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
       </font></font><code class="literal">3E11FA47-71CA-11E1-9E33-C80AA9429562</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这种格式也用于提供</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
       </font></font><code class="literal">SQL_BEFORE_GTIDS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font><font style="vertical-align: inherit;">所需的参数
       </font></font><code class="literal">SQL_AFTER_GTIDS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="replication-gtids-concepts-gtid-sets"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GTID集</font></font></h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140528034379008"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        GTID集合是一组全局事务标识符，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>gtid_set</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>uuid_set</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>uuid_set</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    | </font><font style="vertical-align: inherit;">“”</font></font><font></font>
<font></font>
<em class="replaceable"><code>uuid_set</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>uuid</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><em class="replaceable"><code>interval</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[：</font></font><em class="replaceable"><code>interval</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...</font></font><font></font>
<font></font>
<em class="replaceable"><code>uuid</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>hhhhhhhh</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><em class="replaceable"><code>hhhh</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><em class="replaceable"><code>hhhh</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><em class="replaceable"><code>hhhh</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font><em class="replaceable"><code>hhhhhhhhhhhh</code></em><font></font>
<font></font>
<em class="replaceable"><code>h</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    [0-9 | AF]</font></font><font></font>
<font></font>
<em class="replaceable"><code>interval</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>n</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ - </font></font><em class="replaceable"><code>n</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （</font></font><em class="replaceable"><code>n</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; = 1）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        GTID集以几种方式在MySQL服务器中使用。</font><font style="vertical-align: inherit;">例如，由</font><font style="vertical-align: inherit;">系统变量</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">存储的值
         </font><font style="vertical-align: inherit;">表示为GTID集合。</font><font style="vertical-align: inherit;">另外，这些函数
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_gtid-subset"><code class="literal">GTID_SUBSET()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_gtid-subtract"><code class="literal">GTID_SUBTRACT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要GTID集作为输入。</font><font style="vertical-align: inherit;">当从服务器变量返回GTID集时，UUID按字母顺序排列，数字区间按升序排列。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        GTID始终保存在主控和从属之间。</font><font style="vertical-align: inherit;">这意味着您可以通过检查其二进制日志来确定应用于任何从属设备的任何事务的来源。</font><font style="vertical-align: inherit;">另外，一旦给定GTID的事务在给定的服务器上被提交，任何具有相同GTID的后续事务都会被该服务器忽略。</font><font style="vertical-align: inherit;">因此，在主站上提交的事务只能在从站上应用一次，这有助于保证一致性。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当GTID正在使用时，从机不需要任何非本地数据，例如主机上文件的名称和该文件中的位置。</font><font style="vertical-align: inherit;">所有与主设备同步所需的信息都直接从复制数据流中获取。</font><font style="vertical-align: inherit;">GTID替换之前所需的文件偏移对，以确定启动，停止或恢复主站和从站之间数据流的点。</font><font style="vertical-align: inherit;">因此，不要</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">陈述中</font><font style="vertical-align: inherit;">包含
         </font></font><code class="literal">MASTER_LOG_FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">MASTER_LOG_POS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于指示奴隶从给定主人复制的陈述; </font><font style="vertical-align: inherit;">相反，只需要启用该功能
        </font></font><code class="literal">MASTER_AUTO_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">有关使用基于GTID的复制配置和启动主站和从站所需的确切步骤，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.2节“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用GTID
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;">设置复制”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        GTID的产生和生命周期由以下步骤组成：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            事务在主服务器上执行并提交。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此事务使用主服务器的UUID和尚未在此服务器上使用的最小非零事务序列号分配GTID; </font><font style="vertical-align: inherit;">GTID被写入到master的二进制日志中（紧接在日志中的事务本身之前）。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在将二进制日志数据发送到从站并存储在从站的中继日志中（使用此过程的已建立机制 - </font><font style="vertical-align: inherit;">有关详细信息，</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-implementation" title="16.2复制实现"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2节“复制实现”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）后，从站读取GTID并设置其</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next"><code class="literal">gtid_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">这个GTID变量。</font><font style="vertical-align: inherit;">这告诉奴隶必须使用这个GTID记录下一个事务。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            注意到slave </font></font><code class="literal">gtid_next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在会话上下文中</font><font style="vertical-align: inherit;">设置很重要
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从服务器验证此GTID尚未用于在其自己的二进制日志中记录事务。</font><font style="vertical-align: inherit;">如果这个GTID没有被使用，那么从设备写入GTID，应用事务并将事务写入其二进制日志。</font><font style="vertical-align: inherit;">通过首先读取和检查事务的GTID，在处理事务本身之前，从服务器不仅保证不具有此GTID的以前事务已经应用于从服务器，而且还确保没有其他会话已经读取了该GTID但尚未提交相关的交易。</font><font style="vertical-align: inherit;">换句话说，多个客户端不允许同时应用相同的事务。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            因为</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next"><code class="literal">gtid_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不为空，所以从机不会尝试为该事务生成GTID，而是将存储在该变量中的GTID（即从主机获取的GTID）立即写入二进制日志中。
</font></font></p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="replication-gtids-gtid-executed-table"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql.gtid_executed表</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034342848"></a><a class="indexterm" name="idm140528034341760"></a><a class="indexterm" name="idm140528034340272"></a><a class="indexterm" name="idm140528034338784"></a><a class="indexterm" name="idm140528034337296"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从MySQL 5.7.5开始，GTID被存储在一个名为</font><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">的表
         </font></font><code class="literal">gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中
         </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于每个GTID或其所代表的GTID集合，此表中的一行包含始发服务器的UUID以及该集合的起始和结束事务标识; </font><font style="vertical-align: inherit;">对于仅引用单个GTID的行，这最后两个值是相同的。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在</font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装或升级MySQL服务器时使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        类似于此处显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">表（如果</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">表尚未存在）</font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE gtid_executed（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    source_uuid CHAR（36）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    interval_start BIGINT（20）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    interval_end BIGINT（20）NOT NULL，                                                                                                                                                                                  </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（source_uuid，interval_start）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）      </font></font><font></font>
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          与其他MySQL系统表一样，不要尝试自己创建或修改此表。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表使从机能够在从机上禁用二进制日志记录时使用GTID，并且可以在二进制日志丢失时保留GTID历史记录。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        GTID </font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        仅在</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is
         </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">时才</font><font style="vertical-align: inherit;">存储在</font><font style="vertical-align: inherit;">表中</font></font><code class="literal">ON_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">GTID存储的位置取决于二进制日志记录是启用还是禁用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果二进制日志记录被禁用（</font></font><code class="literal">log_bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
             </font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），或者
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slave_updates"><code class="literal">log_slave_updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被禁用，则服务器将属于每个事务的GTID与事务一起存储在表中。</font><font style="vertical-align: inherit;">另外，该表以用户可配置的速率周期性压缩; </font><font style="vertical-align: inherit;">有关更多信息，</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-gtid-executed-table-compression" title="mysql.gtid_executed表压缩"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql.gtid_executed表压缩</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这种情况只适用于禁用二进制日志记录或从属更新日志记录的复制从站。</font><font style="vertical-align: inherit;">它不适用于复制主服务器，因为在主服务器上，必须启用二进制日志记录才能进行复制。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果启用了二进制日志记录（</font></font><code class="literal">log_bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
             </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），则无论何时二进制日志被轮换或服务器关闭，服务器都会将写入上一个二进制日志的所有事务的GTID写入</font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中。</font><font style="vertical-align: inherit;">这种情况适用于启用了二进制日志记录的复制主节点或复制从节点。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在服务器意外停止的情况下，当前二进制日志中的一组GTID不会保存在
             </font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中。</font><font style="vertical-align: inherit;">在这种情况下，这些GTID会</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在恢复过程</font><font style="vertical-align: inherit;">中添加到表中并添加到</font><font style="vertical-align: inherit;">系统变量中</font><font style="vertical-align: inherit;">的一组GTID中</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用二进制日志记录时，该
             </font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表不会为所有已执行的事务提供完整的GTID记录。</font><font style="vertical-align: inherit;">该信息由</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量</font><font style="vertical-align: inherit;">的全局值提供</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<a class="indexterm" name="idm140528034309136"></a><a class="indexterm" name="idm140528034307632"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表由复位
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-master" title="13.4.1.2 RESET MASTER语法"><code class="literal">RESET MASTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="replication-gtids-gtid-executed-table-compression"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql.gtid_executed表压缩</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034302432"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        随着时间的推移，
         </font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格可能会充满多行，涉及源自同一服务器上的单个GTID，并且其事务ID构成一个序列，类似于此处显示的内容：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM mysql.gtid_executed;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------------------- + ---------- ------ + -------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">source_uuid | </font><font style="vertical-align: inherit;">interval_start | </font><font style="vertical-align: inherit;">interval_end |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| -------------------------------------- + ---------- ------ + -------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562 | </font><font style="vertical-align: inherit;">37 | </font><font style="vertical-align: inherit;">37 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562 | </font><font style="vertical-align: inherit;">38 | </font><font style="vertical-align: inherit;">38 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562 | </font><font style="vertical-align: inherit;">39 | </font><font style="vertical-align: inherit;">39 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562 | </font><font style="vertical-align: inherit;">40 | </font><font style="vertical-align: inherit;">40 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562 | </font><font style="vertical-align: inherit;">41 | </font><font style="vertical-align: inherit;">41 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562 | </font><font style="vertical-align: inherit;">42 | </font><font style="vertical-align: inherit;">42 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562 | </font><font style="vertical-align: inherit;">43 | </font><font style="vertical-align: inherit;">43 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果通过用跨越事务标识符的整个间隔的单个行替换每个这样的行集合来周期性地压缩此表，则可以节省大量的空间，如下所示：
      </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ -------------------------------------- + ---------- ------ + -------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">source_uuid | </font><font style="vertical-align: inherit;">interval_start | </font><font style="vertical-align: inherit;">interval_end |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| -------------------------------------- + ---------- ------ + -------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3E11FA47-71CA-11E1-9E33-C80AA9429562 | </font><font style="vertical-align: inherit;">37 | </font><font style="vertical-align: inherit;">43 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        启用GTID时，服务器会</font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上执行此类型的压缩</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以通过设置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_executed_gtids_compression_period"><code class="literal">executed_gtids_compression_period</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量</font><font style="vertical-align: inherit;">来控制在压缩表之前允许经过的事务数量，从而控制压缩率
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这个变量的默认值是1000; </font><font style="vertical-align: inherit;">这意味着，默认情况下，在每次1000个事务之后执行表的压缩。</font><font style="vertical-align: inherit;">设置
         </font></font><code class="literal">executed_gtid_compression_period</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0会阻止压缩的执行; </font><font style="vertical-align: inherit;">但是，</font></font><code class="literal">gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果执行此操作</font><font style="vertical-align: inherit;">，则应准备好可能会大大增加</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">所需的磁盘空间量
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果启用二进制日志记录，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_executed_gtids_compression_period"><code class="literal">executed_gtids_compression_period</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          则</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">该值，
           </font><font style="vertical-align: inherit;">并且</font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会在每个二进制日志循环中</font><font style="vertical-align: inherit;">对该
           </font><font style="vertical-align: inherit;">表进行压缩。
</font></font></p>
</div>
<a class="indexterm" name="idm140528034287376"></a><a class="indexterm" name="idm140528034286288"></a><a class="indexterm" name="idm140528034284768"></a><p><font style="vertical-align: inherit;"></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">
        压缩</font><font style="vertical-align: inherit;">由名为的专用前景线程执行
         </font></font><code class="literal">thread/sql/compress_gtid_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这个线程没有列在输出中</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
        PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但它可以被看作是</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#threads-table" title="25.11.16.3线程表"><code class="literal">threads</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的一行
         </font><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.threads WHERE NAME LIKE '%gtid%'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          THREAD_ID：26</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               名称：thread / sql / compress_gtid_table</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               类型：FOREGROUND</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     PROCESSLIST_ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   PROCESSLIST_USER：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   PROCESSLIST_HOST：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     PROCESSLIST_DB：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PROCESSLIST_COMMAND：守护进程</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   PROCESSLIST_TIME：1509</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PROCESSLIST_STATE：暂停</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   PROCESSLIST_INFO：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   PARENT_THREAD_ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               ROLE：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       INSTRUMENTED：是的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            历史：是的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    CONNECTION_TYPE：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       THREAD_OS_ID：18677</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        的</font></font><code class="literal">thread/sql/compress_gtid_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">螺纹通常休眠，直到
         </font></font><code class="literal">executed_gtids_compression_period</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        交易已经被执行，那么唤醒到的执行压缩</font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述表。</font><font style="vertical-align: inherit;">然后睡觉，直到另一个
         </font></font><code class="literal">executed_gtids_compression_period</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        交易发生，然后醒来再次执行压缩，无限期地重复此循环。</font><font style="vertical-align: inherit;">禁用二进制日志记录时将此值设置为0意味着线程始终处于睡眠状态并且永不会唤醒。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-gtids-howto"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.2使用GTID设置复制</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034271440"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍在MySQL 5.7中配置和启动基于GTID的复制的过程。</font><font style="vertical-align: inherit;">这是一个
       </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冷启动</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程，假定您是首次启动复制主服务器，或者可以停止它; </font><font style="vertical-align: inherit;">有关使用来自运行主服务器的GTID设置复制从服务器的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover" title="16.1.3.3使用GTID进行故障转移和扩展"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.3节“使用GTID进行故障切换和扩展”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关在线服务器上更改GTID模式的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online" title="16.1.5更改联机服务器上的复制模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.5节“更改联机服务器上的复制模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      最简单的GTID复制拓扑的启动过程中的关键步骤（包括一个主站和一个从站）如下所示：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果复制已在运行，则通过将它们设置为只读来同步这两个服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          停止两台服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          重新启动两台启用了GTID的服务器并配置正确的选项。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节后面的示例中将讨论启动服务器所需</font><font style="vertical-align: inherit;">
          的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GTID必须正确运行。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          指示从服务器将主服务器用作复制数据源并使用自动定位。</font><font style="vertical-align: inherit;">完成此步骤所需的SQL语句在本节后面的示例中进行了介绍。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          采取新的备份。</font><font style="vertical-align: inherit;">包含没有GTID的事务的二进制日志不能在启用了GTID的服务器上使用，因此在此点之前进行的备份不能用于新配置。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          启动从站，然后在两台服务器上再次禁用只读模式，以便它们可以接受更新。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在以下示例中，使用MySQL的基于二进制日志位置的复制协议，两台服务器已经作为主服务器和从服务器运行。</font><font style="vertical-align: inherit;">如果从新服务器开始，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-repuser" title="16.1.2.2创建复制用户"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.2节“为复制创建用户”，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取有关为复制连接添加特定用户
       </font><font style="vertical-align: inherit;">的信息以及有关设置</font><font style="vertical-align: inherit;">变量的</font><font style="vertical-align: inherit;">信息的
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterbaseconfig" title="16.1.2.1设置复制主配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.1节“设置复制主配置”</font></font></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示如何将</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动选项</font><font style="vertical-align: inherit;">存储</font><font style="vertical-align: inherit;">在服务器的选项文件中，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.6节“使用选项文件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。</font><font style="vertical-align: inherit;">或者，您可以在运行</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;">mysqld</font></strong></span></a><font style="vertical-align: inherit;">时使用启动选项
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下大多数步骤都需要使用MySQL
       </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户或具有该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限的</font><font style="vertical-align: inherit;">其他MySQL用户帐户</font><font style="vertical-align: inherit;">。
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin</font></font></strong></span></a> <code class="literal">shutdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font><code class="literal">SUPER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限或
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1步：同步服务器。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有在不使用GTID的情况下复制服务器时才需要执行此步骤。</font><font style="vertical-align: inherit;">对于新服务器，请继续执行步骤3. </font><font style="vertical-align: inherit;">通过发出以下命令，</font><font style="vertical-align: inherit;">将服务器设置为</font><font style="vertical-align: inherit;">每个服务器上</font><font style="vertical-align: inherit;">的</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量为
         </font><font style="vertical-align: inherit;">只读
         </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET @@global.read_only = ON;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      等待所有正在进行的事务提交或回滚。</font><font style="vertical-align: inherit;">然后，让奴隶赶上主人。</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继续之前，确保从服务器已处理所有更新是非常重要的</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。

      
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您将二进制日志用于复制以外的其他任何事情，例如执行时间点备份和恢复，请等到您不需要包含没有GTID的事务的旧的二进制日志。</font><font style="vertical-align: inherit;">理想情况下，等待服务器清除所有二进制日志，并等待任何现有备份到期。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        理解包含没有GTID的交易的日志不能在启用GTID的服务器上使用，这一点很重要。</font><font style="vertical-align: inherit;">继续之前，您必须确保没有GTID的事务不存在于拓扑中的任何位置。
</font></font></p>
</div>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2步：停止两台服务器。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示，</font><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止每个服务器</font><font style="vertical-align: inherit;">，其中</font></font><em class="replaceable"><code>username</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是具有足够权限关闭服务器的MySQL用户的用户名：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin -u<em class="replaceable"><code>username</code></em> -p shutdown</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      然后在提示时提供该用户的密码。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3步：启用启用了GTID的两台服务器。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要启用基于GTID的复制，必须通过将</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量
         </font><font style="vertical-align: inherit;">设置为启用GTID模式启动每个服务器
         </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        启用</font><font style="vertical-align: inherit;">该
         </font><font style="vertical-align: inherit;">变量以确保只记录对基于GTID的复制安全的语句。</font><font style="vertical-align: inherit;">另外，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在配置从站设置之前</font><font style="vertical-align: inherit;">，您应该使用该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动从
         </font><font style="vertical-align: inherit;">站。</font><font style="vertical-align: inherit;">有关GTID相关选项和变量的更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-gtids" title="16.1.6.5全局事务ID选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.5节“全局事务ID选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      由于</font><font style="vertical-align: inherit;">在MySQL 5.7.5中</font><font style="vertical-align: inherit;">增加了</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-gtid-executed-table" title="mysql.gtid_executed表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql.gtid_executed表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">因此为了使用GTID而不需要启用二进制日志记录
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着您可以使用GTID的从服务器，但不使用二进制日志记录。</font><font style="vertical-align: inherit;">为了能够复制，</font><font style="vertical-align: inherit;">主设备</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终启用二进制日志记录。</font><font style="vertical-align: inherit;">例如，要启动启用了GTID但没有二进制日志记录的从站，请在服务器的选项文件中配置这些变量：
    </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gtid_mode = ON</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
执行-GTID一致性=真</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      根据您的配置，为</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供更多选项
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4步：配置从站使用基于GTID的自动定位。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        告诉从属使用基于GTID事务的主数据作为复制数据源，并使用基于GTID的自动定位而不是基于文件的定位。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从机上</font><font style="vertical-align: inherit;">发出
         </font><font style="vertical-align: inherit;">声明，包括</font></font><code class="literal">MASTER_AUTO_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        声明中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项，告诉从机，主机的事务由GTID标识。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可能还需要为主服务器的主机名和端口号以及用于复制用户帐户的用户名和密码提供适当的值，从服务器可以使用该帐户连接主服务器; </font><font style="vertical-align: inherit;">如果在步骤1之前已经设置了这些参数，并且不需要做进一步的修改，那么可以从这里显示的语句中安全地省略相应的选项。
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的MySQL&gt; </font></font><strong class="userinput"><code>CHANGE MASTER TO</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;      </font><font style="vertical-align: inherit;">
     &gt;      </font><font style="vertical-align: inherit;">
     &gt;      </font><font style="vertical-align: inherit;">
     &gt;      </font><font style="vertical-align: inherit;">
     &gt;     </font></font><strong class="userinput"><code>MASTER_HOST = <em class="replaceable"><code>host</code></em>,</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_PORT = <em class="replaceable"><code>port</code></em>,</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_USER = <em class="replaceable"><code>user</code></em>,</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_PASSWORD = <em class="replaceable"><code>password</code></em>,</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_AUTO_POSITION = 1;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置等于1时</font><font style="vertical-align: inherit;">
      ，</font></font><code class="literal">MASTER_LOG_FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项和
       </font></font><code class="literal">MASTER_LOG_POS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项都不能使用
       </font></font><code class="literal">MASTER_AUTO_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。尝试这样做会导致</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
      TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句失败并显示错误。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5步：采取新的备份。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        启用GTID之前创建的现有备份现在不能再用于这些服务器，因为您已启用GTID。</font><font style="vertical-align: inherit;">在这一点上做一个新的备份，这样你就不会没有可用的备份。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      例如，您可以在执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH
      LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份的服务器上</font><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，明确地进行备份或等待您可能已经设置的任何定期备份例程的下一次迭代。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6步：启动从站并禁用只读模式。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        像这样启动slave：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>START SLAVE;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      只有在步骤1中将服务器配置为只读时，才需要执行以下步骤。要允许服务器再次开始接受更新，请发出以下语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET @@global.read_only = OFF;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      现在应该运行基于GTID的复制，并且可以像以前一样开始（或恢复）主机上的活动。
      </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover" title="16.1.3.3使用GTID进行故障转移和扩展"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.3节“使用GTID进行故障转移和扩展”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论了在使用GTID时创建新的从站。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-gtids-failover"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.3使用GTID进行故障转移和扩展</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034191776"></a><a class="indexterm" name="idm140528034190288"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      将全局事务标识符（GTID）与MySQL Replication配合使用时，有许多技术用于配置新的从站，然后可用于扩展，并在故障转移时将其提升为主站。</font><font style="vertical-align: inherit;">本节介绍以下技术：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover-replicate" title="简单的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单的复制</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover-copy" title="将数据和事务复制到从站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将数据和事务复制到从站</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover-empty" title="注入空的交易"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入空的交易</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover-gtid-purged" title="排除与gtid_purged交易"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排除与gtid_purged交易</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-restoring-mysqlbinlog" title="恢复GTID模式从站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恢复GTID模式从站</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      全局事务标识符已添加到MySQL复制中，以便简化复制数据流的一般管理，特别是简化故障转移活动。</font><font style="vertical-align: inherit;">每个标识符唯一标识一组构成事务的二进制日志事件。</font><font style="vertical-align: inherit;">GTID在将更改应用到数据库中起着关键作用：服务器会自动跳过任何具有服务器识别为之前处理过的标识符的事务。</font><font style="vertical-align: inherit;">此行为对于自动复制定位和正确的故障转移至关重要。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在二进制日志中捕获标识符和包含给定事务的事件集合之间的映射。</font><font style="vertical-align: inherit;">使用来自其他现有服务器的数据配置新服务器时，这会带来一些挑战。</font><font style="vertical-align: inherit;">要重现在新服务器上设置的标识符，必须将标识符从旧服务器复制到新服务器，并保留标识符与实际事件之间的关系。</font><font style="vertical-align: inherit;">这对于恢复作为候选者立即可用的从站成为故障切换或切换的新主站是必要的。
    </font></font></p><p><a name="replication-gtids-failover-replicate"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单的复制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在新服务器上再现所有标识符和事务的最简单方法是将新服务器置于具有全部执行历史记录的主服务器的从服务器中，并在两台服务器上启用全局事务标识符。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;">第16.1.3.2节“使用GTID设置复制”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一旦复制启动，新服务器将从主服务器复制整个二进制日志，从而获得有关所有GTID的所有信息。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这种方法简单而有效，但要求从机从主机读取二进制日志; </font><font style="vertical-align: inherit;">有时需要较长的时间才能让新的从服务器跟上主服务器，所以这种方法不适用于快速故障切换或从备份恢复。</font><font style="vertical-align: inherit;">本节介绍如何通过将二进制日志文件复制到新服务器来避免从主服务器获取所有执行历史记录。
    </font></font></p><p><a name="replication-gtids-failover-copy"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将数据和事务复制到从站。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当源服务器先前处理了大量事务时，执行整个事务历史记录可能非常耗时，并且这可能代表设置新复制从属服务器时的主要瓶颈。</font><font style="vertical-align: inherit;">为了消除这种需求，可以将源服务器包含的数据集，二进制日志和全局事务信息的快照导入到新的从服务器。</font><font style="vertical-align: inherit;">源服务器可以是主服务器或从服务器，您必须确保源在复制数据之前处理了所有必需的事务。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这种方法有几种不同的方式，不同之处在于二进制日志中的数据转储和事务转移到从服务器，如下所述：
</font></font></p>
<div class="informaltable">
<table summary="How to copy a data set and transaction history to a new slave."><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据集</font></font></th>
          <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易历史</font></font></th>
        </tr></thead><tbody><tr>
<td scope="row">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端导入使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的转储文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在源服务器上使用的
                   </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_master-data"><code class="option">--master-data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项包括二进制日志信息，并
                   </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_set-gtid-purged"><code class="option">--set-gtid-purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以
                   </font></font><code class="literal">AUTO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认），或者
                   </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，包括有关在转储执行交易的信息。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  停止源服务器，将源的数据目录的内容复制到新的从服务器的数据目录，然后重新启动从服务器。</font><font style="vertical-align: inherit;">换句话说，从站必须配置为基于GTID的复制</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</td>
<td>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  导入从源服务器的二进制日志使用新的奴隶</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog可以</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，与
                   </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_read-from-remote-server"><code class="option">--read-from-remote-server</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  和
                   </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_read-from-remote-master"><code class="option">--read-from-remote-master</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  选项。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  将源的二进制日志文件复制到从属设备。</font><font style="vertical-align: inherit;">您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a>
                  <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从副本进行复制
                   </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些可以通过以下任一方式读入从站：
</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_read-from-remote-server"><code class="option">--read-from-remote-server</code></a>
                  <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_raw"><code class="option">--raw</code></a><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      更新从属
                       </font></font><code class="filename">binlog.index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件以指向复制的日志文件。</font><font style="vertical-align: inherit;">然后</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      在</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">执行一条
                       </font><font style="vertical-align: inherit;">语句，</font><font style="vertical-align: inherit;">指向第一个日志文件并
                       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取它们。
                    </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a>
                      <code class="literal">&gt;</code>
                      <code class="filename"><em class="replaceable"><code>file</code></em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                      （不带该
                       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_raw"><code class="option">--raw</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项）将二进制日志文件导出到可由</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                      客户端</font><font style="vertical-align: inherit;">处理的SQL文件</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
</td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      另请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog-backup" title="4.6.7.3使用mysqlbinlog备份二进制日志文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.7.3节“使用mysqlbinlog备份二进制日志文件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这种方法的优点是几乎可以立即提供新的服务器; </font><font style="vertical-align: inherit;">只有那些在重播快照或转储文件时提交的事务仍然需要从现有主服务器获取。</font><font style="vertical-align: inherit;">这意味着从设备的可用性不是即时的 - 但从设备只需要相对较短的时间就可以赶上这几个剩余的事务。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      预先通过二进制日志复制到目标服务器通常比实时从主服务器读取整个事务执行历史记录要快。</font><font style="vertical-align: inherit;">但是，由于大小或其他考虑因素，在需要时将这些文件移动到目标可能并不总是可行的。</font><font style="vertical-align: inherit;">本节讨论的另外两种配置新从站的方法使用其他方法将有关事务的信息传输给新的从站。
    </font></font></p><p><a name="replication-gtids-failover-empty"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入空的交易。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        主设备的全局</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量包含在</font><font style="vertical-align: inherit;">主设备上
         </font><font style="vertical-align: inherit;">执行的所有事务的集合。</font><font style="vertical-align: inherit;">在拍摄快照以配置新服务器时，不要复制二进制日志，而应注意</font></font><code class="literal">gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拍摄快照的服务器上的</font><font style="vertical-align: inherit;">内容
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在将新服务器添加到复制链之前，只需在新服务器上为包含在主服务器中的每个事务标识符提交一个空事务</font></font><code class="literal">gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GTID_NEXT ='aaa-bbb-ccc-ddd：N';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开始;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
承诺;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GTID_NEXT ='AUTOMATIC';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一旦所有事务标识符以这种方式使用空事务恢复后，您必须刷新并清除从属服务器的二进制日志，如下所示，其中
       </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是当前二进制日志文件名的非零后缀：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FLUSH LOGS;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PURGE BINARY LOGS TO'master-bin.00000 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您应该这样做，以防止此服务器在事后将其提升为主服务器时使用虚假事务泛滥复制流。</font><font style="vertical-align: inherit;">（该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH
      LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句强制创建新的二进制日志文件; </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#purge-binary-logs" title="13.4.1.1 PURGE BINARY LOGS语法"><code class="literal">PURGE BINARY LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除空的事务，但保留其标识符。）
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这种方法创建了一个基本上是快照的服务器，但随着其二进制日志历史记录与复制流的历史趋于一致（即，它赶上了主服务器或主服务器），该服务器能够成为主服务器。</font><font style="vertical-align: inherit;">这一结果与使用剩余供应方法所获得的结果类似，我们在接下来的几段中讨论这一方法。
    </font></font></p><p><a name="replication-gtids-failover-gtid-purged"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排除与gtid_purged交易。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        主站的全局
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量包含已从主站的二进制日志中清除的所有事务的集合。</font><font style="vertical-align: inherit;">与前面讨论的方法一样（请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover-empty" title="注入空的交易"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入空事务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），您可以记录</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从其获取快照的服务器上</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">（代替将二进制日志复制到新服务器）。</font><font style="vertical-align: inherit;">与以前的方法不同，不需要提交空交易（或发行
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#purge-binary-logs" title="13.4.1.1 PURGE BINARY LOGS语法"><code class="literal">PURGE BINARY LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）; </font><font style="vertical-align: inherit;">相反，您可以</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从中获取备份或快照的服务器</font><font style="vertical-align: inherit;">上的值直接在从属</font><font style="vertical-align: inherit;">设备</font><font style="vertical-align: inherit;">上
         </font><font style="vertical-align: inherit;">进行设置</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      与使用空事务的方法一样，此方法创建一个功能上为快照的服务器，但随着其二进制日志历史记录与复制主服务器或组的复制日志历史趋于一致，它将及时成为主服务器。
    </font></font></p><p><a name="replication-gtids-restoring-mysqlbinlog"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恢复GTID模式从站。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在遇到错误的基于GTID的复制设置中恢复从站时，注入空事务可能无法解决问题，因为事件没有GTID。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找下一个事务，这可能是事件发生后的下一个日志文件中的第一个事务。</font><font style="vertical-align: inherit;">将所有内容复制到该
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易中，确保包含该交易</font></font><code class="literal">SET @@SESSION.GTID_NEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">即使您没有使用基于行的复制，仍然可以在命令行客户端中运行二进制日志行事件。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      停止从服务器并运行您复制的事务。</font><font style="vertical-align: inherit;">该
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog可以</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出设置的分隔符
       </font></font><code class="literal">/*!*/;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以将其设置回：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>DELIMITER ;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      自动从正确位置重新启动复制：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SET GTID_NEXT=automatic;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>RESET SLAVE;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>START SLAVE;</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-gtids-restrictions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.4使用GTID复制的限制</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034091744"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      由于基于GTID的复制依赖于事务，所以在使用MySQL时不支持某些在MySQL中可用的功能。</font><font style="vertical-align: inherit;">本节提供有关使用GTID进行复制的限制和限制的信息。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及非事务性存储引擎的更新。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当使用GTIDs，更新使用非事务性存储引擎的表，如</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不能在同一语句或事务的更新使用事务性存储引擎，如表进行
         </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      此限制是由于以下事实：对使用非事务性存储引擎的表进行的更新与在同一事务中使用事务性存储引擎的表的更新混合在一起会导致将多个GTID分配给同一事务。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当主设备和从设备使用不同的存储引擎作为同一表的相应版本时，也会发生这样的问题，其中一个存储引擎是事务性的，另一个不是。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在刚刚提到的任何情况下，事务与GTID之间的一对一对应关系都被打破，结果是基于GTID的复制无法正常运行。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ... SELECT语句。&nbsp;</font></font></b>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
        TABLE ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于基于语句的复制是不安全的。</font><font style="vertical-align: inherit;">在使用基于行的复制时，该语句实际上记录为两个单独的事件 - 一个用于创建表，另一个用于将源表中的行插入刚创建的新表中。</font><font style="vertical-align: inherit;">当在一个事务中执行这个语句时，在某些情况下，这两个事件可能会收到相同的事务标识符，这意味着包含插入事务的事务被从服务器跳过。</font><font style="vertical-align: inherit;">因此，</font></font><code class="literal">CREATE
        TABLE ... SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用基于GTID的复制时不支持。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">临时表。&nbsp;</font></font></b>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TEMPORARY
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TEMPORARY
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用GTID时（即使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">启动服务器时），事务内部不支持语句
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可以在启用GTID的情况下使用这些语句，但只能在任何事务之外使用，并且只能使用这些语句
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防止执行不受支持的语句。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了防止执行会导致基于GTID的复制失败的语句，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用GTID时</font><font style="vertical-align: inherit;">必须使用该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动所有服务器
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这会导致本节前面讨论的任何类型的语句失败并显示错误。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      请注意，
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有在对语句执行二进制日志记录时才会生效。</font><font style="vertical-align: inherit;">如果在服务器上禁用了二进制日志记录，或者由于语句被过滤器删除而未将语句写入二进制日志，则未检查或强制执行未记录的语句的GTID一致性。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关启用GTID时需要的其他启动选项的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.2节“使用GTID设置复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p>
      <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sql_slave_skip_counter"><code class="literal">sql_slave_skip_counter</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用GTID时不被支持。</font><font style="vertical-align: inherit;">如果您需要跳过事务，请改用主</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">的值
       </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">有关更多信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover-empty" title="注入空的交易"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入空白事务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><a name="replication-gtids-restrictions-mysqldump"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GTID模式和mysqldump。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要目标服务器的二进制日志中没有GTID </font><font style="vertical-align: inherit;">
        ，就可以将使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的转储导入
         </font><font style="vertical-align: inherit;">启用GTID模式的MySQL服务器。
      </font></font></p><p><a name="replication-gtids-restrictions-mysql_upgrade"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GTID模式和mysql_upgrade。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当服务器在启用全局事务标识符（GTID）（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的情况下运行时，请勿通过</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        （该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_upgrade_write-binlog"><code class="option">--write-binlog</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项）</font><font style="vertical-align: inherit;">启用二进制日志记录</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-multi-source"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4 MySQL多源复制</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-multi-source-overview"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.1 MySQL多源复制概述</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-multi-source-tutorials"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.2多源复制教程</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-multi-source-monitoring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.3多源复制监视</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-multi-source-error-messages"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.4多源复制错误消息</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528034054496"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本节介绍MySQL多源复制，它使您可以并行复制多个直接主数据库。</font><font style="vertical-align: inherit;">本节介绍多源复制以及如何配置，监视和排除故障。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-multi-source-overview"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.1 MySQL多源复制概述</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528034051664"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL多源复制使复制从服务器可以同时接收来自多个来源的事务。</font><font style="vertical-align: inherit;">多源复制可用于将多台服务器备份到单台服务器，合并表分片并将多台服务器的数据合并到单台服务器。</font><font style="vertical-align: inherit;">多源复制在应用事务时不会执行任何冲突检测或解决方案，并且如果需要，这些任务将留给应用程序。</font><font style="vertical-align: inherit;">在多源复制拓扑中，从服务器为每个主服务器创建一个复制通道，以便从中接收事务。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-channels" title="16.2.3复制通道"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.3节“复制通道”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下各节介绍如何设置多源复制。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-multi-source-tutorials"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.2多源复制教程</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034046992"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何为多源复制配置主站和从站，以及如何启动，停止和重置多源从站。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-multi-source-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.2.1配置多源复制</font></font></h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140528034043744"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何配置多源复制拓扑，并提供有关配置主控和从属的详细信息。</font><font style="vertical-align: inherit;">这样的拓扑需要配置至少两个主设备和一个从设备。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        多源复制拓扑中的主设备可以配置为使用基于全局事务标识符（GTID）的复制或二进制日志基于位置的复制。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">如何使用基于GTID的复制配置主</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;">第16.1.3.2节“</font></a><font style="vertical-align: inherit;">使用GTID设置复制”。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">如何使用基于文件位置的复制来配置主文件</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterbaseconfig" title="16.1.2.1设置复制主配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-masterbaseconfig" title="16.1.2.1设置复制主配置"><font style="vertical-align: inherit;">第16.1.2.1节“设置复制主文件配置”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        多源复制拓扑中的从站需要
         </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于存储库。</font><font style="vertical-align: inherit;">多源复制与</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基础知识库</font><font style="vertical-align: inherit;">不兼容</font><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的存储库类型
         </font><font style="vertical-align: inherit;">可以在启动时动态配置。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在启动时配置复制从服务器使用的存储库的类型，请使用</font><font style="vertical-align: inherit;">以下选项</font><font style="vertical-align: inherit;">启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="terminal" class="programlisting"><strong class="userinput"><code>--master-info-repository=TABLE --relay-log-info-repository=TABLE</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要修改使用
         </font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库以使用
         </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库的现有复制存储，请通过运行以下命令动态转换现有的复制存储：
      </font></font></p><pre data-lang="sql" class="programlisting"><strong class="userinput"><code>STOP SLAVE;</code></strong>
<strong class="userinput"><code>SET GLOBAL master_info_repository = 'TABLE';</code></strong>
<strong class="userinput"><code>SET GLOBAL relay_log_info_repository = 'TABLE';</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-multi-source-adding-gtid-master"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.2.2将基于GTID的主设备添加到多源复制从设备</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034026480"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本部分假定您已使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，启用复制用户</font><font style="vertical-align: inherit;">在主服务器上启用了基于GTID的事务</font><font style="vertical-align: inherit;">，并确保从服务器正在使用
         </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于复制的存储库。</font><font style="vertical-align: inherit;">使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句通过使用</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">将新的主控添加到通道</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关复制通道的更多信息，请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-channels" title="16.2.3复制通道"><font style="vertical-align: inherit;">第16.2.3节“复制通道”</font></a></font><code class="literal">FOR CHANNEL
        <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-channels" title="16.2.3复制通道"><font style="vertical-align: inherit;"></font></a>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        例如，以添加新的主与主机名
         </font></font><em class="replaceable"><code>master1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用端口
         </font></font><em class="replaceable"><code>3451</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到一个所谓的信道
         </font></font><em class="replaceable"><code>master-1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><strong class="userinput"><code><font></font>
CHANGE MASTER TO MASTER_HOST='master1', MASTER_USER='rpl', MASTER_PORT=3451, MASTER_PASSWORD='', \<font></font>
MASTER_AUTO_POSITION = 1 FOR CHANNEL 'master-1';<font></font>
</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        多源复制与自动定位兼容。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><font style="vertical-align: inherit;">第13.4.2.1节“将MASTER更改</font></a><font style="vertical-align: inherit;">为</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><font style="vertical-align: inherit;">语法”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        针对要添加到频道的每个额外主控制器重复此过程，根据需要更改主机名，端口和频道。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-multi-source-adding-binlog-master"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.2.3将基于二进制日志的主节点添加到多源复制从节点</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034013072"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节假设您已启用主服务器上的二进制日志记录，使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin"><code class="literal">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，启用复制用户，记录当前二进制日志位置，并确保从服务器使用</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于复制存储库。</font><font style="vertical-align: inherit;">你需要知道当前
         </font></font><code class="literal">MASTER_LOG_FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">MASTER_LOG_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过指定一个</font><font style="vertical-align: inherit;">子句，</font><font style="vertical-align: inherit;">使用该
         </font><font style="vertical-align: inherit;">语句将新的主控添加到通道</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，以添加新的主与主机名
         </font><font style="vertical-align: inherit;">使用端口
         </font><font style="vertical-align: inherit;">到一个所谓的信道
         </font><font style="vertical-align: inherit;">：
      </font></font><code class="literal">FOR CHANNEL
        <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>master1</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>3451</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>master-1</code></em><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><strong class="userinput"><code><font></font>
CHANGE MASTER TO MASTER_HOST='master1', MASTER_USER='rpl', MASTER_PORT=3451, MASTER_PASSWORD='' \<font></font>
MASTER_LOG_FILE='master1-bin.000006', MASTER_LOG_POS=628 FOR CHANNEL 'master-1';<font></font>
</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        针对要添加到频道的每个额外主控制器重复此过程，根据需要更改主机名，端口和频道。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-multi-source-start-slave"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.2.4启动多源复制从站</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034000496"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一旦添加了要用作复制主机的所有通道，请使用</font><font style="vertical-align: inherit;">语句开始复制。</font><font style="vertical-align: inherit;">当您在从机上启用多个通道时，可以选择启动所有通道，或者选择特定通道启动。
</font></font><code class="literal">START SLAVE
        <em class="replaceable"><code>thread_types</code></em></code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要启动所有当前配置的复制通道：
          </font></font></p><pre data-lang="sql" class="programlisting"> <strong class="userinput"><code>
START SLAVE <em class="replaceable"><code>thread_types</code></em>;</code></strong></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要仅启动指定的通道，请使用以下</font><font style="vertical-align: inherit;">子句：
          </font></font><code class="literal">FOR CHANNEL
            <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"> <strong class="userinput"><code>
START SLAVE <em class="replaceable"><code>thread_types</code></em> FOR CHANNEL <em class="replaceable"><code>channel</code></em>;
</code></strong></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用该</font></font><em class="replaceable"><code>thread_types</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项选择特定的线程，您希望上述语句在从站上启动。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><font style="vertical-align: inherit;">第13.4.2.6节“START SLAVE语法”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-multi-source-stop-slave"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.2.5停止多源复制从站</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528033987056"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">STOP SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句可用于停止多源复制从站。</font><font style="vertical-align: inherit;">默认情况下，如果您</font></font><code class="literal">STOP SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在多源复制从站上</font><font style="vertical-align: inherit;">使用该</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">，则
         </font><font style="vertical-align: inherit;">所有通道都将停止。</font><font style="vertical-align: inherit;">或者，使用该
         </font><font style="vertical-align: inherit;">子句仅停止特定频道。
</font></font><code class="literal">FOR CHANNEL
        <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要停止所有当前配置的复制通道：
          </font></font></p><pre data-lang="sql" class="programlisting"><strong class="userinput"><code>
STOP SLAVE <em class="replaceable"><code>thread_types</code></em>;</code></strong></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要仅停止命名通道，请使用以下</font><font style="vertical-align: inherit;">子句：
          </font></font><code class="literal">FOR CHANNEL
            <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"> <strong class="userinput"><code>
STOP SLAVE <em class="replaceable"><code>thread_types</code></em> FOR CHANNEL <em class="replaceable"><code>channel</code></em>;
</code></strong></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用该</font></font><em class="replaceable"><code>thread_types</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项选择特定的线程，您希望上述语句在从站上停止。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><font style="vertical-align: inherit;">第13.4.2.7节“STOP SLAVE语法”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-multi-source-reset-slave"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.2.6重置多源复制从站</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528033972368"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">RESET SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句可用于重置多源复制从服务器。</font><font style="vertical-align: inherit;">默认情况下，如果</font></font><code class="literal">RESET SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在多源复制从属设备上</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">语句，所有通道都将被重置。</font><font style="vertical-align: inherit;">或者，使用该
         </font><font style="vertical-align: inherit;">子句仅重置特定频道。
</font></font><code class="literal">FOR CHANNEL
        <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要重置所有当前配置的复制通道：
          </font></font></p><pre data-lang="sql" class="programlisting"> <strong class="userinput"><code>
RESET SLAVE;</code></strong></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要仅重置一个指定通道，请使用一个</font><font style="vertical-align: inherit;">子句：
          </font></font><code class="literal">FOR CHANNEL
            <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"> <strong class="userinput"><code>
RESET SLAVE FOR CHANNEL <em class="replaceable"><code>channel</code></em>;
</code></strong></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><font style="vertical-align: inherit;">第13.4.2.4节“RESET SLAVE语法”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-multi-source-monitoring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.3多源复制监视</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528033958912"></a><a class="indexterm" name="idm140528033957440"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要监视复制通道的状态，存在以下选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用复制性能架构表。</font><font style="vertical-align: inherit;">这些表的第一列是</font></font><code class="literal">Channel_Name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这使您可以编写基于</font></font><code class="literal">Channel_Name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥的</font><font style="vertical-align: inherit;">复杂查询
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-replication-tables" title="25.11.11性能模式复制表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.11节“性能架构复制表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，如果</font><font style="vertical-align: inherit;">不使用子句，则此语句显示每个通道每行一个通道的从站状态。</font><font style="vertical-align: inherit;">标识符
           </font><font style="vertical-align: inherit;">作为结果集中的列添加。</font><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">提供</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">子句，则结果仅显示指定的复制通道的状态。
</font></font><code class="literal">SHOW SLAVE STATUS FOR CHANNEL
          <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">FOR CHANNEL
          <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">Channel_name</code><font style="vertical-align: inherit;"></font><code class="literal">FOR CHANNEL
          <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-variables" title="13.7.5.39 SHOW VARIABLES语法"><code class="literal">SHOW VARIABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明不适用于多个复制通道。</font><font style="vertical-align: inherit;">通过这些变量可用的信息已被迁移到复制性能表。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-variables" title="13.7.5.39 SHOW VARIABLES语法"><code class="literal">SHOW VARIABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在具有多个通道的拓扑中</font><font style="vertical-align: inherit;">使用
         </font><font style="vertical-align: inherit;">语句仅显示默认通道的状态。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-multi-source-monitoring-tutorial"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.3.1使用性能模式表监视通道</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528033942304"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何使用复制性能模式表来监视通道。</font><font style="vertical-align: inherit;">您可以选择监视所有频道或现有频道的子集。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要监视所有通道的连接状态：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM replication_connection_status\G;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CHANNEL_NAME：master1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
团队名字：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SOURCE_UUID：046e41f8-a223-11e4-a975-0811960cc264</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
THREAD_ID：24</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SERVICE_STATE：开</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COUNT_RECEIVED_HEARTBEATS：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_HEARTBEAT_TIMESTAMP：0000-00-00 00:00:00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RECEIVED_TRANSACTION_SET：046e41f8-a223-11e4-a975-0811960cc264：4-37</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_NUMBER：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_MESSAGE：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_TIMESTAMP：0000-00-00 00:00:00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CHANNEL_NAME：master2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
团队名字：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SOURCE_UUID：7475e474-a223-11e4-a978-0811960cc264</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
THREAD_ID：26</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SERVICE_STATE：开</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COUNT_RECEIVED_HEARTBEATS：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_HEARTBEAT_TIMESTAMP：0000-00-00 00:00:00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RECEIVED_TRANSACTION_SET：7475e474-a223-11e4-a978-0811960cc264：4-6</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_NUMBER：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_MESSAGE：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_TIMESTAMP：0000-00-00 00:00:00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
	    </pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在上面的输出有启用两个通道，如图中的</font></font><code class="literal">CHANNEL_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段它们被称为
         </font></font><code class="literal">master1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">master2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过添加该</font></font><code class="literal">CHANNEL_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段，可以查询特定通道的性能模式表。</font><font style="vertical-align: inherit;">要监视指定通道的连接状态，请使用以下</font><font style="vertical-align: inherit;">
        子句：
      </font></font><code class="literal">WHERE
        CHANNEL_NAME=<em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM replication_connection_status WHERE CHANNEL_NAME='master1'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CHANNEL_NAME：master1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
团队名字：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SOURCE_UUID：046e41f8-a223-11e4-a975-0811960cc264</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
THREAD_ID：24</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SERVICE_STATE：开</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COUNT_RECEIVED_HEARTBEATS：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_HEARTBEAT_TIMESTAMP：0000-00-00 00:00:00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RECEIVED_TRANSACTION_SET：046e41f8-a223-11e4-a975-0811960cc264：4-37</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_NUMBER：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_MESSAGE：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LAST_ERROR_TIMESTAMP：0000-00-00 00:00:00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        同样，该</font><font style="vertical-align: inherit;">子句可用于监视特定通道的其他复制性能模式表。</font><font style="vertical-align: inherit;">有关更多信息，请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-replication-tables" title="25.11.11性能模式复制表"><font style="vertical-align: inherit;">第25.11.11节“性能架构复制表”</font></a><font style="vertical-align: inherit;">。
</font></font><code class="literal">WHERE
        CHANNEL_NAME=<em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-replication-tables" title="25.11.11性能模式复制表"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-multi-source-error-messages"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.4.4多源复制错误消息</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528033926400"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      错误代码和消息提供有关多源复制拓扑中遇到的错误的信息。</font><font style="vertical-align: inherit;">这些错误代码和消息仅在启用多源复制时才会发出，并提供与生成错误的通道相关的信息。</font><font style="vertical-align: inherit;">例如：
    </font></font></p><p>
      <span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站已在运行</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">且
       </font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站已停止</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已被</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制线程</font></font><em class="replaceable"><code>channel_name</code></em><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取代，</font><span class="errortext"><font style="vertical-align: inherit;">以便通道</font></span><span class="errortext"><font style="vertical-align: inherit;">已经运行</font></span><font style="vertical-align: inherit;">且</font><span class="errortext"><font style="vertical-align: inherit;">通道
       </font></span><span class="errortext"><font style="vertical-align: inherit;">的</font></span></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制线程</font></font><em class="replaceable"><code>channel_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别</font><span class="errortext"><font style="vertical-align: inherit;">停止</font></span><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器日志消息也已更改，以指示日志消息与哪个通道相关。</font><font style="vertical-align: inherit;">这使调试和跟踪更容易。

      
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-mode-change-online"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5更改联机服务器上的复制模式</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-concepts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5.1复制模式概念</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-enable-gtids"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5.2在线启用GTID事务</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-disable-gtids"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5.3在线禁用GTID事务</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-verify-transactions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5.4验证匿名事务的复制</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528033918160"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本节介绍如何更改正在使用的复制模式，而不必使服务器脱机。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-mode-change-online-concepts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5.1复制模式概念</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528033915472"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了能够安全地配置在线服务器的复制模式，理解复制的一些关键概念非常重要。</font><font style="vertical-align: inherit;">本节解释这些概念，并且在尝试修改在线服务器的复制模式之前必须阅读。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL中可用的复制模式依靠不同的技术来识别记录的事务。</font><font style="vertical-align: inherit;">复制使用的事务类型如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          GTID事务由表单中的全局事务标识符（GTID）标识</font></font><code class="literal">UUID:NUMBER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">日志中的每个GTID事务始终以a开头
           </font></font><code class="literal">Gtid_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可以使用GTID或使用文件名和位置来处理GTID事务。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          匿名事务没有分配GTID，并且MySQL确保日志中的每个匿名事务之前都有一个</font></font><code class="literal">Anonymous_gtid_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在以前的版本中，匿名事务不会在任何特定事件之前发生。</font><font style="vertical-align: inherit;">匿名交易只能使用文件名和位置来解决。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当使用GTIDs您可以利用自动定位和自动故障转移的，以及使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_wait-for-executed-gtid-set"><code class="literal">WAIT_FOR_EXECUTED_GTID_SET()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_session_track_gtids"><code class="literal">session_track_gtids</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和监控使用Performance模式表复制的事务。</font><font style="vertical-align: inherit;">启用GTID后，您无法使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sql_slave_skip_counter"><code class="literal">sql_slave_skip_counter</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而是使用空交易。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从运行先前版本MySQL的主站接收到的中继日志中的事务根本不会有任何特定事件发生，但是在重播并记录在从属服务器的二进制日志中之后，它们前面会有一个
       </font></font><code class="literal">Anonymous_gtid_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在线配置复制模式的能力意味着</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      变量现在都是动态的，并且可以通过具有该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限</font><font style="vertical-align: inherit;">的帐户从顶级语句中设置
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在以前的版本中，这两个变量只能在服务器启动时使用适当的选项进行配置，这意味着对复制模式的更改需要重新启动服务器。</font><font style="vertical-align: inherit;">在所有版本中
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以设置为
       </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这与GTID是否用于识别交易相对应。</font><font style="vertical-align: inherit;">当</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是不可能复制的匿名交易，而当
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有竞价交易是可以复制的。</font><font style="vertical-align: inherit;">从MySQL 5.7.6开始，
      </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量有两个附加状态，</font></font><code class="literal">OFF_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
       </font></font><code class="literal">ON_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=OFF_PERMISSIVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后
       </font><font style="vertical-align: inherit;">当
       </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新的</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易是匿名的，同时允许复制交易是GTID或匿名交易。</font><font style="vertical-align: inherit;">当
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON_PERMISSIVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再
       </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，同时允许复制的事务事务使用GTIDs是要么GTID或匿名交易。</font><font style="vertical-align: inherit;">这意味着可以使用具有使用匿名和GTID事务的服务器的复制拓扑。</font><font style="vertical-align: inherit;">例如，一个主人
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以复制到一个奴隶
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON_PERMISSIVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有效值</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下，顺序如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">OFF</code>
        </p></li><li class="listitem"><p>
          <code class="literal">OFF_PERMISSIVE</code>
        </p></li><li class="listitem"><p>
          <code class="literal">ON_PERMISSIVE</code>
        </p></li><li class="listitem"><p>
          <code class="literal">ON</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      重要的是要注意，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只能根据上述顺序一次更改</font><font style="vertical-align: inherit;">状态
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，如果
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前设置为
       </font></font><code class="literal">OFF_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则可以更改为
       </font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">ON_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可以</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是为了确保服务器正确处理从匿名事务到在线GTID事务的过程。</font><font style="vertical-align: inherit;">当你在</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font><font style="vertical-align: inherit;">之间切换时
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，GTID状态（换句话说值
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是持久的。</font><font style="vertical-align: inherit;">这可确保始终保留已由服务器应用的GTID集，而不管类型之间的变化如何
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      作为MySQL 5.7.6引入的更改的一部分，与GTID相关的字段已被修改，以便它们显示正确的信息，而不管当前选择的信息如何
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着，display GTID sets fields，比如
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">RECEIVED_TRANSACTION_SET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在对
       </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#replication-connection-status-table" title="25.11.11.2 replication_connection_status表"><code class="literal">replication_connection_status</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      Performance Schema table，和的GTID related结果
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，现在返回空string when there are不存在GTIDs。</font><font style="vertical-align: inherit;">该显示单个GTID领域，如</font></font><code class="literal">CURRENT_TRANSACTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#replication-applier-status-by-worker-table" title="25.11.11.6 replication_applier_status_by_worker表"><code class="literal">replication_applier_status_by_worker
      </code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能模式表，此时显示
       </font></font><code class="literal">ANONYMOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在不使用GTID事务时。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      来自主</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用者的</font><font style="vertical-align: inherit;">复制
       </font><font style="vertical-align: inherit;">提供了使用自动定位的能力，使用该</font></font><code class="literal">CHANGE
      MASTER TO MASTER_AUTO_POSITION = 1;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句进行</font><font style="vertical-align: inherit;">配置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">正在使用的复制拓扑会影响是否可以启用自动定位，因为此功能依赖于GTID并且与匿名事务不兼容。</font><font style="vertical-align: inherit;">如果启用了自动定位并且遇到匿名事务，则会生成错误。</font><font style="vertical-align: inherit;">强烈建议在启用自动定位之前确保拓扑中不存在匿名事务，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-enable-gtids" title="16.1.5.2在线启用GTID事务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.5.2节“在线启用GTID事务”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有效的组合</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      主站和从站的自动定位如下表所示，主
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">站在水平方向显示，从
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">站在垂直方向：

</font></font></p>
<div class="table">
<a name="idm140528033846496"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表16.1主站和从站gtid_mode的有效组合</font></font></b></p>
<div class="table-contents">
<table><colgroup><col width="2.03%"><col width="1%"><col width="2.01%"><col width="1.92%"><col width="1.04%"></colgroup><thead><tr>
            <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                主从 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a>
              </p></th>
            <th scope="col"><p>
                <code class="literal">&gt;OFF</code>
              </p></th>
            <th scope="col"><p>
                <code class="literal">&gt;OFF_PERMISSIVE</code>
              </p></th>
            <th scope="col"><p>
                <code class="literal">&gt;ON_PERMISSIVE</code>
              </p></th>
            <th scope="col"><p>
                <code class="literal">&gt;ON</code>
              </p></th>
          </tr></thead><tbody><tr>
            <td scope="row"><p>
                <code class="literal">&gt;OFF</code>
              </p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ñ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ñ
              </font></font></p></td>
          </tr><tr>
            <td scope="row"><p>
                <code class="literal">&gt;OFF_PERMISSIVE</code>
              </p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Y *
              </font></font></p></td>
          </tr><tr>
            <td scope="row"><p>
                <code class="literal">&gt;ON_PERMISSIVE</code>
              </p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Y *
              </font></font></p></td>
          </tr><tr>
            <td scope="row"><p>
                <code class="literal">&gt;ON</code>
              </p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ñ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ñ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                ÿ
              </font></font></p></td>
            <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Y *
              </font></font></p></td>
</tr></tbody></table>
</div>

</div>
<p><br class="table-break">
    </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在上表中，条目是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">Y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机和从机是兼容的
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">N</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主从设备不兼容
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：可以使用自动定位
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当前选中的</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      也会影响</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next"><code class="literal">gtid_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      变量。</font><font style="vertical-align: inherit;">下表显示了服务器的不同价值观的行为</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      和</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next"><code class="literal">gtid_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528033791328"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表16.2 gtid_mode和gtid_next的有效组合</font></font></b></p>
<div class="table-contents">
<table><colgroup><col width="2.03%"><col width="1%"><col width="2.01%"><col width="1.92%"><col width="1.04%"></colgroup><thead><tr>
          <th scope="col"><p>
              <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next"><code class="literal">gtid_next</code></a>
            </p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              自动
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              二进制登录
            </font></font></p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              自动
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              二进制注销
            </font></font></p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              UUID：NUMBER
            </font></font></p></th>
        </tr></thead><tbody><tr>
          <td scope="row"><p>
              <code class="literal">&gt;OFF</code>
            </p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匿名</font></font></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              错误
            </font></font></p></td>
        </tr><tr>
          <td scope="row"><p>
              <code class="literal">&gt;OFF_PERMISSIVE</code>
            </p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              UUID：NUMBER
            </font></font></p></td>
        </tr><tr>
          <td scope="row"><p>
              <code class="literal">&gt;ON_PERMISSIVE</code>
            </p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              新的GTID
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              UUID：NUMBER
            </font></font></p></td>
        </tr><tr>
          <td scope="row"><p>
              <code class="literal">&gt;ON</code>
            </p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              新的GTID
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              匿名
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              错误
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              UUID：NUMBER
            </font></font></p></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在上表中，条目是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">ANONYMOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：生成一个匿名交易。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：生成一个错误并且无法执行</font></font><code class="literal">SET GTID_NEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">UUID:NUMBER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用指定的UUID：NUMBER生成一个GTID。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">New GTID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用自动生成的数字生成GTID。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当二进制日志关闭并
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next"><code class="literal">gtid_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为
       </font></font><code class="literal">AUTOMATIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则不会生成GTID。</font><font style="vertical-align: inherit;">这与以前版本的行为一致。

      
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-mode-change-online-enable-gtids"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5.2在线启用GTID事务</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528033739344"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何在已联机并使用匿名事务的服务器上启用GTID事务和可选的自动定位。</font><font style="vertical-align: inherit;">此过程不需要使服务器脱机并适合在生产环境中使用。</font><font style="vertical-align: inherit;">但是，如果您有可能在启用GTID事务时使服务器脱机，那么处理更容易。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      开始之前，请确保服务器符合以下前提条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拓扑中的</font><span class="emphasis"><em><font style="vertical-align: inherit;">所有</font></em></span><font style="vertical-align: inherit;">服务器都必须使用MySQL 5.7.6或更高版本。</font><font style="vertical-align: inherit;">除非</font><font style="vertical-align: inherit;">
          拓扑中的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器都使用此版本，</font><font style="vertical-align: inherit;">否则无法在任何单个服务器上联机启用GTID事务</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          所有服务器都</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置为默认值</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下过程可以随时暂停，稍后可以恢复到原来的位置，或通过跳转到</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-disable-gtids" title="16.1.5.3在线禁用GTID事务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.5.3节“在线禁用GTID事务”中禁用GTID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的联机过程中</font><font style="vertical-align: inherit;">的相应步骤
       </font><font style="vertical-align: inherit;">来恢复。</font><font style="vertical-align: inherit;">这使得过程容错，因为可以像平常一样处理可能出现在过程中间的任何不相关的问题，然后程序继续停止。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在继续下一步之前完成每一步是至关重要的。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要启用GTID交易：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ GLOBAL.ENFORCE_GTID_CONSISTENCY = WARN;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          让服务器运行一段时间，正常工作并监视日志。</font><font style="vertical-align: inherit;">如果此步骤在日志中导致任何警告，请调整您的应用程序，使其仅使用GTID兼容功能并且不会生成任何警告。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这是第一个重要步骤。</font><font style="vertical-align: inherit;">在进入下一步之前，您必须确保在错误日志中没有生成警告。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ GLOBAL.ENFORCE_GTID_CONSISTENCY = ON;</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ GLOBAL.GTID_MODE = OFF_PERMISSIVE;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          首先执行此语句的服务器无关紧要，但在任何服务器开始下一步之前，所有服务器完成此步骤都很重要。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ GLOBAL.GTID_MODE = ON_PERMISSIVE;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          首先执行此语句的服务器无关紧要。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上，等待状态变量
           </font></font><code class="literal">ONGOING_ANONYMOUS_TRANSACTION_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为零。</font><font style="vertical-align: inherit;">这可以使用以下方法检查：
</font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW STATUS LIKE'ONGOING_ANONYMOUS_TRANSACTION_COUNT';</font></font></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在复制从属设备上，理论上可能会显示为零，然后再次为非零。</font><font style="vertical-align: inherit;">这不是问题，只要一次显示零即可。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          等到第5步生成的所有事务复制到所有服务器。</font><font style="vertical-align: inherit;">您可以在不停止更新的情况下执行此操作：唯一重要的是所有匿名事务都被复制。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关</font><font style="vertical-align: inherit;">
          检查所有匿名事务已复制到所有服务器的方法，</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-verify-transactions" title="16.1.5.4验证匿名事务的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.5.4节“验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匿名事务的复制”。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您将二进制日志用于除复制之外的其他任何内容，例如时间点备份和恢复，请等到您不需要具有没有GTID的事务的旧的二进制日志。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例如，在步骤6完成后，您可以在执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份的服务器上</font><font style="vertical-align: inherit;">执行
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，明确地进行备份或等待您可能已经设置的任何定期备份例程的下一次迭代。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          理想情况下，等待服务器清除步骤6完成时存在的所有二进制日志。</font><font style="vertical-align: inherit;">同时等待步骤6之前的任何备份过期。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这是第二重要的一点。</font><font style="vertical-align: inherit;">了解包含匿名事务的二进制日志，而不需要GTIDs在下一步之后无法使用是非常重要的。</font><font style="vertical-align: inherit;">完成此步骤后，您必须确保没有GTID的交易不存在于拓扑中的任何位置。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ GLOBAL.GTID_MODE = ON;</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每个服务器，添加</font></font><code class="literal">gtid-mode=ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到
           </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您现在可以保证所有交易都具有GTID（第5步或更早版本中已生成的交易除外）。</font><font style="vertical-align: inherit;">要开始使用GTID协议，以便稍后可以执行自动故障切换，请在每个从站上执行以下操作。</font><font style="vertical-align: inherit;">或者，如果您使用多源复制，请为每个通道执行此操作并包含
           </font><font style="vertical-align: inherit;">子句：
        </font></font><code class="literal">FOR CHANNEL
          <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STOP SLAVE [FOR CHANNEL'频道'];</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CHANGE MASTER TO MASTER_AUTO_POSITION = 1 [FOR CHANNEL'channel'];</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
START SLAVE [FOR CHANNEL'频道'];</font></font></pre></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-mode-change-online-disable-gtids"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5.3在线禁用GTID事务</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528033698976"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何在已联机的服务器上禁用GTID事务。</font><font style="vertical-align: inherit;">此过程不需要使服务器脱机并适合在生产环境中使用。</font><font style="vertical-align: inherit;">但是，如果您有可能在停用GTIDs模式时使服务器脱机，则该过程更容易。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该过程与在服务器联机时启用GTID事务相似，但是会颠倒这些步骤。</font><font style="vertical-align: inherit;">唯一不同的是您等待记录事务复制的点。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      开始之前，请确保服务器符合以下前提条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拓扑中的</font><span class="emphasis"><em><font style="vertical-align: inherit;">所有</font></em></span><font style="vertical-align: inherit;">服务器都必须使用MySQL 5.7.6或更高版本。</font><font style="vertical-align: inherit;">除非</font><font style="vertical-align: inherit;">
          拓扑中的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器都使用此版本，</font><font style="vertical-align: inherit;">否则无法在任何单个服务器上联机禁用GTID事务</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          所有服务器都已</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置为</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每个从属设备上执行以下操作，如果使用多源复制，请为每个通道执行此操作并包含</font></font><code class="literal">FOR CHANNEL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通道子句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STOP SLAVE [FOR CHANNEL'频道'];</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更改MASTER_ MASTER_AUTO_POSITION = 0，MASTER_LOG_FILE =文件，\</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MASTER_LOG_POS =位置[FOR CHANNEL'频道'];</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
START SLAVE [FOR CHANNEL'频道'];</font></font><font></font>
 </pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ GLOBAL.GTID_MODE = ON_PERMISSIVE;</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ GLOBAL.GTID_MODE = OFF_PERMISSIVE;</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上，等待变量@@ GLOBAL.GTID_OWNED等于空字符串。</font><font style="vertical-align: inherit;">这可以使用以下方法检查：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT @@ GLOBAL.GTID_OWNED;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在复制从属设备上，理论上可能这是空的，然后再不是空的。</font><font style="vertical-align: inherit;">这不是一个问题，只要它是空的就足够了。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          等待任何二进制日志中当前存在的所有事务复制到所有从服务器。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">
          检查所有匿名事务已复制到所有服务器的方法，</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-verify-transactions" title="16.1.5.4验证匿名事务的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.5.4节“验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匿名事务的复制”。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您将二进制日志用于除复制以外的其他任何事情，例如执行备份或还原时间点：请等到您不需要具有GTID事务的旧的二进制日志。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例如，在步骤5完成后，您可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在要备份的服务器上</font><font style="vertical-align: inherit;">执行
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，明确地进行备份或等待您可能已经设置的任何定期备份例程的下一次迭代。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          理想情况下，等待服务器清除第5步完成时存在的所有二进制日志。</font><font style="vertical-align: inherit;">同时等待第5步之前的任何备份过期。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这是这个过程中的一个重点。</font><font style="vertical-align: inherit;">了解包含GTID事务的日志在下一步之后无法使用是非常重要的。</font><font style="vertical-align: inherit;">在继续之前，您必须确保GTID事务不存在于拓扑中的任何地方。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每台服务器上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ GLOBAL.GTID_MODE = OFF;</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每个服务器上，设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid-mode=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
           </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你想设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你现在可以这样做。</font><font style="vertical-align: inherit;">设置后，您应该添加
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          到您的配置文件。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果你想降级到早期版本的MySQL，你现在可以使用正常的降级过程。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-mode-change-online-verify-transactions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.5.4验证匿名事务的复制</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528033665200"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何监控复制拓扑并验证所有匿名事务已被复制。</font><font style="vertical-align: inherit;">在线更改复制模式时这很有用，因为您可以验证是否可以安全地更改为GTID事务。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有几种可能的方式来等待事务复制：
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      最简单的方法，不管你的拓扑结构如何，但依赖于时序，如下所示：如果你确信从站的延迟时间不会超过N秒，请等待N秒多一点。</font><font style="vertical-align: inherit;">或等待一天，或等待您认为安全部署的任何时间段。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一种更安全的方法，它不依赖于时间安排：如果您只有一个具有一个或多个从站的主站，请执行以下操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在主人身上执行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW MASTER STATUS;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          记下</font></font><code class="literal">File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">Position</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每个从站上，使用来自主站的文件和位置信息执行：
</font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MASTER_POS_WAIT（file，position）;</font></font></pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您有一个主站和多个从站级别，或者换言之，您有从站从站，请在每个级别上重复步骤2，从主站开始，然后从所有直接从站，然后从站的所有从站等等。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您使用循环复制拓扑，其中多个服务器可能有写客户端，则对每个主从连接执行步骤2，直到完成整个循环。</font><font style="vertical-align: inherit;">重复整个过程，让你做</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两次</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整圈
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      例如，假设您有三台服务器A，B和C在一个圆圈内复制，以便A→B→C→A。然后该过程是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在A上执行第1步，在B上执行第2步。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在B上执行第1步，在C上执行第2步。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在C上执行步骤1并在A上执行步骤2
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在A上执行第1步，在B上执行第2步。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在B上执行第1步，在C上执行第2步。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在C上执行步骤1并在A上执行步骤2
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6复制和二进制日志记录选项和变量</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-options-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.1复制和二进制日志记录选项和变量引用</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-options-master"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.2复制主选项和变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-options-slave"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.3复制从站选项和变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-options-binary-log"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.4二进制日志记录选项和变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-options-gtids"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.5全局事务ID选项和变量</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    以下部分包含有关</font><font style="vertical-align: inherit;">用于复制和控制二进制日志的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项和服务器变量的</font><font style="vertical-align: inherit;">信息
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在复制主站和复制从站上使用的选项和变量将分别进行介绍，以及与二进制日志记录和全局事务标识符（GTID）相关的选项和变量也是如此。</font><font style="vertical-align: inherit;">还提供了一套快速参考表格，提供有关这些选项和变量的基本信息。
  </font></font></p><p><a name="option_mysqld_server-id"></a>
    <a class="indexterm" name="idm140528033643008"></a>

    <a class="indexterm" name="idm140528033641552"></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">--server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">

    尤其重要
     </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for server-id"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--server-id=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_server_id">server_id</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    此选项对于主复制服务器和从属复制服务器都很常用，并且在复制中使用此选项可使主服务器和从属服务器唯一标识自己。</font><font style="vertical-align: inherit;">有关更多信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-master" title="16.1.6.2复制主选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.2节“复制主选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-slave" title="16.1.6.3复制从站选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.3节“复制从属选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在主服务器和每个从服务器上，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该
     </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">--server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项在1到2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  1 </font><font style="vertical-align: inherit;">的范围内建立唯一的复制标识</font><font style="vertical-align: inherit;">。</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示每个标识必须与其他任何复制使用的其他标识不同主人或奴隶。</font><font style="vertical-align: inherit;">例如，
     </font></font><code class="literal">server-id=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"></font><code class="option">--server-id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果启用二进制日志记录，则必须指定</font><font style="vertical-align: inherit;">
    该</font><font style="vertical-align: inherit;">选项，否则不允许服务器启动。</font><font style="vertical-align: inherit;">如果服务器ID设置为0，则进行二进制日志记录，但服务器ID为0的主服务器会拒绝来自从服务器的任何连接，而服务器ID为0的从服务器拒绝连接到主服务器。</font><font style="vertical-align: inherit;">（错误＃11763963，错误＃56739）
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关更多信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-howto-slavebaseconfig" title="16.1.2.5.1设置复制从站配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.2.5.1节“设置复制从站配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><a name="sysvar_server_uuid"></a>
    <a class="indexterm" name="idm140528033600176"></a>

    <a class="indexterm" name="idm140528033598752"></a>

    <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a>
  </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在MySQL 5.7中，除了</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">--server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户提供</font><font style="vertical-align: inherit;">的服务器外，服务器还生成一个真实的UUID </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是作为全局只读变量提供的
     </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如</font><font style="vertical-align: inherit;">本节前面所述，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在MySQL 5.7中</font><font style="vertical-align: inherit;">存在</font><font style="vertical-align: inherit;">系统变量并不会改变</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">--server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个MySQL服务器</font><font style="vertical-align: inherit;">设置唯一的要求，
       </font><font style="vertical-align: inherit;">这是准备和运行MySQL复制的一部分。
</font></font></p>
</div>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for server_uuid"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid">server_uuid</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    启动时，MySQL服务器自动获取UUID，如下所示：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        <a class="indexterm" name="idm140528033570656"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

        尝试读取和使用写入文件的UUID
         </font></font><code class="filename"><em class="replaceable"><code>data_dir</code></em>/auto.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （其中</font></font><em class="replaceable"><code>data_dir</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是服务器的数据目录）。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果
         </font></font><code class="filename"><em class="replaceable"><code>data_dir</code></em>/auto.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        未找到，请生成一个新的UUID并将其保存到此文件中，并根据需要创建该文件。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="filename">auto.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件的格式与用于</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="filename">my.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    文件</font><font style="vertical-align: inherit;">的格式类似</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7中，</font></font><code class="filename">auto.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有一个</font></font><code class="literal">[auto]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分包含单个
     </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置和值; </font><font style="vertical-align: inherit;">该文件的内容与此处显示的内容类似：
  </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[汽车]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
server_uuid = 8a94f357-aab4-11df-86ab-c80aa9429562</font></font><font></font>
</pre>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="filename">auto.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件是自动生成的; </font><font style="vertical-align: inherit;">不要试图编写或修改这个文件。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    当使用MySQL复制时，主设备和从设备知道彼此的UUID。</font><font style="vertical-align: inherit;">从机的UUID的值可以在输出中看到</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-hosts" title="13.7.5.33 SHOW SLAVE HOSTS语法"><code class="literal">SHOW SLAVE HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一旦
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行完成后，主站的UUID的值在从站的输出中可用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><code class="literal">RESET SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句也
       </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置主人的UUID在从属的使用。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">server_uuid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GTID中也使用</font><font style="vertical-align: inherit;">
    服务器</font><font style="vertical-align: inherit;">来处理源自该服务器的事务。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3节“使用全局事务标识符进行复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    启动时，从属I / O线程会生成一个错误，并在主设备的UUID与自己的UUID相同时放弃，除非该
     </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-same-server-id"><code class="option">--replicate-same-server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项已设置。</font><font style="vertical-align: inherit;">此外，如果满足以下任一条件，从I / O线程将生成警告：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        没有预期的主人
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        尽管没有任何</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
        TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">陈述被执行过</font><font style="vertical-align: inherit;">，但</font><font style="vertical-align: inherit;">
        主人</font><font style="vertical-align: inherit;">已经改变</font><font style="vertical-align: inherit;">了。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-options-reference"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.1复制和二进制日志记录选项和变量引用</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下列表提供了有关适用于复制和二进制日志的MySQL命令行选项和系统变量的基本信息。
</font></font></p>
<div class="itemizedlist">
<a name="replication-optvar-summary-list"></a><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_abort-slave-event-count">abort-slave-event-count</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：mysql-test用于调试和测试复制的选项
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery">binlog_gtid_simple_recovery</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：控制在GTID恢复期间如何迭代二进制日志
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_change_master</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：计数CHANGE MASTER TO语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_show_master_status</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：SHOW MASTER STATUS语句的计数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_show_new_master</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：计算SHOW NEW MASTER语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_show_slave_hosts</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：SHOW SLAVE HOSTS语句的计数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_show_slave_status</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：计数SHOW SLAVE STATUS语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_show_slave_status_nonblocking</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：SHOW SLAVE STATUS NONBLOCKING语句的计数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_slave_start</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：计数START SLAVE语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_slave_stop</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：计数STOP SLAVE语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_disconnect-slave-event-count">disconnect-slave-event-count</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：mysql-test用于调试和测试复制的选项
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency">enforce-gtid-consistency</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：阻止执行无法以事务安全方式记录的语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency">enforce_gtid_consistency</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：阻止执行无法以事务安全方式记录的语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_executed-gtids-compression-period">executed-gtids-compression-period</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：弃用并将在未来版本中删除; </font><font style="vertical-align: inherit;">改为使用重命名的gtid-executed-compression-period
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_executed_gtids_compression_period">executed_gtids_compression_period</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：弃用并将在未来版本中删除; </font><font style="vertical-align: inherit;">改为使用重命名的gtid_executed_compression_period
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_gtid-executed-compression-period">gtid-executed-compression-period</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：每次发生这么多事务时压缩gtid_executed表。</font><font style="vertical-align: inherit;">0意味着永不压缩这个表格。</font><font style="vertical-align: inherit;">仅在禁用二进制日志记录时适用。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_gtid-mode">gtid-mode</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：控制是否启用基于GTID的日志记录以及日志可以包含的事务类型
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed">gtid_executed</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：全局：二进制日志（全局）或当前事务（会话）中的所有GTID。</font><font style="vertical-align: inherit;">只读。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed_compression_period">gtid_executed_compression_period</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：每次发生这么多事务时压缩gtid_executed表。</font><font style="vertical-align: inherit;">0意味着永不压缩这个表格。</font><font style="vertical-align: inherit;">仅在禁用二进制日志记录时适用。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode">gtid_mode</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：控制是否启用基于GTID的日志记录以及日志可以包含的事务类型
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next">gtid_next</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：指定要执行的下一个语句的GTID; </font><font style="vertical-align: inherit;">详情请参阅文档
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_owned">gtid_owned</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：由该客户端（会话）或所有客户端拥有的GTID集合以及所有者的线程标识（全局）。</font><font style="vertical-align: inherit;">只读。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged">gtid_purged</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：已从二进制日志中清除的所有GTID的集合
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_init_slave">init_slave</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：从站连接到主站时执行的语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates">log-slave-updates</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：通知从服务器将由其SQL线程执行的更新记录到其自己的二进制日志中
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slave_updates">log_slave_updates</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：从机是否应该将其SQL线程执行的更新记录到其自己的二进制日志中。</font><font style="vertical-align: inherit;">只读; </font><font style="vertical-align: inherit;">使用--log-slave-updates服务器选项设置。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_statements_unsafe_for_binlog">log_statements_unsafe_for_binlog</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：禁止将错误1592警告写入错误日志
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-file">master-info-file</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：记住主服务器的文件的位置和名称以及I / O复制线程在主服务器的二进制日志中的位置
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-repository">master-info-repository</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：是否将主状态信息和主站二进制日志中的复制I / O线程位置写入文件或表
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-retry-count">master-retry-count</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在放弃之前从设备连接到主设备的尝试次数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_info_repository">master_info_repository</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：是否将主状态信息和主站二进制日志中的复制I / O线程位置写入文件或表
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log">relay-log</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：用于中继日志的位置和基本名称
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-index">relay-log-index</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：用于保存上次中继日志列表的文件的位置和名称
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-info-file">relay-log-info-file</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：记录SQL复制线程在中继日志中的位置的文件的位置和名称
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-info-repository">relay-log-info-repository</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：是否将复制SQL线程在中继日志中的位置写入文件或表中
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery">relay-log-recovery</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：在启动时启用从主站自动恢复中继日志文件
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_basename">relay_log_basename</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：中继日志的完整路径，包括文件名
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_index">relay_log_index</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：中继日志索引文件的名称
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_file">relay_log_info_file</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：从站记录有关中继日志信息的文件的名称
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository">relay_log_info_repository</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：是否将复制SQL线程在中继日志中的位置写入文件或表中
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_purge">relay_log_purge</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：确定是否清除中继日志
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery">relay_log_recovery</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：是否启用在启动时自动从主站恢复中继日志文件; </font><font style="vertical-align: inherit;">必须启用碰撞安全从站
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_space_limit">relay_log_space_limit</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：用于所有中继日志的最大空间
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db">replicate-do-db</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：通知从属SQL线程限制复制到指定的数据库
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table">replicate-do-table</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：通知从属SQL线程将复制限制到指定的表
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db">replicate-ignore-db</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：通知从属SQL线程不复制到指定的数据库
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table">replicate-ignore-table</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：指示从属SQL线程不复制到指定的表
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-rewrite-db">replicate-rewrite-db</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：使用与原始名称不同的名称更新数据库
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-same-server-id">replicate-same-server-id</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在复制中，如果设置为1，不要跳过具有我们服务器ID的事件
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table">replicate-wild-do-table</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：通知从属线程将复制限制为匹配指定通配符模式的表
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table">replicate-wild-ignore-table</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：通知从线程不复制到匹配给定通配符模式的表
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-host">report-host</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：从站注册期间向主站报告的从站的主机名或IP
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-password">report-password</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：从服务器应向主机报告的任意密码。</font><font style="vertical-align: inherit;">与MySQL复制用户帐户的密码不同。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-port">report-port</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：从站注册期间连接到从站的端口报告给主站
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-user">report-user</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：从服务器应该向主服务器报告的任意用户名。</font><font style="vertical-align: inherit;">与用于MySQL复制用户帐户的名称不同。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_clients">Rpl_semi_sync_master_clients</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：半同步从站的数量
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_enabled">rpl_semi_sync_master_enabled</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：是否在主服务器上启用了半同步复制
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_net_avg_wait_time">Rpl_semi_sync_master_net_avg_wait_time</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主机等待从机回复的平均时间
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_net_wait_time">Rpl_semi_sync_master_net_wait_time</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主设备等待从设备回复的总时间
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_net_waits">Rpl_semi_sync_master_net_waits</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主机等待从机回复的总次数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_no_times">Rpl_semi_sync_master_no_times</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主设备关闭半同步复制的次数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_no_tx">Rpl_semi_sync_master_no_tx</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：提交的数量未成功确认
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_status">Rpl_semi_sync_master_status</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：是否在主服务器上运行半同步复制
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_timefunc_failures">Rpl_semi_sync_master_timefunc_failures</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：调用时间函数时主设备失败的次数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_timeout">rpl_semi_sync_master_timeout</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：等待从确认的毫秒数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_trace_level">rpl_semi_sync_master_trace_level</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主服务器上的半同步复制调试跟踪级别
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_tx_avg_wait_time">Rpl_semi_sync_master_tx_avg_wait_time</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主服务器等待每个事务的平均时间
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_tx_wait_time">Rpl_semi_sync_master_tx_wait_time</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主服务器等待事务的总时间
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_tx_waits">Rpl_semi_sync_master_tx_waits</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主服务器等待事务的总次数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_wait_for_slave_count">rpl_semi_sync_master_wait_for_slave_count</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：在继续操作之前，主人每次交易必须接收多少个从属确认
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_wait_no_slave">rpl_semi_sync_master_wait_no_slave</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：即使没有从站，主站是否等待超时
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_wait_point">rpl_semi_sync_master_wait_point</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：从机事务接收确认的等待点
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_wait_pos_backtraverse">Rpl_semi_sync_master_wait_pos_backtraverse</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主站等待二进制坐标低于先前等待的事件的总次数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_wait_sessions">Rpl_semi_sync_master_wait_sessions</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：当前等待从应答的会话数量
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_yes_tx">Rpl_semi_sync_master_yes_tx</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：成功确认的提交数量
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_slave_enabled">rpl_semi_sync_slave_enabled</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：是否在从站上启用半同步复制
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_slave_status">Rpl_semi_sync_slave_status</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：是否在从属设备上运行半同步复制
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_slave_trace_level">rpl_semi_sync_slave_trace_level</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：从站上的半同步复制调试跟踪级别
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_rpl_stop_slave_timeout">rpl_stop_slave_timeout</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：设置STOP SLAVE在超时之前等待的秒数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid">server_uuid</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：服务器的全局唯一ID，在服务器启动时自动（重新）生成
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_show-slave-auth-info">show-slave-auth-info</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：在该主设备上的SHOW SLAVE HOSTS中显示用户名和密码
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_simplified_binlog_gtid_recovery">simplified_binlog_gtid_recovery</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：控制在GTID恢复期间如何迭代二进制日志
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start">skip-slave-start</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：如果设置，从站不会自动启动
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-checkpoint-group">slave-checkpoint-group</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：在调用检查点操作以更新进度状态之前，多线程从服务器处理的最大事务数。</font><font style="vertical-align: inherit;">不受NDB集群支持。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-checkpoint-period">slave-checkpoint-period</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在这个毫秒数之后，更新多线程从设备的进程状态并刷新中继日志信息到磁盘。</font><font style="vertical-align: inherit;">不受NDB集群支持。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-load-tmpdir">slave-load-tmpdir</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：当复制LOAD DATA INFILE语句时，从站应该放置其临时文件的位置
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-max-allowed-packet">slave-max-allowed-packet</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：可以从复制主机发送到从机的数据包的最大大小（以字节为单位）; </font><font style="vertical-align: inherit;">覆盖max_allowed_pa​​cket
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-net-timeout">slave_net_timeout</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在中止读取之前等待来自主/从连接的更多数据的秒数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-parallel-type">slave-parallel-type</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：通知从服务器使用时间戳信息（LOGICAL_CLOCK）或数据库分区（DATABASE）来并行化事务。</font><font style="vertical-align: inherit;">缺省值是LOGICAL_CLOCK。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-parallel-workers">slave-parallel-workers</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：并行执行复制事务的应用程序线程数。</font><font style="vertical-align: inherit;">缺省值是4个应用程序线程。</font><font style="vertical-align: inherit;">设置为0可禁用从多线程。</font><font style="vertical-align: inherit;">不受MySQL Cluster支持。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-pending-jobs-size-max">slave-pending-jobs-size-max</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：保持尚未应用事件的从属工作队列的最大大小
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-rows-search-algorithms">slave-rows-search-algorithms</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：确定用于从更新批处理的搜索算法。</font><font style="vertical-align: inherit;">列表INDEX_SEARCH，TABLE_SCAN，HASH_SCAN中的任何2或3
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-skip-errors">slave-skip-errors</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：当查询从提供的列表返回错误时，通知从属线程继续复制
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_checkpoint_group">slave_checkpoint_group</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：在调用检查点操作以更新进度状态之前，多线程从服务器处理的最大事务数。</font><font style="vertical-align: inherit;">不受NDB集群支持。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_checkpoint_period">slave_checkpoint_period</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在这个毫秒数之后，更新多线程从设备的进程状态并刷新中继日志信息到磁盘。</font><font style="vertical-align: inherit;">不受NDB集群支持。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_compressed_protocol">slave_compressed_protocol</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在主/从协议上使用压缩
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode">slave_exec_mode</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：允许在IDEMPOTENT模式（键和其他一些被抑制的错误）和STRICT模式之间切换从线程; </font><font style="vertical-align: inherit;">STRICT模式是默认模式，除了始终使用IDEMPOTENT的NDB群集外
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_heartbeat_period">Slave_heartbeat_period</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：从站的复制心跳间隔（以秒为单位）
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_max_allowed_packet">slave_max_allowed_packet</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：可以从复制主机发送到从机的数据包的最大大小（以字节为单位）; </font><font style="vertical-align: inherit;">覆盖max_allowed_pa​​cket
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_open_temp_tables">Slave_open_temp_tables</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：从属SQL线程当前打开的临时表的数量
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_type">slave_parallel_type</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：通知从服务器使用时间戳信息（LOGICAL_CLOCK）或数据库分区（DATABASE）来并行化事务。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers">slave_parallel_workers</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：并行执行复制事务的应用程序线程数。</font><font style="vertical-align: inherit;">值为0将禁用从多线程。</font><font style="vertical-align: inherit;">不受MySQL Cluster支持。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_pending_jobs_size_max">slave_pending_jobs_size_max</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：保持尚未应用事件的从属工作队列的最大大小
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order">slave_preserve_commit_order</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：确保从属工作人员的所有提交按照与主服务器相同的顺序进行，以在使用并行应用程序线程时保持一致性。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_retried_transactions">Slave_retried_transactions</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：自启动以来复制从属SQL线程重试事务的总次数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_rows_search_algorithms">slave_rows_search_algorithms</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：确定用于从更新批处理的搜索算法。</font><font style="vertical-align: inherit;">列表INDEX_SEARCH，TABLE_SCAN，HASH_SCAN中的任何2或3。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_rows_last_search_algorithm_used">Slave_rows_last_search_algorithm_used</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：该从机最近使用的搜索算法为行复制（索引，表或散列扫描）定位行，
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_running">Slave_running</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：此服务器作为复制从服务器的状态（从I / O线程状态）
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries">slave_transaction_retries</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：从机SQL线程将在重试事务时重试事务的次数，以防在发生死锁或经过的锁定等待超时之前放弃并停止
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_type_conversions">slave_type_conversions</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：控制复制从站上的类型转换模式。</font><font style="vertical-align: inherit;">值是列表中零个或多个元素的列表：ALL_LOSSY，ALL_NON_LOSSY。</font><font style="vertical-align: inherit;">设置为空字符串以禁止主从机之间的类型转换。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sql_slave_skip_counter">sql_slave_skip_counter</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：主服务器应该跳过的事件数量。</font><font style="vertical-align: inherit;">与GTID复制不兼容。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog">sync_binlog</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在第＃个事件后同步刷新二进制日志到磁盘
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_master_info">sync_master_info</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在第＃个事件之后将master.info同步到磁盘
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log">sync_relay_log</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在第＃个事件之后，将中继日志同步到磁盘
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log_info">sync_relay_log_info</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在第＃个事件之后，将relay.info文件同步到磁盘
</font></font></p></li></ul>
</div>
<p>
      <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-master" title="16.1.6.2复制主选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.2节“复制主选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了有关复制主服务器的选项和变量的更多详细信息。</font><font style="vertical-align: inherit;">有关与复制从服务器相关的选项和变量的更多信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-slave" title="16.1.6.3复制从站选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.3节“复制从服务器选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<a name="binlog-optvar-summary-list"></a><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-checksum">binlog-checksum</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：启用/禁用二进制日志校验和
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db">binlog-do-db</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：将二进制日志记录限制到特定数据库
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_binlog-format">binlog_format</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：指定二进制日志的格式
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db">binlog-ignore-db</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：告诉主控人员不应将给定数据库的更新记录到二进制日志中
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-row-event-max-size">binlog-row-event-max-size</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：二进制日志最大事件大小
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-rows-query-log-events">binlog-rows-query-log-events</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：在使用基于行的日志记录时，启用记录行查询日志事件。</font><font style="vertical-align: inherit;">默认情况下禁用。</font><font style="vertical-align: inherit;">为5.6之前的从站/读取器生成日志时不要启用。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Binlog_cache_disk_use">Binlog_cache_disk_use</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：使用临时文件而不是二进制日志缓存的事务数量
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_cache_size">binlog_cache_size</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：缓存的大小，用于在事务期间保存二进制日志的SQL语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Binlog_cache_use">Binlog_cache_use</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：使用临时二进制日志缓存的事务数量
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_checksum">binlog_checksum</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：启用/禁用二进制日志校验和
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates">binlog_direct_non_transactional_updates</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：将使用语句格式的更新导致非事务性引擎直接写入二进制日志。</font><font style="vertical-align: inherit;">使用前请参阅文档。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_error_action">binlog_error_action</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：控制服务器无法写入二进制日志时发生的情况
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay">binlog_group_commit_sync_delay</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：设置在将事务同步到磁盘之前要等待的微秒数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_no_delay_count">binlog_group_commit_sync_no_delay_count</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：DESCRIPTION：设置在放弃由binlog_group_commit_sync_delay指定的当前延迟之前等待的最大事务数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_max_flush_queue_time">binlog_max_flush_queue_time</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：在刷新到二进制日志前读取事务多长时间
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_order_commits">binlog_order_commits</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：是否以与写入二进制日志相同的顺序提交
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_row_image">binlog_row_image</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：记录行更改时使用完整或最小的图像
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_rows_query_log_events">binlog_rows_query_log_events</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：当为TRUE时，在基于行的记录模式下启用记录行查询日志事件。</font><font style="vertical-align: inherit;">默认为FALSE。</font><font style="vertical-align: inherit;">为5.6之前的复制从站或其他读取器生成日志时，请勿启用。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Binlog_stmt_cache_disk_use">Binlog_stmt_cache_disk_use</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：使用临时文件而非二进制日志语句高速缓存的非事务语句的数量
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_stmt_cache_size">binlog_stmt_cache_size</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：缓存的大小，用于在事务期间保存二进制日志的非事务语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Binlog_stmt_cache_use">Binlog_stmt_cache_use</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：使用临时二进制日志语句高速缓存的语句数
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlogging_impossible_mode">binlogging_impossible_mode</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：弃用并将在未来版本中删除。</font><font style="vertical-align: inherit;">改用重命名的binlog_error_action。
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_show_binlog_events</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：计数SHOW BINLOG EVENTS语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx">Com_show_binlogs</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：计数SHOW BINLOGS语句
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin-use-v1-row-events">log-bin-use-v1-row-events</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：使用版本1二进制日志行事件
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_basename">log_bin_basename</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：二进制日志文件的路径和基本名称
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_use_v1_row_events">log_bin_use_v1_row_events</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：显示服务器是否使用版本1二进制日志行事件
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-verify-checksum">master-verify-checksum</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：导致主机在从二进制日志读取时检查校验和
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_verify_checksum">master_verify_checksum</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：导致主机从二进制日志读取校验和
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_max-binlog-dump-events">max-binlog-dump-events</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：mysql-test用于调试和测试复制的选项
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_cache_size">max_binlog_cache_size</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：可用于限制用于缓存多语句事务的总大小
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_size">max_binlog_size</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说明：当大小超过此值时，二进制日志将自动旋转
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_stmt_cache_size">max_binlog_stmt_cache_size</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：可用于限制用于在事务处理期间缓存所有非事务语句的总大小
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-sql-verify-checksum">slave-sql-verify-checksum</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：当从继电器日志读取时，使从站检查校验和
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_sql_verify_checksum">slave_sql_verify_checksum</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：当从继电器日志读取时，使从站检查校验和
    </font></font></p></li><li class="listitem"><p>
      <code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_sporadic-binlog-dump-fail">sporadic-binlog-dump-fail</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：描述：mysql-test用于调试和测试复制的选项
</font></font></p></li></ul>
</div>
<p>
      <a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-binary-log" title="16.1.6.4二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.4节“二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了有关</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-binary-log" title="16.1.6.4二进制日志记录选项和变量"><font style="vertical-align: inherit;">二进制日志记录的选项和变量的</font></a><font style="vertical-align: inherit;">更多详细信息。</font><font style="vertical-align: inherit;">有关二进制日志的其他一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_log_bin"><code class="literal">sql_log_bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_log_off"><code class="literal">sql_log_off</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于具有</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行选项</font><font style="vertical-align: inherit;">的lsiting，</font><font style="vertical-align: inherit;">与</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld一起</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的系统和状态变量</font><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#mysqld-option-tables" title="5.1.3服务器选项和变量引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.3节“服务器选项和变量引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-options-master"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.2复制主选项和变量</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍可用于复制主服务器的服务器选项和系统变量。</font><font style="vertical-align: inherit;">您可以在
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#command-line-options" title="4.2.4在命令行上使用选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中指定
       </font><a class="link" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;">选项</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以使用指定系统变量值
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在主服务器和每个从服务器上，您必须使用该
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来建立唯一的复制ID。</font><font style="vertical-align: inherit;">对于每个服务器，您应该从1到2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  1 </font><font style="vertical-align: inherit;">范围内选择一个唯一的正整数</font><font style="vertical-align: inherit;">，并且每个ID必须与任何其他复制主服务器或从服务器使用的每个其他ID不同。</font><font style="vertical-align: inherit;">例如：</font></font><code class="literal">server-id=3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关用于控制二进制日志记录的主服务器的选项，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-binary-log" title="16.1.6.4二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.4节“二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="replication-optvars-masters"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制主机的启动选项</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表介绍了用于控制复制主服务器的启动选项。</font><font style="vertical-align: inherit;">本节稍后将讨论与复制相关的系统变量。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_show-slave-auth-info"></a>
            <a class="indexterm" name="idm140528033192400"></a>

            <a class="indexterm" name="idm140528033190944"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_show-slave-auth-info"><code class="option">--show-slave-auth-info</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for show-slave-auth-info"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--show-slave-auth-info</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-hosts" title="13.7.5.33 SHOW SLAVE HOSTS语法"><code class="literal">SHOW SLAVE HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器</font><font style="vertical-align: inherit;">
            的输出中</font><font style="vertical-align: inherit;">显示用于使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-user"><code class="option">--report-user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-password"><code class="option">--report-password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动的
             </font><font style="vertical-align: inherit;">从站的从站用户名和密码
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="replication-sysvars-masters"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制大师使用的系统变量</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下系统变量用于控制复制主文件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_auto_increment_increment"></a>
            <a class="indexterm" name="idm140528033166560"></a>

            <a class="indexterm" name="idm140528033165456"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for auto_increment_increment"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment">auto_increment_increment</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">65535</code></td>
</tr></tbody></table>
</div>
<p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并且</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            旨在用于master-to-master复制，并可用于控制</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的操作
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这两个变量都具有全局值和会话值，并且每个变量都可以采用介于1和65,535之间的整数值。</font><font style="vertical-align: inherit;">将这两个变量中任何一个的值设置为0会导致将其值设置为1。</font><font style="vertical-align: inherit;">试图将这两个变量中任何一个的值设置为大于65,535或小于0的整数时，会将其值设置为65,535。</font><font style="vertical-align: inherit;">试图设置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font><font style="vertical-align: inherit;">的值
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 非整数值产生一个错误，并且变量的实际值保持不变。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
              <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              也支持与</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">一起使用
               </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这两个变量影响</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            列行为，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制连续列值之间的间隔。</font><font style="vertical-align: inherit;">例如：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'auto_inc%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auto_increment_increment | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auto_increment_offset | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE autoinc1</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>(col INT NOT NULL AUTO_INCREMENT PRIMARY KEY);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  查询OK，0行受影响（0.04秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SET @@auto_increment_increment=10;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'auto_inc%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auto_increment_increment | </font><font style="vertical-align: inherit;">10 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auto_increment_offset | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.01秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO autoinc1 VALUES (NULL), (NULL), (NULL), (NULL);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，4行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：4个重复：0个警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT col FROM autoinc1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">col |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">21 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">31 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4行（0.00秒）</font></font><font></font>
</pre></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                确定</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值</font><font style="vertical-align: inherit;">的起点
                 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">考虑以下内容，假定这些语句是在与描述中给出的示例相同的会话期间执行的
                 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET @@auto_increment_offset=5;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'auto_inc%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auto_increment_increment | </font><font style="vertical-align: inherit;">10 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auto_increment_offset | </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE autoinc2</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>(col INT NOT NULL AUTO_INCREMENT PRIMARY KEY);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.06秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO autoinc2 VALUES (NULL), (NULL), (NULL), (NULL);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，4行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：4个重复：0个警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT col FROM autoinc2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">col |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">15 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">25 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">35 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置4行（0.02秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当值
                 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                大于时
                 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，值
                 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                被忽略。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果这些变量中的任何一个被更改，然后将新行插入到包含</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的表中
             </font><font style="vertical-align: inherit;">，结果可能看起来是违反直觉的，因为</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算</font><font style="vertical-align: inherit;">一系列
             </font><font style="vertical-align: inherit;">值时不考虑列中已存在的任何值，并且插入的下一个值是系列中最大值大于</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">最大现有值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该系列计算如下：
          </font></font></p><p>
            <code class="literal">auto_increment_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+
             </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">×
            </font></font><code class="literal">auto_increment_increment</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            其中</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是序列[1,2,3，...]中的正整数值。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'auto_inc%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auto_increment_increment | </font><font style="vertical-align: inherit;">10 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">auto_increment_offset | </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT col FROM autoinc1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">col |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">21 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">31 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO autoinc1 VALUES (NULL), (NULL), (NULL), (NULL);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，4行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：4个重复：0个警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT col FROM autoinc1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">col |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">21 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">31 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">35 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">45 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">55 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">65 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
集合中的8行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            显示</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            生成5 + </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">×10 </font><font style="vertical-align: inherit;">系列</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">，即[5,15,25,35,45，...]。</font></font><code class="literal">col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列之前</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">列中
             </font><font style="vertical-align: inherit;">的最高值为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">31，并且</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系列中</font><font style="vertical-align: inherit;">的下一个可用值为</font><font style="vertical-align: inherit;">35，因此插入的值
             </font></font><code class="literal">col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始于该点，结果如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查询</font><font style="vertical-align: inherit;">所示</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不可能将这两个变量的影响限制在一个表中; </font><font style="vertical-align: inherit;">这些变量控制</font><font style="vertical-align: inherit;">MySQL服务器上</font><span class="emphasis"><em><font style="vertical-align: inherit;">所有</font></em></span><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">中所有</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
             </font><font style="vertical-align: inherit;">的行为</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果设置了任一变量的全局值，则其效果将一直保持到全局值被更改或通过设置会话值或覆盖直到</font><font style="vertical-align: inherit;">重新启动</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;">mysqld</font></strong></span></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果设置了本地值，则新值将影响
             </font><font style="vertical-align: inherit;">当前用户在会话期间插入新行的所有表的列，除非在该会话期间更改了这些值。
          </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            缺省值
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是1.请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-auto-increment" title="16.4.1.1复制和AUTO_INCREMENT"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.1节“复制和AUTO_INCREMENT”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_auto_increment_offset"></a>
            <a class="indexterm" name="idm140528033072384"></a>

            <a class="indexterm" name="idm140528033071344"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for auto_increment_offset"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset">auto_increment_offset</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">65535</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此变量的默认值为1.有关更多信息，请参阅说明
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
              <code class="literal">auto_increment_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也支持与</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">一起使用</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-options-slave"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.3复制从站选项和变量</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍适用于从属复制服务器的服务器选项和系统变量，并包含以下内容：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-optvars-slaves" title="复制从站的启动选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制从站的启动选项</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-slave-log-tables" title="将从站状态记录到表格的选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将从站状态记录到表格的选项</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-sysvars-slaves" title="系统变量用于复制从站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量用于复制从站</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#command-line-options" title="4.2.4在命令行上使用选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中指定
       </font><a class="link" href="/mysql-5.7-google-zh/programs.html#option-files" title="4.2.6使用选项文件"><font style="vertical-align: inherit;">选项</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">许多选项可以在服务器运行时通过使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">来设置
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用指定系统变量值
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器ID。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在主服务器和每个从服务器上，必须使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项在1到2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  1 </font><font style="vertical-align: inherit;">的范围内建立唯一的复制ID </font><font style="vertical-align: inherit;">。</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        表示每个ID必须与其他任何复制主服务器使用的每个其他ID不同或奴隶。</font><font style="vertical-align: inherit;">示例
         </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务器ID = 3</font></font><font></font>
</pre>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="replication-optvars-slaves"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制从站的启动选项</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍用于控制复制从服务器的启动选项。</font><font style="vertical-align: inherit;">许多这些选项可以在服务器运行时通过使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">来设置
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">其他，如</font></font><code class="option">--replicate-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，只能在从服务器启动时设置。</font><font style="vertical-align: inherit;">本节后面将讨论与复制相关的系统变量。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_log-slave-updates"></a>
            <a class="indexterm" name="idm140528033017184"></a>

            <a class="indexterm" name="idm140528033015728"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log-slave-updates"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-slave-updates</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slave_updates">log_slave_updates</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常，从站不会将从主服务器接收到的任何更新写入其自己的二进制日志。</font><font style="vertical-align: inherit;">该选项使从服务器将由其SQL线程执行的更新写入其自己的二进制日志。</font><font style="vertical-align: inherit;">为使此选项有效，从站必须启动，
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并启用二进制日志记录选项。
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于链接复制服务器时。</font><font style="vertical-align: inherit;">例如，您可能想要使用此安排设置复制服务器：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A→B→C
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在这里，</font></font><code class="literal">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为奴隶的主人</font></font><code class="literal">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="literal">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为奴隶的主人</font></font><code class="literal">C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了这个工作，</font></font><code class="literal">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须是主人
             </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奴隶。</font><font style="vertical-align: inherit;">你必须同时启动
             </font></font><code class="literal">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="literal">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以启用二进制日志，并</font></font><code class="literal">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，以便从收到的更新</font></font><code class="literal">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过登录</font></font><code class="literal">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到它的二进制日志。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_log-slow-slave-statements"></a>
            <a class="indexterm" name="idm140528032974480"></a>

            <a class="indexterm" name="idm140528032973024"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slow-slave-statements"><code class="option">--log-slow-slave-statements</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log-slow-slave-statements"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-slow-slave-statements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （5.7.0）</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.1</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个命令行选项在MySQL 5.7.1中被删除，并被</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slow_slave_statements"><code class="literal">log_slow_slave_statements</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量</font><font style="vertical-align: inherit;">取代
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">系统变量可以在命令行或选项文件中以与选项相同的方式进行设置，因此在服务器启动时不需要进行任何更改，但系统变量也可以在运行时检查或设置值。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528032950032"></a>

            <a class="indexterm" name="idm140528032948544"></a>

            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-warnings"><code class="option">--log-warnings[=<em class="replaceable"><code>level</code></em>]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log-warnings"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-warnings[=#]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.2</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_warnings">log_warnings</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台，&gt; = 5.7.2）</font></font></td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台，&lt;= 5.7.1）</font></font></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台，&gt; = 5.7.2）</font></font></td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台，&lt;= 5.7.1）</font></font></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所述</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_error_verbosity"><code class="literal">log_error_verbosity</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量优于，和应使用的相反，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-warnings"><code class="option">--log-warnings</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项或
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_warnings"><code class="literal">log_warnings</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">欲了解更多信息，请参阅的说明
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_error_verbosity"><code class="literal">log_error_verbosity</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_warnings"><code class="literal">log_warnings</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-warnings"><code class="option">--log-warnings</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行选项和</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_warnings"><code class="literal">log_warnings</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量被取消，并将在未来的MySQL版本中删除。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使服务器将更多消息记录到错误日志中，了解它正在做什么。</font><font style="vertical-align: inherit;">关于复制，服务器会生成警告，告诫它在网络或连接失败后成功重新连接，并提供有关每个从属线程如何启动的信息。</font><font style="vertical-align: inherit;">该变量默认设置为2。</font><font style="vertical-align: inherit;">要禁用它，请将其设置为0.如果该值大于0，则服务器记录有关对基于语句的日志记录不安全的语句的消息。如果值大于0，则记录新连接尝试的中止连接和拒绝访问错误1.参见</font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#communication-errors" title="B.5.2.10通信错误和中止连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.2.10节“通信错误和中止的连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此选项的作用不限于复制。</font><font style="vertical-align: inherit;">它会影响各种服务器活动的诊断消息。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_master-info-file"></a>
            <a class="indexterm" name="idm140528032880064"></a>

            <a class="indexterm" name="idm140528032878576"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-file"><code class="option">--master-info-file=<em class="replaceable"><code>file_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for master-info-file"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--master-info-file=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">master.info</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于记录有关主站的信息的文件的名称。</font><font style="vertical-align: inherit;">默认名称
             </font></font><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于数据目录中。</font><font style="vertical-align: inherit;">有关此文件格式的信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs-status" title="16.2.4.2从站状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4.2节“从站状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_master-retry-count"></a>
            <a class="indexterm" name="idm140528032857856"></a>

            <a class="indexterm" name="idm140528032856400"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-retry-count"><code class="option">--master-retry-count=<em class="replaceable"><code>count</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for master-retry-count"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--master-retry-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">86400</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">86400</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从机在放弃之前尝试连接主机的次数。</font></font><code class="literal">MASTER_CONNECT_RETRY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
            TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">设置的时间间隔尝试重新连接</font><font style="vertical-align: inherit;">（默认</font><font style="vertical-align: inherit;">值为</font><font style="vertical-align: inherit;">60）。</font><font style="vertical-align: inherit;">根据</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-net-timeout"><code class="option">--slave-net-timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项，</font><font style="vertical-align: inherit;">由从站超时读取数据时会触发重新连接</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认值是86400.值为0意味着
             </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无限</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从机试图永远连接。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项已弃用，将在未来的MySQL版本中删除。</font><font style="vertical-align: inherit;">应该更新应用程序以改为使用</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的
             </font></font><code class="literal">MASTER_RETRY_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_max-relay-log-size"></a>
            <a class="indexterm" name="idm140528032808752"></a>

            <a class="indexterm" name="idm140528032807296"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_max-relay-log-size"><code class="option">--max-relay-log-size=<em class="replaceable"><code>size</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for max_relay_log_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--max-relay-log-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_relay_log_size">max_relay_log_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器自动旋转中继日志文件的大小。</font><font style="vertical-align: inherit;">如果此值不为零，则继电器日志会在其大小超过此值时自动旋转。</font><font style="vertical-align: inherit;">如果此值为零（默认值），则继电器记录旋转的大小由值
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_size"><code class="literal">max_binlog_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs-relaylog" title="16.2.4.1从站中继日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4.1节“从站中继日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_relay-log"></a>
            <a class="indexterm" name="idm140528032770688"></a>

            <a class="indexterm" name="idm140528032769232"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log=<em class="replaceable"><code>file_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay-log"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log">relay_log</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            中继日志的基本名称。</font><font style="vertical-align: inherit;">对于默认复制通道，中继日志的默认基本名称为
             </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于非默认复制通道，中继日志的默认基本名称是
             </font><font style="vertical-align: inherit;">，其中</font><font style="vertical-align: inherit;">是此中继日志中记录的复制通道的名称。</font><font style="vertical-align: inherit;">服务器将该文件写入数据目录中，除非使用前导绝对路径名给出基名以指定不同的目录。</font><font style="vertical-align: inherit;">服务器通过向基本名称添加数字后缀来依次创建中继日志文件。
          </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin-<em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>channel</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于MySQL解析服务器选项的方式，如果指定了此选项，则必须提供一个值;
            </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当实际未指定选项时才使用默认基本名称</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您使用该
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项而未指定值，则可能会导致意外的行为; </font><font style="vertical-align: inherit;">此行为取决于所使用的其他选项，它们的指定顺序以及它们是在命令行还是在选项文件中指定的。</font><font style="vertical-align: inherit;">有关MySQL如何处理服务器选项的更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#program-options" title="4.2.3指定程序选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.3节“指定程序选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果指定此选项，则指定的值也将用作中继日志索引文件的基本名称。</font><font style="vertical-align: inherit;">您可以通过使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-index"><code class="option">--relay-log-index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">指定不同的中继日志索引文件基本名称来覆盖此行为
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当服务器从索引文件读取条目时，它会检查条目是否包含相对路径。</font><font style="vertical-align: inherit;">如果是这样，路径的相对部分将替换为使用该</font></font><code class="option">--relay-log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">设置的绝对路径</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">绝对路径保持不变; </font><font style="vertical-align: inherit;">在这种情况下，索引必须手动编辑以启用新的路径。</font><font style="vertical-align: inherit;">以前，每当重新定位二进制日志或中继日志文件时都需要手动干预。</font><font style="vertical-align: inherit;">（Bug＃11745230，错误＃12133）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可能会发现该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项可用于执行以下任务：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                创建名称与主机名无关的中继日志。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果您需要将继电器日志放在数据目录以外的某个区域，因为您的中继日志往往非常大，您不想减少
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_relay_log_size"><code class="literal">max_relay_log_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                通过在磁盘之间使用负载平衡来提高速度。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以从</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_basename"><code class="literal">relay_log_basename</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量中</font><font style="vertical-align: inherit;">获取中继日志文件名称（和路径）
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_relay-log-index"></a>
            <a class="indexterm" name="idm140528032727120"></a>

            <a class="indexterm" name="idm140528032725632"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-index"><code class="option">--relay-log-index=<em class="replaceable"><code>file_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay-log-index"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-index=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_index">relay_log_index</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于中继日志索引文件的名称。</font><font style="vertical-align: inherit;">默认名称
             </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin.index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            位于数据目录中，其中
             </font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是服务器的名称。</font><font style="vertical-align: inherit;">对于默认复制通道，默认名称为
             </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin.index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于非默认复制通道，默认名称为
             </font><font style="vertical-align: inherit;">，其中</font><font style="vertical-align: inherit;">是此中继日志索引中记录的复制通道的名称。
          </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin-<em class="replaceable"><code>channel</code></em>.index</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>channel</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于MySQL解析服务器选项的方式，如果指定了此选项，则必须提供一个值;
            </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当实际未指定选项时才使用默认基本名称</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您使用该
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-index"><code class="option">--relay-log-index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项而未指定值，则可能会导致意外的行为; </font><font style="vertical-align: inherit;">此行为取决于所使用的其他选项，它们的指定顺序以及它们是在命令行还是在选项文件中指定的。</font><font style="vertical-align: inherit;">有关MySQL如何处理服务器选项的更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#program-options" title="4.2.3指定程序选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.3节“指定程序选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_relay-log-info-file"></a>
            <a class="indexterm" name="idm140528032692768"></a>

            <a class="indexterm" name="idm140528032691312"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-info-file"><code class="option">--relay-log-info-file=<em class="replaceable"><code>file_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay-log-info-file"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-info-file=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">relay-log.info</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于从站记录有关中继日志信息的文件的名称。</font><font style="vertical-align: inherit;">默认名称
             </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于数据目录中。</font><font style="vertical-align: inherit;">有关此文件格式的信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs-status" title="16.2.4.2从站状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4.2节“从站状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_relay-log-purge"></a>
            <a class="indexterm" name="idm140528032670480"></a>

            <a class="indexterm" name="idm140528032668992"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-purge"><code class="option">--relay-log-purge={0|1}</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay_log_purge"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-purge</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_purge">relay_log_purge</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">TRUE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不再需要时，立即禁用或启用自动清除中继日志。</font><font style="vertical-align: inherit;">默认值是1（启用）。</font><font style="vertical-align: inherit;">这是一个全局变量，可以动态改变</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在使用该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">时禁用清除中继日志
             </font><font style="vertical-align: inherit;">会将数据一致性置于危险之中。
          </font></font><code class="literal">SET GLOBAL relay_log_purge =
            <em class="replaceable"><code>N</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><a name="option_mysqld_relay-log-recovery"></a>
            <a class="indexterm" name="idm140528032638768"></a>

            <a class="indexterm" name="idm140528032637312"></a>

            <a class="indexterm" name="idm140528032635808"></a>

            <a class="indexterm" name="idm140528032634736"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery={0|1}</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay-log-recovery"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-recovery</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器启动后立即启用自动中继日志恢复。</font><font style="vertical-align: inherit;">恢复过程将创建一个新的中继日志文件，将SQL线程位置初始化为此新的中继日志，并将I / O线程初始化为SQL线程位置。</font><font style="vertical-align: inherit;">继续从主站读取中继日志。</font><font style="vertical-align: inherit;">这应该在复制从站意外停止之后使用，以确保不会处理可能损坏的中继日志。</font><font style="vertical-align: inherit;">默认值是0（禁用）。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以将此变量设置为1，以使从服务器可以处理意外暂停，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt" title="16.3.2处理意外的复制从站暂停"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.2节“处理意外暂停的复制从服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            以获取更多信息。</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_purge"><code class="option">relay-log-purge</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">启用此
             </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">可能会导致从未清除的文件中读取中继日志，从而导致数据不一致。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用多线程从站（换句话说
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，大于0）时，从中继日志执行的事务序列中可能会出现不一致，如间隙。</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出现不一致时</font><font style="vertical-align: inherit;">启用该
             </font><font style="vertical-align: inherit;">选项会导致错误，该选项不起作用。</font><font style="vertical-align: inherit;">这种情况下的解决方案是发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START
            SLAVE UNTIL SQL_AFTER_MTS_GAPS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这会使服务器达到更一致的状态，然后发布
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><code class="literal">RESET SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除中继日志。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">
            更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-transaction-inconsistencies" title="16.4.1.33复制和事务不一致"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-transaction-inconsistencies" title="16.4.1.33复制和事务不一致"><font style="vertical-align: inherit;">第16.4.1.33节“复制和事务不一致性”</font></a><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_relay-log-space-limit"></a>
            <a class="indexterm" name="idm140528032605360"></a>

            <a class="indexterm" name="idm140528032603904"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-space-limit"><code class="option">--relay-log-space-limit=<em class="replaceable"><code>size</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay_log_space_limit"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-space-limit=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_space_limit">relay_log_space_limit</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项为从站上的所有中继日志的总大小（以字节为单位）设置上限。</font><font style="vertical-align: inherit;">值为0意味着</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有限制</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这对于磁盘空间有限的从服务器主机很有用。</font><font style="vertical-align: inherit;">当达到限制时，I / O线程将停止从主服务器读取二进制日志事件，直到SQL线程捕获并删除一些未使用的中继日志。</font><font style="vertical-align: inherit;">请注意，此限制不是绝对的：有些情况下SQL线程需要更多事件才能删除中继日志。</font><font style="vertical-align: inherit;">在这种情况下，I / O线程超出限制，直到SQL线程有可能删除某些中继日志为止，因为不这样做会导致死锁。</font><font style="vertical-align: inherit;">你不应该设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-space-limit"><code class="option">--relay-log-space-limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低于</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_max-relay-log-size"><code class="option">--max-relay-log-size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_size"><code class="option">--max-binlog-size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果）
             </font><font style="vertical-align: inherit;">的值的两倍
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_max-relay-log-size"><code class="option">--max-relay-log-size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是0）。</font><font style="vertical-align: inherit;">在这种情况下，I / O线程有可能因为</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-space-limit"><code class="option">--relay-log-space-limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超出而</font><font style="vertical-align: inherit;">等待可用空间
             </font><font style="vertical-align: inherit;">，但SQL线程没有中继日志来清除并且无法满足I / O线程。</font><font style="vertical-align: inherit;">这迫使I / O线程</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-space-limit"><code class="option">--relay-log-space-limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            暂时</font><font style="vertical-align: inherit;">忽略
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_replicate-do-db"></a>
            <a class="indexterm" name="idm140528032548816"></a>

            <a class="indexterm" name="idm140528032547328"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db=<em class="replaceable"><code>db_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for replicate-do-db"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--replicate-do-db=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用数据库的名称创建复制筛选器。</font><font style="vertical-align: inherit;">这些过滤器也可以使用创建
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-replication-filter" title="13.4.2.2更改复制过滤器语法"><code class="literal">CHANGE
            REPLICATION FILTER REPLICATE_DO_DB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此过滤的确切效果取决于基于语句的还是基于行的复制正在使用中，并在接下来的几段中进行介绍。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句的复制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              告诉从SQL线程限制复制到报表，其中默认的数据库（即，由选定的一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是
               </font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要指定多个数据库，请多次使用此选项，每个数据库使用一次; </font><font style="vertical-align: inherit;">但是，这样做
               </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制跨数据库语句，例如</font><font style="vertical-align: inherit;">在选择不同的数据库（或没有数据库）的情况下。
</font></font><code class="literal">UPDATE
              <em class="replaceable"><code>some_db.some_table</code></em> SET
              foo='bar'</code><font style="vertical-align: inherit;"></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要指定多个数据库，您
               </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此选项的多个实例。</font><font style="vertical-align: inherit;">由于数据库名称可以包含逗号，因此如果提供逗号分隔列表，则该列表将被视为单个数据库的名称。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用基于语句的复制时，您可能会发现不起作用的示例：如果从属服务器已启动</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并且您在主服务器上发出以下语句，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font><font style="vertical-align: inherit;">该
             </font><font style="vertical-align: inherit;">语句
             </font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用价格;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE sales.january SET amount = amount + 1000;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这种</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只检查默认数据库</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行为的</font><font style="vertical-align: inherit;">主要原因</font><font style="vertical-align: inherit;">是，从语句中很难知道是否应该复制它（例如，如果您使用多表
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            跨多个表单操作的多</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">语句数据库）。</font><font style="vertical-align: inherit;">如果不需要，只检查默认数据库而不检查所有数据库也更快。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              告诉从属SQL线程限制复制到数据库</font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">只有属于的表</font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被改变; </font><font style="vertical-align: inherit;">当前数据库对此没有影响。</font><font style="vertical-align: inherit;">假设从机启动
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且基于行的复制生效，然后在主机上运行以下语句：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用价格;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE sales.february SET amount = amount + 100;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据</font><font style="vertical-align: inherit;">
            声明</font><font style="vertical-align: inherit;">更改从站数据库中</font><font style="vertical-align: inherit;">
            的</font></font><code class="literal">february</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格
             </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">无论是否</font><font style="vertical-align: inherit;">发布声明都会</font><font style="vertical-align: inherit;">发生这种情况
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，在使用基于行的复制时，在主站上发出以下语句对从站没有影响，并且
             </font><font style="vertical-align: inherit;">：
          </font></font><code class="literal">sales</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db=sales</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用价格;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE prices.march SET amount = amount-25;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            即使声明</font></font><code class="literal">USE prices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变了</font></font><code class="literal">USE sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的效果仍然不会被复制。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及多个数据库的语句方面，与基于行的复制相比，在基于语句的复制</font><font style="vertical-align: inherit;">中如何</font><font style="vertical-align: inherit;">处理</font><font style="vertical-align: inherit;">另一个重要区别
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设从机启动
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db=db1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且在主机上执行以下语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用db1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE db1.table1 SET col1 = 10，db2.table2 SET col2 = 20;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您正在使用基于语句的复制，则在从站上更新这两个表。</font><font style="vertical-align: inherit;">但是，使用基于行的复制时，仅</font></font><code class="literal">table1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从站上受到影响; </font><font style="vertical-align: inherit;">因为</font></font><code class="literal">table2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在不同的数据库中，</font></font><code class="literal">table2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所以从机不会被改变</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在假设，而不是</font></font><code class="literal">USE db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            声明，使用了一个</font></font><code class="literal">USE db4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用db4;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE db1.table1 SET col1 = 10，db2.table2 SET col2 = 20;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用基于语句的复制时，语句对从站没有影响。</font><font style="vertical-align: inherit;">但是，如果您正在使用基于行的复制，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则会</font></font><code class="literal">table1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属设备上进行</font><font style="vertical-align: inherit;">更改
             </font><font style="vertical-align: inherit;">，但不会
             </font></font><code class="literal">table2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 也就是说，只有名称为by的数据库中的表
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才会更改，并且默认数据库的选择对此行为没有影响。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您需要跨数据库更新才能工作，请</font><font style="vertical-align: inherit;">
            改为</font><font style="vertical-align: inherit;">使用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;">第16.2.5节“服务器如何评估复制过滤规则”</font></a><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table=<em class="replaceable"><code>db_name</code></em>.%</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此选项影响复制的方式与</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响二进制日志记录的</font><font style="vertical-align: inherit;">方式相同，
               </font><font style="vertical-align: inherit;">复制格式对</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              影响复制行为的影响与日志记录格式相同
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此选项没有影响
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">BEGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">ROLLBACK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_replicate-ignore-db"></a>
            <a class="indexterm" name="idm140528032474416"></a>

            <a class="indexterm" name="idm140528032472960"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db=<em class="replaceable"><code>db_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for replicate-ignore-db"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--replicate-ignore-db=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用数据库的名称创建复制筛选器。</font><font style="vertical-align: inherit;">这些过滤器也可以使用创建
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-replication-filter" title="13.4.2.2更改复制过滤器语法"><code class="literal">CHANGE
            REPLICATION FILTER REPLICATE_IGNORE_DB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">与
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此类似，此筛选的确切效果取决于基于语句的还是基于行的复制正在使用中，并在接下来的几段中进行介绍。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句的复制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              告诉slave SQL线程不会复制任何声明，其中默认的数据库（即，由选定的一个
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是
               </font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              告诉从属SQL线程不要更新数据库中的任何表</font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认数据库不起作用。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在使用基于语句的复制时，以下示例不能像您所期望的那样工作。</font><font style="vertical-align: inherit;">假设从机启动
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并且您在主机上发出以下语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用价格;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE sales.january SET amount = amount + 1000;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
             </font><font style="vertical-align: inherit;">在这种情况下</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制，因为
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅适用于默认数据库（由</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">确定
             </font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">由于
             </font></font><code class="literal">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库是在语句中明确指定的，因此该语句未被过滤。</font><font style="vertical-align: inherit;">但是，在使用基于行的复制时，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的影响</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传播到从属设备，并且从属设备的副本
             </font></font><code class="literal">sales.january</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会改变; </font><font style="vertical-align: inherit;">在这种情况下，
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            会导致</font><font style="vertical-align: inherit;">对主副本中的表进行的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改</font></font><code class="literal">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            数据库被奴隶忽略。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要指定多个要忽略的数据库，请多次使用此选项，每个数据库使用一次。</font><font style="vertical-align: inherit;">由于数据库名称可以包含逗号，因此如果提供逗号分隔列表，则该列表将被视为单个数据库的名称。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果使用跨数据库更新并且不希望复制这些更新，则不应使用此选项。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5节“服务器如何评估复制过滤规则”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您需要跨数据库更新才能工作，请</font><font style="vertical-align: inherit;">
            改为</font><font style="vertical-align: inherit;">使用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;">第16.2.5节“服务器如何评估复制过滤规则”</font></a><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table=<em class="replaceable"><code>db_name</code></em>.%</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此选项影响复制的方式与</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响二进制日志记录的</font><font style="vertical-align: inherit;">方式相同，
               </font><font style="vertical-align: inherit;">复制格式对
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              影响复制行为的影响与日志记录格式相同
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此选项没有影响
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">BEGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">ROLLBACK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_replicate-do-table"></a>
            <a class="indexterm" name="idm140528032424080"></a>

            <a class="indexterm" name="idm140528032422624"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table=<em class="replaceable"><code>db_name.tbl_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for replicate-do-table"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--replicate-do-table=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过告诉从属SQL线程将复制限制到给定表来创建复制过滤器。</font><font style="vertical-align: inherit;">要指定多个表，请多次使用此选项，每个表使用一次。</font><font style="vertical-align: inherit;">这适用于跨数据库更新和默认数据库更新，与此相反
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5节“服务器如何评估复制过滤规则”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您也可以通过发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-replication-filter" title="13.4.2.2更改复制过滤器语法"><code class="literal">CHANGE
            REPLICATION FILTER REPLICATE_DO_TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">来创建此类过滤器
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项仅影响适用于表的语句。</font><font style="vertical-align: inherit;">它不会影响仅适用于其他数据库对象（例如存储的例程）的语句。</font><font style="vertical-align: inherit;">要过滤运行在存储例程上的语句，请使用一个或多个
             </font></font><code class="option">--replicate-*-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_replicate-ignore-table"></a>
            <a class="indexterm" name="idm140528032402016"></a>

            <a class="indexterm" name="idm140528032400560"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table=<em class="replaceable"><code>db_name.tbl_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for replicate-ignore-table"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--replicate-ignore-table=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过告诉从属SQL线程不复制更新指定表的任何语句，即使任何其他表可能由同一语句更新，也会创建复制过滤器。</font><font style="vertical-align: inherit;">要指定多个要忽略的表，请多次使用此选项，每个表使用一次。</font><font style="vertical-align: inherit;">这适用于跨数据库更新，与之相反
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5节“服务器如何评估复制过滤规则”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您也可以通过发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-replication-filter" title="13.4.2.2更改复制过滤器语法"><code class="literal">CHANGE
            REPLICATION FILTER REPLICATE_IGNORE_TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            声明</font><font style="vertical-align: inherit;">来创建此类过滤器
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项仅影响适用于表的语句。</font><font style="vertical-align: inherit;">它不会影响仅适用于其他数据库对象（例如存储的例程）的语句。</font><font style="vertical-align: inherit;">要过滤运行在存储例程上的语句，请使用一个或多个
             </font></font><code class="option">--replicate-*-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_replicate-rewrite-db"></a>
            <a class="indexterm" name="idm140528032379840"></a>

            <a class="indexterm" name="idm140528032378384"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-rewrite-db"><code class="option">--replicate-rewrite-db=<em class="replaceable"><code>from_name</code></em>-&gt;<em class="replaceable"><code>to_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for replicate-rewrite-db"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--replicate-rewrite-db=old_name-&gt;new_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            告诉从属创建一个复制过滤器，将默认数据库（即，选中的数据库</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）转换为
            </font></font><em class="replaceable"><code>to_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是否
             </font></font><em class="replaceable"><code>from_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器上。</font><font style="vertical-align: inherit;">只有涉及表语句将受到影响（没有语句，例如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-database" title="13.1.1 ALTER DATABASE语法"><code class="literal">ALTER DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），且仅当
             </font></font><em class="replaceable"><code>from_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是主服务器上的默认数据库。</font><font style="vertical-align: inherit;">要指定多个重写，请多次使用此选项。</font><font style="vertical-align: inherit;">服务器使用第一个</font></font><em class="replaceable"><code>from_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">数据库名称转换在完成
             </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成
            </font></font><code class="option">--replicate-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则进行测试。</font><font style="vertical-align: inherit;">您也可以通过发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-replication-filter" title="13.4.2.2更改复制过滤器语法"><code class="literal">CHANGE
            REPLICATION FILTER REPLICATE_REWRITE_DB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">来创建此类过滤器
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用此选项时，使用数据库名称限定表名称的语句不适用于表级别复制筛选选项，例如
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设我们有一个</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器上</font><font style="vertical-align: inherit;">命名的数据库</font><font style="vertical-align: inherit;">，一个</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从服务器上</font><font style="vertical-align: inherit;">命名</font><font style="vertical-align: inherit;">，每个</font><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">都包含一个表</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且已经启动了主服务器</font></font><code class="option">--replicate-rewrite-db='a-&gt;b'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在稍后的时间点，我们执行
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE FROM
            a.t</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，由于以下原因，没有相关的过滤规则：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                <code class="option">--replicate-do-table=a.t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不起作用，因为从站在</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">有表</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p>
                <code class="option">--replicate-do-table=b.t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 与原始语句不匹配，因此被忽略。
              </font></font></p></li><li class="listitem"><p>
                <code class="option">--replicate-do-table=*.t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理方式与之相同
                 </font></font><code class="option">--replicate-do-table=a.t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此也不起作用。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            同样，该</font></font><code class="option">--replication-rewrite-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项不适用于跨数据库更新。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您在命令行上使用此选项，并且该
             </font></font><code class="literal">&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符对您的命令解释程序特殊，请引用选项值。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqld --replicate-rewrite-db="<em class="replaceable"><code>olddb</code></em>-&gt;<em class="replaceable"><code>newdb</code></em>"</code></strong>
</pre></li><li class="listitem"><p><a name="option_mysqld_replicate-same-server-id"></a>
            <a class="indexterm" name="idm140528032335216"></a>

            <a class="indexterm" name="idm140528032333760"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-same-server-id"><code class="option">--replicate-same-server-id</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for replicate-same-server-id"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--replicate-same-server-id</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于从属服务器。</font><font style="vertical-align: inherit;">通常您应该使用默认设置0来防止由循环复制导致的无限循环。</font><font style="vertical-align: inherit;">如果设置为1，则从站不会跳过具有自己的服务器ID的事件。</font><font style="vertical-align: inherit;">通常，这只在罕见的配置中有用。</font><font style="vertical-align: inherit;">如果</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用，</font><font style="vertical-align: inherit;">则不能设置为1
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，如果从I / O线程具有从服务器ID（此优化有助于节省磁盘使用），则它不会将二进制日志事件写入中继日志。</font><font style="vertical-align: inherit;">如果要使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-same-server-id"><code class="option">--replicate-same-server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请确保在使从属设备读取自己想要从属SQL线程执行的事件之前，使用此选项启动从属设备。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_replicate-wild-do-table"></a>
            <a class="indexterm" name="idm140528032312096"></a>

            <a class="indexterm" name="idm140528032310640"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table=<em class="replaceable"><code>db_name.tbl_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for replicate-wild-do-table"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--replicate-wild-do-table=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过告诉从属线程限制复制到任何更新表匹配指定数据库和表名模式的语句，创建复制过滤器。</font><font style="vertical-align: inherit;">模式可以包含</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通配符，它​​们与</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            模式匹配运算符的</font><font style="vertical-align: inherit;">含义相同</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要指定多个表，请多次使用此选项，每个表使用一次。</font><font style="vertical-align: inherit;">这适用于跨数据库更新。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5节“服务器如何评估复制过滤规则”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您也可以通过发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-replication-filter" title="13.4.2.2更改复制过滤器语法"><code class="literal">CHANGE
            REPLICATION FILTER REPLICATE_WILD_DO_TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            声明</font><font style="vertical-align: inherit;">来创建此类过滤器
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项适用于表格，视图和触发器。</font><font style="vertical-align: inherit;">它不适用于存储过程和函数或事件。</font><font style="vertical-align: inherit;">要筛选对后面的对象进行操作的语句，请使用一个或多个</font></font><code class="option">--replicate-*-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            示例：
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table=foo%.bar%</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            仅复制使用数据库名称以数据库名称开头</font></font><code class="literal">foo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且表格名称以</font><font style="vertical-align: inherit;">该数据库名称开头的表格的更新</font></font><code class="literal">bar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果表名称模式</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它匹配任何表名和选项也适用于数据库级的语句（</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE
            DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP
            DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-database" title="13.1.1 ALTER DATABASE语法"><code class="literal">ALTER
            DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如，如果使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table=foo%.%</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，数据库级别语句将在数据库名称与模式匹配时被复制</font></font><code class="literal">foo%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要在数据库或表名模式中包含文字通配符，请使用反斜杠进行转义。</font><font style="vertical-align: inherit;">例如，要复制已命名的数据库的所有表
             </font></font><code class="literal">my_own%db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但不复制</font></font><code class="literal">my1ownAABCdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中的</font><font style="vertical-align: inherit;">表，则</font><font style="vertical-align: inherit;">应该</font><font style="vertical-align: inherit;">
            像下面这样</font><font style="vertical-align: inherit;">转义</font></font><code class="literal">_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符：
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table=my\_own\%db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您在命令行上使用该选项，则可能需要加倍反斜杠或引用选项值，具体取决于您的命令解释程序。</font><font style="vertical-align: inherit;">例如，用
             </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bash</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shell，你需要输入
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table=my\\_own\\%db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_replicate-wild-ignore-table"></a>
            <a class="indexterm" name="idm140528032272000"></a>

            <a class="indexterm" name="idm140528032270496"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table=<em class="replaceable"><code>db_name.tbl_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for replicate-wild-ignore-table"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--replicate-wild-ignore-table=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            创建一个复制过滤器，它使从属线程不会复制任何表与给定通配符模式匹配的语句。</font><font style="vertical-align: inherit;">要指定多个要忽略的表，请多次使用此选项，每个表使用一次。</font><font style="vertical-align: inherit;">这适用于跨数据库更新。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5节“服务器如何评估复制过滤规则”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您也可以通过发行一个来创建这样的过滤器
            </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-replication-filter" title="13.4.2.2更改复制过滤器语法"><code class="literal">CHANGE
            REPLICATION FILTER REPLICATE_WILD_IGNORE_TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            声明</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            示例：
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table=foo%.bar%</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不复制使用数据库名称以数据库名称开头</font></font><code class="literal">foo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且表名称以</font><font style="vertical-align: inherit;">该数据库名称开头的表的更新</font></font><code class="literal">bar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关如何匹配的信息，请参阅该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">的说明
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在选项值中包含文字通配符的规则同样适用
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_report-host"></a>
            <a class="indexterm" name="idm140528032245968"></a>

            <a class="indexterm" name="idm140528032244480"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-host"><code class="option">--report-host=<em class="replaceable"><code>host_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for report-host"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--report-host=host_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_report_host">report_host</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从站注册期间向主站报告的从站的主机名或IP地址。</font><font style="vertical-align: inherit;">该值显示在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-hosts" title="13.7.5.33 SHOW SLAVE HOSTS语法"><code class="literal">SHOW SLAVE
            HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主服务器</font><font style="vertical-align: inherit;">的输出中</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果不希望从设备向主设备注册，则不要设置该值。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              主站在从站连接后仅从TCP / IP套接字读取从站的IP地址是不够的。</font><font style="vertical-align: inherit;">由于NAT和其他路由问题，该IP可能无法用于从主设备或其他主机连接到从设备。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_report-password"></a>
            <a class="indexterm" name="idm140528032216864"></a>

            <a class="indexterm" name="idm140528032215376"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-password"><code class="option">--report-password=<em class="replaceable"><code>password</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for report-password"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--report-password=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_report_password">report_password</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在从站注册期间要向主站报告从站的帐户密码。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-hosts" title="13.7.5.33 SHOW SLAVE HOSTS语法"><code class="literal">SHOW SLAVE HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果主服务器已启动，</font><font style="vertical-align: inherit;">此值将出现在</font><font style="vertical-align: inherit;">主服务器
             </font><font style="vertical-align: inherit;">的输出中</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_show-slave-auth-info"><code class="option">--show-slave-auth-info</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            虽然此选项的名称可能暗示，但
             </font></font><code class="option">--report-password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它并未连接到MySQL用户权限系统，因此不一定（或甚至可能）与MySQL复制用户帐户的密码相同。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_report-port"></a>
            <a class="indexterm" name="idm140528032186800"></a>

            <a class="indexterm" name="idm140528032185312"></a>

            <a class="indexterm" name="idm140528032183824"></a>

            <a class="indexterm" name="idm140528032182752"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-port"><code class="option">--report-port=<em class="replaceable"><code>slave_port_num</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for report-port"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--report-port=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_report_port">report_port</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">[slave_port]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">65535</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于连接到从站的TCP / IP端口号，在从站注册期间向主站报告。</font><font style="vertical-align: inherit;">只有在从设备正在侦听非默认端口时，或者如果您有从主设备或其他客户端到从设备的特殊通道时才设置此项。</font><font style="vertical-align: inherit;">如果您不确定，请不要使用此选项。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项的默认值是从站实际使用的端口号（错误＃13333431）。</font><font style="vertical-align: inherit;">这也是显示的默认值</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-hosts" title="13.7.5.33 SHOW SLAVE HOSTS语法"><code class="literal">SHOW SLAVE
            HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_report-user"></a>
            <a class="indexterm" name="idm140528032146800"></a>

            <a class="indexterm" name="idm140528032145312"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-user"><code class="option">--report-user=<em class="replaceable"><code>user_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for report-user"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--report-user=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_report_user">report_user</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在从站注册期间要向主站报告的从站的帐户用户名。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-hosts" title="13.7.5.33 SHOW SLAVE HOSTS语法"><code class="literal">SHOW SLAVE HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果主服务器已启动，</font><font style="vertical-align: inherit;">此值将出现在</font><font style="vertical-align: inherit;">主服务器
             </font><font style="vertical-align: inherit;">的输出中</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_show-slave-auth-info"><code class="option">--show-slave-auth-info</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            虽然此选项的名称可能暗示，但
             </font></font><code class="option">--report-user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它不与MySQL用户权限系统连接，因此不一定（或甚至可能与）MySQL复制用户帐户的名称相同。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave-checkpoint-group"></a>
            <a class="indexterm" name="idm140528032116800"></a>

            <a class="indexterm" name="idm140528032115344"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-checkpoint-group"><code class="option">--slave-checkpoint-group=<em class="replaceable"><code>#</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-checkpoint-group"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-checkpoint-group=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">512</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">32</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">524280</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块大小</font></font></strong></span></td>
<td><code class="literal">8</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置在调用检查点操作以更新其状态之前，多线程从服务器可以处理的事务的最大数量，如图所示
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置此选项对未启用多线程的从站不起作用。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              NDB集群目前不支持多线程从站，它默默地忽略了该选项的设置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;">第21.6.3节“NDB群集复制中的已知问题”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项与
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-checkpoint-period"><code class="option">--slave-checkpoint-period</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            选项</font><font style="vertical-align: inherit;">时，超出任一限制时，将执行检查点，并且计数器将跟踪事务数和自上次检查点重置以来流逝的时间。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项的最小允许值为32，除非服务器是使用构建的
             </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_with_debug"><code class="option">-DWITH_DEBUG</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在这种情况下，最小值为1.有效值始终为8的倍数; </font><font style="vertical-align: inherit;">您可以将其设置为不是这样的倍数，但是在存储该值之前，服务器将其舍入到8的下一个较低倍数。</font><font style="vertical-align: inherit;">（</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：调试服务器不执行这样的舍入。）无论服务器是如何构建的，默认值为512，允许的最大值为524280。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave-checkpoint-period"></a>
            <a class="indexterm" name="idm140528032079488"></a>

            <a class="indexterm" name="idm140528032078032"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-checkpoint-period"><code class="option">--slave-checkpoint-period=<em class="replaceable"><code>#</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-checkpoint-period"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-checkpoint-period=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">300</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">4G</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置在调用检查点操作之前允许通过的最大时间（以毫秒为单位），以更新多线程从站的状态，如图所示
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置此选项对未启用多线程的从站不起作用。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              NDB集群目前不支持多线程从站，它默默地忽略了该选项的设置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;">第21.6.3节“NDB群集复制中的已知问题”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项与
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-checkpoint-group"><code class="option">--slave-checkpoint-group</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            选项</font><font style="vertical-align: inherit;">时，超出任一限制时，将执行检查点，并且计数器将跟踪事务数和自上次检查点重置以来流逝的时间。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项的最小允许值为1，除非服务器是使用构建的
             </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_with_debug"><code class="option">-DWITH_DEBUG</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在这种情况下，最小值为0.无论服务器如何构建，默认值为300，最大可能值为4294967296（4GB） 。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave-parallel-workers"></a>
            <a class="indexterm" name="idm140528032046128"></a>

            <a class="indexterm" name="idm140528032044672"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-parallel-workers"><code class="option">--slave-parallel-workers</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-parallel-workers"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-parallel-workers=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">1024</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置并行执行复制事务的从属应用程序线程数。</font><font style="vertical-align: inherit;">将此变量设置为大于0的数字会创建一个具有此数量的施加器线程的多线程从器件。</font><font style="vertical-align: inherit;">当设置为0（默认）时，并行执行被禁用，从机使用一个应用程序线程。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            多线程从站通过使用协调器线程和由此选项配置的应用程序线程的数量来提供并行执行。</font><font style="vertical-align: inherit;">事务在应用程序线程中分配的方式由配置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-parallel-type"><code class="option">--slave-parallel-type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关多线程从服务器的更多信息，请参阅
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave-parallel-workers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              NDB集群目前不支持多线程从站，它默默地忽略了该选项的设置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;">第21.6.3节“NDB群集复制中的已知问题”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_slave-pending-jobs-size-max"></a>
            <a class="indexterm" name="idm140528032014464"></a>

            <a class="indexterm" name="idm140528032013008"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-pending-jobs-size-max"><code class="option">--slave-pending-jobs-size-max=<em class="replaceable"><code>#</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-pending-jobs-size-max"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-pending-jobs-size-max=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">16M</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1024</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">18EB</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块大小</font></font></strong></span></td>
<td><code class="literal">1024</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于多线程从站，此选项设置可用于保持尚未应用事件的从属工作队列的最大内存量（以字节为单位）。</font><font style="vertical-align: inherit;">设置此选项对未启用多线程的从站不起作用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项的最小可能值为1024; </font><font style="vertical-align: inherit;">默认值是16MB。</font><font style="vertical-align: inherit;">最大可能值是18446744073709551615（16字节）。</font><font style="vertical-align: inherit;">在存储之前，不是1024的精确倍数的值被舍入到1024的次最高倍数。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该选项的值不得小于主人的值
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">否则从属工作者队列可能变满，而来自主处理器的事件仍有待处理。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_skip-slave-start"></a>
            <a class="indexterm" name="idm140528031981312"></a>

            <a class="indexterm" name="idm140528031979824"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for skip-slave-start"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--skip-slave-start</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当服务器启动时，告诉从服务器不要启动从服务器线程。</font><font style="vertical-align: inherit;">要稍后启动线程，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave_compressed_protocol"></a>
            <a class="indexterm" name="idm140528031959536"></a>

            <a class="indexterm" name="idm140528031958080"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_compressed_protocol"><code class="option">--slave_compressed_protocol={0|1}</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_compressed_protocol"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-compressed-protocol</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_compressed_protocol">slave_compressed_protocol</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果此选项设置为1，则在从站和主站都支持从站/主站协议时使用压缩。</font><font style="vertical-align: inherit;">默认值是0（不压缩）。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave-load-tmpdir"></a>
            <a class="indexterm" name="idm140528031929936"></a>

            <a class="indexterm" name="idm140528031928480"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-load-tmpdir"><code class="option">--slave-load-tmpdir=<em class="replaceable"><code>dir_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-load-tmpdir"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-load-tmpdir=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_load_tmpdir">slave_load_tmpdir</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录名称</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">/tmp</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从机创建临时文件的目录名称。</font><font style="vertical-align: inherit;">该选项默认等于</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当从属SQL线程复制
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句时，它将从中继日志中加载的文件提取到临时文件中，然后将这些文件加载​​到表中。</font><font style="vertical-align: inherit;">如果加载在主文件上的文件很大，则从文件上的临时文件也很大。</font><font style="vertical-align: inherit;">因此，最好使用此选项告诉从服务器将临时文件放在某个文件系统中的目录中，该文件系统有很多可用空间。</font><font style="vertical-align: inherit;">在这种情况下，中继日志也很大，所以你可能也想使用它</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项可将中继日志放入该文件系统。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项指定的目录应位于基于磁盘的文件系统（而不是基于内存的文件系统）中，因为用于复制的临时文件
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在机器重新启动后存在。</font><font style="vertical-align: inherit;">该目录也不应该是在系统启动过程中被操作系统清除的目录。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave-max-allowed-packet"></a>
            <a class="indexterm" name="idm140528031893424"></a>

            <a class="indexterm" name="idm140528031892384"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-max-allowed-packet"><code class="option">slave-max-allowed-packet=<em class="replaceable"><code>bytes</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-max-allowed-packet"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-max-allowed-packet=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1024</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项为从属SQL和I / O线程设置最大数据包大小（以字节为单位），以便使用基于行的复制的较大更新不会导致复制因超过更新而失败
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（错误＃12400221，错误＃60926）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            相应的服务器变量
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_max_allowed_packet"><code class="literal">slave_max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的值始终为1024的正整数倍; </font><font style="vertical-align: inherit;">如果将其设置为某个不是这种倍数的值，则该值会自动舍入为1024的下一个最高倍数。（例如，如果您使用服务器启动
             </font></font><code class="option">--slave-max-allowed-packet=10000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则使用的值为9216;将值设置为0导致1024被使用。）在这种情况下发出截断警告。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            最大（和默认）值是1073741824（1 GB）; </font><font style="vertical-align: inherit;">最小值是1024。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave-net-timeout"></a>
            <a class="indexterm" name="idm140528031862240"></a>

            <a class="indexterm" name="idm140528031860784"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-net-timeout"><code class="option">--slave-net-timeout=<em class="replaceable"><code>seconds</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-net-timeout"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-net-timeout=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_net_timeout">slave_net_timeout</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><code class="literal">60</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.6）</font></font></td>
<td><code class="literal">3600</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在从设备认为连接断开之前等待来自主设备的更多数据的秒数，放弃读取并尝试重新连接。</font><font style="vertical-align: inherit;">第一次重试在超时后立即发生。</font><font style="vertical-align: inherit;">重试之间的时间间隔由</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font></font><code class="literal">MASTER_CONNECT_RETRY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">控制</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
            TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重新连接尝试次数受该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-retry-count"><code class="option">--master-retry-count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">限制
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7.7之前，默认值是3600秒（一小时）。</font><font style="vertical-align: inherit;">在MySQL 5.7.7及更高版本中，缺省值是60秒（一分钟）。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave-parallel-type"></a>
            <a class="indexterm" name="idm140528031822656"></a>

            <a class="indexterm" name="idm140528031821616"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-parallel-type"><code class="option">--slave-parallel-type=<em class="replaceable"><code>type</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-parallel-type"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-parallel-type=type</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.2</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">DATABASE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">DATABASE</code></p><p class="valid-value"><code class="literal">LOGICAL_CLOCK</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用多线程从站（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于0）时，此选项指定用于决定允许哪些事务在从站上并行执行的策略。</font><font style="vertical-align: inherit;">可能的值是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">DATABASE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：并行应用更新不同数据库的事务。</font><font style="vertical-align: inherit;">此值仅适用于将数据分区为多个数据库的情况，这些数据库在主服务器上独立并同时进行更新。</font><font style="vertical-align: inherit;">只有在没有跨数据库约束的情况下才推荐使用，因为这样的约束可能会违反从站。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">LOGICAL_CLOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：作为主站上相同二进制日志组提交的一部分的事务在从站上并行应用。</font><font style="vertical-align: inherit;">没有跨数据库约束，数据不需要分区到多个数据库。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            无论此变量的值如何，主站上都不需要特殊配置。</font><font style="vertical-align: inherit;">何时
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave_preserve_commit_order=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您只能使用</font></font><code class="literal">LOGICAL_CLOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您的复制拓扑使用多级从站，
             </font></font><code class="literal">LOGICAL_CLOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则每个级别可能会实现较少的并行化，从站远离主站。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_slave-rows-search-algorithms"></a>
            <a class="indexterm" name="idm140528031786240"></a>

            <a class="indexterm" name="idm140528031785152"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-rows-search-algorithms"><code class="option">slave-rows-search-algorithms=<em class="replaceable"><code>list</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-rows-search-algorithms"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-rows-search-algorithms=list</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">TABLE_SCAN,INDEX_SCAN</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">TABLE_SCAN,INDEX_SCAN</code></p><p class="valid-value"><code class="literal">INDEX_SCAN,HASH_SCAN</code></p><p class="valid-value"><code class="literal">TABLE_SCAN,HASH_SCAN</code></p><p class="valid-value"><code class="literal">TABLE_SCAN,INDEX_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （相当于INDEX_SCAN，HASH_SCAN）</font></font></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在准备基于行的日志记录和复制的批次行时，此选项控制如何在行中搜索匹配项 - 也就是说，是否将哈希用于使用主键或唯一键，某个其他键或无键的搜索所有。</font><font style="vertical-align: inherit;">该选项设置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_rows_search_algorithms"><code class="literal">slave_rows_search_algorithms</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量</font><font style="vertical-align: inherit;">的初始值
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从列表中指定一个逗号分隔的任何2（或所有3个）的值的列表</font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">TABLE_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">无需引用列表，但不得包含空格，无论是否使用引号。</font><font style="vertical-align: inherit;">下表显示了可能的组合（列表）及其效果：
</font></font></p>
<div class="informaltable">
<table summary="How rows are searched for matches, based on the value specified for the --slave-rows-search-algorithms option."><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的索引/选项值</font></font></th>
                <th scope="col"><code class="literal">INDEX_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么
                  </font></font><code class="literal">INDEX_SCAN,TABLE_SCAN,HASH_SCAN</code></th>
                <th scope="col"><code class="literal">INDEX_SCAN,TABLE_SCAN</code></th>
                <th scope="col"><code class="literal">TABLE_SCAN,HASH_SCAN</code></th>
              </tr></thead><tbody><tr>
                <td scope="row"><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主键或唯一键</font></font></em></span></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描索引</font></font></td>
              </tr><tr>
                <td scope="row"><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（其他）键</font></font></em></span></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描索引</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描索引</font></font></td>
              </tr><tr>
                <td scope="row"><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有索引</font></font></em></span></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在列表中指定算法的顺序不会影响它们通过a </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-variables" title="13.7.5.39 SHOW VARIABLES语法"><code class="literal">SHOW VARIABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">显示的顺序</font><font style="vertical-align: inherit;">（与前面显示的表中使用</font><font style="vertical-align: inherit;">的顺序</font><font style="vertical-align: inherit;">相同）。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                默认值是
                 </font></font><code class="literal">TABLE_SCAN,INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着所有可以使用索引的搜索都会使用它们，而没有任何索引的搜索将使用表扫描。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要对任何不使用主键或唯一键的搜索使用散列，请将此选项设置为
                 </font></font><code class="literal">INDEX_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">指定</font></font><code class="literal">INDEX_SCAN,TABLE_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font><font style="vertical-align: inherit;">指定
                 </font><font style="vertical-align: inherit;">具有相同的效果
                 </font></font><code class="literal">INDEX_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要为</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font><font style="vertical-align: inherit;">强制散列</font><font style="vertical-align: inherit;">，请将此选项设置为
                 </font></font><code class="literal">TABLE_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以为此选项指定单个值，但这不是最佳选项，因为设置单个值会将搜索限制为仅使用该算法。</font><font style="vertical-align: inherit;">特别是，</font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不建议单独</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">，因为在这种情况下，如果没有索引存在，搜索根本无法找到行。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              只有性能优势
               </font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
               </font></font><code class="literal">HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果该行事件是足够大的。</font><font style="vertical-align: inherit;">行事件的大小是使用配置的
               </font></font><code class="literal">--binlog-row-event-max-size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，假设</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              删除25,000行</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句会生成大型
               </font></font><code class="literal">Delete_row_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件。</font><font style="vertical-align: inherit;">在这种情况下，如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_rows_search_algorithms"><code class="literal">slave_rows_search_algorithms</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              设置为</font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有性能改进。</font><font style="vertical-align: inherit;">但是，如果有25,000个
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，并且每个语句都由单独的事件表示，则设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_rows_search_algorithms"><code class="literal">slave_rows_search_algorithms</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为</font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
              </font></font><code class="literal">HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在执行这些单独的事件时没有提供性能改进。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_slave-skip-errors"></a>
            <a class="indexterm" name="idm140528031706176"></a>

            <a class="indexterm" name="idm140528031704720"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-skip-errors"><code class="option">--slave-skip-errors=[<em class="replaceable"><code>err_code1</code></em>,<em class="replaceable"><code>err_code2</code></em>,...|all|ddl_exist_errors]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-skip-errors"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-skip-errors=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_skip_errors">slave_skip_errors</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">[list of error codes]</code></p><p class="valid-value"><code class="literal">all</code></p><p class="valid-value"><code class="literal">ddl_exist_errors</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            正常情况下，当从站发生错误时复制停止，这使您有机会手动解决数据中的不一致问题。</font><font style="vertical-align: inherit;">当语句返回选项值中列出的任何错误时，此选项将导致从属SQL线程继续复制。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            除非你完全理解你为什么得到错误，否则不要使用这个选项。</font><font style="vertical-align: inherit;">如果您的复制设置和客户端程序中没有错误，并且MySQL本身没有错误，则永远不会发生停止复制的错误。</font><font style="vertical-align: inherit;">不分青红皂白地使用这个选项会导致奴隶变得无法与主人同步，你不知道为什么会发生这种情况。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于错误代码，您应该在从站错误日志和输出中使用错误消息提供的数字
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html" title="附录B错误，错误代码和常见问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附录B，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误，错误代码和常见问题</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出服务器错误代码。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            速记值</font></font><code class="literal">ddl_exist_errors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等同于错误代码列表
             </font></font><code class="literal">1007,1008,1050,1051,1054,1060,1061,1068,1094,1146</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您也可以（但不应该）使用非推荐值</font></font><code class="literal">all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来使从服务器忽略所有错误消息并继续进行，而不管发生什么情况。</font><font style="vertical-align: inherit;">毋庸置疑，如果您使用</font></font><code class="literal">all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则不保证数据的完整性。</font><font style="vertical-align: inherit;">如果从机的数据与主机上的数据没有任何接近，请不要抱怨（或者提交错误报告）。</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你已被警告</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例子：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--slave-跳过错误= 1062,1053</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--slave-跳过错误= ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--slave-跳过错误= ddl_exist_errors</font></font><font></font>
</pre></li><li class="listitem"><p><a name="option_mysqld_slave-sql-verify-checksum"></a>
            <a class="indexterm" name="idm140528031659728"></a>

            <a class="indexterm" name="idm140528031658272"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-sql-verify-checksum"><code class="option">--slave-sql-verify-checksum={0|1}</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-sql-verify-checksum"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-sql-verify-checksum=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用此选项时，从站检查从继电器日志中读取的校验和，如果不匹配，从站会因错误而停止。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下选项由MySQL测试套件在内部用于复制测试和调试。</font><font style="vertical-align: inherit;">它们不适用于生产环境。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_abort-slave-event-count"></a>
            <a class="indexterm" name="idm140528031633840"></a>

            <a class="indexterm" name="idm140528031632384"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_abort-slave-event-count"><code class="option">--abort-slave-event-count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for abort-slave-event-count"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--abort-slave-event-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果将此选项设置为某个</font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非0的</font><font style="vertical-align: inherit;">正整数
             </font><font style="vertical-align: inherit;">（缺省值），则会影响复制行为，如下所示：从属SQL线程启动后，</font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许执行日志事件; </font><font style="vertical-align: inherit;">在此之后，从属SQL线程不会再收到任何事件，就像来自主节点的网络连接被切断一样。</font><font style="vertical-align: inherit;">从属线程继续运行，并</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示
             </font></font><code class="literal">Yes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
             </font><font style="vertical-align: inherit;">列</font></font><code class="literal">Slave_IO_Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">Slave_SQL_Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">的输出
             </font><font style="vertical-align: inherit;">，但不会从中继日志中读取其他事件。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_disconnect-slave-event-count"></a>
            <a class="indexterm" name="idm140528031605600"></a>

            <a class="indexterm" name="idm140528031604096"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_disconnect-slave-event-count"><code class="option">--disconnect-slave-event-count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for disconnect-slave-event-count"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--disconnect-slave-event-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
</li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="replication-options-slave-log-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将从站状态记录到表格的选项</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL 5.7支持将复制从属状态信息记录到表格而不是文件。</font><font style="vertical-align: inherit;">可以使用此处列出的两个服务器选项单独配置主信息日志和中继日志信息日志的写入：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_master-info-repository"></a>
            <a class="indexterm" name="idm140528031583360"></a>

            <a class="indexterm" name="idm140528031581904"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-repository"><code class="option">--master-info-repository={FILE|TABLE}</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for master-info-repository"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--master-info-repository=FILE|TABLE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FILE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">FILE</code></p><p class="valid-value"><code class="literal">TABLE</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项会导致服务器将其主信息日志写入文件或表中。</font><font style="vertical-align: inherit;">文件的名称默认为
             </font></font><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-file"><code class="option">--master-info-file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器选项</font><font style="vertical-align: inherit;">更改文件的名称
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项的默认值是
             </font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果使用
             </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，日志将写入</font><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">的
             </font></font><code class="literal">slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中
             </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_relay-log-info-repository"></a>
            <a class="indexterm" name="idm140528031553216"></a>

            <a class="indexterm" name="idm140528031551760"></a>

            <a class="indexterm" name="idm140528031550256"></a>

            <a class="indexterm" name="idm140528031549184"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-info-repository"><code class="option">--relay-log-info-repository={FILE|TABLE}</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay-log-info-repository"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-info-repository=FILE|TABLE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FILE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">FILE</code></p><p class="valid-value"><code class="literal">TABLE</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项使服务器将其中继日志信息记录到文件或表格中。</font><font style="vertical-align: inherit;">文件的名称默认为
             </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-info-file"><code class="option">--relay-log-info-file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器选项</font><font style="vertical-align: inherit;">更改文件的名称
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项的默认值是
             </font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果使用
             </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，日志将写入</font><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">的
             </font></font><code class="literal">slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中
             </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可以使用这些选项使复制从服务器响应意外的暂停。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt" title="16.3.2处理意外的复制从站暂停"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt" title="16.3.2处理意外的复制从站暂停"><font style="vertical-align: inherit;">第16.3.2节“处理意外的复制从站暂停”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        信息日志表及其内容对于给定的MySQL服务器来说是本地的。</font><font style="vertical-align: inherit;">它们不会被复制，并且它们的更改不会写入二进制日志。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="replication-sysvars-slaves"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量用于复制从站</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表描述了用于控制复制从服务器的系统变量。</font><font style="vertical-align: inherit;">它们可以在服务器启动时设置，其中一些可以在运行时使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">本节前面列出了用于复制从服务器的服务器选项。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_init_slave"></a>
            <a class="indexterm" name="idm140528031513984"></a>

            <a class="indexterm" name="idm140528031512928"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_init_slave"><code class="literal">init_slave</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for init_slave"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--init-slave=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_init_slave">init_slave</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该变量与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_init_connect"><code class="literal">init_connect</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server线程每次启动时由从服务器执行的字符串</font><font style="vertical-align: inherit;">类似
             </font><font style="vertical-align: inherit;">，但是该字符串是一个字符串。</font><font style="vertical-align: inherit;">字符串的格式与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_init_connect"><code class="literal">init_connect</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此变量的设置对后续的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">生效
             </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              SQL线程在执行之前向客户端发送确认
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_init_slave"><code class="literal">init_slave</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，不保证
               </font><font style="vertical-align: inherit;">
              退货</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_init_slave"><code class="literal">init_slave</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时已执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><font style="vertical-align: inherit;">第13.4.2.6节“START SLAVE语法”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_log_slow_slave_statements"></a>
            <a class="indexterm" name="idm140528031478528"></a>

            <a class="indexterm" name="idm140528031477040"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slow_slave_statements"><code class="literal">log_slow_slave_statements</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log_slow_slave_statements"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.1</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slow_slave_statements">log_slow_slave_statements</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当启用慢速查询日志时，此变量将启用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_long_query_time"><code class="literal">long_query_time</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对在从站上执行时间</font><font style="vertical-align: inherit;">超过</font><font style="vertical-align: inherit;">几秒的</font><font style="vertical-align: inherit;">查询的日志记录
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这个变量是在MySQL 5.7.1中添加的。</font><font style="vertical-align: inherit;">设置这个变量不会立即生效。</font><font style="vertical-align: inherit;">变量的状态适用于所有后续的
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            请注意，即使</font></font><code class="literal">log_slow_slave_statements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已启用</font><font style="vertical-align: inherit;">，主服务器中以行格式记录的所有语句也不会记录在从服务器的慢日志中
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_master_info_repository"></a>
            <a class="indexterm" name="idm140528031445248"></a>

            <a class="indexterm" name="idm140528031444208"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_info_repository"><code class="literal">master_info_repository</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for master_info_repository"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--master-info-repository=FILE|TABLE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_info_repository">master_info_repository</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FILE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">FILE</code></p><p class="valid-value"><code class="literal">TABLE</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此变量的设置决定从站是否将主站状态和连接信息记录到
             </font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （</font></font><code class="literal">mysql.slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">当没有执行复制线程时，只能更改此变量的值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量的设置也对设置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_master_info"><code class="literal">sync_master_info</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量所</font><font style="vertical-align: inherit;">产生的影响有直接影响
             </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">请参阅变量的描述以获取更多信息。
          </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在配置多个复制通道之前，</font><font style="vertical-align: inherit;">
            必须将此变量设置为</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您使用多个复制通道，则不能将此变量设置回</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_relay_log"></a>
            <a class="indexterm" name="idm140528031404688"></a>

            <a class="indexterm" name="idm140528031403632"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log"><code class="literal">relay_log</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay-log"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log">relay_log</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            中继日志文件的基本名称，没有路径和文件扩展名。</font><font style="vertical-align: inherit;">对于默认复制通道，中继日志的默认基本名称为
             </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于非默认复制通道，中继日志的默认基本名称是
             </font><font style="vertical-align: inherit;">，其中</font><font style="vertical-align: inherit;">是此中继日志中记录的复制通道的名称。
          </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin-<em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>channel</code></em><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><a name="sysvar_relay_log_basename"></a>
            <a class="indexterm" name="idm140528031375568"></a>

            <a class="indexterm" name="idm140528031374528"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_basename"><code class="literal">relay_log_basename</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay_log_basename"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_basename">relay_log_basename</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">datadir + '/' + hostname + '-relay-bin'</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            保存中继日志文件的名称和完整路径。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_relay_log_index"></a>
            <a class="indexterm" name="idm140528031349472"></a>

            <a class="indexterm" name="idm140528031348416"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_index"><code class="literal">relay_log_index</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay_log_index"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-index</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_index">relay_log_index</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">*host_name*-relay-bin.index</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认复制通道的中继日志索引文件的名称。</font><font style="vertical-align: inherit;">默认名称是
             </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin.index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_relay_log_info_file"></a>
            <a class="indexterm" name="idm140528031319168"></a>

            <a class="indexterm" name="idm140528031318128"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_file"><code class="literal">relay_log_info_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay_log_info_file"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-info-file=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_file">relay_log_info_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">relay-log.info</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从站记录有关中继日志的信息的文件的名称
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository=FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository=TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是在存储库更改为的情况下将使用的文件名</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">默认名称</font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于数据目录中。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_relay_log_info_repository"></a>
            <a class="indexterm" name="idm140528031285744"></a>

            <a class="indexterm" name="idm140528031284640"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay_log_info_repository"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository">relay_log_info_repository</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FILE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">FILE</code></p><p class="valid-value"><code class="literal">TABLE</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该变量确定从站在继电器日志中的位置是写入</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （</font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）还是
             </font><font style="vertical-align: inherit;">写入</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （</font></font><code class="literal">mysql.slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">当没有执行复制线程时，只能更改此变量的值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量的设置也对设置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log_info"><code class="literal">sync_relay_log_info</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量所</font><font style="vertical-align: inherit;">产生的影响有直接影响
             </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">请参阅变量的描述以获取更多信息。
          </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在配置多个复制通道之前，</font><font style="vertical-align: inherit;">
            必须将此变量设置为</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您使用多个复制通道，则不能将此变量设置回</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_relay_log_recovery"></a>
            <a class="indexterm" name="idm140528031248112"></a>

            <a class="indexterm" name="idm140528031246624"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for relay_log_recovery"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--relay-log-recovery</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery">relay_log_recovery</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器启动后立即启用自动中继日志恢复。</font><font style="vertical-align: inherit;">恢复过程将创建一个新的中继日志文件，将SQL线程位置初始化为此新的中继日志，并将I / O线程初始化为SQL线程位置。</font><font style="vertical-align: inherit;">继续从主站读取中继日志。</font><font style="vertical-align: inherit;">这个全局变量是只读的; </font><font style="vertical-align: inherit;">它的值可以通过使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动从站来改变，该
             </font><font style="vertical-align: inherit;">选项应该在复制从站意外停止之后使用，以确保不会处理可能损坏的中继日志。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">
            更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt" title="16.3.2处理意外的复制从站暂停"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt" title="16.3.2处理意外的复制从站暂停"><font style="vertical-align: inherit;">第16.3.2节“处理意外的复制从站暂停”</font></a><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量也可以与之交互
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_purge"><code class="option">relay-log-purge</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它控制不再需要的日志清除。</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_purge"><code class="option">relay-log-purge</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">启用此
             </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">可能会导致从未清除的文件中读取中继日志，从而导致数据不一致。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><code class="literal">relay_log_recovery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在多线程模式下运行时由于遇到错误而启用并且从站已停止时，可以使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE
            UNTIL SQL_AFTER_MTS_GAPS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它确保在切换回单线程模式或执行</font></font><code class="literal">CHANGE MASTER TO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句</font><font style="vertical-align: inherit;">之前处理所有间隙</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_rpl_stop_slave_timeout"></a>
            <a class="indexterm" name="idm140528031209488"></a>

            <a class="indexterm" name="idm140528031208000"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_rpl_stop_slave_timeout"><code class="literal">rpl_stop_slave_timeout</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for rpl_stop_slave_timeout"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--rpl-stop-slave-timeout=seconds</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.2</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_rpl_stop_slave_timeout">rpl_stop_slave_timeout</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">31536000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">31536000</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过设置此变量</font><font style="vertical-align: inherit;">来控制在</font><font style="vertical-align: inherit;">超时之前等待</font><font style="vertical-align: inherit;">的时间长度（以秒为单位）
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可以用来避免使用</font></font><code class="literal">STOP SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与从属设备不同的客户端连接的其他从属SQL语句</font><font style="vertical-align: inherit;">之间的死锁</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            最大值和默认值
             </font></font><code class="literal">rpl_stop_slave_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是31536000秒（1年）。</font><font style="vertical-align: inherit;">最小值是2秒。</font><font style="vertical-align: inherit;">对此变量的更改会对后续的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">生效
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该变量仅影响发布</font></font><code class="literal">STOP SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的客户端
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当达到超时时，发出客户端返回一条错误消息，指出命令执行不完整。</font><font style="vertical-align: inherit;">客户端然后停止等待从属线程停止，但从属线程继续尝试停止，并且</font></font><code class="literal">STOP
            SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令保持有效。</font><font style="vertical-align: inherit;">一旦从属线程不再忙，</font></font><code class="literal">STOP
            SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句就会执行并且从属程序停止。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_checkpoint_group"></a>
            <a class="indexterm" name="idm140528031163696"></a>

            <a class="indexterm" name="idm140528031162208"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_checkpoint_group"><code class="literal">slave_checkpoint_group</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_checkpoint_group"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-checkpoint-group=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal">slave_checkpoint_group=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">512</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">32</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">524280</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块大小</font></font></strong></span></td>
<td><code class="literal">8</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置在调用检查点操作以更新其状态之前，多线程从服务器可以处理的事务的最大数量，如图所示
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置此变量对未启用多线程的从站不起作用。</font><font style="vertical-align: inherit;">设置这个变量不会立即生效。</font><font style="vertical-align: inherit;">变量的状态适用于所有后续</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            命令。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              NDB集群目前不支持多线程从站，它默默地忽略了这个变量的设置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;">第21.6.3节“NDB群集复制中的已知问题”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量与
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_checkpoint_period"><code class="literal">slave_checkpoint_period</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量一起工作时，当超出任何限制时，执行检查点，并且计数器跟踪事务数量和自上次检查点重置以来流逝的时间。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量的最小允许值是32，除非服务器是使用的
             </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_with_debug"><code class="option">-DWITH_DEBUG</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在这种情况下，最小值是1.有效值总是8的倍数; </font><font style="vertical-align: inherit;">您可以将其设置为不是这样的倍数，但是在存储该值之前，服务器将其舍入到8的下一个较低倍数。</font><font style="vertical-align: inherit;">（</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：调试服务器不执行这样的舍入。）无论服务器是如何构建的，默认值为512，允许的最大值为524280。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_checkpoint_period"></a>
            <a class="indexterm" name="idm140528031116912"></a>

            <a class="indexterm" name="idm140528031115424"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_checkpoint_period"><code class="literal">slave_checkpoint_period</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_checkpoint_period"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-checkpoint-period=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal">slave_checkpoint_period=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">300</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">4G</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置在调用检查点操作之前允许通过的最大时间（以毫秒为单位），以更新多线程从站的状态，如图所示
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置此变量对未启用多线程的从站不起作用。</font><font style="vertical-align: inherit;">设置此变量将立即对所有复制通道生效，包括正在运行的通道。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              NDB集群目前不支持多线程从站，它默默地忽略了这个变量的设置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;">第21.6.3节“NDB群集复制中的已知问题”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量与
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_checkpoint_group"><code class="literal">slave_checkpoint_group</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量一起工作时，当超出任何限制时，执行检查点，并且计数器跟踪事务数量和自上次检查点重置以来流逝的时间。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此变量的最小允许值为1，除非服务器是使用构建的
             </font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_with_debug"><code class="option">-DWITH_DEBUG</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在这种情况下，最小值为0.不管服务器的构建方式如何，默认值为300，最大可能值为4294967296（4GB） 。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_compressed_protocol"></a>
            <a class="indexterm" name="idm140528031075152"></a>

            <a class="indexterm" name="idm140528031074048"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_compressed_protocol"><code class="literal">slave_compressed_protocol</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_compressed_protocol"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-compressed-protocol</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_compressed_protocol">slave_compressed_protocol</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果从站和主站都支持，则是否使用从站/主站协议的压缩。</font><font style="vertical-align: inherit;">对此变量的更改会在后续的连接尝试中生效; </font><font style="vertical-align: inherit;">这包括在发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE
            </code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句之后，以及由正在运行的I / O线程进行的重新连接（例如，在发布
             </font></font><code class="literal">CHANGE MASTER TO MASTER_RETRY_COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句之后）。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_exec_mode"></a>
            <a class="indexterm" name="idm140528031043648"></a>

            <a class="indexterm" name="idm140528031042592"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_exec_mode"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-exec-mode=mode</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode">slave_exec_mode</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （NDB）</font></font></p><p class="valid-value"><code class="literal">STRICT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （其他）</font></font></p></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">IDEMPOTENT</code></p><p class="valid-value"><code class="literal">STRICT</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制从属线程在复制过程中如何解决冲突和错误。</font></font><code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式会导致重复密钥和无密钥找到错误的抑制;
            </font></font><code class="literal">STRICT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意味着没有这样的抑制发生。
          </font></font></p><p>
            <code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式旨在用于多主复制，循环复制以及用于NDB群集复制的其他特殊复制方案。</font><font style="vertical-align: inherit;">（有关详细</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-multi-master" title="21.6.10 NDB群集复制：多主复制和循环复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-multi-master" title="21.6.10 NDB群集复制：多主复制和循环复制"><font style="vertical-align: inherit;">第21.6.10节“NDB群集复制：多主复制和循环复制”</font></a><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-conflict-resolution" title="21.6.11 NDB群集复制冲突解决"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21.6.11节“NDB群集复制冲突解决”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）NDB群集忽略任何显式设置的值
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并始终视之为</font></font><code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL Server 5.7中，</font></font><code class="literal">STRICT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            mode是默认值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于除以外的存储引擎
             </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><span class="emphasis"><em><code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有在确定可以安全忽略重复键错误和键未发现错误时，才应使用模式</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它旨在用于使用多主复制或循环复制的NDB群集的故障切换方案，并且不建议在其他情况下使用。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_load_tmpdir"></a>
            <a class="indexterm" name="idm140528030997328"></a>

            <a class="indexterm" name="idm140528030996288"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_load_tmpdir"><code class="literal">slave_load_tmpdir</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-load-tmpdir"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-load-tmpdir=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_load_tmpdir">slave_load_tmpdir</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录名称</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">/tmp</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从站为复制</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">创建临时文件的目录名称
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置此变量将立即对所有复制通道生效，包括正在运行的通道。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_max_allowed_packet"></a>
            <a class="indexterm" name="idm140528030966656"></a>

            <a class="indexterm" name="idm140528030965552"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_max_allowed_packet"><code class="literal">slave_max_allowed_packet</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_max_allowed_packet"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_max_allowed_packet">slave_max_allowed_packet</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1024</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此变量设置从属SQL和I / O线程的最大数据包大小，以便使用基于行的复制的大型更新不会导致复制失败，因为超出了更新
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置此变量将立即对所有复制通道生效，包括正在运行的通道。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个全局变量的值总是1024的正整数倍; </font><font style="vertical-align: inherit;">如果将其设置为某个不是的值，则该值会被舍入到1024的下一个最高倍数，因为它被存储或使用; </font><font style="vertical-align: inherit;">设置
             </font></font><code class="literal">slave_max_allowed_packet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0会导致使用1024。</font><font style="vertical-align: inherit;">（在所有这些情况下都会发出截断警告。）默认值和最大值是1073741824（1 GB）; </font><font style="vertical-align: inherit;">最小值是1024。
          </font></font></p><p>
            <code class="literal">slave_max_allowed_packet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以在启动时使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-max-allowed-packet"><code class="option">--slave-max-allowed-packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">进行设置
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_net_timeout"></a>
            <a class="indexterm" name="idm140528030928912"></a>

            <a class="indexterm" name="idm140528030927872"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_net_timeout"><code class="literal">slave_net_timeout</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-net-timeout"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-net-timeout=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_net_timeout">slave_net_timeout</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><code class="literal">60</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.6）</font></font></td>
<td><code class="literal">3600</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在中止读取之前等待来自主/从连接的更多数据的秒数。</font><font style="vertical-align: inherit;">设置这个变量不会立即生效。</font><font style="vertical-align: inherit;">变量的状态适用于所有后续
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_parallel_type"></a>
            <a class="indexterm" name="idm140528030891824"></a>

            <a class="indexterm" name="idm140528030890784"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_type"><code class="literal">slave_parallel_type=<em class="replaceable"><code>type</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-parallel-type"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-parallel-type=type</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.2</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">DATABASE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">DATABASE</code></p><p class="valid-value"><code class="literal">LOGICAL_CLOCK</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用多线程从机（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于0）时，该变量指定用于决定允许哪些事务在从机上并行执行的策略。</font><font style="vertical-align: inherit;">查看
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-parallel-type"><code class="option">--slave-parallel-type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多信息。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_parallel_workers"></a>
            <a class="indexterm" name="idm140528030861696"></a>

            <a class="indexterm" name="idm140528030860656"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_parallel_workers"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-parallel-workers=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers">slave_parallel_workers</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">1024</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置并行执行复制事务的从属应用程序线程数。</font><font style="vertical-align: inherit;">将此变量设置为大于0的数字会创建一个具有此数量的施加器线程的多线程从器件。</font><font style="vertical-align: inherit;">当设置为0（默认）时，并行执行被禁用，从机使用一个应用程序线程。</font><font style="vertical-align: inherit;">设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会立即生效。</font><font style="vertical-align: inherit;">变量的状态适用于所有后续的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              NDB集群目前不支持多线程从站，它默默地忽略了这个变量的设置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;">第21.6.3节“NDB群集复制中的已知问题”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            多线程从站通过使用协调器线程和由此变量配置的应用程序线程的数量来提供并行执行。</font><font style="vertical-align: inherit;">事务在应用程序线程中分配的方式由配置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_type"><code class="literal">slave_parallel_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从机并行应用的事务可能会失序，除非
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave_preserve_commit_order=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，检查最近执行的事务并不能保证来自主站的所有先前事务都已在从站上执行。</font><font style="vertical-align: inherit;">这对使用多线程从站时的日志记录和恢复有影响。</font><font style="vertical-align: inherit;">例如，在一个多线程的slave上
            </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE
            UNTIL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句只支持使用
             </font></font><code class="literal">SQL_AFTER_MTS_GAPS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.5和更高版本中，当在从站上启用多线程时，支持重试事务。</font><font style="vertical-align: inherit;">在以前的版本中，
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries"><code class="literal">slave_transaction_retries</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在使用多线程从服务器时被视为等于0。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_pending_jobs_size_max"></a>
            <a class="indexterm" name="idm140528030814112"></a>

            <a class="indexterm" name="idm140528030812656"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_pending_jobs_size_max"><code class="literal">slave_pending_jobs_size_max</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_pending_jobs_size_max"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_pending_jobs_size_max">slave_pending_jobs_size_max</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">16M</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">1024</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">18EB</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块大小</font></font></strong></span></td>
<td><code class="literal">1024</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于多线程从站，此变量设置可用于保持尚未应用事件的从属工作队列的最大内存量（以字节为单位）。</font><font style="vertical-align: inherit;">设置此变量对未启用多线程的从站不起作用。</font><font style="vertical-align: inherit;">设置这个变量不会立即生效。</font><font style="vertical-align: inherit;">变量的状态适用于所有后续
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该变量的最小可能值是1024; </font><font style="vertical-align: inherit;">默认值是16MB。</font><font style="vertical-align: inherit;">最大可能值是18446744073709551615（16字节）。</font><font style="vertical-align: inherit;">在存储之前，不是1024的精确倍数的值被舍入到1024的次最高倍数。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这个变量的值不能小于master的值
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">否则从属工作者队列可能变满，而来自主处理器的事件仍有待处理。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_slave_preserve_commit_order"></a>
            <a class="indexterm" name="idm140528030774064"></a>

            <a class="indexterm" name="idm140528030772608"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave_preserve_commit_order</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_preserve_commit_order"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-preserve-commit-order=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.5</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order">slave_preserve_commit_order</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于多线程从站，启用此变量可确保事务在从站的中继日志中出现的顺序与从站的外部化顺序相同。</font><font style="vertical-align: inherit;">设置此变量对未启用多线程的从站不起作用。</font><font style="vertical-align: inherit;">在更改此变量之前，必须停止所有复制线程（对于使用多个复制通道的所有复制通道）。</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在从机上启用。</font><font style="vertical-align: inherit;">另外
             </font></font><code class="option">--slave-parallel-type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须设置为
             </font></font><code class="literal">LOGICAL_CLOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一旦多线程从机启动，事务就可以开始并行执行。</font><font style="vertical-align: inherit;">与
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave_preserve_commit_order</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用，执行的线程等待，直到所有以前的事务提交之前提交。</font><font style="vertical-align: inherit;">当从属线程正在等待其他工作人员提交事务时，它会将其状态报告为</font></font><code class="literal">Waiting for
            preceding transaction to commit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（在MySQL 5.7.8之前，这显示为</font></font><code class="literal">Waiting for its turn to
            commit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）在多线程从机上启用此模式可确保它永远不会进入主机不在其中的状态。这使得它非常适合使用复制进行读取扩展。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-scaleout" title="16.3.4使用复制进行扩展"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.4节“使用复制进行横向扩展”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在使用多线程从站时，如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave_preserve_commit_order</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            未启用，从从站的中继日志中执行的事务序列有可能出现间隙。</font><font style="vertical-align: inherit;">当启用此选项时，不存在空隙的可能性，但</font></font><code class="literal">Exec_master_log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可能落后于已经执行的位置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">
            更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-transaction-inconsistencies" title="16.4.1.33复制和事务不一致"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-transaction-inconsistencies" title="16.4.1.33复制和事务不一致"><font style="vertical-align: inherit;">第16.4.1.33节“复制和事务不一致性”</font></a><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_rows_search_algorithms"></a>
            <a class="indexterm" name="idm140528030725840"></a>

            <a class="indexterm" name="idm140528030724736"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_rows_search_algorithms"><code class="literal">slave_rows_search_algorithms</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_rows_search_algorithms"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal">slave_rows_search_algorithms=list</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">TABLE_SCAN,INDEX_SCAN</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">TABLE_SCAN,INDEX_SCAN</code></p><p class="valid-value"><code class="literal">INDEX_SCAN,HASH_SCAN</code></p><p class="valid-value"><code class="literal">TABLE_SCAN,HASH_SCAN</code></p><p class="valid-value"><code class="literal">TABLE_SCAN,INDEX_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （相当于INDEX_SCAN，HASH_SCAN）</font></font></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为基于行的日志记录和复制准备批次行时，此变量控制如何搜索行以查找匹配项 - 即，是否使用主键或唯一键，其他键或不使用键的搜索在所有。</font><font style="vertical-align: inherit;">设置此变量将立即对所有复制通道生效，包括正在运行的通道。</font><font style="vertical-align: inherit;">可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-rows-search-algorithms"><code class="option">--slave-rows-search-algorithms</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">指定系统变量的初始设置
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从列表中指定一个逗号分隔的任何2（或所有3个）的值的列表</font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">TABLE_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该值预期为一个字符串，所以该值必须被引用。</font><font style="vertical-align: inherit;">另外，该值不能包含任何空格。</font><font style="vertical-align: inherit;">下表显示了可能的组合（列表）及其效果：
</font></font></p>
<div class="informaltable">
<table summary="How rows are searched for matches, based on the value specified for the slave_rows_search_algorithms variable."><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的索引/选项值</font></font></th>
                <th scope="col"><code class="literal">INDEX_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么
                  </font></font><code class="literal">INDEX_SCAN,TABLE_SCAN,HASH_SCAN</code></th>
                <th scope="col"><code class="literal">INDEX_SCAN,TABLE_SCAN</code></th>
                <th scope="col"><code class="literal">TABLE_SCAN,HASH_SCAN</code></th>
              </tr></thead><tbody><tr>
                <td scope="row"><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主键或唯一键</font></font></em></span></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描索引</font></font></td>
              </tr><tr>
                <td scope="row"><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（其他）键</font></font></em></span></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描索引</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描索引</font></font></td>
              </tr><tr>
                <td scope="row"><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有索引</font></font></em></span></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表扫描</font></font></td>
                <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希扫描</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在列表中指定算法的顺序不会影响它们通过a </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-variables" title="13.7.5.39 SHOW VARIABLES语法"><code class="literal">SHOW VARIABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">显示的顺序</font><font style="vertical-align: inherit;">（与前面显示的表中使用</font><font style="vertical-align: inherit;">的顺序</font><font style="vertical-align: inherit;">相同）。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                默认值是
                 </font></font><code class="literal">TABLE_SCAN,INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着所有可以使用索引的搜索都会使用它们，而没有任何索引的搜索将使用表扫描。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要对任何不使用主键或唯一键的搜索使用散列，请将此选项设置为
                 </font></font><code class="literal">INDEX_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">指定</font></font><code class="literal">INDEX_SCAN,TABLE_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font><font style="vertical-align: inherit;">指定
                 </font><font style="vertical-align: inherit;">具有相同的效果
                 </font></font><code class="literal">INDEX_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要为</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font><font style="vertical-align: inherit;">强制散列</font><font style="vertical-align: inherit;">，请将此选项设置为
                 </font></font><code class="literal">TABLE_SCAN,HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以为此选项指定单个值，但这不是最佳选项，因为设置单个值会将搜索限制为仅使用该算法。</font><font style="vertical-align: inherit;">特别是，</font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不建议单独</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">，因为在这种情况下，如果没有索引存在，搜索根本无法找到行。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              只有性能优势
               </font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
               </font></font><code class="literal">HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果该行事件是足够大的。</font><font style="vertical-align: inherit;">行事件的大小是使用配置的
               </font></font><code class="literal">--binlog-row-event-max-size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，假设</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              删除25,000行</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句会生成大型
               </font></font><code class="literal">Delete_row_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件。</font><font style="vertical-align: inherit;">在这种情况下，如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_rows_search_algorithms"><code class="literal">slave_rows_search_algorithms</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              设置为</font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有性能改进。</font><font style="vertical-align: inherit;">但是，如果有25,000个
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，并且每个语句都由单独的事件表示，则设置
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_rows_search_algorithms"><code class="literal">slave_rows_search_algorithms</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为</font></font><code class="literal">INDEX_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
              </font></font><code class="literal">HASH_SCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在执行这些单独的事件时没有提供性能改进。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_slave_skip_errors"></a>
            <a class="indexterm" name="idm140528030640544"></a>

            <a class="indexterm" name="idm140528030639504"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_skip_errors"><code class="literal">slave_skip_errors</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave-skip-errors"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-skip-errors=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_skip_errors">slave_skip_errors</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">[list of error codes]</code></p><p class="valid-value"><code class="literal">all</code></p><p class="valid-value"><code class="literal">ddl_exist_errors</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            正常情况下，当从站发生错误时复制停止，这使您有机会手动解决数据中的不一致问题。</font><font style="vertical-align: inherit;">当语句返回变量值中列出的任何错误时，此变量将导致从属SQL线程继续复制。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_sql_verify_checksum"></a>
            <a class="indexterm" name="idm140528030604768"></a>

            <a class="indexterm" name="idm140528030603664"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_sql_verify_checksum"><code class="literal">slave_sql_verify_checksum</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_sql_verify_checksum"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_sql_verify_checksum">slave_sql_verify_checksum</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使从属SQL线程使用从中继日志中读取的校验和验证数据。</font><font style="vertical-align: inherit;">如果不匹配，从站将停止并出现错误。</font><font style="vertical-align: inherit;">设置此变量将立即对所有复制通道生效，包括正在运行的通道。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果可能的话，从I / O线程接收来自网络的事件时，总是读取校验和。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_slave_transaction_retries"></a>
            <a class="indexterm" name="idm140528030573040"></a>

            <a class="indexterm" name="idm140528030571968"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries"><code class="literal">slave_transaction_retries</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_transaction_retries"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-transaction-retries=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries">slave_transaction_retries</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果复制从SQL线程失败，因为一个来执行事务
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">死锁或因为交易的执行时间超过
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
             </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html#ndbparam-ndbd-transactiondeadlockdetectiontimeout"><code class="literal">TransactionDeadlockDetectionTimeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或
             </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html#ndbparam-ndbd-transactioninactivetimeout"><code class="literal">TransactionInactiveTimeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它会自动重试
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries"><code class="literal">slave_transaction_retries</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与错误停止前的时间。</font><font style="vertical-align: inherit;">默认值为10.设置此变量将立即对所有复制通道生效，包括正在运行的通道。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从MySQL 5.7.5开始，在从站上启用多线程时，支持事务重试。</font><font style="vertical-align: inherit;">在以前的版本中，
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries"><code class="literal">slave_transaction_retries</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在使用多线程从服务器时被视为等于0。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_slave_type_conversions"></a>
            <a class="indexterm" name="idm140528030512976"></a>

            <a class="indexterm" name="idm140528030511936"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_type_conversions"><code class="literal">slave_type_conversions</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for slave_type_conversions"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--slave-type-conversions=set</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_type_conversions">slave_type_conversions</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal"></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.2）</font></font></td>
<td><p class="valid-value"><code class="literal">ALL_LOSSY</code></p><p class="valid-value"><code class="literal">ALL_NON_LOSSY</code></p><p class="valid-value"><code class="literal">ALL_SIGNED</code></p><p class="valid-value"><code class="literal">ALL_UNSIGNED</code></p></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.1）</font></font></td>
<td><p class="valid-value"><code class="literal">ALL_LOSSY</code></p><p class="valid-value"><code class="literal">ALL_NON_LOSSY</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用基于行的复制时，控制在从属设备上使用的类型转换模式。</font><font style="vertical-align: inherit;">在MySQL 5.7.2和以后，它的值是从该列表以逗号分隔的组零个或多个元素：</font></font><code class="literal">ALL_LOSSY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">ALL_NON_LOSSY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">ALL_SIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">ALL_UNSIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将此变量设置为空字符串以禁止主从机之间的类型转换。</font><font style="vertical-align: inherit;">设置此变量将立即对所有复制通道生效，包括正在运行的通道。
          </font></font></p><p>
            <code class="literal">ALL_SIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
             </font></font><code class="literal">ALL_UNSIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL 5.7.2中添加（Bug＃15831300）。</font><font style="vertical-align: inherit;">有关适用于基于</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-attribute-promotion" title="基于行的复制：属性提升和降级"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行的复制中的属性升级和降级的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型转换模式的其他信息，请参阅
             </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-attribute-promotion" title="基于行的复制：属性提升和降级"><font style="vertical-align: inherit;">基于行的复制：属性升级和降级</font></a><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_sql_slave_skip_counter"></a>
            <a class="indexterm" name="idm140528030466528"></a>

            <a class="indexterm" name="idm140528030465488"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sql_slave_skip_counter"><code class="literal">sql_slave_skip_counter</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for sql_slave_skip_counter"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sql_slave_skip_counter">sql_slave_skip_counter</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            主服务器应该跳过的事件数量。</font><font style="vertical-align: inherit;">设置选项不会立即生效。</font><font style="vertical-align: inherit;">该变量适用于下一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START
            SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句; </font><font style="vertical-align: inherit;">下
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一条语句也会将该值更改回0.当此变量设置为非零值并且配置了多个复制通道时，该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句只能与该</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">一起使用</font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">FOR CHANNEL
            <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项与基于GTID的复制不兼容，并且在设置时不能设置为非零值
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_gtid-mode"><code class="option">--gtid-mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您在使用GTID时需要跳过事务处理，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主服务器。</font><font style="vertical-align: inherit;">有关如何执行此操作的信息，</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-failover-empty" title="注入空的交易"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入空白事务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果跳过通过设置此变量指定的事件数将导致从站在事件组的中间开始，则从站将继续跳过，直到找到下一个事件组的开始并从该点开始。</font><font style="vertical-align: inherit;">有关更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#set-global-sql-slave-skip-counter" title="13.4.2.5 SET GLOBAL sql_slave_skip_counter语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.4.2.5节“SE​​T GLOBAL sql_slave_skip_counter语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_sync_master_info"></a>
            <a class="indexterm" name="idm140528030432944"></a>

            <a class="indexterm" name="idm140528030431936"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_master_info"><code class="literal">sync_master_info</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for sync_master_info"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--sync-master-info=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_master_info">sync_master_info</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">10000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">10000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量对复制从机的影响取决于从机是否
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_info_repository"><code class="literal">master_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被设置为</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下面的段落所述。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master_info_repository = FILE。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果值</font></font><code class="literal">sync_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于0，那么</font><font style="vertical-align: inherit;">在每次</font><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">之后</font><font style="vertical-align: inherit;">，从站会将其</font></font><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">同步
               </font><font style="vertical-align: inherit;">到磁盘（使用
               </font></font><code class="literal">fdatasync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
               </font></font><code class="literal">sync_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果它是0，则MySQL服务器不会将</font></font><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">同步
               </font><font style="vertical-align: inherit;">到磁盘; </font><font style="vertical-align: inherit;">相反，服务器依靠操作系统定期刷新其内容，与其他文件一样。
            </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master_info_repository = TABLE。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果值</font></font><code class="literal">sync_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于0，那么从设备在每次</font></font><code class="literal">sync_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">之后都会更新其主信息存储库表
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果它是0，表从不更新。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认值为</font></font><code class="literal">sync_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10000.设置此变量会立即对所有复制通道生效，包括正在运行的通道。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_sync_relay_log"></a>
            <a class="indexterm" name="idm140528030372416"></a>

            <a class="indexterm" name="idm140528030371360"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log"><code class="literal">sync_relay_log</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for sync_relay_log"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--sync-relay-log=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log">sync_relay_log</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">10000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">10000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果此变量的值大于0，那么MySQL服务器将</font></font><code class="literal">fdatasync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个</font></font><code class="literal">sync_relay_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件写入中继日志</font><font style="vertical-align: inherit;">后</font><font style="vertical-align: inherit;">，将其中继日志同步到磁盘（正在使用
             </font><font style="vertical-align: inherit;">）
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置此变量将立即对所有复制通道生效，包括正在运行的通道。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置</font></font><code class="literal">sync_relay_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0不会导致同步到磁盘; </font><font style="vertical-align: inherit;">在这种情况下，服务器依赖于操作系统随时刷新中继日志的内容，就像其他文件一样。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值为1是最安全的选择，因为在发生崩溃时，您最多会从中继日志中丢失一个事件。</font><font style="vertical-align: inherit;">但是，它也是最慢的选择（除非磁盘有电池支持的缓存，这使得同步非常快）。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_sync_relay_log_info"></a>
            <a class="indexterm" name="idm140528030320096"></a>

            <a class="indexterm" name="idm140528030319056"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log_info"><code class="literal">sync_relay_log_info</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for sync_relay_log_info"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--sync-relay-log-info=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log_info">sync_relay_log_info</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">10000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">10000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认值为</font></font><code class="literal">sync_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            10000.设置此变量会立即对所有复制通道生效，包括正在运行的通道。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此变量对复制从节点的影响取决于服务器的
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置（</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果设置为
             </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则变量的影响还取决于中继日志信息表使用的存储引擎是事务性的（如
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）还是不是事务性的（</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这些因素对服务器对于</font></font><code class="literal">sync_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">零和大于零值</font><font style="vertical-align: inherit;">的行为的影响
             </font><font style="vertical-align: inherit;">如下所示：
</font></font></p>
<div class="variablelist">
<dl class="variablelist"><dt><span class="term">
                <code class="literal">sync_relay_log_info = 0</code>
</span></dt><dd>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      如果
                       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      设置为</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则MySQL服务器不会将</font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">同步
                       </font><font style="vertical-align: inherit;">到磁盘; </font><font style="vertical-align: inherit;">相反，服务器依靠操作系统定期刷新其内容，与其他文件一样。
                    </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      如果
                       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      设置为</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且该表的存储引擎是事务性的，则在每次事务后更新表。</font><font style="vertical-align: inherit;">（</font></font><code class="literal">sync_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下</font><font style="vertical-align: inherit;">，
                       </font><font style="vertical-align: inherit;">设置被有效忽略。）
                    </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      如果
                       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      设置为</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且该表的存储引擎不是事务性的，则该表永远不会更新。
</font></font></p></li></ul>
</div>
</dd><dt><span class="term">
                <code class="literal">sync_relay_log_info =
                <em class="replaceable"><code>N</code></em> &gt; 0</code>
</span></dt><dd>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      如果
                       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      设置为</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则从机</font><font style="vertical-align: inherit;">在每次</font><font style="vertical-align: inherit;">事务处理</font><font style="vertical-align: inherit;">后将</font><font style="vertical-align: inherit;">其</font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">同步
                       </font><font style="vertical-align: inherit;">到磁盘（使用</font></font><code class="literal">fdatasync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
                       </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                    </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      如果
                       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      设置为</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且该表的存储引擎是事务性的，则在每次事务后更新表。</font><font style="vertical-align: inherit;">（</font></font><code class="literal">sync_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下</font><font style="vertical-align: inherit;">，
                       </font><font style="vertical-align: inherit;">设置被有效忽略。）
                    </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      如果
                       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      设置为</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且该表的存储引擎不是事务性的，则在每个</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">之后更新表
                       </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</dd></dl>
</div>
</li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-options-binary-log"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.4二进制日志记录选项和变量</font></font></h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-optvars-binlog" title="与二进制日志记录一起使用的启动选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与二进制日志记录一起使用的启动选项</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-sysvars-binlog" title="与二进制日志记录一起使用的系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与二进制日志记录一起使用的系统变量</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以使用</font><font style="vertical-align: inherit;">本节中介绍</font><font style="vertical-align: inherit;">的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项和系统变量来影响二进制日志的操作，并控制哪些语句写入二进制日志。</font><font style="vertical-align: inherit;">有关二进制日志的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关使用MySQL服务器选项和系统变量的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-options" title="5.1.4服务器命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.4节“服务器命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="replication-optvars-binlog"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与二进制日志记录一起使用的启动选项</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表介绍了启用和配置二进制日志的启动选项。</font><font style="vertical-align: inherit;">与二进制日志记录一起使用的系统变量将在本节后面讨论。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_binlog-row-event-max-size"></a>
            <a class="indexterm" name="idm140528030225376"></a>

            <a class="indexterm" name="idm140528030223920"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-row-event-max-size"><code class="option">--binlog-row-event-max-size=<em class="replaceable"><code>N</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog-row-event-max-size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-row-event-max-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">8192</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">8192</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">256</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">256</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            指定基于行的二进制日志事件的最大大小（以字节为单位）。</font><font style="vertical-align: inherit;">如果可能的话，行被分成小于这个尺寸的事件。</font><font style="vertical-align: inherit;">该值应该是256的倍数。默认值是8192.请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_binlog-rows-query-log-events"></a>
            <a class="indexterm" name="idm140528030184384"></a>

            <a class="indexterm" name="idm140528030182880"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-rows-query-log-events"><code class="option">--binlog-rows-query-log-events</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog-rows-query-log-events"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-rows-query-log-events</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项启用
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_rows_query_log_events"><code class="literal">binlog_rows_query_log_events</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这会导致MySQL服务器将信息日志事件（如行查询日志事件）写入其二进制日志中。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_log-bin"></a>
            <a class="indexterm" name="idm140528030162592"></a>

            <a class="indexterm" name="idm140528030161136"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin[=<em class="replaceable"><code>base_name</code></em>]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log-bin"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-bin</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin">log_bin</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用二进制日志记录。</font><font style="vertical-align: inherit;">启用二进制日志记录后，服务器会将所有将数据更改为的数据记录到用于备份和复制的二进制日志中。</font><font style="vertical-align: inherit;">二进制日志是一系列具有基本名称和数字扩展名的文件。</font><font style="vertical-align: inherit;">有关二进制日志格式和管理的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果为该</font></font><code class="option">--log-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">提供值，则</font><font style="vertical-align: inherit;">该值将用作日志序列的基本名称。</font><font style="vertical-align: inherit;">服务器通过向基本名称添加数字后缀来依次创建二进制日志文件。</font><font style="vertical-align: inherit;">在MySQL 5.7中，基本名称默认
             </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用主机名称。</font><font style="vertical-align: inherit;">建议您指定一个基本名称，以便您可以继续使用相同的二进制日志文件名称，而不管默认名称的更改如何。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            二进制日志文件的默认位置是数据目录。</font><font style="vertical-align: inherit;">您可以使用该</font></font><code class="option">--log-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项指定替代位置，方法是向基本名称添加前导绝对路径名以指定其他目录。</font><font style="vertical-align: inherit;">当服务器从跟踪已使用的二进制日志文件的二进制日志索引文件中读取条目时，它会检查条目是否包含相对路径。</font><font style="vertical-align: inherit;">如果是这样，路径的相对部分将被替换为使用的绝对路径
            </font></font><code class="option">--log-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">记录在二进制日志索引文件中的绝对路径保持不变; </font><font style="vertical-align: inherit;">在这种情况下，必须手动编辑索引文件以启用一个或多个新路径。</font><font style="vertical-align: inherit;">（在旧版本的MySQL中，每当重定位二进制日志或中继日志文件时都需要手动干预。）（错误＃11745230，错误＃12133）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置此选项会导致
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin"><code class="literal">log_bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量设置为</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或</font></font><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），而不是基本名称。</font><font style="vertical-align: inherit;">二进制日志文件基本名称和任何指定的路径都可用作
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_basename"><code class="literal">log_bin_basename</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您指定</font></font><code class="option">--log-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项而不指定a
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">--server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则不允许服务器启动。</font><font style="vertical-align: inherit;">（错误＃11763963，错误＃56739）
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_log-bin-index"></a>
            <a class="indexterm" name="idm140528030123824"></a>

            <a class="indexterm" name="idm140528030122336"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin-index"><code class="option">--log-bin-index[=<em class="replaceable"><code>file_name</code></em>]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log-bin-index"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-bin-index=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            二进制日志文件名称的索引文件。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您省略文件名，并且您没有指定文件名，则
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL将
             </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-bin.index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用作文件名。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_log-bin-trust-function-creators"></a>
            <a class="indexterm" name="idm140528030103312"></a>

            <a class="indexterm" name="idm140528030101808"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin-trust-function-creators"><code class="option">--log-bin-trust-function-creators[={0|1}]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log-bin-trust-function-creators"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-bin-trust-function-creators</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_bin_trust_function_creators">log_bin_trust_function_creators</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项设置相应的
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_bin_trust_function_creators"><code class="literal">log_bin_trust_function_creators</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量。</font><font style="vertical-align: inherit;">如果没有给出参数，则该选项将变量设置为1.
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_log_bin_trust_function_creators"><code class="literal">log_bin_trust_function_creators</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            影响MySQL如何强制限制存储的函数和触发器的创建。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-programs-logging" title="23.7存储程序的二进制记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第23.7节“存储程序的二进制日志记录”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_log-bin-use-v1-row-events"></a>
            <a class="indexterm" name="idm140528030070416"></a>

            <a class="indexterm" name="idm140528030068960"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin-use-v1-row-events"><code class="option">--log-bin-use-v1-row-events[={0|1}]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log-bin-use-v1-row-events"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-bin-use-v1-row-events[={0|1}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_use_v1_row_events">log_bin_use_v1_row_events</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL 5.7使用Version 2二进制日志行事件，MySQL 5.6.6之前的MySQL Server版本无法读取这些事件。</font><font style="vertical-align: inherit;">将此选项设置为1会导致
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用版本1日志记录事件（这是以前版本中使用的二进制日志事件的唯一版本）写入二进制日志，从而生成旧版本可以读取的二进制日志。</font><font style="vertical-align: inherit;">设置</font></font><code class="option">--log-bin-use-v1-row-events</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0（默认值）会导致</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用版本2二进制日志事件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于此选项的值可以从只读
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_use_v1_row_events"><code class="literal">log_bin_use_v1_row_events</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量中获取。
          </font></font></p><p>
            <code class="option">--log-bin-use-v1-row-events</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要关注使用</font></font><code class="literal">NDB$EPOCH_TRANS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冲突检测功能</font><font style="vertical-align: inherit;">设置复制冲突检测和解决方案</font><font style="vertical-align: inherit;">，该功能需要版本2二进制日志行事件。</font><font style="vertical-align: inherit;">因此，这个选项
             </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html#option_mysqld_ndb-log-transaction-id"><code class="option">--ndb-log-transaction-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并不兼容。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-conflict-resolution" title="21.6.11 NDB群集复制冲突解决"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21.6.11节“NDB群集复制冲突解决”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报表选择选项。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下列表中的选项会影响哪些语句写入二进制日志，并由复制主服务器发送到其从服务器。</font><font style="vertical-align: inherit;">还有从服务器的选项可以控制从主服务器收到的哪些语句应该被执行或忽略。</font><font style="vertical-align: inherit;">有关详细信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options-slave" title="16.1.6.3复制从站选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6.3节“复制从属选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_binlog-do-db"></a>
            <a class="indexterm" name="idm140528030029168"></a>

            <a class="indexterm" name="idm140528030027680"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db=<em class="replaceable"><code>db_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog-do-db"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-do-db=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项以类似于</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响复制</font><font style="vertical-align: inherit;">的方式影响二进制日志记录
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项的效果取决于基于语句的还是基于行的日志记录格式是否正在使用，与使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句或基于行的复制</font><font style="vertical-align: inherit;">的效果相同
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您应该记住，用于记录给定语句的格式可能不一定与值的值相同
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，DDL语句（如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和）</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是作为语句记录，而不考虑记录格式是否有效，因此以下基于语句的规则</font></font><code class="option">--binlog-do-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            总是适用于确定语句是否记录。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句的日志记录。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              只有那些语句被写入二进制日志，其中默认的数据库（也就是一个由选定的
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是
               </font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要指定多个数据库，请多次使用此选项，每个数据库使用一次; </font><font style="vertical-align: inherit;">但是，这样做
               </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致跨数据库语句，例如</font><font style="vertical-align: inherit;">在选择不同数据库（或不具有数据库）时记录。
</font></font><code class="literal">UPDATE
              <em class="replaceable"><code>some_db.some_table</code></em> SET
              foo='bar'</code><font style="vertical-align: inherit;"></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要指定多个数据库，您
               </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此选项的多个实例。</font><font style="vertical-align: inherit;">由于数据库名称可以包含逗号，因此如果提供逗号分隔列表，则该列表将被视为单个数据库的名称。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用基于语句的日志记录时，您可能会发现不起作用的示例：如果服务器启动
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并发出以下语句，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录</font><font style="vertical-align: inherit;">该
             </font><font style="vertical-align: inherit;">语句
             </font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用价格;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE sales.january SET amount = amount + 1000;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这种</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅检查缺省数据库</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行为的</font><font style="vertical-align: inherit;">主要原因</font><font style="vertical-align: inherit;">是，仅从语句中很难知道是否应该复制它（例如，如果您使用多表
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            跨多个表单操作的多</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">语句数据库）。</font><font style="vertical-align: inherit;">如果不需要，只检查默认数据库而不检查所有数据库也更快。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            另一种可能不是不言而喻的情况是，即使在设置选项时没有指定给定的数据库，也会复制该数据库。</font><font style="vertical-align: inherit;">如果启动服务器</font></font><code class="option">--binlog-do-db=sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则会记录</font><font style="vertical-align: inherit;">以下
             </font><font style="vertical-align: inherit;">语句，即使</font></font><code class="literal">prices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在设置时不包括</font></font><code class="option">--binlog-do-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting">        <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用销售;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE prices.discounts SET百分比=百分比+10;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            因为</font></font><code class="literal">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句发布</font><font style="vertical-align: inherit;">时的默认数据库</font><font style="vertical-align: inherit;">，所以会</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被记录。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的日志记录。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              日志记录仅限于数据库
               </font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">只</font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录</font><font style="vertical-align: inherit;">对属于表的更改</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">默认数据库对此没有影响。</font><font style="vertical-align: inherit;">假设服务器启动
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且基于行的日志记录生效，然后执行以下语句：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用价格;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE sales.february SET amount = amount + 100;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据</font><font style="vertical-align: inherit;">声明</font></font><code class="literal">february</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font></font><code class="literal">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">表格
             </font><font style="vertical-align: inherit;">
            的更改进行</font><font style="vertical-align: inherit;">记录</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">无论是否</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布声明都会</font><font style="vertical-align: inherit;">发生这种情况
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，使用基于行的日志记录格式时
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不会记录</font><font style="vertical-align: inherit;">由以下内容所做的更改</font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用价格;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE prices.march SET amount = amount-25;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            即使</font></font><code class="literal">USE prices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句更改为</font></font><code class="literal">USE sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的影响仍不会写入二进制日志。
          </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与基于行的日志记录相比</font><font style="vertical-align: inherit;">
            ，</font><font style="vertical-align: inherit;">处理基于语句的日志记录与处理基于行的日志记录相关的</font><font style="vertical-align: inherit;">另一个重要区别
             </font><font style="vertical-align: inherit;">在于涉及多个数据库的语句。</font><font style="vertical-align: inherit;">假设服务器启动
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db=db1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并执行以下语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用db1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE db1.table1 SET col1 = 10，db2.table2 SET col2 = 20;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您正在使用基于语句的日志记录，则将这两个表的更新写入二进制日志。</font><font style="vertical-align: inherit;">但是，使用基于行的格式时，只会</font></font><code class="literal">table1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录</font><font style="vertical-align: inherit;">更改
             </font><font style="vertical-align: inherit;">;
            </font></font><code class="literal">table2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在不同的数据库中，所以它不会被更改</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在假设，而不是</font></font><code class="literal">USE db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            声明，使用了一个</font></font><code class="literal">USE db4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用db4;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE db1.table1 SET col1 = 10，db2.table2 SET col2 = 20;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用基于语句的日志记录时</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">语句不会写入二进制日志。</font><font style="vertical-align: inherit;">但是，在使用基于行的日志记录时，记录的更改将</font></font><code class="literal">table1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被记录，但不会记录</font></font><code class="literal">table2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 换句话说，只</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录</font><font style="vertical-align: inherit;">对名为by的数据库中表的更改
             </font><font style="vertical-align: inherit;">，并且缺省数据库的选择对此行为没有影响。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_binlog-ignore-db"></a>
            <a class="indexterm" name="idm140528029952496"></a>

            <a class="indexterm" name="idm140528029951008"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db=<em class="replaceable"><code>db_name</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog-ignore-db"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-ignore-db=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项以类似于</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响复制</font><font style="vertical-align: inherit;">的方式影响二进制日志记录
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项的效果取决于基于语句的还是基于行的日志记录格式是否正在使用，与使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句或基于行的复制</font><font style="vertical-align: inherit;">的效果相同
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您应该记住，用于记录给定语句的格式可能不一定与值的值相同
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，DDL语句（如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和）</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是作为语句记录，而不考虑记录格式是否有效，因此以下基于语句的规则
             </font></font><code class="option">--binlog-ignore-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是适用于确定语句是否记录。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句的日志记录。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              告诉服务器无法登录任何声明，其中默认的数据库（即，由选定的一个
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是
               </font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.2之前，如果没有指定默认数据库（即</font><font style="vertical-align: inherit;">返回时
             </font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">，此选项将导致包含完全限定表名的任何语句不被记录
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7.2和更高版本中，当没有默认数据库时，不</font><font style="vertical-align: inherit;">应用</font><font style="vertical-align: inherit;">任何
             </font><font style="vertical-align: inherit;">选项，并且始终记录此类语句。</font><font style="vertical-align: inherit;">（错误＃11829838，错误＃60188）
          </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_database"><code class="literal">DATABASE()</code></a><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font><code class="option">--binlog-ignore-db</code><font style="vertical-align: inherit;"></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的格式。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              指示服务器不要将更新记录到数据库中的任何表中</font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当前数据库不起作用。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在使用基于语句的日志记录时，以下示例不像您所期望的那样正常工作。</font><font style="vertical-align: inherit;">假设服务器启动
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并发出以下语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用价格;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE sales.january SET amount = amount + 1000;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
             </font><font style="vertical-align: inherit;">在这种情况下</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录，因为
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅适用于默认数据库（由</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">确定
             </font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">由于
             </font></font><code class="literal">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库是在语句中明确指定的，因此该语句未被过滤。</font><font style="vertical-align: inherit;">但是，在使用基于行的日志记录时，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的效果</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入二进制日志，这意味着不会更改该
             </font></font><code class="literal">sales.january</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">在这种情况下，
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            会导致</font><font style="vertical-align: inherit;">对主副本中的表进行的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改</font></font><code class="literal">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            数据库为了二进制日志的目的而被忽略。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要指定多个要忽略的数据库，请多次使用此选项，每个数据库使用一次。</font><font style="vertical-align: inherit;">由于数据库名称可以包含逗号，因此如果提供逗号分隔列表，则该列表将被视为单个数据库的名称。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果使用跨数据库更新并且不希望记录这些更新，则不应使用此选项。
</font></font></p></li></ul>
</div>
<p><a name="replication-optvars-binlog-checksums"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校验和选项。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL支持读取和写入二进制日志校验和。</font><font style="vertical-align: inherit;">这些使用这里列出的两个选项启用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_binlog-checksum"></a>
            <a class="indexterm" name="idm140528029902432"></a>

            <a class="indexterm" name="idm140528029900944"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-checksum"><code class="option">--binlog-checksum={NONE|CRC32}</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog-checksum"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-checksum=type</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">CRC32</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">NONE</code></p><p class="valid-value"><code class="literal">CRC32</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用此选项将导致主服务器为写入二进制日志的事件写入校验和。</font><font style="vertical-align: inherit;">设置为
             </font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用，或者用于生成校验和的算法的名称; </font><font style="vertical-align: inherit;">目前只支持CRC32校验和，CRC32是默认值。</font><font style="vertical-align: inherit;">您无法在交易中更改此选项的设置。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_master-verify-checksum"></a>
            <a class="indexterm" name="idm140528029876560"></a>

            <a class="indexterm" name="idm140528029875104"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-verify-checksum"><code class="option">--master-verify-checksum={0|1}</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for master-verify-checksum"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--master-verify-checksum=name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用此选项将导致主服务器使用校验和验证来自二进制日志的事件，并在发生不匹配时停止发生错误。</font><font style="vertical-align: inherit;">默认情况下禁用。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要控制从站（从中继）日志读取校验和，请使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-sql-verify-checksum"><code class="option">--slave-sql-verify-checksum</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试和调试选项。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下二进制日志选项用于复制测试和调试。</font><font style="vertical-align: inherit;">它们不适用于正常操作。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_max-binlog-dump-events"></a>
            <a class="indexterm" name="idm140528029852016"></a>

            <a class="indexterm" name="idm140528029850560"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_max-binlog-dump-events"><code class="option">--max-binlog-dump-events=<em class="replaceable"><code>N</code></em></code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for max-binlog-dump-events"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--max-binlog-dump-events=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项由MySQL测试套件在内部用于复制测试和调试。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_sporadic-binlog-dump-fail"></a>
            <a class="indexterm" name="idm140528029831312"></a>

            <a class="indexterm" name="idm140528029829856"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_sporadic-binlog-dump-fail"><code class="option">--sporadic-binlog-dump-fail</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for sporadic-binlog-dump-fail"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--sporadic-binlog-dump-fail</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该选项由MySQL测试套件在内部用于复制测试和调试。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="replication-sysvars-binlog"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与二进制日志记录一起使用的系统变量</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表描述了控制二进制日志记录的系统变量。</font><font style="vertical-align: inherit;">它们可以在服务器启动时设置，其中一些可以在运行时使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">本节前面列出了用于控制二进制日志记录的服务器选项。</font><font style="vertical-align: inherit;">有关
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_log_bin"><code class="literal">sql_log_bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_log_off"><code class="literal">sql_log_off</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_binlog_cache_size"></a>
            <a class="indexterm" name="idm140528029804080"></a>

            <a class="indexterm" name="idm140528029803040"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_cache_size"><code class="literal">binlog_cache_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_cache_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-cache-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_cache_size">binlog_cache_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">32768</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">32768</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            缓存的大小，用于保存事务期间对二进制日志的更改。</font><font style="vertical-align: inherit;">如果服务器支持任何事务性存储引擎并且服务器启用了二进制日志（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项），</font><font style="vertical-align: inherit;">则为每个客户端分配二进制日志高速缓存</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您经常使用大型事务，则可以增加此缓存大小以获得更好的性能。</font><font style="vertical-align: inherit;">这个
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Binlog_cache_use"><code class="literal">Binlog_cache_use</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Binlog_cache_disk_use"><code class="literal">Binlog_cache_disk_use</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            状态变量可以用来调整这个变量的大小。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p>
            <code class="literal">binlog_cache_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅设置事务高速缓存的大小; </font><font style="vertical-align: inherit;">语句高速缓存的大小由
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_stmt_cache_size"><code class="literal">binlog_stmt_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量控制。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_checksum"></a>
            <a class="indexterm" name="idm140528029748352"></a>

            <a class="indexterm" name="idm140528029747344"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_checksum"><code class="literal">binlog_checksum</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_checksum"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_checksum">binlog_checksum</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">CRC32</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">NONE</code></p><p class="valid-value"><code class="literal">CRC32</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用后，此变量将导致主服务器为二进制日志中的每个事件写入校验和。
            </font></font><code class="literal">binlog_checksum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持值
             </font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（禁用）和
             </font></font><code class="literal">CRC32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认是
             </font></font><code class="literal">CRC32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您无法更改</font></font><code class="literal">binlog_checksum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易内</font><font style="vertical-align: inherit;">的价值
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><code class="literal">binlog_checksum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用（值
             </font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）时，服务器通过编写和检查每个事件的事件长度（而不是校验和）来验证它是否只写完整事件到二进制日志。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            更改此变量的值会导致二进制日志旋转; </font><font style="vertical-align: inherit;">校验和总是写入整个二进制日志文件，并且永远不会只写入其中的一部分。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将主站上的此变量设置为从站无法识别的值会导致从站将其自己的</font></font><code class="literal">binlog_checksum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">设置
             </font><font style="vertical-align: inherit;">为
             </font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并停止复制并出现错误。</font><font style="vertical-align: inherit;">（错误＃13553750，错误＃61096）如果需要向后兼容较旧的从站，则可能需要将该值显式设置为</font></font><code class="literal">NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_direct_non_transactional_updates"></a>
            <a class="indexterm" name="idm140528029708496"></a>

            <a class="indexterm" name="idm140528029707456"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates"><code class="literal">binlog_direct_non_transactional_updates</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_direct_non_transactional_updates"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-direct-non-transactional-updates[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates">binlog_direct_non_transactional_updates</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于并发问题，当事务包含事务和非事务表的更新时，从服务器可能会变得不一致。</font><font style="vertical-align: inherit;">MySQL试图通过将非事务性语句写入事务缓存来保留这些语句之间的因果关系，事务缓存在提交时被刷新。</font><font style="vertical-align: inherit;">但是，如果代表事务对非事务表进行的修改变得对其他连接立即可见，则会出现问题，因为这些更改可能不会立即写入二进制日志中。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates"><code class="literal">binlog_direct_non_transactional_updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            变量为此问题提供了一种可能的解决方法。</font><font style="vertical-align: inherit;">默认情况下，该变量被禁用。</font><font style="vertical-align: inherit;">启用
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates"><code class="literal">binlog_direct_non_transactional_updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            会导致非事务性表的更新直接写入二进制日志，而不是写入事务高速缓存。
          </font></font></p><p>
            <span class="emphasis"><em><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates"><code class="literal">binlog_direct_non_transactional_updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            仅适用于使用基于语句的二进制日志记录格式复制的语句</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">也就是说，它只有在</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is
            </font><font style="vertical-align: inherit;">的值
            </font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is
            </font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和某个给定语句正在使用基于语句的格式进行复制</font><font style="vertical-align: inherit;">时才有效
            </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当二进制日志格式为</font></font><code class="literal">ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或当
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为，
            </font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且使用基于行的格式复制给定语句</font><font style="vertical-align: inherit;">时，此变量不起作用
            </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在启用此变量之前，您必须确保事务性和非事务性表之间不存在依赖关系; </font><font style="vertical-align: inherit;">声明就是这种依赖的一个例子</font></font><code class="literal">INSERT INTO myisam_table
              SELECT * FROM innodb_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，这种说法可能会导致奴隶与主人分道扬。。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当二进制日志格式为</font></font><code class="literal">ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">时，此变量不起作用
             </font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_error_action"></a>
            <a class="indexterm" name="idm140528029662560"></a>

            <a class="indexterm" name="idm140528029661520"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_error_action"><code class="literal">binlog_error_action</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_error_action"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-error-action[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.6</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_error_action">binlog_error_action</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><code class="literal">ABORT_SERVER</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.6）</font></font></td>
<td><code class="literal">IGNORE_ERROR</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">IGNORE_ERROR</code></p><p class="valid-value"><code class="literal">ABORT_SERVER</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制服务器遇到错误时发生的情况，如无法写入，刷新或同步二进制日志，这可能会导致主服务器日志变得不一致，并且复制服务器从服务器失去同步。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.7和更高版本中，这个变量默认为
             </font></font><code class="literal">ABORT_SERVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这会使服务器在遇到二进制日志出现这样的错误时暂停日志并关闭。</font><font style="vertical-align: inherit;">在服务器重新启动时，所有先前准备好的和二进制记录的事务都被提交，而任何已准备好但未由于错误而被二进制记录的事务将被中止。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            何时</font></font><code class="literal">binlog_error_action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为
             </font></font><code class="literal">IGNORE_ERROR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果服务器遇到此类错误，它将继续正在进行的事务，记录错误并暂停记录，并继续执行更新。</font><font style="vertical-align: inherit;">要恢复二进制日志记录，
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin"><code class="literal">log_bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须再次启用。</font><font style="vertical-align: inherit;">这提供了与旧版本MySQL的向后兼容性。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在以前的版本中，这个变量被命名
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlogging_impossible_mode"><code class="literal">binlogging_impossible_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_format"></a>
            <a class="indexterm" name="idm140528029615872"></a>

            <a class="indexterm" name="idm140528029614816"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog-format"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-format=format</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format">binlog_format</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><code class="literal">ROW</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.6）</font></font></td>
<td><code class="literal">STATEMENT</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">ROW</code></p><p class="valid-value"><code class="literal">STATEMENT</code></p><p class="valid-value"><code class="literal">MIXED</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此变量设置二进制日志格式，并且可以是任何一个</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_binlog-format"><code class="option">--binlog-format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动时</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">选项或</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">变量设置。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              虽然您可以在运行时更改日志记录格式，但
               </font><font style="vertical-align: inherit;">建议您</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在复制过程中对其进行更改。</font><font style="vertical-align: inherit;">这部分是因为奴隶不尊重主人的
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设定; </font><font style="vertical-align: inherit;">给定的MySQL服务器只能更改自己的日志记录格式。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.7之前，默认格式是
             </font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7.7及更高版本中，默认值是</font></font><code class="literal">ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：在NDB群集中，默认值是</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">NDB群集不支持基于语句的复制。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您必须有权</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置全局</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">或会话
             </font><font style="vertical-align: inherit;">值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            管理这个变量的变化何时生效的规则以及效果持续的时间与其他MySQL服务器系统变量相同。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.4.1节“变量赋值的SET语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定，基于语句的复制时，除了仅基于行的复制是保证导致正确的结果的情况。</font><font style="vertical-align: inherit;">例如，当语句包含用户定义函数（UDF）或</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid"><code class="literal">UUID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            函数</font><font style="vertical-align: inherit;">时会发生这种情况</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关在设置每种二进制日志记录格式时如何处理存储程序（存储过程和函数，触发器和事件）的详细信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-programs-logging" title="23.7存储程序的二进制记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第23.7节“存储程序的二进制日志记录”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在运行时无法切换复制格式时有例外：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                来自存储的函数或触发器内。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果会话当前处于基于行的复制模式并且已打开临时表。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                来自交易。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            试图在这些情况下切换格式会导致错误。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            二进制日志格式会影响以下服务器选项的行为：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些效果在各个选项的描述中详细讨论。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_group_commit_sync_delay"></a>
            <a class="indexterm" name="idm140528029545168"></a>

            <a class="indexterm" name="idm140528029544128"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_group_commit_sync_delay"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-group-commit-sync-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.5</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay">binlog_group_commit_sync_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">1000000</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制二进制日志提交在将二进制日志文件同步到磁盘之前等待的微秒数。</font><font style="vertical-align: inherit;">默认情况下
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置为0，这意味着没有延迟。</font><font style="vertical-align: inherit;">设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为微秒的延迟可以让更多的事务同时一起同步到磁盘，从而减少提交一组事务所需的总时间，因为较大的组需要较少的每个组的时间单位。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被设置时，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在同步之前（或者在</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续之前），</font><font style="vertical-align: inherit;">为每个二进制日志提交组应用
             </font><font style="vertical-align: inherit;">指定的延迟
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被设置为一个值</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于1，以后每隔延迟施加</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制日志提交的基团。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以增加任何具有（或可能在故障转移后）复制从属服务器上的并行提交事务的数量，因此可以增加复制从服务器上的并行执行。</font><font style="vertical-align: inherit;">为了从中受益，从服务器必须已
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_type"><code class="literal">slave_parallel_type=LOGICAL_CLOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置。</font><font style="vertical-align: inherit;">当您调整设置时，重要的是要考虑主设备的吞吐量和从设备的吞吐量
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            还可以减少</font></font><code class="literal">fsync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            任何具有二进制日志的服务器（主服务器或从服务器）对二进制日志</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">次数</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            请注意，该设置会
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            增加服务器上的事务延迟，这可能会影响客户端应用程序。</font><font style="vertical-align: inherit;">另外，对于高度并发的工作负载，延迟可能会增加争用并因此降低吞吐量。</font><font style="vertical-align: inherit;">通常，设置延迟的好处大于缺点，但应始终进行调整以确定最佳设置。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_group_commit_sync_no_delay_count"></a>
            <a class="indexterm" name="idm140528029486816"></a>

            <a class="indexterm" name="idm140528029485728"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_no_delay_count"><code class="literal">binlog_group_commit_sync_no_delay_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_group_commit_sync_no_delay_count"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-group-commit-sync-no-delay-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.5</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_no_delay_count">binlog_group_commit_sync_no_delay_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">1000000</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在中止当前延迟之前等待的最大事务数
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_group_commit_sync_delay"><code class="literal">binlog_group_commit_sync_delay</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置为0，则此选项无效。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlogging_impossible_mode"></a>
            <a class="indexterm" name="idm140528029445984"></a>

            <a class="indexterm" name="idm140528029444880"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlogging_impossible_mode"><code class="literal">binlogging_impossible_mode</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlogging_impossible_mode"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlogging-impossible-mode[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.5</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是（在5.7.6中删除）</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlogging_impossible_mode">binlogging_impossible_mode</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">IGNORE_ERROR</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">IGNORE_ERROR</code></p><p class="valid-value"><code class="literal">ABORT_SERVER</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL 5.7.6中删除了这个选项。</font><font style="vertical-align: inherit;">使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_error_action"><code class="literal">binlog_error_action</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来控制当服务器无法写入二进制日志中会发生什么。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_max_flush_queue_time"></a>
            <a class="indexterm" name="idm140528029405504"></a>

            <a class="indexterm" name="idm140528029404400"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_max_flush_queue_time"><code class="literal">binlog_max_flush_queue_time</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_max_flush_queue_time"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.9</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_max_flush_queue_time">binlog_max_flush_queue_time</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">100000</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以前，这会控制时间以微秒为单位继续从冲洗队列读取事务，然后再进行组提交。</font><font style="vertical-align: inherit;">在MySQL 5.7中，这个变量不再有任何作用。
          </font></font></p><p>
            <code class="literal">binlog_max_flush_queue_time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 从MySQL 5.7.9开始不推荐使用，并且标记为在未来的MySQL版本中最终删除。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_order_commits"></a>
            <a class="indexterm" name="idm140528029369088"></a>

            <a class="indexterm" name="idm140528029368048"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_order_commits"><code class="literal">binlog_order_commits</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_order_commits"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_order_commits">binlog_order_commits</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当在主服务器上启用此变量（缺省值）时，事务将按照与写入二进制日志相同的顺序进行外部化。</font><font style="vertical-align: inherit;">如果禁用，交易可能会并行提交。</font><font style="vertical-align: inherit;">在某些情况下，禁用此变量可能会产生性能增量。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_row_image"></a>
            <a class="indexterm" name="idm140528029342752"></a>

            <a class="indexterm" name="idm140528029341696"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_row_image"><code class="literal">binlog_row_image</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_row_image"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-row-image=image_type</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal">binlog_row_image=image_type</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">full</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">full</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （记录所有列）</font></font></p><p class="valid-value"><code class="literal">minimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （只记录更改的列，以及识别行所需的列）</font></font></p><p class="valid-value"><code class="literal">noblob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （记录所有列，不需要的BLOB和TEXT列除外）</font></font></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于基于MySQL的行复制，此变量确定如何将行图像写入二进制日志。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL基于行的复制中，每个行更改事件都包含两个图像，一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">before</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像，其列与搜索要更新的行时相匹配，另一个</font><font style="vertical-align: inherit;">包含更改</font><font style="vertical-align: inherit;">的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">after</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像。</font><font style="vertical-align: inherit;">通常情况下，MySQL会记录前后图像的完整行（即所有列）。</font><font style="vertical-align: inherit;">但是，并不是必须在两个图像中都包含每一列，而且我们通常可以通过仅记录那些实际需要的列来节省磁盘，内存和网络使用。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              删除一行时，只会记录之前的图像，因为在删除后没有更改的值要传播。</font><font style="vertical-align: inherit;">插入一行时，只有后面的图像被记录下来，因为没有现存的行要匹配。</font><font style="vertical-align: inherit;">只有在更新一行时，它们都是所需的前后图像，并且都写入二进制日志。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于之前的图像，只需要记录唯一标识行所需的最小列集。</font><font style="vertical-align: inherit;">如果包含该行的表具有主键，则只有主键列被写入二进制日志。</font><font style="vertical-align: inherit;">否则，如果表具有所有列都是唯一键的唯一键</font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则只需要记录唯一键中的列。</font><font style="vertical-align: inherit;">（如果表没有任何主键和没有任何</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的唯一键
             </font><font style="vertical-align: inherit;">，则所有列必须在之前的映像中使用，并记录下来。）在后图中，仅需记录实际更改的列。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以使服务器使用</font></font><code class="literal">binlog_row_image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">记录完整行或最小行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这个变量实际上取三个可能的值中的一个，如下面的列表所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">full</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：在前图像和后图像中记录所有列。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">minimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：仅记录前图像中标识要更改的行所需的那些列; </font><font style="vertical-align: inherit;">只记录后面图像中由SQL语句指定值或通过自动增量生成的那些列。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">noblob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：记录所有列（与之相同
                 </font></font><code class="literal">full</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），除了
                 </font><font style="vertical-align: inherit;">不需要识别行或不需要更改的列</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                 </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              NDB集群不支持此变量; </font><font style="vertical-align: inherit;">设置它对</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的记录没有影响
               </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认值是</font></font><code class="literal">full</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.5和更早版本中，全图像总是用于图像之前和之后的图像。</font><font style="vertical-align: inherit;">如果您需要从一个较新的主站复制到运行MySQL 5.5或更低版本的从站，则主站应始终使用此值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><code class="literal">minimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or时
             </font></font><code class="literal">noblob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果且仅当以下条件对源表和目标表均满足时，才能保证对给定表正确地进行删除和更新：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                所有栏目必须以相同的顺序出现; </font><font style="vertical-align: inherit;">每个列必须使用与其他表中的对应项相同的数据类型。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这些表必须具有相同的主键定义。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （换句话说，这些表必须与不属于表主键的索引的可能例外相同。）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果这些条件未得到满足，目标表中的主键列值可能不足以提供删除或更新的唯一匹配。</font><font style="vertical-align: inherit;">在这种情况下，不会发出警告或错误; </font><font style="vertical-align: inherit;">主人和奴隶默默地分歧，从而破坏了一致性。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            二进制日志格式为时，设置此变量不起作用</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
             </font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，设置为
             </font></font><code class="literal">binlog_row_image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于使用基于行的格式记录的变化，但这种设置上记录的语句变化没有影响。
          </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">binlog_row_image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在全局或会话级别</font><font style="vertical-align: inherit;">
            设置</font><font style="vertical-align: inherit;">不会导致隐式提交; </font><font style="vertical-align: inherit;">这意味着可以在事务处理过程中更改此变量而不影响事务处理。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_rows_query_log_events"></a>
            <a class="indexterm" name="idm140528029277472"></a>

            <a class="indexterm" name="idm140528029276368"></a>

            <code class="literal">binlog_rows_query_log_events</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_rows_query_log_events"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-rows-query-log-events</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_rows_query_log_events">binlog_rows_query_log_events</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_rows_query_log_events"><code class="literal">binlog_rows_query_log_events</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量只会影响基于行的日志记录。</font><font style="vertical-align: inherit;">启用时，它会导致MySQL服务器将信息日志事件（如行查询日志事件）写入其二进制日志中。</font><font style="vertical-align: inherit;">这些信息可用于调试和相关目的; </font><font style="vertical-align: inherit;">例如，当无法通过行更新重建时，获取主设备上发出的原始查询。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL程序读取二进制日志时通常会忽略这些事件，因此在复制或从备份还原时不会导致任何问题。</font><font style="vertical-align: inherit;">要查看它们，增加使用mysqlbinlog可以的详细级别
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_verbose"><code class="option">--verbose</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项两次，无论是作为</font></font><code class="option">-vv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="option">--verbose
            --verbose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_binlog_stmt_cache_size"></a>
            <a class="indexterm" name="idm140528029244496"></a>

            <a class="indexterm" name="idm140528029243456"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_stmt_cache_size"><code class="literal">binlog_stmt_cache_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_stmt_cache_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-stmt-cache-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_stmt_cache_size">binlog_stmt_cache_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">32768</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">32768</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（64位平台）</font></font></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（32位平台）</font></font></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此变量确定二进制日志的缓存大小，以保存事务期间发出的非事务性语句。</font><font style="vertical-align: inherit;">如果服务器支持任何事务性存储引擎并且服务器启用了二进制日志（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项），</font><font style="vertical-align: inherit;">则为每个客户端分配单独的二进制日志事务和语句高速缓存</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您在交易过程中经常使用大型非事务性语句，则可以增加此高速缓存大小以获得更好的性能。</font><font style="vertical-align: inherit;">这个
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Binlog_stmt_cache_use"><code class="literal">Binlog_stmt_cache_use</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Binlog_stmt_cache_disk_use"><code class="literal">Binlog_stmt_cache_disk_use</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            状态变量可以用来调整这个变量的大小。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_cache_size"><code class="literal">binlog_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量设置为事务高速缓存的大小。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_log_bin"></a>
            <a class="indexterm" name="idm140528029189360"></a>

            <a class="indexterm" name="idm140528029188320"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin"><code class="literal">log_bin</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log_bin"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin">log_bin</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            二进制日志是否启用。</font><font style="vertical-align: inherit;">如果使用该
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，则该变量的值为</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">否则是</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此变量仅报告二进制日志记录的状态（启用或禁用）; </font><font style="vertical-align: inherit;">它实际上并没有报告设置的值
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_log_bin_basename"></a>
            <a class="indexterm" name="idm140528029164560"></a>

            <a class="indexterm" name="idm140528029163504"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_basename"><code class="literal">log_bin_basename</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log_bin_basename"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_basename">log_bin_basename</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            保存二进制日志文件的基本名称和路径，可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器选项</font><font style="vertical-align: inherit;">进行设置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7中，默认的基本名称是带有后缀的主机名称
             </font></font><code class="literal">-bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认位置是数据目录。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_log_bin_index"></a>
            <a class="indexterm" name="idm140528029139664"></a>

            <a class="indexterm" name="idm140528029138608"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_index"><code class="literal">log_bin_index</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log_bin_index"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_index">log_bin_index</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            保存二进制日志索引文件的基本名称和路径，可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin-index"><code class="option">--log-bin-index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器选项</font><font style="vertical-align: inherit;">设置
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_log_bin_use_v1_row_events"></a>
            <a class="indexterm" name="idm140528029115552"></a>

            <a class="indexterm" name="idm140528029114448"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_use_v1_row_events"><code class="literal">log_bin_use_v1_row_events</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log_bin_use_v1_row_events"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-bin-use-v1-row-events[={0|1}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin_use_v1_row_events">log_bin_use_v1_row_events</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            显示版本2二进制日志记录是否正在使用中。</font><font style="vertical-align: inherit;">值为1表示服务器正在使用版本1日志记录事件（以前版本中使用的唯一版本的二进制日志事件）写入二进制日志，从而生成可由较旧的从属设备读取的二进制日志。</font><font style="vertical-align: inherit;">0表示版本2二进制日志事件正在使用中。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量是只读的。</font><font style="vertical-align: inherit;">要在版本1和版本2二进制事件二进制日志记录之间切换，需要</font><font style="vertical-align: inherit;">使用该
             </font><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">重新启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin-use-v1-row-events"><code class="option">--log-bin-use-v1-row-events</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            除了执行NDB群集复制升级时，</font></font><code class="option">--log-bin-use-v1-events</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在设置使用复制冲突检测和解决方案时主要感兴趣
             </font></font><code class="literal">NDB$EPOCH_TRANS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这需要版本2二进制行事件日志记录。</font><font style="vertical-align: inherit;">因此，这个选项
             </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html#option_mysqld_ndb-log-transaction-id"><code class="option">--ndb-log-transaction-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并不兼容。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL NDB Cluster 7.5默认使用版本2二进制日志行事件。</font><font style="vertical-align: inherit;">在规划升级或降级时以及使用NDB群集复制的设置时，应该保持这种心态。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-conflict-resolution" title="21.6.11 NDB群集复制冲突解决"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21.6.11节“NDB群集复制冲突解决”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_log_slave_updates"></a>
            <a class="indexterm" name="idm140528029078000"></a>

            <a class="indexterm" name="idm140528029076960"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slave_updates"><code class="literal">log_slave_updates</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log_slave_updates"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--log-slave-updates</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slave_updates">log_slave_updates</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是否应该将从服务器接收到的来自主服务器的更新记录到从服务器自己的二进制日志中。</font><font style="vertical-align: inherit;">必须在从站上启用二进制日志记录才能使此变量生效。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_log_statements_unsafe_for_binlog"></a>
            <a class="indexterm" name="idm140528029047936"></a>

            <a class="indexterm" name="idm140528029046832"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_statements_unsafe_for_binlog"><code class="literal">log_statements_unsafe_for_binlog</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for log_statements_unsafe_for_binlog"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.11</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_statements_unsafe_for_binlog">log_statements_unsafe_for_binlog</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果遇到错误1592，则控制是否将生成的警告添加到错误日志中。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_master_verify_checksum"></a>
            <a class="indexterm" name="idm140528029018944"></a>

            <a class="indexterm" name="idm140528029017904"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_verify_checksum"><code class="literal">master_verify_checksum</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for master_verify_checksum"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_verify_checksum">master_verify_checksum</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用此变量会导致主机在从二进制日志读取时检查校验和。
            </font></font><code class="literal">master_verify_checksum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认是禁用的; </font><font style="vertical-align: inherit;">在这种情况下，主服务器使用二进制日志中的事件长度来验证事件，以便只从二进制日志中读取完整事件。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_max_binlog_cache_size"></a>
            <a class="indexterm" name="idm140528028991888"></a>

            <a class="indexterm" name="idm140528028990848"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_cache_size"><code class="literal">max_binlog_cache_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for max_binlog_cache_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--max-binlog-cache-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_cache_size">max_binlog_cache_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">18446744073709551615</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">18446744073709551615</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果一个事务需要超过这么多字节的内存，那么服务器会生成一个</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多语句事务</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这个</font><span class="errortext"><font style="vertical-align: inherit;">事务所需的字节数超过了'max_binlog_cache_size'字节的存储</font></span><font style="vertical-align: inherit;">错误。</font><font style="vertical-align: inherit;">最小值是4096.最大可能值是16EB（兆字节）。</font><font style="vertical-align: inherit;">最大推荐值为4GB; </font><font style="vertical-align: inherit;">这是因为MySQL目前无法使用大于4GB的二进制日志位置。
          </font></font></p><p>
            <code class="literal">max_binlog_cache_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅设置事务高速缓存的大小; </font><font style="vertical-align: inherit;">语句高速缓存的上限由
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_stmt_cache_size"><code class="literal">max_binlog_stmt_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量控制。
          </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">max_binlog_cache_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_cache_size"><code class="literal">binlog_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">匹配的
             </font><font style="vertical-align: inherit;">
            会话的可见性
             </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">换句话说，更改其值只影响在值更改后启动的新会话。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_max_binlog_size"></a>
            <a class="indexterm" name="idm140528028950512"></a>

            <a class="indexterm" name="idm140528028949504"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_size"><code class="literal">max_binlog_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for max_binlog_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--max-binlog-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_size">max_binlog_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果写入二进制日志会导致当前日志文件大小超过此变量的值，则服务器将旋转二进制日志（关闭当前文件并打开下一个文件）。</font><font style="vertical-align: inherit;">最小值是4096字节。</font><font style="vertical-align: inherit;">最大值和默认值是1GB。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            事务被写入一个块到二进制日志中，所以它不会在多个二进制日志之间被拆分。</font><font style="vertical-align: inherit;">因此，如果您有大事务，则可能会看到大于</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_size"><code class="literal">max_binlog_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。的</font><font style="vertical-align: inherit;">二进制日志文件
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_relay_log_size"><code class="literal">max_relay_log_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0，则该值也
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_size"><code class="literal">max_binlog_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于中继日志。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_max_binlog_stmt_cache_size"></a>
            <a class="indexterm" name="idm140528028910112"></a>

            <a class="indexterm" name="idm140528028909008"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_stmt_cache_size"><code class="literal">max_binlog_stmt_cache_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for max_binlog_stmt_cache_size"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--max-binlog-stmt-cache-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_stmt_cache_size">max_binlog_stmt_cache_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">18446744073709547520</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">18446744073709547520</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果事务中的非事务性语句需要超过这么多字节的内存，则服务器会生成一个错误。</font><font style="vertical-align: inherit;">最小值为4096.最大值和默认值在32位平台上为4 GB，在64位平台上为16EB（EB）。
          </font></font></p><p>
            <code class="literal">max_binlog_stmt_cache_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅设置语句高速缓存的大小; </font><font style="vertical-align: inherit;">事务高速缓存的上限仅由
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_cache_size"><code class="literal">max_binlog_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量管理。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_sync_binlog"></a>
            <a class="indexterm" name="idm140528028871760"></a>

            <a class="indexterm" name="idm140528028870752"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for sync_binlog"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--sync-binlog=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog">sync_binlog</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.6）</font></font></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制在将二进制日志同步到磁盘之前要收集的二进制日志提交组的数量。</font><font style="vertical-align: inherit;">当
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制日志永远不会同步到磁盘，并且何时
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为大于0的值时，此二进制日志落实组的数目会定期同步到磁盘。</font><font style="vertical-align: inherit;">什么时候
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所有事务在提交之前都会同步到二进制日志。</font><font style="vertical-align: inherit;">因此，即使在意外重启的情况下，二进制日志中缺失的任何事务也只处于准备状态。</font><font style="vertical-align: inherit;">这会导致服务器的自动恢复例程回滚这些事务。</font><font style="vertical-align: inherit;">这保证了二进制日志中没有事务丢失，并且是最安全的选项。</font><font style="vertical-align: inherit;">但是，由于磁盘写入次数增加，这可能会对性能产生负面影响。</font><font style="vertical-align: inherit;">使用更高的值可以提高性能，但会增加数据丢失的风险。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于1时，事务将被提交而未被同步到磁盘。</font><font style="vertical-align: inherit;">因此，在发生电源故障或操作系统崩溃的情况下，服务器可能会提交一些尚未同步到二进制日志的事务。</font><font style="vertical-align: inherit;">因此恢复例程不可能恢复这些事务，它们将从二进制日志中丢失。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.7之前，默认值为
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0，它配置为不同步到磁盘 - 在这种情况下，服务器依赖于操作系统随时刷新二进制日志的内容，就像任何其他文件一样。</font><font style="vertical-align: inherit;">MySQL 5.7.7和更高版本使用默认值1，这是最安全的选择，但如上所述可能会影响性能。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-options-gtids"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.6.5全局事务ID选项和变量</font></font></h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-optvars-gtids" title="用于GTID复制的启动选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于GTID复制的启动选项</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-sysvars-gtids" title="与GTID复制一起使用的系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与GTID复制一起使用的系统变量</font></font></a></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍的MySQL服务器选项和系统变量用于监视和控制全局事务标识符（GTID）。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关更多信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3节“使用全局事务标识符进行复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="replication-optvars-gtids"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于GTID复制的启动选项</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下服务器启动选项与基于GTID的复制一起使用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_enforce-gtid-consistency"></a>
            <a class="indexterm" name="idm140528028815200"></a>

            <a class="indexterm" name="idm140528028814144"></a>

            <code class="option">--enforce-gtid-consistency</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for enforce-gtid-consistency"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--enforce-gtid-consistency[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency">enforce_gtid_consistency</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><code class="literal">OFF</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><code class="literal">false</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">WARN</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用后，服务器通过只允许执行可以使用GTID安全记录的语句来强制执行GTID一致性。</font><font style="vertical-align: inherit;">您</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启用基于GTID的复制之前</font><font style="vertical-align: inherit;">将此选项设置为</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以配置</font><font style="vertical-align: inherit;">
            的值
             </font><font style="vertical-align: inherit;">是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：所有交易都被允许违反GTID一致性。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：不允许交易违反GTID一致性。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">WARN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：所有交易都被允许违反GTID一致性，但在这种情况下会生成警告。</font></font><code class="literal">WARN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被添加到MySQL 5.7.6。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            没有值的</font><font style="vertical-align: inherit;">
            设置
             </font><font style="vertical-align: inherit;">是别名
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这会影响变量的行为，请参阅
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            只有在</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为</font><font style="vertical-align: inherit;">可以记录时才能记录使用GTID安全语句的语句
             </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此此处列出的操作不能用于此选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
                TABLE ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 声明
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
                TEMPORARY TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP
                TEMPORARY TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易中的报表
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                同时更新事务性和非事务性表的事务或语句。</font><font style="vertical-align: inherit;">如果所有</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非事务性</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表都是临时性的</font><font style="vertical-align: inherit;">，则在事务中或与事务性DML相同的语句中允许非事务性DML是个例外
                 </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            只有在二进制日志记录发生时才会生效。</font><font style="vertical-align: inherit;">如果在服务器上禁用了二进制日志记录，或者由于语句被过滤器删除而未将语句写入二进制日志，则未检查或强制执行未记录的语句的GTID一致性。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-restrictions" title="16.1.3.4使用GTID复制的限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.4节“使用GTID复制的限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_executed-gtids-compression-period"></a>
            <a class="indexterm" name="idm140528028746496"></a>

            <a class="indexterm" name="idm140528028745456"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_executed-gtids-compression-period"><code class="option">--executed-gtids-compression-period</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for executed-gtids-compression-period"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--executed-gtids-compression-period=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.5</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.6</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项已弃用，将在未来的MySQL版本中删除。</font><font style="vertical-align: inherit;">使用重命名的gtid_executed_compression_period来控制gtid_executed表的压缩方式。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_gtid-mode"></a>
            <a class="indexterm" name="idm140528028714848"></a>

            <a class="indexterm" name="idm140528028713792"></a>

            <code class="option">--gtid-mode</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for gtid-mode"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--gtid-mode=MODE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode">gtid_mode</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">OFF_PERMISSIVE</code></p><p class="valid-value"><code class="literal">ON_PERMISSIVE</code></p><p class="valid-value"><code class="literal">ON</code></p></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">UPGRADE_STEP_1</code></p><p class="valid-value"><code class="literal">UPGRADE_STEP_2</code></p><p class="valid-value"><code class="literal">ON</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项指定是否使用全局事务标识符（GTID）来标识事务。</font><font style="vertical-align: inherit;">设置此选项</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_gtid-mode"><code class="option">--gtid-mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            需要
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7.6之前</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，此选项控制</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">变量只能在服务器启动时设置。</font><font style="vertical-align: inherit;">在MySQL 5.7.6及更高版本中，该
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量是动态的，并且可以在线配置基于GTID的复制。</font><font style="vertical-align: inherit;">在使用此功能之前，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online" title="16.1.5更改联机服务器上的复制模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.5节“更改联机服务器上的复制模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在此之前的MySQL 5.7.5，在启动服务器
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_gtid-mode"><code class="option">--gtid-mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需的服务器也可以用开始
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，选项。</font><font style="vertical-align: inherit;">在MySQL 5.7.5及更高版本中，这不是必需的。</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-gtid-executed-table" title="mysql.gtid_executed表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql.gtid_executed表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="option_mysqld_gtid-executed-compression-period"></a>
            <a class="indexterm" name="idm140528028659920"></a>

            <a class="indexterm" name="idm140528028658880"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_gtid-executed-compression-period"><code class="option">--gtid-executed-compression-period
            </code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for gtid-executed-compression-period"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--gtid-executed-compression-period=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.6</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次发生这么多事务时</font><font style="vertical-align: inherit;">
            压缩</font><font style="vertical-align: inherit;">表格。</font><font style="vertical-align: inherit;">设置为0意味着该表未被压缩。</font><font style="vertical-align: inherit;">在启用二进制日志记录时不会对表进行压缩，因此该选项除非</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin"><code class="literal">log_bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是，
             </font><font style="vertical-align: inherit;">否则不起作用
             </font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            看到
            </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-gtid-executed-table-compression" title="mysql.gtid_executed表压缩"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多信息，</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-gtid-executed-table-compression" title="mysql.gtid_executed表压缩"><font style="vertical-align: inherit;"> mysql.gtid_executed表压缩</font></a><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.5版本中，这个变量被添加为
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_executed_gtids_compression_period"><code class="literal">executed_gtids_compression_period</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL版本5.7.6，并被重命名为
             </font></font><code class="literal">gtid_executed_compression_period</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="replication-sysvars-gtids"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与GTID复制一起使用的系统变量</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下系统变量用于基于GTID的复制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_binlog_gtid_simple_recovery"></a>
            <a class="indexterm" name="idm140528028622304"></a>

            <a class="indexterm" name="idm140528028621264"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for binlog_gtid_simple_recovery"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--binlog-gtid-simple-recovery</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.6</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery">binlog_gtid_simple_recovery</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><code class="literal">TRUE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.6）</font></font></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个变量控制在MySQL启动或重新启动时在搜索GTID期间如何迭代二进制日志文件。</font><font style="vertical-align: inherit;">在MySQL 5.7.5版本中，这个变量被添加为
             </font></font><code class="literal">simplified_binlog_gtid_recovery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL版本5.7.6，并被重命名为
            </font></font><code class="literal">binlog_gtid_simple_recovery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            何时
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery=FALSE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迭代二进制日志文件的方法是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为了初始化
                 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，二进制日志文件从最新的文件迭代，在第一个二进制日志中停止
                 </font></font><code class="literal">Previous_gtids_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从此二进制日志文件读取</font><font style="vertical-align: inherit;">所有GTID </font></font><code class="literal">Previous_gtids_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
                 </font><font style="vertical-align: inherit;">从中</font></font><code class="literal">Gtid_log_events</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取。</font><font style="vertical-align: inherit;">这个GTID集合存储在内部并被调用</font></font><code class="literal">gtids_in_binlog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">值的
                 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算方法是该集合与存储在GTID中的GTID的并集</font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格中</font><font style="vertical-align: inherit;">。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果您有大量没有GTID事件的二进制日志文件（例如，创建时），则此过程可能需要很长时间
                 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要初始化
                 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，二进制日志文件从最旧到最新迭代，在包含</font></font><code class="literal">Previous_gtids_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非空（至少有一个GTID）或至少有一个的非空</font><font style="vertical-align: inherit;">第一个二进制日志处停止
                 </font></font><code class="literal">Gtid_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从这个二进制日志中读取
                 </font></font><code class="literal">Previous_gtids_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该GTID集合从</font></font><code class="literal">gtids_in_binlog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在内部变量中的结果和结果中
                 </font><font style="vertical-align: inherit;">减去
                 </font></font><code class="literal">gtids_in_binlog_not_purged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该值</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化为</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，减号
                 </font><font style="vertical-align: inherit;">的值
                 </font></font><code class="literal">gtids_in_binlog_not_purged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            何时
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery=TRUE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是MySQL 5.7.7及更高版本中的默认设置，服务器只迭代最旧和最新的二进制日志文件，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并且</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅根据</font><font style="vertical-align: inherit;">这些文件</font></font><code class="literal">Previous_gtids_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">Gtid_log_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这些文件中找到</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">计算
             </font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可以确保在服务器重新启动或清除二进制日志时，只会重复使用两个二进制日志文件。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果启用此选项，
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下情况下可能会被错误地初始化：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  是由MySQL 5.7.5或以上产生的最新的二进制日志，并</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  为</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些二进制日志，但
                   </font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在最新的二进制日志。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  一个</font></font><code class="literal">SET GTID_PURGED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明是在5.7.7之前的MySQL版本上发布的，并且在这个时候活动的二进制日志
                   </font></font><code class="literal">SET GTID_PURGED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还没有被清除。


</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果在任何情况下都计算了不正确的GTID集合，即使稍后重新启动服务器，它也将保持不正确，无论此选项的值如何。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="sysvar_enforce_gtid_consistency"></a>
            <a class="indexterm" name="idm140528028548160"></a>

            <a class="indexterm" name="idm140528028547056"></a>

            <code class="literal">enforce_gtid_consistency</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for enforce_gtid_consistency"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--enforce-gtid-consistency[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency">enforce_gtid_consistency</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><code class="literal">OFF</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><code class="literal">false</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">WARN</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            根据此变量的值，服务器通过只允许执行可以使用GTID安全记录的语句来强制执行GTID一致性。</font><font style="vertical-align: inherit;">在启用基于GTID的复制之前，</font><font style="vertical-align: inherit;">您
             </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将此变量设置为
             </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以配置</font><font style="vertical-align: inherit;">
            的值
             </font><font style="vertical-align: inherit;">是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：所有交易都被允许违反GTID一致性。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：不允许交易违反GTID一致性。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">WARN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：所有交易都被允许违反GTID一致性，但在这种情况下会生成警告。</font></font><code class="literal">WARN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被添加到MySQL 5.7.6。
</font></font></p></li></ul>
</div>
<p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            只有在二进制日志记录发生时才会生效。</font><font style="vertical-align: inherit;">如果在服务器上禁用了二进制日志记录，或者由于语句被过滤器删除而未将语句写入二进制日志，则未检查或强制执行未记录的语句的GTID一致性。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关可以使用基于GTID的复制记录的语句的更多信息，请参阅
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.6之前，布尔默
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            认为</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了保持与以前版本的兼容性，在MySQL 5.7.6中，枚举默认为</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_enforce-gtid-consistency"><code class="option">--enforce-gtid-consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            没有值的设置被解释为将值设置为
             </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">变量也有价值观的多个文本别名：
             </font></font><code class="literal">0=OFF=FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">1=ON=TRUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">2=WARN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这与其他枚举类型不同，但与以前版本中使用的布尔类型保持兼容。</font><font style="vertical-align: inherit;">这些更改会影响变量返回的内容。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">SELECT
            @@ENFORCE_GTID_CONSISTENCY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">SHOW
            VARIABLES LIKE 'ENFORCE_GTID_CONSISTENCY'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
            </font></font><code class="literal">SELECT * FROM INFORMATION_SCHEMA.VARIABLES WHERE
            'VARIABLE_NAME' = 'ENFORCE_GTID_CONSISTENCY'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都返回文本格式，而不是数字格式。</font><font style="vertical-align: inherit;">这是一个不兼容的变化，因为
             </font></font><code class="literal">@@ENFORCE_GTID_CONSISTENCY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回布尔值的数字形式，但返回</font></font><code class="literal">SHOW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息模式</font><font style="vertical-align: inherit;">的文本形式
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_executed_gtids_compression_period"></a>
            <a class="indexterm" name="idm140528028480544"></a>

            <a class="indexterm" name="idm140528028479504"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_executed_gtids_compression_period"><code class="literal">executed_gtids_compression_period</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for executed_gtids_compression_period"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.5</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.6</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.5）</font></font></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_executed_gtids_compression_period">executed_gtids_compression_period</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项已弃用，将在未来的MySQL版本中删除。</font><font style="vertical-align: inherit;">使用重命名
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed_compression_period"><code class="literal">gtid_executed_compression_period</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            来控制</font></font><code class="literal">gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格的压缩方式。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_gtid_executed"></a>
            <a class="indexterm" name="idm140528028440192"></a>

            <a class="indexterm" name="idm140528028439136"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for gtid_executed"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed">gtid_executed</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed">gtid_executed</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.7）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与全局作用域一起使用时，此变量包含服务器上执行的所有事务的集合表示，以及由</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">设置的GTID
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是相同的值
             </font><font style="vertical-align: inherit;">列在的输出
             </font><font style="vertical-align: inherit;">和
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此变量的值是GTID集，请参阅
             </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-concepts-gtid-sets" title="GTID集"><font style="vertical-align: inherit;">GTID集</font></a><font style="vertical-align: inherit;">以获取更多信息。
          </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"></font><code class="literal">Executed_Gtid_Set</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS语法"><code class="literal">SHOW MASTER STATUS</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-concepts-gtid-sets" title="GTID集"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当服务器启动时，
             </font></font><code class="literal">@@global.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被初始化。</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关如何迭代二进制日志以填充的更多信息</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">随着事务的执行，或者任何</font><font style="vertical-align: inherit;">语句被执行</font><font style="vertical-align: inherit;">，GTID被添加到集合中
             </font><font style="vertical-align: inherit;">。
          </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在任何给定时间可以在二进制日志中找到的一组事务等于
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_gtid-subtract"><code class="literal">GTID_SUBTRACT(@@global.gtid_executed,
            @@global.gtid_purged)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">也就是说，二进制日志中尚未清除的所有事务。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            发布会</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-master" title="13.4.1.2 RESET MASTER语法"><code class="literal">RESET MASTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致将此变量的全局值（但不是会话值）重置为空字符串。</font><font style="vertical-align: inherit;">GTID不会从该组中除去，除非该组由于被清除</font></font><code class="literal">RESET MASTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.7之前，这个变量也可以用于会话范围，它包含了一组表示在当前会话中写入缓存的事务。</font><font style="vertical-align: inherit;">会话范围在MySQL 5.7.7中已被弃用。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_gtid_executed_compression_period"></a>
            <a class="indexterm" name="idm140528028389600"></a>

            <a class="indexterm" name="idm140528028388560"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed_compression_period"><code class="literal">gtid_executed_compression_period</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for gtid_executed_compression_period"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.6</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed_compression_period">gtid_executed_compression_period</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低限度</font></font></strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font></strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            压缩 </font></font><code class="literal">mysql.gtid_executed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次处理这些许多事务时</font><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">设置为0意味着该表未被压缩。</font><font style="vertical-align: inherit;">由于在使用二进制日志时不会对表进行压缩，因此除非禁用二进制日志记录，否则设置变量的值不起作用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关</font><font style="vertical-align: inherit;">更多信息，</font><font style="vertical-align: inherit;">请参阅
            </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-gtid-executed-table-compression" title="mysql.gtid_executed表压缩"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mysql.gtid_executed表压缩</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.5版本中，这个变量被添加为
             </font></font><code class="literal">executed_gtids_compression_period</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL版本5.7.6，并被重命名为
             </font></font><code class="literal">gtid_executed_compression_period</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_gtid_mode"></a>
            <a class="indexterm" name="idm140528028349840"></a>

            <a class="indexterm" name="idm140528028348784"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for gtid_mode"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode">gtid_mode</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">OFF</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&gt; = 5.7.6）</font></font></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">OFF_PERMISSIVE</code></p><p class="valid-value"><code class="literal">ON_PERMISSIVE</code></p><p class="valid-value"><code class="literal">ON</code></p></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（&lt;= 5.7.5）</font></font></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">UPGRADE_STEP_1</code></p><p class="valid-value"><code class="literal">UPGRADE_STEP_2</code></p><p class="valid-value"><code class="literal">ON</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制是否启用基于GTID的日志记录以及日志可以包含哪些类型的事务。</font><font style="vertical-align: inherit;">在MySQL 5.7.6之前，这个变量是只读的，并且仅使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_gtid-mode"><code class="option">--gtid-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">设置
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQL 5.7.6使这个变量可以动态设置。</font><font style="vertical-align: inherit;">您必须有权</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置此变量。
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_enforce_gtid_consistency"><code class="literal">enforce_gtid_consistency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            必须是真的，然后才能设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">修改此变量之前，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online" title="16.1.5更改联机服务器上的复制模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.5节“更改联机服务器上的复制模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.6及更高版本中记录的事务可以是匿名的，也可以使用GTID。</font><font style="vertical-align: inherit;">匿名交易依赖于二进制日志文件和位置来识别特定事务。</font><font style="vertical-align: inherit;">GTID事务具有用于引用事务的唯一标识符。</font><font style="vertical-align: inherit;">该
             </font></font><code class="literal">OFF_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">ON_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL 5.7.6添加模式允许在拓扑这些交易类型的混合。</font><font style="vertical-align: inherit;">现在有不同的模式：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：新的和复制的交易都必须是匿名的。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">OFF_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：新交易是匿名的。</font><font style="vertical-align: inherit;">复制的交易可以是匿名或GTID交易。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">ON_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：新交易是GTID交易。</font><font style="vertical-align: inherit;">复制的交易可以是匿名或GTID交易。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：新的和复制的交易都必须是GTID交易。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从一个值到另一个值的变化只能是一次一个步骤。</font><font style="vertical-align: inherit;">例如，如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前设置为</font></font><code class="literal">OFF_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则可以更改为</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">ON_PERMISSIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可以
             </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.6和更高的价值
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有持续不论价值
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，即使在更改值后
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这些变量也包含正确的值。</font><font style="vertical-align: inherit;">在MySQL 5.7.5及更早版本的价值观</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不持久的，而
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，更改</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为
             </font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦所有包含GTID的二进制日志都被清除后，这些变量的值就会丢失。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_gtid_next"></a>
            <a class="indexterm" name="idm140528028277088"></a>

            <a class="indexterm" name="idm140528028276032"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next"><code class="literal">gtid_next</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for gtid_next"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next">gtid_next</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">AUTOMATIC</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效值</font></font></strong></span></td>
<td><p class="valid-value"><code class="literal">AUTOMATIC</code></p><p class="valid-value"><code class="literal">ANONYMOUS</code></p><p class="valid-value"><code class="literal">UUID:NUMBER</code></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该变量用于指定是否以及如何获取下一个GTID。</font></font><code class="literal">gtid_next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以采取以下任何值：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">AUTOMATIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：使用下一个自动生成的全局事务ID。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">ANONYMOUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：事务不具有全局标识符，并且仅由文件和位置标识。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                全球交易ID
                 </font><font style="vertical-align: inherit;">
                格式
 </font></font><em class="replaceable"><code>UUID</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><em class="replaceable"><code>NUMBER</code></em><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            具体哪些选项是有效的取决于设置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">
            有关更多信息</font><font style="vertical-align: inherit;">，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-mode-change-online-concepts" title="16.1.5.1复制模式概念"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.5.1节“复制模式概念”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果设置该变量没有效果
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
             </font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在将此变量设置为
             </font></font><em class="replaceable"><code>UUID</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><em class="replaceable"><code>NUMBER</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且事务已提交或回滚之后，</font></font><code class="literal">SET GTID_NEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在任何其他语句之前再次发出</font><font style="vertical-align: inherit;">明确的</font><font style="vertical-align: inherit;">语句。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.5和更高版本中，</font></font><code class="literal">DROP TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
             </font></font><code class="literal">DROP TEMPORARY TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在临时表与临时表的组合使用时出现明显错误，或者使用事务存储引擎与临时表使用非事务存储引擎的临时表时出现错误。</font><font style="vertical-align: inherit;">在此之前的MySQL 5.7.5，当GTIDs被启用，但</font></font><code class="literal">gtid_next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有
             </font></font><code class="literal">AUTOMATIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有正确与任一表的这些组合使用时的工作。</font><font style="vertical-align: inherit;">（错误＃17620053）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.1，你不能执行任何语句
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-server" title="13.1.7 ALTER SERVER语法"><code class="literal">ALTER SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-server" title="13.1.28 DROP SERVER语法"><code class="literal">DROP SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#cache-index" title="13.7.6.2 CACHE INDEX语法"><code class="literal">CACHE INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-index" title="13.7.6.5 LOAD INDEX INTO CACHE语法"><code class="literal">LOAD INDEX INTO
            CACHE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush" title="13.7.6.3 FLUSH语法"><code class="literal">FLUSH</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset" title="13.7.6.6 RESET语法"><code class="literal">RESET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_next"><code class="literal">gtid_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被设置为任意值比其他</font></font><code class="literal">AUTOMATIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在这种情况下，声明失败并报错。</font><font style="vertical-align: inherit;">这些语句</font><font style="vertical-align: inherit;">在MySQL 5.7.2及更高版本</font><font style="vertical-align: inherit;">中</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不被</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁止。</font><font style="vertical-align: inherit;">（错误＃16062608，错误＃16715809，错误＃69045）（错误＃16062608）
          </font></font></p></li><li class="listitem"><p><a name="sysvar_gtid_owned"></a>
            <a class="indexterm" name="idm140528028207600"></a>

            <a class="indexterm" name="idm140528028206544"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_owned"><code class="literal">gtid_owned</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for gtid_owned"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_owned">gtid_owned</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球，会议</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此只读变量包含一个列表，其内容取决于其范围。</font><font style="vertical-align: inherit;">与会话范围一起使用时，该列表包含此客户端拥有的所有GTID; </font><font style="vertical-align: inherit;">当与全球范围一起使用时，它将包含所有GTID及其所有者的列表。
          </font></font></p></li><li class="listitem"><p><a name="sysvar_gtid_purged"></a>
            <a class="indexterm" name="idm140528028184416"></a>

            <a class="indexterm" name="idm140528028183360"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for gtid_purged"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged">gtid_purged</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">串</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从二进制日志中清除的所有事务的集合。</font><font style="vertical-align: inherit;">这是一组交易中的一个子集
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此变量的值是GTID集，请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-concepts-gtid-sets" title="GTID集"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GTID集</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取更多信息。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当服务器启动时，全局值
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被初始化为一组GTID。</font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关如何迭代二进制日志以填充的更多信息</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">发布会</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-master" title="13.4.1.2 RESET MASTER语法"><code class="literal">RESET MASTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致将此变量的值重置为空字符串。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以更新此变量的值，但仅当</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空字符串时，因此
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空字符串。</font><font style="vertical-align: inherit;">这可能发生在先前未启动复制时，或者复制先前未使用GTID时。</font><font style="vertical-align: inherit;">在MySQL 5.7.6之前，这个变量只能在设置时才能设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7.6和更高版本中，无论值为什么，该变量都是可设置的</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果所有现有的二进制日志都是使用MySQL 5.7.6或更高版本生成的，那么在发布</font></font><code class="literal">SET gtid_purged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句之后
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery=TRUE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （MySQL 5.7.7及更高版本中的默认设置）可以安全地使用。</font><font style="vertical-align: inherit;">如果存在来自MySQL 5.7.7或更早版本的二进制日志，则有
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能计算错误。</font><font style="vertical-align: inherit;">查看
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            更多信息。</font><font style="vertical-align: inherit;">如果您使用的是MySQL 5.7.7或更早版本，则在发出</font></font><code class="literal">SET gtid_purged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句后记下当前的二进制日志文件名称，可以使用该命令进行检查</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS语法"><code class="literal">SHOW MASTER
            STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果在清除此文件之前重新启动服务器，则应该使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery=FALSE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以避免</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_purged"><code class="literal">gtid_purged</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_executed"><code class="literal">gtid_executed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算错误。
          </font></font></p><p></p></li><li class="listitem"><p><a name="sysvar_simplified_binlog_gtid_recovery"></a>
            <a class="indexterm" name="idm140528028136288"></a>

            <a class="indexterm" name="idm140528028135248"></a>

            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_simplified_binlog_gtid_recovery"><code class="literal">simplified_binlog_gtid_recovery</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for simplified_binlog_gtid_recovery"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行格式</font></font></strong></span></td>
<td><code class="literal">--simplified-binlog-gtid-recovery</code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.5</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.7.6</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></strong></span></td>
<td><code class="literal"><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_simplified_binlog_gtid_recovery">simplified_binlog_gtid_recovery</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">布尔</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></strong></span></td>
<td><code class="literal">FALSE</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此选项已弃用，将在未来的MySQL版本中删除。</font><font style="vertical-align: inherit;">使用重命名
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_gtid_simple_recovery"><code class="literal">binlog_gtid_simple_recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            来控制MySQL在崩溃后如何迭代二进制日志文件。
</font></font></p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-administration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.7常用复制管理任务</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-administration-status"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.7.1检查复制状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-administration-pausing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.7.2在从站上暂停复制</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一旦复制已经开始，它就会执行而不需要太多的定期管理。</font><font style="vertical-align: inherit;">本节介绍如何检查复制状态以及如何暂停从属设备。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-administration-status"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.7.1检查复制状态</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        管理复制过程最常见的任务是确保正在进行复制，并且从站和主站之间没有错误。
      </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您必须在每个从站上执行</font><font style="vertical-align: inherit;">
        的</font><font style="vertical-align: inherit;">声明提供有关从站服务器和主站服务器之间连接的配置和状态的信息。</font><font style="vertical-align: inherit;">从MySQL 5.7起，性能模式具有复制表，以更易访问的形式提供这些信息。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-replication-tables" title="25.11.11性能模式复制表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.11节“性能架构复制表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明还提供了专门涉及复制奴隶的一些信息。</font><font style="vertical-align: inherit;">从MySQL 5.7.5版开始，以前使用的以下状态变量</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已被弃用，并被移至性能架构复制表中：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_retried_transactions"><code class="literal">Slave_retried_transactions</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_last_heartbeat"><code class="literal">Slave_last_heartbeat</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_received_heartbeats"><code class="literal">Slave_received_heartbeats</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_heartbeat_period"><code class="literal">Slave_heartbeat_period</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_running"><code class="literal">Slave_running</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        Performance Schema复制表中显示的复制心跳信息使您可以检查复制连接是否处于活动状态，即使主站最近尚未将事件发送到从站。</font><font style="vertical-align: inherit;">如果二进制日志中没有更新并且没有未发送事件，则主设备会向从设备发送心跳信号，其周期长于心跳间隔。</font><font style="vertical-align: inherit;">该
         </font></font><code class="literal">MASTER_HEARTBEAT_PERIOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主（由所设置的设置</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
        TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句）指定心跳的频率，默认为用于从属连接超时间隔的一半（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_net_timeout"><code class="literal">slave_net_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">该
        </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#replication-connection-status-table" title="25.11.11.2 replication_connection_status表"><code class="literal">replication_connection_status</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        性能架构表显示复制从器件收到最近一次心跳信号的时间，以及接收到的心跳信号数量。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您正在使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来检查单个从站的状态，则该语句将提供以下信息：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW SLAVE STATUS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               Slave_IO_State：等待主控发送事件</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  Master_Host：master1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  Master_User：根</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  Master_Port：3306</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Connect_Retry：60</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Master_Log_File：mysql-bin.000004</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Read_Master_Log_Pos：931</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               Relay_Log_File：slave1-relay-bin.000056</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Relay_Log_Pos：950</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        Relay_Master_Log_File：mysql-bin.000004</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             Slave_IO_Running：是的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            Slave_SQL_Running：是的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Replicate_Do_DB：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Replicate_Ignore_DB：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           Replicate_Do_Table：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Replicate_Ignore_Table：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      Replicate_Wild_Do_Table：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Replicate_Wild_Ignore_Table：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                   Last_Errno：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                   Last_Error：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 Skip_Counter：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Exec_Master_Log_Pos：931</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Relay_Log_Space：1365</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Until_Condition：无</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               Until_Log_File：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Until_Log_Pos：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           Master_SSL_Allowed：否</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           Master_SSL_CA_File：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           Master_SSL_CA_Path：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Master_SSL_Cert：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            Master_SSL_Cipher：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               Master_SSL_Key：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        Seconds_Behind_Master：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Master_SSL_Verify_Server_Cert：没有</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Last_IO_Errno：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Last_IO_Error：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               Last_SQL_Errno：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               Last_SQL_Error：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Replicate_Ignore_Server_Ids：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从状态报告到检查的关键字段是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Slave_IO_State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：从站的当前状态。</font><font style="vertical-align: inherit;">有关更多</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#slave-io-thread-states" title="8.14.5复制从属I / O线程状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#slave-io-thread-states" title="8.14.5复制从属I / O线程状态"><font style="vertical-align: inherit;">第8.14.5节“复制从I / O线程状态”</font></a><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#slave-sql-thread-states" title="8.14.6复制从SQL SQL线程状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.14.6节“复制从SQL SQL线程状态”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">Slave_IO_Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用于读取主站二进制日志的I / O线程是否正在运行。</font><font style="vertical-align: inherit;">通常情况下，你希望这是</font></font><code class="literal">Yes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除非你还没有开始复制或明确地停止它</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">Slave_SQL_Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：是否在中继日志中执行事件的SQL线程正在运行。</font><font style="vertical-align: inherit;">和I / O线程一样，这通常应该是
             </font></font><code class="literal">Yes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">Last_IO_Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">Last_SQL_Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：处理中继日志时由I / O和SQL线程注册的最后一个错误。</font><font style="vertical-align: inherit;">理想情况下，这些应该是空白的，表明没有错误。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">Seconds_Behind_Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：从属SQL线程处理主二进制日志后的秒数。</font><font style="vertical-align: inherit;">高数字（或增加的数字）可以表明从机无法及时处理来自主机的事件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            0的值</font></font><code class="literal">Seconds_Behind_Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常可以解释为奴隶已经赶上了主人，但在某些情况下，这并非严格对待。</font><font style="vertical-align: inherit;">例如，如果主站和从站之间的网络连接中断，但从站I / O线程尚未注意到这种情况（即</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_net_timeout"><code class="literal">slave_net_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尚未过去</font><font style="vertical-align: inherit;">），</font><font style="vertical-align: inherit;">则</font><font style="vertical-align: inherit;">可能发生这种情况</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            暂态值
             </font></font><code class="literal">Seconds_Behind_Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可能不能准确反映情况。</font><font style="vertical-align: inherit;">当从属SQL线程赶上I / O时，</font></font><code class="literal">Seconds_Behind_Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示0; </font><font style="vertical-align: inherit;">但是当从属I / O线程仍在排队新事件时，</font></font><code class="literal">Seconds_Behind_Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会显示一个较大的值，直到SQL线程完成执行新事件。</font><font style="vertical-align: inherit;">当事件具有旧时间戳时，这尤其可能; </font><font style="vertical-align: inherit;">在这种情况下，如果您</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在相对较短的时间内</font><font style="vertical-align: inherit;">执行
             </font><font style="vertical-align: inherit;">多次，您可能会看到此值在0和相对较大的值之间反复来回变化。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        几对字段提供有关从主二进制日志中读取事件并在中继日志中处理它们的从属进程的信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （</font></font><code class="literal">Master_Log_file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">Read_Master_Log_Pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：在主二进制日志中进行坐标指示从I / O线程已从该日志读取事件的距离。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （</font></font><code class="literal">Relay_Master_Log_File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">Exec_Master_Log_Pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：在主二进制日志中进行坐标，指示从属SQL线程执行从该日志接收到的事件的距离。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （</font></font><code class="literal">Relay_Log_File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">Relay_Log_Pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：在从站中继日志中进行坐标指示从站SQL线程执行中继日志的距离。</font><font style="vertical-align: inherit;">这些对应于前面的坐标，但用从属中继日志坐标而不是主要二进制日志坐标表示。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在主站上，您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查正在运行的进程列表来检查</font><font style="vertical-align: inherit;">连接的从站的状态</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从站连接
         </font></font><code class="literal">Binlog Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">Command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        现场：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW PROCESSLIST \G;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 4. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Id：10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   用户：root</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   主机：slave1：58371</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     db：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令：Binlog转储</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   时间：777</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  状态：已将所有binlog发送给从属; </font><font style="vertical-align: inherit;">等待binlog被更新</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   信息：NULL</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        因为它是推动复制过程的奴隶，所以本报告中的信息非常少。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于以</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-host"><code class="option">--report-host</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选件</font><font style="vertical-align: inherit;">启动</font><font style="vertical-align: inherit;">并连接到主</font><font style="vertical-align: inherit;">站的从站，
         </font><font style="vertical-align: inherit;">主站上的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-hosts" title="13.7.5.33 SHOW SLAVE HOSTS语法"><code class="literal">SHOW SLAVE
        HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句显示有关从站的基本信息。</font><font style="vertical-align: inherit;">输出包括从服务器的ID，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_report-host"><code class="option">--report-host</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">，连接端口和主ID：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW SLAVE HOSTS;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- + -------- + ------ + ------------------- +  - ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Server_id | </font><font style="vertical-align: inherit;">主机| </font><font style="vertical-align: inherit;">端口| </font><font style="vertical-align: inherit;">Rpl_recovery_rank | </font><font style="vertical-align: inherit;">Master_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- + -------- + ------ + ------------------- +  - ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">slave1 | </font><font style="vertical-align: inherit;">3306 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------- + -------- + ------ + ------------------- +  - ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-administration-pausing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.7.2在从站上暂停复制</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">停止并启动从站上的复制
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要停止处理来自主设备的二进制日志，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>STOP SLAVE;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        停止复制时，从属I / O线程停止从主二进制日志读取事件并将它们写入中继日志，并且SQL线程停止从中继日志读取事件并执行它们。</font><font style="vertical-align: inherit;">您可以通过指定线程类型来单独暂停I / O或SQL线程：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>STOP SLAVE IO_THREAD;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>STOP SLAVE SQL_THREAD;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要再次开始执行，请使用以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START
        SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>START SLAVE;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要启动特定的线程，请指定线程类型：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>START SLAVE IO_THREAD;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>START SLAVE SQL_THREAD;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于仅通过处理来自主服务器的事件执行更新的从服务器，如果要执行备份或其他任务，仅停止SQL线程可能很有用。</font><font style="vertical-align: inherit;">I / O线程将继续从主站读取事件，但不会执行。</font><font style="vertical-align: inherit;">这使得在重新启动SQL线程时，从站可以更容易地赶上。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        仅停止I / O线程可以使中继日志中的事件由SQL线程执行，直至中继日志结束。</font><font style="vertical-align: inherit;">当您想要暂停执行以赶上已经从主服务器接收到的事件时，如果要对从服务器执行管理，还要确保它已将所有更新处理到特定点，这会非常有用。</font><font style="vertical-align: inherit;">当您在主设备上进行管理时，此方法也可用于在从设备上暂停事件接收。</font><font style="vertical-align: inherit;">停止I / O线程但允许SQL线程运行有助于确保在再次启动复制时不会有大量积压的事件要执行。
</font></font></p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="replication-implementation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2复制实现</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1复制格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-implementation-details"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.2复制实现细节</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-channels"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3复制通道</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#slave-logs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.4复制中继和状态日志</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-rules"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5服务器如何评估复制过滤规则</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528028007696"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    复制是基于主服务器跟踪其二进制日志中对其数据库的所有更改（更新，删除等）。</font><font style="vertical-align: inherit;">二进制日志充当从服务器启动的那一刻起修改数据库结构或内容（数据）的所有事件的书面记录。</font><font style="vertical-align: inherit;">通常情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    不记录语句，因为它们既不修改数据库结构也不修改内容
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    连接到主站的每个从站都会请求二进制日志的副本。</font><font style="vertical-align: inherit;">也就是说，它从主设备中取出数据，而不是主设备将数据推送到从设备。</font><font style="vertical-align: inherit;">从站也从它接收到的二进制日志中执行事件。</font><font style="vertical-align: inherit;">这具有重复原始更改的效果，就像它们在主控上进行一样。</font><font style="vertical-align: inherit;">创建表或修改其结构，并根据最初在主服务器上所做的更改插入，删除和更新数据。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    由于每个从属设备都是独立的，所以从主设备的二进制日志中重放的更改将在连接到主设备的每个从设备上独立进行。</font><font style="vertical-align: inherit;">另外，由于每个从设备只通过向主设备请求来接收二进制日志的副本，所以从设备能够以自己的速度读取和更新数据库的副本，并且可以随意启动和停止复制过程而不会影响能够更新主站或从站上的最新数据库状态。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关复制实现细节的更多信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-implementation-details" title="16.2.2复制实现细节"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.2节“复制实现细节”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    大师和奴隶定期报告他们在复制过程中的状态，以便您可以监控他们。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">所有复制相关状态的说明，</font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#thread-information" title="8.14检查线程信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.14节“检查线程信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    主二进制日志在处理之前写入从属设备上的本地中继日志。</font><font style="vertical-align: inherit;">从站还使用主站的二进制日志和本地中继日志记录有关当前位置的信息。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    根据一组根据控制事件评估的配置选项和变量应用的规则，在从站上过滤数据库更改。</font><font style="vertical-align: inherit;">有关如何应用这些规则的详细信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules" title="16.2.5服务器如何评估复制过滤规则"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5节“服务器如何评估复制过滤规则”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-formats"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1复制格式</font></font></h3>
</div>
</div>
</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-sbr-rbr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1.1基于声明和基于行的复制的优点和缺点</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-rbr-usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1.2使用基于行的记录和复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-rbr-safe-unsafe"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1.3在二进制测井中确定安全和不安全的陈述</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      因为写入二进制日志的事件从主服务器读取，然后在从服务器上处理，所以复制可以工作。</font><font style="vertical-align: inherit;">根据事件类型，事件以不同格式记录在二进制日志中。</font><font style="vertical-align: inherit;">所使用的不同复制格式对应于事件记录在主站的二进制日志中时使用的二进制记录格式。</font><font style="vertical-align: inherit;">二进制日志记录格式与复制期间使用的术语之间的相关性如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用基于语句的二进制日志记录时，主服务器将SQL语句写入二进制日志。</font><font style="vertical-align: inherit;">通过在从服务器上执行SQL语句将主服务器复制到从服务器。</font><font style="vertical-align: inherit;">这被称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句的复制</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（可以缩写为
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SBR</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），它对应于基于MySQL语句的标准二进制日志格式。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在使用基于行的日志记录时，主服务器将</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入
           </font><font style="vertical-align: inherit;">二进制日志，以指示单个表行如何更改。</font><font style="vertical-align: inherit;">主站复制到从站的工作方式是将表示表格行更改的事件复制到从站。</font><font style="vertical-align: inherit;">这称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（可以缩写为
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RBR</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您还可以将MySQL配置为混合使用基于语句和基于行的日志记录，具体取决于最适合记录更改的日志记录。</font><font style="vertical-align: inherit;">这被称为
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">混合格式日志记录</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用混合格式日志记录时，默认情况下使用基于语句的日志。</font><font style="vertical-align: inherit;">根据特定的语句以及正在使用的存储引擎，日志会在特定情况下自动切换为基于行。</font><font style="vertical-align: inherit;">使用混合格式的复制被称为
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于混合的复制</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          或</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">混合格式的复制</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log-mixed" title="5.4.4.3混合二进制记录格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4.3节“混合二进制记录格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在MySQL 5.7.7之前，基于声明的格式是默认格式。</font><font style="vertical-align: inherit;">在MySQL 5.7.7和更高版本中，基于行的格式是默认格式。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDB群集。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL NDB Cluster 7.5中的默认二进制日志格式是
         </font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您应该注意，NDB群集复制始终使用基于行的复制，并且
         </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎与基于语句的复制不兼容。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-general" title="21.6.2 NDB群集复制的一般要求"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-general" title="21.6.2 NDB群集复制的一般要求"><font style="vertical-align: inherit;">第21.6.2节“NDB群集复制的一般要求”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式时，二进制日志记录格式部分由正在使用的存储引擎和正在执行的语句确定。</font><font style="vertical-align: inherit;">有关混合格式日志记录和支持不同日志记录格式的规则的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log-mixed" title="5.4.4.3混合二进制记录格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4.3节“混合二进制日志记录格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在运行的MySQL服务器中的日志格式是通过设置 </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器系统变量。</font><font style="vertical-align: inherit;">该变量可以使用会话或全局范围进行设置。</font><font style="vertical-align: inherit;">管理新设置何时以及如何生效的规则与其他MySQL服务器系统变量相同。</font><font style="vertical-align: inherit;">为当前会话设置变量只会持续到该会话结束，并且更改对其他会话不可见。</font><font style="vertical-align: inherit;">全局设置变量对更改后连接的客户端生效，但不适用于任何当前客户端会话，包括变量设置已更改的会话。</font><font style="vertical-align: inherit;">要使全局系统变量设置为永久性的，以便跨服务器重新启动应用，必须将其设置为选项文件。</font><font style="vertical-align: inherit;">有关更多信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.4.1节“变量赋值的SET语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有些情况下，您无法在运行时更改二进制日志记录格式，否则会导致复制失败。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log-setting" title="5.4.4.2设置二进制日志格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4.2节“设置二进制日志格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您必须有权</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置全局</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">或会话
       </font><font style="vertical-align: inherit;">值。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      基于声明和基于行的复制格式具有不同的问题和限制。</font><font style="vertical-align: inherit;">要比较它们的相对优点和缺点，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-sbr-rbr" title="16.2.1.1基于声明和基于行的复制的优点和缺点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1.1节“基于声明和基于行的复制的优点和缺点”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用基于语句的复制时，可能会遇到复制存储例程或触发器的问题。</font><font style="vertical-align: inherit;">您可以通过使用基于行的复制来避免这些问题。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-programs-logging" title="23.7存储程序的二进制记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第23.7节“存储程序的二进制日志记录”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-sbr-rbr"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1.1基于声明和基于行的复制的优点和缺点</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528027967200"></a><a class="indexterm" name="idm140528027965744"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每种二进制日志格式都有优点和缺点。</font><font style="vertical-align: inherit;">对于大多数用户来说，混合复制格式应该提供数据完整性和性能的最佳组合。</font><font style="vertical-align: inherit;">但是，如果您希望在执行某些任务时利用特定于基于语句或基于行的复制格式的功能，则可以使用本节中的信息，其中提供了其相对优点和缺点的摘要，以确定哪个最适合您的需求。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#replication-sbr-rbr-sbr-advantages" title="基于声明的复制的优点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于声明的复制的优点</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#replication-sbr-rbr-sbr-disadvantages" title="基于声明的复制的缺点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于声明的复制的缺点</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#replication-sbr-rbr-rbr-advantages" title="基于行的复制的优点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制的优点</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#replication-sbr-rbr-rbr-disadvantages" title="基于行的复制的缺点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制的缺点</font></font></a>
</p></li></ul>
</div>
<h5><a name="replication-sbr-rbr-sbr-advantages"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于声明的复制的优点</font></font></h5>
<a class="indexterm" name="idm140528027953984"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            经过验证的技术。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            写入日志文件的数据较少。</font><font style="vertical-align: inherit;">当更新或删除操作影响很多行时，这会导致</font><font style="vertical-align: inherit;">
            日志文件所需的存储空间少</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">得多</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这也意味着可以更快地完成备份和恢复。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            日志文件包含所有发生更改的语句，因此它们可用于审计数据库。
</font></font></p></li></ul>
</div>
<h5><a name="replication-sbr-rbr-sbr-disadvantages"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于声明的复制的缺点</font></font></h5>
<a class="indexterm" name="idm140528027947696"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于SBR不安全的语句。&nbsp;</font></font></b><a class="indexterm" name="idm140528027945040"></a><a class="indexterm" name="idm140528027943520"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              不修改该数据的所有语句（如
               </font><font style="vertical-align: inherit;">，
               </font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">语句）可以使用基于语句的复制被复制。</font><font style="vertical-align: inherit;">使用基于语句的复制时，任何非确定性行为都很难复制。</font><font style="vertical-align: inherit;">此类数据修改语言（DML）语句的示例包括以下内容：
</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a>
              <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                由于UDF或存储程序返回的值或取决于提供给它的参数以外的因素，因此依赖于UDF或存储程序的声明不具有确定性。</font><font style="vertical-align: inherit;">（但是，基于行的复制只是复制由UDF或存储程序返回的值，所以它对主表和行的表行和数据的影响是相同的。）请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-invoked" title="16.4.1.16调用特征的复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.16节“调用的特性的复制“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，了解更多信息。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
                 </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有an </font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句的
                 </font><font style="vertical-align: inherit;">陈述</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是不确定的。</font><font style="vertical-align: inherit;">请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-limit" title="16.4.1.17复制和限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.17节“复制和限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                确定性UDF必须应用于从站。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用基于语句的复制无法正确复制使用以下任何函数的语句：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid"><code class="literal">UUID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                    </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid-short"><code class="literal">UUID_SHORT()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（除非主设备和从设备都使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_sysdate-is-now"><code class="option">--sysdate-is-now</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    选项</font><font style="vertical-align: inherit;">启动
                     </font><font style="vertical-align: inherit;">）
                  </font></font></p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_is-free-lock"><code class="literal">IS_FREE_LOCK()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_is-used-lock"><code class="literal">IS_USED_LOCK()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_master-pos-wait"><code class="literal">MASTER_POS_WAIT()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_sleep"><code class="literal">SLEEP()</code></a>
                  </p></li><li class="listitem"><p>
                    <a class="link" href="/mysql-5.7-google-zh/functions.html#function_version"><code class="literal">VERSION()</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                但是，所有其他函数都使用基于语句的复制（包括</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_now"><code class="literal">NOW()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等）</font><font style="vertical-align: inherit;">正确复制
                 </font><font style="vertical-align: inherit;">。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                有关更多信息，请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-functions" title="16.4.1.15复制和系统功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.15节“复制和系统函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用基于语句的复制无法正确复制的语句会使用如下所示的警告进行记录：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[警告]声明不能安全地登录声明格式。
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在这种情况下也会向客户发出类似的警告。</font><font style="vertical-align: inherit;">客户端可以使用它来显示它
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT ...
            SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 与基于行的复制相比，需要更多数量的行级锁。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要表扫描的语句（因为</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">没有使用索引
             </font><font style="vertical-align: inherit;">）必须锁定比使用基于行的复制更多的行。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
             </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止其他非冲突</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句的语句。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于复杂的语句，必须在更新或插入行之前在从属系统上评估和执行语句。</font><font style="vertical-align: inherit;">使用基于行的复制时，从站只需修改受影响的行，而不是执行完整的语句。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果在从站上评估时出现错误，特别是在执行复杂语句时，基于语句的复制可能会逐渐增加受影响的行中的错误容限。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-slaveerrors" title="16.4.1.28复制期间的从站错误"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.28节“从复制期间的错误”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            存储函数的执行与</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_now"><code class="literal">NOW()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用语句</font><font style="vertical-align: inherit;">具有相同的
             </font><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">但是，这不适用于存储过程。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            确定性UDF必须应用于从站。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表格定义必须（几乎）在主站和从站上相同。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-differing-tables" title="16.4.1.10复制主控和从属参数不同的表定义"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-differing-tables" title="16.4.1.10复制主控和从属参数不同的表定义"><font style="vertical-align: inherit;">第16.4.1.10节“在主服务器和从服务器上使用不同的表定义进行复制”</font></a><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<h5><a name="replication-sbr-rbr-rbr-advantages"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制的优点</font></font></h5>
<a class="indexterm" name="idm140528027870944"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            所有更改都可以被复制。</font><font style="vertical-align: inherit;">这是最安全的复制形式。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句更新的信息
               </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库，例如
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和触发器的操作，存储程序（包括存储过程），和看法，都使用基于语句的复制复制到奴隶。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于像这样
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE
              ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code class="literal">CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句，从表定义生成语句并使用基于语句的格式进行复制，而使用基于行的格式复制行插入。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于以下类型的语句，主设备上需要更少的行锁，从而实现更高的并发性：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT
                ... SELECT</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 声明
                </font></font><code class="literal">AUTO_INCREMENT</code>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不使用键的子句的</font><font style="vertical-align: inherit;">语句，
                 </font><font style="vertical-align: inherit;">或者不改变大多数检查过的行。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于任何</font><font style="vertical-align: inherit;">，或者
             </font><font style="vertical-align: inherit;">语句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">从站都需要更少的行锁
             </font><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<h5><a name="replication-sbr-rbr-rbr-disadvantages"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制的缺点</font></font></h5>
<a class="indexterm" name="idm140528027845280"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            RBR可以生成更多必须记录的数据。</font><font style="vertical-align: inherit;">要复制DML语句（如一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font><font style="vertical-align: inherit;">一个
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句），基于语句的复制只将语句写入二进制日志。</font><font style="vertical-align: inherit;">相比之下，基于行的复制将每个更改的行写入二进制日志。</font><font style="vertical-align: inherit;">如果语句更改很多行，则基于行的复制可能会向二进制日志写入更多的数据; </font><font style="vertical-align: inherit;">即使对于回滚的语句也是如此。</font><font style="vertical-align: inherit;">这也意味着制作和恢复备份可能需要更多时间。</font><font style="vertical-align: inherit;">另外，二进制日志被锁定的时间更长，以便写入数据，这可能会导致并发问题。</font><font style="vertical-align: inherit;">使用
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_row_image"><code class="literal">binlog_row_image=minimal</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 大大减少了不利因素。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用基于行的复制进行复制的</font><font style="vertical-align: inherit;">
            生成较大</font><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">确定性UDF
             </font><font style="vertical-align: inherit;">比使用基于语句的复制需要更长的时间。</font><font style="vertical-align: inherit;">这是因为
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值是记录的，而不是生成数据的语句。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您无法在从服务器上看到从主服务器收到并执行的语句。</font><font style="vertical-align: inherit;">但是，您可以通过</font><font style="vertical-align: inherit;">选项
             </font><font style="vertical-align: inherit;">
            和</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看更改了哪些数据</font><font style="vertical-align: inherit;">。
          </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_base64-output"><code class="option">--base64-output=DECODE-ROWS</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_verbose"><code class="option">--verbose</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或者，使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_rows_query_log_events"><code class="literal">binlog_rows_query_log_events</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            变量，如果启用</font><font style="vertical-align: inherit;">该
             </font><font style="vertical-align: inherit;">变量，则</font><font style="vertical-align: inherit;">在使用该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">时将该</font></font><code class="literal">Rows_query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">事件</font><font style="vertical-align: inherit;">添加
             </font><font style="vertical-align: inherit;">到
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出中
             </font></font><code class="literal">-vv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于使用</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            存储引擎的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当将它们作为基于行的事件应用于二进制日志时，</font><font style="vertical-align: inherit;">需要在从属设备上对</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">进行更强大的锁定
             </font><font style="vertical-align: inherit;">，而不是将它们作为语句应用。</font><font style="vertical-align: inherit;">这意味着</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用基于行的复制时，不支持</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">表进行</font><font style="vertical-align: inherit;">并行插入</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-rbr-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1.2使用基于行的记录和复制</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL使用基于语句的日志记录（SBL），基于行的日志记录（RBL）或混合格式日志记录。</font><font style="vertical-align: inherit;">使用的二进制日志类型会影响日志记录的大小和效率。因此，基于行的复制（RBR）或基于语句的复制（SBR）之间的选择取决于您的应用程序和环境。</font><font style="vertical-align: inherit;">本节介绍使用基于行的格式日志时的已知问题，并介绍在复制中使用它的一些最佳实践。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-sbr-rbr" title="16.2.1.1基于声明和基于行的复制的优点和缺点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1.1节“基于声明和基于行复制的优点和缺点”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关特定于NDB群集复制（取决于基于行的复制）的问题的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-issues" title="21.6.3 NDB群集复制中的已知问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21.6.3节“NDB群集复制中的已知问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="replication-rbr-usage-temptables"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">临时表的基于行的日志记录。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-temptables" title="16.4.1.30复制和临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.30节“复制和临时表”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，临时表在使用基于行的格式时不会被复制。</font><font style="vertical-align: inherit;">使用混合格式日志时，
               </font><font style="vertical-align: inherit;">使用基于语句的格式记录涉及临时表的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-sbr-rbr" title="16.2.1.1基于声明和基于行的复制的优点和缺点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1.1节“基于语句和基于行的复制的优点和缺点”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用基于行的格式时不会复制临时表，因为没有必要。</font><font style="vertical-align: inherit;">另外，因为临时表只能从创建它们的线程读取，所以即使使用基于语句的格式，也很少从复制它们获得任何好处。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7中，即使在创建临时表时，也可以从基于语句的切换到基于行的二进制记录模式。</font><font style="vertical-align: inherit;">但是，在使用基于行的格式时，MySQL服务器无法确定创建给定临时表时有效的日志记录模式。</font><font style="vertical-align: inherit;">因此，在这种情况下，服务器在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TEMPORARY
            TABLE IF EXISTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话结束时为每个给定客户机会话仍然存在的临时表</font><font style="vertical-align: inherit;">记录一条</font><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">虽然这意味着这是一个不必要的</font><font style="vertical-align: inherit;">选择。
          </font></font><code class="literal">DROP TEMPORARY TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            在某些情况下可能会记录</font><font style="vertical-align: inherit;">语句，但该语句是无害的，即使表不存在也不会导致错误，这是由于存在</font></font><code class="literal">IF
            EXISTS</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要</font><font style="vertical-align: inherit;">
            涉及</font><font style="vertical-align: inherit;">到这些语句的任何非事务性表都是临时表（Bug＃14272672），</font><font style="vertical-align: inherit;">就可以使用涉及临时表的</font><font style="vertical-align: inherit;">非事务性</font><font style="vertical-align: inherit;">DML语句
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RBL和非事务表的同步。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当许多行受到影响时，这组更改被分成几个事件; </font><font style="vertical-align: inherit;">当语句提交时，所有这些事件都写入二进制日志。</font><font style="vertical-align: inherit;">在从属设备上执行时，会在所有涉及的表上执行表锁定，然后以批处理模式应用这些行。</font><font style="vertical-align: inherit;">取决于用于表的奴隶副本的引擎，这可能会或可能不会有效。

              
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟和二进制日志大小。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              RBL将每行的更改写入二进制日志，因此其大小可以相当快地增加。</font><font style="vertical-align: inherit;">这可能会显着增加对从站进行更改所需的时间，以匹配主站上的更改。</font><font style="vertical-align: inherit;">您应该意识到您的应用程序出现延迟的可能性。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取二进制日志。&nbsp;</font></font></b>
              <a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="literal">BINLOG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句</font><font style="vertical-align: inherit;">在二进制日志中显示基于行的事件</font><font style="vertical-align: inherit;">（参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#binlog" title="13.7.6.1 BINLOG语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.6.1节“BINLOG语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">该语句将事件显示为64位编码的基本字符串，其含义不明显。</font><font style="vertical-align: inherit;">当用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_base64-output"><code class="option">--base64-output=DECODE-ROWS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_verbose"><code class="option">--verbose</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，
               </font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;">mysqlbinlog</font></strong></span></a><font style="vertical-align: inherit;">调用
              </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式化二进制日志的内容以便人类可读。</font><font style="vertical-align: inherit;">当以基于行的格式写入二进制日志事件并且想要读取或从复制或数据库故障中恢复时，可以使用此命令来读取二进制日志的内容。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog-row-events" title="4.6.7.2 mysqlbinlog行事件显示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.7.2节“mysqlbinlog行事件显示”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制日志执行错误和slave_exec_mode。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode=IDEMPOTENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通常仅对MySQL NDB Cluster复制有用，因为它</font></font><code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是默认值。</font><font style="vertical-align: inherit;">（请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication-multi-master" title="21.6.10 NDB群集复制：多主复制和循环复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21.6.10节“NDB群集复制：多主复制和循环复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
              </font></font><code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，由于无法找到原始行，因此无法应用来自RBL的更改不会触发错误或导致复制失败。</font><font style="vertical-align: inherit;">这意味着有可能在从站上不应用更新，以便主站和从站不再同步。</font><font style="vertical-align: inherit;">延迟问题和使用带RBR的非事务表时
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能导致主机和从机进一步发散。</font><font style="vertical-align: inherit;">有关更多信息
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于其他方案，设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于
             </font></font><code class="literal">STRICT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常是足够的; </font><font style="vertical-align: inherit;">这是除以外的存储引擎的默认值
             </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持基于服务器ID的过滤。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您可以使用</font></font><code class="literal">IGNORE_SERVER_IDS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项
               </font><font style="vertical-align: inherit;">根据服务器ID进行过滤
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该选项适用于基于语句和基于行的记录格式。</font><font style="vertical-align: inherit;">另一种过滤一些从属变化的方法是使用一个</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含关系</font><font style="vertical-align: inherit;">从句</font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">语句的</font><font style="vertical-align: inherit;">子句
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，这不适用于基于行的日志记录。</font><font style="vertical-align: inherit;">要使用
               </font><font style="vertical-align: inherit;">系统变量进行语句筛选，请使用基于语句的日志记录。
            </font></font><code class="literal">@@server_id &lt;&gt;
              <em class="replaceable"><code>id_value</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"></font><code class="literal">WHERE @@server_id &lt;&gt; 1</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库级复制选项。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的影响
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-rewrite-db"><code class="option">--replicate-rewrite-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              选择差异很大依赖于基于行或基于语句的日志记录是否被使用。</font><font style="vertical-align: inherit;">因此，建议避免数据库级别的选项，而是使用表级的选项，如
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关这些选项以及影响复制格式对操作方式的更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RBL，非事务性表和停止的奴隶。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用基于行的日志记录时，如果从属服务器在从属线程更新非事务表时停止，则从属数据库可能会达到不一致的状态。</font><font style="vertical-align: inherit;">出于这个原因，建议您使用事务性存储引擎，例如
               </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对使用基于行的格式进行复制的所有表。</font><font style="vertical-align: inherit;">使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE
              SQL_THREAD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭从属MySQL服务器之前</font><font style="vertical-align: inherit;">或
               </font><font style="vertical-align: inherit;">之前有助于防止发生问题，并且总是建议您使用记录格式或存储引擎。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-rbr-safe-unsafe"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1.3在二进制测井中确定安全和不安全的陈述</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528027749952"></a><a class="indexterm" name="idm140528027748496"></a><a class="indexterm" name="idm140528027746992"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL复制中语句</font><font style="vertical-align: inherit;">
        的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全性</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是指语句及其效果是否可以使用基于语句的格式正确复制。</font><font style="vertical-align: inherit;">如果陈述如此，我们将该陈述称为
         </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">否则，我们称之为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一般而言，如果陈述是确定性的，则陈述是安全的，如果陈述不是安全的，则陈述是不安全的。</font><font style="vertical-align: inherit;">但是，某些非确定性函数
         </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被视为不安全（请参阅
         </font><font style="vertical-align: inherit;">本节后面的</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rbr-safe-unsafe-not" title="非确定性函数不被视为不安全"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非确定性函数不被视为不安全</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">另外，使用浮点算术函数的结果（依赖于硬件）的语句总是被认为是不安全的（参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-floatvalues" title="16.4.1.12复制和浮点值"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.12节“复制和浮点值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理安全和不安全的陈述。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          根据语句是否被认为是安全的以及关于二进制日志记录格式（即当前值</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">，语句被区别对待
           </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在使用基于行的日志记录时，不会区分安全和不安全的陈述。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用混合格式日志记录时，使用基于行的格式记录标记为不安全的语句; </font><font style="vertical-align: inherit;">被视为安全的语句使用基于声明的格式进行记录。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在使用基于语句的日志记录时，被标记为不安全的语句会为此生成警告。</font><font style="vertical-align: inherit;">安全语句正常记录。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个被标记为不安全的语句都会生成警告。</font><font style="vertical-align: inherit;">以前，如果在主服务器上执行大量此类语句，则可能会导致过大的错误日志文件。</font><font style="vertical-align: inherit;">为了防止这种情况发生，MySQL 5.7提供了一种警告抑制机制，其行为如下：只要</font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_binlog_unsafe_statement"><code class="literal">ER_BINLOG_UNSAFE_STATEMENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在任何50秒的时间内生成了50次</font><font style="vertical-align: inherit;">最新的
         </font><font style="vertical-align: inherit;">警告超过50次，就会启用警告抑制。</font><font style="vertical-align: inherit;">激活时，这会导致此类警告不会写入错误日志; </font><font style="vertical-align: inherit;">相反，每50个这种类型的警告，一个音符</font></font><code class="literal">The
        last warning was repeated <em class="replaceable"><code>N</code></em> times in
        last <em class="replaceable"><code>S</code></em> seconds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入错误日志。</font><font style="vertical-align: inherit;">只要50秒内发出最近50次这种警告，这种情况就会继续; </font><font style="vertical-align: inherit;">一旦速率降低到低于此阈值，警告将再次正常记录。</font><font style="vertical-align: inherit;">警告抑制不会影响基于语句的日志记录的安全性，也不会影响向客户端发送警告的方式。</font><font style="vertical-align: inherit;">MySQL客户端仍然收到每个这样的语句的一个警告。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被认为不安全的声明。&nbsp;</font></font></b><a class="indexterm" name="idm140528027727600"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          具有以下特征的声明被认为是不安全的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含可能在从属设备上返回不同值的系统功能的语句。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些功能包括
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_is-free-lock"><code class="literal">IS_FREE_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_is-used-lock"><code class="literal">IS_USED_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_master-pos-wait"><code class="literal">MASTER_POS_WAIT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_row-count"><code class="literal">ROW_COUNT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_session-user"><code class="literal">SESSION_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sleep"><code class="literal">SLEEP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_system-user"><code class="literal">SYSTEM_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid"><code class="literal">UUID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid-short"><code class="literal">UUID_SHORT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><a name="replication-rbr-safe-unsafe-not"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非确定性函数不被视为不安全。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              虽然这些功能是不确定的，它们被视为安全的记录和复制的目的：
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_curdate"><code class="literal">CURDATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-date"><code class="literal">CURRENT_DATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-time"><code class="literal">CURRENT_TIME()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-timestamp"><code class="literal">CURRENT_TIMESTAMP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_curtime"><code class="literal">CURTIME()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，， ，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_localtime"><code class="literal">LOCALTIME()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_localtimestamp"><code class="literal">LOCALTIMESTAMP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_now"><code class="literal">NOW()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_utc-date"><code class="literal">UTC_DATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
              </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_utc-time"><code class="literal">UTC_TIME()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_utc-timestamp"><code class="literal">UTC_TIMESTAMP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-functions" title="16.4.1.15复制和系统功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.15节“复制和系统函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用系统变量。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              大多数系统变量不能使用基于语句的格式正确复制。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-variables" title="16.4.1.38复制和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.38节“复制和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关例外情况，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log-mixed" title="5.4.4.3混合二进制记录格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4.3节“混合二进制日志记录格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDF的。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于我们无法控制UDF的功能，所以我们必须假定它正在执行不安全的语句。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全文插件。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这个插件在不同的MySQL服务器上可能会有不同的表现。</font><font style="vertical-align: inherit;">因此，依赖于它的陈述可能会有不同的结果。</font><font style="vertical-align: inherit;">因此，所有依赖全文插件的语句都被视为不安全（Bug＃11756280，Bug＃48183）。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发器或存储的程序更新具有AUTO_INCREMENT列的表。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这是不安全的，因为在主机和从机上行更新的顺序可能不同。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此外，将</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个包含</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是该</font><font style="vertical-align: inherit;">组合主键</font><font style="vertical-align: inherit;">的第一列的列的组合键</font><font style="vertical-align: inherit;">设为表
             </font><font style="vertical-align: inherit;">是不安全的。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-auto-increment" title="16.4.1.1复制和AUTO_INCREMENT"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.1节“复制和AUTO_INCREMENT”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在具有多个主键或唯一键的表上插入... ON DUPLICATE KEY UPDATE语句。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当针对包含多个主键或唯一键的表执行时，此语句被认为是不安全的，对存储引擎检查密钥的顺序非常敏感，这是非确定性的，并且在其上选择由MySQL服务器依赖。
            </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-on-duplicate" title="13.2.5.2 INSERT ... ON DUPLICATE KEY UPDATE语法"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对具有多个唯一或主键的表</font><font style="vertical-align: inherit;">
            的
             </font><font style="vertical-align: inherit;">语句被标记为对基于语句的复制而言不安全。</font><font style="vertical-align: inherit;">（Bug＃11765650，错误＃58637）
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用LIMIT进行更新。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有指定检索行的顺序，因此被认为是不安全的。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-limit" title="16.4.1.17复制和限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.17节“复制和限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问或引用日志表。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              主系统和从系统的系统日志表内容可能不同。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务操作之后的非事务操作。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在一个事务中，允许任何非事务读取或写入在任何事务读取或写入后执行都被认为是不安全的。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-transactions" title="16.4.1.34复制和事务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.34节“复制和事务”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问或引用自动记录表。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所有读取和写入自我记录表都被认为是不安全的。</font><font style="vertical-align: inherit;">在一个事务中，在读取或写入自我记录表之后的任何语句也被认为是不安全的。
            </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOAD DATA INFILE语句。&nbsp;</font></font></b>
              <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
              INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被视为不安全，并且当
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=mixed</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句以行为格式记录时。</font><font style="vertical-align: inherit;">当
               </font><font style="vertical-align: inherit;">不产生警告，不像其他不安全的语句。
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=statement</code></a>
              <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
              INFILE</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XA交易。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果在主服务器上以并行方式提交的两个XA事务以相反的顺序在从服务器上准备好，则基于语句的复制可能会发生锁定依赖性，而这种复制不能安全地解决，并且复制可能会因从服务器死锁而失败。</font><font style="vertical-align: inherit;">何时
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=STATEMENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              设置，XA事务内的DML语句被标记为不安全并生成警告。</font><font style="vertical-align: inherit;">当
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=MIXED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置，XA事务内的DML语句使用基于行的复制记录，以及潜在的问题是不存在的。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features" title="16.4.1复制功能和问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1节“复制功能和问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-implementation-details"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.2复制实现细节</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL复制功能使用三个线程实现，一个在主服务器上，另一个在从服务器上：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Binlog转储线程。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            主站创建一个线程，在从站连接时将二进制日志内容发送给从站。</font><font style="vertical-align: inherit;">该线程可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
            PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主</font></font><code class="literal">Binlog
            Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程</font><font style="vertical-align: inherit;">的输出中标识</font><font style="vertical-align: inherit;">为</font><font style="vertical-align: inherit;">线程。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          二进制日志转储线程在主服务器的二进制日志上获取一个锁，用于读取要发送给从服务器的每个事件。</font><font style="vertical-align: inherit;">一旦事件被读取，即使在事件被发送到从设备之前，锁也被释放。
        </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从属I / O线程。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从属服务器上发布语句时，从属创建一个I / O线程，该线程连接到主服务器并要求它发送记录在其二进制日志中的更新。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从I / O线程读取主</font></font><code class="literal">Binlog Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程发送</font><font style="vertical-align: inherit;">的更新
           </font><font style="vertical-align: inherit;">（请参阅前一项）并将它们复制到组成从站的中继日志的本地文件。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此线程的状态显示
           </font></font><code class="literal">Slave_IO_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在输出中
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_running"><code class="literal">Slave_running</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出中</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从属SQL线程。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从站创建一个SQL线程来读取由从站I / O线程写入的中继日志并执行其中包含的事件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在前面的描述中，每个主/从连接有三个线程。</font><font style="vertical-align: inherit;">拥有多个从站的主站为每个当前连接的从站创建一个二进制日志转储线程，并且每个从站都有自己的I / O和SQL线程。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从机使用两个线程将读取更新与主机分离，并将其执行为独立任务。</font><font style="vertical-align: inherit;">因此，如果语句执行速度较慢，则阅读语句的任务不会减慢。</font><font style="vertical-align: inherit;">例如，如果从服务器没有运行一段时间，它的I / O线程可以在从服务器启动时快速地从主服务器获取所有二进制日志内容，即使SQL线程远远落后。</font><font style="vertical-align: inherit;">如果从站在SQL线程执行完所有提取的语句之前停止，那么I / O线程至少会提取所有内容，以便将语句的安全副本本地存储在从站的中继日志中，以备下次执行奴隶开始。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明提供的信息可以告诉您关于复制的主站和从站上发生了什么。</font><font style="vertical-align: inherit;">有关主状态的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#master-thread-states" title="8.14.4复制主线程状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.14.4节“复制主线程状态”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于从机状态，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#slave-io-thread-states" title="8.14.5复制从属I / O线程状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.14.5节“复制从机I / O线程状态”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#slave-sql-thread-states" title="8.14.6复制从SQL SQL线程状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.14.6节“复制从机SQL线程状态”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下示例说明了三个线程如何显示在输出中</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在主服务器上，输出来自</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
      PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW PROCESSLIST\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Id：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   用户：root</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   主机：localhost：32931</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     db：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令：Binlog转储</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   时间：94</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  状态：已将所有binlog发送给从属; </font><font style="vertical-align: inherit;">等待binlog</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         被更新</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   信息：NULL</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这里，线程2是一个</font></font><code class="literal">Binlog Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制线程，为连接的从站提供服务。</font><font style="vertical-align: inherit;">该
       </font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息表明所有未完成的更新都已发送到从站，并且主站正在等待更多更新发生。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">Binlog Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器</font><font style="vertical-align: inherit;">上看不到任何
       </font><font style="vertical-align: inherit;">线程，则表示复制未运行; </font><font style="vertical-align: inherit;">也就是说，目前没有奴隶连接。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在从属服务器上，输出结果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
      PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW PROCESSLIST\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Id：10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   用户：系统用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   主办：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     db：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令：连接</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   时间：11</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  状态：等待主人发送活动</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   信息：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Id：11</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   用户：系统用户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   主办：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     db：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
命令：连接</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   时间：11</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  状态：已经读取所有的中继日志; </font><font style="vertical-align: inherit;">等待从机I / O</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         线程来更新它</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   信息：NULL</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息表明线程10是与主服务器通信的I / O线程，线程11是处理存储在中继日志中的更新的SQL线程。</font><font style="vertical-align: inherit;">在
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行的时候，两个线程都处于空闲状态，等待进一步更新。
    </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">Time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">
      的值</font><font style="vertical-align: inherit;">可以显示奴隶与主人的比较有多迟。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/faqs.html#faqs-replication" title="A.13 MySQL 5.7 FAQ：复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第A.13节“MySQL 5.7 FAQ：复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果在主</font></font><code class="literal">Binlog
      Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程</font><font style="vertical-align: inherit;">上没有在</font><font style="vertical-align: inherit;">线程</font><font style="vertical-align: inherit;">上运行足够的时间</font><font style="vertical-align: inherit;">，主器件将确定从器件不再连接。</font><font style="vertical-align: inherit;">对于任何其他客户端连接，这样做的超时取决于的值
       </font></font><code class="option">net_write_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="option">net_retry_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">有关这些的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句提供有关从服务器上的复制处理的其他信息。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-administration-status" title="16.1.7.1检查复制状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.7.1节“检查复制状态”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-channels"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3复制通道</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#channels-commands-single-channel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3.1单通道操作命令</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#channels-with-prev-replication"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3.2与先前复制语句的兼容性</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#channels-startup-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3.3启动选项和复制通道</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#channels-naming-conventions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3.4复制通道命名约定</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528027595696"></a><a class="indexterm" name="idm140528027594624"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL 5.7.6引入了一个复制通道的概念，它表示从主站到从站的事务处理路径。</font><font style="vertical-align: inherit;">本节介绍如何在复制拓扑中使用通道，以及它们对单源复制的影响。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    为了提供与以前版本的兼容性，MySQL服务器在启动时自动创建一个名称为空字符串（</font></font><code class="literal">""</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的默认通道</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此频道始终存在; </font><font style="vertical-align: inherit;">它不能被用户创建或销毁。</font><font style="vertical-align: inherit;">如果尚未创建其他通道（具有非空名称），则复制语句仅作用于默认通道，以便所有来自较早从属的复制语句按预期运行（请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#channels-with-prev-replication" title="16.2.3.2与先前复制语句的兼容性"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.3.2节“与先前复制语句的兼容性”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。到本节中描述的复制通道只能在至少有一个命名通道时使用。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    复制通道包含从主设备传输到从设备的事务路径。</font><font style="vertical-align: inherit;">在多源复制中，从设备打开多个通道，每个主设备一个，每个通道都有自己的中继日志和应用程序（SQL）线程。</font><font style="vertical-align: inherit;">一旦复制通道的接收器（I / O）线程接收到事务，它们将被添加到通道的中继日志文件并传递给应用程序线程。</font><font style="vertical-align: inherit;">这使通道可以独立工作。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    复制通道也与主机名和端口相关联。</font><font style="vertical-align: inherit;">您可以将多个通道分配给主机名和端口的相同组合; </font><font style="vertical-align: inherit;">在MySQL 5.7中，可以添加到多源复制拓扑中的一个从站的最大通道数为256个。每个复制通道必须具有唯一（非空）名称（请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#channels-naming-conventions" title="16.2.3.4复制通道命名约定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.3.4节“复制通道命名约定”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">通道可以独立配置。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="channels-commands-single-channel"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3.1单通道操作命令</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528027586224"></a><a class="indexterm" name="idm140528027584736"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要使MySQL复制操作能够作用于单独的复制通道，请将该</font><font style="vertical-align: inherit;">子句与以下复制语句一起使用：
</font></font><code class="literal">FOR CHANNEL
      <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-relaylog-events" title="13.7.5.32 SHOW RELAYLOG EVENTS句法"><code class="literal">SHOW RELAYLOG EVENTS</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-relay-logs"><code class="literal">FLUSH RELAY LOGS</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><code class="literal">RESET SLAVE</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      同样，</font></font><code class="literal">channel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为以下功能引入了</font><font style="vertical-align: inherit;">一个附加</font><font style="vertical-align: inherit;">参数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/functions.html#function_master-pos-wait"><code class="literal">MASTER_POS_WAIT()</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/functions.html#function_wait-until-sql-thread-after-gtids"><code class="literal">WAIT_UNTIL_SQL_THREAD_AFTER_GTIDS()</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从MySQL 5.7.9开始，以下语句不适用于该</font></font><code class="literal">group_replication_recovery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      通道。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a>
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="channels-with-prev-replication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3.2与先前复制语句的兼容性</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528027555120"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当复制从站有多个通道并且</font><font style="vertical-align: inherit;">未指定选项时，通常会在所有可用通道上运行有效语句。
    </font></font><code class="literal">FOR
      CHANNEL <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      例如，以下语句按预期工作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除</font></font><code class="literal">group_replication_recovery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通道</font><font style="vertical-align: inherit;">外，为所有通道启动复制线程
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止除</font></font><code class="literal">group_replication_recovery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通道</font><font style="vertical-align: inherit;">之外的所有通道的复制线程
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 报告所有渠道的状态。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-relay-logs"><code class="literal">FLUSH RELAY LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 为所有通道刷新中继日志。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><code class="literal">RESET
          SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 重置所有频道。
</font></font></p></li></ul>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><code class="literal">RESET SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为此语句删除所有现有的渠道，清除他们的中继日志文件，并重新创建只有默认通道慎用。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      某些复制语句不能在所有通道上运行。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站上存在</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1964 </font><span class="errortext"><font style="vertical-align: inherit;">多通道。</font></span><span class="errortext"><font style="vertical-align: inherit;">请提供频道名称作为参数。</font></span><font style="vertical-align: inherit;">生成。</font><font style="vertical-align: inherit;">以下语句和函数在多源复制拓扑中使用时会生成此错误，并且
       </font><font style="vertical-align: inherit;">
      没有使用选项指定要对其执行操作的通道：
</font></font><code class="literal">FOR CHANNEL <em class="replaceable"><code>channel</code></em></code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-relaylog-events" title="13.7.5.32 SHOW RELAYLOG EVENTS句法"><code class="literal">SHOW RELAYLOG EVENTS</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/functions.html#function_master-pos-wait"><code class="literal">MASTER_POS_WAIT()</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/functions.html#function_wait-until-sql-thread-after-gtids"><code class="literal">WAIT_UNTIL_SQL_THREAD_AFTER_GTIDS()</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/functions.html#function_wait-for-executed-gtid-set"><code class="literal">WAIT_FOR_EXECUTED_GTID_SET()</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      请注意，默认通道总是存在于单个源复制拓扑中，其中语句和函数的行为与以前版本的MySQL相同。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="channels-startup-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3.3启动选项和复制通道</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528027523360"></a><a class="indexterm" name="idm140528027521872"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍受复制通道添加影响的启动选项。
    </font></font></p><p><font style="vertical-align: inherit;"></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正确配置</font><font style="vertical-align: inherit;">
      以下启动选项</font><span class="emphasis"><em><font style="vertical-align: inherit;">才能</font></em></span><font style="vertical-align: inherit;">使用多源复制。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">--relay-log-info-repository</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这必须设置为</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此选项设置为</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则尝试向从属设备添加更多源将失败
           </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_slave_new_channel_wrong_repository"><code class="literal">ER_SLAVE_NEW_CHANNEL_WRONG_REPOSITORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="option">--master-info-repository</code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这必须设置为</font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此选项设置为</font></font><code class="literal">FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则尝试向从属设备添加更多源将失败
           </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_slave_new_channel_wrong_repository"><code class="literal">ER_SLAVE_NEW_CHANNEL_WRONG_REPOSITORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下启动选项现在会影响</font><font style="vertical-align: inherit;">
      复制拓扑中的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通道。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slave_updates"><code class="literal">--log-slave-updates</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从站（甚至来自多个源）接收到的所有事务均写入二进制日志中。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_purge"><code class="literal">--relay-log-purge</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置后，每个通道自动清除自己的中继日志。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries"><code class="literal">--slave_transaction_retries</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          所有通道的应用程序线程重试事务。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          任何通道上都不会启动复制线程。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_skip_errors"><code class="literal">--slave-skip-errors</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          执行继续，所有通道的错误都会被跳过。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为以下启动选项设置的值适用于每个通道; </font><font style="vertical-align: inherit;">因为这些是</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动选项，它们应用于每个通道。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="option">--max-relay-log-size=<em class="replaceable"><code>size</code></em></code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个通道的单个中继日志文件的最大大小; </font><font style="vertical-align: inherit;">达到此限制后，文件将被旋转。
        </font></font></p></li><li class="listitem"><p>
          <code class="option">--relay-log-space-limit=<em class="replaceable"><code>size</code></em></code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个独立通道的所有中继日志总大小的上限。</font><font style="vertical-align: inherit;">对于</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          频道，这些日志的总大小限制为
           </font><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_space_limit"><code class="literal">relay_log_space_limit *
          <em class="replaceable"><code>N</code></em></code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
          <code class="option">--slave-parallel-workers=<em class="replaceable"><code>value</code></em></code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个通道的从属并行工作者数量。
        </font></font></p></li><li class="listitem"><p>
          <code class="option">--slave-checkpoint-group</code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个源的I / O线程等待时间。
        </font></font></p></li><li class="listitem"><p>
          <code class="option">--relay-log-index=filename</code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个通道的中继日志索引文件的基本名称。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#channels-naming-conventions" title="16.2.3.4复制通道命名约定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.3.4节“复制通道命名约定”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="option">--relay-log=filename</code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表示每个通道的中继日志文件的基本名称。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#channels-naming-conventions" title="16.2.3.4复制通道命名约定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.3.4节“复制通道命名约定”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="option">--slave_net-timeout=N</code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该值是针对每个通道设置的，以便每个通道等待
           </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几秒钟以检查连接断开。
        </font></font></p></li><li class="listitem"><p>
          <code class="option">--slave-skip-counter=N</code>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该值是为每个通道设置的，以便每个通道都跳过
           </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其主站的事件。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="channels-naming-conventions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3.4复制通道命名约定</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528027473280"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍命名约定如何受到复制通道的影响。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个复制通道都有一个唯一的名称，它是一个最大长度为64个字符的字符串，并且不区分大小写。</font><font style="vertical-align: inherit;">由于通道名称用于从表，因此用于这些字符集的字符集始终为UTF-8。</font><font style="vertical-align: inherit;">尽管您一般可以自由使用任何频道名称，但以下名称是保留的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">group_replication_applier</code>
        </p></li><li class="listitem"><p>
          <code class="literal">group_replication_recovery</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您为复制通道选择的名称也会影响多源复制从属服务器使用的文件名。</font><font style="vertical-align: inherit;">每个通道的中继日志文件和索引文件都被命名
       </font><font style="vertical-align: inherit;">，其中</font><font style="vertical-align: inherit;">是使用该</font><font style="vertical-align: inherit;">
      选项</font><font style="vertical-align: inherit;">指定的基本名称</font><font style="vertical-align: inherit;">，并且</font><font style="vertical-align: inherit;">是记录到此文件的通道的名称。</font><font style="vertical-align: inherit;">如果您不指定该
       </font><font style="vertical-align: inherit;">选项，则会使用一个默认文件名，其中也包含频道的名称。
</font></font><code class="filename"><em class="replaceable"><code>relay_log_basename</code></em>-<em class="replaceable"><code>channel</code></em>.xxxxxx</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>relay_log_basename</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"></font><em class="replaceable"><code>channel</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="slave-logs"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.4复制中继和状态日志</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#slave-logs-relaylog"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.4.1从站中继日志</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#slave-logs-status"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.4.2从站状态日志</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528027460784"></a><a class="indexterm" name="idm140528027459328"></a><a class="indexterm" name="idm140528027457840"></a><a class="indexterm" name="idm140528027456752"></a><a class="indexterm" name="idm140528027455664"></a><a class="indexterm" name="idm140528027454576"></a><a class="indexterm" name="idm140528027453488"></a><a class="indexterm" name="idm140528027452400"></a><a class="indexterm" name="idm140528027451312"></a><a class="indexterm" name="idm140528027450240"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在复制期间，从属服务器创建多个日志，用于保存从主站传递到从站的二进制日志事件，并记录有关中继日志中当前状态和位置的信息。</font><font style="vertical-align: inherit;">这里列出了三种类型的日志：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主信息日志</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          包含状态和当前的配置信息从服务器的连接到主机。</font><font style="vertical-align: inherit;">该日志保存有关主控主机名，登录凭证和坐标的信息，指示从控制器从主控的二进制日志中读取的距离。
        </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">mysql.slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过启动slave，</font><font style="vertical-align: inherit;">
          可以将此日志写入
           </font><font style="vertical-align: inherit;">表中而不是文件
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-repository"><code class="option">--master-info-repository=TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中继日志</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由来自主的二进制日志读取和写入由从I / O线程的事件。</font><font style="vertical-align: inherit;">作为SQL线程的一部分，中继日志中的事件在从服务器上执行。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中继日志信息记录</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          保存有关从服务器的中继日志中的执行点的状态信息。
        </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">mysql.slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过启动slave，</font><font style="vertical-align: inherit;">
          可以将此日志写入
           </font><font style="vertical-align: inherit;">表中而不是文件
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-info-repository"><code class="option">--relay-log-info-repository=TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      设置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      并</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_info_repository"><code class="literal">master_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以
       </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够提高抵御意外暂停。</font><font style="vertical-align: inherit;">主信息日志存储恢复从属服务器I / O线程所需的信息，中继日志信息日志存储恢复SQL线程所需的信息。</font><font style="vertical-align: inherit;">表的更新与事务一起提交，这意味着即使在服务器停止的情况下，它们中的信息也始终与应用于数据库的信息一致。</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在从站上启用</font><font style="vertical-align: inherit;">该
       </font><font style="vertical-align: inherit;">选项才能保证弹性。</font><font style="vertical-align: inherit;">有关更多详细信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt" title="16.3.2处理意外的复制从站暂停"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.2节“处理意外暂停的复制从属”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当表用于从属状态日志时，如果</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法初始化复制日志记录表，但会允许从属设备继续启动，</font><font style="vertical-align: inherit;">则会发出警告</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从不支持从属日志记录表的MySQL版本升级到支持它们的版本时，最有可能发生这种情况。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不要试图更新或插入行
         </font></font><code class="literal">slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表手动。</font><font style="vertical-align: inherit;">这样做会导致未定义的行为，并且不受支持。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      需要对的一方或双方写锁定任何语句的执行</font></font><code class="literal">slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
       </font></font><code class="literal">slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同时复制正在进行，而在任何时候都允许执行只读取语句表是不允许的。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="slave-logs-relaylog"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.4.1从站中继日志</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        中继日志与二进制日志一样，由一组包含描述数据库更改的事件的编号文件以及一个包含所有使用的中继日志文件名称的索引文件组成。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        术语</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中继日志文件</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常表示包含数据库事件的单独编号的文件。</font><font style="vertical-align: inherit;">术语
         </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中继日志</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集体表示编号的中继日志文件加上索引文件的集合。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        中继日志文件与二进制日志文件具有相同的格式，可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行读取</font><font style="vertical-align: inherit;">（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.7节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 处理二进制日志文件的实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        默认情况下，中继日志文件名称的格式
         </font><font style="vertical-align: inherit;">
        在数据目录中，其中
         </font><font style="vertical-align: inherit;">是从属服务器主机的名称并且</font><font style="vertical-align: inherit;">是序列号。</font><font style="vertical-align: inherit;">连续的继电器日志文件使用连续的序列号创建，以</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">开头</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从站使用索引文件来跟踪当前正在使用的中继日志文件。</font><font style="vertical-align: inherit;">默认的中继日志索引文件名称
         </font><font style="vertical-align: inherit;">
        位于数据目录中。
      </font></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin.<em class="replaceable"><code>nnnnnn</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>nnnnnn</code></em><font style="vertical-align: inherit;"></font><code class="literal">000001</code><font style="vertical-align: inherit;"></font><code class="filename"><em class="replaceable"><code>host_name</code></em>-relay-bin.index</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        默认的中继日志文件和中继日志索引文件名称可分别使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-index"><code class="option">--relay-log-index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器选项（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">进行重写
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果从站使用默认的基于主机的中继日志文件名称，则在设置复制后更改从站的主机名称可能会导致复制失败并显示错误</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法打开中继日志，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在中继日志初始化期间无法找到目标日志</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个已知问题（请参阅错误＃2122）。</font><font style="vertical-align: inherit;">如果预计从站的主机名可能会在未来发生变化（例如，如果网络是建立在奴隶这样使用DHCP，它的主机名称可以修改），您可以通过使用避免此问题完全
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
        </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-index"><code class="option">--relay-log-index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于在最初设置从站时明确指定中继日志文件名的选项。</font><font style="vertical-align: inherit;">这将使名称独立于服务器主机名的变化。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果在复制已经开始后遇到问题，解决此问题的一种方法是停止从服务器，将旧中继日志索引文件的内容预先添加到新服务器中，然后重新启动从服务器。</font><font style="vertical-align: inherit;">在Unix系统上，可以按照如下所示完成：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>cat <em class="replaceable"><code>new_relay_log_name</code></em>.index &gt;&gt; <em class="replaceable"><code>old_relay_log_name</code></em>.index</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>mv <em class="replaceable"><code>old_relay_log_name</code></em>.index <em class="replaceable"><code>new_relay_log_name</code></em>.index</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从服务器在以下情况下创建新的中继日志文件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每次I / O线程启动。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当日志被刷新; </font><font style="vertical-align: inherit;">例如with
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-logs</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当前中继日志文件的大小变得
             </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">太大</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”时，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果值
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_relay_log_size"><code class="literal">max_relay_log_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于0，那么这是最大的中继日志文件大小。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果值为
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_relay_log_size"><code class="literal">max_relay_log_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0，则</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_max_binlog_size"><code class="literal">max_binlog_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                确定最大中继日志文件大小。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        SQL线程在执行文件中的所有事件并且不再需要它之后自动删除每个中继日志文件。</font><font style="vertical-align: inherit;">没有明确的机制来删除中继日志，因为SQL线程负责这样做。</font><font style="vertical-align: inherit;">但是，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旋转中继日志会影响SQL线程何时删除它们。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="slave-logs-status"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.4.2从站状态日志</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        复制从服务器创建两个日志。</font><font style="vertical-align: inherit;">默认情况下，这些日志是名为</font></font><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and的</font><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，
         </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在数据目录中创建。</font><font style="vertical-align: inherit;">这些文件的名称和位置可以分别使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-file"><code class="option">--master-info-file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        和</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-info-file"><code class="option">--relay-log-info-file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">进行更改</font><font style="vertical-align: inherit;">。</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用适当的选项启动服务器，</font><font style="vertical-align: inherit;">可以将这些日志中的任一个或两个日志写入</font><font style="vertical-align: inherit;">数据库中的</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">：使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_master-info-repository"><code class="option">--master-info-repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将主信息日志写入
         </font></font><code class="literal">mysql.slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中，并用于
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-info-repository"><code class="option">--relay-log-info-repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将中继日志信息日志写入
         </font></font><code class="literal">mysql.slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这两个状态日志包含类似</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句</font><font style="vertical-align: inherit;">输出中显示的信息，</font><font style="vertical-align: inherit;">在</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#replication-slave-sql" title="13.4.2用于控制从服务器的SQL语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.4.2节“控制从属服务器的SQL语句”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对此进行了讨论
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于状态日志存储在磁盘上，因此它们在从服务器关闭时仍然存在。</font><font style="vertical-align: inherit;">下一次从站启动时，它会读取两个日志，以确定它在从主站读取二进制日志和处理其自己的中继日志方面的进展。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        主信息日志文件或表应该受到保护，因为它包含用于连接到主服务器的密码。</font><font style="vertical-align: inherit;">参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#password-logging" title="6.1.2.3密码和记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.3节“密码和记录”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        设置
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_info_repository"><code class="literal">master_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以
         </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够提高抵御意外暂停。</font><font style="vertical-align: inherit;">主信息日志存储恢复从属服务器I / O线程所需的信息，中继日志信息日志存储恢复SQL线程所需的信息。</font><font style="vertical-align: inherit;">表的更新与事务一起提交，这意味着即使在服务器停止的情况下，它们中的信息也始终与应用于数据库的信息一致。</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在从站上启用</font><font style="vertical-align: inherit;">该
         </font><font style="vertical-align: inherit;">选项才能保证弹性。</font><font style="vertical-align: inherit;">有关更多详细信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt" title="16.3.2处理意外的复制从站暂停"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.2节“处理意外暂停的复制从属”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从I / O线程更新主信息日志。</font><font style="vertical-align: inherit;">下表显示了</font></font><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中的行，
         </font></font><code class="literal">mysql.slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的列和显示的列</font><font style="vertical-align: inherit;">之间的对应关系
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="informaltable">
<table summary="The correspondence between the lines in the master.info file, the columns in the mysql.slave_master_info table, and the columns displayed by SHOW SLAVE STATUS."><colgroup><col width="16%"><col width="31%"><col width="40%"><col width="18%"></colgroup><thead><tr>
            <th scope="col"><code class="filename">master.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 文件行</font></font></th>
            <th scope="col"><code class="literal">slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 表列</font></font></th>
            <th scope="col"><code class="literal">SHOW SLAVE STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 柱</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
            <td><code class="literal">Number_of_lines</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[没有]</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中的行数或表中的列数</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
            <td><code class="literal">Master_log_name</code></td>
            <td><code class="literal">Master_Log_File</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前正在从主设备读取的主二进制日志的名称</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
            <td><code class="literal">Master_log_pos</code></td>
            <td><code class="literal">Read_Master_Log_Pos</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主二进制日志中已经从主设备读取的当前位置</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
            <td><code class="literal">Host</code></td>
            <td><code class="literal">Master_Host</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机的主机名</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">五</font></font></td>
            <td><code class="literal">User_name</code></td>
            <td><code class="literal">Master_User</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于连接到主服务器的用户名</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
            <td><code class="literal">User_password</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码（未显示</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于连接到主设备的密码</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
            <td><code class="literal">Port</code></td>
            <td><code class="literal">Master_Port</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于连接到主站的网络端口</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
            <td><code class="literal">Connect_retry</code></td>
            <td><code class="literal">Connect_Retry</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在尝试重新连接到主设备之前，从设备将等待的时间（以秒为单位）</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></td>
            <td><code class="literal">Enabled_ssl</code></td>
            <td><code class="literal">Master_SSL_Allowed</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示服务器是否支持SSL连接</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></td>
            <td><code class="literal">Ssl_ca</code></td>
            <td><code class="literal">Master_SSL_CA_File</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于证书颁发机构（CA）证书的文件</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></td>
            <td><code class="literal">Ssl_capath</code></td>
            <td><code class="literal">Master_SSL_CA_Path</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书颁发机构（CA）证书的路径</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></td>
            <td><code class="literal">Ssl_cert</code></td>
            <td><code class="literal">Master_SSL_Cert</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL证书文件的名称</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13</font></font></td>
            <td><code class="literal">Ssl_cipher</code></td>
            <td><code class="literal">Master_SSL_Cipher</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL连接握手中使用的可能密码列表</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14</font></font></td>
            <td><code class="literal">Ssl_key</code></td>
            <td><code class="literal">Master_SSL_Key</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL密钥文件的名称</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15</font></font></td>
            <td><code class="literal">Ssl_verify_server_cert</code></td>
            <td><code class="literal">Master_SSL_Verify_Server_Cert</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否验证服务器证书</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></td>
            <td><code class="literal">Heartbeat</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[没有]</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制心跳之间的时间间隔（以秒为单位）</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></td>
            <td><code class="literal">Bind</code></td>
            <td><code class="literal">Master_Bind</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应使用哪个从站的网络接口连接到主站</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18</font></font></td>
            <td><code class="literal">Ignored_server_ids</code></td>
            <td><code class="literal">Replicate_Ignore_Server_Ids</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要忽略的服务器标识列表。</font><font style="vertical-align: inherit;">请注意，对于
               </font></font><code class="literal">Ignored_server_ids</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器标识列表，前面是要忽略的服务器标识总数。</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19</font></font></td>
            <td><code class="literal">Uuid</code></td>
            <td><code class="literal">Master_UUID</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主人的唯一ID</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20</font></font></td>
            <td><code class="literal">Retry_count</code></td>
            <td><code class="literal">Master_Retry_Count</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许重新连接的最大次数</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21</font></font></td>
            <td><code class="literal">Ssl_crl</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[没有]</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL证书撤销列表文件的路径</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22</font></font></td>
            <td><code class="literal">Ssl_crl_path</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[没有]</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含ssl证书吊销列表文件的目录的路径</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23</font></font></td>
            <td><code class="literal">Enabled_auto_position</code></td>
            <td><code class="literal">Auto_position</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果自动定位正在使用或没有使用</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24</font></font></td>
            <td><code class="literal">Channel_name</code></td>
            <td><code class="literal">Channel_name</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制通道的名称</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25</font></font></td>
            <td><code class="literal">Tls_Version</code></td>
            <td><code class="literal">Master_TLS_Version</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主站上的TLS版本</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从属SQL线程更新中继日志信息日志。</font><font style="vertical-align: inherit;">该
         </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件包含行数和复制延迟值。</font><font style="vertical-align: inherit;">下表显示了</font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中的行，
         </font></font><code class="literal">mysql.slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的列和显示的列</font><font style="vertical-align: inherit;">之间的对应关系
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="informaltable">
<table summary="The correspondence between the lines in the relay-log.info file, the columns in the mysql.slave_relay_log_info table, and the columns displayed by SHOW SLAVE STATUS."><colgroup><col width="15%"><col width="30%"><col width="40%"><col width="20%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入 </font></font><code class="filename">relay-log.info</code></th>
            <th scope="col"><code class="literal">slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 表列</font></font></th>
            <th scope="col"><code class="literal">SHOW SLAVE STATUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 柱</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
            <td><code class="literal">Number_of_lines</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[没有]</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中的行数或表中的行数</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
            <td><code class="literal">Relay_log_name</code></td>
            <td><code class="literal">Relay_Log_File</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前中继日志文件的名称</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
            <td><code class="literal">Relay_log_pos</code></td>
            <td><code class="literal">Relay_Log_Pos</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中继日志文件中的当前位置; </font><font style="vertical-align: inherit;">事件到这个位置已经在从数据库上执行了</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
            <td><code class="literal">Master_log_name</code></td>
            <td><code class="literal">Relay_Master_Log_File</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取中继日志文件中事件的主二进制日志文件的名称</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">五</font></font></td>
            <td><code class="literal">Master_log_pos</code></td>
            <td><code class="literal">Exec_Master_Log_Pos</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主站的二进制日志文件中已经执行的事件的等效位置</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
            <td><code class="literal">Sql_delay</code></td>
            <td><code class="literal">SQL_Delay</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站必须滞后主站的秒数</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
            <td><code class="literal">Number_of_workers</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[没有]</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于并行执行复制事件（事务）的从属工作线程数</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
            <td><code class="literal">Id</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[没有]</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于内部目的的ID; </font><font style="vertical-align: inherit;">目前这总是1</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></td>
            <td><code class="literal">Channel_name</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHANNEL_NAME</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制通道的名称</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.6之前的MySQL版本中，该
         </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件不包含行数或延迟值（且该
         </font></font><code class="literal">slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表不可用）。
</font></font></p>
<div class="informaltable">
<table summary="The correspondence between lines in the relay-log.info file and items that appear in the Status column."><colgroup><col width="15%"><col width="35%"><col width="50%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态栏</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
            <td><code class="literal">Relay_Log_File</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前中继日志文件的名称</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
            <td><code class="literal">Relay_Log_Pos</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中继日志文件中的当前位置; </font><font style="vertical-align: inherit;">事件到这个位置已经在从数据库上执行了</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
            <td><code class="literal">Relay_Master_Log_File</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取中继日志文件中事件的主二进制日志文件的名称</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
            <td><code class="literal">Exec_Master_Log_Pos</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主站的二进制日志文件中已经执行的事件的等效位置</font></font></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您将从服务器降级到比MySQL 5.6旧的版本，则旧服务器不会</font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正确</font><font style="vertical-align: inherit;">读取该
           </font><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">要解决这个问题，请在文本编辑器中修改该文件，方法是删除包含行数的起始行。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">文件没有刷新到磁盘</font><font style="vertical-align: inherit;">
        ，则</font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">内容</font><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">显示的状态</font><font style="vertical-align: inherit;">可能不匹配
         </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">理想情况下，您应该只查看
         </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离线的奴隶（即</font></font><code class="literal">mysqld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有运行）。</font><font style="vertical-align: inherit;">对于正在运行的系统，您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或查询
         </font></font><code class="literal">slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，如果你正在写的状态日志表。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        备份从站的数据时，应备份这两个状态日志以及中继日志文件。</font><font style="vertical-align: inherit;">从从站恢复数据后，需要使用状态日志才能恢复复制。</font><font style="vertical-align: inherit;">如果您丢失了中继日志，但仍然有中继日志信息日志，则可以通过检查它来确定SQL线程在主二进制日志中执行的距离。</font><font style="vertical-align: inherit;">然后你可以使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
         </font></font><code class="literal">MASTER_LOG_FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">MASTER_LOG_POS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项告诉奴隶从该点重新读取二进制日志。</font><font style="vertical-align: inherit;">当然，这要求二进制日志仍然存在于主服务器上。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-rules"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5服务器如何评估复制过滤规则</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-rules-db-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5.1评估数据库级复制和二进制日志记录选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-rules-table-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5.2评估表级复制选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-rules-examples"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5.3复制规则应用程序</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果主服务器不向二进制日志写入语句，则不会复制语句。</font><font style="vertical-align: inherit;">如果服务器确实记录了该语句，则该语句被发送到所有从站，并且每个从站确定是执行还是忽略它。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在主服务器上，通过使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来控制二进制日志记录</font><font style="vertical-align: inherit;">，您可以控制要记录更改的数据库</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关服务器在评估这些选项时使用的规则的说明，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules-db-options" title="16.2.5.1评估数据库级复制和二进制日志记录选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5.1节“数据库级复制和二进制日志记录选项的评估”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您不应该使用这些选项来控制复制哪些数据库和表。</font><font style="vertical-align: inherit;">相反，在从站上使用过滤来控制在从站上执行的事件。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在从站方面，根据</font></font><code class="option">--replicate-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站的启动选项</font><font style="vertical-align: inherit;">决定是否执行或忽略来自主站的语句
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）也可以使用该</font></font><code class="literal">CHANGE REPLICATION FILTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">动态设置由这些选项管理的过滤器
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">控制这些过滤器的规则是相同的，无论它们是在使用</font></font><code class="option">--replicate-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动时</font><font style="vertical-align: inherit;">还是在从属服务器运行时创建的</font></font><code class="literal">CHANGE REPLICATION
      FILTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在最简单的情况下，当没有
       </font></font><code class="option">--replicate-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项时，从设备执行从主设备收到的所有语句。</font><font style="vertical-align: inherit;">否则，结果取决于给定的特定选项。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先检查</font><font style="vertical-align: inherit;">
      数据库级选项（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）; </font><font style="vertical-align: inherit;">有关此过程的说明，</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules-db-options" title="16.2.5.1评估数据库级复制和二进制日志记录选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5.1节“数据库级复制和二进制日志记录选项的评估”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果没有使用数据库级别的选项，则选项检查将转到可能正在使用的任何表级选项（</font><font style="vertical-align: inherit;">有关这些</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules-table-options" title="16.2.5.2评估表级复制选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的讨论，</font><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules-table-options" title="16.2.5.2评估表级复制选项"><font style="vertical-align: inherit;">第16.2.5.2节“表级复制选项的评估”</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果使用一个或多个数据库级选项但没有匹配，则不会复制该语句。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于仅影响数据库语句（也就是
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-database" title="13.1.1 ALTER DATABASE语法"><code class="literal">ALTER DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），数据库级选项总是优先于任何
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">换句话说，对于这些语句，
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当且仅当没有适用的数据库级选项时才检查选项。</font><font style="vertical-align: inherit;">这是从以前版本的MySQL中改变的行为，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE
      dbx</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果从机已经启动，那么</font><font style="vertical-align: inherit;">语句
       </font><font style="vertical-align: inherit;">不会被复制</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（错误＃46110）
    </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db=dbx</code></a>
      <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table=db%.t1</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了更容易确定选项集的效果，建议避免混合使用</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
      和</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ignore</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，或者使用通配符和非wildcard选项。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-rewrite-db"><code class="option">--replicate-rewrite-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      指定了</font><font style="vertical-align: inherit;">任何</font><font style="vertical-align: inherit;">选项，则在</font></font><code class="option">--replicate-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试过滤规则</font><font style="vertical-align: inherit;">之前应用这些选项
       </font><font style="vertical-align: inherit;">。
</font></font></p><a class="indexterm" name="idm140528027104400"></a><a class="indexterm" name="idm140528027102896"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        所有的复制过滤选项都遵循相同的区分大小写规则，这些规则适用于MySQL服务器中其他位置的数据库和表名称，包括</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_lower_case_table_names"><code class="literal">lower_case_table_names</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的影响
         </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-rules-db-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5.1评估数据库级复制和二进制日志记录选项</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在评估复制选项时，从服务器首先检查是否存在任何应用程序
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或时
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，过程相似，但在主站上检查选项。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        检查匹配的数据库取决于正在处理的语句的二进制日志格式。</font><font style="vertical-align: inherit;">如果语句已使用行格式记录，则要更改数据的数据库是检查的数据库。</font><font style="vertical-align: inherit;">如果语句已使用语句格式记录，则默认数据库（用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">指定
         </font><font style="vertical-align: inherit;">）是检查的数据库。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          只有DML语句可以使用行格式记录。</font><font style="vertical-align: inherit;">DDL语句始终以语句形式记录，即使是
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，所有DDL语句总是按照基于语句的复制规则进行过滤。</font><font style="vertical-align: inherit;">这意味着您必须使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">显式选择缺省数据库
           </font><font style="vertical-align: inherit;">，以便应用DDL语句。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于复制，涉及的步骤在此处列出：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用哪种记录格式？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  测试默认数据库。
                </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  测试受更改影响的数据库。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有什么
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  数据库是否匹配其中的任何一个？

</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          继续到第4步。
                        </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                          忽略更新并退出。
</font></font></p></li></ul>
</div>
<p>
                </p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  继续执行第3步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有什么
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选择吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  数据库是否匹配其中的任何一个？

</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          忽略更新并退出。
                        </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                          继续执行第4步。
</font></font></p></li></ul>
</div>
<p>
                </p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  继续执行第4步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            继续检查表级复制选项，如果有的话。</font><font style="vertical-align: inherit;">有关如何检查这些选项的说明，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules-table-options" title="16.2.5.2评估表级复制选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5.2节“表级复制选项的评估”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              现阶段仍然允许的声明尚未实际执行。</font><font style="vertical-align: inherit;">在所有表级选项（如果有）都被检查之前，语句不会被执行，并且该过程的结果允许执行语句。
</font></font></p>
</div>
</li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于二进制日志记录，涉及的步骤在这里列出：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是否有任何</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选择？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  继续执行第2步。
                </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  记录声明并退出。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是否有默认数据库（有任何数据库被选中</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  继续执行第3步。
                </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  忽略声明并退出。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有一个默认数据库。</font><font style="vertical-align: inherit;">有什么
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  它们中的任何一个与数据库匹配吗？

</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          记录声明并退出。
                        </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                          忽略声明并退出。
</font></font></p></li></ul>
</div>
<p>
                </p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  继续执行第4步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是否有任何
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-ignore-db"><code class="option">--binlog-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项与数据库匹配？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  忽略声明并退出。
                </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  记录声明并退出。
</font></font></p></li></ul>
</div>
</li></ol>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于基于语句的日志记录，一个例外是只为给定的规则做</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE
          DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-database" title="13.1.1 ALTER DATABASE语法"><code class="literal">ALTER
          DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP
          DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。</font><font style="vertical-align: inherit;">在这些情况下，</font><font style="vertical-align: inherit;">
          在确定是否记录或忽略更新时</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在</font><span class="emphasis"><em><font style="vertical-align: inherit;">创建，更改或删除</font></em></span><font style="vertical-align: inherit;">的数据库会替换默认数据库。
</font></font></p>
</div>
<p>
        <a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有时可能意味着
         </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略其他数据库</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，使用基于语句的日志记录时，仅运行的服务器
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_binlog-do-db"><code class="option">--binlog-do-db=sales</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会写入缺省数据库与其不同的二进制日志语句</font></font><code class="literal">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当使用具有相同选项的基于行的日志记录时，服务器仅记录那些更改数据的更新</font></font><code class="literal">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-rules-table-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5.2评估表级复制选项</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有在满足以下两个条件之一的情况下，从机才会检查并评估表格选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            没有找到匹配的数据库选项。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            找到了一个或多个数据库选项，</font><font style="vertical-align: inherit;">根据前一节中描述的规则</font><font style="vertical-align: inherit;">评估其达到</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件（请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules-db-options" title="16.2.5.1评估数据库级复制和二进制日志记录选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5.1节“数据库级复制和二进制日志记录选项的评估”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        首先，作为初步条件，从机检查是否启用基于语句的复制。</font><font style="vertical-align: inherit;">如果是这样，并且语句发生在一个存储的函数中，则从属执行语句并退出。</font><font style="vertical-align: inherit;">如果启用了基于行的复制，从属设备不知道主设备上存储的功能是否发生了语句，所以此条件不适用。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于基于语句的复制，复制事件表示语句（组成给定事件的所有更改都与单个SQL语句关联）; </font><font style="vertical-align: inherit;">对于基于行的复制，每个事件代表单个表行中的更改（因此</font></font><code class="literal">UPDATE mytable SET mycol =
          1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会产生许多基于行的事件</font><font style="vertical-align: inherit;">等单个语句</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">从事件角度来看，检查表选项的过程对于基于行和基于语句的复制都是相同的。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        达到这一点后，如果没有表格选项，从属设备只执行所有事件。</font><font style="vertical-align: inherit;">如果有任何
         </font><font style="vertical-align: inherit;">
        选项</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，则该事件必须与其中的一个匹配，如果要执行的话; </font><font style="vertical-align: inherit;">否则，它被忽略。</font><font style="vertical-align: inherit;">如果有任何
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项，则执行所有事件，除了那些匹配任何这些选项的事件。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下步骤更详细地描述了此评估。</font><font style="vertical-align: inherit;">起点是评估数据库级选项的结束，如
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rules-db-options" title="16.2.5.1评估数据库级复制和二进制日志记录选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.5.1节“数据库级复制和二进制日志记录选项的评估”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有没有表复制选项？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  继续执行第2步。
                </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  执行更新并退出。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用哪种记录格式？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  对每个执行更新的语句执行其余步骤。
                </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  执行表格行每次更新的其余步骤。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有什么
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  表中的任何一个匹配吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      执行更新并退出。
                    </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                      继续执行第4步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  继续执行第4步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有什么
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选择吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  表中的任何一个匹配吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      忽略更新并退出。
                    </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                      继续执行第5步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  继续执行第5步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有什么
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选择吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  表中的任何一个匹配吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      执行更新并退出。
                    </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                      继续执行第6步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  继续执行第6步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有什么
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选择吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  表中的任何一个匹配吗？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      忽略更新并退出。
                    </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                      继续执行第7步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  继续执行第7步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是否有另一张桌子需要测试？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  回到步骤3。
                </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  继续执行第8步。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是否有任何
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选择？
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  忽略更新并退出。
                </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                  执行更新并退出。
</font></font></p></li></ul>
</div>
</li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果单个SQL语句对</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or或
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          option </font><font style="vertical-align: inherit;">所包含的</font><font style="vertical-align: inherit;">表以及另一个由</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项</font><font style="vertical-align: inherit;">忽略的表进行操作，则
           </font><font style="vertical-align: inherit;">基于语句的复制将停止
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从机必须执行或忽略完整的语句（它构成一个复制事件），并且它不能从逻辑上做到这一点。</font><font style="vertical-align: inherit;">这也适用于DDL语句的基于行的复制，因为DDL语句总是记录为语句，而不考虑有效的日志格式。</font><font style="vertical-align: inherit;">可以更新包含的表和被忽略的表并且仍然可以成功复制的唯一语句类型是DML语句，该语句已记录
          </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-rules-examples"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5.3复制规则应用程序</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节提供了有关复制筛选选项的不同组合的其他说明和使用示例。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表中给出了一些典型的复制过滤器规则类型组合：
</font></font></p>
<div class="informaltable">
<table summary="Typical combinations of replication filter rule types and the outcome of each."><colgroup><col width="40%"><col width="60%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件（选项类型）</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"></font><code class="option">--replicate-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根本</font><font style="vertical-align: inherit;">没有</font><font style="vertical-align: inherit;">选择：</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从机执行从主机接收到的所有事件。</font></font></td>
          </tr><tr>
            <td scope="row"><code class="option">--replicate-*-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 选项，但没有表格选项：</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站使用数据库选项接受或忽略事件。</font><font style="vertical-align: inherit;">它执行这些选项允许的所有事件，因为没有表限制。</font></font></td>
          </tr><tr>
            <td scope="row"><code class="option">--replicate-*-table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 选项，但没有数据库选项：</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有事件都在数据库检查阶段被接受，因为没有数据库条件。</font><font style="vertical-align: inherit;">从机只根据表选项执行或忽略事件。</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库和表格选项的组合：</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站使用数据库选项接受或忽略事件。</font><font style="vertical-align: inherit;">然后根据表选项评估这些选项所允许的所有事件。</font><font style="vertical-align: inherit;">这有时会导致看起来违反直觉的结果，这可能会有所不同，具体取决于您使用的是基于语句还是基于行的复制; </font><font style="vertical-align: inherit;">看一个例子的文字。</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下面是一个更复杂的例子，在这个例子中，我们检查了基于声明和基于行的设置的结果。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设我们</font><font style="vertical-align: inherit;">在主</font></font><code class="literal">mytbl1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font></font><code class="literal">db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">mytbl2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">有两个表</font></font><code class="literal">db2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且从属设备正在运行，但有以下选项（并且没有其他复制过滤选项）：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">replicate-ignore-db = db1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
replicate-do-table = db2.tbl2</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        现在我们在master上执行以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用db1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO db2.tbl2 VALUES（1）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从站上的结果根据二进制日志格式而有很大差异，在任何情况下都可能与初始预期不符。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句的复制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">USE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
           </font></font><code class="literal">db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成为默认数据库。</font><font style="vertical-align: inherit;">因此该
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项匹配，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且该
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句被忽略</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">表格选项未被选中。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在使用基于行的复制时，默认数据库对从机读取数据库选项的方式没有影响。</font><font style="vertical-align: inherit;">因此，该
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句在</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理选项方式上</font><font style="vertical-align: inherit;">没有区别
           </font><font style="vertical-align: inherit;">：由该选项指定的数据库与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句更改数据</font><font style="vertical-align: inherit;">的数据库不匹配</font><font style="vertical-align: inherit;">，因此从属程序继续检查表选项。</font><font style="vertical-align: inherit;">指定
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的表匹配要更新的表，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并插入行</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="replication-solutions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3复制解决方案</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1使用复制进行备份</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.2处理意外的复制从站暂停</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-diffengines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.3使用不同的主存储引擎和从属存储引擎进行复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-scaleout"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.4使用复制进行扩展</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-partitioning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.5将不同的数据库复制到不同的从站</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-performance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.6提高复制性能</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-switch"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.7在故障转移期间切换主站</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-encrypted-connections"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.8设置复制以使用加密连接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-semisync"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9半同步复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-delayed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.10延迟复制</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    复制可以在许多不同的环境中用于各种目的。</font><font style="vertical-align: inherit;">本节提供关于为特定解决方案类型使用复制的一般说明和建议。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关在备份环境中使用复制的信息（包括有关设置，备份过程和要备份的文件的注意事项），请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups" title="16.3.1使用复制进行备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.1节“使用复制进行备份”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关在主服务器和从服务器上使用不同存储引擎的建议和技巧，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-diffengines" title="16.3.3使用不同的主存储引擎和从属存储引擎进行复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.3节“使用不同的主存储引擎和从属存储引擎进行复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    将复制用作横向扩展解决方案需要对使用解决方案的应用程序的逻辑和操作进行一些更改。</font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-scaleout" title="16.3.4使用复制进行扩展"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.4节“使用复制进行横向扩展”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    出于性能或数据分发的原因，您可能希望将不同的数据库复制到不同的复制从服务器。</font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-partitioning" title="16.3.5将不同的数据库复制到不同的从站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.5节“将不同的数据库复制到不同的从站”</font></font></a>
  </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    随着复制从站数量的增加，主站上的负载可能会增加并导致性能下降（因为需要将二进制日志复制到每个从站）。</font><font style="vertical-align: inherit;">有关提高复制性能的提示（包括将单个辅助服务器用作复制主服务器），请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-performance" title="16.3.6提高复制性能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.6节“提高复制性能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关切换主站或</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-switch" title="16.3.7在故障转移期间切换主站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将从</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">站作为紧急故障切换解决方案的一部分转换为主站的指导，请参见
     </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-switch" title="16.3.7在故障转移期间切换主站"><font style="vertical-align: inherit;">第16.3.7节“在故障切换期间切换主站”</font></a><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    为了保护您的复制通信，您可以加密通信通道。</font><font style="vertical-align: inherit;">有关逐步说明，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-encrypted-connections" title="16.3.8设置复制以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.8节“设置复制以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-solutions-backups"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1使用复制进行备份</font></font></h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups-mysqldump"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1.1使用mysqldump备份一个从站</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups-rawdata"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1.2从从站备份原始数据</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups-read-only"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1.3通过只读方式备份主机或从机</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要将复制用作备份解决方案，请将主站中的数据复制到从站，然后备份数据从站。</font><font style="vertical-align: inherit;">从站可以暂停和关闭而不影响主站的运行操作，因此您可以生成一个有效的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实时</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">快照，
       </font><font style="vertical-align: inherit;">否则这些数据会要求关闭主站。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      备份数据库的方式取决于数据库的大小以及是仅备份数据还是备份数据和复制从属状态，以便在发生故障时重建从站。</font><font style="vertical-align: inherit;">因此有两个选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您使用复制作为解决方案来备份主服务器上的数据，并且数据库的大小不是很大，那么</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具可能是合适的。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups-mysqldump" title="16.3.1.1使用mysqldump备份一个从站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.1.1节“使用mysqldump备份一个从站”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于较大型的数据库，如果</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不切实际或效率低下，则可以备份原始数据文件。</font><font style="vertical-align: inherit;">使用原始数据文件选项还意味着您可以备份二进制和中继日志，以便在发生从站故障时重新创建从站。</font><font style="vertical-align: inherit;">有关更多信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups-rawdata" title="16.3.1.2从从站备份原始数据"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.1.2节“从从站备份原始数据”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      另一种可用于主服务器或从服务器的备份策略是将服务器置于只读状态。</font><font style="vertical-align: inherit;">该备份是针对只读服务器执行的，然后该服务器将恢复到其通常的读/写操作状态。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups-read-only" title="16.3.1.3通过只读方式备份主机或从机"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.1.3节“通过使其只读来备份主站或从站”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-solutions-backups-mysqldump"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1.1使用mysqldump备份一个从站</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建数据库副本使您能够以一种格式捕获数据库中的所有数据，以便将信息导入另一个MySQL服务器实例中（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.5.4节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 数据库备份程序“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">由于信息的格式是SQL语句，因此如果您需要在紧急情况下访问数据，则可以轻松地将该文件分发并应用到正在运行的服务器。</font><font style="vertical-align: inherit;">但是，如果数据集的大小非常大，则</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能不切实际。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump时</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，应该在启动转储过程之前停止从服务器上的复制，以确保转储包含一组一致的数据：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            停止从属处理请求。</font><font style="vertical-align: inherit;">你可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在slave上完全停止复制
             </font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin stop-slave</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或者，您可以仅停止从属SQL线程来暂停事件执行：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -e 'STOP SLAVE SQL_THREAD;'</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这使得从站可以继续从主站的二进制日志接收数据更改事件，并使用I / O线程将它们存储在中继日志中，但可以防止从站执行这些事件并更改其数据。</font><font style="vertical-align: inherit;">在繁忙的复制环境中，允许在备份期间运行I / O线程可能会在重新启动从属SQL线程时加速追赶过程。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来转储你的数据库。</font><font style="vertical-align: inherit;">您可以转储所有数据库或选择要转储的数据库。</font><font style="vertical-align: inherit;">例如，要转储所有数据库：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --all-databases &gt; fulldb.dump</code></strong></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            转储完成后，再次启动从属操作：
</font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin start-slave</code></strong></pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在前面的示例中，您可能希望将登录凭据（用户名，密码）添加到命令中，并将该过程捆绑到可以每天自动运行的脚本中。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您使用这种方法，请确保您监控从复制过程，以确保运行备份所用的时间不会影响从服务器跟上主服务器事件的能力。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-administration-status" title="16.1.7.1检查复制状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.7.1节“检查复制状态”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果从站无法跟上，则可能需要添加另一个从站并分配备份过程。</font><font style="vertical-align: inherit;">有关如何配置此方案的示例，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-partitioning" title="16.3.5将不同的数据库复制到不同的从站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.5节“将不同的数据库复制到不同的从站”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-solutions-backups-rawdata"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1.2从从站备份原始数据</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了保证复制文件的完整性，在从属服务器关闭时，应该在MySQL复制从服务器上备份原始数据文件。</font><font style="vertical-align: inherit;">如果MySQL服务器仍在运行，后台任务可能仍然在更新数据库文件，特别是那些涉及具有后台进程的存储引擎的文件</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">与此同时</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这些问题应该在崩溃恢复期间得到解决，但由于在备份过程中可以关闭从服务器而不影响主服务器的执行，所以利用这种能力是有意义的。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        关闭服务器并备份文件：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            关闭从属MySQL服务器：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin shutdown</code></strong></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            复制数据文件。</font><font style="vertical-align: inherit;">您可以使用任何合适的复制或存档实用程序，包括</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tar</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinZip</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，假设数据目录位于当前目录下，则可以按以下方式存档整个目录：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>tar cf /tmp/dbbackup.tar ./data</code></strong></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            再次启动MySQL服务器。</font><font style="vertical-align: inherit;">在Unix下：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqld_safe &amp;</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在Windows下：
</font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\&gt; </font></font><strong class="userinput"><code>"C:\Program Files\MySQL\MySQL Server 5.7\bin\mysqld"</code></strong></pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通常你应该备份从属MySQL服务器的整个数据目录。</font><font style="vertical-align: inherit;">如果您希望能够恢复数据并作为从站运行（例如，在从站发生故障时），则除了从站数据之外，还应备份从站状态文件，主站信息和中继日志信息库以及中继日志文件。</font><font style="vertical-align: inherit;">恢复从站的数据后需要这些文件才能恢复复制。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您丢失了中继日志但仍有该
         </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，则可以通过检查它来确定SQL主线程在主二进制日志中执行的程度。</font><font style="vertical-align: inherit;">然后你可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
        TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="literal">MASTER_LOG_FILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">MASTER_LOG_POS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项告诉奴隶从该点重新读取二进制日志。</font><font style="vertical-align: inherit;">这要求二进制日志仍然存在于主服务器上。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果从站正在复制
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，则还应备份</font></font><code class="filename">SQL_LOAD-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站用于此目录的</font><font style="vertical-align: inherit;">所有
         </font><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">从机需要这些文件来恢复任何中断</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作的</font><font style="vertical-align: inherit;">复制
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该目录的位置是该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-load-tmpdir"><code class="option">--slave-load-tmpdir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果服务器未使用该选项启动，则目录位置是</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-solutions-backups-read-only"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1.3通过只读方式备份主机或从机</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过获取全局读锁和</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        操作系统变量来更改要备份的服务器的只读状态，可以</font><font style="vertical-align: inherit;">在复制设置中备份主服务器或从服务器</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使服务器为只读，以便它仅处理检索并阻止更新。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            执行备份。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将服务器更改回正常的读/写状态。
</font></font></p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节中的说明将要备份的服务器置于对从服务器获取数据的备份方法</font><font style="vertical-align: inherit;">
          （</font><font style="vertical-align: inherit;">如</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump）</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.5.4节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 数据库备份程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）安全的状态。</font><font style="vertical-align: inherit;">您不应尝试通过直接复制文件来使用这些说明进行二进制备份，因为服务器可能仍会修改缓存在内存中的数据，而不会刷新到磁盘。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下说明介绍了如何为主服务器和从服务器执行此操作。</font><font style="vertical-align: inherit;">对于这里讨论的两种情况，假设您有以下复制设置：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            主服务器M1
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以M1作为主设​​备的从服务器S1
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            客户端C1连接到M1
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            客户端C2连接到S1
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在任何一种情况下，获取全局读锁和操作</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">的语句
         </font><font style="vertical-align: inherit;">都将在要备份的服务器上执行，并且不会传播到该服务器的任何从服务器。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方案1：使用只读主机进行备份</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过在其上执行这些语句将主M1置于只读状态：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>FLUSH TABLES WITH READ LOCK;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SET GLOBAL read_only = ON;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当M1处于只读状态时，以下属性成立：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由C1发送到M1的更新请求将被阻塞，因为服务器处于只读模式。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由C1发送到M1的查询结果请求将成功。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在M1上进行备份是安全的。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在S1上进行备份并不安全。</font><font style="vertical-align: inherit;">该服务器仍在运行，可能正在处理来自客户端C2的二进制日志或更新请求
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        虽然M1只读，请执行备份。</font><font style="vertical-align: inherit;">例如，你可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        M1上的备份操作完成后，通过执行以下语句将M1恢复到正常操作状态：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SET GLOBAL read_only = OFF;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        尽管在M1上执行备份是安全的（就备份而言），但对于性能来说，这并不是最佳选择，因为M1的客户端被阻止执行更新。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此策略适用于在复制设置中备份主服务器，但也可用于非复制设置中的单个服务器。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方案2：使用只读从站进行备份</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过在其上执行以下语句将从站S1置于只读状态：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>FLUSH TABLES WITH READ LOCK;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SET GLOBAL read_only = ON;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当S1处于只读状态时，以下属性成立：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            主设备M1将继续运行，因此在主设备上进行备份并不安全。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从站S1停止，因此在从站S1上进行备份是安全的。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些属性为流行的备份方案提供了基础：让一个从属忙一段时间执行备份不是问题，因为它不会影响整个网络，并且系统在备份过程中仍在运行。</font><font style="vertical-align: inherit;">特别是，客户端仍然可以在主服务器上执行更新，而不受从服务器上的备份活动的影响。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        虽然S1是只读的，但请执行备份。</font><font style="vertical-align: inherit;">例如，你可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在S1上的备份操作完成后，通过执行以下语句将S1恢复到其正常操作状态：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SET GLOBAL read_only = OFF;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从设备恢复正常操作后，它将通过跟踪主设备二进制日志中未完成的更新再次与主设备同步。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-solutions-unexpected-slave-halt"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.2处理意外的复制从站暂停</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528026789024"></a><a class="indexterm" name="idm140528026787952"></a><a class="indexterm" name="idm140528026786464"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了使复制对服务器的意外停止具有弹性（有时称为崩溃安全），在停止之前，从服务器必须能够恢复其状态。</font><font style="vertical-align: inherit;">本节介绍在复制过程中意外停止从站的影响以及如何配置从站以获得最佳恢复机会以继续复制。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在意外停止从属之后，重新启动后，I / O线程必须恢复有关接收到哪些事务的信息，并且SQL线程必须恢复已经执行了哪些事务。</font><font style="vertical-align: inherit;">有关恢复所需的从站日志的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      恢复所需的信息传统上存储在数据目录中的文件中，这些文件在事务处理完成后被更新。</font><font style="vertical-align: inherit;">这有可能会失去与主服务器的同步，这取决于处理从服务器停止的事务的哪个阶段，甚至是文件本身的损坏。</font><font style="vertical-align: inherit;">在MySQL 5.7中，您可以使用表来存储恢复信息。</font><font style="vertical-align: inherit;">表的更新与事务一起提交，这意味着即使在服务器停止的情况下，它们中的信息也始终与应用于数据库的信息一致。</font><font style="vertical-align: inherit;">这些表是</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此事务性存储引擎</font><font style="vertical-align: inherit;">创建的</font><font style="vertical-align: inherit;">，并且在重新启动时信息始终可恢复。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要配置MySQL 5.7存储在表中复制信息，设置
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_master_info_repository"><code class="literal">master_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到
       </font></font><code class="literal">TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，服务器将</font></font><code class="literal">mysql.slave_master_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">恢复I / O线程</font><font style="vertical-align: inherit;">所需的信息</font><font style="vertical-align: inherit;">以及
       </font><font style="vertical-align: inherit;">表中恢复SQL线程所需的信息存储起来
       </font></font><code class="literal">mysql.slave_relay_log_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      事实上复制从服务器如何从意外暂停中恢复受到所选复制方法的影响，无论从服务器是单线程还是多线程，变量的设置
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及是否</font></font><code class="literal">MASTER_AUTO_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在使用</font><font style="vertical-align: inherit;">诸如此类的功能</font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      下表显示了这些不同因素对单线程从服务器如何从意外中止恢复的影响。
</font></font></p>
<div class="table">
<a name="idm140528026771424"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表16.3影响单线程复制从恢复的因素</font></font></b></p>
<div class="table-contents">
<table frame="all"><colgroup><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"></colgroup><thead><tr>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              GTID
            </font></font></p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MASTER_AUTO_POSITION
            </font></font></p></th>
          <th scope="col"><p>
              <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery</code></a>
            </p></th>
          <th scope="col"><p>
              <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a>
            </p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              崩溃类型
            </font></font></p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              保证恢复
            </font></font></p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              中继日志影响
            </font></font></p></th>
        </tr></thead><tbody><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              丢失
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              OS
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              丢失
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              遗迹
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              OS
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              遗迹
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              丢失
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              遗迹
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              OS
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              遗迹
            </font></font></p></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如表格所示，当使用单线程从设备时，以下配置最容易出现意外暂停：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用GTID和</font></font><code class="literal">MASTER_AUTO_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set时</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过此配置，设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和其他变量不会影响恢复。</font><font style="vertical-align: inherit;">请注意，为保证恢复，
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在从站上设置（这是默认设置），以便在每次写入时将从站的二进制日志同步到磁盘。</font><font style="vertical-align: inherit;">否则，提交的事务可能不会出现在从机的二进制日志中。

        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在使用基于文件位置的复制时，设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository=TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。

</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在恢复期间，中继日志丢失。
</font></font></p>
</div>
<p>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      下表显示了这些不同因素对多线程从设备如何从意外停止中恢复的影响。
</font></font></p>
<div class="table">
<a name="idm140528026681872"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表16.4影响多线程复制从恢复的因素</font></font></b></p>
<div class="table-contents">
<table frame="all"><colgroup><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"><col width="1.0%" align="center"></colgroup><thead><tr>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              GTID
            </font></font></p></th>
          <th scope="col"><p>
              <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log"><code class="literal">sync_relay_log</code></a>
            </p></th>
          <th scope="col"><p>
              <code class="literal">MASTER_AUTO_POSITION</code>
            </p></th>
          <th scope="col"><p>
              <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery</code></a>
            </p></th>
          <th scope="col"><p>
              <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a>
            </p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              崩溃类型
            </font></font></p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              保证恢复
            </font></font></p></th>
          <th scope="col"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              中继日志影响
            </font></font></p></th>
        </tr></thead><tbody><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              丢失
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              &gt; 1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              丢失
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              &gt; 1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              OS
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              丢失
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              遗迹
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              OS
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              遗迹
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上
            </font></font></p></td>
          <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              丢失
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              遗迹
            </font></font></p></td>
        </tr><tr valign="middle">
          <td scope="row"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              上
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              1
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关闭
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              0
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              任何
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              OS
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有
            </font></font></p></td>
          <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              遗迹
            </font></font></p></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如表所示，使用多线程从设备时，以下配置最容易出现意外中断：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用GTID和</font></font><code class="literal">MASTER_AUTO_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set时</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过此配置，设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和其他变量不会影响恢复。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用文件位置基于阵列的复制，设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log"><code class="literal">sync_relay_log=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_info_repository"><code class="literal">relay_log_info_repository=TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。

</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在恢复期间，中继日志丢失。
</font></font></p>
</div>
<p>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      需要注意的是</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log"><code class="literal">sync_relay_log=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，每个事务需要写入中继日志，</font><font style="vertical-align: inherit;">这一点很重要
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">虽然这种设置对于意外停止最有弹性，但最多只有一个未写入的事务丢失，但它也有可能大大增加存储负载。</font><font style="vertical-align: inherit;">如果没有
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log"><code class="literal">sync_relay_log=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，意外停止的影响取决于操作系统如何处理中继日志。</font><font style="vertical-align: inherit;">还要注意什么时候
      </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当下一次在意外停止后启动从站</font><font style="vertical-align: inherit;">，继电器日志将作为恢复的一部分进行处理。</font><font style="vertical-align: inherit;">此过程完成后，中继日志将被删除。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用上面建议的基于文件位置的复制配置的多线程复制从属站的意外停止可能导致中继日志的事务不一致（事务序列中的空白），这是由意外中断引起的。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-transaction-inconsistencies" title="16.4.1.33复制和事务不一致"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.33节“复制和事务不一致性”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7.13和更高版本中，如果中继日志恢复进程遇到这种事务不一致性，它们将被填充并且恢复过程会自动继续。</font><font style="vertical-align: inherit;">在MySQL 5.7.13之前的MySQL版本中，这个过程不是自动的，并且需要启动服务器</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，启动从属</font><font style="vertical-align: inherit;">服务器
      </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START
      SLAVE UNTIL SQL_AFTER_MTS_GAPS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修复任何事务不一致，然后重新启动slave
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当您使用多源复制时，并且
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_relay_log_recovery"><code class="literal">relay_log_recovery=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在由于意外中断而重新启动后，所有复制通道都将通过中继日志恢复过程。</font><font style="vertical-align: inherit;">填充由于多线程从站意外停止而在中继日志中发现的任何不一致。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-solutions-diffengines"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.3使用不同的主存储引擎和从属存储引擎进行复制</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      复制过程主站上的源表和从站上的复制表是否使用不同的引擎类型无关紧要。</font><font style="vertical-align: inherit;">事实上，
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_storage_engine"><code class="literal">storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量不会被复制。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这在复制过程中提供了许多优点，因为您可以针对不同的复制方案利用不同的引擎类型。</font><font style="vertical-align: inherit;">例如，在典型的横向扩展场景中（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-scaleout" title="16.3.4使用复制进行扩展"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.4节“使用复制进行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">横向扩展
       </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-scaleout" title="16.3.4使用复制进行扩展"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">），您希望</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器上</font><font style="vertical-align: inherit;">使用
       </font><font style="vertical-align: inherit;">表来利用事务功能，但</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在事务处理的从服务器上</font><font style="vertical-align: inherit;">使用
       </font><font style="vertical-align: inherit;">因为只读取数据，所以不需要支持。</font><font style="vertical-align: inherit;">在数据记录环境中使用复制时，可能需要</font></font><code class="literal">Archive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属设备上</font><font style="vertical-align: inherit;">使用
       </font><font style="vertical-align: inherit;">存储引擎。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在主服务器和从服务器上配置不同的引擎取决于您如何设置初始复制过程：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器上创建数据库快照，则可以编辑转储文件文本以更改每个表上使用的引擎类型。
        </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          另一种替代方法</font><font style="vertical-align: inherit;">是，在使用转储在从站上构建数据之前，禁用不想在从站上使用的引擎类型。</font><font style="vertical-align: inherit;">例如，您可以</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-federated</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在您的从站上</font><font style="vertical-align: inherit;">添加该
           </font><font style="vertical-align: inherit;">选项来禁用
           </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎。</font><font style="vertical-align: inherit;">如果某个特定的引擎不存在要创建的表，那么MySQL通常会使用默认的引擎类型</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这要求
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_engine_substitution"><code class="literal">NO_ENGINE_SUBSTITUTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不启用SQL模式。）如果您想以这种方式禁用其他引擎，则可能需要考虑构建一个特殊的二进制文件，以用于仅支持所需引擎的从站。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您使用原始数据文件（二进制备份）来设置从站，您将无法更改初始表格格式。</font><font style="vertical-align: inherit;">相反，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从机启动后用于更改表类型。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于主服务器上当前没有表的新主/从复制设置，请避免在创建新表时指定引擎类型。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您已经在运行复制解决方案并希望将现有表格转换为其他引擎类型，请按照下列步骤操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          停止从服务器运行复制更新：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>STOP SLAVE;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这将使您能够不中断地更改引擎类型。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个要更改的表</font><font style="vertical-align: inherit;">
          执行一次</font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">ALTER TABLE ...
          ENGINE='<em class="replaceable"><code>engine_type</code></em>'</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          再次启动从复制过程：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>START SLAVE;</code></strong>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      虽然
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量是不可复制的，要知道，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
      TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      语句包括发动机规格将被正确复制到奴隶。</font><font style="vertical-align: inherit;">例如，如果您有一个CSV表格并执行：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE csvtable Engine='MyISAM';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      上述语句将被复制到从站，并且从站上的引擎类型将被转换为</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即使您之前已将从站上的表格类型更改为CSV以外的引擎。</font><font style="vertical-align: inherit;">如果你想保留主从机上的引擎差异，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当创建一个新表时</font><font style="vertical-align: inherit;">，你应该小心地</font><font style="vertical-align: inherit;">在主机上</font><font style="vertical-align: inherit;">使用这个
       </font><font style="vertical-align: inherit;">变量。</font><font style="vertical-align: inherit;">例如，而不是：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE tablea (columna int) Engine=MyISAM;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用这种格式：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SET default_storage_engine=MyISAM;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>CREATE TABLE tablea (columna int);</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      复制时，该
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量将被忽略，并且该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
      TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句将使用从机的默认引擎在从机上执行。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-solutions-scaleout"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.4使用复制进行扩展</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以使用复制作为横向扩展解决方案; </font><font style="vertical-align: inherit;">也就是说，您希望在多个数据库服务器之间分割数据库查询的负载，这在一些合理的限制内。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      因为复制的工作方式是从一个主服务器分配到一个或多个从服务器，所以使用复制进行向外扩展最适合在读取数量较多且写入/更新数量较少的环境中使用。</font><font style="vertical-align: inherit;">大多数网站都适用于此类别，用户可以浏览网站，阅读文章，发布帖子或查看产品。</font><font style="vertical-align: inherit;">更新只在会话管理期间进行，或者在进行购买或向论坛添加评论/消息时进行。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在这种情况下的复制使您可以将读取分配到复制从服务器上，同时仍然允许Web服务器在需要写入时与复制主服务器进行通信。</font><font style="vertical-align: inherit;">您可以在</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#figure_replication-scaleout" title="图16.1在扩展过程中使用复制来提高性能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.1“使用复制来提高扩展期间的性能”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到该场景的示例复制布局</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="figure">
<a name="figure_replication-scaleout"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.1在扩展过程中使用复制来提高性能</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/scaleout.png" width="687" height="341" alt="来自客户端的传入请求被定向到负载均衡器，该负载均衡器在多个Web客户端之间分发客户端数据。 Web客户端写入的数据直接指向一台MySQL主服务器，而Web客户端写入的数据则指向三台MySQL从服务器之一。 从MySQL主服务器复制到三个MySQL从服务器。">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果负责数据库访问的代码部分已被正确抽象/模块化，将其转换为使用复制设置运行应该非常流畅和简单。</font><font style="vertical-align: inherit;">更改数据库访问的实现，将所有写入操作发送到主机，并将读取发送到主机或从机。</font><font style="vertical-align: inherit;">如果你的代码没有这个抽象级别，那么建立一个复制系统给你提供清理它的机会和动机。</font><font style="vertical-align: inherit;">首先创建一个实现以下功能的包装库或模块：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">safe_writer_connect()</code>
        </p></li><li class="listitem"><p>
          <code class="literal">safe_reader_connect()</code>
        </p></li><li class="listitem"><p>
          <code class="literal">safe_reader_statement()</code>
        </p></li><li class="listitem"><p>
          <code class="literal">safe_writer_statement()</code>
</p></li></ul>
</div>
<p>
      <code class="literal">safe_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个函数名中意味着该函数负责处理所有错误条件。</font><font style="vertical-align: inherit;">您可以为这些功能使用不同的名称。</font><font style="vertical-align: inherit;">重要的是要有一个统一的接口来连接读取，连接写入，读取和写入。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      然后将您的客户端代码转换为使用包装库。</font><font style="vertical-align: inherit;">起初这可能是一个痛苦而可怕的过程，但从长远来看，这是有益的。</font><font style="vertical-align: inherit;">所有使用上述方法的应用程序都可以利用主/从配置，即使是涉及多个从站的配置。</font><font style="vertical-align: inherit;">代码更容易维护，添加故障排除选项很简单。</font><font style="vertical-align: inherit;">您只需修改一个或两个功能; </font><font style="vertical-align: inherit;">例如记录每个语句花了多长时间，或者在发布的语句中哪个语句给你一个错误。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您编写了大量代码，则可能需要使用</font><font style="vertical-align: inherit;">标准MySQL分发版附带</font><font style="vertical-align: inherit;">的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#replace-utility" title="4.8.3替换 - 字符串替换实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替换</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序</font><font style="vertical-align: inherit;">自动执行转换任务</font><font style="vertical-align: inherit;">，或编写自己的转换脚本。</font><font style="vertical-align: inherit;">理想情况下，您的代码使用一致的编程风格约定。</font><font style="vertical-align: inherit;">如果不是，那么无论如何你可能会更好地重写它，或者至少通过手动修改它来使用一致的风格。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-solutions-partitioning"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.5将不同的数据库复制到不同的从站</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有些情况下，您只有一个主服务器，并且想要将不同的数据库复制到不同的从服务器。</font><font style="vertical-align: inherit;">例如，您可能希望将不同的销售数据分配给不同的部门，以便在数据分析期间分散负载。</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#figure_replication-multi-db" title="图16.2使用复制来复制数据库以分离复制从节点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.2“使用复制来复制数据库以分离复制从节点”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了此布局的示例
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="figure">
<a name="figure_replication-multi-db"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.2使用复制来复制数据库以分离复制从节点</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/multi-db.png" width="424" height="178" alt="MySQL主服务器有三个数据库，databaseA，databaseB和databaseC。 DatabaseA仅复制到MySQL从站1，DatabaseB仅复制到MySQL从站2，而DatabaseC仅复制到MySQL从站3。">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以通过正常配置主站和从站来实现这种分离，然后通过使用每个从站的</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      配置选项</font><font style="vertical-align: inherit;">来限制每个从站处理的二进制日志语句
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        你应该</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用基于语句的复制时，因为基于语句的复制导致该选项的影响，根据当前选择的数据库来改变这个目的。</font><font style="vertical-align: inherit;">这也适用于混合格式复制，因为这可以使用基于语句的格式复制一些更新。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果仅使用基于行的复制</font><font style="vertical-align: inherit;">，则应该可以安全地使用
         </font><font style="vertical-align: inherit;">此目的，因为在这种情况下，当前选定的数据库对该选项的操作没有影响。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      例如，要支持</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#figure_replication-multi-db" title="图16.2使用复制来复制数据库以分离复制从节点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图16.2“使用复制来复制数据库以分离复制从节点”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示的分离
       </font><font style="vertical-align: inherit;">，应该在执行以下操作之前按如下方式配置每个复制从属设备
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          复制从机1应该使用
           </font></font><code class="option">--replicate-wild-do-table=databaseA.%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          复制从机2应该使用
           </font></font><code class="option">--replicate-wild-do-table=databaseB.%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          复制从站3应该使用
           </font></font><code class="option">--replicate-wild-do-table=databaseC.%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      此配置中的每个从属服务器都接收来自主服务器的完整二进制日志，但仅执行二进制日志中的那些适用于该服务器上的有效</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项所</font><font style="vertical-align: inherit;">包含的数据库和表的事件
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果在复制开始前您必须将数据同步到从站，则您有多种选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将所有数据同步到每个从站，并删除不想保留的数据库，表或两者。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个数据库创建一个单独的转储文件，并在每个从属设备上加载相应的转储文件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用原始数据文件转储，并仅包含每个从属服务器所需的特定文件和数据库。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            除非您使用</font><font style="vertical-align: inherit;">
            ，</font><font style="vertical-align: inherit;">否则</font><font style="vertical-align: inherit;">这不适用于</font><font style="vertical-align: inherit;">数据库
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-solutions-performance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.6提高复制性能</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      随着连接到主站的从站数量的增加，负载虽然很小，但也随着每个从站使用到主站的客户端连接而增加。</font><font style="vertical-align: inherit;">另外，由于每个从设备都必须收到主二进制日志的完整副本，因此主设备上的网络负载也可能会增加并造成瓶颈。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果使用连接到一个主服务器的大量从服务器，并且该主服务器也忙于处理请求（例如，作为横向扩展解决方案的一部分），则可能需要提高复制过程的性能。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      提高复制过程性能的一种方法是创建一个更深层次的复制结构，使主节点只能复制到一个从节点，并使其余的节点能够连接到这个主从节点以满足各自的复制需求。</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#figure_replication-performance" title="图16.3使用其他复制主机提高性能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.3“使用其他复制主机提高性能”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了此结构的示例
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="figure">
<a name="figure_replication-performance"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.3使用其他复制主机提高性能</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/submaster-performance.png" width="534" height="179" alt="服务器MySQL Master 1复制到服务器MySQL Master 2，然后再复制到服务器MySQL Slave 1，MySQL Slave 2和MySQL Slave 3。">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了达到这个目的，你必须按如下方式配置MySQL实例：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          主设备1是将所有更改和更新写入数据库的主要主设备。</font><font style="vertical-align: inherit;">应在此机器上启用二进制日志记录。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          主站2是主站1的从站，它为复制结构中的其余从站提供复制功能。</font><font style="vertical-align: inherit;">Master 2是唯一允许连接到Master 1的机器。Master 2还启用了二进制日志记录，并提供
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，以便Master 1的复制指令也写入Master 2的二进制日志，以便它们可以复制到真正的从属设备。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从设备1，从设备2和从设备3作为主设备2的从设备，并复制主设备2的信息，主设备2实际上包含主设备1上记录的升级信息。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      上述解决方案减少了主要主设备上的客户端负载和网络接口负载，这可以在用作直接数据库解决方案时提高主要主设备的整体性能。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您的从服务器无法跟上主服务器上的复制过程，则有多种可用选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果可能，请将继电器日志和数据文件放在不同的物理驱动器上。</font><font style="vertical-align: inherit;">为此，请使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log"><code class="option">--relay-log</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项指定中继日志的位置。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果从服务器比主服务器慢得多，则可能需要划分将不同数据库复制到不同从服务器的责任。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-partitioning" title="16.3.5将不同的数据库复制到不同的从站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.5节“将不同的数据库复制到不同的从站”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您的主服务器使用事务并且您不关心从服务器上的事务支持，请使用
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从服务器上的另一个非事务处理引擎。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-diffengines" title="16.3.3使用不同的主存储引擎和从属存储引擎进行复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.3节“与不同的主存储引擎和从属存储引擎一起使用复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你的奴隶没有充当主人，并且你有一个潜在的解决方案来确保你可以在出现故障时启动主人，那么你可以关闭
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可以防止</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">愚蠢的</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从属人员将他们执行的事件记录到他们自己的二进制日志中。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-solutions-switch"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.7在故障转移期间切换主站</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当使用GTID进行复制时（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16.1.3
       </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;">节“使用全局事务标识符进行复制”</font></a><font style="vertical-align: inherit;">），可以使用</font><font style="vertical-align: inherit;">MySQL Utilities提供的</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlfailover</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在发生故障时在主站和从站之间提供故障切换
       </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">有关更多信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a class="ulink" href="http://dev.mysql.com/doc/mysql-utilities/1.5/en/mysqlfailover.html" target="_top"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlfailover</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 自动复制运行状况监视和故障转移</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果你不使用GTID，因此不能使用
       </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlfailover</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你必须建立一个主人和一个或多个奴隶; </font><font style="vertical-align: inherit;">那么您需要编写一个监视主服务器的应用程序或脚本来检查它是否已启动，并指示从服务器和应用程序在发生故障时更改为另一主服务器。</font><font style="vertical-align: inherit;">本节讨论以这种方式设置故障转移时遇到的一些问题。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">告诉奴隶更改为新的主人
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从站不检查主站上的数据库是否与从站上的数据库兼容; </font><font style="vertical-align: inherit;">它只是开始读取和执行新主设备二进制日志中指定坐标的事件。</font><font style="vertical-align: inherit;">在故障切换的情况下，组中的所有服务器通常都从相同的二进制日志文件执行相同的事件，因此，如果您在制作时注意事项的来源，则不应影响数据库的结构或完整性更改。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      应该使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">运行从站
       </font><font style="vertical-align: inherit;">，如果不使用GTID，那么它们也应该在没有运行的情况下运行
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过这种方式，从设备即可在不重启从设备</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况下成为主设备
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设您具有</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#figure_replication-redundancy-before" title="图16.4使用复制的冗余，初始结构"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.4“使用复制的冗余，初始结构”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#figure_replication-redundancy-before" title="图16.4使用复制的冗余，初始结构"><font style="vertical-align: inherit;">所示的结构</font></a><font style="vertical-align: inherit;">。
</font></font></p>
<div class="figure">
<a name="figure_replication-redundancy-before"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.4使用复制的冗余，初始结构</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/redundancy-before.png" width="504" height="353" alt="两个Web客户端将数据库读取和数据库写入指向一台MySQL主服务器。 MySQL主服务器复制到MySQL从站1，MySQL从站2和MySQL从站3。">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在此图中，</font></font><code class="literal">MySQL Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存主数据库，</font></font><code class="literal">MySQL Slave</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机是复制从服务器，并且</font></font><code class="literal">Web Client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机正在发出数据库读取和写入操作。</font><font style="vertical-align: inherit;">只发布读取（并且通常会连接到从站）的Web客户端不会显示，因为它们在发生故障时不需要切换到新的服务器。</font><font style="vertical-align: inherit;">有关读/写扩展复制结构的更详细示例，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-scaleout" title="16.3.4使用复制进行扩展"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.4节“为扩展使用复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个MySQL从（</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Slave
      2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">Slave 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是与运行从属</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和无
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因为从设备从主设备收到的更新没有记录在二进制日志中，除非
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定，所以每个从设备的二进制日志最初都是空的。</font><font style="vertical-align: inherit;">如果由于某种原因</font></font><code class="literal">MySQL Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变得不可用，您可以选择其中一个奴隶成为新的主人。</font><font style="vertical-align: inherit;">例如，如果你选择</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所有</font></font><code class="literal">Web
      Clients</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该重定向到</font></font><code class="literal">Slave
      1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将更新写入其二进制日志。
      </font></font><code class="literal">Slave 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后</font></font><code class="literal">Slave 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该从中复制</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      运行没有从机的原因
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是为了防止从机接收更新两次，以防一个从机成为新主机。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用，它会</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在其自己的二进制日志中</font><font style="vertical-align: inherit;">写入它</font><font style="vertical-align: inherit;">从其</font><font style="vertical-align: inherit;">接收的任何更新</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着，当</font></font><code class="literal">Slave
      2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从其</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变为
       </font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主人时，它可能会从</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它已经
       </font><font style="vertical-align: inherit;">收到的更新中收到更新</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      确保所有从站都在其中继日志中处理了任何语句。</font><font style="vertical-align: inherit;">在每个奴隶，问题</font></font><code class="literal">STOP SLAVE
      IO_THREAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后检查输出，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直到你看到
       </font></font><code class="literal">Has read all relay log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果所有从站均为真，则可以将其重新配置为新的设置。</font><font style="vertical-align: inherit;">在</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被提升为主人</font><font style="vertical-align: inherit;">的奴隶</font><font style="vertical-align: inherit;">上，问题</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-master" title="13.4.1.2 RESET MASTER语法"><code class="literal">RESET MASTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在其他奴隶</font></font><code class="literal">Slave 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Slave
      3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">CHANGE MASTER TO MASTER_HOST='Slave1'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（其中
       </font></font><code class="literal">'Slave1'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代表真正的主机名
       </font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">要使用</font></font><code class="literal">CHANGE MASTER
      TO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，添加有关如何连接到的所有信息
       </font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自</font></font><code class="literal">Slave 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">Slave 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>user</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><em class="replaceable"><code>port</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在</font></font><code class="literal">CHANGE
      MASTER TO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font><font style="vertical-align: inherit;">发布</font><font style="vertical-align: inherit;">语句时，不需要指定</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要读取</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">二进制日志文件或日志位置</font><font style="vertical-align: inherit;">的名称</font><font style="vertical-align: inherit;">，因为第一个二进制日志文件和位置4是缺省值。</font><font style="vertical-align: inherit;">最后，执行
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font><code class="literal">Slave
      2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Slave 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一旦新的复制设置就绪后，您需要告诉每个
       </font></font><code class="literal">Web Client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人指示其声明
       </font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从这一点上来说，通过发送的所有更新语句</font></font><code class="literal">Web Client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来</font></font><code class="literal">Slave
      1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被写入二进制日志</font></font><code class="literal">Slave
      1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后包含发送到每一个更新语句
       </font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">死了。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      生成的服务器结构</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#figure_replication-redundancy-after" title="图16.5主站故障后使用复制的冗余"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图16.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示
       </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#figure_replication-redundancy-after" title="图16.5主站故障后使用复制的冗余"><font style="vertical-align: inherit;">，“Master故障后使用复制的冗余”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
<div class="figure">
<a name="figure_replication-redundancy-after"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图16.5主站故障后使用复制的冗余</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/redundancy-after.png" width="538" height="432" alt="MySQL主服务器发生故障，不再连接到复制拓扑中。 这两个Web客户端现在将数据库读取和数据库写入指向MySQL主站1（这是新主站）。 MySQL Slave 1复制到MySQL Slave 2和MySQL Slave 3。">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次变得可用时，你应该让它成为一个奴隶</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要做到这一点，请</font><font style="vertical-align: inherit;">发布</font><font style="vertical-align: inherit;">与</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">发布的声明</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE
      MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">。
      </font><font style="vertical-align: inherit;">然后成为它的奴隶，</font><font style="vertical-align: inherit;">并拿起</font><font style="vertical-align: inherit;">它在脱机时错过</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">写作。
    </font></font><code class="literal">Slave
      2</code><font style="vertical-align: inherit;"></font><code class="literal">Slave 3</code><font style="vertical-align: inherit;"></font><code class="literal">Master</code><font style="vertical-align: inherit;"></font><code class="literal">S1ave
      1</code><font style="vertical-align: inherit;"></font><code class="literal">Web Client</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新</font><font style="vertical-align: inherit;">制作</font><font style="vertical-align: inherit;">主文件，请使用上述过程，就好像</font></font><code class="literal">Slave 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可用并且</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将成为新主文件。</font><font style="vertical-align: inherit;">在此过程中，不要忘了运行
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-master" title="13.4.1.2 RESET MASTER语法"><code class="literal">RESET MASTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
       </font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制作之前</font></font><code class="literal">Slave
      1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Slave 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Slave
      3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奴隶</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果你没有这样做，奴隶们可能会从</font></font><code class="literal">Web
      Client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序</font></font><code class="literal">Master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变得不可用</font><font style="vertical-align: inherit;">之前的应用程序中</font><font style="vertical-align: inherit;">提取过时的写入</font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您应该意识到，即使共享同一个主服务器，从服务器之间也没有同步，因此一些从服务器可能远远超过其他服务器。</font><font style="vertical-align: inherit;">这意味着在某些情况下，前面示例中列出的过程可能无法按预期工作。</font><font style="vertical-align: inherit;">但实际上，所有从站上的中继日志应该相对靠近。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      让应用程序了解主服务器位置的一种方法是为主服务器提供动态DNS条目。</font><font style="vertical-align: inherit;">有了
       </font></font><code class="literal">bind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><code class="filename">nsupdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      动态更新DNS。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-solutions-encrypted-connections"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.8设置复制以使用加密连接</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要使用加密连接传输复制期间所需的二进制日志，主服务器和从属服务器都必须支持加密的网络连接。</font><font style="vertical-align: inherit;">如果其中一个服务器不支持加密连接（因为它尚未被编译或配置），则无法通过加密连接进行复制。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为复制设置加密连接类似于客户端/服务器连接。</font><font style="vertical-align: inherit;">您必须获取（或创建）您可以在主设备上使用的合适安全证书以及每台从设备上的类似证书（来自同一证书颁发机构）。</font><font style="vertical-align: inherit;">您还必须获取合适的密钥文件。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关为加密连接设置服务器和客户端的更多信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/security.html#using-encrypted-connections" title="6.4.1配置MySQL以使用加密连接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4.1节“配置MySQL以使用加密连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要在主站上启用加密连接，您必须创建或获取合适的证书和密钥文件，然后将以下配置选项添加到主</font></font><code class="literal">[mysqld]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">站</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">部分中的主站
       </font><font style="vertical-align: inherit;">配置中</font><font style="vertical-align: inherit;">，并根据需要更改文件名：
    </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL的CA = cacert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL证书=服务器cert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL的密钥=服务器key.pem</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      文件的路径可能是相对的或绝对的; </font><font style="vertical-align: inherit;">我们建议您始终使用完整路径来达到此目的。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      选项如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：证书颁发机构（CA）证书文件的路径名称。</font><font style="vertical-align: inherit;">（</font></font><code class="option">--ssl-capath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似但指定CA证书文件目录的路径名称。）
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：服务器公钥证书文件的路径名。</font><font style="vertical-align: inherit;">这可以发送给客户端，并根据它拥有的CA证书进行身份验证。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：服务器私钥文件的路径名称。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在从站上，有两种方式指定使用加密连接到主站所需的信息。</font><font style="vertical-align: inherit;">您可以在从属文件的</font></font><code class="literal">[client]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分中
       </font><font style="vertical-align: inherit;">命名从属证书和密钥
       </font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，也可以使用以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
      TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">明确指定该信息</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用选项文件命名从属证书和密钥文件，请将以下行添加到</font></font><code class="literal">[client]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从属</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">部分，
           </font><font style="vertical-align: inherit;">根据需要更改文件名称：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[客户]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL的CA = cacert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL证书=客户端 -  cert.pem</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSL的密钥=客户端 -  key.pem</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          重新启动从服务器，使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项防止</font><font style="vertical-align: inherit;">从服务器
           </font><font style="vertical-align: inherit;">连接到主服务器。</font><font style="vertical-align: inherit;">使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定的主配置，使用</font></font><code class="literal">MASTER_SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选择使用加密连接：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CHANGE MASTER TO</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>MASTER_HOST='master_hostname',</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>MASTER_USER='replicate',</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>MASTER_PASSWORD='<em class="replaceable"><code>password</code></em>',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_SSL=1;</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">指定证书和密钥名称
           </font><font style="vertical-align: inherit;">，请附加适当的
           </font><font style="vertical-align: inherit;">
          选项：
        </font></font><code class="literal">MASTER_SSL_<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CHANGE MASTER TO</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>MASTER_HOST='master_hostname',</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>MASTER_USER='replicate',</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>MASTER_PASSWORD='<em class="replaceable"><code>password</code></em>',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_SSL=1,</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_SSL_CA = 'ca_file_name',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_SSL_CAPATH = 'ca_directory_name',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_SSL_CERT = 'cert_file_name',</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>MASTER_SSL_KEY = 'key_file_name';</code></strong>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      主信息更新后，启动从复制过程：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>START SLAVE;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      语句来确认加密连接已成功建立。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER
      TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的</font><font style="vertical-align: inherit;">更多信息</font><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.4.2.1节“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将主</font><font style="vertical-align: inherit;">语句</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><font style="vertical-align: inherit;">更改为”</font></a><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果要在复制过程中强制使用加密连接，请创建一个用户并使用该</font></font><code class="literal">REQUIRE
      SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，然后向该用户授予该
       </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。</font><font style="vertical-align: inherit;">例如：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font><font style="vertical-align: inherit;">
    - &gt; </font><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>CREATE USER 'repl'@'%.example.com' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>'</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>REQUIRE SSL;</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>GRANT REPLICATION SLAVE ON *.*</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>TO 'repl'@'%.example.com';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果该帐户已存在，则可以</font></font><code class="literal">REQUIRE
      SSL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下语句</font><font style="vertical-align: inherit;">添加该帐户</font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER USER 'repl'@'%.example.com' REQUIRE SSL;</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-semisync"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9半同步复制</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-semisync-interface"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9.1半同步复制管理界面</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-semisync-installation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9.2半同步复制安装和配置</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-semisync-monitoring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9.3半同步复制监视</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528026275696"></a><a class="indexterm" name="idm140528026274640"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      除了内置的异步复制之外，MySQL 5.7还支持通过插件实现的半同步复制接口。</font><font style="vertical-align: inherit;">本节讨论什么是半同步复制以及它是如何工作的。</font><font style="vertical-align: inherit;">以下部分介绍了半同步复制的管理界面以及如何安装，配置和监视它。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      默认情况下MySQL复制是异步的。</font><font style="vertical-align: inherit;">主站将事件写入其二进制日志，但不知道是否或何时从站检索并处理它们。</font><font style="vertical-align: inherit;">通过异步复制，如果主服务器崩溃，它提交的事务可能没有传输到任何从服务器。</font><font style="vertical-align: inherit;">因此，在这种情况下，从主服务器到从服务器的故障切换可能会导致故障切换到缺少相对于主服务器的事务的服务器。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      半同步复制可用作异步复制的替代方法：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个从机指示它连接到主机时是否具有半同步功能。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果在主端启用了半同步复制，并且至少有一个半同步从端，则该线程会在主块上执行事务提交，并等待至少一个半异步从服务器确认已收到事务的所有事件，或直到发生超时。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          只有事件写入其中继日志并刷新到磁盘后，从设备才会确认收到事务的事件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果没有任何从服务器确认事务发生超时，主服务器将恢复异步复制。</font><font style="vertical-align: inherit;">当至少有一个半同步从站追上时，主站返回到半同步复制。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          半主动同步复制必须在主控和从控双方上启用。</font><font style="vertical-align: inherit;">如果在主服务器上禁用了半同步复制，或者在主服务器上但在不从服务器上启用了半同步复制，则主服务器使用异步复制。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当主设备阻塞（等待从设备确认）时，它不会返回到执行事务的会话。</font><font style="vertical-align: inherit;">块结束时，主站返回到会话，然后可以继续执行其他语句。</font><font style="vertical-align: inherit;">此时，交易已在主方承诺，至少一个从方已确认收到其事件。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在继续之前，主站必须接收的从站确认数量可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_wait_for_slave_count"><code class="literal">rpl_semi_sync_master_wait_for_slave_count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      系统变量</font><font style="vertical-align: inherit;">进行配置
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认值是1。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在写入二进制日志的回滚之后，也会发生阻塞，当修改非事务表的事务回滚时发生。</font><font style="vertical-align: inherit;">回滚的事务即使对事务性表没有任何影响也会被记录下来，因为对非事务性表的修改不能回滚并且必须发送给从机。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于事务上下文中没有发生的语句（也就是说，当没有</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">START
      TRANSACTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
       </font><font style="vertical-align: inherit;">已经开始事务时
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET autocommit =
      0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），自动提交被启用，并且每个语句隐式提交。</font><font style="vertical-align: inherit;">使用半同步复制，每个这样的语句的主模块就像为显式事务提交一样。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要理解</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半</font></font></span><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><span class="quote"><span class="quote"><font style="vertical-align: inherit;">同步复制</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”</font></span><font style="vertical-align: inherit;">中
       </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”的</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含义，请将其与异步和完全同步复制进行比较：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过异步复制，主服务器将事件写入其二进制日志，从服务器准备就绪时请求它们。</font><font style="vertical-align: inherit;">无法保证任何事件都会触及任何奴隶。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在完全同步复制的情况下，当主服务器提交事务时，所有从服务器也将在主服务器返回执行事务的会话之前提交事务。</font><font style="vertical-align: inherit;">这样做的缺点是可能会有很多延迟来完成交易。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          半同步复制属于异步复制和完全同步复制。</font><font style="vertical-align: inherit;">主站仅等待至少一个从站接收并记录事件。</font><font style="vertical-align: inherit;">它不会等待所有的从站确认收到，它只需要收据，而不是事件在从站完全执行和提交。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      与异步复制相比，半同步复制提供了改进的数据完整性，因为当提交成功返回时，已知数据至少存在两处。</font><font style="vertical-align: inherit;">在半同步主设备收到来自由其配置的从设备数量的确认之前
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_wait_for_slave_count"><code class="literal">rpl_semi_sync_master_wait_for_slave_count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该事务处于保持状态且未提交。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      半同步复制还通过限制二进制日志事件可以从主机发送到从机的速度来限制繁忙会话的速率限制。</font><font style="vertical-align: inherit;">当一个用户太忙时，这会降低速度，这在某些部署情况下非常有用。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      半同步复制确实有一些性能影响，因为由于需要等待从站，提交速度较慢。</font><font style="vertical-align: inherit;">这是增加数据完整性的折衷。</font><font style="vertical-align: inherit;">减速量至少是向从站发送提交并等待从设备收到确认的TCP / IP往返时间。</font><font style="vertical-align: inherit;">这意味着半同步复制最适合于通过快速网络进行通信的近距离服务器，而对于通过慢速网络进行通信的远距离服务器来说，最差。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      所述
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_wait_point"><code class="literal">rpl_semi_sync_master_wait_point</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      系统变量控制在该状态返回到执行的事务客户端之前一个半同步复制主等待交易收据的从属确认的点。</font><font style="vertical-align: inherit;">这些值是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">AFTER_SYNC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（缺省值）：主服务器将每个事务写入其二进制日志和从服务器，并将二进制日志同步到磁盘。</font><font style="vertical-align: inherit;">同步后，主设备等待从设备确认事务接收。</font><font style="vertical-align: inherit;">在收到确认后，主服务器将事务提交给存储引擎，并将结果返回给客户端，然后客户端可以继续。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">AFTER_COMMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：主服务器将每个事务写入其二进制日志和从服务器，同步二进制日志，并将事务提交给存储引擎。</font><font style="vertical-align: inherit;">主提交后等待从服务器确认事务接收。</font><font style="vertical-align: inherit;">在收到确认后，主人将结果返回给客户端，然后客户端可以继续。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这些设置的复制特征不同，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用时</font></font><code class="literal">AFTER_SYNC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所有客户端同时看到已提交的事务：在从服务器确认并承诺主服务器上的存储引擎之后。</font><font style="vertical-align: inherit;">因此，所有客户端都会在主服务器上看到相同的数据。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在主站发生故障时，主站上提交的所有事务都已复制到从站（保存到其中继日志中）。</font><font style="vertical-align: inherit;">由于从站是最新的，主站和故障转移到从站的崩溃是无损的。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用时</font></font><code class="literal">AFTER_COMMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只有在服务器提交给存储引擎并接收到从应答之后，颁发该事务的客户才会获得返回状态。</font><font style="vertical-align: inherit;">在提交之后和从属确认之前，其他客户端可以在提交客户端之前看到提交的事务。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果出现错误，从服务器不处理事务，那么在主服务器崩溃并故障切换到从服务器的情况下，这些客户端可能会看到相对于他们在主服务器上看到的数据丢失。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-semisync-interface"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9.1半同步复制管理界面</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528026236752"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        半同步复制的管理界面有几个组件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            两个插件实现半同步功能。</font><font style="vertical-align: inherit;">主侧有一个插件，从侧有一个插件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量控制插件行为。</font><font style="vertical-align: inherit;">一些例子：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_enabled"><code class="literal">rpl_semi_sync_master_enabled</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制是否在主服务器上启用半同步复制。</font><font style="vertical-align: inherit;">要启用或禁用插件，请分别将此变量设置为1或0。</font><font style="vertical-align: inherit;">默认值是0（关闭）。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_timeout"><code class="literal">rpl_semi_sync_master_timeout</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                以毫秒为单位的值，用于控制主服务器在超时并恢复异步复制之前等待来自从服务器的确认提交等待的时间。</font><font style="vertical-align: inherit;">默认值是10000（10秒）。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_slave_enabled"><code class="literal">rpl_semi_sync_slave_enabled</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                类似于
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_enabled"><code class="literal">rpl_semi_sync_master_enabled</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但控制从插件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            所有
             </font><font style="vertical-align: inherit;">
            系统变量在</font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”中</font></a><font style="vertical-align: inherit;">都有描述
             </font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">rpl_semi_sync_<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            状态变量启用半同步复制监视。</font><font style="vertical-align: inherit;">一些例子：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_clients"><code class="literal">Rpl_semi_sync_master_clients</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                半同步从站的数量。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_status"><code class="literal">Rpl_semi_sync_master_status</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当前是否在主服务器上运行半同步复制。</font><font style="vertical-align: inherit;">如果插件已启用并且未提交确认，则值为1。</font><font style="vertical-align: inherit;">如果该插件未启用，或者由于提交确认超时而主站已退回到异步复制，则该值为0。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_no_tx"><code class="literal">Rpl_semi_sync_master_no_tx</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                从机未成功确认的提交数量。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_yes_tx"><code class="literal">Rpl_semi_sync_master_yes_tx</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                从机成功确认的提交数量。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_slave_status"><code class="literal">Rpl_semi_sync_slave_status</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当前是否在从站上运行半同步复制。</font><font style="vertical-align: inherit;">如果插件已启用且从属I / O线程正在运行，则为1，否则为0。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            所有
             </font><font style="vertical-align: inherit;">
            状态变量在</font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;">第5.1.7节“服务器状态变量”中</font></a><font style="vertical-align: inherit;">都有描述
             </font><font style="vertical-align: inherit;">。
</font></font><code class="literal">Rpl_semi_sync_<em class="replaceable"><code>xxx</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有安装了相应的主插件或从插件时，系统和状态变量才可用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-semisync-installation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9.2半同步复制安装和配置</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528026201264"></a><a class="indexterm" name="idm140528026199808"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        半同步复制是使用插件实现的，因此必须将插件安装到服务器中以使其可用。</font><font style="vertical-align: inherit;">插件安装完成后，您可以通过与其关联的系统变量来控制插件。</font><font style="vertical-align: inherit;">这些系统变量在安装关联插件之前不可用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何安装半同步复制插件。</font><font style="vertical-align: inherit;">有关安装插件的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-plugin-loading" title="5.5.1安装和卸载插件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.1节“安装和卸载插件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要使用半同步复制，必须满足以下要求：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            必须安装MySQL 5.5或更高版本。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            安装插件的功能需要支持动态加载的MySQL服务器。</font><font style="vertical-align: inherit;">要验证这一点，请检查</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_have_dynamic_loading"><code class="literal">have_dynamic_loading</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">是否为</font></font><code class="literal">YES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">二进制分布应该支持动态加载。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            复制必须已经有效，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-configuration" title="16.1配置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1节“配置复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不能配置多个复制通道。</font><font style="vertical-align: inherit;">半同步复制仅与默认复制通道兼容。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-channels" title="16.2.3复制通道"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.3节“复制通道”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要设置半同步复制，请使用以下说明。</font><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET
        GLOBAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里所说的语句需要的</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_super"><code class="literal">SUPER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL发行版包括主端和从端的半同步复制插件文件。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要被主服务器或从服务器使用，相应的插件库文件必须位于MySQL插件目录（由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">命名的目录
         </font><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">如有必要，请设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动时</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">以告知服务器插件目录位置。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插件库文件基名是
         </font></font><code class="literal">semisync_master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">semisync_slave</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个平台的文件名后缀都不相同（例如，</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Unix和类Unix系统，</font></font><code class="filename">.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于Windows）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        主插件库文件必须存在于主服务器的插件目录中。</font><font style="vertical-align: inherit;">从插件库文件必须存在于每个从服务器的插件目录中。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要加载插件，请</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL
        PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主站和每个要进行半同步的从站上</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">语句（</font></font><code class="filename">.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        必要时根据您的平台</font><font style="vertical-align: inherit;">调整</font><font style="vertical-align: inherit;">后缀）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在主人身上：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL PLUGIN rpl_semi_sync_master SONAME'semisync_master.so';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在每个奴隶上：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL PLUGIN rpl_semi_sync_slave SONAME'semisync_slave.so';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果在Linux上尝试安装插件导致类似于此处显示的错误，则必须安装
         </font></font><code class="literal">libimf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSTALL PLUGIN rpl_semi_sync_master SONAME 'semisync_master.so';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1126（HY000）：无法打开共享库</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'/usr/local/mysql/lib/plugin/semisync_master.so'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（错误：22 libimf.so：无法打开共享对象文件：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
无此文件或目录）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以</font></font><code class="literal">libimf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从
         </font></font><a class="ulink" href="http://dev.mysql.com/downloads/os-linux.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://dev.mysql.com/downloads/os-linux.html获取</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要查看安装了哪些插件，请使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或查询</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要验证插件安装，请检查该
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#obtaining-plugin-information" title="5.5.2获取服务器插件信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5.2节“获取服务器插件信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%semi%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PLUGIN_NAME | </font><font style="vertical-align: inherit;">PLUGIN_STATUS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">rpl_semi_sync_master | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------- + -------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果插件无法初始化，请检查服务器错误日志以获取诊断消息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在安装了半同步复制插件后，默认情况下它将被禁用。</font><font style="vertical-align: inherit;">必须在主端和从端都启用插件才能启用半同步复制。</font><font style="vertical-align: inherit;">如果只启用一方，复制将是异步的。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要控制是否启用已安装的插件，请设置适当的系统变量。</font><font style="vertical-align: inherit;">您可以在运行时使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET
        GLOBAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或在服务器启动时在命令行或选项文件中</font><font style="vertical-align: inherit;">设置这些变量</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在运行时，这些主站端系统变量可用：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL rpl_semi_sync_master_enabled = {0 | 1};</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL rpl_semi_sync_master_timeout = </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在从站方面，这个系统变量是可用的：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL rpl_semi_sync_slave_enabled = {0 | 1};
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_enabled"><code class="literal">rpl_semi_sync_master_enabled</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_slave_enabled"><code class="literal">rpl_semi_sync_slave_enabled</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该值应该为1以启用半同步复制或0以禁用它。</font><font style="vertical-align: inherit;">默认情况下，这些变量设置为0。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        因为
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_timeout"><code class="literal">rpl_semi_sync_master_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该值</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以毫秒为单位给出。</font><font style="vertical-align: inherit;">默认值是10000（10秒）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果在运行时在从站上启用半同步复制，则还必须启动从站I / O线程（如果它已在运行，则首先停止它），以使从站连接到主站并注册为半同步从站：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STOP SLAVE IO_THREAD;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
START SLAVE IO_THREAD;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果I / O线程已经运行并且没有重新启动它，则从属设备将继续使用异步复制。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在服务器启动时，控制半同步复制的变量可以设置为命令行选项或选项文件。</font><font style="vertical-align: inherit;">每次服务器启动时，选项文件中列出的设置都会生效。</font><font style="vertical-align: inherit;">例如，您可以</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按如下方式在主站和从站上</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">的变量
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在主人身上：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rpl_semi_sync_master_enabled = 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rpl_semi_sync_master_timeout = 1000＃1秒</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在每个奴隶上：
      </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rpl_semi_sync_slave_enabled = 1</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-semisync-monitoring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.9.3半同步复制监视</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528026134560"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        用于半同步复制功能的插件会公开多个可检查的系统和状态变量，以确定其配置和操作状态。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量反映了如何配置半同步复制。</font><font style="vertical-align: inherit;">要检查它们的值，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-variables" title="13.7.5.39 SHOW VARIABLES语法"><code class="literal">SHOW
        VARIABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'rpl_semi_sync%';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        状态变量使您能够监视半同步复制的操作。</font><font style="vertical-align: inherit;">要检查它们的值，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW STATUS LIKE 'Rpl_semi_sync%';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当由于提交阻塞超时或从站追赶而导致主站在异步或半同步复制之间切换时，它会</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_status"><code class="literal">Rpl_semi_sync_master_status</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        适当地</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">状态变量</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从主机上的半同步到异步复制的自动回退意味着</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_rpl_semi_sync_master_enabled"><code class="literal">rpl_semi_sync_master_enabled</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        即使当前半实时同步复制实际上不可操作时，主系统上的系统变量</font><font style="vertical-align: inherit;">也可能
         </font><font style="vertical-align: inherit;">具有值1。</font><font style="vertical-align: inherit;">您可以监视
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_status"><code class="literal">Rpl_semi_sync_master_status</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        状态变量以确定主服务器当前是使用异步还是半同步复制。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要查看连接了多少个半同步从站，请检查
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_clients"><code class="literal">Rpl_semi_sync_master_clients</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由</font><font style="vertical-align: inherit;">
        变量</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_yes_tx"><code class="literal">Rpl_semi_sync_master_yes_tx</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        和</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_master_no_tx"><code class="literal">Rpl_semi_sync_master_no_tx</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">指示已成功确认或从属失败的提交数量
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在从属方面，
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Rpl_semi_sync_slave_status"><code class="literal">Rpl_semi_sync_slave_status</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        指示当前是否正在运行半同步复制。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-delayed"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.10延迟复制</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528026112816"></a><a class="indexterm" name="idm140528026111744"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL 5.7支持延迟复制，使得从服务器故意在主服务器后面至少延迟一段指定的时间。</font><font style="vertical-align: inherit;">默认延迟是0秒。</font><font style="vertical-align: inherit;">使用该
       </font></font><code class="literal">MASTER_DELAY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将延迟设置为</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秒：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改MASTER_DELAY = MASTER_DELAY = </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从主站接收的事件至少要</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">晚于</font><font style="vertical-align: inherit;">主站执行的时间才会
       </font><font style="vertical-align: inherit;">执行。</font><font style="vertical-align: inherit;">例外情况是格式描述事件或日志文件循环事件没有延迟，这些事件只影响SQL线程的内部状态。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      延迟复制可用于以下几个目的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          防止用户在主服务器上发生错误。</font><font style="vertical-align: inherit;">数据库管理员可以将灾难发生前的时间推迟到一定时间。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          测试系统在出现滞后时的表现。</font><font style="vertical-align: inherit;">例如，在一个应用程序中，延迟可能是由于从站的负载过重造成的。</font><font style="vertical-align: inherit;">但是，产生这种负载水平可能很困难。</font><font style="vertical-align: inherit;">延迟复制可以模拟延迟，而无需模拟负载。</font><font style="vertical-align: inherit;">它也可以用来调试与滞后从属相关的条件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          检查数据库很久以前的样子，而不必重新加载备份。</font><font style="vertical-align: inherit;">例如，如果延迟时间为一周，并且DBA需要在最近几天的开发前查看数据库的外观，则可以检查延迟的从站。
</font></font></p></li></ul>
</div>
<p>
      <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立即生效并忽略任何延迟。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><code class="literal">RESET SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      将延迟重置为0。
    </font></font></p><p>
      <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 有三个字段提供有关延迟的信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">SQL_Delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：一个非负整数，表示从站必须滞后于主站的秒数。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">SQL_Remaining_Delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：当
           </font></font><code class="literal">Slave_SQL_Running_State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是时</font></font><code class="literal">Waiting
          until MASTER_DELAY seconds after master executed
          event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该字段包含一个整数，指示延迟剩下的秒数。</font><font style="vertical-align: inherit;">在其他时候，这个领域是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">Slave_SQL_Running_State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：一个字符串，指示SQL线程的状态（类似于
           </font></font><code class="literal">Slave_IO_State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">该值与</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示的SQL线程</font><font style="vertical-align: inherit;">的值相同</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当从属SQL线程在执行事件之前等待延迟时间时，将</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
      PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">显示</font><font style="vertical-align: inherit;">为</font></font><code class="literal">Waiting until MASTER_DELAY seconds after master
      executed event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="replication-notes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4复制注释和提示</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1复制功能和问题</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-compatibility"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.2 MySQL版本之间的复制兼容性</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-upgrade"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.3升级复制设置</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-problems"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.4复制故障排除</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-bugs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.5如何报告复制错误或问题</font></font></a></span></dt></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-features"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1复制功能和问题</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-auto-increment"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.1复制和AUTO_INCREMENT</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-blackhole"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.2复制和BLACKHOLE表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-charset"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.3复制和字符集</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-checksum-table"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.4复制和校验和表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-create-if-not-exists"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.5复制CREATE ...如果不存在语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-create-select"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.6复制CREATE TABLE ... SELECT语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-create-alter-drop-server"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.7 CREATE SERVER，ALTER SERVER和DROP SERVER的复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-current-user"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.8复制CURRENT_USER（）</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-drop-if-exists"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.9复制DROP ... IF EXISTS语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-differing-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.10复制主控和从属参数不同的表定义</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-directory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.11复制和目录表选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-floatvalues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.12复制和浮点值</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-fractional-seconds"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.13复制和小数秒支持</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-flush"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.14复制和FLUSH</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.15复制和系统功能</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-invoked"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.16调用特征的复制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-limit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.17复制和限制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-load-data"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.18复制和LOAD DATA INFILE</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-max-allowed-packet"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.19复制和max_allowed_pa​​cket</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-memory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.20复制和内存表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-mysqldb"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.21复制mysql系统数据库</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-optimizer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.22复制和查询优化器</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-partitioning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.23复制和分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-repair-table"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.24复制和修理表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-reserved-words"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.25复制和保留字</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-server-side-help"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.26复制服务器端帮助表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-shutdowns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.27复制和主或从关机</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-slaveerrors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.28复制期间的从站错误</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-sql-mode"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.29复制和服务器SQL模式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-temptables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.30复制和临时表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-timeout"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.31复制重试和超时</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-timezone"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.32复制和时区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-transaction-inconsistencies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.33复制和事务不一致</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-transactions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.34复制和事务</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-triggers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.35复制和触发器</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-truncate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.36复制和截断表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-user-names"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.37复制和用户名长度</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-variables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.38复制和变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/replication.html#replication-features-views"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.39复制和视图</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528026079264"></a><a class="indexterm" name="idm140528026077808"></a><a class="indexterm" name="idm140528026076736"></a><a class="indexterm" name="idm140528026075248"></a><a class="indexterm" name="idm140528026074176"></a><a class="indexterm" name="idm140528026073104"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下部分提供有关MySQL复制中支持和不支持的内容的信息，以及有关复制某些语句时可能发生的特定问题和情况的信息。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      基于语句的复制取决于主机和从机之间SQL级别的兼容性。</font><font style="vertical-align: inherit;">换句话说，成功的基于语句的复制要求主服务器和从服务器都支持使用的任何SQL功能。</font><font style="vertical-align: inherit;">如果您在主服务器上使用仅在当前版本的MySQL中可用的功能，则无法复制到使用早期版本MySQL的从服务器。</font><font style="vertical-align: inherit;">这种不兼容性也可能发生在版本系列以及版本之间。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您打算在MySQL 5.7和以前的MySQL发行版系列之间使用基于语句的复制，最好查阅</font><font style="vertical-align: inherit;">与早期发行版系列相对应</font><font style="vertical-align: inherit;">的</font></font><em class="citetitle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL参考手册</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的版本，以获取关于该系列复制特性的信息。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用基于MySQL的基于声明的复制，复制存储的例程或触发器可能存在问题。</font><font style="vertical-align: inherit;">您可以通过使用MySQL的基于行的复制来避免这些问题。</font><font style="vertical-align: inherit;">有关问题的详细列表，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-programs-logging" title="23.7存储程序的二进制记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第23.7节“存储程序的二进制日志记录”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关基于行的日志记录和基于行的复制的更多信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log-formats" title="5.4.4.1二进制日志记录格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4.1节“二进制日志记录格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关特定于复制的更多信息
       </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-and-mysql-replication" title="14.19 InnoDB和MySQL复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.19节“InnoDB和MySQL复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关使用NDB群集进行复制的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-replication" title="21.6 NDB群集复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21.6节“NDB群集复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-auto-increment"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.1复制和AUTO_INCREMENT</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528026062384"></a><a class="indexterm" name="idm140528026060896"></a><a class="indexterm" name="idm140528026059408"></a><a class="indexterm" name="idm140528026057920"></a><a class="indexterm" name="idm140528026056432"></a><a class="indexterm" name="idm140528026054944"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        基于语句的复制
         </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是正确，符合以下情况除外：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7.1之前使用基于语句的复制
             </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，从服务器上的表中的列必须与主服务器上的相同列匹配; </font><font style="vertical-align: inherit;">也就是说，
             </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列必须复制到</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            调用引起</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">更新的触发器或函数的</font><font style="vertical-align: inherit;">语句不会使用基于语句的复制正确复制。</font><font style="vertical-align: inherit;">这些陈述被标记为不安全。</font><font style="vertical-align: inherit;">（错误＃45677）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成具有包括一个复合主键的表
             </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，它是不该组合键的第一列不是基于语句的记录或复制的安全。</font><font style="vertical-align: inherit;">这些陈述被标记为不安全。</font><font style="vertical-align: inherit;">（错误＃11754117，错误＃45670）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此问题不会影响使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">，因为</font><font style="vertical-align: inherit;">具有</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_auto_increment" title="自动递增"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AUTO_INCREMENT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            列</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">表
             </font><font style="vertical-align: inherit;">至少需要一个键，其中自动增量列是唯一或最左边的列。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到表中</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能不会产生从属系统和主系统上相同行的顺序。</font><font style="vertical-align: inherit;">这是因为行编号的顺序取决于表中使用的特定存储引擎以及行插入的顺序。</font><font style="vertical-align: inherit;">如果在主站和从站上具有相同的顺序很重要，则必须在分配</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字</font><font style="vertical-align: inherit;">之前对行进行排序
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设您想将添加</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列一个表</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有列
             </font></font><code class="literal">col1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">col2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，下面的语句产生新表
             </font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同的</font><font style="vertical-align: inherit;">列：
          </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但有一个</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t2 LIKE t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE t2 ADD id INT AUTO_INCREMENT PRIMARY KEY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t2 SELECT * FROM t1 ORDER BY col1，col2;</font></font><font></font>
</pre>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为保证主站和从站的顺序相同，该</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句必须命名
               </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            刚才给出的说明受限于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-like" title="13.1.18.4 CREATE TABLE ... LIKE语法"><code class="literal">CREATE
            TABLE ... LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：外键定义被忽略，</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">INDEX DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表选项一样。</font><font style="vertical-align: inherit;">如果表定义包含任何这些特征，则</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与用于</font><font style="vertical-align: inherit;">创建
             </font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句相同</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句创建</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但添加该</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不管用于创建和填充具有该</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的副本的方法</font><font style="vertical-align: inherit;">，最后一步是删除原始表，然后重新命名副本：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE t2 RENAME t1;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            另请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#alter-table-problems" title="B.5.6.1 ALTER TABLE的问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.6.1节“ALTER TABLE的问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-blackhole"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.2复制和BLACKHOLE表</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528026013952"></a><a class="indexterm" name="idm140528026012464"></a><a class="indexterm" name="idm140528026010976"></a><a class="indexterm" name="idm140528026009488"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#blackhole-storage-engine" title="15.6 BLACKHOLE存储引擎"><code class="literal">BLACKHOLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎接受数据，而是将其丢弃，不存储。</font><font style="vertical-align: inherit;">在执行二进制日志记录时，无论使用的日志记录格式如何，对这些表的所有插入都会被记录。</font><font style="vertical-align: inherit;">取决于基于语句还是基于行的记录正在使用，更新和删除的处理方式会有所不同。</font><font style="vertical-align: inherit;">使用基于语句的记录格式，将影响</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">所有语句
         </font><font style="vertical-align: inherit;">都记录下来，但忽略它们的影响。</font><font style="vertical-align: inherit;">在使用基于行的日志记录时，只需跳过对这些表的更新和删除 - 它们不会写入二进制日志。</font><font style="vertical-align: inherit;">发生这种情况时会记录一条警告（错误号13004581）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        因此，我们建议您在使用</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#blackhole-storage-engine" title="15.6 BLACKHOLE存储引擎"><code class="literal">BLACKHOLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">复制到表时</font><font style="vertical-align: inherit;">将</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器变量设置为</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是</font></font><code class="literal">ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-charset"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.3复制和字符集</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025998240"></a><a class="indexterm" name="idm140528025996752"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下内容适用于使用不同字符集的MySQL服务器之间的复制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果主数据库的字符集与全局</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_character_set_server"><code class="literal">character_set_server</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">不同，则
             </font><font style="vertical-align: inherit;">应该设计</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，以便它们不会隐式地依赖数据库缺省字符集。</font><font style="vertical-align: inherit;">一个很好的解决方法是在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句中</font><font style="vertical-align: inherit;">明确</font><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">字符集和排序规则</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-checksum-table"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.4复制和校验和表</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025988240"></a><a class="indexterm" name="idm140528025986736"></a><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#checksum-table" title="13.7.2.3 CHECKSUM TABLE语法"><code class="literal">CHECKSUM TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回一个逐行计算的校验和，使用一种依赖于表行存储格式的方法。</font><font style="vertical-align: inherit;">不保证存储格式在MySQL版本之间保持不变，因此升级后校验和值可能会更改。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-create-if-not-exists"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.5复制CREATE ...如果不存在语句</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025982048"></a><a class="indexterm" name="idm140528025980544"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL </font></font><code class="literal">CREATE ... IF
        NOT EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在复制</font><font style="vertical-align: inherit;">各种</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">时应用这些规则</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE
            DATABASE IF NOT EXISTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论数据库是否已存在于主数据库中，</font><font style="vertical-align: inherit;">
            每个
             </font><font style="vertical-align: inherit;">语句都会被复制。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            同样，</font><font style="vertical-align: inherit;">无论是否存在主表</font><font style="vertical-align: inherit;">，都会</font><font style="vertical-align: inherit;">复制</font><font style="vertical-align: inherit;">每个
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE
            IF NOT EXISTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有a的语句
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这包括
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-like" title="13.1.18.4 CREATE TABLE ... LIKE语法"><code class="literal">CREATE
            TABLE IF NOT EXISTS ... LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">复制
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
            TABLE IF NOT EXISTS ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遵循有些不同的规则; </font><font style="vertical-align: inherit;">有关更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-create-select" title="16.4.1.6复制CREATE TABLE ... SELECT语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-create-select" title="16.4.1.6复制CREATE TABLE ... SELECT语句"><font style="vertical-align: inherit;">第16.4.1.6节“CREATE TABLE ... SELECT语句的复制”</font></a><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-event" title="13.1.12创建事件语法"><code class="literal">CREATE EVENT
            IF NOT EXISTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 总是被复制，无论该语句中指定的事件是否已经存在于主服务器上。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-create-select"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.6复制CREATE TABLE ... SELECT语句</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025964944"></a><a class="indexterm" name="idm140528025963488"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节讨论MySQL如何复制
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
        TABLE ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL 5.7不允许
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
        TABLE ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句在由语句创建的表以外的表中进行任何更改。</font><font style="vertical-align: inherit;">一些旧版本的MySQL允许这些语句这样做; </font><font style="vertical-align: inherit;">这意味着，当在MySQL 5.6或更高版本的从属服务器与运行先前版本的MySQL的主服务器之间使用基于语句的复制时，主服务器上
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
        TABLE ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他表中的更改会导致从服务器上的其他表发生故障，从而导致复制停止。</font><font style="vertical-align: inherit;">为防止这种情况发生，您应该使用基于行的复制，在主节点上运行之前重写违规语句，或者将主节点升级到MySQL 5.7。</font><font style="vertical-align: inherit;">（如果您选择升级主设备，请记住这样的
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
        TABLE ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句会在升级后失败，除非它被重写以删除对其他表的任何副作用）。使用基于行的复制时，这不是问题，因为语句会记录为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对表数据进行任何更改并记录为行插入事件，而不是整个事件
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
        TABLE ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些行为不依赖于MySQL版本：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
            TABLE ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是执行隐式提交（</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#implicit-commit" title="13.3.3导致隐式提交的语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.3.3节“导致隐式提交的语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果目标表不存在，则记录发生如下。</font><font style="vertical-align: inherit;">是否</font></font><code class="literal">IF NOT
            EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在</font><font style="vertical-align: inherit;">并不重要</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                格式：该语句按照书面记录。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式：该语句记录为一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                语句，后跟一系列插入行事件。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果语句失败，则不会记录任何内容。</font><font style="vertical-align: inherit;">这包括目标表存在并且</font></font><code class="literal">IF NOT
            EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有给出的情况。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当目标表存在并</font></font><code class="literal">IF NOT
        EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出时，MySQL 5.7会完全忽略该语句; </font><font style="vertical-align: inherit;">没有插入或记录任何东西。</font><font style="vertical-align: inherit;">在以前的MySQL版本中，处理这些语句在这方面已经发生了很大变化; </font><font style="vertical-align: inherit;">如果您正在从MySQL 5.5.6或更旧的主站</font></font><a class="ulink" href="http://dev.mysql.com/doc/refman/5.5/en/replication-features-create-if-not-exists.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到更新的从站，请参阅
         </font><a class="ulink" href="http://dev.mysql.com/doc/refman/5.5/en/replication-features-create-if-not-exists.html" target="_top"><font style="vertical-align: inherit;">CREATE ... IF NOT EXISTS语句的复制以</font></a><font style="vertical-align: inherit;">获取更多信息。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-create-alter-drop-server"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.7 CREATE SERVER，ALTER SERVER和DROP SERVER的复制</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该声明</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-server" title="13.1.7 ALTER SERVER语法"><code class="literal">ALTER SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-server" title="13.1.28 DROP SERVER语法"><code class="literal">DROP SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有写入到二进制日志，无论二进制日志记录格式是在使用中。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-current-user"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.8复制CURRENT_USER（）</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下声明支持使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数替代受影响的用户或定义者的名称（可能还包括其主机）; </font><font style="vertical-align: inherit;">在这种情况下，
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要进行扩展：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-user" title="13.7.1.3 DROP USER语法"><code class="literal">DROP USER</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#rename-user" title="13.7.1.5 RENAME USER语法"><code class="literal">RENAME USER</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-function" title="13.1.13 CREATE FUNCTION语法"><code class="literal">CREATE FUNCTION</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-procedure" title="13.1.16 CREATE PROCEDURE和CREATE FUNCTION语法"><code class="literal">CREATE PROCEDURE</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-trigger" title="13.1.20 CREATE TRIGGER语法"><code class="literal">CREATE TRIGGER</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-event" title="13.1.12创建事件语法"><code class="literal">CREATE EVENT</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-view" title="13.1.21 CREATE VIEW语法"><code class="literal">CREATE VIEW</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-event" title="13.1.2 ALTER EVENT语法"><code class="literal">ALTER EVENT</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-view" title="13.1.10 ALTER VIEW语法"><code class="literal">ALTER VIEW</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作任何陈述的定义者</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-function" title="13.1.13 CREATE FUNCTION语法"><code class="literal">CREATE
        FUNCTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-procedure" title="13.1.16 CREATE PROCEDURE和CREATE FUNCTION语法"><code class="literal">CREATE
        PROCEDURE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-trigger" title="13.1.20 CREATE TRIGGER语法"><code class="literal">CREATE
        TRIGGER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-event" title="13.1.12创建事件语法"><code class="literal">CREATE EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-view" title="13.1.21 CREATE VIEW语法"><code class="literal">CREATE VIEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-view" title="13.1.10 ALTER VIEW语法"><code class="literal">ALTER VIEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当启用了二进制日志，该函数引用之前它被写入到二进制日志扩大，因此该声明是指在相同的用户同时在当语句被复制时主机和从机。</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于在当也扩大之前被写入到二进制日志
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-user" title="13.7.1.3 DROP USER语法"><code class="literal">DROP USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#rename-user" title="13.7.1.5 RENAME USER语法"><code class="literal">RENAME USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-event" title="13.1.2 ALTER EVENT语法"><code class="literal">ALTER EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-drop-if-exists"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.9复制DROP ... IF EXISTS语句</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025883584"></a><a class="indexterm" name="idm140528025882096"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP DATABASE
        IF EXISTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE IF
        EXISTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-view" title="13.1.32 DROP VIEW语法"><code class="literal">DROP VIEW IF
        EXISTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句总是被复制，即使数据库，表或视图被丢弃在主不存在。</font><font style="vertical-align: inherit;">这是为了确保一旦从设备跟上主设备，被主设备或从设备将不再存在被丢弃的对象。
      </font></font></p><p>
        <code class="literal">DROP ... IF EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 存储程序（存储过程和函数，触发器和事件）的语句也被复制，即使主存储器上不存在要删除的存储程序。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-differing-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.10复制主控和从属参数不同的表定义</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025873552"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        用于复制的源表和目标表不必相同。</font><font style="vertical-align: inherit;">主站上的表可以具有比表的从属副本更多或更少的列。</font><font style="vertical-align: inherit;">另外，主站和从站的相应表格列可以使用不同的数据类型，但需要满足一定的条件。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不支持彼此分区不同的表之间的复制。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-partitioning" title="16.4.1.23复制和分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.23节“复制和分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在源表和目标表不具有相同定义的所有情况下，数据库和表名在主服务器和从服务器上必须相同。</font><font style="vertical-align: inherit;">在下面两节中讨论附加条件和示例。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-features-more-columns"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.10.1在主站或从站上有更多列的复制</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以将表格从主表复制到从表，从而使表的主副表副的列数不同，但需满足以下条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表格的两个版本通用的列必须在主从站上以相同的顺序定义。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （即使两个表的列数相同，也是如此。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              必须在任何其他列之前定义两个表格版本通用的列。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这意味着</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
              TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属表上</font><font style="vertical-align: inherit;">执行一条</font><font style="vertical-align: inherit;">语句，在这两个表的共同列的范围内将新列插入到表中，导致复制失败，如以下示例所示：
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              假设</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主站和从站上存在</font><font style="vertical-align: inherit;">的表</font><font style="vertical-align: inherit;">由以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">定义
               </font><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    c1 INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    c2 INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    c3 INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              假设</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
              TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句在从站上执行：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t ADD COLUMN cnew1 INT AFTER c3;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              之前</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从服务器</font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">是允许的，因为在</font><font style="vertical-align: inherit;">两个版本的表中，两个版本的表所共有</font><font style="vertical-align: inherit;">的列
               </font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">c2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
               </font></font><code class="literal">c3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，在任何不同的列之前，都将它们组合在一起。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              但是，以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
              TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句不能在不引起复制中断的情况下在从站上执行：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t ADD COLUMN cnew2 INT AFTER c2;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              复制在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刚刚显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的从属节点上执行后失败
               </font><font style="vertical-align: inherit;">，因为新列</font></font><code class="literal">cnew2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在两个版本的通用</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">之间
               </font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格版本中具有更多列的</font><font style="vertical-align: inherit;">
              每个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">额外</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列都必须具有默认值。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              列的默认值由多种因素决定，包括其类型，是否使用</font></font><code class="literal">DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">定义
               </font><font style="vertical-align: inherit;">，是否声明为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及在创建时有效的服务器SQL模式; </font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/data-types.html#data-type-defaults" title="11.7数据类型默认值"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第11.7节“数据类型默认值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另外，当表的从属副本具有比主副本更多的列时，表中的每个列必须在两个表中使用相同的数据类型。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例子。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下示例说明了一些有效和无效的表定义：
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掌握更多专栏。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            下表定义是有效的并且正确复制：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT, c3 INT);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从&gt;&gt;  </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT);</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下表定义会引发错误，因为表的两个版本的通用列的定义在从属节点上的顺序与主节点上的顺序不同：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT, c3 INT);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从&gt;&gt;  </font></font><strong class="userinput"><code>CREATE TABLE t1 (c2 INT, c1 INT);</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          下列表格定义也会引发错误，因为主文件上额外列的定义出现在两个版本表格的通用列的定义之前：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (c3 INT, c1 INT, c2 INT);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从&gt;&gt;  </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT);</code></strong>
</pre><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奴隶的更多专栏。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            下表定义是有效的并且正确复制：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从&gt;&gt;  </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT, c3 INT);</code></strong>
                  </pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下定义引发错误，因为表的两个版本的通用列未在主服务器和从服务器上按相同顺序定义：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从&gt;&gt;  </font></font><strong class="userinput"><code>CREATE TABLE t1 (c2 INT, c1 INT, c3 INT);</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          下表定义也会引发错误，因为表的从属版本中额外列的定义出现在表的两个版本的公共列的定义之前：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从&gt;&gt;  </font></font><strong class="userinput"><code>CREATE TABLE t1 (c3 INT, c1 INT, c2 INT);</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          下表定义失败，因为该表的从属版本与主版本相比具有附加列，并且该表的两个版本对公用列使用不同的数据类型
           </font></font><code class="literal">c2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 BIGINT);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从&gt;&gt;  </font></font><strong class="userinput"><code>CREATE TABLE t1 (c1 INT, c2 INT, c3 INT);</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="replication-features-different-data-types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.10.2复制具有不同数据类型的列</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025815056"></a><a class="indexterm" name="idm140528025813568"></a><a class="indexterm" name="idm140528025812080"></a><a class="indexterm" name="idm140528025810592"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          理想情况下，主表和副表的从属副本上的相应列应具有相同的数据类型。</font><font style="vertical-align: inherit;">但是，只要满足某些条件，并不总是严格执行。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通常可以从给定数据类型的列复制到具有相同类型和相同大小或宽度（如果适用）或更大的另一列。</font><font style="vertical-align: inherit;">例如，您可以</font><font style="vertical-align: inherit;">毫无问题</font><font style="vertical-align: inherit;">地将</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">从</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">复制</font></font><code class="literal">CHAR(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到另一列
           </font></font><code class="literal">CHAR(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或从
           </font></font><code class="literal">CHAR(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">复制</font><font style="vertical-align: inherit;">到
           </font></font><code class="literal">CHAR(25)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">在某些情况下，还可以从具有一种数据类型的列（在主服务器上）复制到具有不同数据类型的列（在从服务器上）; </font><font style="vertical-align: inherit;">当主站的版本的列的数据类型被提升为从站上的相同大小或更大的类型时，这被称为
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性提升</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          属性提升既可以用于基于语句的复制，也可以用于基于行的复制，并且不依赖主设备或从设备使用的存储引擎。</font><font style="vertical-align: inherit;">但是，日志格式的选择对允许的类型转换有影响; </font><font style="vertical-align: inherit;">本节后面将讨论这些细节。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            无论您使用基于语句还是基于行的复制，如果您希望使用属性升级，则表的从属副本不能包含比主副本更多的列。
</font></font></p>
</div>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句的复制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用基于语句的复制时，一个简单的经验法则是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果在主服务器上运行的语句也能在从服务器上成功执行，它也应该成功复制</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">换句话说，如果语句使用的值与从机上给定列的类型兼容，则可以复制该语句。</font><font style="vertical-align: inherit;">例如，您可以在</font></font><code class="literal">TINYINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">插入任何适合</font><font style="vertical-align: inherit;">列的
             </font><font style="vertical-align: inherit;">值</font></font><code class="literal">BIGINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">因此，即使您将</font></font><code class="literal">TINYINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表的从属副本中的列</font><font style="vertical-align: inherit;">的类型更改</font><font style="vertical-align: inherit;">为
            </font></font><code class="literal">BIGINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，任何插入成功的主机上的列也应该在从机上成功，因为不可能有</font></font><code class="literal">TINYINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">足够大</font><font style="vertical-align: inherit;">的合法
             </font><font style="vertical-align: inherit;">值超过</font></font><code class="literal">BIGINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在使用MySQL 5.7.1之前，当使用基于语句的复制时，
           </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求主站和从站的列相同; </font><font style="vertical-align: inherit;">否则，可以将更新应用于从站上的错误表格。</font><font style="vertical-align: inherit;">（Bug＃12669186）
        </font></font></p><p><a name="replication-features-attribute-promotion"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行的复制：属性提升和降级。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            基于行的复制支持较小数据类型和较大类型之间的属性升级和降级。</font><font style="vertical-align: inherit;">也可以指定是否允许降级列值的有损（截断）或无损转换，如本节后面所述。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有损和无损转换。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果目标类型无法表示要插入的值，则必须决定如何处理转换。</font><font style="vertical-align: inherit;">如果我们允许转换但截断（或以其他方式修改）源值以</font><font style="vertical-align: inherit;">在目标列中</font><font style="vertical-align: inherit;">实现
             </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适合</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则我们进行所谓的</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有损转换</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不需要截断或类似修改以适应目标列中的源列值的
             </font><font style="vertical-align: inherit;">转换</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是非有损</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换。
          </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型转换模式（slave_type_conversions变量）。&nbsp;</font></font></b><font style="vertical-align: inherit;"></font><code class="literal">slave_type_conversions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            全局服务器变量</font><font style="vertical-align: inherit;">
            的设置</font><font style="vertical-align: inherit;">控制从站上使用的类型转换模式。</font><font style="vertical-align: inherit;">该变量从下表中获取一组值，其中显示了每种模式对从机类型转换行为的影响：
</font></font></p>
<div class="informaltable">
<table summary="Type conversion modes for the slave_type_conversions global server variable and the effects of each mode on the slave&#39;s type-conversion behavior."><colgroup><col width="35%"><col width="65%"></colgroup><thead><tr>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font></font></th>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响</font></font></th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">ALL_LOSSY</code></td>
              <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  在这种模式下，类型转换可能意味着信息的丢失。
                </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  这并不意味着允许非有损转换，而只是只允许需要有损转换或根本不转换的情况; </font><font style="vertical-align: inherit;">例如，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用
                   </font><font style="vertical-align: inherit;">此模式允许将
                   </font></font><code class="literal">INT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列转换为
                   </font></font><code class="literal">TINYINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（有损转换），但不将</font></font><code class="literal">TINYINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列转换为
                   </font></font><code class="literal">INT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列（非有损）。</font><font style="vertical-align: inherit;">在这种情况下尝试后面的转换会导致复制停止，并在从站上发生错误。
                </font></font></p></td>
            </tr><tr>
              <td scope="row"><code class="literal">ALL_NON_LOSSY</code></td>
              <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  该模式允许不需要截断或其他特殊处理源值的转换; </font><font style="vertical-align: inherit;">也就是说，它允许目标类型的范围比源类型更宽的转换。
                </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  设置此模式与是否允许有损转换无关; </font><font style="vertical-align: inherit;">这是用</font></font><code class="literal">ALL_LOSSY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">控制的
                   </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果仅
                   </font></font><code class="literal">ALL_NON_LOSSY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置，但不是
                   </font></font><code class="literal">ALL_LOSSY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则试图进行转换将导致数据的丢失（如</font></font><code class="literal">INT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到
                   </font></font><code class="literal">TINYINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
                   </font></font><code class="literal">CHAR(25)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到
                   </font></font><code class="literal">VARCHAR(20)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）导致从停止与一个错误。
                </font></font></p></td>
            </tr><tr>
              <td scope="row"><code class="literal">ALL_LOSSY,ALL_NON_LOSSY</code></td>
              <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  设置此模式后，所有受支持的类型转换都是允许的，无论它们是否有损转换。
                </font></font></p></td>
            </tr><tr>
              <td scope="row"><code class="literal">ALL_SIGNED</code></td>
              <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  将提升的整数类型视为有符号值（默认行为）。
                </font></font></p></td>
            </tr><tr>
              <td scope="row"><code class="literal">ALL_UNSIGNED</code></td>
              <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  将提升的整数类型视为无符号值。
                </font></font></p></td>
            </tr><tr>
              <td scope="row"><code class="literal">ALL_SIGNED,ALL_UNSIGNED</code></td>
              <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  如果可能，将提升的整数类型视为已签名，否则视为未签名。
                </font></font></p></td>
            </tr><tr>
              <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></td>
              <td><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  如果</font></font><code class="literal">slave_type_conversions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有设置，没有属性升级或降级是允许的; </font><font style="vertical-align: inherit;">这意味着源表和目标表中的所有列必须具有相同的类型。
                </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  这种模式是默认的。
                </font></font></p></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当整数类型被提升时，其签名不会被保留。</font><font style="vertical-align: inherit;">默认情况下，从设备将所有这些值视为已签名。</font><font style="vertical-align: inherit;">与MySQL 5.7.2开始，您可以使用此行为的控制</font></font><code class="literal">ALL_SIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">ALL_UNSIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或两者兼而有之。</font><font style="vertical-align: inherit;">（错误＃15831300）
           </font></font><code class="literal">ALL_SIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">告诉从服务器将所有提升的整数类型视为已签名;
          </font></font><code class="literal">ALL_UNSIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示它将这些视为未签名。</font><font style="vertical-align: inherit;">指定两者都会导致从服务器将该值视为已签名（如果可能），否则将其视为未签名; </font><font style="vertical-align: inherit;">他们列出的顺序并不重要。</font><font style="vertical-align: inherit;">如果至少有一个</font><font style="vertical-align: inherit;">或
           </font><font style="vertical-align: inherit;">不被使用，</font><font style="vertical-align: inherit;">也
           </font></font><code class="literal">ALL_SIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有
           </font></font><code class="literal">ALL_UNSIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何影响</font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">ALL_LOSSY</code><font style="vertical-align: inherit;"></font><code class="literal">ALL_NONLOSSY</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          更改类型转换模式需要使用新</font></font><code class="literal">slave_type_conversions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置</font><font style="vertical-align: inherit;">重新启动从站</font><font style="vertical-align: inherit;">。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的转化。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下列表中显示了不同但类似数据类型之间支持的转换：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              之间的任意整数类型的
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">TINYINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">SMALLINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">MEDIUMINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">INT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">BIGINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这包括这些类型的签名和未签名版本之间的转换。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有损转换是通过将源值截断为目标列允许的最大值（或最小值）进行的。</font><font style="vertical-align: inherit;">为了确保从无符号到有符号类型时的无损转换，目标列必须足够大以容纳源列中值的范围。</font><font style="vertical-align: inherit;">例如，您可以</font></font><code class="literal">TINYINT
              UNSIGNED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非损失地
               </font><font style="vertical-align: inherit;">降级</font></font><code class="literal">SMALLINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但不是
               </font></font><code class="literal">TINYINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              之间的任何小数类型
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#fixed-point-types" title="11.2.2定点类型（准确值） -  DECIMAL，NUMERIC"><code class="literal">DECIMAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#floating-point-types" title="11.2.3浮点类型（近似值） -  FLOAT，DOUBLE"><code class="literal">FLOAT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#floating-point-types" title="11.2.3浮点类型（近似值） -  FLOAT，DOUBLE"><code class="literal">DOUBLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#fixed-point-types" title="11.2.2定点类型（准确值） -  DECIMAL，NUMERIC"><code class="literal">NUMERIC</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p>
              <code class="literal">FLOAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><code class="literal">DOUBLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个无损转换; </font></font><code class="literal">DOUBLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到
               </font></font><code class="literal">FLOAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只能有损地处理。</font><font style="vertical-align: inherit;">转换
               </font><font style="vertical-align: inherit;">
              到
               </font><font style="vertical-align: inherit;">
              哪里</font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">）是无损的; </font><font style="vertical-align: inherit;">在任何情况下
               </font><font style="vertical-align: inherit;">，
               </font><font style="vertical-align: inherit;">或者两者只能进行有损转换。
            </font></font><code class="literal">DECIMAL(<em class="replaceable"><code>M</code></em>,<em class="replaceable"><code>D</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">DECIMAL(<em class="replaceable"><code>M'</code></em>,<em class="replaceable"><code>D'</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>D'</code></em> &gt;=
              <em class="replaceable"><code>D</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">(<em class="replaceable"><code>M'</code></em>-<em class="replaceable"><code>D'</code></em>)
              &gt;=
              (<em class="replaceable"><code>M</code></em>-<em class="replaceable"><code>D</code></em></code><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>M'</code></em> &lt;
              <em class="replaceable"><code>M</code></em></code><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>D'</code></em> &lt;
              <em class="replaceable"><code>D</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于任何小数类型，如果要存储的值不适合目标类型，则会根据文档中其他位置为服务器定义的舍入规则向下舍入该值。</font><font style="vertical-align: inherit;">关于如何完成十进制类型的信息</font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#precision-math-rounding" title="12.21.4舍入行为"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/functions.html#precision-math-rounding" title="12.21.4舍入行为"><font style="vertical-align: inherit;">第12.21.4节“舍入行为”</font></a><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              之间的任何字符串类型
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，包括不同的宽度之间的转换。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将相同大小或更大</font><font style="vertical-align: inherit;">
              的a </font></font><code class="literal">CHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">TEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font><code class="literal">CHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">TEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">转换</font><font style="vertical-align: inherit;">不会有损失。</font><font style="vertical-align: inherit;">有损转换是通过</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从机上</font><font style="vertical-align: inherit;">仅插入</font><font style="vertical-align: inherit;">字符串</font><font style="vertical-align: inherit;">的第一个</font><font style="vertical-align: inherit;">字符</font><font style="vertical-align: inherit;">来处理的</font><font style="vertical-align: inherit;">，其中</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是目标列的宽度。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                不支持使用不同字符集的列之间的复制。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              之间的任何二进制数据类型
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">BINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">VARBINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，包括不同的宽度之间的转换。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将相同大小或更大</font><font style="vertical-align: inherit;">
              的a </font></font><code class="literal">BINARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">VARBINARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">BLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              a </font></font><code class="literal">BINARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">VARBINARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">BLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">转换</font><font style="vertical-align: inherit;">不会有损失。</font><font style="vertical-align: inherit;">有损转换是通过</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属设备上</font><font style="vertical-align: inherit;">只插入</font><font style="vertical-align: inherit;">字符串</font><font style="vertical-align: inherit;">的第一个</font><font style="vertical-align: inherit;">字节</font><font style="vertical-align: inherit;">来处理的
               </font><font style="vertical-align: inherit;">，其中</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是目标列的宽度。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在任何2 </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#bit-type" title="11.2.4位值类型 -  BIT"><code class="literal">BIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">个尺寸的</font><font style="vertical-align: inherit;">任何2 </font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">之间</font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将</font><font style="vertical-align: inherit;">
              列中
               </font><font style="vertical-align: inherit;">的值插入
               </font><font style="vertical-align: inherit;">
              列时，其中列</font><font style="vertical-align: inherit;">的最高有效位
               </font><font style="vertical-align: inherit;">
              被清除（设置为零）</font><font style="vertical-align: inherit;">，并将</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">的
               </font><font style="vertical-align: inherit;">位
               </font><font style="vertical-align: inherit;">设置为列的最低有效位
               </font><font style="vertical-align: inherit;">
              。
            </font></font><code class="literal">BIT(<em class="replaceable"><code>M</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">BIT(<em class="replaceable"><code>M'</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>M'</code></em> &gt;
              <em class="replaceable"><code>M</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">BIT(<em class="replaceable"><code>M'</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"></font><code class="literal">BIT(<em class="replaceable"><code>M</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">BIT(<em class="replaceable"><code>M'</code></em>)</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将来源</font><font style="vertical-align: inherit;">
              列中</font><font style="vertical-align: inherit;">的值插入
               </font><font style="vertical-align: inherit;">到目标
               </font><font style="vertical-align: inherit;">
              列时，其中</font><font style="vertical-align: inherit;">
              分配列</font><font style="vertical-align: inherit;">的最大可能值
               </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">换句话说，
               </font><span class="quote"><font style="vertical-align: inherit;">“ </font></span><span class="quote"><span class="quote"><font style="vertical-align: inherit;">全集</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”</font></span><font style="vertical-align: inherit;">值被分配给目标列。
</font></font><code class="literal">BIT(<em class="replaceable"><code>M</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">BIT(<em class="replaceable"><code>M'</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>M'</code></em> &lt;
              <em class="replaceable"><code>M</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">BIT(<em class="replaceable"><code>M'</code></em>)</code><font style="vertical-align: inherit;"></font><span class="quote"><font style="vertical-align: inherit;"></font><span class="quote"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不允许在不在之前列表中的类型之间进行转换。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-directory"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.11复制和目录表选项</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025668832"></a><a class="indexterm" name="idm140528025667344"></a><a class="indexterm" name="idm140528025665856"></a><a class="indexterm" name="idm140528025664368"></a><a class="indexterm" name="idm140528025662880"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果</font><font style="vertical-align: inherit;">在主服务器上的语句中</font><font style="vertical-align: inherit;">使用了</font><font style="vertical-align: inherit;">一个</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">一个</font></font><code class="literal">INDEX
        DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表选项
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么表格选项也用在从属服务器上。</font><font style="vertical-align: inherit;">如果从属主机文件系统中不存在相应的目录，或者它存在但从属服务器不可访问，则会导致问题。</font><font style="vertical-align: inherit;">这可以通过</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_dir_in_create"><code class="literal">NO_DIR_IN_CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从服务器上</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">服务器SQL模式</font><font style="vertical-align: inherit;">来覆盖
         </font><font style="vertical-align: inherit;">，这会导致从服务器</font><font style="vertical-align: inherit;">在复制</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">忽略
         </font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">INDEX
        DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表选项
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">结果是</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据和索引文件在表的数据库目录中创建。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#sql-mode" title="5.1.8服务器SQL模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.8节“服务器SQL模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-floatvalues"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.12复制和浮点值</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025650416"></a><a class="indexterm" name="idm140528025648912"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用基于语句的复制时，值将从十进制转换为二进制。</font><font style="vertical-align: inherit;">因为它们之间的十进制和二进制表示之间的转换可能是近似的，所以涉及浮点值的比较是不精确的。</font><font style="vertical-align: inherit;">这对于显式使用浮点值的操作或使用隐式转换为浮点值的操作都是如此。</font><font style="vertical-align: inherit;">由于计算机体系结构，用于编译MySQL的编译器等不同，浮点值的比较可能会在主服务器和从服务器上产生不同的结果。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#type-conversion" title="12.2表达式评估中的类型转换"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.2节“表达式评估中的类型转换”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#problems-with-float" title="B.5.4.8浮点值问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.4.8节“浮点值问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-fractional-seconds"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.13复制和小数秒支持</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025643712"></a><a class="indexterm" name="idm140528025642224"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        的MySQL 5.7许可证秒的小数部分
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#time" title="11.3.2时间类型"><code class="literal">TIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，高达微秒（6位）的精度。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/data-types.html#fractional-seconds" title="11.3.6小数秒的时间值"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第11.3.6节“时间分数秒数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从可以理解小数秒的主服务器复制到旧版本的从属服务器（MySQL 5.6.3及更早版本）可能会出现以下问题：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font></font><em class="replaceable"><code>fsp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（小数秒精度）值大于0的</font><font style="vertical-align: inherit;">列的语句
             </font><font style="vertical-align: inherit;">，复制将由于分析器错误而失败。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><em class="replaceable"><code>fsp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为0的时</font><font style="vertical-align: inherit;">态数据类型的
             </font><font style="vertical-align: inherit;">语句适用于基于语句的日志记录，但不适用于基于行的日志记录。</font><font style="vertical-align: inherit;">在后一种情况下，数据类型在主站上具有与从站上的数据类型不同的二进制格式和类型代码。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一些表达式结果在主从机上会有所不同。</font><font style="vertical-align: inherit;">示例：在主设备上，</font></font><code class="literal">timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量返回一个包含微秒小数部分的值; </font><font style="vertical-align: inherit;">在从机上，它返回一个整数。</font><font style="vertical-align: inherit;">在主，函数返回包括当前时间（例如，结果
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_curtime"><code class="literal">CURTIME()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_utc-timestamp"><code class="literal">UTC_TIMESTAMP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）解释的参数作为</font></font><em class="replaceable"><code>fsp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数值和返回值包括许多数字的小数部分秒。</font><font style="vertical-align: inherit;">在奴隶，这些功能允许一个参数，但忽略它。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-flush"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.14复制和FLUSH</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025623328"></a><a class="indexterm" name="idm140528025621840"></a><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush" title="13.7.6.3 FLUSH语法"><code class="literal">FLUSH</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的</font><font style="vertical-align: inherit;">
        某些形式</font><font style="vertical-align: inherit;">不会被记录，因为如果复制到从站，它们可能会导致问题：</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH TABLES WITH READ LOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关语法示例，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#flush" title="13.7.6.3 FLUSH语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.6.3节“FLUSH语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句被写入二进制日志，因此复制到奴隶。</font><font style="vertical-align: inherit;">这通常不是问题，因为这些语句不会修改表数据。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，这种行为在某些情况下会造成困难。</font><font style="vertical-align: inherit;">如果在</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">复制特权表
         </font><font style="vertical-align: inherit;">并直接更新这些表而不使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则必须</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属设备上</font><font style="vertical-align: inherit;">发出一个</font><font style="vertical-align: inherit;">新特权才能生效。</font><font style="vertical-align: inherit;">另外，如果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在重命名属于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的表的一部分的
         </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时使用，则必须</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属设备</font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">手动</font><font style="vertical-align: inherit;">发出
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非您指定</font></font><code class="literal">NO_WRITE_TO_BINLOG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或其别名，
         </font><font style="vertical-align: inherit;">否则这些语句将写入二进制日志</font></font><code class="literal">LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-functions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.15复制和系统功能</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025599776"></a><a class="indexterm" name="idm140528025598288"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在某些情况下某些功能不能很好地复制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid"><code class="literal">UUID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_version"><code class="literal">VERSION()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能被复制没有改变，因此并除非基于行的复制功能无法可靠地在从服务器上运行。</font><font style="vertical-align: inherit;">（请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
          </font></font></p><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">时使用基于行的复制自动复制</font><font style="vertical-align: inherit;">，并在</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式下</font><font style="vertical-align: inherit;">生成警告</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（另请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-current-user" title="16.4.1.8复制CURRENT_USER（）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.8节“CURRENT_USER（）的复制”）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。对于</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_version"><code class="literal">VERSION()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            and </font><font style="vertical-align: inherit;">也是如此</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_now"><code class="literal">NOW()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，二进制日志包含时间戳。</font><font style="vertical-align: inherit;">这意味着</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用该主函数返回</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
             </font><span class="emphasis"><em><font style="vertical-align: inherit;">将</font></em></span><font style="vertical-align: inherit;">被复制到从机。</font><font style="vertical-align: inherit;">为避免在不同时区的MySQL服务器之间进行复制时出现意外结果，请在主服务器和从服务器上设置时区。</font><font style="vertical-align: inherit;">另请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-timezone" title="16.4.1.32复制和时区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.32节“复制和时区”</font></font></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了解释在不同时区的服务器之间复制时的潜在问题，假设主站位于纽约，从站位于斯德哥尔摩，并且两台服务器都使用本地时间。</font><font style="vertical-align: inherit;">进一步假设，在master上，你创建一个表
             </font></font><code class="literal">mytable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个表上</font><font style="vertical-align: inherit;">执行一个
             </font><font style="vertical-align: inherit;">语句，然后从表中选择，如下所示：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE mytable (mycol TEXT);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.06秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO mytable VALUES ( NOW() );</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM mytable;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">mycol |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2009-09-01 12:00:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            斯德哥尔摩当地时间比纽约晚六个小时; </font><font style="vertical-align: inherit;">所以，如果您</font></font><code class="literal">SELECT NOW()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在同一时刻在从站上</font><font style="vertical-align: inherit;">发出数据</font><font style="vertical-align: inherit;">，</font></font><code class="literal">2009-09-01 18:00:00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则返回</font><font style="vertical-align: inherit;">该值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">出于这个原因，如果你</font></font><code class="literal">mytable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">刚刚显示的语句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句被复制</font><font style="vertical-align: inherit;">之后
             </font><font style="vertical-align: inherit;">从副本中选择
             </font><font style="vertical-align: inherit;">，你可能期望
             </font></font><code class="literal">mycol</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含该值
             </font></font><code class="literal">2009-09-01 18:00:00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然而，这种情况并非如此; </font><font style="vertical-align: inherit;">当您从副本中选择时
             </font></font><code class="literal">mytable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您将获得与主机上完全相同的结果：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM mytable;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">mycol |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2009-09-01 12:00:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与此不同的是</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_now"><code class="literal">NOW()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数不是复制安全的，因为它不受</font></font><code class="literal">SET
            TIMESTAMP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制日志中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">影响，</font><font style="vertical-align: inherit;">并且如果使用基于语句的日志记录</font><font style="vertical-align: inherit;">则不</font><font style="vertical-align: inherit;">具有确定性。</font><font style="vertical-align: inherit;">如果使用基于行的日志记录，这不是问题。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            另一种方法是使用该
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_sysdate-is-now"><code class="option">--sysdate-is-now</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项使其</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成为别名</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_now"><code class="literal">NOW()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这必须在主设备和从设备上正常工作。</font><font style="vertical-align: inherit;">在这种情况下，该功能仍会发出警告，但只要</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_sysdate-is-now"><code class="option">--sysdate-is-now</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主控和从控上使用，都</font><font style="vertical-align: inherit;">可以安全地忽略
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">时使用基于行的复制自动复制
             </font><font style="vertical-align: inherit;">，并在</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式下</font><font style="vertical-align: inherit;">生成警告
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            另请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-timezone" title="16.4.1.32复制和时区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.32节“复制和时区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下限制仅适用于基于语句的复制，而不适用于基于行的复制。</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
            </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
            </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
            </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_is-free-lock"><code class="literal">IS_FREE_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
            </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_is-used-lock"><code class="literal">IS_USED_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其处理用户级锁功能被复制而不会从知道在主并发上下文。</font><font style="vertical-align: inherit;">因此，这些函数不应该用于插入主表中，因为从属内容会有所不同。</font><font style="vertical-align: inherit;">例如，不要发布诸如</font></font><code class="literal">INSERT
            INTO mytable VALUES(GET_LOCK(...))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">的语句</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些函数在使用</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">时使用基于行的复制自动复制</font><font style="vertical-align: inherit;">，并在</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式下</font><font style="vertical-align: inherit;">生成警告</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        作为基于语句的复制生效时的上述限制的解决方法，您可以使用将有问题的函数结果保存在用户变量中并在稍后的语句中引用该变量的策略。</font><font style="vertical-align: inherit;">例如，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于对该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid"><code class="literal">UUID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的引用</font><font style="vertical-align: inherit;">，以下单行
         </font><font style="vertical-align: inherit;">是有问题的</font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO t VALUES（UUID（））;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要解决该问题，请改为执行此操作：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @my_uuid = UUID（）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t VALUES（@my_uuid）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该语句序列被复制，因为该值
         </font></font><code class="literal">@my_uuid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">之前作为用户变量事件存储在二进制日志中，</font><font style="vertical-align: inherit;">并可用于</font><font style="vertical-align: inherit;">该
         </font><font style="vertical-align: inherit;">语句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        同样的想法适用于多行插入，但使用起来更麻烦。</font><font style="vertical-align: inherit;">对于两行插入，您可以这样做：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @ my_uuid1 = UUID（）; </font><font style="vertical-align: inherit;">@ my_uuid2 = UUID（）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t VALUES（@ my_uuid1），（@ my_uuid2）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，如果行数很大或未知，则解决方法很难或不可行。</font><font style="vertical-align: inherit;">例如，不能将以下语句转换为给定的单个用户变量与每行关联的语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO t2 SELECT UUID（），* FROM t1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在存储的函数中，</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只要在函数执行过程中只调用一次就可以正确复制。</font><font style="vertical-align: inherit;">（您可以将函数执行时间戳和随机数种子视为隐式输入，这些输入在主机和从机上是相同的。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_row-count"><code class="literal">ROW_COUNT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能使用基于语句的复制不可复制的可靠。</font><font style="vertical-align: inherit;">解决方法是将函数调用的结果存储在用户变量中，然后在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">使用它
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，如果您希望将结果存储在名为的表中
         </font></font><code class="literal">mytable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您通常可以这样做：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT SQL_CALC_FOUND_ROWS FROM mytable LIMIT 1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO mytable VALUES（FOUND_ROWS（））;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，如果您正在复制</font></font><code class="literal">mytable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则应该使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO语法"><code class="literal">SELECT
        ... INTO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后将该变量存储在表中，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT SQL_CALC_FOUND_ROWS INTO @found_rows FROM mytable LIMIT 1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO mytable VALUES（@found_rows）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过这种方式，用户变量作为上下文的一部分进行复制，并正确应用于从站。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些函数在使用</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">时使用基于行的复制自动复制</font><font style="vertical-align: inherit;">，并在</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式下</font><font style="vertical-align: inherit;">生成警告</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（错误＃12092，错误＃30244）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7.3之前，</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">在从服务器上启用了</font><font style="vertical-align: inherit;">诸如</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和之类的
         </font><font style="vertical-align: inherit;">过滤选项</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">则不会正确复制
         </font><font style="vertical-align: inherit;">该值
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（错误＃17234370，BUG＃69861）
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-invoked"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.16调用特征的复制</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025505856"></a><a class="indexterm" name="idm140528025504368"></a><a class="indexterm" name="idm140528025502880"></a><a class="indexterm" name="idm140528025501392"></a><a class="indexterm" name="idm140528025499904"></a><a class="indexterm" name="idm140528025498416"></a><a class="indexterm" name="idm140528025496928"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        调用的功能（如用户定义函数（UDF）和存储程序（存储过程和函数，触发器和事件））的复制提供了以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该功能的效果总是被复制。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下语句使用基于语句的复制进行复制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-event" title="13.1.12创建事件语法"><code class="literal">CREATE EVENT</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-event" title="13.1.2 ALTER EVENT语法"><code class="literal">ALTER EVENT</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-event" title="13.1.23 DROP EVENT语法"><code class="literal">DROP EVENT</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-procedure" title="13.1.16 CREATE PROCEDURE和CREATE FUNCTION语法"><code class="literal">CREATE PROCEDURE</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-procedure" title="13.1.27 DROP程序和DROP FUNCTION语法"><code class="literal">DROP PROCEDURE</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-function" title="13.1.13 CREATE FUNCTION语法"><code class="literal">CREATE FUNCTION</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-function" title="13.1.24 DROP FUNCTION语法"><code class="literal">DROP FUNCTION</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-trigger" title="13.1.20 CREATE TRIGGER语法"><code class="literal">CREATE TRIGGER</code></a>
              </p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-trigger" title="13.1.31 DROP TRIGGER语法"><code class="literal">DROP TRIGGER</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            但是，</font><font style="vertical-align: inherit;">使用这些语句创建，修改或删除的功能</font><font style="vertical-align: inherit;">的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">效果</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会使用基于行的复制进行复制。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              尝试使用基于语句的复制来复制调用的功能会产生警告
               </font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句不能安全地登录语句格式</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，尝试复制具有基于语句的复制的UDF会生成此警告，因为它目前无法由MySQL服务器确定UDF是否为确定性的。</font><font style="vertical-align: inherit;">如果您完全确定被调用的功能的效果是确定性的，您可以放心地忽略这些警告。
</font></font></p>
</div>
</li><li class="listitem"><p>
            <a class="indexterm" name="idm140528025471376"></a>

            <a class="indexterm" name="idm140528025469888"></a>

            <a class="indexterm" name="idm140528025468400"></a>

            <a class="indexterm" name="idm140528025466912"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

            在的情况下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-event" title="13.1.12创建事件语法"><code class="literal">CREATE EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-event" title="13.1.2 ALTER EVENT语法"><code class="literal">ALTER EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">SLAVESIDE_DISABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论指定的状态如何</font><font style="vertical-align: inherit;">
                ，该事件的状态都设置
                 </font><font style="vertical-align: inherit;">在从站上（这不适用于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-event" title="13.1.23 DROP EVENT语法"><code class="literal">DROP EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在其上创建事件的主站通过其服务器ID在从站上标识。</font><font style="vertical-align: inherit;">该
                 </font></font><code class="literal">ORIGINATOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
                 </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#events-table" title="24.7 INFORMATION_SCHEMA事件表"><code class="literal">INFORMATION_SCHEMA.EVENTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                与</font></font><code class="literal">originator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
                 </font></font><code class="literal">mysql.event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储这些信息。</font><font style="vertical-align: inherit;">有关更多</font></font><a class="xref" href="/mysql-5.7-google-zh/information-schema.html#events-table" title="24.7 INFORMATION_SCHEMA事件表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/information-schema.html#events-table" title="24.7 INFORMATION_SCHEMA事件表"><font style="vertical-align: inherit;">第24.7节“INFORMATION_SCHEMA事件表”</font></a><font style="vertical-align: inherit;">和
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#show-events" title="13.7.5.18 SHOW EVENTS语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.5.18节“SHOW EVENTS语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            功能实现驻留在可更新状态的从站上，这样，如果主站发生故障，从站可以用作主站而不会丢失事件处理。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要确定在另一台服务器上创建的MySQL服务器上是否有任何计划事件（即充当复制主服务器），请</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#events-table" title="24.7 INFORMATION_SCHEMA事件表"><code class="literal">INFORMATION_SCHEMA.EVENTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照与此处显示的方式类似的方式</font><font style="vertical-align: inherit;">查询该
         </font><font style="vertical-align: inherit;">表：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT EVENT_SCHEMA，EVENT_NAME</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    FROM INFORMATION_SCHEMA.EVENTS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    WHERE STATUS ='SLAVESIDE_DISABLED';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或者，您可以使用以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-events" title="13.7.5.18 SHOW EVENTS语法"><code class="literal">SHOW
        EVENTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展示活动</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    WHERE STATUS ='SLAVESIDE_DISABLED';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        将具有此类事件的复制从服务器提升为复制主服务器时，必须使用以下事件启用每个事件
         </font><font style="vertical-align: inherit;">，其中
         </font><font style="vertical-align: inherit;">是事件的名称。
      </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-event" title="13.1.2 ALTER EVENT语法"><code class="literal">ALTER EVENT
        <em class="replaceable"><code>event_name</code></em> ENABLE</code></a><font style="vertical-align: inherit;"></font><em class="replaceable"><code>event_name</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果有多个主服务器参与在该从服务器上创建事件，并且您希望识别仅在具有该服务器ID的给定主服务器上创建的事件
         </font></font><em class="replaceable"><code>master_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请修改</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#events-table" title="24.7 INFORMATION_SCHEMA事件表"><code class="literal">EVENTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上的上一个查询</font><font style="vertical-align: inherit;">以包含该
         </font></font><code class="literal">ORIGINATOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT EVENT_SCHEMA，EVENT_NAME，ORIGINATOR</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    FROM INFORMATION_SCHEMA.EVENTS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    WHERE STATUS ='SLAVESIDE_DISABLED'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    AND ORIGINATOR =' </font></font><em class="replaceable"><code>master_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以</font><font style="vertical-align: inherit;">以类似的方式</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">ORIGINATOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-events" title="13.7.5.18 SHOW EVENTS语法"><code class="literal">SHOW EVENTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">陈述：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展示活动</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    WHERE STATUS ='SLAVESIDE_DISABLED'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    AND ORIGINATOR =' </font></font><em class="replaceable"><code>master_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在启用从主站复制的事件之前，应该禁用从站上的MySQL事件调度程序（使用类似语句</font></font><code class="literal">SET GLOBAL event_scheduler =
        OFF;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），运行任何必要的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-event" title="13.1.2 ALTER EVENT语法"><code class="literal">ALTER
        EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，重新启动服务器，然后在从站上重新启用事件调度程序（使用诸如此类的陈述</font></font><code class="literal">SET GLOBAL event_scheduler = ON;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">） -
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果稍后将新主设备降级为复制从设备，则必须手动禁用由该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-event" title="13.1.2 ALTER EVENT语法"><code class="literal">ALTER EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">启用的所有事件
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以通过在单独的表中存储</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">的事件名称
         </font><font style="vertical-align: inherit;">，或使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-event" title="13.1.2 ALTER EVENT语法"><code class="literal">ALTER EVENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句重新命名具有通用前缀的事件（例如
         </font></font><code class="literal">replicated_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别它们）来完成此操作。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您重命名事件，那么在将此服务器降级为复制从属服务器时，可以通过查询</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#events-table" title="24.7 INFORMATION_SCHEMA事件表"><code class="literal">EVENTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">来识别事件</font><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT CONCAT（EVENT_SCHEMA，'。'，EVENT_NAME）AS'Db.Event'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      FROM INFORMATION_SCHEMA.EVENTS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      WHERE INSTR（EVENT_NAME，'replicated_'）= 1;</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-limit"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.17复制和限制</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025423200"></a><a class="indexterm" name="idm140528025421712"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于受影响的行的顺序未定义</font><font style="vertical-align: inherit;">，因此</font><font style="vertical-align: inherit;">
        基于语句的复制</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT ...
        SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句是不安全的。</font><font style="vertical-align: inherit;">（只有在语句中还包含</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的情况下，</font><font style="vertical-align: inherit;">才可以使用基于语句的复制正确复制此类语句</font><font style="vertical-align: inherit;">。）遇到这样的语句时：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式时，现在发出一条警告，说明语句对基于语句的复制是不安全的。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式时，</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使它们也有一个</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句（因此确定性），</font><font style="vertical-align: inherit;">也会
             </font><font style="vertical-align: inherit;">为DML语句发出警告
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个已知的问题。</font><font style="vertical-align: inherit;">（错误＃42851）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式时，语句现在使用基于行的模式自动复制。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-load-data"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.18复制和LOAD DATA INFILE</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025406800"></a><a class="indexterm" name="idm140528025405312"></a><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于基于声明的日志记录而言被认为是不安全的（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rbr-safe-unsafe" title="16.2.1.3在二进制测井中确定安全和不安全的陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1.3节“确定二进制日志记录中的安全和不安全的声明”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">何时</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=MIXED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置，语句以行为格式记录。</font><font style="vertical-align: inherit;">何时
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=STATEMENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置，注意</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会产生警告，不像其他不安全的陈述。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以基于语句的格式记录的语句的</font><font style="vertical-align: inherit;">日志事件时，
         </font><font style="vertical-align: inherit;">会在临时目录中创建生成的本地文件。</font><font style="vertical-align: inherit;">这些临时文件不会被</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或任何其他MySQL程序</font><font style="vertical-align: inherit;">自动删除
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于语句的二进制日志记录的语句，则在不再需要语句日志之后，应该自己删除临时文件。</font><font style="vertical-align: inherit;">有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分4.6.7，“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 处理二进制日志文件的实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-max-allowed-packet"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.19复制和max_allowed_pa​​cket</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025389872"></a><a class="indexterm" name="idm140528025388384"></a><p>
        <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置MySQL服务器和客户端之间的任何单个消息的大小的上限，包括复制从服务器。</font><font style="vertical-align: inherit;">如果要复制较大的列值（例如可能位于
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中）并且
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器上的值太小，则主服务器会因错误而失败，并且从服务器会关闭I / O线程。</font><font style="vertical-align: inherit;">如果
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站太小，这也会导致从站停止I / O线程。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        基于行的复制当前将更新的行的所有列和列值从主服务器发送到从服务器，包括实际上未被更新更改的列的值。</font><font style="vertical-align: inherit;">这意味着，当您使用基于行的复制复制大型列值时，必须注意设置
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">足够大以容纳要复制的任何表中的最大行，即使您仅复制更新，或者仅插入相对较小的值。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-memory"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.20复制和内存表</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025376448"></a><a class="indexterm" name="idm140528025374960"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当主服务器关闭并重新启动时，其
         </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格变空。</font><font style="vertical-align: inherit;">为了将这种效果复制到从服务器，主服务器第一次</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启动后</font><font style="vertical-align: inherit;">使用给定的</font><font style="vertical-align: inherit;">表，它会记录一个事件，该事件通知从服务器必须通过</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将该表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">写入</font><font style="vertical-align: inherit;">二进制日志</font><font style="vertical-align: inherit;">来清空
         </font><font style="vertical-align: inherit;">该表。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当从属服务器关闭并重新启动时，其
         </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格变空。</font><font style="vertical-align: inherit;">这会导致从站与主站不同步并可能导致其他故障或导致从站停止：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从主站接收的行格式更新和删除可能会失败</font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">Can't find record in
            '<em class="replaceable"><code>memory_table</code></em>'</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            像这样的语句
             </font><font style="vertical-align: inherit;">可以在主机和从机上插入一组不同的行。
</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT INTO
            ... SELECT FROM
            <em class="replaceable"><code>memory_table</code></em></code></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        重新启动正在复制</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的从站的安全方法
         </font><font style="vertical-align: inherit;">是首先从</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        主服务器上的表中</font><font style="vertical-align: inherit;">删除或删除所有行，</font><font style="vertical-align: inherit;">并等到这些更改已复制到从服务器。</font><font style="vertical-align: inherit;">然后重启从站是安全的。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在某些情况下可能会应用另一种重启方法。</font><font style="vertical-align: inherit;">何时
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode=IDEMPOTENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在再次启动从站之前</font><font style="vertical-align: inherit;">设置了，则可以防止从站停止
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这样可以使从服务器继续复制，但它的
         </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格仍然会与主服务器上的不同。</font><font style="vertical-align: inherit;">如果应用程序逻辑</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以安全地丢失表</font><font style="vertical-align: inherit;">的内容</font><font style="vertical-align: inherit;">（例如，如果</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表用于缓存）</font><font style="vertical-align: inherit;">，则</font><font style="vertical-align: inherit;">这可以是可以的
         </font><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode=IDEMPOTENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        全局应用于所有表，因此可能会隐藏非</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">其他复制错误</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （刚刚描述的方法不适用于NDB群集，其中</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_exec_mode"><code class="literal">slave_exec_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终是
         </font></font><code class="literal">IDEMPOTENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可更改的。）
      </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">
        的大小</font><font style="vertical-align: inherit;">受</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值限制，
         </font><font style="vertical-align: inherit;">不会被复制（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-variables" title="16.4.1.38复制和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.38节“复制和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在改变
         </font></font><code class="literal">max_heap_table_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生的影响
         </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建或更新使用表</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE
        ... ENGINE = MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下的变化，或所有
         </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表以下重新启动服务器。</font><font style="vertical-align: inherit;">如果在主站上增加此变量的值而不在从站上执行此操作，主站上的一个表就会变得比从站上的一个变大，从而导致插入在主站上成功，但在从站上失败与</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表已满</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误。</font><font style="vertical-align: inherit;">这是一个已知问题（错误＃48666）。</font><font style="vertical-align: inherit;">在这种情况下，您必须</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属设备和主设备上</font><font style="vertical-align: inherit;">设置全局值
         </font><font style="vertical-align: inherit;">，然后重新启动复制。</font><font style="vertical-align: inherit;">还建议您重新启动主服务器和从服务器，以确保新值对每个服务器都具有完全（全局）的效果。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">表格的</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        请参见</font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><font style="vertical-align: inherit;">第15.3节“内存存储引擎”</font></a></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-mysqldb"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.21复制mysql系统数据库</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025332256"></a><a class="indexterm" name="idm140528025330800"></a><a class="indexterm" name="idm140528025329312"></a><a class="indexterm" name="idm140528025327824"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中的</font><font style="vertical-align: inherit;">表进行的数据修改语句
         </font><font style="vertical-align: inherit;">根据以下值进行复制</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">如果该值是</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则使用基于行的格式复制这些语句。</font><font style="vertical-align: inherit;">但是，通常会间接更新此信息的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">（例如
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操纵触发器，存储例程和视图的语句）会使用基于语句的复制复制到从属设备。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-optimizer"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.22复制和查询优化器</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025318800"></a><a class="indexterm" name="idm140528025317312"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果语句的写入方式使数据修改不确定，则主站和从站上的数据可能会有所不同; </font><font style="vertical-align: inherit;">也就是说，留下了查询优化器。</font><font style="vertical-align: inherit;">（在一般情况下，这不是一个好的实践中，即使外部的复制。）非确定性语句的示例包括</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用语句
         </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        条款; </font><font style="vertical-align: inherit;">有关这些的详细讨论，</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-limit" title="16.4.1.17复制和限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.17节“复制和限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-partitioning"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.23复制和分区</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025309184"></a><a class="indexterm" name="idm140528025307696"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区表之间支持复制，只要它们使用相同的分区方案，并且具有相同的结构，除非特别允许有例外（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-differing-tables" title="16.4.1.10复制主控和从属参数不同的表定义"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.10节“在主服务器和从服务器上使用不同表定义的复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通常不支持具有不同分区的表之间的复制。</font><font style="vertical-align: inherit;">这是因为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... DROP PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下直接作用于分区的</font><font style="vertical-align: inherit;">语句（例如
         </font><font style="vertical-align: inherit;">）可能会在主从服务器上产生不同的结果。</font><font style="vertical-align: inherit;">如果一个表在主服务器上而不在从服务器上进行分区，则在从服务器的主服务器副本上的分区上运行的任何语句都会失败。</font><font style="vertical-align: inherit;">当表的从属副本被分区但主分区的副本不存在时，在主分区上运行的语句不能在主分区上运行，而不会在那里引起错误。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于这些导致复制完全失败（由于语句失败）和不一致的风险（当分区级SQL语句的结果在主从服务器上产生不同结果时），我们建议确保对任何表进行分区从主站复制的是从站的这些表的版本。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-repair-table"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.24复制和修理表</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025300480"></a><a class="indexterm" name="idm140528025298976"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在损坏的表或其他损坏的表上使用时，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句</font><font style="vertical-align: inherit;">可能</font><font style="vertical-align: inherit;">会删除无法恢复的行。</font><font style="vertical-align: inherit;">但是，由此语句执行的任何表格数据修改都不会被复制，这会导致主站和从站失去同步。</font><font style="vertical-align: inherit;">出于这个原因，如果主服务器上的表被损坏并且
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于修复它，则应在使用之前先停止复制（如果它仍在运行）</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后再比较主服务器和从服务器的副本，然后进行比较准备在重新启动复制之前手动更正任何差异。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-reserved-words"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.25复制和保留字</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025291392"></a><a class="indexterm" name="idm140528025289904"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当您尝试从较旧的主站复制到较新的从站时，您可能会遇到问题，并且您使用主站上的标识符作为从站上运行的较新MySQL版本中的保留字。</font><font style="vertical-align: inherit;">一个例子是使用一个名为</font></font><code class="literal">virtual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.6主机</font><font style="vertical-align: inherit;">的表列</font><font style="vertical-align: inherit;">，它复制到5.7或更高版本的从机，因为它
         </font></font><code class="literal">VIRTUAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个以MySQL 5.7开头的保留字。</font><font style="vertical-align: inherit;">使用错误1064复制可能会失败在
         </font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语法中有错误...</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使使用保留字命名的数据库或表或具有使用保留字命名的列的表被排除在复制之外</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是由于每个SQL事件必须在执行前由从机解析，以便从机知道哪个数据库对象会受到影响; </font><font style="vertical-align: inherit;">只有在事件被解析可从通过应用所定义的任何过滤规则
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-db"><code class="option">--replicate-ignore-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要解决主服务器上数据库，表或列名称被从服务器视为保留字的问题，请执行以下操作之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在主服务器上</font><font style="vertical-align: inherit;">
            使用一个或多个</font><font style="vertical-align: inherit;">语句来更改任何数据库对象的名称，这些名称将被视为从服务器上的保留字，并更改使用旧名称的所有SQL语句以使用新名称。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在使用这些数据库对象名称的任何SQL语句中，使用反引号字符（</font></font><code class="literal">`</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">将名称写为带引号的标识符</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关MySQL版本的保留字列表，请参阅
         </font><em class="citetitle"><font style="vertical-align: inherit;">MySQL服务器版本参考</font></em><font style="vertical-align: inherit;">中的</font></font><a class="ulink" href="http://dev.mysql.com/doc/mysqld-version-reference/en/mysqld-version-reference-optvar.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关标识符引用规则，请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#identifiers" title="9.2模式对象名称"><font style="vertical-align: inherit;">第9.2节“模式对象名称”</font></a><font style="vertical-align: inherit;">。
</font></font><em class="citetitle"><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#identifiers" title="9.2模式对象名称"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-server-side-help"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.26复制服务器端帮助表</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器维护</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        数据库中用于存储</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#help" title="13.8.3 HELP语法"><code class="literal">HELP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">信息的
         </font><font style="vertical-align: inherit;">表（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#help" title="13.8.3 HELP语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.8.3节“HELP语法”）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些表可以手动加载，如</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-side-help-support" title="5.1.11服务器端帮助"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.11节“服务器端帮助”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        帮助表内容来源于MySQL参考手册。</font><font style="vertical-align: inherit;">每个MySQL发行系列都有特定的手册版本，所以帮助内容也针对每个系列。</font><font style="vertical-align: inherit;">通常情况下，您会加载与服务器版本匹配的帮助内容版本。</font><font style="vertical-align: inherit;">这对复制有影响。</font><font style="vertical-align: inherit;">例如，您可以将MySQL 5.6帮助内容加载到MySQL 5.6主服务器中，但不一定将该内容复制到5.7版本的帮助内容更适合的MySQL 5.7从服务器上。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何在服务器参与复制时管理帮助表内容升级。</font><font style="vertical-align: inherit;">服务器版本是此任务的一个因素。</font><font style="vertical-align: inherit;">另一个问题是，主站和从站之间的帮助表结构可能不同。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假定帮助内容存储在一个名为的文件中
         </font></font><code class="filename">fill_help_tables.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL发行版中，该文件位于
         </font></font><code class="filename">share</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">share/mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        目录下，并且最新版本始终可从</font></font><a class="ulink" href="http://dev.mysql.com/doc/index-other.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://dev.mysql.com/doc/index-other.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要升级帮助表，请使用以下过程。</font><font style="vertical-align: inherit;">这里讨论</font><font style="vertical-align: inherit;">的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">不会显示连接参数
         </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在所有情况下，请使用</font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有修改</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">中表的权限</font><font style="vertical-align: inherit;">的帐户连接到服务器
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade来</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级服务器</font><font style="vertical-align: inherit;">，首先在从</font><font style="vertical-align: inherit;">服务器</font><font style="vertical-align: inherit;">上，然后在主</font><font style="vertical-align: inherit;">服务器上运行
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是首先升级奴隶的通常原则。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            决定是否要将帮助表内容从主站复制到其从站。</font><font style="vertical-align: inherit;">如果不是，则分别在主设备和每个从设备上加载内容。</font><font style="vertical-align: inherit;">否则，请检查并解决主服务器与其从服务器上的帮助表结构之间的任何不兼容问题，然后将该内容装入主服务器并让它复制到从服务器。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关这两种加载帮助表格内容的更多细节如下。
</font></font></p></li></ol>
</div>
<h5><a name="idm140528025255072"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在加载帮助表内容而不复制到从站</font></font></h5>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在不复制的情况下加载帮助表内容，请使用</font></font><code class="filename">fill_help_tables.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含适合服务器版本的内容</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">文件（在一行中输入该命令）</font><font style="vertical-align: inherit;">单独在主服务器和每个从</font><font style="vertical-align: inherit;">服务器</font><font style="vertical-align: inherit;">上运行此命令
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --init-command =“SET sql_log_bin = 0”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  mysql &lt;fill_help_tables.sql</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_init-command"><code class="option">--init-command</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果从站也充当复制拓扑中其他从站的主站，请在每个服务器上</font><font style="vertical-align: inherit;">
        使用该</font><font style="vertical-align: inherit;">选项，包括从站。</font><font style="vertical-align: inherit;">该
         </font></font><code class="literal">SET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明禁止二进制日志记录。</font><font style="vertical-align: inherit;">在每台要升级的服务器上运行该命令后，就完成了。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从MySQL 5.7.5开始，该
           </font></font><code class="filename">fill_help_tables.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件包含</font></font><code class="literal">SET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于使文件内容不复制</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">因此，对于5.7.5及更高版本，命令更简单：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql mysql &lt;fill_help_tables.sql
</font></font></pre>
</div>
<h5><a name="idm140528025246096"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载与从站复制的帮助表内容</font></font></h5>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如前所述，
           </font></font><code class="filename">fill_help_tables.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL 5.7.5及更高版本中包含一条</font></font><code class="literal">SET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明，用于禁止文件内容的二进制日志记录。</font><font style="vertical-align: inherit;">如果您想为MySQL 5.7.5或更高版本复制帮助表内容，则必须进行编辑
           </font></font><code class="filename">fill_help_tables.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以删除该
           </font></font><code class="literal">SET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">这应该很少是需要的，因为帮助表内容是特定于它们加载到的服务器的版本的，这对于主站和从站来说可能不同。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您确实想要复制帮助表内容，请检查主站与其从站之间的帮助表不兼容性。</font><font style="vertical-align: inherit;">和
         </font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的
         </font></font><code class="literal">url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
         </font><font style="vertical-align: inherit;">最初是
         </font><font style="vertical-align: inherit;">，但</font><font style="vertical-align: inherit;">在更新的MySQL版本中，以容纳更长的URL。</font><font style="vertical-align: inherit;">要检查帮助表结构，请使用以下语句：
      </font></font><code class="literal">help_category</code><font style="vertical-align: inherit;"></font><code class="literal">help_topic</code><font style="vertical-align: inherit;"></font><code class="literal">CHAR(128)</code><font style="vertical-align: inherit;"></font><code class="literal">TEXT</code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT TABLE_NAME，COLUMN_NAME，COLUMN_TYPE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM INFORMATION_SCHEMA.COLUMNS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE TABLE_SCHEMA ='mysql'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND COLUMN_NAME ='url';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于具有旧结构的表，该语句产生了以下结果：
      </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ --------------- + ------------- ------------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_NAME | </font><font style="vertical-align: inherit;">COLUMN_NAME | </font><font style="vertical-align: inherit;">COLUMN_TYPE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------------- ------------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">help_category | </font><font style="vertical-align: inherit;">url | </font><font style="vertical-align: inherit;">char（128）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">help_topic | </font><font style="vertical-align: inherit;">url | </font><font style="vertical-align: inherit;">char（128）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------------- ------------- + +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于具有新结构的表，该语句产生了以下结果：
      </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ --------------- + ------------- ------------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_NAME | </font><font style="vertical-align: inherit;">COLUMN_NAME | </font><font style="vertical-align: inherit;">COLUMN_TYPE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------------- ------------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">help_category | </font><font style="vertical-align: inherit;">url | </font><font style="vertical-align: inherit;">文字|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">help_topic | </font><font style="vertical-align: inherit;">url | </font><font style="vertical-align: inherit;">文字|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------------- ------------- + +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果主服务器和从服务器都具有旧结构或两者都具有新结构，则它们是兼容的，并且您可以通过在主服务器上执行此命令来复制帮助表内容：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql mysql &lt;fill_help_tables.sql
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格内容将加载到主站中，然后复制到从站。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果主服务器和从服务器具有不兼容的帮助表（一台服务器具有旧的结构，另一台具有新的结构），则可以选择不复制帮助表内容，或者使表结构兼容，以便复制内容。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您决定不复制内容，请使用</font><font style="vertical-align: inherit;">带有该
             </font><font style="vertical-align: inherit;">选项的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单独升级主站和从站
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_init-command"><code class="option">--init-command</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如前所述。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您决定使表结构兼容，请升级具有旧结构的服务器上的表。</font><font style="vertical-align: inherit;">假设您的主服务器具有旧的表结构。</font><font style="vertical-align: inherit;">通过执行这些语句手动将表升级到新结构（在此禁用二进制日志记录以防止将更改复制到已具有新结构的从服务器）：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET sql_log_bin = 0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE mysql.help_category ALTER COLUMN url TEXT;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE mysql.help_topic ALTER COLUMN url TEXT;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            然后在master上运行这个命令：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql mysql &lt;fill_help_tables.sql
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表格内容将加载到主站中，然后复制到从站。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-shutdowns"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.27复制和主或从关机</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025220000"></a><a class="indexterm" name="idm140528025218512"></a><a class="indexterm" name="idm140528025217024"></a><a class="indexterm" name="idm140528025215536"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        关闭主服务器并稍后重新启动是安全的。</font><font style="vertical-align: inherit;">当一个从机失去与主机的连接时，从机会立即尝试重新连接，如果发生故障，则会定期重试。</font><font style="vertical-align: inherit;">默认情况是每60秒重试一次。</font><font style="vertical-align: inherit;">这可能会随着</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        声明</font><font style="vertical-align: inherit;">而改变</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一个奴隶也能够处理网络连接中断。</font><font style="vertical-align: inherit;">但是，从设备仅在收到主设备的数据达</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_net_timeout"><code class="literal">slave_net_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数秒</font><font style="vertical-align: inherit;">之后才会注意到网络中断
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您的停电时间很短，您可能需要减少
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_net_timeout"><code class="literal">slave_net_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-unexpected-slave-halt" title="16.3.2处理意外的复制从站暂停"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.2节“处理意外的复制从站暂停”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于主二进制日志文件没有被刷新，因此主端的非正常关闭（例如，崩溃）可能导致主二进制日志的最终位置小于从服务器读取的最新位置。</font><font style="vertical-align: inherit;">这可能会导致从服务器无法在主服务器恢复时进行复制。</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中进行</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">有助于最大限度地减少此问题，因为它会导致主服务器更频繁地刷新其二进制日志。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        干净地关闭一个奴隶是安全的，因为它可以跟踪它离开的地方。</font><font style="vertical-align: inherit;">但是，请注意，从站没有打开临时表; </font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-temptables" title="16.4.1.30复制和临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.30节“复制和临时表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不清洁的关机可能会产生问题，特别是在问题发生之前磁盘缓存未刷新到磁盘的情况下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于事务，从属提交并更新
             </font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果在这两个操作之间发生崩溃，则继电器日志处理将比信息文件指示进一步进行，并且从属设备在重新启动后将重新执行中继日志中最后一个事务的事件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果从设备更新</font></font><code class="filename">relay-log.info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但服务器主机在写入写入磁盘之前崩溃，则</font><font style="vertical-align: inherit;">可能会出现类似的问题
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了最小化发生这种情况的可能性，请</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log_info"><code class="literal">sync_relay_log_info=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从属</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">设置
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_sync_relay_log_info"><code class="literal">sync_relay_log_info</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0会导致写入操作不能强制进入磁盘，并且服务器会依赖操作系统不时刷新文件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您拥有良好的不间断电源，则系统对这些类型问题的容错能力会大大增加。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-slaveerrors"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.28复制期间的从站错误</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025195552"></a><a class="indexterm" name="idm140528025194064"></a><a class="indexterm" name="idm140528025192576"></a><a class="indexterm" name="idm140528025191088"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果语句在主服务器和从服务器上产生相同的错误（相同的错误代码），则会记录错误，但复制仍在继续。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果语句在主服务器和从服务器上产生不同的错误，则从属SQL线程终止，从服务器将消息写入其错误日志，并等待数据库管理员决定如何处理错误。</font><font style="vertical-align: inherit;">这包括语句在主站或从站上产生错误的情况，但不包括两者。</font><font style="vertical-align: inherit;">要解决该问题，请手动连接到从站并确定问题的原因。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对此很有用。</font><font style="vertical-align: inherit;">然后解决问题并运行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START
        SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，您可能需要创建一个不存在的表，然后才能再次启动从站。

</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果在从站的错误日志中记录了临时错误，则不必采取引用错误消息中建议的任何操作。</font><font style="vertical-align: inherit;">临时错误应由客户重试交易处理。</font><font style="vertical-align: inherit;">例如，如果从属SQL线程记录与死锁有关的临时错误，则不需要在从属设备上手动重新启动事务，除非从属SQL线程随后以非临时性错误消息终止。
</font></font></p>
</div>
<p>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果此错误代码验证行为不可取，则可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-skip-errors"><code class="option">--slave-skip-errors</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">将部分或全部错误屏蔽掉（忽略）
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于非事务性存储引擎（例如）
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可能会有一个只能部分更新表并返回错误代码的语句。</font><font style="vertical-align: inherit;">例如，这可能发生在多行插入中，该插入的行违反了关键约束，或者如果在更新某些行后更新了较长的语句。</font><font style="vertical-align: inherit;">如果这种情况发生在主设备上，则从设备期望执行该语句以产生相同的错误代码。</font><font style="vertical-align: inherit;">如果不是这样，则从属SQL线程按前面所述停止。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果要在使用主服务器和从服务器上不同存储引擎的表之间进行复制，请记住，对一个版本的表运行时，相同的语句可能会产生不同的错误，或者可能会导致错误表格的版本，但不是其他版本。</font><font style="vertical-align: inherit;">例如，由于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略外键约束，因此</font><font style="vertical-align: inherit;">访问</font><font style="vertical-align: inherit;">主</font><font style="vertical-align: inherit;">服务器上的</font><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">语句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会导致外键违例，但</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从服务器上的同一表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">版本上</font><font style="vertical-align: inherit;">执行的语句
         </font><font style="vertical-align: inherit;">不会产生此类错误，从而导致复制停止。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-sql-mode"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.29复制和服务器SQL模式</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025173504"></a><a class="indexterm" name="idm140528025172016"></a><a class="indexterm" name="idm140528025170528"></a><a class="indexterm" name="idm140528025169040"></a><a class="indexterm" name="idm140528025167552"></a><a class="indexterm" name="idm140528025166064"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在主服务器和从服务器上使用不同的服务器SQL模式设置可能会导致主服务器和从服务器上的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        处理方式不同，导致主服务器和从服务器发生分歧。</font><font style="vertical-align: inherit;">为了获得最佳结果，您应始终在主服务器和从服务器上使用相同的服务器SQL模式。</font><font style="vertical-align: inherit;">无论您使用基于语句还是基于行的复制，此建议都适用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果要复制分区表，则在主服务器和从服务器上使用不同的SQL模式很可能会导致问题。</font><font style="vertical-align: inherit;">至少，这可能会导致分区间的数据分配在给定表的主副本副本中不同。</font><font style="vertical-align: inherit;">它也可能导致插入到在主服务器上成功失败的分区表中。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#sql-mode" title="5.1.8服务器SQL模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.8节“服务器SQL模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">具体来说，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#sql-mode-changes" title="MySQL 5.7中的SQL模式更改"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 5.7中的SQL模式更改</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中介绍了MySQL 5.7中的更改，以便您可以评估应用程序是否会受到影响。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-temptables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.30复制和临时表</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025158464"></a><a class="indexterm" name="idm140528025157008"></a><a class="indexterm" name="idm140528025155520"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下段落中的讨论不适用，
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为在这种情况下，临时表不会被复制; </font><font style="vertical-align: inherit;">这意味着在从机发生非计划关机时，从机上不会有任何临时表丢失。</font><font style="vertical-align: inherit;">本节的其余部分仅适用于使用基于语句或混合格式的复制。</font><font style="vertical-align: inherit;">在从服务器上复制的临时表的损失可能是一个问题，只要
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
         </font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，涉及可安全使用基于语句格式被记录临时表的语句。</font><font style="vertical-align: inherit;">有关基于行的复制和临时表的更多信息，请参阅临时表
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rbr-usage-temptables" title="临时表的基于行的日志记录"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的基于行的日志记录</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用临时表时，安全的从机关机。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          临时表将被复制，除非您停止从属服务器（不仅仅是从属线程），并且您复制了临时表，这些临时表可用于尚未在从属设备上执行的更新。</font><font style="vertical-align: inherit;">如果停止从服务器，那么当从服务器重新启动时，这些更新所需的临时表将不再可用。</font><font style="vertical-align: inherit;">为避免此问题，请不要在临时表打开时关闭从属设备。</font><font style="vertical-align: inherit;">请改用以下步骤：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            发表</font></font><code class="literal">STOP SLAVE SQL_THREAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查的数值
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Slave_open_temp_tables"><code class="literal">Slave_open_temp_tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            变量。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果值不为0，请重新启动从属SQL线程，
             </font></font><code class="literal">START SLAVE SQL_THREAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稍后重复此过程。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当值为0时，发出一个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin shutdown</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来停止从站。
</font></font></p></li></ol>
</div>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">临时表和复制选项。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          默认情况下，所有临时表都被复制; </font><font style="vertical-align: inherit;">这种情况是否不存在任何匹配
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-db"><code class="option">--replicate-do-db</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-do-table"><code class="option">--replicate-wild-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在效果选项。</font><font style="vertical-align: inherit;">然而，
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项很荣幸临时表。</font><font style="vertical-align: inherit;">例外是，为了在会话结束时正确删除临时表，复制从属节点总是复制
           </font></font><code class="literal">DROP TEMPORARY TABLE IF EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，而不管通常适用于指定表的任何排除规则。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在使用基于语句或混合格式的复制时，推荐的做法是指定一个前缀，用于命名不想复制的临时表，然后使用一个
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项来匹配该前缀。</font><font style="vertical-align: inherit;">例如，你可能会给所有这样的表名开头</font></font><code class="literal">norep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（如</font></font><code class="literal">norepmytable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">norepyourtable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等），然后使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-wild-ignore-table"><code class="option">--replicate-wild-ignore-table=norep%</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ，以防止它们被复制。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-timeout"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.31复制重试和超时</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025123072"></a><a class="indexterm" name="idm140528025121584"></a><a class="indexterm" name="idm140528025120096"></a><a class="indexterm" name="idm140528025119024"></a><a class="indexterm" name="idm140528025117536"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        全局系统变量
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries"><code class="literal">slave_transaction_retries</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        会影响复制，如下所示：如果从属SQL线程由于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        死锁或由于超出</font></font><code class="literal">InnoDB</code>
        <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值或</font><font style="vertical-align: inherit;">or
         </font><font style="vertical-align: inherit;">值而</font><font style="vertical-align: inherit;">未能执行事务</font><font style="vertical-align: inherit;">，则</font><font style="vertical-align: inherit;">在停止发生错误之前</font><font style="vertical-align: inherit;">，从属会自动重试事务
         </font><font style="vertical-align: inherit;">时间。</font><font style="vertical-align: inherit;">默认值是10.总重试次数可以在输出中看到
         </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;">第5.1.7节“服务器状态变量”</font></a><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a>
        <code class="literal">TransactionDeadlockDetectionTimeout</code><font style="vertical-align: inherit;"></font><code class="literal">TransactionInactiveTimeout</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_transaction_retries"><code class="literal">slave_transaction_retries</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW STATUS</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-timezone"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.32复制和时区</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025104688"></a><a class="indexterm" name="idm140528025103200"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        默认情况下，主服务器和从服务器假定它们位于同一时区。</font><font style="vertical-align: inherit;">如果您要在不同时区的服务器之间进行复制，则必须在主站和从站上设置时区。</font><font style="vertical-align: inherit;">否则，取决于主服务器上的本地时间的语句不会被正确复制，例如使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_now"><code class="literal">NOW()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_from-unixtime"><code class="literal">FROM_UNIXTIME()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过使用</font><font style="vertical-align: inherit;">脚本</font><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">或设置</font><font style="vertical-align: inherit;">环境变量</font><font style="vertical-align: inherit;">来设置</font><font style="vertical-align: inherit;">运行MySQL服务器的时区
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-functions" title="16.4.1.15复制和系统功能"><font style="vertical-align: inherit;">第16.4.1.15节“复制和系统函数”</font></a><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqld_safe_timezone"><code class="option">--timezone=<em class="replaceable"><code>timezone_name</code></em></code></a><font style="vertical-align: inherit;"></font><code class="filename">mysqld_safe</code><font style="vertical-align: inherit;"></font><code class="literal">TZ</code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-functions" title="16.4.1.15复制和系统功能"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-transaction-inconsistencies"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.33复制和事务不一致</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        取决于您的复制配置，可能会发生从中继日志中执行的事务序列中的不一致。</font><font style="vertical-align: inherit;">本节介绍如何避免不一致并解决它们造成的任何问题。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下类型的不一致可以存在：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半应用交易</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">更新非事务表的事务已经应用了一些但并非全部的更改。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">差距</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">缺口是一种尚未（完全）应用的交易，尽管后来的一些交易已经被应用。</font><font style="vertical-align: inherit;">只有使用多线程从站时才会出现间隙。</font><font style="vertical-align: inherit;">为了避免发生间隙，集
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave_preserve_commit_order=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这就要求
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_type"><code class="literal">slave_parallel_type=LOGICAL_CLOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_bin"><code class="literal">log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_log_slave_updates"><code class="literal">log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也启用。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无间隙低水位位置</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">即使没有差距，也有可能</font></font><code class="literal">Exec_master_log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在应用</font><font style="vertical-align: inherit;">之后</font><font style="vertical-align: inherit;">进行</font><font style="vertical-align: inherit;">交易</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，所有直到点的事务
            </font></font><code class="literal">N</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都已经被应用，并且没有事务</font></font><code class="literal">N</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被应用，但是
            </font></font><code class="literal">Exec_master_log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它的值小于。</font></font><code class="literal">N.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这只能发生在多线程的从机上。</font><font style="vertical-align: inherit;">启用
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave_preserve_commit_order</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止无间隙低水印位置。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下情景与半应用事务，间隙和无间隙低水印位置不一致的存在相关：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当从属线程正在运行时，可能存在差距和半应用事务。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭。</font><font style="vertical-align: inherit;">无论是干净的还是不干净的关闭都会中止正在进行的交易，并且可能会留下空白和半应用交易
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#kill" title="13.7.6.4 KILL语法"><code class="literal">KILL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的复制线程（使用单线程从站时的SQL线程，使用多线程从站时的协调器线程）。</font><font style="vertical-align: inherit;">这会中止正在进行的交易，并可能留下差距和半程应用交易。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            应用程序线程错误。</font><font style="vertical-align: inherit;">这可能会留下空隙。</font><font style="vertical-align: inherit;">如果错误出现在混合交易中，那么该交易将被应用一半。</font><font style="vertical-align: inherit;">当使用多线程从机时，未收到错误的工作人员完成其队列，因此可能需要一段时间才能停止所有线程。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用一个多线程的奴隶。</font><font style="vertical-align: inherit;">发布后
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从属等待填补任何空白，然后更新
             </font></font><code class="literal">Exec_master_log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这确保了它永远不会留下间隙或没有间隙的低水位位置，除非上述情况适用（换句话说，在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">，发生错误或其他线程问题
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#kill" title="13.7.6.4 KILL语法"><code class="literal">KILL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或服务器重新启动），在这些情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            返回成功。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果中继日志中的最后一个事务只收到一半，并且多线程从协调器已开始将事务调度给工作人员，则
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等待最多等待60秒才能收到事务。</font><font style="vertical-align: inherit;">超时后，协调员放弃并中止交易。</font><font style="vertical-align: inherit;">如果交易混合，它可能会留下一半。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用单线程从机时。</font><font style="vertical-align: inherit;">如果正在进行的事务只更新事务表，则它将被回滚并
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立即停止。</font><font style="vertical-align: inherit;">如果正在进行的交易混合，则
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最多等待60秒以完成交易。</font><font style="vertical-align: inherit;">超时后，它会中止交易，因此可能会暂停一半。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        全局变量
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_rpl_stop_slave_timeout"><code class="literal">rpl_stop_slave_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与停止复制线程的过程无关。</font><font style="vertical-align: inherit;">它只会让问题的客户端</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE语法"><code class="literal">STOP
        SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回到客户端，但复制线程将继续尝试停止。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果复制渠道存在差距，则会产生以下后果：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从属数据库处于主服务器上可能永远不存在的状态。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该领域</font></font><code class="literal">Exec_master_log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也只是“低水印”。</font><font style="vertical-align: inherit;">换句话说，出现在头寸之前的交易被保证承诺，但头寸之后的交易可能已经承诺或没有承诺。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该通道的语句会失败并显示错误，除非应用程序线程正在运行，并且该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE
            MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句只设置接收器选项。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font><font style="vertical-align: inherit;">启动
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_relay-log-recovery"><code class="option">--relay-log-recovery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则不会为该通道执行恢复，并会打印警告。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_dump-slave"><code class="option">--dump-slave</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它不记录缺口的存在; </font><font style="vertical-align: inherit;">从而将</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其
             </font></font><code class="literal">RELAY_LOG_POS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为</font><font style="vertical-align: inherit;">打印
             </font><font style="vertical-align: inherit;">到低水印位置</font></font><code class="literal">Exec_master_log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在其他服务器上应用转储并启动复制线程后，位置后出现的事务将再次复制。</font><font style="vertical-align: inherit;">请注意，如果启用了GTID，则这是无害的（但在这种情况下，不建议使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_dump-slave"><code class="option">--dump-slave</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果复制通道具有无间隙低水印位置，则上述情况2至5适用，但情况1不适用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        无间隙低水印位置信息在内部表格中以二进制格式保存
         </font></font><code class="literal">mysql.slave_worker_info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE
        [SQL_THREAD]</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终咨询此信息，以便仅适用于正确的交易。</font><font style="vertical-align: inherit;">即使</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经改为0之前</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START
        SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即使</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START
        SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="literal">UNTIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句一起</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">，也是如此</font><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE UNTIL
        SQL_AFTER_MTS_GAPS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是根据需要应用尽可能多的交易以填补空白。</font><font style="vertical-align: inherit;">如果
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于
         </font></font><code class="literal">UNTIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示它在消耗所有间隙之前停止的子句，则会留下剩余的间隙。
</font></font></p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><code class="literal">RESET SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除中继日志并重置复制位置。</font><font style="vertical-align: inherit;">因此，向</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE语法"><code class="literal">RESET SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有缺口的奴隶</font><font style="vertical-align: inherit;">发放
           </font><font style="vertical-align: inherit;">意味着奴隶失去了有关缺口的任何信息，而没有纠正差距。
</font></font></p>
</div>
<p>
        <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave-preserve-commit-order</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        确保没有差距。</font><font style="vertical-align: inherit;">但是，</font></font><code class="literal">Exec_master_log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上面的场景1到4中，</font><font style="vertical-align: inherit;">仍然可能</font><font style="vertical-align: inherit;">只是无间隙的低水位位置。</font><font style="vertical-align: inherit;">也就是说，之后可能会有交易</font></font><code class="literal">Exec_master_log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        被应用。</font><font style="vertical-align: inherit;">因此，即使</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave-preserve-commit-order</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用了</font><font style="vertical-align: inherit;">上面的情况，上面的情况编号为2至5（但不是情况1）
         </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-transactions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.34复制和事务</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528025011440"></a><a class="indexterm" name="idm140528025009952"></a><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在同一个交易中混合交易和非交易报表。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通常，应该避免在复制环境中更新事务和非事务表的事务。</font><font style="vertical-align: inherit;">您还应该避免使用任何访问事务性（或临时性）和非事务性表并写入其中任何表的语句。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器将这些规则用于二进制日志记录：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果事务中的初始语句是非事务性的，则它们会立即写入二进制日志。</font><font style="vertical-align: inherit;">在事务提交之前，事务中的其余语句被缓存并且不写入二进制日志。</font><font style="vertical-align: inherit;">（如果事务回滚，只有当它们进行了无法回滚的非事务性更改时，高速缓存的语句才写入二进制日志中，否则它们将被丢弃。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于基于语句的日志记录，非事务语句的日志记录受</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates"><code class="literal">binlog_direct_non_transactional_updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量的</font><font style="vertical-align: inherit;">影响
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当这个变量是
             </font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认）时，日志就像刚刚描述的那样。</font><font style="vertical-align: inherit;">当这个变量是</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，对于事务中任何地方发生的非事务性语句（不仅仅是初始的非事务语句），记录立即发生。</font><font style="vertical-align: inherit;">其他语句保存在事务高速缓存中，并在事务提交时进行记录。
            </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates"><code class="literal">binlog_direct_non_transactional_updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对行格式或混合格式二进制日志记录没有影响。
</font></font></p></li></ul>
</div>
<p><a name="replication-features-transactions-trx-nontrx-mixed"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易型，非交易型和混合型报表。&nbsp;</font></font></b><a class="indexterm" name="idm140528024998048"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了应用这些规则，如果服务器仅更改非事务表，则服务器将其视为非事务性;如果仅更改事务性表，则事务性事务。</font><font style="vertical-align: inherit;">引用非事务表和事务表并且更新</font><font style="vertical-align: inherit;">涉及的</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">
          语句</font><font style="vertical-align: inherit;">被认为是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">混合</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">（在过去的一些版本的MySQL，只有更新的声明</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非事务性和事务性表，被认为是混合的。）混合语句，像事务语句，缓存和事务提交时记录。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果语句也执行以下任一操作，则更新事务表的混合语句被认为是不安全的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            更新或读取临时表
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            读取非事务性表并且事务隔离级别小于REPEATABLE_READ
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果执行以下任一操作，则在事务内的事务表更新之后的混合语句被认为是不安全的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            更新任何表并从任何临时表中读取
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            更新非事务性表并
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_direct_non_transactional_updates"><code class="literal">binlog_direct_non_transactional_updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            关闭
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-rbr-safe-unsafe" title="16.2.1.3在二进制测井中确定安全和不安全的陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1.3节“确定二进制日志中的安全和不安全的语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          混合语句与混合二进制日志记录格式无关。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在事务混合更新事务性和非事务性表的情况下，二进制日志中的语句顺序是正确的，并且所有需要的语句都会写入二进制日志中，即使发生了
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">ROLLBACK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，当第二个连接在第一个连接事务完成之前更新非事务性表时，可能会将语句乱序登录，因为第二个连接更新在执行后立即写入，而不管第一个连接事务执行的状态连接。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主站和从站上使用不同的存储引擎。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以使用从站上的非事务表复制主站上的事务表。</font><font style="vertical-align: inherit;">例如，您可以将</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主表</font><font style="vertical-align: inherit;">复制</font><font style="vertical-align: inherit;">为
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从表。</font><font style="vertical-align: inherit;">但是，如果这样做，如果</font><font style="vertical-align: inherit;">从站在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">BEGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ... </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块</font><font style="vertical-align: inherit;">的中间停止，则会出现问题，</font><font style="vertical-align: inherit;">因为从站将在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">BEGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块</font><font style="vertical-align: inherit;">的开始处重新启动
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        将从</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主服务器上的表的事务</font><font style="vertical-align: inherit;">复制到从服务器</font><font style="vertical-align: inherit;">上的事务处理表（例如使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">表
         </font><font style="vertical-align: inherit;">）也是安全
         </font><font style="vertical-align: inherit;">的。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_autocommit"><code class="literal">AUTOCOMMIT=1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        主站上发布</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">语句被复制，从而</font></font><code class="literal">AUTOCOMMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在从站上</font><font style="vertical-align: inherit;">强制执行
         </font><font style="vertical-align: inherit;">模式。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当从机的存储引擎类型为非事务性时，应避免主机上的混合事务性和非事务性表更新的事务，因为它们可能会导致主事务表和从事非事务性表之间的数据不一致。</font><font style="vertical-align: inherit;">也就是说，这样的事务可能会导致主存储引擎特定的行为，并可能导致复制失去同步效果。</font><font style="vertical-align: inherit;">当前，MySQL不会发出警告，因此在将事务表从主表复制到从表上的非事务表时，应格外小心。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改事务中的二进制日志记录格式。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_checksum"><code class="literal">binlog_checksum</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量是只读的，只要交易正在进行中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个事务（包括
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务）都记录在二进制日志中，就像它以一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">BEGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句</font><font style="vertical-align: inherit;">开始一样
         </font><font style="vertical-align: inherit;">，并以一个
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或一个
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">ROLLBACK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句结束。</font><font style="vertical-align: inherit;">这对于影响使用非事务性存储引擎（例如</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">表的语句来说也是如此
         </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关XA交易特别适用的限制，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/restrictions.html#xa-restrictions" title="C.6对XA交易的限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第C.6节“XA交易限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-triggers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.35复制和触发器</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528024956192"></a><a class="indexterm" name="idm140528024954704"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用基于语句的复制时，主站上执行的触发器也会在从站上执行。</font><font style="vertical-align: inherit;">使用基于行的复制时，在主站上执行的触发器不会在从站上执行。</font><font style="vertical-align: inherit;">相反，从触发器执行产生的主设备上的行更改将复制并应用到从设备上。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此行为是设计使然。</font><font style="vertical-align: inherit;">如果在基于行的复制下，从属设备应用了触发器以及由它们引起的行更改，则更改实际上将在从属设备上应用两次，从而导致主设备和从设备上的数据不同。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果你想让触发器在主设备和从设备上执行 - 可能因为你在主设备和从设备上有不同的触发器 - 你必须使用基于语句的复制。</font><font style="vertical-align: inherit;">但是，要启用从属端触发器，则不必专门使用基于语句的复制。</font><font style="vertical-align: inherit;">仅对那些需要此效果的语句切换到基于语句的复制并在其余时间使用基于行的复制就足够了。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        调用触发器（或函数）的语句导致对</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的更新</font><font style="vertical-align: inherit;">不会使用基于语句的复制正确复制。</font><font style="vertical-align: inherit;">MySQL 5.7将这些语句标记为不安全。</font><font style="vertical-align: inherit;">（错误＃45677）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        触发器可以触发事件（的不同组合触发</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和动作时间（</font></font><code class="literal">BEFORE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">AFTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），然而MySQL 5.7.2之前，不能有具有相同的触发事件和动作时间多个触发器。</font><font style="vertical-align: inherit;">MySQL 5.7.2解除了这个限制，允许多个触发器。</font><font style="vertical-align: inherit;">此更改对升级和降级具有复制影响。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为简洁起见，</font><font style="vertical-align: inherit;">这里的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多触发器</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font><span class="quote"><font style="vertical-align: inherit;">“ </font></span><span class="quote"><span class="quote"><font style="vertical-align: inherit;">触发事件和动作时间相同的</font></span></span><span class="quote"><span class="quote"><font style="vertical-align: inherit;">多触发器</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”</font></span><font style="vertical-align: inherit;">的缩写</font><span class="quote"><span class="quote"><font style="vertical-align: inherit;">。</font></span></span><span class="quote"><font style="vertical-align: inherit;">”</font></span></font><span class="quote"><font style="vertical-align: inherit;"></font><span class="quote"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></span>
      </p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级。</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设您将不支持多触发器的旧服务器升级到MySQL 5.7.2或更高版本。</font><font style="vertical-align: inherit;">如果新服务器是复制主服务器，并且旧从服务器不支持多个触发器，则如果在主服务器上为已经具有触发器且具有相同触发事件和操作时间的表创建触发器，则会在这些从服务器上发生错误。</font><font style="vertical-align: inherit;">为避免此问题，请先升级从站，然后升级主站。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">降级。</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您将支持多个触发器的服务器降级为旧版本，则降级会产生以下效果：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于每个具有触发器的表，所有触发器定义都保留在</font></font><code class="filename">.TRG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">文件中。</font><font style="vertical-align: inherit;">但是，如果有多个具有相同触发事件和操作时间的触发器，则当发生触发器事件时，服务器仅执行其中的一个触发器。</font><font style="vertical-align: inherit;">有关</font></font><code class="literal">.TRG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件的</font><font style="vertical-align: inherit;">信息
             </font><font style="vertical-align: inherit;">，请参阅
             </font></font><a class="ulink" href="http://dev.mysql.com/doc/dev/mysql-server/latest//stored_programs.html#sp_storage_trigger" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格触发器存储</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果在降级后添加或删除表的触发器，则服务器会重写表的
             </font></font><code class="filename">.TRG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">重写的文件在触发事件和动作时间的组合中仅保留一个触发器; </font><font style="vertical-align: inherit;">其他人都失去了。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了避免这些问题，请在降级之前修改触发器。</font><font style="vertical-align: inherit;">对于每个组合触发事件和动作时间都有多个触发器的表，请按如下方式将每个这样的触发器组转换为一个触发器：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于每个触发器，创建一个包含触发器中所有代码的存储例程。</font><font style="vertical-align: inherit;">值使用访问
             </font></font><code class="literal">NEW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">OLD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可传递到日常使用的参数。</font><font style="vertical-align: inherit;">如果触发器需要代码中的单个结果值，则可以将代码放入存储函数中并让该函数返回值。</font><font style="vertical-align: inherit;">如果触发器需要代码中的多个结果值，则可以将代码放入存储过程中，并使用</font></font><code class="literal">OUT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">返回值</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            删除表格的所有触发器。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为调用刚刚创建的存储例程的表创建一个新的触发器。</font><font style="vertical-align: inherit;">因此该触发器的效果与其替换的多重触发器相同。
</font></font></p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-truncate"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.36复制和截断表</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528024925552"></a><a class="indexterm" name="idm140528024924064"></a><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常被认为是DML语句，因此在二进制日志记录模式为</font></font><code class="literal">ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font><font style="vertical-align: inherit;">时，应该使用基于行的格式进行记录和复制</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然而，这种记录或复制时，引起的问题</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式，即使用事务性存储引擎，如表</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当事务隔离级别是</font></font><code class="literal">READ
        COMMITTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">READ UNCOMMITTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这就排除了基于语句的记录。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为DDL而不是DML进行日志记录和复制，以便它可以作为语句记录和复制。</font><font style="vertical-align: inherit;">但是，适用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于复制从站的其他事务表以及</font><font style="vertical-align: inherit;">适用</font><font style="vertical-align: inherit;">于该复制从站的其他事务表</font><font style="vertical-align: inherit;">的效果
         </font><font style="vertical-align: inherit;">仍然遵循</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.34节“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理这些表的</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><font style="vertical-align: inherit;">TRUNCATE TABLE语法”中</font></a><font style="vertical-align: inherit;">所述的规则
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（错误＃36763）
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-user-names"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.37复制和用户名长度</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528024909936"></a><a class="indexterm" name="idm140528024908480"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7.8中，MySQL用户名的最大长度从16个字符增加到32个字符。</font><font style="vertical-align: inherit;">将超过16个字符的用户名复制到仅支持较短用户名的从站时将失败。</font><font style="vertical-align: inherit;">但是，只有在从新主设备复制到旧设备时，才会发生这种情况，这不是推荐的配置。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.38复制和变量</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528024904976"></a><a class="indexterm" name="idm140528024903488"></a><a class="indexterm" name="idm140528024902000"></a><a class="indexterm" name="idm140528024900512"></a><a class="indexterm" name="idm140528024899024"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        系统变量在使用</font></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">时不会被正确复制
         </font><font style="vertical-align: inherit;">，除了与会话范围一起使用时，下列变量除外：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_character_set_client"><code class="literal">character_set_client</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_character_set_connection"><code class="literal">character_set_connection</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_character_set_database"><code class="literal">character_set_database</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_character_set_server"><code class="literal">character_set_server</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_collation_connection"><code class="literal">collation_connection</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_collation_database"><code class="literal">collation_database</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_collation_server"><code class="literal">collation_server</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_identity"><code class="literal">identity</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_last_insert_id"><code class="literal">last_insert_id</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_lc_time_names"><code class="literal">lc_time_names</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_pseudo_thread_id"><code class="literal">pseudo_thread_id</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_auto_is_null"><code class="literal">sql_auto_is_null</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_time_zone"><code class="literal">time_zone</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_timestamp"><code class="literal">timestamp</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_unique_checks"><code class="literal">unique_checks</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><code class="literal">MIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式时，上述列表中的变量与会话作用域一起使用时，会导致从基于语句的切换到基于行的日志记录切换。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log-mixed" title="5.4.4.3混合二进制记录格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4.3节“混合二进制记录格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_mode"><code class="literal">sql_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_dir_in_create"><code class="literal">NO_DIR_IN_CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">外，也被复制
         </font><font style="vertical-align: inherit;">; </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_dir_in_create"><code class="literal">NO_DIR_IN_CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论主机上的变化如何，</font><font style="vertical-align: inherit;">从机始终保留自己的值
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有复制格式都是如此。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，当</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析一条
         </font><font style="vertical-align: inherit;">语句时，包含的完整
         </font><font style="vertical-align: inherit;">值
         </font><font style="vertical-align: inherit;">将传递给接收服务器。</font><font style="vertical-align: inherit;">由于这个原因，当</font><font style="vertical-align: inherit;">使用模式</font><font style="vertical-align: inherit;">时，复制这样的语句可能不安全</font><font style="vertical-align: inherit;">。
      </font></font><code class="literal">SET @@sql_mode =
        <em class="replaceable"><code>mode</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>mode</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_dir_in_create"><code class="literal">NO_DIR_IN_CREATE</code></a><font style="vertical-align: inherit;"></font><code class="literal">STATEMENT</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        的</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_storage_engine"><code class="literal">storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量不会被复制，而不考虑记录模式的; </font><font style="vertical-align: inherit;">这旨在促进不同存储引擎之间的复制。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量是不可复制的。</font><font style="vertical-align: inherit;">另外，启用这个变量对于临时表，表锁和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD语法"><code class="literal">SET PASSWORD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不同MySQL版本</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">有不同的影响</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量是不可复制的。</font><font style="vertical-align: inherit;">在主机上增加此变量的值而不在从机上这样做时，最终可能会导致</font><font style="vertical-align: inherit;">在从机上执行</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">时，从机上的</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表是完全</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误
         </font><font style="vertical-align: inherit;">，因此主机</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上的</font><font style="vertical-align: inherit;">语句
         </font><font style="vertical-align: inherit;">允许比从机上的副本更大。</font><font style="vertical-align: inherit;">有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-memory" title="16.4.1.20复制和内存表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.20节“复制和存储器表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在基于语句的复制中，在用于更新表的语句中使用会话变量时不会正确复制。</font><font style="vertical-align: inherit;">例如，以下语句序列不会在主站和从站中插入相同的数据：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET max_join_size = 1000;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO mytable VALUES（@@ max_join_size）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这不适用于通用序列：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET time_zone = ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO mytable VALUES（CONVERT_TZ（...，...，@@ time_zone））;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在使用基于行的复制时，会话变量的复制不成问题，在这种情况下，会话变量总是安全地复制。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        无论日志记录格式如何，以下会话变量都会写入二进制日志，并且在解析二进制日志时由复制从属服务器承认：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_mode"><code class="literal">sql_mode</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_unique_checks"><code class="literal">unique_checks</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_character_set_client"><code class="literal">character_set_client</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_collation_connection"><code class="literal">collation_connection</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_collation_database"><code class="literal">collation_database</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_collation_server"><code class="literal">collation_server</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_auto_is_null"><code class="literal">sql_auto_is_null</code></a>
</p></li></ul>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          即使与字符集和归类相关的会话变量被写入二进制日志，也不支持不同字符集之间的复制。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为帮助减少可能的混淆，我们建议您始终</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_lower_case_table_names"><code class="literal">lower_case_table_names</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器和从服务器上</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">使用相同的设置
         </font><font style="vertical-align: inherit;">，特别是在具有区分大小写的文件系统的平台上运行MySQL时。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="replication-features-views"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.1.39复制和视图</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528024811392"></a><a class="indexterm" name="idm140528024809904"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        视图总是被复制到奴隶。</font><font style="vertical-align: inherit;">视图按其自己的名称过滤，而不是由它们引用的表格过滤。</font><font style="vertical-align: inherit;">这意味着即使视图包含一个通常会被</font></font><code class="option">replication-ignore-table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则</font><font style="vertical-align: inherit;">过滤掉的表，也可以将视图复制到从属系统
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，应该注意确保视图不会复制出于安全原因通常会被过滤的表格数据。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用基于语句的日志记录支持从表到同名视图的复制，但在使用基于行的日志记录时不支持。</font><font style="vertical-align: inherit;">在基于行的日志记录生效时试图这样做会导致错误。</font><font style="vertical-align: inherit;">（错误＃11752707，错误＃43975）
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-compatibility"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.2 MySQL版本之间的复制兼容性</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL支持从一个发行版系列到更高版本系列的复制。</font><font style="vertical-align: inherit;">例如，您可以从运行MySQL 5.5的主服务器复制到运行MySQL 5.6的从服务器，从运行MySQL 5.6的主服务器到运行MySQL 5.7的从服务器等等。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      但是，如果主服务器使用语句或依赖从服务器上使用的MySQL版本不再支持的行为，则从较旧的主服务器复制到较新的从服务器时可能会遇到困难。</font><font style="vertical-align: inherit;">例如，在MySQL 5.5中，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE TABLE
      ... SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许声明更改正在创建的表以外的表，但在MySQL 5.6中不再允许这样做（请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-create-select" title="16.4.1.6复制CREATE TABLE ... SELECT语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.6节“复制CREATE TABLE ... SELECT语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">） 。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      不管主数据库还是从属MySQL服务器的数量，涉及多个主数据库的复制设置都不支持使用两个以上的MySQL服务器版本。</font><font style="vertical-align: inherit;">此限制不仅适用于发布系列，而且适用于同一发行版系列中的版本号。</font><font style="vertical-align: inherit;">例如，如果您正在使用链式或循环复制设置，则不能同时使用MySQL 5.7.1，MySQL 5.7.2和MySQL 5.7.4，但可以将这两个版本中的任意两个一起使用。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        强烈建议使用特定MySQL版本系列中的最新版本，因为复制（和其他）功能不断得到改进。</font><font style="vertical-align: inherit;">当后者可用于该发行版系列时，还建议升级使用MySQL发行版的早期版本到GA（制作版）的主版本和从版本。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从较新的主站到旧的从站的复制可能是可能的，但通常不被支持。</font><font style="vertical-align: inherit;">这是由于许多因素造成的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制日志格式更改。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            二进制日志格式可以在主要版本之间更改。</font><font style="vertical-align: inherit;">虽然我们试图保持向后兼容性，但这并非总是可行。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这对升级复制服务器也有重大影响; </font><font style="vertical-align: inherit;">有关更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-upgrade" title="16.4.3升级复制设置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-upgrade" title="16.4.3升级复制设置"><font style="vertical-align: inherit;">第16.4.3节“升级复制设置”</font></a><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关基于行的复制的更多信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-formats" title="16.2.1复制格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.1节“复制格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL不兼容。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果要复制的语句使用主服务器上可用的SQL功能，但不使用从服务器，则无法使用基于语句的复制功能从较新的主服务器复制到较旧的从服务器。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          但是，如果主服务器和从服务器都支持基于行的复制，并且没有数据定义语句需要复制，而这些语句依赖于主服务器上的而不是从服务器上的SQL功能，则可以使用基于行的复制来复制即使从站上不支持在主站上运行的DDL，也会影响数据修改语句。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关潜在复制问题的更多信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features" title="16.4.1复制功能和问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1节“复制功能和问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-upgrade"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.3升级复制设置</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      升级参与复制设置的服务器时，升级过程取决于当前的服务器版本以及要升级的版本。</font><font style="vertical-align: inherit;">本节提供有关升级如何影响复制的信息。</font><font style="vertical-align: inherit;">有关升级MySQL的一般信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#upgrading" title="2.11.1升级MySQL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.11.1节“升级MySQL”</font></font></a>
    </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当您将早期MySQL版本系列中的主版本升级到5.7版本时，应首先确保该版本的所有从版本都使用相同的5.7.x版本。</font><font style="vertical-align: inherit;">如果情况并非如此，则应首先升级从属设备。</font><font style="vertical-align: inherit;">要升级每个从属设备，请将其关闭，将其升级到相应的5.7.x版本，重新启动它，然后重新启动复制。</font><font style="vertical-align: inherit;">升级后从设备创建的中继日志为5.7格式。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      影响严格SQL模式（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_strict_trans_tables"><code class="literal">STRICT_TRANS_TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_strict_all_tables"><code class="literal">STRICT_ALL_TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中的</font><font style="vertical-align: inherit;">操作的更改</font><font style="vertical-align: inherit;">可能会导致更新的从站上的复制失败。</font><font style="vertical-align: inherit;">例如，从MySQL 5.7.2开始，服务器</font></font><code class="literal">DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在严格模式下</font><font style="vertical-align: inherit;">限制为时</font><font style="vertical-align: inherit;">态数据类型</font><font style="vertical-align: inherit;">插入
       </font><font style="vertical-align: inherit;">值0。</font><font style="vertical-align: inherit;">如果使用基于语句的日志记录（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=STATEMENT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），如果在主服务器之前升级从服务器，则非升级的主服务器将执行没有可能在从服务器上失败的错误的语句，并且复制将停止。</font><font style="vertical-align: inherit;">为了解决这个问题，停止对主人的所有新的陈述，并等待奴隶赶上。</font><font style="vertical-align: inherit;">然后升级奴隶。</font><font style="vertical-align: inherit;">或者，如果您无法停止新语句，请临时更改为主文件上的基于行的日志记录（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并等到所有的从站都处理完所有的二进制日志为止。</font><font style="vertical-align: inherit;">然后升级奴隶。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从机升级后，关闭主机，将其升级到与从机相同的5.7.x版本，然后重新启动。</font><font style="vertical-align: inherit;">如果您已暂时将主服务器更改为基于行的日志记录，请将其更改回基于语句的日志记录。</font><font style="vertical-align: inherit;">5.7主站能够读取在升级之前写入的旧的二进制日志，并将它们发送到5.7从站。</font><font style="vertical-align: inherit;">奴隶认可旧格式并妥善处理。</font><font style="vertical-align: inherit;">主机在升级后创建的二进制日志格式为5.7格式。</font><font style="vertical-align: inherit;">这些也被5.7个奴隶所认可。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      换句话说，升级到MySQL 5.7时，从设备必须是MySQL 5.7，然后才能将主设备升级到5.7。</font><font style="vertical-align: inherit;">请注意，从5.7降级到旧版本不会如此简单：您必须确保已完全处理任何5.7二进制日志或中继日志，以便在继续进行降级之前将其删除。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      某些升级可能要求您在从一个MySQL系列迁移到下一个系列时删除并重新创建数据库对象。</font><font style="vertical-align: inherit;">例如，排序规则更改可能需要重建表索引。</font><font style="vertical-align: inherit;">如有必要，这些操作将在</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#upgrading-from-previous-series" title="2.11.1.2影响升级到MySQL的更改5.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.11.1.2节“影响升级到MySQL 5.7的更改”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中详细介绍
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在从服务器和主服务器上分别执行这些操作并禁止将这些操作从主服务器复制到从服务器是最安全的。</font><font style="vertical-align: inherit;">要达到此目的，请使用以下步骤：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          停止所有的奴隶并升级它们。</font><font style="vertical-align: inherit;">用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">重新启动它们，
           </font><font style="vertical-align: inherit;">以便它们不连接到主站。</font><font style="vertical-align: inherit;">执行重建数据库对象所需的任何表修复或重建操作，例如使用</font></font><code class="literal">REPAIR TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><code class="literal">ALTER TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或转储和重新加载表或触发器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          禁用主设备上的二进制日志。</font><font style="vertical-align: inherit;">要在不重新启动主机的情况下执行此操作，请执行</font></font><code class="literal">SET sql_log_bin =
          0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">或者，停止主设备并在没有</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项的</font><font style="vertical-align: inherit;">情况下重启设备
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您重新启动主设备，您可能也想禁止客户端连接。</font><font style="vertical-align: inherit;">例如，如果所有客户端使用TCP / IP连接，则</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在重新启动主服务器时</font><font style="vertical-align: inherit;">使用该</font><font style="vertical-align: inherit;">选项。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在禁用二进制日志的情况下，执行重新创建数据库对象所需的任何表修复或重建操作。</font><font style="vertical-align: inherit;">在此步骤中必须禁用二进制日志，以防止将这些操作记录并稍后发送到从属设备。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在主设备上重新启用二进制日志。</font><font style="vertical-align: inherit;">如果您</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sql_log_bin"><code class="literal">sql_log_bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">早先</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">为0，则执行</font></font><code class="literal">SET sql_log_bin = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">如果您重新启动主服务器以禁用二进制日志，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端和从服务器无法连接的方式</font><font style="vertical-align: inherit;">重新启动它</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          重新启动从站，这次没有
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您将现有的复制设置从不支持全局事务标识符的MySQL版本升级到具有该功能的版本，则在确保设置满足GTID的所有要求之前，不应在主控设备或从属设备上启用GTID基于复制。</font><font style="vertical-align: inherit;">例如
       </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它在MySQL 5.6中添加，必须存在GTID才能正常运行。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids-howto" title="16.1.3.2使用GTID设置复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.3.2节“使用GTID设置复制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含有关将现有复制设置转换为使用基于GTID的复制的信息。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当服务器在启用全局事务标识符（GTID）（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的情况下运行时，请勿通过</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade  - 检查并升级MySQL表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql_upgrade</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用二进制日志记录</font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_gtid_mode"><code class="literal">gtid_mode=ON</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的转储文件包含系统表，</font><font style="vertical-align: inherit;">
      则不建议在服务器（</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">上启用GTID时加载转储文件</font><font style="vertical-align: inherit;">。
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为使用非事务性MyISAM存储引擎的系统表发出DML指令，并且在启用GTID时不允许使用此组合。</font><font style="vertical-align: inherit;">另外请注意，将启用了GTID的服务器中的转储文件加载到启用了GTID的另一台服务器中会导致生成不同的事务标识符。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-problems"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.4复制故障排除</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528024749152"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您已按照说明进行操作，但复制设置不起作用，则首先要</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查错误日志中的消息</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">许多用户在遇到问题后很快就没有这么做了。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您无法从错误日志中发现问题，请尝试以下技术：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS语法"><code class="literal">SHOW MASTER STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">验证主服务器是否启用了二进制日志记录
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果启用日志记录，</font></font><code class="literal">Position</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则为非零。</font><font style="vertical-align: inherit;">如果二进制日志记录未启用，请验证您是否正在使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项</font><font style="vertical-align: inherit;">运行主服务器</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          验证主机和从机是否都使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_server-id"><code class="option">--server-id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动，
           </font><font style="vertical-align: inherit;">并且每个服务器上的ID值都是唯一的。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          验证从站正在运行。</font><font style="vertical-align: inherit;">使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查是否</font></font><code class="literal">Slave_IO_Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">Slave_SQL_Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值都
           </font></font><code class="literal">Yes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果没有，请验证启动从服务器时使用的选项。</font><font style="vertical-align: inherit;">例如，</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_skip-slave-start"><code class="option">--skip-slave-start</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">，
           </font><font style="vertical-align: inherit;">阻止从属线程启动
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果从站正在运行，请检查它是否建立了与主站的连接。</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
          PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，找到I / O和SQL线程并检查它们的</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列以查看它们显示的内容。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-implementation-details" title="16.2.2复制实现细节"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.2节“复制实现细节”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果I / O线程状态显示</font></font><code class="literal">Connecting to master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请检查以下内容：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              验证在主服务器上用于复制的用户的权限。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              检查主机的主机名是否正确，以及您是否使用正确的端口连接到主机。</font><font style="vertical-align: inherit;">用于复制的端口与用于客户端网络通信的端口相同（默认为
               </font></font><code class="literal">3306</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">对于主机名称，请确保名称解析为正确的IP地址。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              检查在主站或从站上网络是否未被禁用。</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-networking"><code class="option">skip-networking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在配置文件中</font><font style="vertical-align: inherit;">查找
               </font><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">如果存在，请将其注释掉或将其删除。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果主设备具有防火墙或IP过滤配置，请确保用于MySQL的网络端口未被过滤。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              检查您可以通过访问主
               </font></font><code class="literal">ping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">traceroute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code class="literal">tracert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              到达主机。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果从站先前正在运行但已停止，原因通常是主站上成功的一些语句在从站上失败。</font><font style="vertical-align: inherit;">如果您已经对主设备进行了适当的快照，并且永远不会在从设备线程外修改从设备上的数据，则永远不会发生这种情况。</font><font style="vertical-align: inherit;">如果从站意外停止，那么这是一个错误，或者您遇到了</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features" title="16.4.1复制功能和问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1节“复制功能和问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中所述的已知复制限制之一
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果它是一个错误，请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-bugs" title="16.4.5如何报告复制错误或问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.5节“如何报告复制错误或问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以获取有关如何报告</font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-bugs" title="16.4.5如何报告复制错误或问题"><font style="vertical-align: inherit;">错误</font></a><font style="vertical-align: inherit;">的说明。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果在主服务器上成功执行的语句拒绝在从服务器上运行，如果通过删除从服务器的数据库并从主服务器复制新快照来完成完全数据库重同步操作是不可行的，请尝试执行以下过程：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              确定从站上受影响的表是否与主表不同。</font><font style="vertical-align: inherit;">试着了解这是如何发生的。</font><font style="vertical-align: inherit;">然后让奴隶的桌子与主人的桌子相同并且运行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE语法"><code class="literal">START
              SLAVE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果上述步骤不起作用或不适用，请尝试了解手动更新是否安全（如果需要），然后忽略来自主服务器的下一个语句。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您决定从站可跳过主站的下一条语句，请发出以下语句：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SET GLOBAL sql_slave_skip_counter = <em class="replaceable"><code>N</code></em>;</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>START SLAVE;</code></strong>
</pre><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果来自主设备的下一个语句不使用</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或，
               </font><font style="vertical-align: inherit;">则</font><font style="vertical-align: inherit;">
              值</font><font style="vertical-align: inherit;">应该为1
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，该值应为2.对于使用</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器的二进制日志中使用两个事件的</font><font style="vertical-align: inherit;">语句使用值为2的原因
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              另请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#set-global-sql-slave-skip-counter" title="13.4.2.5 SET GLOBAL sql_slave_skip_counter语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.4.2.5节“SE​​T GLOBAL sql_slave_skip_counter语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您确定从机与主机启动完全同步，并且没有人更新从机线外所涉及的表，那么大概这种差异就是错误的结果。</font><font style="vertical-align: inherit;">如果您正在运行最新版本的MySQL，请报告问题。</font><font style="vertical-align: inherit;">如果您运行的是旧版本，请尝试升级到最新的产品版本，以确定问题是否仍然存在。
</font></font></p></li></ol>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="replication-bugs"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.4.5如何报告复制错误或问题</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您确定没有涉及用户错误，并且复制仍然无法工作或者不稳定，那么现在是时候向我们发送错误报告。</font><font style="vertical-align: inherit;">我们需要从您那里获得尽可能多的信息，以便能够追踪错误。</font><font style="vertical-align: inherit;">请花费一些时间和精力准备好错误报告。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您有可重复使用的测试用例来演示该错误，请使用</font></font><a class="xref" href="/mysql-5.7-google-zh/introduction.html#bug-reports" title="1.7如何报告错误或问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1.7节“如何报告错误或问题”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的说明将其输入到我们的错误数据库中</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您有
       </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幻影</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题（您不能随意复制的问题），请使用以下步骤：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          确认没有涉及用户错误。</font><font style="vertical-align: inherit;">例如，如果更新从属线程之外的从属设备，则数据不同步，并且在更新时可能存在唯一的密钥违例。</font><font style="vertical-align: inherit;">在这种情况下，从属线程停止并等待您手动清理表以使其同步。</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这不是复制问题。</font><font style="vertical-align: inherit;">这是外部干扰导致复制失败的问题。</font></font></em></span>
        </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-slave-updates"><code class="option">--log-slave-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">运行从站
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些选项会使从服务器将从主服务器接收到的更新记录到其自己的二进制日志中。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在重置复制状态之前保存所有证据。</font><font style="vertical-align: inherit;">如果我们没有信息或者只有简单的信息，那么我们很难或不可能找到问题。</font><font style="vertical-align: inherit;">你应该收集的证据是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              来自主设备的所有二进制日志文件
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              来自从站的所有二进制日志文件
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-master-status" title="13.7.5.23 SHOW MASTER STATUS语法"><code class="literal">SHOW MASTER
              STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您发现问题时</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">从主服务器
             </font><font style="vertical-align: inherit;">的输出</font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE
              STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在发现问题时从从站
             </font><font style="vertical-align: inherit;">
              的输出</font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              来自主机和从机的错误日志
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查二进制日志。</font><font style="vertical-align: inherit;">以下内容应该有助于查找问题陈述。
          </font></font><em class="replaceable"><code>log_file</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
           </font></font><em class="replaceable"><code>log_pos</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
           </font></font><code class="literal">Master_Log_File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">Read_Master_Log_Pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自的价值
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog --start-position=<em class="replaceable"><code>log_pos</code></em> <em class="replaceable"><code>log_file</code></em> | head</code></strong>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在收集了问题的证据之后，尝试首先将其作为单独的测试用例进行隔离。</font><font style="vertical-align: inherit;">然后使用</font></font><a class="xref" href="/mysql-5.7-google-zh/introduction.html#bug-reports" title="1.7如何报告错误或问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1.7节“如何报告错误或问题”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的说明，将尽可能多的信息输入到我们的错误数据库中</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tbody><tr>
<td width="40%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/storage-engines.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a></td>
<td width="20%" align="center"><a accesskey="u" href="/mysql-5.7-google-zh/replication.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向上</font></font></a></td>
<td width="40%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/group-replication.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15章备用存储引擎</font></font></td>
<td width="20%" align="center"><a accesskey="h" href="/mysql-5.7-google-zh/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家</font></font></a></td>
<td width="40%" align="right" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17章组复制</font></font></td>
</tr>
</tbody></table>
</div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./images/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>