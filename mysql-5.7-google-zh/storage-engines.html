<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>第15章备用存储引擎</title>
<link rel="stylesheet" href="./images/mvl.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
<link rel="start" href="/mysql-5.7-google-zh/index.html" title="{书名}">
<link rel="up" href="/mysql-5.7-google-zh/storage-engines.html" title="">
<link rel="prev" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎">
<link rel="next" href="/mysql-5.7-google-zh/replication.html" title="第16章复制">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./images/translateelement.css"></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tbody><tr>
<th colspan="3" align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15章备用存储引擎</font></font></th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/innodb-storage-engine.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a>&nbsp;</td>
<th width="60%" align="center"></th>
<td width="20%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/replication.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
</tbody></table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="storage-engines"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15章备用存储引擎</font></font></h1>

</div>

</div>

</div>
<div class="toc">
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></b></p><dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#storage-engine-setting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1设置存储引擎</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2 MyISAM存储引擎</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#myisam-start"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.1 MyISAM启动选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#key-space"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.2键所需的空间</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#myisam-table-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3 MyISAM表格存储格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#myisam-table-problems"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4 MyISAM表问题</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.3内存存储引擎</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#csv-storage-engine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4 CSV存储引擎</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#se-csv-repair"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4.1修复和检查CSV表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#se-csv-limitations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4.2 CSV限制</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#archive-storage-engine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.5 ARCHIVE存储引擎</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#blackhole-storage-engine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.6 BLACKHOLE存储引擎</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#merge-storage-engine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.7 MERGE存储引擎</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#merge-table-advantages"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.7.1 MERGE表的优点和缺点</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#merge-table-problems"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.7.2 MERGE表问题</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-storage-engine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8 FEDERATED存储引擎</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-description"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.1 FEDERATED存储引擎概述</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-create"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.2如何创建FEDERATED表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-usagenotes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.3联邦存储引擎注释和提示</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-storage-engine-resources"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.4 FEDERATED存储引擎资源</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#example-storage-engine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.9示例存储引擎</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#storage-engines-other"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.10其他存储引擎</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#pluggable-storage-overview"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.11 MySQL存储引擎架构概述</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#pluggable-storage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.11.1可插拔存储引擎架构</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#pluggable-storage-common-layer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.11.2公用数据库服务器层</font></font></a></span></dt></dl></dd></dl>
</div>
<a class="indexterm" name="idm140528036660880"></a><a class="indexterm" name="idm140528036659424"></a><a class="indexterm" name="idm140528036657936"></a><a class="indexterm" name="idm140528036656448"></a><a class="indexterm" name="idm140528036655376"></a><a class="indexterm" name="idm140528036654304"></a><a class="indexterm" name="idm140528036653232"></a><a class="indexterm" name="idm140528036652160"></a><a class="indexterm" name="idm140528036651088"></a><a class="indexterm" name="idm140528036650016"></a><a class="indexterm" name="idm140528036648944"></a><a class="indexterm" name="idm140528036647872"></a><a class="indexterm" name="idm140528036646800"></a><a class="indexterm" name="idm140528036645712"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    存储引擎是处理不同表类型的SQL操作的MySQL组件。</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是默认和最通用的存储引擎，Oracle建议将其用于除专用用例之外的表。</font><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">默认情况下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MySQL 5.7中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句创建</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。）
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL服务器使用可插拔的存储引擎架构，使存储引擎能够从正在运行的MySQL服务器中加载和卸载。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要确定服务器支持哪些存储引擎，请使用该
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-engines" title="13.7.5.16 SHOW ENGINES语法"><code class="literal">SHOW ENGINES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font></font><code class="literal">Support</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">指示是否可以使用引擎。</font><font style="vertical-align: inherit;">的值</font></font><code class="literal">YES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
     </font></font><code class="literal">NO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示发动机可用，不可用，或可用与当前被设置为默认的存储引擎。
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW ENGINES\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      引擎：PERFORMANCE_SCHEMA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     支持：是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     评论：性能模式</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
交易：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          XA：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  保存点：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      引擎：InnoDB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     支持：默认</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     评论：支持事务，行级锁定和外键</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
交易：是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          XA：是的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  保存点：是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 3. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      引擎：MRG_MYISAM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     支持：是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     评论：收集相同的MyISAM表格</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
交易：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          XA：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  保存点：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 4. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      引擎：BLACKHOLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     支持：是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     评论：/ dev / null存储引擎（您写入的任何内容都会消失）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
交易：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          XA：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  保存点：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 5. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      引擎：MyISAM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     支持：是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     评论：MyISAM存储引擎</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
交易：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          XA：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  保存点：NO</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本章介绍特殊用途MySQL存储引擎的用例。</font><font style="vertical-align: inherit;">它不</font><font style="vertical-align: inherit;">包括</font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><font style="vertical-align: inherit;">第14章，</font></a><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><i><font style="vertical-align: inherit;">InnoDB存储引擎</font></i></a><font style="vertical-align: inherit;">和
     </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><font style="vertical-align: inherit;">第21章，</font></a><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><i><font style="vertical-align: inherit;">MySQL NDB集群7.5和NDB集群7.6中</font></i></a><font style="vertical-align: inherit;">介绍的默认
     </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎或
     </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于高级用户，本章还包含可插拔存储引擎体系结构的描述（请参见</font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#pluggable-storage-overview" title="15.11 MySQL存储引擎架构概述"><font style="vertical-align: inherit;">第15.11节“MySQL存储引擎体系结构概述”</font></a><font style="vertical-align: inherit;">）。
  </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#pluggable-storage-overview" title="15.11 MySQL存储引擎架构概述"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关商用MySQL服务器二进制文件中提供的存储引擎支持的信息，请参阅
     </font><font style="vertical-align: inherit;">MySQL网站上的MySQL </font></font><a class="ulink" href="http://www.mysql.com/products/enterprise/server.html" target="_top"><em class="citetitle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企业服务器5.7</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可用的存储引擎可能取决于您正在使用的Enterprise Server版本。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关MySQL存储引擎常见问题的答案，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/faqs.html#faqs-storage-engines" title="A.2 MySQL 5.7 FAQ：存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第A.2节“MySQL 5.7 FAQ：存储引擎”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h2><a name="idm140528036624672"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 5.7支持的存储引擎</font></font></h2>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：MySQL 5.7中的默认存储引擎。
        </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是MySQL的事务安全（ACID兼容）存储引擎，具有提交，回滚和崩溃恢复功能来保护用户数据。
        </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行级锁定（没有升级到更粗粒度锁）和Oracle样式一致的非锁定读取增加了多用户并发性和性能。</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将用户数据存储在聚簇索引中以减少基于主键的常见查询的I / O。</font><font style="vertical-align: inherit;">为了保持数据完整性，
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还支持</font></font><code class="literal">FOREIGN
        KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照完整性约束。</font><font style="vertical-align: inherit;">有关更多信息</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InnoDB存储引擎</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这些表的占地面积很小。
        </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_table_lock" title="表锁"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表级锁定会</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        限制读/写工作负载的性能，因此它通常用于Web和数据仓库配置中的只读或只读工作负载。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">Memory</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：将所有数据存储在RAM中，以便在需要快速查找非关键数据的环境中快速访问。</font><font style="vertical-align: inherit;">这款发动机以前被称为</font></font><code class="literal">HEAP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发动机。</font><font style="vertical-align: inherit;">其用例正在减少; </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其缓冲池内存区提供了一种通用和持久的方法来保存大部分或全部数据到内存中，并
         </font></font><code class="literal">NDBCLUSTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为大型分布式数据集提供快速键值查找。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/storage-engines.html#csv-storage-engine" title="15.4 CSV存储引擎"><code class="literal">CSV</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：它的表格实际上是用逗号分隔的值的文本文件。</font><font style="vertical-align: inherit;">CSV表格允许您导入或转储CSV格式的数据，以便与读取和写入相同格式的脚本和应用程序交换数据。</font><font style="vertical-align: inherit;">由于CSV表格未建立索引，因此通常</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在正常操作期间</font><font style="vertical-align: inherit;">将数据保存在</font><font style="vertical-align: inherit;">表格中，并且仅在导入或导出阶段使用CSV表格。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/storage-engines.html#archive-storage-engine" title="15.5 ARCHIVE存储引擎"><code class="literal">Archive</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这些精简的无索引表格旨在用于存储和检索大量很少参考的历史，存档或安全审计信息。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/storage-engines.html#blackhole-storage-engine" title="15.6 BLACKHOLE存储引擎"><code class="literal">Blackhole</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Blackhole存储引擎接受但不存储数据，类似于Unix </font></font><code class="literal">/dev/null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备。</font><font style="vertical-align: inherit;">查询总是返回一个空集。</font><font style="vertical-align: inherit;">这些表可用于将DML语句发送到从属服务器的复制配置中，但主服务器不保留其自己的数据副本。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（也称为
         </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDBCLUSTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：此群集数据库引擎特别适用于需要尽可能高的正常运行时间和可用性的应用程序。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/storage-engines.html#merge-storage-engine" title="15.7 MERGE存储引擎"><code class="literal">Merge</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：使MySQL DBA或开发人员能够对一系列相同的</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">进行逻辑分组，</font><font style="vertical-align: inherit;">并将它们作为一个对象引用。</font><font style="vertical-align: inherit;">适用于VLDB环境，如数据仓库。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/storage-engines.html#federated-storage-engine" title="15.8 FEDERATED存储引擎"><code class="literal">Federated</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：提供链接单独的MySQL服务器以从多个物理服务器创建一个逻辑数据库的能力。</font><font style="vertical-align: inherit;">非常适合分布式或数据集市环境。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/storage-engines.html#example-storage-engine" title="15.9示例存储引擎"><code class="literal">Example</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：该引擎在MySQL源代码中用作示例，说明如何开始编写新的存储引擎。</font><font style="vertical-align: inherit;">这主要是开发人员感兴趣的。</font><font style="vertical-align: inherit;">存储引擎是一个</font><font style="vertical-align: inherit;">什么也不做</font><font style="vertical-align: inherit;">的
         </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存根</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以使用此引擎创建表格，但不能将数据存储在其中或从中检索数据。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    您不限于为整个服务器或架构使用相同的存储引擎。</font><font style="vertical-align: inherit;">您可以为任何表指定存储引擎。</font><font style="vertical-align: inherit;">例如，应用程序可能主要使用
     </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，其中一个</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    表格用于将数据导出到电子表格，另外一些
     </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格用于临时工作区。
  </font></font></p><p>
    <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择一个存储引擎</font></font></strong></span>
  </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL提供的各种存储引擎在设计时考虑到了不同的用例。</font><font style="vertical-align: inherit;">下表提供了随MySQL一起提供的一些存储引擎的概述，并在表格后面给出了说明。
</font></font></p>
<div class="table">
<a name="idm140528036584352"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表15.1存储引擎功能摘要</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Summary of features supported per storage engine."><colgroup><col width="10%"><col width="16%"><col width="16%"><col width="16%"><col width="16%"><col width="16%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特征</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyISAM数据</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记忆</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InnoDB的</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">档案</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导航台</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B树索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份/时间点恢复</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（注1）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群数据库支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聚集索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩数据</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是（注2）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据缓存</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N / A</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密数据</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（注3）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外键支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是（注4）</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全文搜索索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是（注5）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间数据类型支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间索引支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是（注6）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否（注7）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引缓存</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N / A</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定粒度</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MVCC</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询缓存支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制支持</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（注1）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有限公司（注8）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储限制</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">256TB</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64TB</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">384EB</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T树索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新数据字典的统计信息</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记：</font></font></strong></span></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.在服务器中实现，而不是在存储引擎中实现。</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.只有使用压缩行格式时才支持压缩的MyISAM表。</font><font style="vertical-align: inherit;">使用MyISAM使用压缩行格式的表是只读的。</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.通过加密功能在服务器中实施。</font><font style="vertical-align: inherit;">静态数据表空间加密在MySQL 5.7及更高版本中可用。</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. MySQL Cluster NDB 7.3及更高版本支持外键。</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. InnoDB对FULLTEXT索引的支持在MySQL 5.6和更高版本中可用。</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. InnoDB对地理空间索引的支持在MySQL 5.7和更高版本中可用。</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. InnoDB在内部利用散列索引来实现自适应哈希索引功能。</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.请参阅本节后面的讨论。</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="storage-engine-setting"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1设置存储引擎</font></font></h2>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在创建新表时，可以通过向</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">添加</font></font><code class="literal">ENGINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表选项来
       </font><font style="vertical-align: inherit;">指定要使用的存储引擎</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  ENGINE = INNODB不需要，除非你设定了不同的值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 默认存储引擎。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE t1（INT）ENGINE = INNODB;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 简单的表格定义可以从一个切换到另一个。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE t2（INT）ENGINE = CSV;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE t3（INT）ENGINE = MEMORY;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当您省略该</font></font><code class="literal">ENGINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项时，将使用默认存储引擎。</font><font style="vertical-align: inherit;">默认引擎
       </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL 5.7中。</font><font style="vertical-align: inherit;">您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_default-storage-engine"><code class="option">--default-storage-engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器启动选项或通过</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_default-storage-engine"><code class="option">default-storage-engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置文件中</font><font style="vertical-align: inherit;">设置
       </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">来指定默认引擎
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以通过设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">来设置当前会话的默认存储引擎
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET default_storage_engine = NDBCLUSTER;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      用于</font></font><code class="literal">TEMPORARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建表</font><font style="vertical-align: inherit;">的存储引擎</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
      TEMPORARY TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_tmp_storage_engine"><code class="literal">default_tmp_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过在启动时或运行时</font><font style="vertical-align: inherit;">设置永久表的引擎来单独设置
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要将表从一个存储引擎转换为另一个存储引擎，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示新引擎</font><font style="vertical-align: inherit;">的
       </font><font style="vertical-align: inherit;">语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t ENGINE = InnoDB;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8节“ALTER TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您尝试使用未编译或已编译但已停用的存储引擎，则MySQL会使用默认存储引擎创建一个表。</font><font style="vertical-align: inherit;">例如，在复制设置中，可能您的主服务器使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表来实现最大的安全性，但从服务器使用其他存储引擎来提高速度，但要牺牲耐久性或并发性。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      默认情况下，只要</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能使用默认存储引擎</font><font style="vertical-align: inherit;">就会生成警告
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为避免混淆意外的行为，如果所需的引擎不可用，请启用
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_engine_substitution"><code class="literal">NO_ENGINE_SUBSTITUTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL模式。</font><font style="vertical-align: inherit;">如果所需的引擎不可用，则此设置会产生错误而不是警告，并且不会创建或更改表格。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#sql-mode" title="5.1.8服务器SQL模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.8节“服务器SQL模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于新表，MySQL总是创建一个</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      文件来保存表和列的定义。</font><font style="vertical-align: inherit;">表的索引和数据可能存储在一个或多个其他文件中，具体取决于存储引擎。</font><font style="vertical-align: inherit;">服务器</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在存储引擎级别上</font><font style="vertical-align: inherit;">创建
       </font><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">单独的存储引擎会创建其管理的表所需的任何其他文件。</font><font style="vertical-align: inherit;">如果表名包含特殊字符，则表格文件的名称包含这些字符的编码版本，如
       </font></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#identifier-mapping" title="9.2.3标识符到文件名称的映射"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2.3节“将标识符映射到文件名”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="myisam-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2 MyISAM存储引擎</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#myisam-start"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.1 MyISAM启动选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#key-space"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.2键所需的空间</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#myisam-table-formats"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3 MyISAM表格存储格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#myisam-table-problems"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4 MyISAM表问题</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528036405024"></a><a class="indexterm" name="idm140528036403984"></a><p>
    <code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于较旧（不再可用）的</font></font><code class="literal">ISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，但有许多有用的扩展。
</font></font></p>
<div class="table">
<a name="idm140528036400608"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表15.2 MyISAM存储引擎功能</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Features supported by the MyISAM storage engine."><colgroup><col width="60%"><col width="40%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特征</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B树索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份/时间点恢复</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在服务器中实施，而不是在存储引擎中实施。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群数据库支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聚集索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩数据</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是（仅当使用压缩行格式时才支持压缩的MyISAM表格。使用MyISAM的压缩行格式的表格是只读的。）</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据缓存</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密数据</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（通过加密功能在服务器中实现。</font><span class="bold"><strong><font style="vertical-align: inherit;">静态数据</font></strong></span><font style="vertical-align: inherit;">表空间加密在MySQL 5.7和更高版本中可用。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外键支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全文搜索索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间数据类型支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间索引支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引缓存</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定粒度</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MVCC</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询缓存支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制支持</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在服务器中实现，而不是在存储引擎中实现。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储限制</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">256TB</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T树索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新数据字典的统计信息</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    每张</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表以三个文件存储在磁盘上。</font><font style="vertical-align: inherit;">这些文件的名称以表名开头，并有一个扩展名来指示文件类型。</font><font style="vertical-align: inherit;">一个</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    文件存储表格格式。</font><font style="vertical-align: inherit;">数据文件有一个
     </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="literal">MYData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）扩展名。</font><font style="vertical-align: inherit;">索引文件有一个</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （</font></font><code class="literal">MYIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）扩展名。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要明确指定您需要</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    表格，请使用</font></font><code class="literal">ENGINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格选项</font><font style="vertical-align: inherit;">指出</font><font style="vertical-align: inherit;">：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t（i INT）ENGINE = MYISAM;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在MySQL 5.7中，通常需要使用
     </font></font><code class="literal">ENGINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    存储引擎，因为</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是默认引擎。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    您可以</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlcheck" title="4.5.3 mysqlcheck  - 一个表维护程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlcheck</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    实用程序</font><font style="vertical-align: inherit;">来检查或修复</font><font style="vertical-align: inherit;">表
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您也可以</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩</font><font style="vertical-align: inherit;">表
     </font><font style="vertical-align: inherit;">以占用更少的空间。</font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqlcheck" title="4.5.3 mysqlcheck  - 一个表维护程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.5.3节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlcheck</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 表维护程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.3节，“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  MyISAM表维护实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.5节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 生成压缩的只读MyISAM表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p>
    <code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 表格具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        所有的数据值都首先与低字节一起存储。</font><font style="vertical-align: inherit;">这使得数据机器和操作系统无关。</font><font style="vertical-align: inherit;">二进制可移植性的唯一要求是该机器使用两个补码有符号整数和IEEE浮点格式。</font><font style="vertical-align: inherit;">这些要求在主流机器中广泛使用。</font><font style="vertical-align: inherit;">二进制兼容性可能不适用于嵌入式系统，它有时具有特殊的处理器。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        首先存储数据低字节没有明显的速度损失; </font><font style="vertical-align: inherit;">表格行中的字节通常是不对齐的，并且按顺序读取未对齐字节的处理比按相反顺序处理更多。</font><font style="vertical-align: inherit;">此外，与其他代码相比，获取列值的服务器中的代码不是时间关键的。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        所有数字键值都先与高字节一起存储，以允许更好的索引压缩。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        大文件（最多63位文件长度）在支持大文件的文件系统和操作系统上受支持。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表中有（2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        （1.844E + 19）行的限制</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表</font><font style="vertical-align: inherit;">的最大索引数</font><font style="vertical-align: inherit;">为64。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个索引的最大列数是16。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        最大密钥长度是1000字节。</font><font style="vertical-align: inherit;">这也可以通过改变源代码和重新编译来改变。</font><font style="vertical-align: inherit;">对于密钥长度超过250个字节的情况，使用比缺省值1024字节更大的密钥块大小。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当按排序顺序插入行时（与使用
         </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列时一样），索引树将被拆分，以便高位节点只包含一个键。</font><font style="vertical-align: inherit;">这提高了索引树中的空间利用率。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        内部处理</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个表</font><font style="vertical-align: inherit;">的一</font><font style="vertical-align: inherit;">列是支持的。</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        自动更新此列
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作。</font><font style="vertical-align: inherit;">这使
         </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列更快（至少10％）。</font><font style="vertical-align: inherit;">序列顶部的值在删除后不会重复使用。</font><font style="vertical-align: inherit;">（当</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列被定义为多列索引的最后一列时，重复使用从序列顶部删除的值。）</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置</font><font style="vertical-align: inherit;">该
         </font><font style="vertical-align: inherit;">值
         </font><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        将更新和插入混合删除时，动态大小的行要少得多。</font><font style="vertical-align: inherit;">这是通过自动组合相邻的删除块并在下一个块被删除时扩展块来完成的。
      </font></font></p></li><li class="listitem"><p>
        <code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持并发插入：如果一个表在数据文件中间没有空闲块，那么可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其他线程正在从表中读取</font><font style="vertical-align: inherit;">数据的同时将
         </font><font style="vertical-align: inherit;">新行插入到它中。</font><font style="vertical-align: inherit;">由于删除行或使用比当前内容更多的数据更新动态长度行，可能会出现空闲块。</font><font style="vertical-align: inherit;">当所有空闲块用完（填充）时，未来的插入再次变为并发。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#concurrent-inserts" title="8.11.3并发插入"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.3节“并发插入”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以将数据文件和索引文件放在不同物理设备的不同目录中，以使用</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">INDEX
        DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表选项</font><font style="vertical-align: inherit;">获得更高的速度</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列可以被索引。
      </font></font></p></li><li class="listitem"><p>
        <code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值在索引列中是允许的。</font><font style="vertical-align: inherit;">这需要每个键0到1个字节。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个字符列可以有不同的字符集。</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/charset.html" title="第10章字符集，排序规则，Unicode"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第10章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符集，归类，Unicode</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引文件中</font><font style="vertical-align: inherit;">
        有一个标志</font><font style="vertical-align: inherit;">，指示表是否正确关闭。</font><font style="vertical-align: inherit;">如果
         </font><font style="vertical-align: inherit;">使用该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则会在打开时自动检查表，如果表未正确关闭，则会进行修复。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果使用该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_update-state"><code class="option">--update-state</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">运行它，</font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"> myisamchk</font></strong></span></a><font style="vertical-align: inherit;">会将表格标记为已检查</font><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --fast只会</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查那些没有这个标记的表。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --analyze</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储密钥部分以及整个密钥的统计信息。
      </font></font></p></li><li class="listitem"><p>
        <a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以打包
        </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
        </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。
</font></font></p></li></ul>
</div>
<p>
    <code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 还支持以下功能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        支持真正的</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型; </font><font style="vertical-align: inherit;">一</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列以一个或两个字节存储的长度开始。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        具有</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的</font><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">可能具有固定或动态的行长度。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">
        的长度之
         </font><font style="vertical-align: inherit;">和
         </font><font style="vertical-align: inherit;">可能高达64KB。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        任意长度限制</font></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<h3><a name="idm140528036254432"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他资源</font></font></h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><a class="ulink" href="http://forums.mysql.com/list.php?21" target="_top"><font style="vertical-align: inherit;">http://forums.mysql.com/list.php?21</font></a></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供</font><font style="vertical-align: inherit;">
        专用于</font><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">论坛</font><font style="vertical-align: inherit;">。
</font></font><a class="ulink" href="http://forums.mysql.com/list.php?21" target="_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-start"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.1 MyISAM启动选项</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">可用于更改</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的行为</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-options" title="5.1.4服务器命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.4节“服务器命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="idm140528036247056"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表15.3 MyISAM选项和变量引用</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Reference for MyISAM command-line options and system variables."><colgroup><col width="20%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMD线</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项文件</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Var范围</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态</font></font></th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_bulk_insert_buffer_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bulk_insert_buffer_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_concurrent_insert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concurrent_insert</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_delay-key-write"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟键写入</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_delay_key_write"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delay_key_write</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_have_rtree_keys"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">have_rtree_keys</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">key_buffer_size的</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_log-isam"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录ISAM</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-block-size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的myisam块大小</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_data_pointer_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_data_pointer_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_max_sort_file_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_max_sort_file_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_mmap_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_mmap_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-recover-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyISAM数据-恢复选项</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_recover_options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_recover_options</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_recover_options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_recover_options</font></font></a></td>
<td></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_repair_threads"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_repair_threads</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_sort_buffer_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_sort_buffer_size</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_stats_method"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_stats_method</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_use_mmap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisam_use_mmap</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-concurrent-insert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳过并发插入</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_concurrent_insert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concurrent_insert</font></font></a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tmp_table_size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tmp_table_size的</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="indexterm" name="idm140528036085488"></a>

          <a class="indexterm" name="idm140528036083984"></a>

          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options=<em class="replaceable"><code>mode</code></em></code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置崩溃</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">自动恢复模式
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140528036079264"></a>

          <a class="indexterm" name="idm140528036077776"></a>

          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=ALL</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不要在任何</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">写入之间刷新键缓冲区
           </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您这样做，则在使用</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时</font><font style="vertical-align: inherit;">，您不应该访问
             </font><font style="vertical-align: inherit;">另一个程序（例如另一个MySQL服务器或
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中的表。</font><font style="vertical-align: inherit;">这样做会导致索引腐败。</font><font style="vertical-align: inherit;">使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并不能消除这种风险。
</font></font></p>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下系统变量影响</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的行为
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_bulk_insert_buffer_size"><code class="literal">bulk_insert_buffer_size</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          批量插入优化中使用的树缓存的大小。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这是</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个线程</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的限制</font><font style="vertical-align: inherit;">！
</font></font></p>
</div>
</li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL正在允许而重新创建一个使用临时文件的最大尺寸</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指数（期间</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
          INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果文件大小大于此值，则索引是使用键缓存创建的，而速度较慢。</font><font style="vertical-align: inherit;">该值以字节为单位给出。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置恢复表时使用的缓冲区的大小。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font><font style="vertical-align: inherit;">使用该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font><font style="vertical-align: inherit;">自动恢复功能将被激活
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，当服务器打开一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表时，它会检查表是否标记为崩溃或表的打开计数变量是否不为0，并且您正在运行禁用了外部锁定的服务器。</font><font style="vertical-align: inherit;">如果这些条件中的任何一个为真，则会发生以下情况：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器检查表中是否有错误。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果服务器发现错误，它会尝试执行快速表修复（排序并且不重新创建数据文件）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果由于数据文件中的错误而导致修复失败（例如，重复键错误），则服务器再次尝试，这次重新创建数据文件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果修复仍然失败，服务器将再次尝试使用旧的修复选项方法（逐行写入而不进行排序）。</font><font style="vertical-align: inherit;">该方法应该能够修复任何类型的错误并且具有较低的磁盘空间要求。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果恢复无法恢复先前完成的语句中的所有行，并且未</font></font><code class="literal">FORCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的值中</font><font style="vertical-align: inherit;">指定
       </font><font style="vertical-align: inherit;">，则
       </font><font style="vertical-align: inherit;">自动修复会在错误日志中显示错误消息并中止：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误：无法修复表格：test.g00页面
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果指定</font></font><code class="literal">FORCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则会写入类似这样的警告：
    </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：在修复./test/g00页面时发现了354行中的344行
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果自动恢复值包含
       </font></font><code class="literal">BACKUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则恢复过程将创建具有表单名称的文件
       </font></font><code class="filename"><em class="replaceable"><code>tbl_name-datetime</code></em>.BAK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您应该有一个</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cron</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本，可以自动将这些文件从数据库目录移动到备份介质。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="key-space"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.2键所需的空间</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528036036448"></a><p>
      <code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表使用B树索引。</font><font style="vertical-align: inherit;">您可以粗略计算索引文件的大​​小，并将其
       </font></font><code class="literal">(key_length+4)/0.67</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇总到所有的键上。</font><font style="vertical-align: inherit;">这是在所有密钥按排序顺序插入并且表格没有任何压缩密钥的情况下的最坏情况。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      字符串索引是空间压缩的。</font><font style="vertical-align: inherit;">如果第一个索引部分是一个字符串，它也是前缀压缩的。</font><font style="vertical-align: inherit;">如果字符串列有很多尾随空间，或者</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是并非总是使用全长</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">列，则</font><font style="vertical-align: inherit;">空间压缩会使索引文件小于最差情况数字
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">前缀压缩用于以字符串开头的键。</font><font style="vertical-align: inherit;">前缀压缩有助于如果有许多字符串具有相同的前缀。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格中，您还</font></font><code class="literal">PACK_KEYS=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在创建表格时</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">表格选项</font><font style="vertical-align: inherit;">来前缀压缩数字</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">数字首先与高位字节一起存储，因此当您有许多具有相同前缀的整数键时，这会有所帮助。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-table-formats"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3 MyISAM表格存储格式</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#static-format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3.1静态（固定长度）表特征</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#dynamic-format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3.2动态表特征</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#compressed-format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3.3压缩表特征</font></font></a></span></dt></dl>
</div>
<p>
      <code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持三种不同的存储格式。</font><font style="vertical-align: inherit;">根据您使用的列的类型自动选择其中两种固定格式和动态格式。</font><font style="vertical-align: inherit;">第三种压缩格式只能使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序</font><font style="vertical-align: inherit;">创建
       </font><font style="vertical-align: inherit;">（请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.5节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 生成压缩的只读MyISAM表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当您使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有
       </font><font style="vertical-align: inherit;">列</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的表格时，可以强制表格格式</font></font><code class="literal">FIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">DYNAMIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="literal">ROW_FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表格选项。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18，“CREATE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，有关的信息
       </font></font><code class="literal">ROW_FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      你可以</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk
      </font></font><code class="option">--unpack</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解压缩（解压）压缩的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">有关更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;">第4.6.3节“ </font></a><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"> -  MyISAM表维护实用程序”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="static-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3.1静态（固定长度）表特征</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        静态格式是</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格</font><font style="vertical-align: inherit;">的默认格式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当表不包含可变长度列（它是用来</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">VARBINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">每行都使用固定数量的字节进行存储。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在三种</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储格式中，静态格式是最简单和最安全的（最不受腐败影响）。</font><font style="vertical-align: inherit;">它也是磁盘格式中速度最快的，因为可以在磁盘上轻松找到数据文件中的行：要根据索引中的行号查找行，请将行号乘以行长计算行的位置。</font><font style="vertical-align: inherit;">而且，在扫描表格时，每次读取磁盘操作都可以读取恒定数量的行。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您的计算机在MySQL服务器写入固定格式</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件时</font><font style="vertical-align: inherit;">崩溃，证明安全性
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以轻松确定每行开始和结束的位置，因此通常可以回收除部分写入行之外的所有行。</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表索引总是可以基于数据行重建。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          固定长度的行格式仅适用于不带</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的</font><font style="vertical-align: inherit;">表格
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用显式</font></font><code class="literal">ROW_FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">创建具有这些列的表
           </font><font style="vertical-align: inherit;">不会产生错误或警告; </font><font style="vertical-align: inherit;">格式规范将被忽略。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        静态格式表具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列以空格填充到指定的列宽，但列类型未更改。
            </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">BINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">VARBINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列被填充以</font></font><code class="literal">0x00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节列的宽度。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列需要额外的空间来记录它们的值是否为
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列需要额外一位，四舍五入到最接近的字节。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            很快。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            易于缓存。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            容易在崩溃后重建，因为行位于固定位置。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            除非您删除大量行并希望将可用磁盘空间返回给操作系统，否则重新组织是不必要的。</font><font style="vertical-align: inherit;">为此，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -r</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常比动态格式表需要更多的磁盘空间。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用以下表达式计算静态大小行的预期行长度（以字节为单位）：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行长度= 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             +（</font></font><em class="replaceable"><code>sum of column lengths</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             +（</font></font><em class="replaceable"><code>number of NULL columns</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font><em class="replaceable"><code>delete_flag</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 7）/ 8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             +（</font></font><em class="replaceable"><code>number of variable-length columns</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p>
            <em class="replaceable"><code>delete_flag</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于具有静态行格式的表，为1。</font><font style="vertical-align: inherit;">静态表在行记录中使用一个标志位，指示行是否已被删除。
            </font></font><em class="replaceable"><code>delete_flag</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于动态表，因为该标志存储在动态行标题中，因此为0。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="dynamic-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3.2动态表特征</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528035970672"></a><a class="indexterm" name="idm140528035969616"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        用于动态存储格式，如果一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表包含任何可变长度列（</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">VARBINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），或者如果表用所创建的</font></font><code class="literal">ROW_FORMAT=DYNAMIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的选项。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        动态格式比静态格式稍微复杂一点，因为每行都有一个标题，表明它有多长。</font><font style="vertical-align: inherit;">当更新结果变长时，一行可能会变成碎片（存储在不连续的碎片中）。
      </font></font></p><a class="indexterm" name="idm140528035960544"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -r</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对表格进行碎片整理。</font><font style="vertical-align: inherit;">如果您有一个固定长度的列可以在一个也包含一些可变长度列的表中经常访问或更改，那么将可变长度列移动到其他表中以避免碎片可能是一个好主意。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        动态格式表具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            所有字符串列都是动态的，除了那些长度小于四的字符串。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每行之前都有一个位图，指示哪些列包含空字符串（对于字符串列）或零（对于数字列）。</font><font style="vertical-align: inherit;">这不包括包含</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果删除尾部空格后字符串列的长度为零，或者数值列的值为零，则它将在位图中标记并且不会保存到磁盘。</font><font style="vertical-align: inherit;">非空字符串保存为长度字节加上字符串内容。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列需要额外的空间来记录它们的值是否为
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列需要额外一位，四舍五入到最接近的字节。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常比固定长度表需要更少的磁盘空间。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每行只使用所需的空间。</font><font style="vertical-align: inherit;">但是，如果一行变大，它将被分割成所需的数量，从而导致行碎片化。</font><font style="vertical-align: inherit;">例如，如果您使用扩展行长度的信息更新一行，则该行将变为碎片。</font><font style="vertical-align: inherit;">在这种情况下，您可能需要</font><font style="vertical-align: inherit;">不时</font><font style="vertical-align: inherit;">运行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -r</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来提高性能。</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -ei</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取表格统计信息。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            比静态格式表更难于在崩溃后重建，因为行可能被分割成许多片段并且链接（片段）可能会丢失。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用以下表达式计算动态大小行的预期行长度：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+（</font></font><em class="replaceable"><code>number of columns</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 7）/ 8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+（</font></font><em class="replaceable"><code>number of char columns</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+（</font></font><em class="replaceable"><code>packed size of numeric columns</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+（</font></font><em class="replaceable"><code>length of strings</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+（</font></font><em class="replaceable"><code>number of NULL columns</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 7）/ 8
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每个链接有6个字节的惩罚。</font><font style="vertical-align: inherit;">每当更新导致行的放大时，链接一个动态行。</font><font style="vertical-align: inherit;">每个新的链接至少有20个字节，所以下一个放大可能在同一个链接中。</font><font style="vertical-align: inherit;">如果不是，则创建另一个链接。</font><font style="vertical-align: inherit;">您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -ed</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到链接的数量
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有链接都可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -r</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="compressed-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3.3压缩表特征</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528035932384"></a><a class="indexterm" name="idm140528035930928"></a><a class="indexterm" name="idm140528035929856"></a><a class="indexterm" name="idm140528035928368"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        压缩存储格式是使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具</font><font style="vertical-align: inherit;">生成的只读格式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">压缩表可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行解压缩
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        压缩表具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            压缩的表占用很少的磁盘空间。</font><font style="vertical-align: inherit;">这可以最大限度地减少磁盘使用量，这在使用慢速磁盘（如CD-ROM）时很有用。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每行都是分开压缩的，因此访问开销很小。</font><font style="vertical-align: inherit;">根据表中最大的行，行的标题占用1到3个字节。</font><font style="vertical-align: inherit;">每列压缩不同。</font><font style="vertical-align: inherit;">每列通常有一个不同的霍夫曼树。</font><font style="vertical-align: inherit;">一些压缩类型是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                后缀空间压缩。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                前缀空间压缩。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                值为零的数字使用一位存储。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果整数列中的值的范围很小，则使用尽可能最小的类型存储该列。</font><font style="vertical-align: inherit;">例如，如果一个</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">BIGINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列（八个字节）的</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">TINYINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有值都在从</font></font><code class="literal">-128</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">〜到</font><font style="vertical-align: inherit;">的范围内，则</font><font style="vertical-align: inherit;">可以将它们存储为
                 </font><font style="vertical-align: inherit;">列（一个字节）
                 </font></font><code class="literal">127</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果列只有一小组可能的值，那么数据类型将转换为
                 </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#enum" title="11.4.4 ENUM类型"><code class="literal">ENUM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                列可以使用前述压缩类型的任意组合。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以用于固定长度或动态长度的行。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          虽然压缩表是只读的，但您不能在表中更新或添加行，但DDL（数据定义语言）操作仍然有效。</font><font style="vertical-align: inherit;">例如，您仍然可以使用</font></font><code class="literal">DROP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除表格并</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清空表格。
</font></font></p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-table-problems"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4 MyISAM表问题</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#corrupted-myisam-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4.1损坏的MyISAM表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#myisam-table-close"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4.2表没有正确关闭的问题</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL用来存储数据的文件格式已经过广泛的测试，但总会有可能导致数据库表损坏的情况。</font><font style="vertical-align: inherit;">以下讨论描述了如何发生以及如何处理它。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="corrupted-myisam-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4.1损坏的MyISAM表</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        即使</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格格式非常可靠（在语句返回之前写入对SQL语句所做的所有更改），如果发生以下任何事件，您仍然可能会损坏表格：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程在写中间被杀害。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            发生意外的计算机关闭（例如，关闭计算机）。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            硬件故障。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您正在使用外部程序（如
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）修改服务器正在同时修改的表。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL或</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            代码</font><font style="vertical-align: inherit;">中的软件错误</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        腐败桌子的典型症状是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从表中选择数据时出现以下错误：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的错误密钥文件：'...'。</font><font style="vertical-align: inherit;">尝试修复它
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查询在表中找不到行或返回不完整的结果。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">检查</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的健康状况</font><font style="vertical-align: inherit;">，并使用修复损坏的</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未运行时，您还可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">检查或修复表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.2节“CHECK TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.5节“REPAIR TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.3节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  MyISAM表维护实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果你的表经常被损坏，你应该尝试确定为什么会发生这种情况。</font><font style="vertical-align: inherit;">要知道的最重要的事情是该表是否因服务器崩溃而损坏。</font><font style="vertical-align: inherit;">您可以通过</font></font><code class="literal">restarted mysqld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在错误日志中</font><font style="vertical-align: inherit;">查找最近的</font><font style="vertical-align: inherit;">消息来</font><font style="vertical-align: inherit;">轻松进行验证
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果存在这样的消息，表格腐败很可能是服务器死亡的结果。</font><font style="vertical-align: inherit;">否则，在正常操作期间可能发生腐败。</font><font style="vertical-align: inherit;">这是一个错误。</font><font style="vertical-align: inherit;">您应该尝试创建可再现的测试用例来证明问题。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#crashing" title="B.5.3.3如果MySQL保持崩溃，该怎么办"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.3.3节“MySQL如何保持崩溃”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
         </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#porting" title="28.5调试和移植MySQL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.5节“调试和移植MySQL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="myisam-table-close"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4.2表没有正确关闭的问题</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引文件（</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件）在标题中都有一个计数器，可用于检查表是否已正确关闭。</font><font style="vertical-align: inherit;">如果你从下面的警告
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着这个计数器已经不同步：
      </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户正在使用或未正确关闭表格
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此警告并不一定意味着表格已损坏，但您至少应该检查表格。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        柜台工作如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL中第一次更新表时，索引文件头部的计数器会增加。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            计数器在进一步更新期间不会更改。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当表的最后一个实例关闭时（因为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">了
             </font><font style="vertical-align: inherit;">操作或因为表缓存中没有空间），如果表在任何时候都已更新，则计数器递减。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当您修理工作台或检查工作台并发现工作正常时，计数器将重置为零。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为避免与可能检查表的其他进程交互的问题，如果计数器为零，则计数器在关闭时不会递减。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        换句话说，只有在这些条件下，计数器才会变得不正确：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表被复制，而第一发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL在更新和最后关闭之间崩溃。</font><font style="vertical-align: inherit;">（表格可能仍然可以，因为MySQL总是为每个语句之间的所有内容写入数据。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个表由</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --recover</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --update-state</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在它被</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的同时进行了修改</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            多个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器正在使用该表，并且一台服务器在另一台服务器正在使用的</font><font style="vertical-align: inherit;">同时在该表上</font><font style="vertical-align: inherit;">执行了一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个服务器。</font><font style="vertical-align: inherit;">在这种设置中，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管您可能会从其他服务器获得警告，但</font><font style="vertical-align: inherit;">使用起来很安全
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该避免这种情况，因为当一台服务器用新的服务器替换数据文件时，这是其他服务器不知道的。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常，在多个服务器之间共享数据目录是一个不好的主意。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">其他讨论</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#multiple-servers" title="5.6在一台机器上运行多个MySQL实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#multiple-servers" title="5.6在一台机器上运行多个MySQL实例"><font style="vertical-align: inherit;">第5.6节“在一台机器上运行多个MySQL实例”</font></a><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="memory-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.3内存存储引擎</font></font></h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140528035844032"></a><a class="indexterm" name="idm140528035842992"></a><a class="indexterm" name="idm140528035841920"></a><a class="indexterm" name="idm140528035840432"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    的</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎（以前称为
     </font></font><code class="literal">HEAP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）创建具有存储在存储器中的内容的专用的表。</font><font style="vertical-align: inherit;">由于数据容易受到崩溃，硬件问题或停电的影响，因此仅将这些表用作临时工作区或从其他表中提取数据的只读缓存。
</font></font></p>
<div class="table">
<a name="idm140528035836816"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表15.4内存存储引擎功能</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Features supported by the MEMORY storage engine."><colgroup><col width="60%"><col width="40%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特征</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B树索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份/时间点恢复</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在服务器中实施，而不是在存储引擎中实施。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群数据库支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聚集索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩数据</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据缓存</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N / A</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密数据</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（通过加密功能在服务器中实现。</font><span class="bold"><strong><font style="vertical-align: inherit;">静态数据</font></strong></span><font style="vertical-align: inherit;">表空间加密在MySQL 5.7和更高版本中可用。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外键支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全文搜索索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间数据类型支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间索引支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引缓存</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N / A</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定粒度</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MVCC</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询缓存支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制支持</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在服务器中实现，而不是在存储引擎中实现。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有限（请参阅本节后面的讨论。）</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储限制</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T树索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新数据字典的统计信息</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-compared-cluster" title="何时使用MEMORY或NDB群集"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时使用MEMORY或NDB群集</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-performance-characteristics" title="性能特点"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能特点</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-characteristics-of-memory-tables" title="MEMORY表格的特性"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEMORY表格的特性</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-ddl-operations-for-memory-tables" title="内存表的DDL操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存表的DDL操作</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-indexes" title="索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-user-created-and-temporary-tables" title="用户创建和临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户创建和临时表</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-loading-data" title="加载数据中"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载数据中</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-tables-replication" title="内存表和复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存表和复制</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-managing-memory-use" title="管理内存使用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理内存使用</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine-additional-resources" title="其他资源"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他资源</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h3 class="title"><a name="memory-storage-engine-compared-cluster"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时使用MEMORY或NDB群集</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      希望将使用</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">应用程序部署到
       </font><font style="vertical-align: inherit;">重要，高度可用或频繁更新的数据的开发人员应考虑NDB集群是否是更好的选择。</font><font style="vertical-align: inherit;">一个典型的</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">使用案例
       </font><font style="vertical-align: inherit;">涉及这些特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          涉及瞬时非关键数据的操作，如会话管理或缓存。</font><font style="vertical-align: inherit;">当MySQL服务器暂停或重新启动时，</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的数据</font><font style="vertical-align: inherit;">将丢失。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于快速访问和低延迟的内存存储。</font><font style="vertical-align: inherit;">数据量可以完全放入内存中，而不会导致操作系统换出虚拟内存页面。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一种只读或主要读取数据访问模式（有限更新）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      NDB集群提供</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与具有更高性能级别</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">相同的功能
       </font><font style="vertical-align: inherit;">，并提供以下附加功能
       </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          行级锁定和多线程操作，以实现客户端之间的低争用。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          即使包含写入的语句混合也具有可伸缩性。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          数据持久性的可选磁盘备份操作。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          无共享架构和多主机操作，无单点故障，可实现99.999％的可用性。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          跨节点自动分配数据; </font><font style="vertical-align: inherit;">应用程序开发人员不需要制定自定义分片或分区解决方案。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          支持变长数据类型（包括
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持）
           </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-storage-engine-performance-characteristics"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能特点</font></font></h3>

</div>

</div>

</div>
<p>
      <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能受到处理更新时单线程执行和表锁定开销导致的争用的限制。</font><font style="vertical-align: inherit;">这在负载增加时限制了可伸缩性，特别是对于包含写入的语句混合。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      尽管</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表</font><font style="vertical-align: inherit;">在内存中进行处理</font><font style="vertical-align: inherit;">，但它们不一定比</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">繁忙服务器上的表，通用查询或读/写工作负载下的表</font><font style="vertical-align: inherit;">更快
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特别是，涉及执行更新的表锁定可能会减慢</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自多个会话</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">并发使用</font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      根据在</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上执行的查询类型
       </font><font style="vertical-align: inherit;">，您可以创建索引作为默认散列数据结构（用于查找基于唯一键的单个值）或通用B树数据结构（用于各种类型的涉及平等，不平等或范围运算符（如小于或大于）的查询。</font><font style="vertical-align: inherit;">以下部分说明了创建两种索引的语法。</font><font style="vertical-align: inherit;">常见的性能问题是在B树索引效率更高的工作负载中使用缺省散列索引。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-storage-engine-characteristics-of-memory-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEMORY表格的特性</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      的</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎相关联的每个表具有一个磁盘文件，其存储表定义（而不是数据）。</font><font style="vertical-align: inherit;">文件名以表名开头，扩展名为</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p>
      <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 表格具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格的</font><font style="vertical-align: inherit;">
          空间</font><font style="vertical-align: inherit;">分成小块。</font><font style="vertical-align: inherit;">表对插入使用100％动态哈希。</font><font style="vertical-align: inherit;">不需要溢出区域或额外的密钥空间。</font><font style="vertical-align: inherit;">免费列表不需要额外的空间。</font><font style="vertical-align: inherit;">删除的行放入链接列表中，并在向表中插入新数据时重新使用。
          </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中也没有通常与哈希表中的删除和插入相关联的问题。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表使用固定长度的行存储格式。</font><font style="vertical-align: inherit;">诸如</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用固定长度存储的</font><font style="vertical-align: inherit;">可变长度类型
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格不能包含
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括对</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的</font><font style="vertical-align: inherit;">支持
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">TEMPORARY</code> <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          所有客户端都共享</font><font style="vertical-align: inherit;">
          非</font><font style="vertical-align: inherit;">表，就像任何其他非</font></font><code class="literal">TEMPORARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表一样。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-storage-engine-ddl-operations-for-memory-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存表的DDL操作</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要创建一个</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，请</font></font><code class="literal">ENGINE=MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">指定该子句
       </font><font style="vertical-align: inherit;">。
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t（i INT）ENGINE = MEMORY;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如引擎名称所示，</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格存储在内存中。</font><font style="vertical-align: inherit;">它们默认使用散列索引，这使得它们对于单值查找非常快速，并且对于创建临时表非常有用。</font><font style="vertical-align: inherit;">但是，当服务器关闭时，存储在</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">所有行都会</font><font style="vertical-align: inherit;">丢失。</font><font style="vertical-align: inherit;">表格本身继续存在，因为它们的定义存储在</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘上的文件中，但是当服务器重新启动时它们是空的。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这个例子展示了你可以如何创建，使用和删除一个
       </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE test ENGINE=MEMORY</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>SELECT ip,SUM(downloads) AS down</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM log_table GROUP BY ip;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT COUNT(ip),AVG(down) FROM test;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>DROP TABLE test;</code></strong>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">
      的最大大小</font><font style="vertical-align: inherit;">受</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">限制，</font><font style="vertical-align: inherit;">系统变量默认值为16MB。</font><font style="vertical-align: inherit;">要对</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">执行不同的大小限制</font><font style="vertical-align: inherit;">，请更改此变量的值。</font><font style="vertical-align: inherit;">在效果的值
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或随后的
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，是用于表的寿命值。</font><font style="vertical-align: inherit;">服务器重新启动还会将现有</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的最大大小设置</font><font style="vertical-align: inherit;">为全局
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">您可以按照本节后面所述设置单个表的大小。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-storage-engine-indexes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎支持
       </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引。</font><font style="vertical-align: inherit;">您可以通过添加</font></font><code class="literal">USING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句来为</font><font style="vertical-align: inherit;">给定索引指定一个或另一个
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE查找</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （id INT，INDEX USING HASH（id））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ENGINE = MEMORY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE查找</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （id INT，INDEX USING BTREE（id））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ENGINE = MEMORY;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关B树和散列索引的一般特性，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#mysql-indexes" title="8.3.1 MySQL如何使用索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.3.1节“MySQL如何使用索引”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p>
      <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 表每个表最多可以有64个索引，每个索引有16列，最大密钥长度为3072个字节。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表散列索引具有高度的密钥重复（许多索引条目包含相同的值），那么影响关键值和所有删除的表的更新会显着变慢。</font><font style="vertical-align: inherit;">这种放缓的程度与复制程度成正比（或者与指数基数成反比）。</font><font style="vertical-align: inherit;">您可以使用</font></font><code class="literal">BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引来避免此问题。
    </font></font></p><p>
      <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表可以有不唯一的键。</font><font style="vertical-align: inherit;">（这是散列索引实现的一个罕见功能。）
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      索引列可以包含</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      值。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-storage-engine-user-created-and-temporary-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户创建和临时表</font></font></h3>

</div>

</div>

</div>
<p>
      <code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表内容存储在内存中，这是</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表与内部临时表共享</font><font style="vertical-align: inherit;">的属性，该</font><font style="vertical-align: inherit;">表与服务器在处理查询时创建的内部临时表共享。</font><font style="vertical-align: inherit;">但是，这两种表格的不同之处在于</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格不受存储转换的限制，而内部临时表格是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果内部临时表变得太大，服务器会自动将其转换为磁盘上的存储器，如
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-temporary-tables" title="8.4.4在MySQL中使用内部临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.4.4节“MySQL中使用内部临时表”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用户创建的</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表永远不会转换为磁盘表。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-storage-engine-loading-data"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载数据中</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL服务器启动时</font><font style="vertical-align: inherit;">填充</font><font style="vertical-align: inherit;">表，您可以使用该
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_init-file"><code class="option">--init-file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">例如，您可以将语句（如
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT INTO ...
      SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
      INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放入此文件）从持久性数据源加载表。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-options" title="5.1.4服务器命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.4节“服务器命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.6节“LOAD DATA INFILE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-tables-replication"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存表和复制</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器的</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表在关闭并重新启动时会变空。</font><font style="vertical-align: inherit;">如果服务器是复制主服务器，其从服务器不知道这些表已变为空，因此如果从从服务器上的表中选择数据，则会看到过时的内容。</font><font style="vertical-align: inherit;">为了同步主</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">和从</font><font style="vertical-align: inherit;">表，当</font><font style="vertical-align: inherit;">主
       </font><font style="vertical-align: inherit;">表</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      第一次在主表上使用表时，会将一条</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句写入主表的二进制日志中，以清空从表上的表。</font><font style="vertical-align: inherit;">在主站重新启动和第一次使用表格之间的时间间隔内，从站仍然存在过期的数据。</font><font style="vertical-align: inherit;">为了避免这个时间间隔，当从机直接查询可能会返回陈旧的数据时，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_init-file"><code class="option">--init-file</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      选项</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启动时</font><font style="vertical-align: inherit;">填充</font><font style="vertical-align: inherit;">主服务器上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-storage-engine-managing-memory-use"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理内存使用</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器需要足够的内存来维护同时使用的所有
       </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果从</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格中</font><font style="vertical-align: inherit;">删除单个行，则内存不会回收
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">内存仅在整个表被删除时才会回收。</font><font style="vertical-align: inherit;">之前用于删除行的内存将重新用于同一个表中的新行。</font><font style="vertical-align: inherit;">要</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在不再需要其内容时</font><font style="vertical-align: inherit;">释放</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">使用的所有内存</font><font style="vertical-align: inherit;">，请执行
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除所有行，或者使用完全删除表</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP
      TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要释放已删除行使用的内存，请使用
       </font></font><code class="literal">ALTER TABLE ENGINE=MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制重建表。
    </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">
      一行所需的内存</font><font style="vertical-align: inherit;">使用以下表达式进行计算：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUM_OVER_ALL_BTREE_KEYS（</font></font><em class="replaceable"><code>max_length_of_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ sizeof（char *）* 4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ SUM_OVER_ALL_HASH_KEYS（sizeof（char *）* 2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ALIGN（</font></font><em class="replaceable"><code>length_of_row</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+1，sizeof（char *））
</font></font></pre><p>
      <code class="literal">ALIGN()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示使行长度成为</font></font><code class="literal">char</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指针大小</font><font style="vertical-align: inherit;">的精确倍数的舍入因子
       </font><font style="vertical-align: inherit;">。
      </font></font><code class="literal">sizeof(char*)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在32位机器上是4个，在64位机器上是8个。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如前所述，
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量设置</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的最大大小限制
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要控制各个表的最大大小，请在创建每个表之前设置此变量的会话值。</font><font style="vertical-align: inherit;">（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除非您打算将值用于</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      所有客户端创建的</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，</font><font style="vertical-align: inherit;">否则请</font><font style="vertical-align: inherit;">不要更改全局
       </font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">。）下面的示例创建两个
       </font><font style="vertical-align: inherit;">表，最大大小分别为1MB和2MB：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET max_heap_table_size = 1024*1024;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (id INT, UNIQUE(id)) ENGINE = MEMORY;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.01秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SET max_heap_table_size = 1024*1024*2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE t2 (id INT, UNIQUE(id)) ENGINE = MEMORY;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果服务器重新启动，</font><font style="vertical-align: inherit;">
      两个表都会恢复为服务器的全局
       </font><font style="vertical-align: inherit;">值。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您还可以在</font></font><code class="literal">MAX_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中
       </font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">表格选项，
       </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以提供有关您计划存储在其中的行数的提示。</font><font style="vertical-align: inherit;">这不会使表增长超出
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，这仍然是最大表大小的限制。</font><font style="vertical-align: inherit;">为了能够使用的最大灵活性，请</font><font style="vertical-align: inherit;">至少</font></font><code class="literal">MAX_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与每个</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表能够增长</font><font style="vertical-align: inherit;">的值一样高的值</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="memory-storage-engine-additional-resources"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他资源</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><a class="ulink" href="http://forums.mysql.com/list.php?92" target="_top"><font style="vertical-align: inherit;">http://forums.mysql.com/list.php?92</font></a></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上提供了</font><font style="vertical-align: inherit;">
      专用于</font><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">论坛</font><font style="vertical-align: inherit;">。
</font></font><a class="ulink" href="http://forums.mysql.com/list.php?92" target="_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="csv-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4 CSV存储引擎</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#se-csv-repair"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4.1修复和检查CSV表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#se-csv-limitations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4.2 CSV限制</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528035620768"></a><a class="indexterm" name="idm140528035619696"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用逗号分隔值格式的文本文件存储引擎存储数据。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎总是被编译到MySQL服务器。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要检查</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">的源代码</font><font style="vertical-align: inherit;">，请查看</font></font><code class="filename">storage/csv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL源代码分发</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">目录。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在创建</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时，服务器会在数据库目录中创建一个表格格式文件。</font><font style="vertical-align: inherit;">该文件以表名称开始并具有</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展名。</font><font style="vertical-align: inherit;">存储引擎还会创建一个数据文件。</font><font style="vertical-align: inherit;">它的名字以表名开头，并有一个</font></font><code class="filename">.CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展名。</font><font style="vertical-align: inherit;">数据文件是纯文本文件。</font><font style="vertical-align: inherit;">将数据存储到表中时，存储引擎会以逗号分隔值格式将其保存到数据文件中。
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE test (i INT NOT NULL, c CHAR(10) NOT NULL)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>ENGINE = CSV;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.12秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO test VALUES(1,'record one'),(2,'record two');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，2行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：2重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM test;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">我| </font><font style="vertical-align: inherit;">c |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">记录一个|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">记录两个|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    创建CSV表格还会创建一个对应的图元文件，用于存储表格的状态以及表格中存在的行数。</font><font style="vertical-align: inherit;">该文件的名称与具有扩展名的表的名称相同</font></font><code class="filename">CSM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    如果您检查</font></font><code class="filename">test.CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过执行前面的语句创建的数据库目录中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">文件，其内容应如下所示：
  </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“1”，“记录一个”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“2”，“记录两个”</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    这种格式可以通过电子表格应用程序（如Microsoft Excel或StarOffice Calc）读取甚至写入。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="se-csv-repair"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4.1修复和检查CSV表</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      CSV存储引擎支持</font></font><code class="literal">CHECK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">REPAIR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明来验证，如果可能的话，修复损坏的CSV表。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      运行</font></font><code class="literal">CHECK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句时，将通过查找正确的字段分隔符，转义字段（匹配或缺少引号），与表定义相比的正确字段数以及是否存在相应的CSV元文件来检查CSV文件的有效性。</font><font style="vertical-align: inherit;">发现的第一个无效行将报告错误。</font><font style="vertical-align: inherit;">检查一个有效的表产生如下所示的输出：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>check table csvtest;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">操作| </font><font style="vertical-align: inherit;">Msg_type | </font><font style="vertical-align: inherit;">Msg_text |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.csvtest | </font><font style="vertical-align: inherit;">检查| </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      检查损坏的表格会返回错误：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>check table csvtest;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">操作| </font><font style="vertical-align: inherit;">Msg_type | </font><font style="vertical-align: inherit;">Msg_text |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.csvtest | </font><font style="vertical-align: inherit;">检查| </font><font style="vertical-align: inherit;">错误| </font><font style="vertical-align: inherit;">腐败|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.01秒）</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果检查失败，表格被标记为崩溃（损坏）。</font><font style="vertical-align: inherit;">一旦表格被标记为损坏，当您下次运行</font></font><code class="literal">CHECK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或执行
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">时，它会自动修复</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">运行时将显示相应的损坏状态和新状态
       </font></font><code class="literal">CHECK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>check table csvtest;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + --------------- ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">操作| </font><font style="vertical-align: inherit;">Msg_type | </font><font style="vertical-align: inherit;">Msg_text |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + --------------- ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.csvtest | </font><font style="vertical-align: inherit;">检查| </font><font style="vertical-align: inherit;">警告| </font><font style="vertical-align: inherit;">表被标记为崩溃|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.csvtest | </font><font style="vertical-align: inherit;">检查| </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ------- + ---------- + --------------- ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2排（0.08秒）</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要修复可以使用的表格</font></font><code class="literal">REPAIR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它会尽可能多地复制现有CSV数据中的有效行，然后用已恢复的行替换现有的CSV文件。</font><font style="vertical-align: inherit;">超出损坏数据的任何行都会丢失。
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>repair table csvtest;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + -------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">操作| </font><font style="vertical-align: inherit;">Msg_type | </font><font style="vertical-align: inherit;">Msg_text |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + -------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.csvtest | </font><font style="vertical-align: inherit;">修复| </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + -------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.02秒）</font></font></pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在修复过程中，只有从CSV文件到第一个损坏行的行被复制到新表中。</font><font style="vertical-align: inherit;">从第一个损坏行到表结尾的所有其他行都被删除，即使是有效的行也是如此。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="se-csv-limitations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.4.2 CSV限制</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎不支持索引。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      分区不支持使用</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">表
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您使用</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      存储引擎</font><font style="vertical-align: inherit;">创建的所有表</font><font style="vertical-align: inherit;">必须</font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在所有列上</font><font style="vertical-align: inherit;">具有该</font><font style="vertical-align: inherit;">属性。</font><font style="vertical-align: inherit;">但是，为了向后兼容，您可以继续使用在以前的MySQL版本中创建的具有可空列的表。</font><font style="vertical-align: inherit;">（错误＃32050）
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="archive-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.5 ARCHIVE存储引擎</font></font></h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140528035576704"></a><a class="indexterm" name="idm140528035575664"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎产生大量未索引数据存储在一个非常小的足迹专用表。
</font></font></p>
<div class="table">
<a name="idm140528035572880"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表15.5存档引擎功能</font></font></b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Features supported by the ARCHIVE storage engine."><colgroup><col width="60%"><col width="40%"></colgroup><thead><tr><th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特征</font></font></th>
<th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持</font></font></th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B树索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份/时间点恢复</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在服务器中实施，而不是在存储引擎中实施。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集群数据库支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聚集索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩数据</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据缓存</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密数据</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（通过加密功能在服务器中实现。</font><span class="bold"><strong><font style="vertical-align: inherit;">静态数据</font></strong></span><font style="vertical-align: inherit;">表空间加密在MySQL 5.7和更高版本中可用。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外键支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全文搜索索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间数据类型支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理空间索引支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引缓存</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定粒度</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MVCC</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询缓存支持</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制支持</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在服务器中实现，而不是在存储引擎中实现。）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储限制</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T树索引</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr><tr><td scope="row"><span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新数据字典的统计信息</font></font></strong></span></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎包含在MySQL二进制分发。</font><font style="vertical-align: inherit;">要从源代码构建MySQL时启用此存储引擎，请</font><font style="vertical-align: inherit;">使用该
     </font><font style="vertical-align: inherit;">
    选项</font><font style="vertical-align: inherit;">调用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake</font></font></strong></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_storage_engine_options" title="存储引擎选项"><code class="option">-DWITH_ARCHIVE_STORAGE_ENGINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要检查</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">的源代码</font><font style="vertical-align: inherit;">，请查看</font></font><code class="filename">storage/archive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL源代码分发</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">目录。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    您可以检查</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎是否可用于该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-engines" title="13.7.5.16 SHOW ENGINES语法"><code class="literal">SHOW ENGINES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    语句。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    当您创建</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时，服务器会在数据库目录中创建一个表格格式文件。</font><font style="vertical-align: inherit;">该文件以表名称开始并具有</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    扩展名。</font><font style="vertical-align: inherit;">存储引擎创建其他文件，所有文件的名称都以表名开头。</font><font style="vertical-align: inherit;">数据文件的扩展名为
     </font></font><code class="filename">.ARZ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="filename">.ARN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化操作中可能会出现</font><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">文件。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎支持
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它确实支持
     </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作，
     </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列和基本上所有空间数据类型（参见</font></font><a class="xref" href="/mysql-5.7-google-zh/data-types.html#spatial-type-overview" title="11.5.1空间数据类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第11.5.1节“空间数据类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发动机采用了行级锁。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎支持
     </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column属性。</font><font style="vertical-align: inherit;">该
     </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列可以具有唯一或不唯一的索引。</font><font style="vertical-align: inherit;">尝试在任何其他列上创建索引都会导致错误。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发动机还支持</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表选项
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来指定一个新的表中的初始序列值或者，重置序列值分别为现有的表。
  </font></font></p><p>
    <code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持将值插入</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小于当前最大列值的列中。</font><font style="vertical-align: inherit;">尝试这样做会导致
     </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_dup_key"><code class="literal">ER_DUP_KEY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎将忽略
     </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，如果没有要求，并扫描他们过去在阅读它们。
  </font></font></p><p>
    <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储：</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行在插入时被压缩。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎使用
    </font></font><code class="literal">zlib</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无损数据压缩（参见
    </font></font><a class="ulink" href="http://www.zlib.net/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> http://www.zlib.net/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">您可以使用
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析表格并将其打包成更小的格式（出于某个原因
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参阅本节后面的内容）。</font><font style="vertical-align: inherit;">该引擎也支持</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK
    TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有几种类型的插入被使用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明只是推行成一个压缩缓冲，并且缓冲刷新是必要的。</font><font style="vertical-align: inherit;">插入缓冲区受锁的保护。</font><font style="vertical-align: inherit;">一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制进行冲洗。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        批量插入只有在完成后才可见，除非其他插入同时发生，在这种情况下可以部分看到。</font><font style="vertical-align: inherit;">A </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永远不会导致大容量刀片的冲洗，除非正在加载时出现正常的刀片插入。
</font></font></p></li></ul>
</div>
<p>
    <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：在检索时，行按需要解压缩; </font><font style="vertical-align: inherit;">没有行缓存。</font><font style="vertical-align: inherit;">一个
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作执行一个完整的表扫描：当</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生时，它发现有多少行是目前可用的和读取的行数。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为一致的读取来执行。</font><font style="vertical-align: inherit;">请注意，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入过程</font><font style="vertical-align: inherit;">中的大量
    </font><font style="vertical-align: inherit;">语句会降低压缩率，除非只使用批量或延迟插入。</font><font style="vertical-align: inherit;">要达到更好的压缩效果，可以使用
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报表中
    </font><font style="vertical-align: inherit;">的行数
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS语法"><code class="literal">SHOW TABLE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是准确的。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.4节“OPTIMIZE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
    </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.5节“REPAIR TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
    </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.5.36节“SHOW TABLE STATUS语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h3><a name="idm140528035451168"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他资源</font></font></h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><a class="ulink" href="http://forums.mysql.com/list.php?112" target="_top"><font style="vertical-align: inherit;">http://forums.mysql.com/list.php?112</font></a></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供</font><font style="vertical-align: inherit;">
        专用于</font><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">论坛</font><font style="vertical-align: inherit;">。
</font></font><a class="ulink" href="http://forums.mysql.com/list.php?112" target="_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="blackhole-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.6 BLACKHOLE存储引擎</font></font></h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140528035446736"></a><a class="indexterm" name="idm140528035445648"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎作为一个
     </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">黑洞</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它接受的数据，但它扔了出去，不存储。</font><font style="vertical-align: inherit;">检索总是返回一个空的结果：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE test(i INT, c CHAR(10)) ENGINE = BLACKHOLE;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.03秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO test VALUES(1,'record one'),(2,'record two');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，2行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：2重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM test;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要从</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码构建MySQL时</font><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">存储引擎，请</font><font style="vertical-align: inherit;">使用该
     </font><font style="vertical-align: inherit;">
    选项</font><font style="vertical-align: inherit;">调用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake</font></font></strong></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_storage_engine_options" title="存储引擎选项"><code class="option">-DWITH_BLACKHOLE_STORAGE_ENGINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要检查</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">的源代码</font><font style="vertical-align: inherit;">，请查看</font></font><code class="filename">sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL源代码分发</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">目录。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在创建</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时，服务器会在数据库目录中创建一个表格格式文件。</font><font style="vertical-align: inherit;">该文件以表名称开始并具有</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    扩展名。</font><font style="vertical-align: inherit;">没有其他文件与表格相关联。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎支持所有类型的索引。</font><font style="vertical-align: inherit;">也就是说，您可以在表格定义中包含索引声明。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    您可以检查</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎是否可用于该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-engines" title="13.7.5.16 SHOW ENGINES语法"><code class="literal">SHOW
    ENGINES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    插入到</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中不会存储任何数据，但如果启用了基于语句的二进制日志记录，则会将SQL语句记录并复制到从属服务器。</font><font style="vertical-align: inherit;">这可以用作中继器或过滤器机制。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    假设您的应用程序需要从端过滤规则，但是首先将所有二进制日志数据传输到从服务器会导致流量过大。</font><font style="vertical-align: inherit;">在这种情况下，可以在主控主机上设置</font><font style="vertical-align: inherit;">默认存储引擎</font><font style="vertical-align: inherit;">的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从属进程，</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
</font></font></p>
<div class="figure">
<a name="idm140528035425392"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图15.1使用BLACKHOLE进行过滤复制</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/blackhole-1.png" width="520" height="245" alt="使用BLACKHOLE进行过滤复制">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    主站写入其二进制日志。</font><font style="vertical-align: inherit;">的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚设</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font></font></span>
    <a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程是一个从机，施加的所需组合</font></font><code class="literal">replicate-do-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><code class="literal">replicate-ignore-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则，并写入它自己的新的，过滤二进制日志。</font><font style="vertical-align: inherit;">（请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-options" title="16.1.6复制和二进制日志记录选项和变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.1.6节“复制和二进制日志记录选项和变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）此过滤日志提供给从站。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    虚拟进程实际上并不存储任何数据，因此</font><font style="vertical-align: inherit;">在复制主控主机上</font><font style="vertical-align: inherit;">运行额外的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程会</font><font style="vertical-align: inherit;">产生很少的处理开销
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这种类型的设置可以通过附加的复制从站进行重复。
  </font></font></p><p>
    <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格的</font><font style="vertical-align: inherit;">触发器
     </font><font style="vertical-align: inherit;">按预期工作。</font><font style="vertical-align: inherit;">但是，由于该</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表实际上并未存储任何数据，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发器未激活：</font></font><code class="literal">FOR EACH ROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发器定义中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句不适用，因为没有行。
  </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">
    其他可能用途</font><font style="vertical-align: inherit;">包括：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        转储文件语法的验证。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过比较使用</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用和不启用二进制日志记录的</font><font style="vertical-align: inherit;">性能，测量二进制日志记录的开销</font><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p>
        <code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本质上是一个
         </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无操作</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”的</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，因此它可以用于查找与存储引擎本身无关的性能瓶颈。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发动机是交易感知的，在这个意义上，提交的事务都写入二进制日志和回滚事务都没有。
  </font></font></p><p>
    <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">黑洞引擎和自动递增列</font></font></strong></span>
  </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Blackhole引擎是一个无操作引擎。</font><font style="vertical-align: inherit;">任何使用Blackhole在桌面上执行的操作都不会起作用。</font><font style="vertical-align: inherit;">在考虑自动递增的主键列的行为时，应该牢记这一点。</font><font style="vertical-align: inherit;">引擎不会自动增加字段值，也不会保留自动增量字段状态。</font><font style="vertical-align: inherit;">这对复制有重要影响。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    考虑以下复制情况，其中以下三个条件均适用：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在主服务器上有一个带有自动增量字段的黑洞表，它是主键。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在一个从机上存在同一个表，但使用MyISAM引擎。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        无需在</font></font><code class="literal">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句本身中</font><font style="vertical-align: inherit;">明确设置自动递增值，</font><font style="vertical-align: inherit;">也可以通过使用
         </font></font><code class="literal">SET INSERT_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">在主表中执行插入操作
         </font><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在这种情况下，复制将失败，主键列上出现重复条目​​错误。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在基于语句的复制中，</font></font><code class="literal">INSERT_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文事件中</font><font style="vertical-align: inherit;">的值
     </font><font style="vertical-align: inherit;">将始终相同。</font><font style="vertical-align: inherit;">因此，复制将失败，因为尝试插入具有主键列重复值的行。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在基于行的复制中，引擎对行的返回值始终与每个插入的值相同。</font><font style="vertical-align: inherit;">这将导致从服务器尝试使用主键列的相同值重播两个插入日志条目，因此复制将失败。
  </font></font></p><p>
    <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列过滤</font></font></strong></span>
  </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在使用基于行的复制时，（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）会支持从表中缺少最后一列的从站，如
     </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-features-differing-tables" title="16.4.1.10复制主控和从属参数不同的表定义"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.4.1.10节“在主服务器和从服务器上使用不同的表定义进行复制”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    此过滤在从属端工作，也就是说，在过滤之前，这些列将被复制到从属端口。</font><font style="vertical-align: inherit;">至少有两种情况是不希望将列复制到从服务器：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果数据是保密的，那么从属服务器不应该有权访问它。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果主站有多个从站，则在发送到从站之前进行筛选可能会减少网络流量。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    主列过滤可以使用</font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">来实现
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这与主表过滤的实现方式类似 - 通过使用
     </font></font><code class="literal">BLACKHOLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎和/
     </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-do-table"><code class="option">--replicate-do-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
     </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_replicate-ignore-table"><code class="option">--replicate-ignore-table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    主设备的设置是：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（public_col_1，...，public_col_N，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 secret_col_1，...，secret_col_M）ENGINE = MyISAM;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    可信从站的设置是：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（public_col_1，...，public_col_N）ENGINE = BLACKHOLE;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    不受信任的奴隶的设置是：
</font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（public_col_1，...，public_col_N）ENGINE = MyISAM;</font></font></pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="merge-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.7 MERGE存储引擎</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#merge-table-advantages"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.7.1 MERGE表的优点和缺点</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#merge-table-problems"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.7.2 MERGE表问题</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528035371856"></a><a class="indexterm" name="idm140528035370816"></a><a class="indexterm" name="idm140528035369328"></a><a class="indexterm" name="idm140528035367840"></a><a class="indexterm" name="idm140528035366352"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    的</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，也被称为
     </font></font><code class="literal">MRG_MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发动机，是相同的集合
     </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可被用作一个表。
    </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示所有表具有相同的列数据类型和索引信息。</font><font style="vertical-align: inherit;">不能合并
     </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列以不同顺序列出的表，在相应列中没有完全相同的数据类型，或者索引顺序不同。</font><font style="vertical-align: inherit;">但是，任何或所有</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格都可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行压缩</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.5节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 生成压缩的只读MyISAM表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">表格之间的差异并不重要：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        相应列和索引的名称可能不同。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表，列和索引的注释可能有所不同。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表的选项，如</font></font><code class="literal">AVG_ROW_LENGTH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">MAX_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">PACK_KEYS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以不同。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">
    的另一种选择</font><font style="vertical-align: inherit;">是分区表，它将单个表的分区存储在单独的文件中。</font><font style="vertical-align: inherit;">分区使得一些操作能够更高效地执行，并且不限于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    存储引擎。</font><font style="vertical-align: inherit;">有关更多信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html" title="第22章分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    当你创建一个</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时，MySQL会在磁盘上创建两个文件。</font><font style="vertical-align: inherit;">这些文件的名称以表名开头，并有一个扩展名来指示文件类型。</font><font style="vertical-align: inherit;">一个
     </font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件存储表格格式，而一个
     </font></font><code class="filename">.MRG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件包含</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应当作为一个使用</font><font style="vertical-align: inherit;">的基础</font><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">的名称
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些表不必与</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">在同一个数据库
     </font><font style="vertical-align: inherit;">中。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    表。</font><font style="vertical-align: inherit;">您必须</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">映射到</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表
     </font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_select"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
     </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_delete"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_update"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权
     </font><font style="vertical-align: inherit;">。
</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格会带来以下安全问题：如果用户有权访问</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表</font></font><em class="replaceable"><code>t</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么该用户可以创建一个</font><font style="vertical-align: inherit;">可访问</font><font style="vertical-align: inherit;">的
       </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，如果用户的特权</font><font style="vertical-align: inherit;">随后被撤销，则用户可以</font><font style="vertical-align: inherit;">通过这样做
       </font><font style="vertical-align: inherit;">继续访问
       </font><font style="vertical-align: inherit;">。
</font></font><em class="replaceable"><code>m</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>t</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>t</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>t</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>m</code></em><font style="vertical-align: inherit;"></font></p>
</div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">一起
     </font><font style="vertical-align: inherit;">
    使用</font><font style="vertical-align: inherit;">只会降低
     </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规格。</font><font style="vertical-align: inherit;">基础表不受影响。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要创建</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，您必须指定一个
     </font><font style="vertical-align: inherit;">
    选项来指示</font><font style="vertical-align: inherit;">要使用的表格。</font><font style="vertical-align: inherit;">您可以选择指定一个</font><font style="vertical-align: inherit;">
    选项来控制如何插入</font><font style="vertical-align: inherit;">
    表中。</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">or
     </font><font style="vertical-align: inherit;">的值分别</font><font style="vertical-align: inherit;">使插入在第一个或最后一个基础表中进行。</font><font style="vertical-align: inherit;">如果您不指定任何
     </font><font style="vertical-align: inherit;">选项，或者如果您指定它的值为</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">则不允许</font><font style="vertical-align: inherit;">插入到
     </font><font style="vertical-align: inherit;">表中，并尝试这样做会导致错误。
  </font></font><code class="literal">UNION=(<em class="replaceable"><code>list-of-tables</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"></font><code class="literal">INSERT_METHOD</code><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"></font><code class="literal">FIRST</code><font style="vertical-align: inherit;"></font><code class="literal">LAST</code><font style="vertical-align: inherit;"></font><code class="literal">INSERT_METHOD</code><font style="vertical-align: inherit;"></font><code class="literal">NO</code><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    以下示例显示如何创建</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    表格：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>message CHAR(20)) ENGINE=MyISAM;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t2 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>message CHAR(20)) ENGINE=MyISAM;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO t1 (message) VALUES ('Testing'),('table'),('t1');</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO t2 (message) VALUES ('Testing'),('table'),('t2');</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE total (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>message CHAR(20), INDEX(a))</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;    </font></font><strong class="userinput"><code>ENGINE=MERGE UNION=(t1,t2) INSERT_METHOD=LAST;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    列</font><font style="vertical-align: inherit;">在基础</font><font style="vertical-align: inherit;">表中</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引为a </font><font style="vertical-align: inherit;">，但不在</font><font style="vertical-align: inherit;">表中。</font><font style="vertical-align: inherit;">在那里它被索引，但不是作为一个</font><font style="vertical-align: inherit;">表，</font><font style="vertical-align: inherit;">因为
     </font><font style="vertical-align: inherit;">表不能强制执行唯一性超过一组基础表。</font><font style="vertical-align: inherit;">（同样，</font><font style="vertical-align: inherit;">在基础表中有索引</font><font style="vertical-align: inherit;">的列
     </font><font style="vertical-align: inherit;">应该在</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">索引，</font><font style="vertical-align: inherit;">但不能作为
     </font><font style="vertical-align: inherit;">索引。）
  </font></font><code class="literal">PRIMARY
    KEY</code><font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    创建</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表之后，可以使用它来发出对整个表组进行操作的查询：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM total;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+  -  + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">消息|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+  -  + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">测试|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">表| |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">t1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">测试|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">表| |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">t2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+  -  + --------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要将</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表重</font><font style="vertical-align: inherit;">映射</font><font style="vertical-align: inherit;">到不同的</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">集合</font><font style="vertical-align: inherit;">，可以使用以下方法之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">DROP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表并重新创建它。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font><font style="vertical-align: inherit;">来改变底层表的列表。
      </font></font><code class="literal">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em>
        UNION=(...)</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        也可以使用</font></font><code class="literal">ALTER TABLE ...
        UNION=()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（即用空
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句）删除所有基础表。</font><font style="vertical-align: inherit;">但是，在这种情况下，该表实际上是空的，并且插入失败，因为没有基础表需要新行。</font><font style="vertical-align: inherit;">这样的表格可能会用作创建新</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">的模板</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-like" title="13.1.18.4 CREATE TABLE ... LIKE语法"><code class="literal">CREATE
        TABLE ... LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    基础表定义和索引必须严格符合表的定义</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当一个表的一部分</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    被打开时，而不是在</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建表</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">检查一致性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果任何表失败一致性检查，触发表打开的操作将失败。</font><font style="vertical-align: inherit;">这意味着</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问表</font><font style="vertical-align: inherit;">时，对a </font><font style="vertical-align: inherit;">中表的定义所做的更改
     </font><font style="vertical-align: inherit;">可能会导致失败
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">应用于每个表的一致性检查是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        基础表和</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表必须具有相同的列数。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        基础表和</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的列顺序
         </font><font style="vertical-align: inherit;">必须匹配。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此外，</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还会比较</font><font style="vertical-align: inherit;">父</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">中的每个对应列的规范</font><font style="vertical-align: inherit;">和基础表，并且必须满足以下检查：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            基础表和</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的列类型
             </font><font style="vertical-align: inherit;">必须相同。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            基础表和</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的列长度
             </font><font style="vertical-align: inherit;">必须相等。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            基础表和
             </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的列可以是
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        基础表必须至少具有与</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">一样多的索引
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">基础表可能有比</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">更多的索引</font><font style="vertical-align: inherit;">，但不能少一些。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          存在一个已知问题，即</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表和基础</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的相同列的索引必须以相同顺序排列</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参见错误＃33653。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个指数必须满足这些检查：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            基础表和</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的索引类型
             </font><font style="vertical-align: inherit;">必须相同。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            基础表和</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的索引定义中的索引部分（即复合索引内的多个列）的数量</font><font style="vertical-align: inherit;">必须相同。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于每个索引部分：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                索引部分长度必须相等。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                索引部分类型必须相同。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                索引部分语言必须相同。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                检查索引部分是否可以
                 </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    如果</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于基础表的问题而无法打开或使用表，请</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK
    TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示有关哪个表导致问题的信息。
</font></font></p>
<h3><a name="idm140528035249920"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他资源</font></font></h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><a class="ulink" href="http://forums.mysql.com/list.php?93" target="_top"><font style="vertical-align: inherit;">http://forums.mysql.com/list.php?93</font></a></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上提供了</font><font style="vertical-align: inherit;">
        专用于</font><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">论坛</font><font style="vertical-align: inherit;">。
</font></font><a class="ulink" href="http://forums.mysql.com/list.php?93" target="_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="merge-table-advantages"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.7.1 MERGE表的优点和缺点</font></font></h3>

</div>

</div>

</div>
<p>
      <code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 表格可以帮助您解决以下问题：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          轻松管理一组日志表。</font><font style="vertical-align: inherit;">例如，您可以将来自不同月份的数据放入单独的表格中，使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩其中一些数据，</font><font style="vertical-align: inherit;">然后创建一个
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格将它们作为一个表格使用。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          获得更多速度。</font><font style="vertical-align: inherit;">您可以根据某些条件拆分大型只读表，然后将各个表放在不同的磁盘上。</font><font style="vertical-align: inherit;">以</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种方式构建</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表可能比使用单个大表快得多。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          执行更有效的搜索。</font><font style="vertical-align: inherit;">如果你确切知道你在找什么，你可以在一个底层表中搜索一些查询，并</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为其他表</font><font style="vertical-align: inherit;">使用一个</font><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">你甚至可以有许多</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用重叠表格的</font><font style="vertical-align: inherit;">不同
           </font><font style="vertical-align: inherit;">表格。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          执行更有效的修理。</font><font style="vertical-align: inherit;">修复映射到</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">单个较小表</font><font style="vertical-align: inherit;">比修复单个较大表</font><font style="vertical-align: inherit;">更容易
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将许多表即时映射为一个。</font><font style="vertical-align: inherit;">一个</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表不需要维护它自己的索引，因为它使用了各个表的索引。</font><font style="vertical-align: inherit;">因此，
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格集合
           </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速地创建或重新映射。</font><font style="vertical-align: inherit;">（</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使没有</font><font style="vertical-align: inherit;">创建索引，您仍然必须在创​​建</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">时指定索引定义
           </font><font style="vertical-align: inherit;">。）
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您有一组表可以根据需要创建大型表，您可以根据需要从中创建
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">这要快得多并且节省了大量的磁盘空间。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          超过操作系统的文件大小限制。</font><font style="vertical-align: inherit;">每个
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表都受此限制约束，但</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的集合</font><font style="vertical-align: inherit;">不是。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过定义
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射到该单个表的表</font><font style="vertical-align: inherit;">来创建表的别名或同义词
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这样做应该没有真正显着的性能影响（只有几次间接调用和
           </font></font><code class="literal">memcpy()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次读取的调用）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">
      的缺点</font><font style="vertical-align: inherit;">是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您只能</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">使用相同</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表格。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          某些</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能在</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">中不可用
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，您不能</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">索引
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（您可以</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在基础</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">创建
           </font><font style="vertical-align: inherit;">索引
           </font><font style="vertical-align: inherit;">，但不能
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用全文搜索来搜索表。）
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格是非临时</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">，则所有基础</font><font style="vertical-align: inherit;">表格都必须是非临时表格。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格是临时的，则</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格可以是临时和非临时的任意组合。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表使用比</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">更多的文件描述符
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果10个客户端使用
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射到10个表的表，则服务器使用（10×10）+ 10个文件描述符。</font><font style="vertical-align: inherit;">（10个客户端中的每个客户端的10个数据文件描述符，以及10个客户端之间共享的索引文件描述符）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引读取速度较慢。</font><font style="vertical-align: inherit;">读取索引时，
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎需要对所有基础表发出读取操作，以检查哪一个与给定索引值最匹配。</font><font style="vertical-align: inherit;">要读取下一个索引值，
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎需要搜索读缓冲区以查找下一个值。</font><font style="vertical-align: inherit;">只有当一个索引缓冲区用完时，存储引擎才需要读取下一个索引块。</font><font style="vertical-align: inherit;">这会使</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引在</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          搜索上</font><font style="vertical-align: inherit;">慢得多</font><font style="vertical-align: inherit;">，但搜索</font><font style="vertical-align: inherit;">速度并</font><font style="vertical-align: inherit;">不会太慢
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关详细信息</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ，并</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.8.2，“EXPLAIN语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="merge-table-problems"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.7.2 MERGE表问题</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下是有关</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表格的</font><font style="vertical-align: inherit;">已知问题</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在5.1.23之前的MySQL Server版本中，可以使用非临时子MyISAM表创建临时合并表。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从版本5.1.23开始，MERGE子级通过父表被锁定。</font><font style="vertical-align: inherit;">如果父母是临时的，那么它并没有被锁定，所以孩子们也没有被锁住。</font><font style="vertical-align: inherit;">并行使用MyISAM表会破坏它们。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">为另一个存储引擎，则对基础表的映射将丢失。</font><font style="vertical-align: inherit;">相反，底层</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的行将</font><font style="vertical-align: inherit;">被复制到更改后的表中，然后该表使用指定的存储引擎。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><code class="literal">INSERT_METHOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个表选择
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表指示哪个底层
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用表插入到
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中。</font><font style="vertical-align: inherit;">然而，使用的
           </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该表选项
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表对于插入到不影响</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，直到至少一个行已直接插入到</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表中。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表不能保持对整个表唯一性约束。</font><font style="vertical-align: inherit;">执行某个操作时
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，数据将进入第一个或最后一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格（由</font></font><code class="literal">INSERT_METHOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">确定</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">MySQL确保唯一的键值在该</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">保持唯一
           </font><font style="vertical-align: inherit;">，但不会覆盖该集合中的所有基础表。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          由于该</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎无法对该组基础表实施唯一性，因此
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法按预期工作。</font><font style="vertical-align: inherit;">两个关键事实是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只能在要写入的基础表中检测唯一的键违规（由</font></font><code class="literal">INSERT_METHOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">决定
               </font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这不同于</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格本身的</font><font style="vertical-align: inherit;">违规行为</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测到唯一的密钥违例，它将只更改它正在写入的基础表中的相应行; </font><font style="vertical-align: inherit;">即由</font></font><code class="literal">INSERT_METHOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">确定的第一张或最后一张表
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          类似的考虑适用于
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-on-duplicate" title="13.2.5.2 INSERT ... ON DUPLICATE KEY UPDATE语法"><code class="literal">INSERT
          ... ON DUPLICATE KEY UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表不支持分区。</font><font style="vertical-align: inherit;">也就是说，您不能对</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表进行</font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">，也不能对</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">任何</font><font style="vertical-align: inherit;">基础</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表进行分区。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          你不应该使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有一个
           </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款，或
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何被映射到一个开放的表的</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表。</font><font style="vertical-align: inherit;">如果这样做，</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格可能仍会引用原始表格并产生意想不到的结果。</font><font style="vertical-align: inherit;">要解决此问题，请确保</font><font style="vertical-align: inherit;">在执行任何指定的操作之前，</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">保持</font><font style="vertical-align: inherit;">任何
           </font><font style="vertical-align: inherit;">表未被打开
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          意外的结果包括</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上的操作</font><font style="vertical-align: inherit;">会报告表损坏</font><font style="vertical-align: inherit;">的可能性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果这发生在基础</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上的某个命名操作之后</font><font style="vertical-align: inherit;">，则损坏消息是虚假的。</font><font style="vertical-align: inherit;">为了解决这个问题，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在修改</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">后</font><font style="vertical-align: inherit;">发布一个
           </font><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在由表使用的</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上不适用于Windows，因为</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的表映射对于MySQL的上层是隐藏的。</font><font style="vertical-align: inherit;">Windows不允许删除打开的文件，因此您必须先删除所有</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格（带有
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或删除
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当访问表时（例如，作为</font><font style="vertical-align: inherit;">或
           </font><font style="vertical-align: inherit;">声明的</font><font style="vertical-align: inherit;">一部分），检查</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表和
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表
           </font><font style="vertical-align: inherit;">
          的定义</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些检查</font><font style="vertical-align: inherit;">通过比较列顺序，类型，大小和关联索引来</font><font style="vertical-align: inherit;">确保表和父
           </font><font style="vertical-align: inherit;">表定义匹配。</font><font style="vertical-align: inherit;">如果表格之间存在差异，则返回错误并且语句失败。</font><font style="vertical-align: inherit;">由于这些检查是在表打开时发生的，因此对单个表的定义（包括列更改，列排序和引擎更改）的任何更改都会导致语句失败。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中及其基础表中</font><font style="vertical-align: inherit;">
          的索引顺序</font><font style="vertical-align: inherit;">应该相同。</font><font style="vertical-align: inherit;">如果您使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向</font></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中使用的</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">添加
           </font><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">，然后使用</font><font style="vertical-align: inherit;">在
           </font><font style="vertical-align: inherit;">表
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上添加非唯一索引</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么如果在基础表中已经存在非唯一索引，则索引排序对于表是不同的。</font><font style="vertical-align: inherit;">（发生这种情况是因为
           </font><font style="vertical-align: inherit;">在非唯一索引之前</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放入
           </font></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引以便快速检测重复键。）因此，使用此类索引的表上的查询可能会返回意外的结果。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果遇到与</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1017（HY000）</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似的错误消息</font><span class="errortext"><font style="vertical-align: inherit;">：找不到文件：'. </font></span><span class="errortext"><font style="vertical-align: inherit;">MRG'（错误号：2）</font></span><font style="vertical-align: inherit;">，它通常表示某些基础表不使用</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          存储引擎。</font><font style="vertical-align: inherit;">确认所有这些表都是
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格中</font><font style="vertical-align: inherit;">
          的最大行数</font><font style="vertical-align: inherit;">是2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（〜1.844E + 19;与</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">无法将多个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">合并</font><font style="vertical-align: inherit;">到一个
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中，而这个表的行数会超过这个数。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          目前已知</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用具有父表格的不同行格式</font><font style="vertical-align: inherit;">
          的基础</font><font style="vertical-align: inherit;">表格</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会失败。</font><font style="vertical-align: inherit;">参见Bug＃32364。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生效</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">
          不能更改非临时</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的联合列表
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK
          TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下就
           </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常工作：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE m1 ... ENGINE = MRG_MYISAM ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
锁定表t1写入，t2写入，m1写入;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE m1 ... UNION =（t1，t2）...;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          但是，您可以使用临时</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">执行此操作
           </font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您不能创建一个</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有桌子
           </font></font><code class="literal">CREATE ... SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，既不是一个临时
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中，也不作为非临时
           </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE m1 ... ENGINE = MRG_MYISAM ... SELECT ...;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          尝试这样做会导致错误：
           </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是</font></font><code class="literal">BASE
          TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在某些情况下，</font><font style="vertical-align: inherit;">如果基础表包含</font><font style="vertical-align: inherit;">或
           </font><font style="vertical-align: inherit;">列，</font><font style="vertical-align: inherit;">则表和底层表</font></font><code class="literal">PACK_KEYS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">不同</font><font style="vertical-align: inherit;">表选项值</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会导致意外的结果</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">作为解决方法，
           </font><font style="vertical-align: inherit;">请确保所有涉及的表具有相同的</font><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">（错误＃50646）
</font></font><code class="literal">CHAR</code><font style="vertical-align: inherit;"></font><code class="literal">BINARY</code><font style="vertical-align: inherit;"></font><code class="literal">ALTER TABLE</code><font style="vertical-align: inherit;"></font><code class="literal">PACK_KEYS</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="federated-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8 FEDERATED存储引擎</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-description"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.1 FEDERATED存储引擎概述</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-create"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.2如何创建FEDERATED表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-usagenotes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.3联邦存储引擎注释和提示</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-storage-engine-resources"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.4 FEDERATED存储引擎资源</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528035095072"></a><a class="indexterm" name="idm140528035093984"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，您无需使用复制或群集技术访问从远程MySQL数据库的数据。</font><font style="vertical-align: inherit;">查询本地</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表会自动从远程（联合）表中提取数据。</font><font style="vertical-align: inherit;">没有数据存储在本地表上。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要包含</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，如果您从源代码创建MySQL，请</font><font style="vertical-align: inherit;">使用该
     </font><font style="vertical-align: inherit;">
    选项</font><font style="vertical-align: inherit;">调用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake</font></font></strong></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_storage_engine_options" title="存储引擎选项"><code class="option">-DWITH_FEDERATED_STORAGE_ENGINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎默认情况下未在运行的服务器启用; </font><font style="vertical-align: inherit;">要启用
     </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您必须使用该</font></font><code class="option">--federated</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动MySQL服务器二进制文件</font><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要检查</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">的源代码</font><font style="vertical-align: inherit;">，请查看</font></font><code class="filename">storage/federated</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL源代码分发</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">目录。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="federated-description"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.1 FEDERATED存储引擎概述</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当创建使用标准的存储引擎中的一个（例如桌子</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），该表由表定义和相关联的数据。</font><font style="vertical-align: inherit;">在创建
       </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时，表定义是相同的，但数据的物理存储在远程服务器上处理。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      一个</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格由两个元素组成：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          甲</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程服务器</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与数据库表，其又由表定义（存储中的
           </font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件）和相关联的表。</font><font style="vertical-align: inherit;">远程表的表类型可以是远程</font></font><code class="literal">mysqld</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font><font style="vertical-align: inherit;">支持的任何类型</font><font style="vertical-align: inherit;">，包括
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          甲</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地服务器</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与数据库表，其中表定义在远程服务器上匹配相应的表的。</font><font style="vertical-align: inherit;">表格定义存储在</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中。</font><font style="vertical-align: inherit;">但是，本地服务器上没有数据文件。</font><font style="vertical-align: inherit;">相反，表定义包含一个指向远程表的连接字符串。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地服务器</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表上</font><font style="vertical-align: inherit;">执行查询和语句时
       </font><font style="vertical-align: inherit;">，通常会将本地数据文件中插入，更新或删除信息的操作发送到远程服务器执行，在远程服务器上更新数据文件或从远程服务器返回匹配的行。
    </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格设置</font><font style="vertical-align: inherit;">
      的基本结构</font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#figure-se-federated-structure" title="图15.2 FEDERATED表结构"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图15.2“FEDERATED表格结构”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="figure">
<a name="figure-se-federated-structure"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图15.2 FEDERATED表结构</font></font></b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="./images/se-federated-structure.png" width="475" height="269" alt="内容在周围文本中描述。">
</div>

</div>

</div>
<br class="figure-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当客户端发出引用</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的SQL语句时，
       </font><font style="vertical-align: inherit;">本地服务器（执行SQL语句的位置）和远程服务器（数据实际存储的位置）之间的信息流如下所示：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          存储引擎会查看该</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表所具有的</font><font style="vertical-align: inherit;">每个列，
           </font><font style="vertical-align: inherit;">并构建引用远程表的适当SQL语句。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该语句使用MySQL客户端API发送到远程服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          远程服务器处理语句，本地服务器检索语句产生的任何结果（受影响的行数或结果集）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果语句产生结果集，则每列都转换为</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎期望的</font><font style="vertical-align: inherit;">内部存储引擎格式，
           </font><font style="vertical-align: inherit;">并可用于将结果显示给发布原始语句的客户端。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本地服务器使用MySQL客户端C API函数与远程服务器进行通信。</font><font style="vertical-align: inherit;">它调用
       </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-real-query" title="27.8.7.57 mysql_real_query（）"><code class="literal">mysql_real_query()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送语句。</font><font style="vertical-align: inherit;">要读取一个结果集，它使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-store-result" title="27.8.7.75 mysql_store_result（）"><code class="literal">mysql_store_result()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并一次取一行
       </font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-fetch-row" title="27.8.7.21 mysql_fetch_row（）"><code class="literal">mysql_fetch_row()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="federated-create"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.2如何创建FEDERATED表</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-create-connection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.2.1使用CONNECTION创建FEDERATED表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#federated-create-server"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.2.2使用CREATE SERVER创建FEDERATED表</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要创建</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，您应该按照以下步骤操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在远程服务器上创建表。</font><font style="vertical-align: inherit;">或者，记下现有表的表定义，可能使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE语法"><code class="literal">SHOW CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用相同的表定义在本地服务器上创建表，但添加将本地表链接到远程表的连接信息。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      例如，您可以在远程服务器上创建以下表格：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE test_table（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT（20）NOT NULL AUTO_INCREMENT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    name VARCHAR（32）NOT NULL DEFAULT''，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    其他INT（20）NOT NULL DEFAULT'0'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（id），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INDEX名称（名称），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INDEX other_key（其他）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENGINE = MyISAM数据</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DEFAULT CHARSET = latin1;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要创建将联合到远程表的本地表，有两个选项可用。</font><font style="vertical-align: inherit;">您可以创建本地表并指定用于使用连接到远程表的连接字符串（包含服务器名称，登录名，密码）</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，也可以使用先前使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">创建的现有连接
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在创建本地表时，它</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        与远程表具有相同的字段定义。
</font></font></p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过向主机上的表添加索引来</font><font style="vertical-align: inherit;">提高</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的性能
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化将发生，因为发送到远程服务器的查询将包含该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">的内容，
         </font><font style="vertical-align: inherit;">并将发送到远程服务器，然后在本地执行。</font><font style="vertical-align: inherit;">这样可以减少网络流量，否则会请求服务器上的整个表进行本地处理。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="federated-create-connection"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.2.1使用CONNECTION创建FEDERATED表</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要使用第一种方法，您必须</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">的引擎类型之后</font><font style="vertical-align: inherit;">指定
         </font><font style="vertical-align: inherit;">字符串
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE federated_table（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT（20）NOT NULL AUTO_INCREMENT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    name VARCHAR（32）NOT NULL DEFAULT''，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    其他INT（20）NOT NULL DEFAULT'0'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（id），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INDEX名称（名称），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INDEX other_key（其他）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENGINE = FEDERATED</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DEFAULT CHARSET = latin1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CONNECTION = '的MySQL：// fed_user @ REMOTE_HOST：9306 /联合/ TEST_TABLE';</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
          <code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取代了
           </font></font><code class="literal">COMMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前版本的MySQL中使用的。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串包含连接到包含将用于物理存储数据的表的远程服务器所需的信息。</font><font style="vertical-align: inherit;">连接字符串指定服务器名称，登录凭据，端口号和数据库/表信息。</font><font style="vertical-align: inherit;">在该示例中，远程表位于服务器上</font></font><code class="literal">remote_host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用端口9306.名称和端口号应与要用作远程表的远程MySQL服务器实例的主机名（或IP地址）和端口号相匹配。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        连接字符串的格式如下所示：
      </font></font></p><pre data-lang="none" class="programlisting"><em class="replaceable"><code>scheme</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：// </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[：</font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] @ </font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[：</font></font><em class="replaceable"><code>port_num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font><em class="replaceable"><code>tbl_name</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        哪里：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <em class="replaceable"><code>scheme</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：一个公认的连接协议。</font><font style="vertical-align: inherit;">此时仅</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持该
             </font></font><em class="replaceable"><code>scheme</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。
          </font></font></p></li><li class="listitem"><p>
            <em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：连接的用户名称。</font><font style="vertical-align: inherit;">此用户必须已经在远程服务器上创建，并且必须具有适当的特权来执行所需的操作（</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在远程表，等等）。
          </font></font></p></li><li class="listitem"><p>
            <em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:(可选）相应的密码
             </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：远程服务器的主机名或IP地址。
          </font></font></p></li><li class="listitem"><p>
            <em class="replaceable"><code>port_num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:(可选）远程服务器的端口号。</font><font style="vertical-align: inherit;">默认值是3306。
          </font></font></p></li><li class="listitem"><p>
            <em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：持有远程表的数据库的名称。
          </font></font></p></li><li class="listitem"><p>
            <em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：远程表的名称。</font><font style="vertical-align: inherit;">本地和远程表的名称不必匹配。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        示例连接字符串：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONNECTION = 'mysql的：//用户名：密码@主机名：端口/数据库/表名'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CONNECTION = 'mysql的：//用户名@主机名/数据库/表名'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CONNECTION = 'mysql的：//用户名：密码@主机名/数据库/表名'</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="federated-create-server"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.2.2使用CREATE SERVER创建FEDERATED表</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果要</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在同一台服务器上</font><font style="vertical-align: inherit;">创建多个</font><font style="vertical-align: inherit;">表，或者要简化创建</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的过程</font><font style="vertical-align: inherit;">，则可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来定义服务器连接参数，就像使用</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串一样。
      </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        声明</font><font style="vertical-align: inherit;">
        的格式</font><font style="vertical-align: inherit;">是：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE SERVER
 </font></font><em class="replaceable"><code>server_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FOREIGN DATA WRAPPER </font></font><em class="replaceable"><code>wrapper_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPTIONS（</font></font><em class="replaceable"><code>option</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>option</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...）</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        将</font></font><em class="replaceable"><code>server_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个新的时，在连接字符串中使用的
         </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        例如，要创建与</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font><font style="vertical-align: inherit;">相同的服务器连接
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONNECTION = '的MySQL：// fed_user @ REMOTE_HOST：9306 /联合/ TEST_TABLE';</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        你会使用下面的语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE SERVER fedlink</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FOREIGN DATA WRAPPER mysql</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPTIONS（USER'fed_user'，HOST'remote_host'，PORT 9306，DATABASE'federated'）;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要创建</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此连接</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表，您仍然使用</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        关键字，但指定您在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">使用的名称
         </font><font style="vertical-align: inherit;">。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE test_table（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT（20）NOT NULL AUTO_INCREMENT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    name VARCHAR（32）NOT NULL DEFAULT''，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    其他INT（20）NOT NULL DEFAULT'0'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（id），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INDEX名称（名称），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INDEX other_key（其他）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENGINE = FEDERATED</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DEFAULT CHARSET = latin1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CONNECTION = 'FEDLINK / TEST_TABLE';</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此示例中的连接名称包含连接的名称（</font></font><code class="literal">fedlink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和</font></font><code class="literal">test_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要链接到</font><font style="vertical-align: inherit;">的表（（</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的名称</font><font style="vertical-align: inherit;">，用斜杠分隔。</font><font style="vertical-align: inherit;">如果只指定没有表名的连接名称，则使用本地表的表名。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关更多信息</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE
        SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.17节“CREATE SERVER语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句接受与</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        字符串</font><font style="vertical-align: inherit;">相同的参数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句更新</font></font><code class="literal">mysql.servers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的行
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关连接字符串中的参数，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE
        SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中的</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">和表中的列
         </font><font style="vertical-align: inherit;">之间的对应关系的信息，请参</font></font><code class="literal">mysql.servers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">见下表。</font><font style="vertical-align: inherit;">作为参考，</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font><font style="vertical-align: inherit;">的格式</font><font style="vertical-align: inherit;">如下所示：
      </font></font></p><pre data-lang="none" class="programlisting"><em class="replaceable"><code>scheme</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：// </font></font><em class="replaceable"><code>user_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[：</font></font><em class="replaceable"><code>password</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] @ </font></font><em class="replaceable"><code>host_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[：</font></font><em class="replaceable"><code>port_num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><em class="replaceable"><code>db_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font><em class="replaceable"><code>tbl_name</code></em>
</pre>
<div class="informaltable">
<table summary="The correspondence between parameters in a connection string, options in the CREATE SERVER statement, and the columns in the mysql.servers table."><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
            <th scope="col"><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 串</font></font></th>
            <th scope="col"><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 选项</font></font></th>
            <th scope="col"><code class="literal">mysql.servers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 柱</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接方案</font></font></td>
            <td><em class="replaceable"><code>scheme</code></em></td>
            <td><code class="literal">wrapper_name</code></td>
            <td><code class="literal">Wrapper</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程用户</font></font></td>
            <td><em class="replaceable"><code>user_name</code></em></td>
            <td><code class="literal">USER</code></td>
            <td><code class="literal">Username</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程密码</font></font></td>
            <td><em class="replaceable"><code>password</code></em></td>
            <td><code class="literal">PASSWORD</code></td>
            <td><code class="literal">Password</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程主机</font></font></td>
            <td><em class="replaceable"><code>host_name</code></em></td>
            <td><code class="literal">HOST</code></td>
            <td><code class="literal">Host</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程端口</font></font></td>
            <td><em class="replaceable"><code>port_num</code></em></td>
            <td><code class="literal">PORT</code></td>
            <td><code class="literal">Port</code></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程数据库</font></font></td>
            <td><em class="replaceable"><code>db_name</code></em></td>
            <td><code class="literal">DATABASE</code></td>
            <td><code class="literal">Db</code></td>
</tr></tbody></table>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="federated-usagenotes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.3联邦存储引擎注释和提示</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">时应注意以下几点
       </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表可能会复制到其他从服务器，但您必须确保从服务器能够使用</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串（或</font></font><code class="literal">mysql.servers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的行）中
           </font><font style="vertical-align: inherit;">定义的用户/密码组合
           </font><font style="vertical-align: inherit;">连接到远程服务器。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下各项表示
       </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎支持和不支持的功能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          远程服务器必须是MySQL服务器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在尝试通过</font><font style="vertical-align: inherit;">
          表</font><font style="vertical-align: inherit;">访问表之前</font><font style="vertical-align: inherit;">
          ，</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表指向</font><font style="vertical-align: inherit;">的远程表</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一张</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">桌子</font><font style="vertical-align: inherit;">可能</font><font style="vertical-align: inherit;">指向另一张桌子，但您必须小心不要造成一个循环。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一张</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表不支持通常意义上的索引; </font><font style="vertical-align: inherit;">因为对表数据的访问是远程处理的，所以它实际上是利用索引的远程表。</font><font style="vertical-align: inherit;">这意味着，对于无法使用任何索引并因此需要全表扫描的查询，服务器将从远程表中提取所有行并在本地进行过滤。</font><font style="vertical-align: inherit;">无论这种情况如何，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与本</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明一起</font><font style="vertical-align: inherit;">使用，</font><font style="vertical-align: inherit;">都会发生此情况
          </font><font style="vertical-align: inherit;">这些子句在本地应用于返回的行。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不能使用索引的查询可能会导致性能下降和网络过载。</font><font style="vertical-align: inherit;">另外，由于返回的行必须存储在内存中，所以这样的查询也可能导致本地服务器交换，甚至挂起。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          创建</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">时应小心，
           </font><font style="vertical-align: inherit;">因为</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能不支持</font><font style="vertical-align: inherit;">来自等效</font><font style="vertical-align: inherit;">表或其他表</font><font style="vertical-align: inherit;">的索引定义</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，在创建一个
           </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表与索引前缀
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列将失败。</font><font style="vertical-align: inherit;">以下定义</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是有效的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE`T1`（`A` VARCHAR（100），UNIQUE KEY（`A`（30）））ENGINE = MYISAM;</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本例中的关键字前缀与</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">不兼容，
           </font><font style="vertical-align: inherit;">等效语句将失败：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE`T1`（`A` VARCHAR（100），UNIQUE KEY（`A`（30）））ENGINE = FEDERATED</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  CONNECTION = 'MYSQL：//127.0.0.1：3306 / TEST / T1';</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果可能，在远程服务器和本地服务器上创建表时，应该尝试分离列和索引定义以避免这些索引问题。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在内部，实现使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但不会
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#handler" title="13.2.4 HANDLER语法"><code class="literal">HANDLER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎支持
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和索引。</font><font style="vertical-align: inherit;">它不支持</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或任何直接影响表的结构的数据定义语言语句，而不是
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当前的实现不使用预准备语句。

          
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-on-duplicate" title="13.2.5.2 INSERT ... ON DUPLICATE KEY UPDATE语法"><code class="literal">INSERT
          ... ON DUPLICATE KEY UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，但是如果发生重复键冲突，语句会失败并显示错误。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          事务不受支持。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行批量插入处理，以便将多行发送到批处理中的远程表，从而提高性能。</font><font style="vertical-align: inherit;">另外，如果远程表是事务性的，则它会使远程存储引擎在发生错误时正确执行语句回滚。</font><font style="vertical-align: inherit;">此功能具有以下限制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              插入的大小不能超过服务器之间的最大数据包大小。</font><font style="vertical-align: inherit;">如果插入超过此大小，则会将其分解为多个数据包，并且可能会发生回滚问题。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              批量插入处理不会发生
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-on-duplicate" title="13.2.5.2 INSERT ... ON DUPLICATE KEY UPDATE语法"><code class="literal">INSERT
              ... ON DUPLICATE KEY UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有没有办法让</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎知道，如果远程表已经改变。</font><font style="vertical-align: inherit;">原因是这个表必须像一个数据文件一样工作，这个数据文件永远不会被数据库系统之外的任何东西写入。</font><font style="vertical-align: inherit;">如果远程数据库发生任何更改，则可能会破坏本地表中数据的完整性。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><code class="literal">CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串时，不能在密码中使用“@”字符。</font><font style="vertical-align: inherit;">您可以通过使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE
          SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句创建服务器连接来</font><font style="vertical-align: inherit;">绕过此限制</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_insert_id"><code class="literal">insert_id</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_timestamp"><code class="literal">timestamp</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项都不会传播到数据提供者。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">发布的</font><font style="vertical-align: inherit;">
          任何</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">只会删除本地表，而不会删除远程表。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 表格不适用于查询缓存。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用户定义的分区不支持
           </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="federated-storage-engine-resources"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.8.4 FEDERATED存储引擎资源</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下附加资源可用于
       </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><a class="ulink" href="http://forums.mysql.com/list.php?105" target="_top"><font style="vertical-align: inherit;">http://forums.mysql.com/list.php?105</font></a></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上提供了</font><font style="vertical-align: inherit;">
          专用于</font><font style="vertical-align: inherit;">存储引擎的
           </font><font style="vertical-align: inherit;">论坛</font><font style="vertical-align: inherit;">。
</font></font><a class="ulink" href="http://forums.mysql.com/list.php?105" target="_top"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="example-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.9示例存储引擎</font></font></h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140528034846976"></a><a class="indexterm" name="idm140528034845936"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">EXAMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎是一个存根引擎，什么都不做。</font><font style="vertical-align: inherit;">其目的是作为示例说明如何开始编写新的存储引擎的MySQL源代码。</font><font style="vertical-align: inherit;">因此，开发人员主要关心这一点。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要从</font></font><code class="literal">EXAMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码构建MySQL时</font><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">存储引擎，请</font><font style="vertical-align: inherit;">使用该
     </font><font style="vertical-align: inherit;">
    选项</font><font style="vertical-align: inherit;">调用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMake</font></font></strong></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_storage_engine_options" title="存储引擎选项"><code class="option">-DWITH_EXAMPLE_STORAGE_ENGINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要检查</font></font><code class="literal">EXAMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎</font><font style="vertical-align: inherit;">的源代码</font><font style="vertical-align: inherit;">，请查看</font></font><code class="filename">storage/example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL源代码分发</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">目录。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    当您创建</font></font><code class="literal">EXAMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时，服务器会在数据库目录中创建一个表格格式文件。</font><font style="vertical-align: inherit;">该文件以表名称开始并具有</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    扩展名。</font><font style="vertical-align: inherit;">没有其他文件被创建。</font><font style="vertical-align: inherit;">没有数据可以存储到表中。</font><font style="vertical-align: inherit;">检索返回空结果。
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE test (i INT) ENGINE = EXAMPLE;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.78秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO test VALUES(1),(2),(3);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1031（HY000）：'test'的表存储引擎不会»</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    有这个选项</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM test;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.31秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    该</font></font><code class="literal">EXAMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎不支持索引。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="storage-engines-other"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.10其他存储引擎</font></font></h2>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      其他存储引擎可能来自使用自定义存储引擎界面的第三方和社区成员。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL不支持第三方引擎。</font><font style="vertical-align: inherit;">有关更多信息，文档，安装指南，错误报告或任何有关这些引擎的帮助或协助，请直接联系引擎开发人员。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关开发可与可插拔存储引擎架构一起使用的客户存储引擎的更多信息，请参阅
       </font></font><a class="ulink" href="http://dev.mysql.com/doc/internals/en/custom-engine.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL内部：编写自定义存储引擎</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="pluggable-storage-overview"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.11 MySQL存储引擎架构概述</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#pluggable-storage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.11.1可插拔存储引擎架构</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/storage-engines.html#pluggable-storage-common-layer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.11.2公用数据库服务器层</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL可插拔存储引擎架构使数据库专业人员能够针对特定应用需求选择专用存储引擎，同时完全屏蔽了管理任何特定应用编码要求的需求。</font><font style="vertical-align: inherit;">MySQL服务器体系结构将应用程序员和DBA与存储级别的所有低级实施细节隔离开来，提供一致且简单的应用程序模型和API。</font><font style="vertical-align: inherit;">因此，虽然跨不同存储引擎有不同的功能，但应用程序不受这些差异的影响。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可插拔存储引擎架构提供了一套标准的管理和支持服务，这些服务在所有底层存储引擎中都很常见。</font><font style="vertical-align: inherit;">存储引擎本身是数据库服务器的组件，它们实际上在物理服务器级别维护的底层数据上执行操作。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这种高效的模块化体系结构为那些希望专门针对特定应用需求（如数据仓库，事务处理或高可用性情况）的用户提供了巨大的好处，同时享受利用独立于任何一个接口和服务的优势存储引擎。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      应用程序员和DBA通过连接器API和位于存储引擎之上的服务层与MySQL数据库进行交互。</font><font style="vertical-align: inherit;">如果应用程序更改带来了需求底层存储引擎更改的需求，或者添加了一个或多个存储引擎以支持新需求，则不需要进行重大编码或流程更改即可使事情顺利进行。</font><font style="vertical-align: inherit;">MySQL服务器体系结构通过提供适用于存储引擎的一致且易于使用的API来将应用程序从存储引擎的底层复杂性中屏蔽出来。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="pluggable-storage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.11.1可插拔存储引擎架构</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL服务器使用可插拔的存储引擎架构，使存储引擎能够从正在运行的MySQL服务器中加载和卸载。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入存储引擎</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在可以使用存储引擎之前，必须使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">将存储引擎插件共享库加载到MySQL中
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，如果</font></font><code class="literal">EXAMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引擎插件已命名</font></font><code class="literal">example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且共享库已命名
         </font></font><code class="filename">ha_example.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则使用以下语句加载它：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL插件示例SONAME'ha_example.so';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要安装可插入的存储引擎，插件文件必须位于MySQL插件目录中，并且发布该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的用户
         </font><font style="vertical-align: inherit;">必须具有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="literal">mysql.plugin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">特权
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        共享库必须位于MySQL服务器插件目录中，其位置由
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量提供。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拔下存储引擎</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要拔下存储引擎，请使用以下
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNINSTALL插件示例;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您拔下现有表所需的存储引擎，则这些表将变得无法访问，但仍将存在于磁盘上（如果适用）。</font><font style="vertical-align: inherit;">拔下存储引擎之前，请确保没有使用存储引擎的表格。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="pluggable-storage-common-layer"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.11.2公用数据库服务器层</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL可插拔存储引擎是MySQL数据库服务器中的组件，负责为数据库执行实际的数据I / O操作，以及启用和强制执行针对特定应用程序需求的某些功能集。</font><font style="vertical-align: inherit;">使用特定存储引擎的一个主要好处是您只能交付特定应用程序所需的功能，因此数据库中的系统开销较小，最终结果是效率更高，数据库性能更高。</font><font style="vertical-align: inherit;">这是MySQL一直被认为具有如此高性能，匹配或殴打行业标准基准测试中专有单一数据库的原因之一。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从技术角度来看，存储引擎中的一些独特的支持基础架构组件是什么？</font><font style="vertical-align: inherit;">一些主要特征差异包括：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并发性</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：某些应用程序比其他应用程序具有更多粒度锁定要求（例如行级锁定）。</font><font style="vertical-align: inherit;">选择正确的锁定策略可以减少开销，从而提高整体性能。</font><font style="vertical-align: inherit;">此区域还包括对多版本并发控制或</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快照</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            读取等功能的支持。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务支持</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：并非每个应用程序都需要事务处理，但对于那些需要事务处理的应用程序，有非常明确的需求，例如ACID合规性等。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用完整性</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：需要服务器通过DDL定义的外键强制执行关系数据库参照完整性。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理存储</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这涉及表格和索引的整个页面大小以及用于将数据存储到物理磁盘的格式。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引支持</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：不同的应用场景倾向于受益于不同的索引策略。</font><font style="vertical-align: inherit;">每个存储引擎通常都有自己的索引方法，尽管一些（如B树索引）几乎是所有引擎都通用的。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存缓存</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：不同的应用程序对某些内存缓存策略的反应比其他应用程序更好，因此尽管某些内存缓存对于所有存储引擎（例如用于用户连接或MySQL高速查询缓存的缓存）都是通用的，但其他内存缓存仅在特定的存储引擎正在发挥作用。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能辅助</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这包括用于并行操作的多个I / O线程，线程并发性，数据库检查点设置，批量插入处理等。
          </font></font></p></li><li class="listitem"><p>
            <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他目标功能</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这可能包括对地理空间操作的支持，对某些数据操作操作的安全限制以及其他类似功能。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每一组可插拔存储引擎基础架构组件都旨在为特定应用程序提供一组选择性的好处。</font><font style="vertical-align: inherit;">相反，避免一组组件功能有助于减少不必要的开销。</font><font style="vertical-align: inherit;">理解特定应用程序的需求并选择合适的MySQL存储引擎可以对整体系统效率和性能产生巨大影响。
</font></font></p>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tbody><tr>
<td width="40%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/innodb-storage-engine.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a></td>
<td width="20%" align="center"><a accesskey="u" href="/mysql-5.7-google-zh/storage-engines.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向上</font></font></a></td>
<td width="40%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/replication.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14章InnoDB存储引擎</font></font></td>
<td width="20%" align="center"><a accesskey="h" href="/mysql-5.7-google-zh/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家</font></font></a></td>
<td width="40%" align="right" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16章复制</font></font></td>
</tr>
</tbody></table>
</div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./images/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>