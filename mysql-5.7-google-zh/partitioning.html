<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>第22章分区</title>
<link rel="stylesheet" href="./images/mvl.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
<link rel="start" href="/mysql-5.7-google-zh/index.html" title="{书名}">
<link rel="up" href="/mysql-5.7-google-zh/partitioning.html" title="">
<link rel="prev" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6">
<link rel="next" href="/mysql-5.7-google-zh/stored-programs-views.html" title="第23章存储程序和视图">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./images/translateelement.css"></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tbody><tr>
<th colspan="3" align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22章分区</font></font></th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/mysql-cluster.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a>&nbsp;</td>
<th width="60%" align="center"></th>
<td width="20%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/stored-programs-views.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
</tbody></table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="partitioning"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22章分区</font></font></h1>

</div>

</div>

</div>
<div class="toc">
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></b></p><dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-overview"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.1 MySQL中的分区概述</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2分区类型</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-range"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.1范围分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-list"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.2列表分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.3列分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-hash"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.4 HASH分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-key"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.5密钥分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-subpartitions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.6子分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-handling-nulls"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.7 MySQL分区如何处理NULL</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-management"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3分区管理</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-range-list"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.1范围和列表分区的管理</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-hash-key"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.2 HASH和密钥分区的管理</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-exchange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.3与表交换分区和子分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-maintenance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.4分区维护</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.5获取有关分区的信息</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.4分区修剪</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-selection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.5分区选择</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6分区的限制和限制</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.1分区键，主键和唯一键</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-storage-engines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.2有关存储引擎的分区限制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.3与功能相关的分区限制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.4分区和锁定</font></font></a></span></dt></dl></dd></dl>
</div>
<a class="indexterm" name="idm140527983835472"></a><a class="indexterm" name="idm140527983834400"></a><a class="indexterm" name="idm140527983833328"></a><a class="indexterm" name="idm140527983831840"></a><a class="indexterm" name="idm140527983830352"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本章讨论MySQL的</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义分区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的实现
     </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      从MySQL 5.7.17开始，MySQL服务器中的通用分区处理程序已被弃用，并且在用于给定表的存储引擎需要提供其自己的（</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）分区处理程序</font><font style="vertical-align: inherit;">时，将在MySQL 8.0中删除</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">目前，只有</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎做到这一点。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用带有非本地分区的表格会导致
       </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_warn_deprecated_syntax"><code class="literal">ER_WARN_DEPRECATED_SYNTAX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告。</font><font style="vertical-align: inherit;">在MySQL 5.7.17到5.7.20中，服务器在启动时会自动执行检查以识别使用非本地分区的表; </font><font style="vertical-align: inherit;">对于找到的任何内容，服务器会将消息写入其错误日志。</font><font style="vertical-align: inherit;">要禁用此检查，请使用该
       </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_disable-partition-engine-check"><code class="option">--disable-partition-engine-check</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      选项。</font><font style="vertical-align: inherit;">在MySQL 5.7.21及更高版本中，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">此检查
       </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在这些版本中，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_disable-partition-engine-check"><code class="option">--disable-partition-engine-check=false</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果希望服务器使用通用分区处理程序检查表（错误＃85830，错误＃25846957），则</font><font style="vertical-align: inherit;">必须启动服务器
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了准备迁移到MySQL 8.0，任何具有非本地分区的表都应该改为使用提供本地分区的引擎，或者将其设置为非分区。</font><font style="vertical-align: inherit;">例如，要将表更改为</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请执行以下语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE </font></font><em class="replaceable"><code>table_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENGINE = INNODB;
</font></font></pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    您可以通过检查</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-plugins" title="13.7.5.25 SHOW PLUGINS语法"><code class="literal">SHOW
    PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的输出来确定您的MySQL服务器是否支持分区</font><font style="vertical-align: inherit;">，如下所示：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW PLUGINS;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------- + ---------------- + -------- -  + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">名称| </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">类型| </font><font style="vertical-align: inherit;">图书馆| </font><font style="vertical-align: inherit;">许可证|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------- + ---------------- + -------- -  + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">binlog | </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font>
<span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">分区| </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font></strong></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">存档| </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">黑洞| </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CSV | </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">FEDERATED | </font><font style="vertical-align: inherit;">禁用| </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MEMORY | </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">InnoDB | </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MRG_MYISAM | </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MyISAM | </font><font style="vertical-align: inherit;">ACTIVE | </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ndbcluster | </font><font style="vertical-align: inherit;">禁用| </font><font style="vertical-align: inherit;">存储引擎| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">GPL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------- + ---------------- + -------- -  + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一套11行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    您也可以</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#plugins-table" title="24.16 INFORMATION_SCHEMA插件表"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用与此类似的查询来</font><font style="vertical-align: inherit;">检查
     </font><font style="vertical-align: inherit;">表格：
  </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PLUGIN_NAME as Name,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PLUGIN_VERSION as Version,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PLUGIN_STATUS as Status</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>WHERE PLUGIN_TYPE='STORAGE ENGINE';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">名称| </font><font style="vertical-align: inherit;">版本| </font><font style="vertical-align: inherit;">状态|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">binlog | </font><font style="vertical-align: inherit;">1.0 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CSV | </font><font style="vertical-align: inherit;">1.0 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MEMORY | </font><font style="vertical-align: inherit;">1.0 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MRG_MYISAM | </font><font style="vertical-align: inherit;">1.0 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MyISAM | </font><font style="vertical-align: inherit;">1.0 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PERFORMANCE_SCHEMA | </font><font style="vertical-align: inherit;">0.1 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">黑洞| </font><font style="vertical-align: inherit;">1.0 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">存档| </font><font style="vertical-align: inherit;">3.0 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">InnoDB | </font><font style="vertical-align: inherit;">5.7 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font><font></font>
<span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">分区| </font><font style="vertical-align: inherit;">1.0 | </font><font style="vertical-align: inherit;">ACTIVE |</font></font></strong></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------------- + --------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
整套10行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    无论哪种情况，如果您没有</font><font style="vertical-align: inherit;">在输出中</font><font style="vertical-align: inherit;">看到</font><font style="vertical-align: inherit;">列中列</font></font><code class="literal">partition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    值为</font></font><code class="literal">ACTIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该
     </font></font><code class="literal">Status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">插件</font><font style="vertical-align: inherit;">（在每个示例中以粗体显示），那么您的MySQL版本不是用分区支持构建的。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Oracle提供的MySQL 5.7社区二进制文件包含分区支持。</font><font style="vertical-align: inherit;">有关MySQL企业版二进制文件中提供的分区支持的信息，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-enterprise.html" title="第29章MySQL企业版"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第29章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL企业版</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    要从源代码编译MySQL 5.7启用分区，必须使用该</font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_storage_engine_options" title="存储引擎选项"><code class="option">-DWITH_PARTITION_STORAGE_ENGINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    选项</font><font style="vertical-align: inherit;">配置构建
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#source-installation" title="2.9从源代码安装MySQL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.9节“从源代码安装MySQL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    如果您的MySQL二进制文件是使用分区支持构建的，则不需要做任何事情来启用它（例如，文件中不需要特殊条目</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    如果您想禁用分区支持，您可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-partition"><code class="option">--skip-partition</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    选项</font><font style="vertical-align: inherit;">启动MySQL服务器</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当禁用分区支持时，您可以看到任何现有的分区表并将其删除（尽管不建议这样做），但您无法操作它们或访问其数据。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关</font><font style="vertical-align: inherit;">分区和分区概念的介绍，</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-overview" title="22.1 MySQL中的分区概述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.1节“MySQL中的分区概述”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL支持几种类型的分区和子分区; </font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-types" title="22.2分区类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2节“分区类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
     </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-subpartitions" title="22.2.6子分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.6节</font></font></a><font style="vertical-align: inherit;"><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-types" title="22.2分区类型"><font style="vertical-align: inherit;">“子分区</font></a><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-subpartitions" title="22.2.6子分区"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">。
  </font></font></p><p>
    <a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management" title="22.3分区管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3节“分区管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍了在现有分区表中添加，删除和更改分区的方法。
  </font></font></p><p>
    <a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-maintenance" title="22.3.4分区维护"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3.4节“维护分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论了与分区表一起使用的表维护命令。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">
    的</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表
     </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供有关分区和分区表的信息。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息，</font><font style="vertical-align: inherit;">请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第24.15节“INFORMATION_SCHEMA分区表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关此表的查询的一些示例，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-handling-nulls" title="22.2.7 MySQL分区如何处理NULL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.7节“MySQL分区如何处理NULL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    有关MySQL 5.7中分区的已知问题，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations" title="22.6分区的限制和限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.6节“分区的限制和限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    使用分区表时，您还可能会发现以下资源非常有用。
  </font></font></p><a class="indexterm" name="idm140527983781216"></a><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他资源。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关MySQL中用户定义分区的其他信息来源包括以下内容：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="ulink" href="http://forums.mysql.com/list.php?106" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL分区论坛</font></font></a>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这是针对那些对MySQL分区技术感兴趣或者正在尝试使用MySQL的官方讨论论坛。</font><font style="vertical-align: inherit;">它具有MySQL开发人员和其他人的公告和更新。</font><font style="vertical-align: inherit;">它由分区开发和文档团队的成员进行监控。
      </font></font></p></li><li class="listitem"><p>
        <a class="ulink" href="http://mikaelronstrom.blogspot.com/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MikaelRonström的博客</font></font></a>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL分区架构师和首席开发人员MikaelRonström经常在这里发表文章，介绍他在MySQL分区和NDB集群方面的工作。
      </font></font></p></li><li class="listitem"><p>
        <a class="ulink" href="http://www.planetmysql.org/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlanetMySQL</font></font></a>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一个以MySQL相关博客为特色的MySQL新闻网站，任何使用我的MySQL的人都应该对此感兴趣。</font><font style="vertical-align: inherit;">我们鼓励您在此查看与使用MySQL分区的人员保持联系的博客链接，或者将自己的博客添加到所涵盖的博客中。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL 5.7二进制文件可从
     </font></font><a class="ulink" href="http://dev.mysql.com/downloads/mysql/5.7.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://dev.mysql.com/downloads/mysql/5.7.html获得</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，对于最新的分区错误修复和功能添加，您可以从我们的GitHub存储库获取源代码。</font><font style="vertical-align: inherit;">要启用分区，必须使用该</font></font><a class="link" href="/mysql-5.7-google-zh/installing.html#option_cmake_storage_engine_options" title="存储引擎选项"><code class="option">-DWITH_PARTITION_STORAGE_ENGINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    选项</font><font style="vertical-align: inherit;">配置构建
     </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关构建MySQL的更多信息，请参见
     </font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#source-installation" title="2.9从源代码安装MySQL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.9节“从源代码安装MySQL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您在编译启用分区的MySQL 5.7版本时遇到问题，请检查</font></font><a class="ulink" href="http://forums.mysql.com/list.php?106" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL分区论坛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果您没有找到已发布问题的解决方案，请向其寻求帮助。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="partitioning-overview"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.1 MySQL中的分区概述</font></font></h2>
</div>
</div>
</div>
<a class="indexterm" name="idm140527983766448"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节概述MySQL 5.7中的分区。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关分区限制和功能限制的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations" title="22.6分区的限制和限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.6节“分区的限制和限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      SQL标准没有提供很多有关数据存储物理方面的指导。</font><font style="vertical-align: inherit;">SQL语言本身旨在独立于其工作的模式，表格，行或列的任何数据结构或媒体。</font><font style="vertical-align: inherit;">尽管如此，大多数高级数据库管理系统已经发展出一些确定用于存储文件系统，硬件甚至两者的特定数据片段的物理位置的手段。</font><font style="vertical-align: inherit;">在MySQL中，
       </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎长期以来一直支持表空间的概念，即使在引入分区之前，MySQL服务器也可以配置为使用不同的物理目录来存储不同的数据库（请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#symbolic-links" title="8.12.3使用符号链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.12.3节“使用符号链接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，解释如何完成这一操作）。
    </font></font></p><p>
      <span class="firstterm"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使您能够根据您可以根据需要大体设置的规则，跨文件系统分发单个表的各个部分，</font><span class="firstterm"><font style="vertical-align: inherit;">分区</font></span><font style="vertical-align: inherit;">使这一概念更进一步。</font><font style="vertical-align: inherit;">实际上，表格的不同部分作为分开的表格存储在不同的位置。</font><font style="vertical-align: inherit;">数据分割完成的用户选择规则称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区功能</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它在MySQL中可以是模数，与一组范围或值列表简单匹配，内部哈希函数或线性哈希函数。</font><font style="vertical-align: inherit;">该功能根据用户指定的分区类型进行选择，并将用户提供的表达式的值作为其参数。</font><font style="vertical-align: inherit;">此表达式可以是列值，作用于一个或多个列值的函数，也可以是一组一列或多列值，具体取决于所使用的分区类型。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在的情况下</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和[ </font></font><code class="literal">LINEAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      分区，分区列的值被传递给分区函数，它返回表示其中特定记录应当被存储的分区的数目的整数值。</font><font style="vertical-align: inherit;">这个函数必须是非恒定且非随机的。</font><font style="vertical-align: inherit;">它可能不包含任何查询，但可以使用在MySQL中有效的SQL表达式，只要该表达式返回一个</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或一个整数，
       </font></font><em class="replaceable"><code>intval</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如
    </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-MAXVALUE &lt;= </font></font><em class="replaceable"><code>intval</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;= MAXVALUE
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      （</font></font><code class="literal">MAXVALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于表示所讨论整数类型的最小上界，
       </font></font><code class="literal">-MAXVALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示最大下界。）
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于[ </font></font><code class="literal">LINEAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">LIST
      COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区，分区表达式由一列或多列组成。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于[ </font></font><code class="literal">LINEAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      分区，分区功能由MySQL提供。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关允许的分区列类型和分区函数的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-types" title="22.2分区类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2节“分区类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中提供了分区语法描述和其他示例。</font><font style="vertical-align: inherit;">有关分区函数限制的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-functions" title="22.6.3与功能相关的分区限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.6.3节“关于函数的分区限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这被称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水平分区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 也就是说，表的不同行可以被分配给不同的物理分区。</font><font style="vertical-align: inherit;">MySQL 5.7不支持
       </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">垂直分区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即将不同的列分配给不同的物理分区。</font><font style="vertical-align: inherit;">目前还没有计划在MySQL中引入垂直分区。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关确定您的MySQL服务器二进制文件是否支持用户定义的分区的信息，请参阅
       </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html" title="第22章分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为了创建分区表，您可以使用MySQL服务器支持的大多数存储引擎; </font><font style="vertical-align: inherit;">MySQL分区引擎在单独的层中运行，并可以与其中任何一个进行交互。</font><font style="vertical-align: inherit;">在MySQL 5.7中，同一分区表的所有分区必须使用相同的存储引擎; </font><font style="vertical-align: inherit;">例如，您不能使用</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个分区和</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个</font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，没有什么能够阻止您在同一个MySQL服务器上甚至在同一个数据库中为不同的分区表使用不同的存储引擎。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL分区不能与使用
       </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      分区由</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">LINEAR
      KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以与</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但其他类型的用户定义的划分不支持使用该存储引擎的表。</font><font style="vertical-align: inherit;">另外，</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户定义的分区</font><font style="vertical-align: inherit;">的
       </font><font style="vertical-align: inherit;">表必须具有明确的主键，并且表的分区表达式中引用的所有列必须是主键的一部分。</font><font style="vertical-align: inherit;">但是，如果在</font><font style="vertical-align: inherit;">用于创建或修改用户分区</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">or
       </font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font></font><code class="literal">PARTITION BY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">PARTITION BY
      LINEAR KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">没有列出列
       </font><font style="vertical-align: inherit;">，则表不需要具有明确的主键。</font><font style="vertical-align: inherit;">有关更多信息，请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-limitations-syntax" title="21.1.6.1在NDB集群中不符合SQL语法"><font style="vertical-align: inherit;">第21.1.6.1节“NDB集群中的SQL语法不符合”</font></a><font style="vertical-align: inherit;">。
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
      TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
      TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-limitations-syntax" title="21.1.6.1在NDB集群中不符合SQL语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要使用特定的存储引擎，分区表，它仅需要使用</font></font><code class="literal">[STORAGE] ENGINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      选项就像你的分区表。</font><font style="vertical-align: inherit;">然而，你应该记住，</font></font><code class="literal">[STORAGE] ENGINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（和其他的表选项）必须上市</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
      在使用的任何分区选项</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
      TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。</font><font style="vertical-align: inherit;">此示例显示如何创建一个通过散列分区为6个分区并使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的表：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ti（id INT，金额DECIMAL（7,2），tr_date DATE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ENGINE = INNODB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION BY HASH（MONTH（tr_date））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区6;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句都可以包含一个
       </font></font><code class="literal">[STORAGE] ENGINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，但在MySQL 5.7中没有任何作用。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区适用于表的所有数据和索引; </font><font style="vertical-align: inherit;">你不能只分区数据而不是索引，反之亦然，也不能只分区表的一部分。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可以使用</font><font style="vertical-align: inherit;">用于创建分区表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句
       </font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">INDEX DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
       </font><font style="vertical-align: inherit;">将每个分区的数据和索引分配给特定的目录</font><font style="vertical-align: inherit;">。
    </font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"></font></p><p>
      <code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="literal">INDEX
      DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows上的</font><font style="vertical-align: inherit;">单个分区或</font><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">子分区</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它们支持单个分区和</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">子分区
       </font><font style="vertical-align: inherit;">（如在所有平台上）。
    </font></font></p><a class="indexterm" name="idm140527983706592"></a><a class="indexterm" name="idm140527983705104"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      表的分区表达式中使用的所有列必须是表中每个唯一键的一部分，包括任何主键。</font><font style="vertical-align: inherit;">这意味着由以下SQL语句创建的表（如下面的表）不能分区：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE tnp（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL AUTO_INCREMENT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ref BIGINT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    名称VARCHAR（255），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY PK（ID），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    UNIQUE KEY英国（名字）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      由于密钥</font></font><code class="literal">pk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">uk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      没有共同的列，所以在分区表达式中没有可用的列。</font><font style="vertical-align: inherit;">在这种情况下可能的解决方法包括将</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到表的主键，添加</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font><code class="literal">uk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或完全删除唯一键。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys" title="22.6.1分区键，主键和唯一键"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys" title="22.6.1分区键，主键和唯一键"><font style="vertical-align: inherit;">第22.6.1节“分区键，主键和唯一键”</font></a><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      另外，</font></font><code class="literal">MAX_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">MIN_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可被用于确定行，分别的最大和最小数字，可以被存储在每个分区中。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">这些选项的更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management" title="22.3分区管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management" title="22.3分区管理"><font style="vertical-align: inherit;">第22.3节“分区管理”</font></a><font style="vertical-align: inherit;">。
    </font></font></p><a class="indexterm" name="idm140527983694176"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><code class="literal">MAX_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项对于创建具有额外分区的NDB簇表也很有用，因此可以更好地存储散列索引。</font><font style="vertical-align: inherit;">有关详细信息，请参阅</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html#ndbparam-ndbd-datamemory"><code class="literal">DataMemory</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据节点配置参数以及
       </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-nodes-groups" title="21.1.2 NDB群集节点，节点组，副本和分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21.1.2节“NDB群集节点，节点组，副本和分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的文档
       </font><font style="vertical-align: inherit;">。
    </font></font></p><a class="indexterm" name="idm140527983689392"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这里列出了分区的一些优点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分区可以在一个表中存储比单个磁盘或文件系统分区上的数据更多的数据。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过删除仅包含该数据的分区（或多个分区），通常可以轻松地从分区表中删除失去其有用性的数据。</font><font style="vertical-align: inherit;">相反，添加新数据的过程在某些情况下可以通过添加一个或多个新分区来专门存储该数据而大大方便。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          由于满足给定</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的数据只能存储在一个或多个分区上，因此可自动排除搜索中剩余的​​分区，</font><font style="vertical-align: inherit;">因此可以大大优化某些查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于可以在创建分区表后更改分区，因此可以重新组织数据以增强频繁查询，这些查询在首次设置分区方案时可能并不经常使用。</font><font style="vertical-align: inherit;">这种排除不匹配的分区（以及它们包含的任何行）的功能通常称为
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区修剪</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning" title="22.4分区修剪"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.4节“分区修剪”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另外，MySQL 5.7支持查询显式分区选择。</font><font style="vertical-align: inherit;">例如，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT * FROM t
          PARTITION (p0,p1) WHERE c &lt; 5</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在分区仅选择那些行</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该匹配</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          条件。</font><font style="vertical-align: inherit;">在这种情况下，MySQL不会检查表的其他分区</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">当你已经知道你想要检查的分区时，这可以大大加快查询速度。</font><font style="vertical-align: inherit;">选择分区还支持数据修改语句
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-xml" title="13.2.7 LOAD XML语法"><code class="literal">LOAD XML</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息和示例，请参阅这些语句的描述。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      通常与分区相关的其他好处包括以下列表中的好处。</font><font style="vertical-align: inherit;">这些功能目前尚未在MySQL分区中实现，但在我们的优先级列表中处于首位。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          涉及聚合函数的查询（如
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sum"><code class="literal">SUM()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和）
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_count"><code class="literal">COUNT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以很容易地并行化。</font><font style="vertical-align: inherit;">这种查询的一个简单例子可能是
           </font></font><code class="literal">SELECT salesperson_id, COUNT(orders) as order_total
          FROM sales GROUP BY salesperson_id;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并行化</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的意思是可以在每个分区上同时运行查询，并且仅通过对所有分区获得的结果求和即可获得最终结果。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          凭借在多个磁盘上传播数据，实现更高的查询吞吐量。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      随着MySQL分区开发的继续，请务必经常检查本节和章节的更新。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="partitioning-types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2分区类型</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-range"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.1范围分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-list"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.2列表分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.3列分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-hash"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.4 HASH分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-key"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.5密钥分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-subpartitions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.6子分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-handling-nulls"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.7 MySQL分区如何处理NULL</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140527983660496"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节讨论MySQL 5.7中可用的分区类型。</font><font style="vertical-align: inherit;">这些包括这里列出的类型：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这种类型的分区基于落在给定范围内的列值将行分配给分区。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-range" title="22.2.1范围分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.1节“范围分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关此类扩展的信息</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-range" title="22.2.3.1 RANGE COLUMNS分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.3.1节“RANGE COLUMNS分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与通过分区类似</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，除了分区是基于与一组离散值中的一个相匹配的列来选择的。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-list" title="22.2.2列表分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.2节“列表分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关此类型扩展的信息</font></font><code class="literal">LIST COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-list" title="22.2.3.2 LIST COLUMNS分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.3.2节“LIST COLUMNS分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HASH分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用这种类型的分区，基于由用户定义的表达式返回的值来选择分区，该表达式对要插入到表中的行中的列值进行操作。</font><font style="vertical-align: inherit;">该函数可能由任何在MySQL中有效的表达式组成，这些表达式会产生一个非负整数值。</font><font style="vertical-align: inherit;">此类型的扩展</font></font><code class="literal">LINEAR HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是可用的。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-hash" title="22.2.4 HASH分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.4节“HASH分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KEY分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了仅提供一个或多个要评估的列以外，</font><font style="vertical-align: inherit;">
            此类型的分区与分区类似
             </font><font style="vertical-align: inherit;">，但MySQL服务器提供了自己的散列函数。</font><font style="vertical-align: inherit;">这些列可以包含除整数值之外的值，因为由MySQL提供的哈希函数保证了整数结果，而不管列数据类型如何。</font><font style="vertical-align: inherit;">此类型的扩展
             </font></font><code class="literal">LINEAR KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是可用的。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-key" title="22.2.5密钥分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.5节“密钥分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<a class="indexterm" name="idm140527983641824"></a><a class="indexterm" name="idm140527983640336"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      数据库分区的一个非常常见的用途是按日期分隔数据。</font><font style="vertical-align: inherit;">一些数据库系统支持明确的日期分区，MySQL在5.7中没有实现。</font><font style="vertical-align: inherit;">但是，不能在MySQL中很难创建基于分区方案
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#time" title="11.3.2时间类型"><code class="literal">TIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，或基于表达式利用这样的列。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      按</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font><font style="vertical-align: inherit;">分区时</font></font><code class="literal">LINEAR
      KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以使用a </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#time" title="11.3.2时间类型"><code class="literal">TIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column作为分区列，而无需对列值进行任何修改。</font><font style="vertical-align: inherit;">例如，这个表创建语句在MySQL中是完全有效的：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE成员（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    firstname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lastname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    username VARCHAR（16）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    电子邮件VARCHAR（35），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    加入了DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KEY分区（加入）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区6;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在MySQL 5.7中，也可以使用a
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column作为使用</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">LIST
      COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">的分区列</font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      然而，MySQL的其他分区类型需要一个分区表达式来产生一个整数值或
       </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果你想通过使用基于日期的分区</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者</font></font><code class="literal">LINEAR HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你可以简单地使用，其操作上的功能
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#time" title="11.3.2时间类型"><code class="literal">TIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，并返回这样的值，如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE成员（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    firstname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lastname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    username VARCHAR（16）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    电子邮件VARCHAR（35），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    加入了DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（年份（加入））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p0值小于（1960），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1值小于（1970），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2值小于（1980），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p3值小于（1990），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p4的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用日期分区的其他示例可以在本章的以下章节中找到：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-range" title="22.2.1范围分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.1节“范围分区”</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-hash" title="22.2.4 HASH分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.4节“HASH分区”</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-linear-hash" title="22.2.4.1线性HASH分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.4.1节“LINEAR HASH分区”</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关日期分区的更复杂示例，请参见以下各节：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning" title="22.4分区修剪"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.4节“分区修剪”</font></font></a>
        </p></li><li class="listitem"><p>
          <a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-subpartitions" title="22.2.6子分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.6节“子分区”</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL的分区是采用最优化
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-days"><code class="literal">TO_DAYS()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-seconds"><code class="literal">TO_SECONDS()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">但是，您可以使用其他日期和时间函数返回一个整数或者</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，例如
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_weekday"><code class="literal">WEEKDAY()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_dayofyear"><code class="literal">DAYOFYEAR()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_month"><code class="literal">MONTH()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关这些功能的更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#date-and-time-functions" title="12.7日期和时间函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/functions.html#date-and-time-functions" title="12.7日期和时间函数"><font style="vertical-align: inherit;">第12.7节“日期和时间函数”</font></a><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      无论您使用哪种分区类型，记住这一点非常重要 - 分区始终自动编号，并且在创建时按顺序编号
       </font></font><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将新行插入到分区表中时，这些分区号用于标识正确的分区。</font><font style="vertical-align: inherit;">例如，如果你的表使用4个分区，这些分区编号</font></font><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
       </font></font><code class="literal">3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区类型，需要确保为每个分区号定义了一个分区。</font><font style="vertical-align: inherit;">对于</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区，用户提供的表达式必须求值为大于的整数值</font></font><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      分区，这个问题由MySQL服务器内部使用的散列函数自动处理。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      分区的名称通常遵循管理其他MySQL标识符的规则，例如表和数据库的标识符。</font><font style="vertical-align: inherit;">但是，您应该注意分区名称不区分大小写。</font><font style="vertical-align: inherit;">例如，下面的
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句如下所示失败：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t2 (val INT)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY LIST(val)(</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION mypart VALUES IN (1,3,5),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION MyPart VALUES IN (2,4,6)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1488（HY000）：复制分区名称mypart</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      发生失败的原因是MySQL认为分区名称</font></font><code class="literal">mypart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">MyPart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当您为表指定分区数时，必须将其表示为不含前导零的正数非零整数文字，并且可能不是像</font></font><code class="literal">0.8E+01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font><font style="vertical-align: inherit;">这样的表达式
       </font></font><code class="literal">6-2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即使它计算为整数值。</font><font style="vertical-align: inherit;">小数分数是不允许的。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在接下来的部分中，我们不一定提供可用于创建每个分区类型的语法的所有可能形式; </font><font style="vertical-align: inherit;">这些信息可以在
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE Syntax”中找到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-range"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.1范围分区</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140527983574496"></a><a class="indexterm" name="idm140527983573008"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        按范围分区的表以这样的方式分区，即每个分区包含分区表达式值位于给定范围内的行。</font><font style="vertical-align: inherit;">范围应该是连续的但不重叠，并且使用</font></font><code class="literal">VALUES LESS THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作符</font><font style="vertical-align: inherit;">来定义
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于接下来的几个例子，假设您正在创建一个如下所示的表来保存20个视频商店的连锁店的人员记录，编号为1到20：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">employees</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里使用</font><font style="vertical-align: inherit;">
          的</font><font style="vertical-align: inherit;">表没有主键或唯一键。</font><font style="vertical-align: inherit;">虽然示例的工作方式与本讨论的目的相同，但您应该记住，实际上表具有主键，唯一键或两者兼而有之，并且分区列的允许选项取决于用于这些列的列键，如果有的话。</font><font style="vertical-align: inherit;">有关这些问题的讨论，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys" title="22.6.1分区键，主键和唯一键"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.6.1节“分区键，主键和唯一键”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        根据您的需求，此表可以按照多种方式进行分区。</font><font style="vertical-align: inherit;">一种方法是使用该
         </font></font><code class="literal">store_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">例如，你可以决定通过添加一个</font></font><code class="literal">PARTITION BY RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">来分割表格
         </font><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY RANGE（store_id）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p0值小于（6），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（11），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p2的值小于（16），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p3值小于（21）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种分区方案中，与在商店1到5工作的员工相对应的所有行都存储在分区中
         </font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，与在商店6到10中使用的行存储在分区中</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等。</font><font style="vertical-align: inherit;">请注意，每个分区按从低到高的顺序定义。</font><font style="vertical-align: inherit;">这是</font></font><code class="literal">PARTITION BY
        RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法</font><font style="vertical-align: inherit;">的要求</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">你可以把它看作类似于</font></font><code class="literal">if ... elseif ...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C或Java在这方面</font><font style="vertical-align: inherit;">的一系列</font><font style="vertical-align: inherit;">语句。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这是很容易确定包含数据的新行
         </font></font><code class="literal">(72, 'Mitchell', 'Wilson', '1998-06-25', NULL,
        13)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入分区</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是当你的链增加了21会发生什么</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">店？</font><font style="vertical-align: inherit;">在这个方案下，没有规则覆盖</font></font><code class="literal">store_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        大于20 </font><font style="vertical-align: inherit;">的行</font><font style="vertical-align: inherit;">，所以会产生错误，因为服务器不知道将它放在哪里。</font><font style="vertical-align: inherit;">您可以通过</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">声明中</font><font style="vertical-align: inherit;">使用</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">catchall</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span> <code class="literal">VALUES LESS
        THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">来防止发生这种情况，该</font><font style="vertical-align: inherit;">子句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的所有值都大于显式指定的最高值：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY RANGE（store_id）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p0值小于（6），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（11），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p2的值小于（16），</font></font><font></font>
    <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区p3的值小于MAXVALUE</font></font></em></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当找不到匹配的值时避免错误的另一种方法是使用</font></font><code class="literal">IGNORE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字作为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的</font><font style="vertical-align: inherit;">一部分
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关示例，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-list" title="22.2.2列表分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.2节“列表分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关一般信息
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><font style="vertical-align: inherit;">第13.2.5节“INSERT语法”</font></a></font><code class="literal">IGNORE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p>
        <code class="literal">MAXVALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示一个整数值，它总是大于最大可能的整数值（在数学语言中，它用作
         </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小上限</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">现在，</font></font><code class="literal">store_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值大于或等于16（定义的最高值）的</font><font style="vertical-align: inherit;">任何行都</font><font style="vertical-align: inherit;">存储在分区中</font></font><code class="literal">p3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在未来的某一时刻，当商店数量增加到25,30或更多时，您可以使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句为商店21-25,26-30等添加新分区（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management" title="22.3分区管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3节“分区管理“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，了解如何做到这一点的细节）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以几乎相同的方式，您可以根据员工工作代码对表格进行分区 - 即基于</font></font><code class="literal">job_code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值的</font><font style="vertical-align: inherit;">范围
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，假设常规（店内）工作人员使用两位数工作代码，则办公室和支持人员使用三位数代码，管理职位使用四位数代码 - 您可以创建分区表使用以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY RANGE（job_code）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0的值小于（100），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（1000），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p2值小于（10000）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，与店内工人有关的所有行都将存储在分区中</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，与办公室和支持人员相关的</font><font style="vertical-align: inherit;">所有行以及与分区</font><font style="vertical-align: inherit;">中管理人员相关的</font><font style="vertical-align: inherit;">行都存储在分区</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        也可以在</font></font><code class="literal">VALUES LESS
        THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">使用表达式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，MySQL必须能够评估表达式的返回值，作为</font></font><code class="literal">LESS
        THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="literal">&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）比较的一部分。
      </font></font></p><a class="indexterm" name="idm140527983532352"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        而不是根据商店编号拆分表格数据，而是可以使用基于两</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">之一的表达式
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，让我们假设您希望根据每位员工离开公司的年份进行划分; </font><font style="vertical-align: inherit;">那就是价值
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR(separated)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里显示了一个实现这种分区方案</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">示例
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（年份（分开））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（1991），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p1值小于（1996），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p2值小于（2001），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p3的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这个方案中，对于1991年以前离开的所有员工，行被存储在分区中</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">对于那些谁留在1991年至1995年，在</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">对于那些在1996年到2000年离开的人来说，在
         </font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">以及2000年以后离开的任何工人</font></font><code class="literal">p3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        也可以</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">函数根据</font><font style="vertical-align: inherit;">列
         </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值对
         </font><font style="vertical-align: inherit;">表进行分区
         </font><font style="vertical-align: inherit;">，如下例所示：
      </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE quarterly_report_status（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    report_id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    report_status VARCHAR（20）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    report_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY RANGE（UNIX_TIMESTAMP（report_updated））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（UNIX_TIMESTAMP（'2008-01-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1值小于（UNIX_TIMESTAMP（'2008-04-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2值小于（UNIX_TIMESTAMP（'2008-07-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p3的值小于（UNIX_TIMESTAMP（'2008-10-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p4的值小于（UNIX_TIMESTAMP（'2009-01-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p5的值小于（UNIX_TIMESTAMP（'2009-04-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p6值小于（UNIX_TIMESTAMP（'2009-07-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p7值小于（UNIX_TIMESTAMP（'2009-10-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p8的值小于（UNIX_TIMESTAMP（'2010-01-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p9的值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        任何涉及</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">其他表达式
         </font><font style="vertical-align: inherit;">都是不允许的。</font><font style="vertical-align: inherit;">（请参阅错误＃42849。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当满足以下一个或多个条件时，范围分区特别有用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您想要或需要删除</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旧</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据。</font><font style="vertical-align: inherit;">如果您正在使用之前为</font></font><code class="literal">employees</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">显示的分区方案
             </font><font style="vertical-align: inherit;">，则可以简单
             </font></font><code class="literal">ALTER TABLE employees DROP PARTITION p0;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            地删除与1991年以前停止为公司工作的员工有关的所有行。（请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8节“ALTER TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management" title="22.3分区管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3节，“分区管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以获得更多信息。）对于有很多行的表，这可以比运行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">更有效率，
             </font><font style="vertical-align: inherit;">例如
             </font></font><code class="literal">DELETE FROM employees WHERE YEAR(separated) &lt;=
            1990;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您想要使用包含日期或时间值的列或包含其他系列值的列。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您经常运行直接依赖于用于分区表的列的查询。</font><font style="vertical-align: inherit;">例如，执行诸如</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN SELECT
            COUNT(*) FROM employees WHERE separated BETWEEN '2000-01-01'
            AND '2000-12-31' GROUP BY store_id;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL之</font><font style="vertical-align: inherit;">类的查询时
             </font><font style="vertical-align: inherit;">，可以快速确定只</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            需要扫描</font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">，因为其余分区不能包含任何满足该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            子句的</font><font style="vertical-align: inherit;">记录</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关如何完成的更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning" title="22.4分区修剪"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning" title="22.4分区修剪"><font style="vertical-align: inherit;">第22.4节“分区修剪”</font></a><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这种类型的分区的变体是</font></font><code class="literal">RANGE
        COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区。</font><font style="vertical-align: inherit;">通过分区</font></font><code class="literal">RANGE
        COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用多个列来定义分区范围，这些分区范围既适用于分区中的行的放置，也适用于在执行分区修剪时确定包含或排除特定分区。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-range" title="22.2.3.1 RANGE COLUMNS分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-range" title="22.2.3.1 RANGE COLUMNS分区"><font style="vertical-align: inherit;">第22.2.3.1节“RANGE COLUMNS分区”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><a name="partitioning-time-intervals"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于时间间隔的分区方案。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您希望在MySQL 5.7中基于范围或时间间隔实施分区方案，您有两种选择：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由分区表</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及用于分隔表达，采用功能上的操作
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#time" title="11.3.2时间类型"><code class="literal">TIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱并返回一个整数值，如下所示：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE成员（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    firstname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lastname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    username VARCHAR（16）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    电子邮件VARCHAR（35），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    加入了DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（年份（加入））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p0值小于（1960），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1值小于（1970），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2值小于（1980），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p3值小于（1990），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p4的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7中，也可以</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">函数根据</font><font style="vertical-align: inherit;">列
             </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值对
             </font><font style="vertical-align: inherit;">表进行分区</font><font style="vertical-align: inherit;">，如下例所示：
          </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE quarterly_report_status（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    report_id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    report_status VARCHAR（20）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    report_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY RANGE（UNIX_TIMESTAMP（report_updated））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（UNIX_TIMESTAMP（'2008-01-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1值小于（UNIX_TIMESTAMP（'2008-04-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2值小于（UNIX_TIMESTAMP（'2008-07-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p3的值小于（UNIX_TIMESTAMP（'2008-10-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p4的值小于（UNIX_TIMESTAMP（'2009-01-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p5的值小于（UNIX_TIMESTAMP（'2009-04-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p6值小于（UNIX_TIMESTAMP（'2009-07-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p7值小于（UNIX_TIMESTAMP（'2009-10-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p8的值小于（UNIX_TIMESTAMP（'2010-01-01 00:00:00'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p9的值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7中，</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不允许</font><font style="vertical-align: inherit;">任何涉及</font><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">其他表达式
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（请参阅错误＃42849。）
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在MySQL 5.7中，也可以将其
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP(timestamp_column)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              用作分区表的分区表达式</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，这样做通常是不现实的。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            按表分区</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列作为分区列。</font><font style="vertical-align: inherit;">例如，
             </font></font><code class="literal">members</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以</font></font><code class="literal">joined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">来定义表格
             </font><font style="vertical-align: inherit;">，如下所示：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE成员（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    firstname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lastname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    username VARCHAR（16）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    电子邮件VARCHAR（35），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    加入了DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围分列（加入）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（'1960-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1值小于（'1970-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2的值小于（'1980-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p3值小于（'1990-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p4的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用除日期或时间类型以外的分区列</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持
           </font><font style="vertical-align: inherit;">的分区列</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-list"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.2列表分区</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140527983465360"></a><a class="indexterm" name="idm140527983463872"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL中的列表分区在很多方面类似于范围分区。</font><font style="vertical-align: inherit;">在分区时</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，必须明确定义每个分区。</font><font style="vertical-align: inherit;">两种类型的分区之间的主要区别在于，在列表分区中，每个分区是根据列值的成员在一组值列表中定义和选择的，而不是在一组连续范围之一值。</font><font style="vertical-align: inherit;">这是通过使用</font><font style="vertical-align: inherit;">where
         </font><font style="vertical-align: inherit;">是一个列值或基于列值的表达式并返回一个整数值，然后通过a定义每个分区来完成的
         </font><font style="vertical-align: inherit;">，其中
         </font><font style="vertical-align: inherit;">是用逗号分隔的整数列表。
</font></font><code class="literal">PARTITION BY
        LIST(<em class="replaceable"><code>expr</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"></font><code class="literal">VALUES IN
        (<em class="replaceable"><code>value_list</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>value_list</code></em><font style="vertical-align: inherit;"></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL 5.7，有可能对阵只有整数（和可能的列表
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-handling-nulls" title="22.2.7 MySQL分区如何处理NULL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.7，“MySQL的分区处理NULL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）分区时</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          但是，在使用</font></font><code class="literal">LIST COLUMN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">时，其他列类型可能会在值列表中使用</font><font style="vertical-align: inherit;">，这将在本节后面进行介绍。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与范围定义的分区不同，列表分区不需要以任何特定顺序进行声明。</font><font style="vertical-align: inherit;">有关更详细的语法信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于后面的示例，我们假设要分区的表的基本定义由以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">提供
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （这是用作</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-range" title="22.2.1范围分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.1节“范围分区”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例的基础的相同表格
         </font><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设有4家特许经营店分布有20家视频商店，如下表所示。
</font></font></p>
<div class="informaltable">
<table summary="An example of 20 video stores distributed among 4 regional franchises, as described in the preceding text."><colgroup><col width="30%"><col width="70%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地区</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">商店ID号码</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">北</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3，5，6，9，17</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">东</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1，2，10，11，19，20</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">西</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4，12，13，14，18</font></font></td>
          </tr><tr>
            <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中央</font></font></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7，8，15，16</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要以属于同一区域的商店的行存储在同一分区中的方式对此表进行分区，可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此处显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY LIST（store_id）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （3,5,6,9,17）中的分数pNorth值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （1,2,10,11,19,20）中的分区pEast值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （4,12,13,14,18）中的分区值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区pCentral值（7,8,15,16）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这使得向表中或从表中添加或删除与特定区域相关的员工记录变得容易。</font><font style="vertical-align: inherit;">例如，假设西部地区的所有商店都出售给另一家公司。</font><font style="vertical-align: inherit;">在MySQL 5.7中，与在该地区的商店工作的员工相关的所有行都可以使用查询来删除
         </font></font><code class="literal">ALTER TABLE employees TRUNCATE PARTITION
        pWest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这可以比等效</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句</font><font style="vertical-align: inherit;">更有效地执行</font></font><code class="literal">DELETE FROM employees WHERE store_id IN
        (4,12,13,14,18);</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（使用</font></font><code class="literal">ALTER TABLE
        employees DROP PARTITION pWest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也会删除所有这些行，但也会</font></font><code class="literal">pWest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从表的定义中</font><font style="vertical-align: inherit;">删除分区
         </font><font style="vertical-align: inherit;">;您需要使用</font></font><code class="literal">ALTER TABLE ... ADD
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来恢复表的原始分区方案。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区一样，可以将</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区与散列或键分区</font><font style="vertical-align: inherit;">结合起来</font><font style="vertical-align: inherit;">，以生成复合分区（子分区）。</font><font style="vertical-align: inherit;">参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-subpartitions" title="22.2.6子分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.6节“子分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">划分</font><font style="vertical-align: inherit;">的情况不同</font><font style="vertical-align: inherit;">，不存在</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如
         </font></font><code class="literal">MAXVALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font><code class="literal">PARTITION
        ... VALUES IN (...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">应涵盖分区表达式的所有预期值</font><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含不匹配的分区列值</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">语句会失败并显示错误，如下例所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE h2 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;    </font></font><strong class="userinput"><code>c1 INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;    </font></font><strong class="userinput"><code>c2 INT</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY LIST(c1) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;    </font></font><strong class="userinput"><code>PARTITION p0 VALUES IN (1, 4, 7),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;    </font></font><strong class="userinput"><code>PARTITION p1 VALUES IN (2, 5, 8)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.11秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1525（HY000）：表没有值为3的分区</font></span></font><strong class="userinput"><code>INSERT INTO h2 VALUES (3, 5);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当使用单个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">插入多行时
         </font><font style="vertical-align: inherit;">，行为取决于表是否使用事务性存储引擎。</font><font style="vertical-align: inherit;">对于</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，该语句被视为单个事务，因此任何不匹配值的存在都会导致语句完全失败，并且不会插入行。</font><font style="vertical-align: inherit;">对于使用非事务性存储引擎的表（例如</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，插入包含不匹配值的行之前的任何行），但插入之后的任何行都不会插入。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以通过使用</font></font><code class="literal">IGNORE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">来忽略这种类型的错误
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果这样做，则不插入包含不匹配的分区列值的行，但</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入</font><font style="vertical-align: inherit;">具有匹配值的任何行</font><font style="vertical-align: inherit;">，并且不报告错误：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>TRUNCATE h2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM h2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT IGNORE INTO h2 VALUES (2, 5), (6, 10), (7, 5), (3, 1), (1, 9);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，3行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：5个重复：2个警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM h2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">c1 | </font><font style="vertical-align: inherit;">c2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">9 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置3行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL 5.7支持</font></font><code class="literal">LIST
        COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区。</font><font style="vertical-align: inherit;">这是一种</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">的变体，
         </font><font style="vertical-align: inherit;">它使您能够使用非整数类型的列来对分区列进行分区，并将多个列用作分区键。</font><font style="vertical-align: inherit;">有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-list" title="22.2.3.2 LIST COLUMNS分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.3.2节“LIST COLUMNS分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-columns"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.3列分区</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-range"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.3.1 RANGE COLUMNS分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-list"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.3.2 LIST COLUMNS分区</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140527983393408"></a><a class="indexterm" name="idm140527983391920"></a><a class="indexterm" name="idm140527983390848"></a><a class="indexterm" name="idm140527983389760"></a><a class="indexterm" name="idm140527983388672"></a><a class="indexterm" name="idm140527983387600"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        接下来的两节讨论
         </font></font><span class="firstterm"><code class="literal">COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这些</font><span class="firstterm"><font style="vertical-align: inherit;">分区</font></span><font style="vertical-align: inherit;">是变体
         </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区。</font></font><code class="literal">COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区允许在分区键中使用多列。</font><font style="vertical-align: inherit;">所有这些列都考虑到了将行放入分区以及确定哪些分区要在分区修剪中检查匹配行的目的。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        另外，</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区和</font></font><code class="literal">LIST COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区都支持使用非整数列来定义值范围或列表成员。</font><font style="vertical-align: inherit;">允许的数据类型显示在以下列表中：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            所有整数类型：</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">TINYINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">SMALLINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">MEDIUMINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">INT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">INTEGER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），和
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">BIGINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这与通过</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font><font style="vertical-align: inherit;">分区相同</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            其他数字数据类型（如
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#fixed-point-types" title="11.2.2定点类型（准确值） -  DECIMAL，NUMERIC"><code class="literal">DECIMAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#floating-point-types" title="11.2.3浮点类型（近似值） -  FLOAT，DOUBLE"><code class="literal">FLOAT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）不支持作为分区列。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            作为分区列不支持使用与日期或时间相关的其他数据类型的列。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            下面的字符串类型：
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">BINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">VARBINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p>
            <a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持列作为分区列。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下</font><font style="vertical-align: inherit;">两节</font><font style="vertical-align: inherit;">的讨论</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">LIST COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区假设您已经熟悉基于MySQL 5.1和更高版本所支持的范围和列表的分区; </font><font style="vertical-align: inherit;">有关这些的更多信息，请分别参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-range" title="22.2.1范围分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.1节“RANGE分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-list" title="22.2.2列表分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.2节“LIST分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="partitioning-columns-range"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.3.1 RANGE COLUMNS分区</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          范围列分区与范围分区类似，但允许您使用基于多个列值的范围定义分区。</font><font style="vertical-align: inherit;">另外，您可以使用整数类型以外的列来定义范围。
        </font></font></p><p>
          <code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下几个方面</font><font style="vertical-align: inherit;">与分区有很大不同</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 不接受表达式，只接受列的名称。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 接受一列或多列。
            </font></font></p><p>
              <code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区基于</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元组</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之间的比较
               </font><font style="vertical-align: inherit;">（列值列表），而不是标量值之间的比较。</font></font><code class="literal">RANGE
              COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">中行的放置</font><font style="vertical-align: inherit;">也基于元组之间的比较; </font><font style="vertical-align: inherit;">这部分将在后面进一步讨论。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区列不限于整数列; </font><font style="vertical-align: inherit;">字符串
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列也可以用作分区列。</font><font style="vertical-align: inherit;">（有关</font><font style="vertical-align: inherit;">详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns" title="22.2.3列分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns" title="22.2.3列分区"><font style="vertical-align: inherit;">第22.2.3节“COLUMNS分区”</font></a><font style="vertical-align: inherit;">。）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          创建分区表的基本语法
           </font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"></font><em class="replaceable"><code>table_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由范围列分隔的</font><font style="vertical-align: inherit;">CREATE TABLE </font><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>column_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分割</font></font><em class="replaceable"><code>partition_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值小于（</font></font><em class="replaceable"><code>value_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）[，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区</font></font><em class="replaceable"><code>partition_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值小于（</font></font><em class="replaceable"><code>value_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）] [，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ...]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font>
<font></font>
<em class="replaceable"><code>column_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>column_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>column_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [，...]</font></font><font></font>
<font></font>
<em class="replaceable"><code>value_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [，...]
</font></font></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里显示了创建分区表时不能使用的</font><font style="vertical-align: inherit;">
            所有</font><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">有关完整信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在刚刚显示的语法中，
           </font></font><em class="replaceable"><code>column_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一列或多列（有时称为
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区列表</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并且</font></font><em class="replaceable"><code>value_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是值列表（即，它是
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区定义值列表</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">甲</font></font><em class="replaceable"><code>value_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须为每个分区定义来提供，并且每个
           </font></font><em class="replaceable"><code>value_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须具有相同数目的值作为</font></font><em class="replaceable"><code>column_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          具有列。</font><font style="vertical-align: inherit;">一般来说，如果使用
           </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="literal">COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中的</font><font style="vertical-align: inherit;">列
           </font><font style="vertical-align: inherit;">，则</font></font><code class="literal">VALUES
          LESS THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还必须为</font><font style="vertical-align: inherit;">每个</font><font style="vertical-align: inherit;">子句提供一个</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分区列表中和定义每个分区的值列表中的元素必须以相同的顺序出现。</font><font style="vertical-align: inherit;">另外，值列表中的每个元素必须与列列表中的相应元素具有相同的数据类型。</font><font style="vertical-align: inherit;">但是，分区列表和值列表中列名的顺序不必与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">主要部分中表列定义的顺序相同</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">与分区表一样</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以使用它</font></font><code class="literal">MAXVALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来表示插入给定列的任何合法值始终小于此值的值。</font><font style="vertical-align: inherit;">这是一个例子
          </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 声明有助于说明所有这些要点：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE rcx (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>a INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>b INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c CHAR(3),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>d INT</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY RANGE COLUMNS(a,d,c) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (5,10,'ggg'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (10,20,'mmm'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (15,30,'sss'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN (MAXVALUE,MAXVALUE,MAXVALUE)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.15秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表</font></font><code class="literal">rcx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含列
           </font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">供给至分区列列表</font></font><code class="literal">COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句使用这些列3中，在顺序</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每个用于定义分区的值列表包含3个相同顺序的值; </font><font style="vertical-align: inherit;">也就是说，每个值列表元组的形式为（</font></font><code class="literal">INT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">INT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">CHAR(3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），其对应于由列中使用的数据类型</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（按该顺序）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过将要插入的行中</font></font><code class="literal">COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的元素</font><font style="vertical-align: inherit;">与</font><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">列列表匹配</font><font style="vertical-align: inherit;">的元组与用于子句中的元组</font><font style="vertical-align: inherit;">进行比较以确定表的分区来确定将行放入分区</font></font><code class="literal">VALUES LESS THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中。</font><font style="vertical-align: inherit;">由于我们正在比较元组（即列表或值集合）而不是标量值，因此</font><font style="vertical-align: inherit;">分区</font></font><code class="literal">VALUES LESS THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font><font style="vertical-align: inherit;">的语义</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与简单</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">的情况略有不同
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在
           </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区中，生成等于a中的极限值的表达式值的行
           </font></font><code class="literal">VALUES LESS THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会放置在相应的分区中; </font><font style="vertical-align: inherit;">但是，使用时</font></font><code class="literal">RANGE
          COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区时，有时可能会出现分区列表第一个元素的值等于</font></font><code class="literal">VALUES LESS THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值列表中</font><font style="vertical-align: inherit;">第一个元素的
           </font><font style="vertical-align: inherit;">值以放入相应分区的行。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          考虑</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由此语句创建</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">分区表：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE r1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    b INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（a）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p0值小于（5），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果我们在这个表中插入3行，使得</font><font style="vertical-align: inherit;">每行</font><font style="vertical-align: inherit;">的列值为，</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则</font></font><code class="literal">5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有3行都存储在分区中，</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因为</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值在每种情况下不小于5，正如我们通过执行针对
           </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO r1 VALUES (5,10), (5,11), (5,12);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，3行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：3重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME,TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'r1';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在考虑一个类似的表</font></font><code class="literal">rc1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它使用
           </font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个列进行分区</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><code class="literal">COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">引用</font><font style="vertical-align: inherit;">，如下所示创建：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE rc1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    b INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围分列（a，b）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0的值小于（5,12），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p3的值小于（MAXVALUE，MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果我们插入与</font></font><code class="literal">rc1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          刚刚插入的</font><font style="vertical-align: inherit;">行完全相同的行</font></font><code class="literal">r1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么行的分配会非常不同：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO rc1 VALUES (5,10), (5,11), (5,12);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，3行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：3重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME,TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'rc1';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_SCHEMA | </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这是因为我们正在比较行而不是标量值。</font><font style="vertical-align: inherit;">我们可以将插入的行值与</font></font><code class="literal">VALUES THAN LESS
          THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表中</font><font style="vertical-align: inherit;">定义分区</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句中
           </font><font style="vertical-align: inherit;">的限制行值进行比较</font></font><code class="literal">rc1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT (5,10) &lt; (5,12), (5,11) &lt; (5,12), (5,12) &lt; (5,12);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ----------------- + ------------- ---- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">（5,10）&lt;（5,12）| </font><font style="vertical-align: inherit;">（5,11）&lt;（5,12）| </font><font style="vertical-align: inherit;">（5,12）&lt;（5,12）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ----------------- + ------------- ---- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ----------------- + ------------- ---- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          所述2元组</font></font><code class="literal">(5,10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">(5,11)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估为小于
           </font></font><code class="literal">(5,12)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此它们存储在分区
           </font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于5不小于5并且12不小于12，所以</font></font><code class="literal">(5,12)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被认为不小于</font></font><code class="literal">(5,12)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并存储在分区中</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上例中</font><font style="vertical-align: inherit;">
          的</font><font style="vertical-align: inherit;">语句也可以使用显式行构造函数编写，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ROW（5,10）&lt;ROW（5,12），ROW（5,11）&lt;ROW（5,12），ROW（5,12）&lt;ROW（5,12）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关在MySQL中使用行构造函数的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#row-subqueries" title="13.2.10.5行子查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.10.5节“行子查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          仅使用单个分区列进行</font><font style="vertical-align: inherit;">分区的表，分区中</font><font style="vertical-align: inherit;">的行存储与分区的等效表的存储方式相同</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下
           </font></font><code class="literal">CREATE TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用1分区列</font><font style="vertical-align: inherit;">创建分区表</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE rx（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    b INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围分列（a）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p0值小于（5），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果我们插入的行</font></font><code class="literal">(5,10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">(5,11)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">(5,12)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到这个表中，我们可以看到，他们的位置是一样的，因为它是表</font></font><code class="literal">r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们创建和早期填充：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO rx VALUES (5,10), (5,11), (5,12);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，3行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：3重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME,TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'rx';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_SCHEMA | </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ -------------- + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          也可以创建表，通过
           </font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在连续分区定义中重复限制一个或多个列的值的方式进行分区。</font><font style="vertical-align: inherit;">只要用于定义分区的列值的元组严格增加，就可以执行此操作。</font><font style="vertical-align: inherit;">例如，以下每个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句都是有效的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE rc2（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    b INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围分列（a，b）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0的值小于（0,10），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（10,20），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2的值小于（10,30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p3的值小于（MAXVALUE，MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE rc3（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    b INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围分列（a，b）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0的值小于（0,10），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（10,20），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2的值小于（10,30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p3的值小于（10,35），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p4的值小于（20,40），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p5的值小于（MAXVALUE，MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下语句也成功了，即使它可能乍一看也不会出现，因为列的限制值为</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25，分区
           </font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为20
           </font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，列的限制值为
           </font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100，分区
           </font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为50
           </font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE rc4（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    b INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    c INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各种颜色的分区（a，b，c）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（0,25,50），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（10,20,100），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p2的值小于（10,30,50）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p3值小于（MAXVALUE，MAXVALUE，MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在设计分区表时</font></font><code class="literal">RANGE
          COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以通过使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">比较所需的元组来测试连续的分区定义
           </font><font style="vertical-align: inherit;">，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT (0,25,50) &lt; (10,20,100), (10,20,100) &lt; (10,30,50);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">（0,25,50）&lt;（10,20,100）| </font><font style="vertical-align: inherit;">（10,20,100）&lt;（10,30,50）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句包含的分区定义不是严格按升序排列，则会失败并显示错误，如以下示例所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE rcf (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>a INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>b INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c INT</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY RANGE COLUMNS(a,b,c) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (0,25,50),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (20,20,100),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (10,30,50),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN (MAXVALUE,MAXVALUE,MAXVALUE)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;   </font><span class="errortext"><font style="vertical-align: inherit;">ERROR 1493（HY000）：值小于每个分区的值必须严格增加</font></span></font><strong class="userinput"><code>);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当出现这样的错误时，您可以通过</font><font style="vertical-align: inherit;">
          在列列表之间</font><font style="vertical-align: inherit;">进行</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少于</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比较</font><font style="vertical-align: inherit;">来推断哪些分区定义是无效的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，问题在于分区的定义，</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为用于</font><font style="vertical-align: inherit;">定义分区
           </font><font style="vertical-align: inherit;">的元组不会小于用于定义分区的元组
           </font></font><code class="literal">p3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT (0,25,50) &lt; (20,20,100), (20,20,100) &lt; (10,30,50);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">（0,25,50）&lt;（20,20,100）| </font><font style="vertical-align: inherit;">（20,20,100）&lt;（10,30,50）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + ----------------------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用时，也可以</font></font><code class="literal">MAXVALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在多个</font></font><code class="literal">VALUES LESS
          THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">显示相同的列</font></font><code class="literal">RANGE
          COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，连续分区定义中各个列的限制值应另外增加，应该不会有多于一个分区定义</font></font><code class="literal">MAXVALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为所有列值的上限，并且此分区定义应显示在</font></font><code class="literal">PARTITION ...
          VALUES LESS THAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">列表中的最后一个</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此外，不能将其</font></font><code class="literal">MAXVALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作多个分区定义中第一列的限制值。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如前所述，</font></font><code class="literal">RANGE
          COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">也可以</font><font style="vertical-align: inherit;">使用非整数列作为分区列。</font><font style="vertical-align: inherit;">（有关</font><font style="vertical-align: inherit;">这些的完整列表，</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns" title="22.2.3列分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.3节“COLUMNS分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）考虑</font></font><code class="literal">employees</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用以下语句创建的</font><font style="vertical-align: inherit;">名为</font><font style="vertical-align: inherit;">（未分区）的表：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区，您可以创建此表的一个版本，根据员工的姓氏将每行存储在四个分区之一中，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees_by_lname（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围列分区（lname）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0的值小于（'g'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（'m'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2的值小于（'t'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p3值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，可以</font></font><code class="literal">employees</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过执行以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">使用此方案对先前创建</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">表进行分区
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE employees PARTITION BY RANGE COLUMNS（lname）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0的值小于（'g'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（'m'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2的值小于（'t'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p3值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            因为不同的字符集和排序规则具有不同的排序顺序，所以</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用字符串列作为分区列时，使用</font><font style="vertical-align: inherit;">的字符集和排序规则可能会影响由</font><font style="vertical-align: inherit;">给定行</font><font style="vertical-align: inherit;">分区的表中的哪个分区
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此外，在创建此类表后，更改给定数据库，表或列的字符集或排序规则可能会改变行的分布方式。</font><font style="vertical-align: inherit;">例如，在使用区分大小写的排序规则时，
             </font></font><code class="literal">'and'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要先
             </font></font><code class="literal">'Andersen'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行排序，但在使用不区分大小写的排序规则时，反之亦然。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关MySQL如何处理字符集和归类的信息，请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/charset.html" title="第10章字符集，排序规则，Unicode"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第10章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符集，归类，Unicode</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          同样，可以</font></font><code class="literal">employees</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          按照这样的方式</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">表进行分区，即每个行都存储在几个分区中的一个分区中，这些分区是根据雇员使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">雇用的十年时间存储的
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE雇员按范围分列（雇用）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（'1970-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1值小于（'1980-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2值小于（'1990-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p3的值小于（'2000-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p4的值小于（'2010-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p5的值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的其他信息</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE语法”</font></a></font><code class="literal">PARTITION BY RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="partitioning-columns-list"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.3.2 LIST COLUMNS分区</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL 5.7支持</font></font><code class="literal">LIST
          COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区。</font><font style="vertical-align: inherit;">这是一种</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">的变体，
           </font><font style="vertical-align: inherit;">它支持使用多个列作为分区键，而将除整数类型以外的数据类型的列用作分区列; </font><font style="vertical-align: inherit;">你可以使用字符串类型
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">（有关</font></font><code class="literal">COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区列</font><font style="vertical-align: inherit;">许可数据类型的更多信息
           </font><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns" title="22.2.3列分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.3节“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
           </font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns" title="22.2.3列分区"><font style="vertical-align: inherit;">分区”</font></a><font style="vertical-align: inherit;">。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设您有一个在12个城市拥有客户的业务，出于销售和营销目的，您将按照下表所示组织成3个城市的4个区域：
</font></font></p>
<div class="informaltable">
<table summary="The example described in the preceding text of a business with four sales and marketing regions, with each region having three cities."><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地区</font></font></th>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">城市</font></font></th>
            </tr></thead><tbody><tr>
              <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oskarshamn，Högsby，Mönsterås</font></font></td>
            </tr><tr>
              <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vimmerby，Hultsfred，Västervik</font></font></td>
            </tr><tr>
              <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nässjö，Eksjö，Vetlanda</font></font></td>
            </tr><tr>
              <td scope="row"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uppvidinge，Alvesta，Växjo</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过</font></font><code class="literal">LIST COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区，您可以创建一个客户数据表，根据客户所在城市的名称为这些区域对应的4个分区中的任何一个分配一行，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE customers_1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    first_name VARCHAR（25），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    last_name VARCHAR（25），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    street_1 VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    street_2 VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    城市VARCHAR（15），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    更新日期</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
列表分区列表（城市）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pRegion_1（'Oskarshamn'，'Högsby'，'Mönsterås'）的价值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pRegion_2（'Vimmerby'，'Hultsfred'，'Västervik'）的值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pRegion_3 VALUE IN（'Nässjö'，'Eksjö'，'Vetlanda'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pRegion_4 VALUES IN（'Uppvidinge'，'Alvesta'，'Växjo'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          与分区一样</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您不需要在</font></font><code class="literal">COLUMNS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">使用表达式
           </font><font style="vertical-align: inherit;">将列值转换为整数。</font><font style="vertical-align: inherit;">（实际上，不允许使用列名以外的表达式
           </font></font><code class="literal">COLUMNS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          也可以使用</font><font style="vertical-align: inherit;">列</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，如以下示例所示，它使用与</font></font><code class="literal">customers_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">相同的名称和列</font><font style="vertical-align: inherit;">，但使用</font></font><code class="literal">LIST COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于</font></font><code class="literal">renewal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的</font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">将行存储在4个分区之一中，具体取决于2010年2月的一周该客户的账户计划更新：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE customers_2（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    first_name VARCHAR（25），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    last_name VARCHAR（25），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    street_1 VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    street_2 VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    城市VARCHAR（15），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    更新日期</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按列表分区（续展）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pWeek_1 VALUES IN（'2010-02-01'，'2010-02-02'，'2010-02-03'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        '2010-02-04'，'2010-02-05'，'2010-02-06'，'2010-02-07'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pWeek_2值（'2010-02-08'，'2010-02-09'，'2010-02-10'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        '2010-02-11'，'2010-02-12'，'2010-02-13'，'2010-02-14'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pWeek_3 VALUE IN（'2010-02-15'，'2010-02-16'，'2010-02-17'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        '2010-02-18'，'2010-02-19'，'2010-02-20'，'2010-02-21'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pWeek_4 VALUE IN（'2010-02-22'，'2010-02-23'，'2010-02-24'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        '2010-02-25'，'2010-02-26'，'2010-02-27'，'2010-02-28'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这是有效的，但如果所涉及的日期数量增长很多，则定义和维护会变得很麻烦; </font><font style="vertical-align: inherit;">在这种情况下，使用</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分区</font><font style="vertical-align: inherit;">通常更实用
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，由于我们希望用作分区键的</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">是一
           </font><font style="vertical-align: inherit;">列，因此我们使用
           </font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE customers_3（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    first_name VARCHAR（25），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    last_name VARCHAR（25），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    street_1 VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    street_2 VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    城市VARCHAR（15），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    更新日期</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围列划分（续展）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pWeek_1的值小于（'2010-02-09'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pWeek_2的值小于（'2010-02-15'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pWeek_3的值小于（'2010-02-22'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION pWeek_4的值小于（'2010-03-01'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-range" title="22.2.3.1 RANGE COLUMNS分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-columns-range" title="22.2.3.1 RANGE COLUMNS分区"><font style="vertical-align: inherit;">第22.2.3.1节“RANGE COLUMNS分区”</font></a><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另外（与</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分区一样），您可以在</font></font><code class="literal">COLUMNS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">使用多个列
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的其他信息</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE语法”</font></a></font><code class="literal">PARTITION BY LIST COLUMNS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-hash"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.4 HASH分区</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-linear-hash"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.4.1线性HASH分区</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140527983130304"></a><a class="indexterm" name="idm140527983128816"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区依据</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要用于确保数据在预定数量的分区中的均匀分布。</font><font style="vertical-align: inherit;">使用范围或列表分区，您必须明确指定要存储给定列值或列值集合的分区; </font><font style="vertical-align: inherit;">使用散列分区，MySQL会为您处理此问题，并且您只需根据要进行散列的列值和分区表的分区数量指定列值或表达式即可。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要使用分区对表进行</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区，有必要在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">附加</font><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">子句，其中
         </font><font style="vertical-align: inherit;">是一个返回整数的表达式。</font><font style="vertical-align: inherit;">这可以简单地是一个列的类型是MySQL的整数类型之一的名称。</font><font style="vertical-align: inherit;">另外，你很可能想要跟随它</font><font style="vertical-align: inherit;">，其中
         </font><font style="vertical-align: inherit;">是一个正整数，表示将要分割表的分区数。
</font></font><code class="literal">PARTITION BY HASH
        (<em class="replaceable"><code>expr</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"></font><code class="literal">PARTITIONS
        <em class="replaceable"><code>num</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>num</code></em><font style="vertical-align: inherit;"></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了简单起见，以下示例中的表格不使用任何键。</font><font style="vertical-align: inherit;">您应该知道，如果表中有任何唯一键，则此表的分区表达式中使用的每列必须是每个唯一键（包括主键）的一部分。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys" title="22.6.1分区键，主键和唯一键"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys" title="22.6.1分区键，主键和唯一键"><font style="vertical-align: inherit;">第22.6.1节“分区键，主键和唯一键”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下语句创建一个在</font></font><code class="literal">store_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">上使用散列的表，
         </font><font style="vertical-align: inherit;">并将其划分为4个分区：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY HASH（store_id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果不包含</font></font><code class="literal">PARTITIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，则分区数缺省为</font></font><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><code class="literal">PARTITIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有数字</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">关键字会导致语法错误。
      </font></font></p><a class="indexterm" name="idm140527983112960"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您还可以使用返回整数的SQL表达式
         </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，您可能希望根据员工被聘用的年份进行分区。</font><font style="vertical-align: inherit;">这可以如下所示完成：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HASH分区（年份（已聘请））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
</pre><p>
        <em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须返回一个非常数的非随机整数值（换句话说，它应该是变化的，但是是确定性的），并且不得包含</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations" title="22.6分区的限制和限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.6节“分区的限制和限制”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述的任何禁止的结构
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您还应该记住，每次插入或更新行（或可能已删除）时都会评估此表达式; </font><font style="vertical-align: inherit;">这意味着非常复杂的表达式可能会导致性能问题，特别是在执行操作（如批处理插入）时会同时影响很多行。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        最有效的散列函数是对单个表列进行操作并且其值随列值一致增加或减少的函数，因为这允许
         </font><font style="vertical-align: inherit;">在分区范围上</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修剪</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，表达式越靠近它所基于的列的值，MySQL就越有效地使用该表达式来进行散列分区。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        例如，哪里</font></font><code class="literal">date_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个类型的列</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则表达式
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-days"><code class="literal">TO_DAYS(date_col)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被称为与值的值直接变化</font></font><code class="literal">date_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为对于</font><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">每次变化，</font></font><code class="literal">date_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式的值以一致的方式变化。</font><font style="vertical-align: inherit;">表达</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR(date_col)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方面
         </font><font style="vertical-align: inherit;">的差异
         </font></font><code class="literal">date_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并不像那样直接
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-days"><code class="literal">TO_DAYS(date_col)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为并不是每一个可能的变化都会</font></font><code class="literal">date_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生同等的变化
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR(date_col)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">即使如此，
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR(date_col)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希函数也是一个很好的候选者，因为它直接与一部分相关，</font></font><code class="literal">date_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且没有可能的变化</font></font><code class="literal">date_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这会导致不成比例的变化
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR(date_col)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        相反，假设您有一个名为</font></font><code class="literal">int_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其类型
         </font><font style="vertical-align: inherit;">的列
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">INT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在考虑一下表达式
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_pow"><code class="literal">POW(5-int_col,3) + 6</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这对散列函数来说是一个糟糕的选择，因为值的变化</font></font><code class="literal">int_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能保证在表达式的值中产生比例变化。</font><font style="vertical-align: inherit;">改变</font></font><code class="literal">int_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个给定量</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">可以产生表达式值的广泛不同的变化。</font><font style="vertical-align: inherit;">例如，改变</font></font><code class="literal">int_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从
         </font></font><code class="literal">5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font></font><code class="literal">6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生的变化</font></font><code class="literal">-1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式的值，但改变的值</font></font><code class="literal">int_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从
         </font></font><code class="literal">6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font></font><code class="literal">7</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生的变化</font></font><code class="literal">-7</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在表达式中的值。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        换句话说，列值与表达式的值越接近一条直线，如方程式所示
         </font><font style="vertical-align: inherit;">，其中
         </font><font style="vertical-align: inherit;">有一个非零常数，则表达式越适合散列。</font><font style="vertical-align: inherit;">这与表达式越是非线性的事实相关，在趋向于产生的分区之间的数据分布越不均匀。
      </font></font><code class="literal">y=<em class="replaceable"><code>c</code></em>x</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>c</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        理论上，对于包含多个列值的表达式，修剪也是可能的，但确定哪些表达式合适可能是相当困难和耗时的。</font><font style="vertical-align: inherit;">出于这个原因，不特别推荐使用涉及多列的散列表达式。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当</font></font><code class="literal">PARTITION BY HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用时，MySQL根据</font></font><em class="replaceable"><code>num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表达式结果的模数</font><font style="vertical-align: inherit;">确定</font><font style="vertical-align: inherit;">要使用</font><font style="vertical-align: inherit;">哪个分区</font><font style="vertical-align: inherit;">分区。</font><font style="vertical-align: inherit;">换句话说，对于给定的表达式
         </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，存储记录的分区是分区号
         </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设该表
         </font><font style="vertical-align: inherit;">定义如下，以便它有4个分区：
      </font></font><code class="literal"><em class="replaceable"><code>N</code></em> =
        MOD(<em class="replaceable"><code>expr</code></em>,
        <em class="replaceable"><code>num</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">t1</code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（col1 INT，col2 CHAR（5），col3 DATE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    HASH分区（年份（col3））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您插入的记录</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
         </font></font><code class="literal">col3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是
         </font></font><code class="literal">'2005-09-15'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则存储它的分区按如下方式确定：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOD（YEAR（ '2005-09-01'），4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
= MOD（2005,4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
= 1</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL 5.7还支持</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线性散列</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">分区
         </font><font style="vertical-align: inherit;">变体，
         </font><font style="vertical-align: inherit;">它使用更复杂的算法来确定插入分区表中的新行的位置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">此算法的说明，</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-linear-hash" title="22.2.4.1线性HASH分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.4.1节“LINEAR HASH分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每次插入或更新记录时都会评估用户提供的表达式。</font><font style="vertical-align: inherit;">它也可以 - 根据具体情况 - 在记录被删除时进行评估。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="partitioning-linear-hash"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.4.1线性HASH分区</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140527983062624"></a><a class="indexterm" name="idm140527983061136"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL还支持线性哈希，它不同于常规哈希，因为线性哈希使用线性幂指数算法，而常规哈希使用哈希函数值的模数。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在语法上，线性哈希分区和常规哈希之间的唯一区别是</font></font><code class="literal">LINEAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">PARTITION
          BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">添加
           </font><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    雇用了DATE NOT NULL DEFAULT'1970-01-01'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分隔的DATE NOT NULL DEFAULT'9999-12-31'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    job_code INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LINEAR HASH分区（年份（已聘请））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          给出的表达式</font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中，所述记录被存储在使用线性散列分区是分区号</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从间</font></font><em class="replaceable"><code>num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隔板，其中
           </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，根据以下算法导出：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              找到下一个2的幂次大于
               </font></font><em class="replaceable"><code>num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们称之为价值
               </font></font><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">它可以计算为：
            </font></font></p><pre data-lang="simple" class="programlisting"><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= POWER（2，CEILING（LOG（2，</font></font><em class="replaceable"><code>num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）））
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （假设</font></font><em class="replaceable"><code>num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是13.然后
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_log"><code class="literal">LOG(2,13)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是3.7004397181411。
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_ceiling"><code class="literal">CEILING(3.7004397181411)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是4，</font></font><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= =
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_power"><code class="literal">POWER(2,4)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它是16.）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Set </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=
               </font></font><em class="replaceable"><code>F</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>column_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）＆（</font></font><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-  1）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; =时
               </font></font><em class="replaceable"><code>num</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  Set </font></font><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=
                   </font></font><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ 2
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  Set </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=
                   </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＆（</font></font><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-  1）
</font></font></p></li></ul>
</div>
</li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此语句创建使用线性哈希分区并具有6个分区的表：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（col1 INT，col2 CHAR（5），col3 DATE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    线性散列分区（年份（col3））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区6;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在假设你想插入两个记录到
           </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有</font></font><code class="literal">col3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          列值</font></font><code class="literal">'2003-04-14'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">'1998-10-19'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">第一个的分区号决定如下：
        </font></font></p><pre data-lang="simple" class="programlisting"><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= POWER（2，CEILING（LOG（2,6）））= 8
 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= YEAR（'2003-04-14'）＆（8-1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   = 2003＆7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   = 3</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3&gt; = 6是FALSE：存储在分区＃3中的记录</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          计算第二条记录所在分区的编号，如下所示：
        </font></font></p><pre data-lang="simple" class="programlisting"><em class="replaceable"><code>V</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 8
 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= YEAR（'1998-10-19'）＆（8  -  1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  = 1998＆7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  = 6</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6&gt; = 6为真：需要额外的步骤</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font>
<font></font>
<em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 6＆（（8/2）-1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  = 6和3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  = 2</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2&gt; = 6是FALSE：存储在分区＃2中的记录</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          线性散列分区的优点是分区的添加，删除，合并和分割速度更快，这在处理包含极大量（太字节）数据的表时非常有用。</font><font style="vertical-align: inherit;">缺点是与使用常规哈希分区获得的分布相比，分区之间的数据不太可能均匀分布。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-key"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.5密钥分区</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140527983022144"></a><a class="indexterm" name="idm140527983020656"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        按键分区与按哈希分区类似，只是在散列分区使用用户定义的表达式时，用于密钥分区的散列函数由MySQL服务器提供。</font><font style="vertical-align: inherit;">NDB集群
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_md5"><code class="literal">MD5()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于此目的; </font><font style="vertical-align: inherit;">对于使用其他存储引擎的表，服务器使用自己的内部散列函数，该函数基于与之相同的算法</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语法规则</font></font><code class="literal">CREATE TABLE ... PARTITION BY
        KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与用于创建按散列分区的表类似。</font><font style="vertical-align: inherit;">主要区别在这里列出：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被使用而不是
             </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只接受零个或多个列名称的列表。</font><font style="vertical-align: inherit;">如果表中有一个，则用作分区键的任何列都必须包含部分或全部表的主键。</font><font style="vertical-align: inherit;">如果未指定列名作为分区键，则使用表的主键（如果有）。</font><font style="vertical-align: inherit;">例如，以下
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句在MySQL 5.7中有效：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE k1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ID INT NOT NULL PRIMARY KEY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    名称VARCHAR（20）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按键分区（）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区2;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果没有主键但有唯一键，则该唯一键用于分区键：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE k1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    名称VARCHAR（20），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    唯一键（id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按键分区（）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区2;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            但是，如果唯一键列未定义为
             </font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则以前的语句将失败。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在这两种情况下，分区键均为
             </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，即使它未显示在表的输出中</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE语法"><code class="literal">SHOW CREATE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">PARTITION_EXPRESSION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中
             </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与其他分区类型不同，用于分区的列</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不限于整数或</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">例如，以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句是有效的：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE tm1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    s1 CHAR（32）PRIMARY KEY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按键分区（s1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区10;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            前面的语句将</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是有效的，将被指定不同的分区类型。</font><font style="vertical-align: inherit;">（在这种情况下，简单地使用</font></font><code class="literal">PARTITION BY
            KEY()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是有效的，并且具有与表一样的效果</font></font><code class="literal">PARTITION BY KEY(s1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为
             </font></font><code class="literal">s1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是表的主键。）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关此问题的其他信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations" title="22.6分区的限制和限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.6节“分区的限制和限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">被隐式分区
               </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，再次使用表的主键作为分区键。</font><font style="vertical-align: inherit;">如果NDB簇表没有明确的主键，</font><font style="vertical-align: inherit;">则由</font><font style="vertical-align: inherit;">存储引擎为每个NDB簇表</font><font style="vertical-align: inherit;">生成</font><font style="vertical-align: inherit;">的
               </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐藏</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主键
               </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作分区键。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果为</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">定义明确的分区方案
               </font><font style="vertical-align: inherit;">，则该表必须具有明确的主键，并且分区表达式中使用的任何列都必须是此键的一部分。</font><font style="vertical-align: inherit;">但是，如果表使用</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表达式 - 即</font></font><code class="literal">PARTITION BY
              KEY()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有列引用 - 则不需要明确的主键。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-programs-ndb-desc" title="21.4.10 ndb_desc  - 描述NDB表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ndb_desc</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序（使用该
               </font></font><code class="option">-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项）</font><font style="vertical-align: inherit;">观察此分区
               </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于键分区表，您无法执行
               </font></font><code class="literal">ALTER TABLE DROP PRIMARY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为这样会</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表中找不到分区函数的字段列表中</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的错误</font><span class="errortext"><font style="vertical-align: inherit;">ERROR 1466（HY000）：字段</font></span><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这对NDB群集表格不是问题，它们被分区</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">在这种情况下，使用</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐藏</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主键</font><font style="vertical-align: inherit;">重新组织
               </font><font style="vertical-align: inherit;">表作为表的新分区键。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL NDB Cluster 7.5和NDB Cluster 7.6</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li></ul>
</div>
<a class="indexterm" name="idm140527982978096"></a><a class="indexterm" name="idm140527982976608"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        也可以通过线性键对表格进行分区。</font><font style="vertical-align: inherit;">这是一个简单的例子：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE tk（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 CHAR（5），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 DATE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
线性密钥分区（col1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区3;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><code class="literal">LINEAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区上的</font><font style="vertical-align: inherit;">效果与在</font><font style="vertical-align: inherit;">分区上的
         </font><font style="vertical-align: inherit;">效果相同
         </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，分区编号是使用二次幂运算而不是模运算得出的。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">此算法及其含义的说明，</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-linear-hash" title="22.2.4.1线性HASH分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.4.1节“LINEAR HASH分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-subpartitions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.6子分区</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140527982969200"></a><a class="indexterm" name="idm140527982968128"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        子</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><font style="vertical-align: inherit;">也称为
         </font><span class="firstterm"><font style="vertical-align: inherit;">复合分区</font></span><font style="vertical-align: inherit;"> - 是分区表中每个分区的进一步划分。</font><font style="vertical-align: inherit;">考虑以下
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（id INT，购买日期）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（年份（购买））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    通过HASH（TO_DAYS（购买））进行分隔</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    SUBPARTITIONS 2（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p0值小于（1990），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p1小于（2000），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p2的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表</font></font><code class="literal">ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有3个</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区。</font><font style="vertical-align: inherit;">这些分区-中的每一个</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-is进一步分成2子分区。</font><font style="vertical-align: inherit;">实际上，整个表格被分成多个
         </font></font><code class="literal">3 * 2 = 6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区。</font><font style="vertical-align: inherit;">但是，由于该</font></font><code class="literal">PARTITION BY RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款</font><font style="vertical-align: inherit;">的作用</font><font style="vertical-align: inherit;">，其中前两项仅存储</font></font><code class="literal">purchased</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">值小于1990的那些记录</font><font style="vertical-align: inherit;">。
      </font></font></p><a class="indexterm" name="idm140527982956992"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7中，可以对由</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
         </font><font style="vertical-align: inherit;">分区的表进行子分区</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">子</font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">可以使用
         </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区。</font><font style="vertical-align: inherit;">这也被称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复合分区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
          <code class="literal">SUBPARTITION BY HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">SUBPARTITION BY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般遵循相同的语法规则</font></font><code class="literal">PARTITION BY HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">PARTITION BY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。</font><font style="vertical-align: inherit;">此例外是</font></font><code class="literal">SUBPARTITION BY
          KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不同</font></font><code class="literal">PARTITION BY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）目前不支持默认列，因此必须指定用于此目的的列，即使该表具有明确的主键。</font><font style="vertical-align: inherit;">这是我们正在努力解决的一个已知问题; </font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-subpartitions" title="子分区的问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子部分的问题</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以获取更多信息和示例。
</font></font></p>
</div>
<a class="indexterm" name="idm140527982945472"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        也可以使用</font></font><code class="literal">SUBPARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">明确定义子分区
         </font><font style="vertical-align: inherit;">来指定个别子分区的选项。</font><font style="vertical-align: inherit;">例如，创建</font></font><code class="literal">ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前例所示</font><font style="vertical-align: inherit;">的相同表格的更详细的方式</font><font style="vertical-align: inherit;">是：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（id INT，购买日期）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（年份（购买））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    通过哈希（TO_DAYS（购买））（（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p0值小于（1990）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p1值小于（2000）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p2的值小于MAXVALUE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s4，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这里列出了一些音符的语法项目：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每个分区必须具有相同数量的子分区。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您使用</font></font><code class="literal">SUBPARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表的任何分区</font><font style="vertical-align: inherit;">显式定义任何子分区
             </font><font style="vertical-align: inherit;">，则必须全部定义它们。</font><font style="vertical-align: inherit;">换句话说，以下陈述将失败：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（id INT，购买日期）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（年份（购买））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    通过哈希（TO_DAYS（购买））（（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p0值小于（1990）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p1小于（2000），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p2的值小于MAXVALUE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            即使它包含一个</font></font><code class="literal">SUBPARTITIONS 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款，</font><font style="vertical-align: inherit;">该声明仍然会失败
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每个</font></font><code class="literal">SUBPARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句必须包含（至少）子分区的名称。</font><font style="vertical-align: inherit;">否则，您可以为子分区设置任何所需的选项，或允许它为该选项采用其默认设置。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            子分区名称在整个表格中必须是唯一的。</font><font style="vertical-align: inherit;">例如，以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句在MySQL 5.7中有效：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（id INT，购买日期）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（年份（购买））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    通过哈希（TO_DAYS（购买））（（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p0值小于（1990）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p1值小于（2000）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p2的值小于MAXVALUE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s4，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ）;</font></font><font></font>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        子分区可以与特别大的</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表一起</font><font style="vertical-align: inherit;">使用，
         </font><font style="vertical-align: inherit;">以便在多个磁盘之间分配数据和索引。</font><font style="vertical-align: inherit;">假设你已经安装的6个磁盘</font></font><code class="filename">/disk0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="filename">/disk1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="filename">/disk2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，等等。</font><font style="vertical-align: inherit;">现在考虑下面的例子：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（id INT，购买日期）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ENGINE = MYISAM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（年份（购买））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    通过哈希（TO_DAYS（购买））（（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p0值小于（1990）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk0 / data'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk0 / idx'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk1 / data'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk1 / idx'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p1值小于（2000）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk2 / data'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk2 / idx'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk3 / data'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk3 / idx'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p2的值小于MAXVALUE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk4 / data'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk4 / idx'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk5 / data'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk5 / idx'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，一个单独的磁盘用于数据和每个索引</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">许多其他变化是可能的; </font><font style="vertical-align: inherit;">另一个例子可能是：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（id INT，购买日期）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ENGINE = MYISAM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（年份（购买））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    通过哈希（TO_DAYS（购买））（（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p0值小于（1990）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s0a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk0'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk1'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s0b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk2'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk3'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p1值小于（2000）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s1a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk4 / data'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk4 / idx'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s1b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                DATA DIRECTORY ='/ disk5 / data'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                INDEX DIRECTORY ='/ disk5 / idx'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p2的值小于MAXVALUE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s2a，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SUBPARTITION s2b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这里的存储如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            具有</font></font><code class="literal">purchased</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1990年以前的日期的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">占用大量空间，所以分成4种方式，具有专用于数据的单独磁盘以及两个子分区中的每一个的索引（</font></font><code class="literal">s0a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="literal">s0b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）构成分区</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">换一种说法：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                子分区的数据</font></font><code class="literal">s0a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在上</font></font><code class="filename">/disk0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                子分区的索引</font></font><code class="literal">s0a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在上</font></font><code class="filename">/disk1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                子分区的数据</font></font><code class="literal">s0b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在上</font></font><code class="filename">/disk2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                子分区的索引</font></font><code class="literal">s0b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在上</font></font><code class="filename">/disk3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            包含从1990年到1999年（分区</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">日期的行</font><font style="vertical-align: inherit;">不需要</font><font style="vertical-align: inherit;">与1990年以前的日期</font><font style="vertical-align: inherit;">相同的空间。这些</font><font style="vertical-align: inherit;">分区
             </font><font style="vertical-align: inherit;">在2个磁盘（</font></font><code class="filename">/disk4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="filename">/disk5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）而不是4个磁盘</font><font style="vertical-align: inherit;">之间分割，</font><font style="vertical-align: inherit;">如同存储在</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下中</font><font style="vertical-align: inherit;">的旧式记录</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                属于</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个子分区（</font></font><code class="literal">s1a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">数据和索引</font><font style="vertical-align: inherit;">存储在</font></font><code class="filename">/disk4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据
                 </font></font><code class="filename">/disk4/data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和索引中
                 </font></font><code class="filename">/disk4/idx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                属于</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个子分区（</font></font><code class="literal">s1b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">数据和索引</font><font style="vertical-align: inherit;">存储在</font></font><code class="filename">/disk5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据
                 </font></font><code class="filename">/disk5/data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和索引中
                 </font></font><code class="filename">/disk5/idx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            反映从2000年到现在的日期（分区</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的行不占用前两个范围中的任何一个所需的空间。</font><font style="vertical-align: inherit;">目前，将所有这些存储在默认位置就足够了。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            未来，当从2000年开始的十年购买数量增长到缺省位置不再提供足够空间时，相应的行可以使用</font></font><code class="literal">ALTER
            TABLE ... REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">移动</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management" title="22.3分区管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3节“分区管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，了解如何完成此操作。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font><font style="vertical-align: inherit;">服务器SQL模式有效</font><font style="vertical-align: inherit;">时，分区定义中不允许</font><font style="vertical-align: inherit;">
        使用</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">INDEX
        DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_dir_in_create"><code class="literal">NO_DIR_IN_CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL 5.7中，这些选项在定义子分区时也是不允许的（Bug＃42954）。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-handling-nulls"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.7 MySQL分区如何处理NULL</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL中进行分区并不禁止
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表达式的值，无论它是列值还是用户提供的表达式的值。</font><font style="vertical-align: inherit;">尽管允许将其
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作必须产生整数的表达式的值，但请记住这
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是一个数字。</font><font style="vertical-align: inherit;">MySQL的分区实现视为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比任何非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">都少</font><font style="vertical-align: inherit;">，就像一样
         </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这意味着</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对不同类型的分区的</font><font style="vertical-align: inherit;">处理会</font><font style="vertical-align: inherit;">有所不同，并且可能会产生如果您没有做好准备就不会期望的行为。</font><font style="vertical-align: inherit;">在这种情况下，我们将在本节中讨论如何确定每个MySQL分区类型</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在确定应存储行的分区时</font><font style="vertical-align: inherit;">如何处理</font><font style="vertical-align: inherit;">值，并为每个分区提供示例。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用RANGE分区处理NULL。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果将行插入按照
           </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于确定分区的列值进行分区的表中</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则该行将插入到最低分区中。</font><font style="vertical-align: inherit;">考虑一个名为数据库中的这两个表</font></font><code class="literal">p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，创建如下：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t1 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c1 INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c2 VARCHAR(20)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY RANGE(c1) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (0),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (10),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN MAXVALUE</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.09秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t2 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c1 INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c2 VARCHAR(20)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY RANGE(c1) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (-5),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (0),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (10),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN MAXVALUE</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.09秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下针对</font><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">中的</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的
         </font><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">来查看由这两个</font><font style="vertical-align: inherit;">语句
         </font><font style="vertical-align: inherit;">创建的分区
         </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT TABLE_NAME, PARTITION_NAME, TABLE_ROWS, AVG_ROW_LENGTH, DATA_LENGTH</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;    </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;   </font></font><strong class="userinput"><code>WHERE TABLE_SCHEMA = 'p' AND TABLE_NAME LIKE 't_';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_NAME | </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS | </font><font style="vertical-align: inherit;">AVG_ROW_LENGTH | </font><font style="vertical-align: inherit;">DATA_LENGTH |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t1 | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t1 | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t1 | </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t2 | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t2 | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t2 | </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t2 | </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置7行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （有关此表的更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第24.15节“INFORMATION_SCHEMA PARTITIONS表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）现在，让我们用包含</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作分区键的列中</font><font style="vertical-align: inherit;">的单个行填充每个表
         </font><font style="vertical-align: inherit;">，然后验证是否插入了行使用一对
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO t1 VALUES (NULL, 'mothra');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO t2 VALUES (NULL, 'mothra');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM t1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">名称|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">mothra |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM t2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">名称|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">mothra |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以通过重新运行先前的查询</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并检查输出</font><font style="vertical-align: inherit;">来查看哪些分区用于存储插入的行
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT TABLE_NAME, PARTITION_NAME, TABLE_ROWS, AVG_ROW_LENGTH, DATA_LENGTH</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;    </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;   </font></font><strong class="userinput"><code>WHERE TABLE_SCHEMA = 'p' AND TABLE_NAME LIKE 't_';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_NAME | </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS | </font><font style="vertical-align: inherit;">AVG_ROW_LENGTH | </font><font style="vertical-align: inherit;">DATA_LENGTH |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font>
<span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">t1 | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">20 | </font><font style="vertical-align: inherit;">20 |</font></font></em></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t1 | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t1 | </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font>
<span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">t2 | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">20 | </font><font style="vertical-align: inherit;">20 |</font></font></em></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t2 | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t2 | </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">t2 | </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一组7行（0.01秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您还可以通过删除这些分区来证明这些行存储在每个表的最低分区中，然后重新运行这些</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE t1 DROP PARTITION p0;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.16秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE t2 DROP PARTITION p0;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.16秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM t1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM t2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （有关更多信息</font></font><code class="literal">ALTER TABLE ... DROP
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8节“ALTER TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
      </font></font></p><p>
        <code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也以这种方式处理分区使用SQL函数的表达式。</font><font style="vertical-align: inherit;">假设我们使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下这样</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">定义一个表</font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE tndate（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    dt日期</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（年（dt））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（1990），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1小于（2000），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与其他MySQL函数一样，
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR(NULL)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">具有</font></font><code class="literal">dt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        列值的行</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被视为分区表达式计算为小于任何其他值的值，因此被插入到分区中</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用LIST分区处理NULL。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当且仅当其中一个分区使用包含的值列表进行定义时，</font><font style="vertical-align: inherit;">
          通过</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">承认
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值进行分区的表
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">与此相反，由分区表分区的表</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在值列表中</font><font style="vertical-align: inherit;">明确使用</font><font style="vertical-align: inherit;">，拒绝了导致</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表达式值的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">，如下例所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE ts1 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c1 INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c2 VARCHAR(20)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY LIST(c1) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES IN (0, 3, 6),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES IN (1, 4, 7),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES IN (2, 5, 8)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.01秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1504（HY000）：表没有值为9的分区</font></span></font><strong class="userinput"><code>INSERT INTO ts1 VALUES (9, 'mothra');</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1504（HY000）：表没有值为NULL的分区</font></span></font><strong class="userinput"><code>INSERT INTO ts1 VALUES (NULL, 'mothra');</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有具有</font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介于</font></font><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">之间</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">值的
         </font><font style="vertical-align: inherit;">行</font></font><code class="literal">8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能被插入</font></font><code class="literal">ts1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        超出这个范围，就像数字一样
         </font></font><code class="literal">9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们可以创建表格
         </font></font><code class="literal">ts2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">ts3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含值列表</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE ts2 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c1 INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c2 VARCHAR(20)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY LIST(c1) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES IN (0, 3, 6),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES IN (1, 4, 7),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES IN (2, 5, 8),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p3 VALUES IN (NULL)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.01秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE ts3 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c1 INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c2 VARCHAR(20)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY LIST(c1) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES IN (0, 3, 6),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES IN (1, 4, 7, NULL),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES IN (2, 5, 8)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.01秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当为分区定义值列表时，您可以（也应该）像处理</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何其他值一样</font><font style="vertical-align: inherit;">对待</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，无论是</font></font><code class="literal">VALUES IN (NULL)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">VALUES IN (1, 4, 7, NULL)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是有效的，因为是
         </font></font><code class="literal">VALUES IN (1, NULL, 4, 7)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">VALUES IN
        (NULL, 1, 4, 7)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等。</font><font style="vertical-align: inherit;">您可以将具有</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的行</font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        插入每个表中，</font></font><code class="literal">ts2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
         </font></font><code class="literal">ts3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO ts2 VALUES (NULL, 'mothra');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO ts3 VALUES (NULL, 'mothra');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过发出适当的查询
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以确定哪些分区用于存储刚刚插入的行（我们假设，如前面的示例中所示，分区表是在</font></font><code class="literal">p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        数据库</font><font style="vertical-align: inherit;">中创建的</font><font style="vertical-align: inherit;">）：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT TABLE_NAME, PARTITION_NAME, TABLE_ROWS, AVG_ROW_LENGTH, DATA_LENGTH</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;    </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;   </font></font><strong class="userinput"><code>WHERE TABLE_SCHEMA = 'p' AND TABLE_NAME LIKE 'ts_';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_NAME | </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS | </font><font style="vertical-align: inherit;">AVG_ROW_LENGTH | </font><font style="vertical-align: inherit;">DATA_LENGTH |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts2 | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts2 | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts2 | </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font>
<span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">ts2 | </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">20 | </font><font style="vertical-align: inherit;">20 |</font></font></em></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts3 | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font>
<span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">ts3 | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">20 | </font><font style="vertical-align: inherit;">20 |</font></font></em></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts3 | </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一组7行（0.01秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如本节前面所示，您还可以通过删除这些分区，然后执行a来验证哪些分区用于存储行
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用HASH和KEY分区处理NULL。&nbsp;</font></font></b>
          <code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于由</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
           </font><font style="vertical-align: inherit;">分隔的表格，处理方式有所不同</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这些情况下，任何产生一个</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">分区表达式</font><font style="vertical-align: inherit;">都被视为它的返回值为零。</font><font style="vertical-align: inherit;">我们可以通过检查对文件系统的影响来验证这种行为，即创建一个表，</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并用包含适当值的记录填充它。</font><font style="vertical-align: inherit;">假设您有一个</font><font style="vertical-align: inherit;">使用以下语句创建</font><font style="vertical-align: inherit;">的表</font></font><code class="literal">th</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（也在</font></font><code class="literal">p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE th (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c1 INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>c2 VARCHAR(20)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY HASH(c1)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>PARTITIONS 2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        属于此表的分区可以使用此处显示的查询来查看：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; SELECT TABLE_NAME，PARTITION_NAME，TABLE_ROWS，AVG_ROW_LENGTH，DATA_LENGTH</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt; FROM INFORMATION_SCHEMA.PARTITIONS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt; WHERE TABLE_SCHEMA ='p'AND TABLE_NAME ='th';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_NAME | </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS | </font><font style="vertical-align: inherit;">AVG_ROW_LENGTH | </font><font style="vertical-align: inherit;">DATA_LENGTH |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">th | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">th | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p>
        <code class="literal">TABLE_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于每个分区为0.现在将两行插入</font></font><code class="literal">th</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其
         </font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        0，并验证是否插入了这些行，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO th VALUES (NULL, 'mothra'), (0, 'gigan');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM th;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">c1 | </font><font style="vertical-align: inherit;">c2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">mothra |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">gigan |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.01秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        回想一下，对于任何整数</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，值</font><font style="vertical-align: inherit;">总是
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于由分区表
         </font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">，此结果被处理，用于确定正确的分区为
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">再次</font><font style="vertical-align: inherit;">检查
         </font><font style="vertical-align: inherit;">表格，我们可以看到两行都被插入到分区中</font><font style="vertical-align: inherit;">：
      </font></font><code class="literal">NULL MOD
        <em class="replaceable"><code>N</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font><code class="literal">HASH</code><font style="vertical-align: inherit;"></font><code class="literal">KEY</code><font style="vertical-align: inherit;"></font><code class="literal">0</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"></font><code class="literal">p0</code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT TABLE_NAME, PARTITION_NAME, TABLE_ROWS, AVG_ROW_LENGTH, DATA_LENGTH</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;    </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;   </font></font><strong class="userinput"><code>WHERE TABLE_SCHEMA = 'p' AND TABLE_NAME ='th';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_NAME | </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS | </font><font style="vertical-align: inherit;">AVG_ROW_LENGTH | </font><font style="vertical-align: inherit;">DATA_LENGTH |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font>
<span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">th | </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">20 | </font><font style="vertical-align: inherit;">20 |</font></font></em></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">th | </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ---------------- + ------------ + ------ ---------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过重复使用最后一个示例</font></font><code class="literal">PARTITION BY
        KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替</font></font><code class="literal">PARTITION BY HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表的定义，您可以验证
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于此类分区也将其视为0。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="partitioning-management"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3分区管理</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-range-list"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.1范围和列表分区的管理</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-hash-key"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.2 HASH和密钥分区的管理</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-exchange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.3与表交换分区和子分区</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-maintenance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.4分区维护</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-info"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.5获取有关分区的信息</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140527982727888"></a><a class="indexterm" name="idm140527982726816"></a><a class="indexterm" name="idm140527982725328"></a><a class="indexterm" name="idm140527982723840"></a><a class="indexterm" name="idm140527982722352"></a><a class="indexterm" name="idm140527982720864"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL 5.7提供了许多修改分区表的方法。</font><font style="vertical-align: inherit;">可以添加，删除，重新定义，合并或拆分现有分区。</font><font style="vertical-align: inherit;">所有这些操作都可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
      TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的分区扩展来执行
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">还有一些方法可以获取有关分区表和分区的信息。</font><font style="vertical-align: inherit;">我们在后面的章节中讨论这些主题。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关由</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
           </font><font style="vertical-align: inherit;">分区的表中的分区管理的信息</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-range-list" title="22.3.1范围和列表分区的管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3.1节“RANGE和LIST分区的管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关管理</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">的讨论</font><font style="vertical-align: inherit;">，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-hash-key" title="22.3.2 HASH和密钥分区的管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3.2节“HASH和KEY分区的管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-info" title="22.3.5获取有关分区的信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取关于分区表和分区的信息的讨论，</font><font style="vertical-align: inherit;">
          请参见</font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-info" title="22.3.5获取有关分区的信息"><font style="vertical-align: inherit;">第22.3.5节“获取</font></a><font style="vertical-align: inherit;">有关分区的信息”。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关在分区上执行维护操作的讨论，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-maintenance" title="22.3.4分区维护"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3.4节“维护分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7中，分区表中的所有分区必须具有相同数量的子分区，并且在创建表后不可能更改子分区。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要更改表格的分区方案，只需要将</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
      TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句与
       </font></font><em class="replaceable"><code>partition_options</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">一起使用
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该子句的语法与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于创建分区表的</font><font style="vertical-align: inherit;">语法相同
       </font><font style="vertical-align: inherit;">，始终以关键字开头
       </font></font><code class="literal">PARTITION BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设您有一个使用以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">按范围分区的表
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE trb3（id INT，name VARCHAR（50），购买日期）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（年份（购买））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p0值小于（1990），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p1值小于（1995），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p2值小于（2000），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p3值小于（2005）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要重新分区此表，以便使用</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值作为键的基础将其按键</font><font style="vertical-align: inherit;">分区为两个分区</font><font style="vertical-align: inherit;">，则可以使用以下语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE trb3 PARTITION BY KEY（ID）PARTITIONS 2;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这与表格的结构具有相同的效果，因此可以删除表格并重新使用表格</font></font><code class="literal">CREATE TABLE trb3
      PARTITION BY KEY(id) PARTITIONS 2;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p>
      <code class="literal">ALTER TABLE ... ENGINE = ...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只更改表使用的存储引擎，并保持表的分区方案不变。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">ALTER TABLE ... REMOVE
      PARTITIONING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除表的分区。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8节“ALTER TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有一个单一的</font></font><code class="literal">PARTITION BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">ADD
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">DROP PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font><code class="literal">COALESCE
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句可以在给定的使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明。</font><font style="vertical-align: inherit;">如果您（例如）希望删除一个分区并重新组织一个表的剩余分区，则必须在两个单独的
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（一个使用</font></font><code class="literal">DROP
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后第二个使用
         </font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中执行此操作。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在MySQL 5.7中，可以使用删除一个或多个选定分区中的所有行
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE ...
      TRUNCATE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-management-range-list"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.1范围和列表分区的管理</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140527982682240"></a><a class="indexterm" name="idm140527982680752"></a><a class="indexterm" name="idm140527982679264"></a><a class="indexterm" name="idm140527982677776"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        范围和列表分区的添加和删除都以类似的方式处理，因此我们在本节中讨论这两种分区的管理。</font><font style="vertical-align: inherit;">有关使用散列或密钥分区的表的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-hash-key" title="22.3.2 HASH和密钥分区的管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3.2节“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列
         </font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-hash-key" title="22.3.2 HASH和密钥分区的管理"><font style="vertical-align: inherit;">和密钥分区的管理”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从通过任意分区的表中删除分区
         </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用来实现
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的发言</font></font><code class="literal">DROP
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">假设你已经创建了一个由范围分区，然后用10条记录使用下面的填充表格</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        报表：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE tr (id INT, name VARCHAR(50), purchased DATE)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION BY RANGE( YEAR(purchased) ) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (1990),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (1995),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (2000),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN (2005),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p4 VALUES LESS THAN (2010),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p5 VALUES LESS THAN (2015)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.28秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO tr VALUES</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(1, 'desk organiser', '2003-10-15'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(2, 'alarm clock', '1997-11-05'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(3, 'chair', '2009-03-10'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(4, 'bookcase', '1989-01-10'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(5, 'exercise bike', '2014-05-09'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(6, 'sofa', '1987-06-05'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(7, 'espresso maker', '2011-11-22'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(8, 'aquarium', '1992-08-04'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(9, 'study desk', '2006-09-16'),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>(10, 'lava lamp', '1998-12-25');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，10行受影响（0.05秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：10重复：0警告：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        你可以看到哪些项目应该被插入分区
         </font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT * FROM tr</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE purchased BETWEEN '1995-01-01' AND '1999-12-31';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">名称| </font><font style="vertical-align: inherit;">购买|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">闹钟| </font><font style="vertical-align: inherit;">1997-11-05 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">熔岩灯| </font><font style="vertical-align: inherit;">1998-12-25 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您还可以使用分区选择来获取此信息，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM tr PARTITION (p2);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">名称| </font><font style="vertical-align: inherit;">购买|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">闹钟| </font><font style="vertical-align: inherit;">1997-11-05 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">熔岩灯| </font><font style="vertical-align: inherit;">1998-12-25 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-selection" title="22.5分区选择"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-selection" title="22.5分区选择"><font style="vertical-align: inherit;">第22.5节“分区选择”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要删除名为的分区</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请执行以下命令：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE tr DROP PARTITION p2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.03秒）</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDBCLUSTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎不支持</font></font><code class="literal">ALTER TABLE ... DROP
          PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，它确实支持</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章中介绍</font><font style="vertical-align: inherit;">的其他与分区相关的扩展
           </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        记住非常重要的一点是，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当你删除一个分区时，你也删除了存储在该分区中的所有数据</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以通过重新运行先前的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询</font><font style="vertical-align: inherit;">来看到这种情况</font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT * FROM tr WHERE purchased</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>BETWEEN '1995-01-01' AND '1999-12-31';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        因此，您必须先拥有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">特权，然后才能</font></font><code class="literal">ALTER TABLE ... DROP
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该表格上</font><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">该表格。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您希望在保留表定义及其分区方案的同时删除所有分区的所有数据，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.34节“TRUNCATE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您打算更改表的分区
         </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丢失数据，请</font></font><code class="literal">ALTER
        TABLE ... REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改为</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参见下面或在</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8，“ALTER TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，有关的信息
         </font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果你现在执行一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE语法"><code class="literal">SHOW CREATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明，你可以看到如何改变表的分区组成：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW CREATE TABLE tr\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       表：tr</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建表：CREATE TABLE`tr`（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `id` int（11）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `name` varchar（50）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `购买'日期DEFAULT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB DEFAULT CHARSET = latin1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ *！50100按范围划分（年份（购买））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（PARTITION p0值小于（1990）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p1值小于（1995）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p3值小于（2005）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p4的值小于（2010）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p5值小于（2015）ENGINE = InnoDB）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当您将新行插入已更改的表中并且
         </font></font><code class="literal">purchased</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值在</font></font><code class="literal">'1995-01-01'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">'2004-12-31'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">之间时
         </font><font style="vertical-align: inherit;">，这些行将存储在分区中</font></font><code class="literal">p3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">你可以验证这个如下：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO tr VALUES (11, 'pencil holder', '1995-07-12');</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT * FROM tr WHERE purchased</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>BETWEEN '1995-01-01' AND '2004-12-31';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">名称| </font><font style="vertical-align: inherit;">购买|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">书桌组织者| </font><font style="vertical-align: inherit;">2003-10-15 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">笔筒| </font><font style="vertical-align: inherit;">1995-07-12 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE tr DROP PARTITION p3;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.03秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT * FROM tr WHERE purchased</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>BETWEEN '1995-01-01' AND '2004-12-31';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从表中删除的行数
         </font></font><code class="literal">ALTER TABLE ... DROP PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会由服务器报告，因为它将通过等效
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询进行报告。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        删除</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区使用完全相同的</font></font><code class="literal">ALTER TABLE ... DROP PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法来删除</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区。</font><font style="vertical-align: inherit;">但是，这对于以后使用表的效果有一个重要区别：您不能再向该表中插入任何具有包含在定义已删除分区的值列表中的任何值的行。</font><font style="vertical-align: inherit;">（例如，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-list" title="22.2.2列表分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.2节“列表分区”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要将新范围或列表分区添加到先前分区的表中，请使用该</font></font><code class="literal">ALTER TABLE ... ADD PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句。</font><font style="vertical-align: inherit;">用于由分区表
         </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这可以用于一个新的范围添加到现有分区的列表的末尾。</font><font style="vertical-align: inherit;">假设您有一个包含贵组织成员资格数据的分区表，其定义如下：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE成员（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（25），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（25），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    dob DATE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（年（dob））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（1980），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1小于（1990），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p2值小于（2000）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        进一步假设成员的最低年龄为16岁。随着日历临近2015年底，您意识到您很快就会加入2000年（及以后）出生的成员。</font><font style="vertical-align: inherit;">您可以修改</font></font><code class="literal">members</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格以适应2000年至2010年出生的新成员，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE成员添加分区（PARTITION p3 VALUE小于（2010））;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于按范围分区的表，可以使用仅
         </font></font><code class="literal">ADD PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将新分区添加到分区列表的高端。</font><font style="vertical-align: inherit;">尝试在现有分区之间或之前以此方式添加新分区会导致如下所示的错误：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE members</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;      </font></font><strong class="userinput"><code>ADD PARTITION (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;     </font></font><strong class="userinput"><code>PARTITION n VALUES LESS THAN (1970));</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1463（HY000）：数值必须严格限制»</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   每个分区都在增加</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以通过将第一个分区重新组织为两个新分区来解决这个问题，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE成员</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    重组分区p0 INTO（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION n0值小于（1970），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区n1值小于（1980）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE语法"><code class="literal">SHOW CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以看到该</font></font><code class="literal">ALTER TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明具有预期效果：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW CREATE TABLE members\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       表：成员</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建表：CREATE TABLE`members`（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `id` int（11）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `fname` varchar（25）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `lname` varchar（25）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `dob`日期DEFAULT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB DEFAULT CHARSET = latin1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ *！50100按范围划分（年份（dob））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（PARTITION n0值小于（1970）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION n1值小于（1980）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p1值小于（1990）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p2的值小于（2000）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p3值小于（2010）ENGINE = InnoDB）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        另请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8.1节“ALTER TABLE分区操作”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您还可以使用</font></font><code class="literal">ALTER TABLE ... ADD
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将新分区添加到被分区的表中</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设</font></font><code class="literal">tt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">来定义
         </font><font style="vertical-align: inherit;">表格
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE tt（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    数据INT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按列表分区（数据）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值（5,10,15），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p1值（6,12,18）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可以添加在其中具有所述行存储一个新的分区
         </font></font><code class="literal">data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的列值</font></font><code class="literal">7</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">14</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">21</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE tt ADD PARTITION（PARTITION p2 VALUES IN（7，14，21））;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        请记住，您</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加
         </font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含已包含在现有分区值列表中的任何值的新分区。</font><font style="vertical-align: inherit;">如果您尝试这样做，会导致错误：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql </font></font><strong class="userinput"><code>ALTER TABLE tt ADD PARTITION </code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &gt;&gt;     </font></font><strong class="userinput"><code>(PARTITION np VALUES IN (4, 8, 12));</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1465（HY000）：同一常数的多重定义»</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    在列表分区中</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于具有</font></font><code class="literal">data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值的
         </font><font style="vertical-align: inherit;">任何行</font></font><code class="literal">12</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都已分配给分区
         </font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此无法</font><font style="vertical-align: inherit;">
        在其值列表</font></font><code class="literal">tt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中包含的</font><font style="vertical-align: inherit;">表上创建新的分区</font></font><code class="literal">12</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要做到这一点，你可以删除
         </font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后添加</font></font><code class="literal">np</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个新</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的修改后的定义。</font><font style="vertical-align: inherit;">但是，正如前面所讨论的那样，这会导致所有存储在数据中的数据丢失</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 而且这通常不是您真正想要做的事情。</font><font style="vertical-align: inherit;">另一种解决方案似乎是使用新分区复制表格并将数据复制到其中
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE ...
        SELECT ...</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后删除旧表并重命名新表，但是在处理大量数据时这可能非常耗时。</font><font style="vertical-align: inherit;">在需要高可用性的情况下，这也可能不可行。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以在一个</font></font><code class="literal">ALTER TABLE
        ... ADD PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">添加多个分区，</font><font style="vertical-align: inherit;">如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  fname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  lname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  雇用了DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（年份（已聘用））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PARTITION p1值小于（1991），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  分区p2值小于（1996），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  分区p3值小于（2001），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  分区p4值小于（2005）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE员工ADD PARTITION（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p5的价值小于（2010），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p6的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        幸运的是，MySQL的分区实现提供了重新定义分区而不会丢失数据的方法。</font><font style="vertical-align: inherit;">首先让我们看几个涉及</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区</font><font style="vertical-align: inherit;">的简单例子</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">回想一下</font></font><code class="literal">members</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在定义</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表格，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW CREATE TABLE members\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       表：成员</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建表：CREATE TABLE`members`（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `id` int（11）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `fname` varchar（25）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `lname` varchar（25）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `dob`日期DEFAULT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB DEFAULT CHARSET = latin1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ *！50100按范围划分（年份（dob））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（PARTITION n0值小于（1970）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION n1值小于（1980）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p1值小于（1990）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p2的值小于（2000）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p3值小于（2010）ENGINE = InnoDB）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设您想将表示1960年以前出生的成员的所有行移动到单独的分区中。</font><font style="vertical-align: inherit;">正如我们已经看到的，这是无法使用的
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... ADD PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，您可以使用另一个与分区相关的扩展
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来完成此操作：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE成员REORGANIZE PARTITION n0 INTO（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区s0值小于（1960），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区s1值小于（1970）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        实际上，此命令分区拆分</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        成两个新的分区</font></font><code class="literal">s0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">s1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它还</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据两个</font></font><code class="literal">PARTITION ... VALUES
        ...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款中</font></font><code class="literal">s0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">的规则将</font><font style="vertical-align: inherit;">存储在</font><font style="vertical-align: inherit;">新分区中</font><font style="vertical-align: inherit;">的数据移动
         </font><font style="vertical-align: inherit;">，以便</font><font style="vertical-align: inherit;">只</font><font style="vertical-align: inherit;">包含那些</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR(dob)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小于1960的</font><font style="vertical-align: inherit;">记录，
         </font><font style="vertical-align: inherit;">并
         </font></font><code class="literal">s1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含那些
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR(dob)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于或等于1960但小于比1970年。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        甲</font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款还可以使用用于合并相邻的分区。</font><font style="vertical-align: inherit;">您可以在</font></font><code class="literal">members</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格中</font><font style="vertical-align: inherit;">反转前一个语句的效果，</font><font style="vertical-align: inherit;">如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE成员REORGANIZE PARTITION s0，s1 INTO（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p0值小于（1970）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在使用分割或合并分区时不会丢失数据
         </font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在执行上面的语句中，MySQL将所有的已存储在分区中的记录</font></font><code class="literal">s0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="literal">s1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为分区</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一般语法</font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    REORGANIZE PARTITION </font></font><em class="replaceable"><code>partition_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INTO（</font></font><em class="replaceable"><code>partition_definitions</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这里</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是分区表的名称，并且</font></font><em class="replaceable"><code>partition_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        是要改变的一个或多个现有分区的名称的以逗号分隔的列表。
        </font></font><em class="replaceable"><code>partition_definitions</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是新分区定义的逗号分隔列表，它遵循与在</font></font><em class="replaceable"><code>partition_definitions</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中使用</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">列表
         </font><font style="vertical-align: inherit;">相同的规则
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您不仅限于将几个分区合并为一个分区，还可以将一个分区合并为多个分区</font></font><code class="literal">REORGANIZE
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，您可以将</font></font><code class="literal">members</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">所有四个分区重新组织</font><font style="vertical-align: inherit;">为两个，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE成员REORGANIZE PARTITION p0，p1，p2，p3 INTO（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区m0值小于（1980），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区m1值小于（2000）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您也可以使用</font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被分区的表格</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">让我们回到将新分区添加到列表分区</font></font><code class="literal">tt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的问题，并且失败，因为新分区的值已经存在于其中一个现有分区的值列表中。</font><font style="vertical-align: inherit;">我们可以通过添加仅包含非冲突值的分区来处理此问题，然后重新组织新分区和现有分区，以便将存储在现有分区中的值移至新分区：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE tt ADD PARTITION（PARTITION np VALUES IN（4，8））;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE tt REORGANIZE PARTITION p1，np INTO（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1（6，18），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （4，8，12）中的分区np值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在使用</font></font><code class="literal">ALTER TABLE ... REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新分区由</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">分区的表
         </font><font style="vertical-align: inherit;">时，请记住以下几点
         </font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于确定新分区方案</font><font style="vertical-align: inherit;">
            的</font><font style="vertical-align: inherit;">选项遵循与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">使用的规则相同的规则</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            新的</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区方案不能有任何重叠范围; </font><font style="vertical-align: inherit;">一个新的</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            分区方案不能有任何重叠的值集。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>partition_definitions</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">
            中分区的组合
             </font><font style="vertical-align: inherit;">应该占用与在中指定的组合分区相同的范围或整组值
             </font></font><em class="replaceable"><code>partition_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例如，分区</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一起涵盖了1980年到1999年</font></font><code class="literal">members</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中用作示例</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表格。</font><font style="vertical-align: inherit;">这两个分区的任何重组都应该覆盖整个年份的相同范围。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于被分区的表</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您只能重新组织相邻的分区; </font><font style="vertical-align: inherit;">你不能跳过范围分区。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例如，你不能</font></font><code class="literal">members</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用一开始的语句</font><font style="vertical-align: inherit;">重新组织示例
             </font><font style="vertical-align: inherit;">表，</font></font><code class="literal">ALTER TABLE members REORGANIZE PARTITION p0,p2
            INTO ...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涵盖了1970年以前</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的年份和1990年到1999年的年份，所以这些不是相邻的分区。</font><font style="vertical-align: inherit;">（</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在这种情况下，</font><font style="vertical-align: inherit;">您不能跳过分区</font><font style="vertical-align: inherit;">。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您不能使用它</font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来更改表使用的分区类型; </font><font style="vertical-align: inherit;">例如，您不能将</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            分区</font><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">为</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区或相反。</font><font style="vertical-align: inherit;">您也不能使用此语句来更改分区表达式或列。</font><font style="vertical-align: inherit;">要完成这些任务中的任一个而不删除并重新创建表，可以使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
            TABLE ... PARTITION BY ...</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE成员</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    HASH分区（年份（dob））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区8;</font></font><font></font>
</pre></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-management-hash-key"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.2 HASH和密钥分区的管理</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140527982500768"></a><a class="indexterm" name="idm140527982499280"></a><a class="indexterm" name="idm140527982497792"></a><a class="indexterm" name="idm140527982496304"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过散列或按键进行分区的表关于在分区设置中进行更改时彼此非常相似，并且这些表与通过范围或列表进行分区的表的方式在许多方面有所不同。</font><font style="vertical-align: inherit;">出于这个原因，本节讨论了通过散列或按键进行分区的表的修改。</font><font style="vertical-align: inherit;">有关添加和删除按范围或列表进行分区的表的分区的讨论，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-management-range-list" title="22.3.1范围和列表分区的管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3.1节“对RANGE和LIST分区的管理”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不能删除从由分区表分区
         </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在你可以从表由划分以同样的方式
         </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，您可以</font><font style="vertical-align: inherit;">
        使用该</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">进行合并</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font></font><code class="literal">ALTER TABLE ... COALESCE
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设你有一个包含关于客户端的数据的表，它被分成十二个分区。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">clients</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的定义如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE客户端（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    签署日期</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HASH分区（月（签名））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区12;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要将分区数从十二个减少到八个，请执行以下
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE clients COALESCE PARTITION 4;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.02秒）</font></font><font></font>
</pre><p>
        <code class="literal">COALESCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">效果一样好由分区表</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">LINEAR HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
         </font></font><code class="literal">LINEAR KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个与前一个类似的例子，不同之处仅在于该表由</font></font><code class="literal">LINEAR KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下</font><font style="vertical-align: inherit;">分区
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE clients_lk (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>id INT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>fname VARCHAR(30),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>lname VARCHAR(30),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>signed DATE</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY LINEAR KEY(signed)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>PARTITIONS 12;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.03秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE clients_lk COALESCE PARTITION 4;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.06秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下面</font></font><code class="literal">COALESCE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数字是合并到余数中的分区数 - 换句话说，它是要从表中移除的分区数。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您尝试删除比表具有更多的分区，则结果会显示如下所示的错误：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE clients COALESCE PARTITION 18;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1478（HY000）：无法删除所有分区，请改用DROP TABLE</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        将</font></font><code class="literal">clients</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">的分区数量
         </font><font style="vertical-align: inherit;">从12增加到18.使用
         </font></font><code class="literal">ALTER TABLE ... ADD PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE客户端添加分区分区6;
</font></font></pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-management-exchange"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.3与表交换分区和子分区</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7中，可以使用表来交换表分区或子分区</font><font style="vertical-align: inherit;">，其中
         </font><font style="vertical-align: inherit;">分区表</font><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">分区表，并且
         </font><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">要与未分区表交换</font><font style="vertical-align: inherit;">的分区或子
         </font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">，前提是以下语句是正确的：
</font></font><code class="literal">ALTER
        TABLE <em class="replaceable"><code>pt</code></em> EXCHANGE PARTITION
        <em class="replaceable"><code>p</code></em> WITH TABLE
        <em class="replaceable"><code>nt</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>pt</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>p</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>pt</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>nt</code></em><font style="vertical-align: inherit;"></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表格</font></font><em class="replaceable"><code>nt</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本身并未分区。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表格</font></font><em class="replaceable"><code>nt</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是临时表格。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表格的结构</font></font><em class="replaceable"><code>pt</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><em class="replaceable"><code>nt</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他方面是相同的。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表不</font></font><code class="literal">nt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含外键引用，并且其他表中没有任何引用的外键</font></font><code class="literal">nt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>nt</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该分区定义的边界之外
             </font><font style="vertical-align: inherit;">
            没有行</font></font><em class="replaceable"><code>p</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果使用该</font></font><code class="literal">WITHOUT VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，则</font><font style="vertical-align: inherit;">此条件不适用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">[{WITH|WITHOUT} VALIDATION]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项已添加到MySQL 5.7.5中。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        除了</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_alter"><code class="literal">ALTER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_insert"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_create"><code class="literal">CREATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常需要的权限</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        声明，你必须有
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_drop"><code class="literal">DROP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行权限
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE ...
        EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您还应该了解以下影响
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE ...
        EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
            TABLE ... EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会调用分区表或要交换的表上的任何触发器。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交换表中的</font><font style="vertical-align: inherit;">
            任何</font><font style="vertical-align: inherit;">列都将被重置。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">IGNORE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与...一起使用时，</font><font style="vertical-align: inherit;">
            该</font><font style="vertical-align: inherit;">关键字不起作用</font></font><code class="literal">ALTER TABLE ... EXCHANGE
            PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE ...
        EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">
        的语法
         </font><font style="vertical-align: inherit;">如下所示：</font></font><em class="replaceable"><code>pt</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表</font><font style="vertical-align: inherit;">在哪里
         </font><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>p</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是要交换的分区还是子</font><font style="vertical-align: inherit;">分区，
         </font><font style="vertical-align: inherit;">是要与之交换</font></font><em class="replaceable"><code>nt</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的非分区表
         </font></font><em class="replaceable"><code>p</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    使用TABLE </font><font style="vertical-align: inherit;">修改TABLE </font></font><em class="replaceable"><code>pt</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    换行分区</font><font style="vertical-align: inherit;">;
</font></font><em class="replaceable"><code>p</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>nt</code></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或者，您可以附加一个</font></font><code class="literal">WITH VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或</font><font style="vertical-align: inherit;">一个</font></font><code class="literal">WITHOUT VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">当
         </font></font><code class="literal">WITHOUT VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被指定，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE ...
        EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交换分区分区表操作时不执行行由行验证，允许数据库管理员承担确保行是分区定义的范围内承担责任。</font></font><code class="literal">WITH VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        是默认行为，不需要明确指定。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">[{WITH|WITHOUT} VALIDATION]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项已添加到MySQL 5.7.5中。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一个且只有一个分区或子分区可以在一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE
        EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">与唯一的一个非分区表交换
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要交换多个分区或子分区，请使用多个
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE
        EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font></font><code class="literal">EXCHANGE
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能不会与其他</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">结合使用
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">分区表使用的分区和（如果适用）子分区可以是MySQL 5.7支持的任何类型或类型。
</font></font></p>
<h4><a name="idm140527982414528"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与非分区表交换分区</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设</font></font><code class="literal">e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经使用以下SQL语句创建并填充</font><font style="vertical-align: inherit;">了分区表</font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE e（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（id）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p0的值小于（50），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p1的值小于（100），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p2的值小于（150），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p3值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插入e值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （1669年，“吉姆”，“史密斯”），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （337，“玛丽”，“琼斯”），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （16，“弗兰克”，“白色”），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （2005年，“琳达”，“黑色”）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        现在我们创建一个未分区的</font></font><code class="literal">e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        named </font></font><code class="literal">e2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">来完成
         </font><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE e2 LIKE e;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（1.34秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE e2 REMOVE PARTITIONING;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.90秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过查询</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表</font><font style="vertical-align: inherit;">
        可以看到表</font><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">哪些分区</font><font style="vertical-align: inherit;">包含行
         </font><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME, TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'e';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4行（0.00秒）</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于分区</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，行计数给出在</font></font><code class="literal">TABLE_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该列
           </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表仅是一个估计值在SQL优化使用，并不总是准确的。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表中
         </font></font><code class="literal">e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与表</font><font style="vertical-align: inherit;">交换分区</font></font><code class="literal">e2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处显示</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE e EXCHANGE PARTITION p0 WITH TABLE e2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.28秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        更准确地说，刚刚发布的语句会使分区中找到的任何行与表中找到的行交换。</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        像以前</font><font style="vertical-align: inherit;">一样，您可以通过查询</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">来观察这是如何发生的
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">先前在分区中找到的表格行</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不再存在：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME, TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'e';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您查询表格</font></font><code class="literal">e2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以看到
         </font><font style="vertical-align: inherit;">现在可以在那里找到</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缺失</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM e2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">16 | </font><font style="vertical-align: inherit;">弗兰克| </font><font style="vertical-align: inherit;">白色|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与分区交换的表不一定是空的。</font><font style="vertical-align: inherit;">为了演示这一点，我们首先在表中插入一个新行</font></font><code class="literal">e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过选择一个</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小于50 </font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">列值，并通过查询</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">来验证此
         </font><font style="vertical-align: inherit;">行，确保将此行存储在分区</font><font style="vertical-align: inherit;">中：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">                                                          
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO e VALUES (41, "Michael", "Green");</code></strong>            <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.05秒）                              </font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME, TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'e';</code></strong>            <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">1 |             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 |             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 |             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">3 |             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4行（0.00秒）        </font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        现在我们再次</font><font style="vertical-align: inherit;">使用与</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">相同的
         </font><font style="vertical-align: inherit;">语句</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与表格</font><font style="vertical-align: inherit;">交换分区</font><font style="vertical-align: inherit;">：
      </font></font><code class="literal">e2</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE e EXCHANGE PARTITION p0 WITH TABLE e2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.28秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下查询的输出显示存储在分区中</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的表行以及</font></font><code class="literal">e2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">之前
         </font><font style="vertical-align: inherit;">存储在表中的表行</font><font style="vertical-align: inherit;">已切换到位置：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM e;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">16 | </font><font style="vertical-align: inherit;">弗兰克| </font><font style="vertical-align: inherit;">白色|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1669 | </font><font style="vertical-align: inherit;">吉姆| </font><font style="vertical-align: inherit;">史密斯|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">337 | </font><font style="vertical-align: inherit;">Mary | </font><font style="vertical-align: inherit;">琼斯|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2005 | </font><font style="vertical-align: inherit;">琳达| </font><font style="vertical-align: inherit;">黑色|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME, TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'e';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM e2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + --------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + --------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">41 | </font><font style="vertical-align: inherit;">迈克尔| </font><font style="vertical-align: inherit;">绿色|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + --------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre>
<h4><a name="idm140527982358928"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不匹配的行</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您应该记住，在发布</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE ...
        EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">之前在非分区表中找到的任何行
         </font><font style="vertical-align: inherit;">必须满足它们存储在目标分区中所需的条件; </font><font style="vertical-align: inherit;">否则，声明失败。</font><font style="vertical-align: inherit;">要了解这种情况发生时，先插入一行到</font></font><code class="literal">e2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是分区的分区定义的边界之外
         </font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font><code class="literal">e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，插入一个</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值太大</font><font style="vertical-align: inherit;">的行</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">然后，尝试再次与该分区交换表：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO e2 VALUES (51, "Ellen", "McDonald");</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.08秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1707（HY000）：找到与该分区不匹配的行</font></span></font><strong class="userinput"><code>ALTER TABLE e EXCHANGE PARTITION p0 WITH TABLE e2;</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有</font></font><code class="literal">WITHOUT VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项才能使此操作成功：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE e EXCHANGE PARTITION p0 WITH TABLE e2 WITHOUT VALIDATION;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.02秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当分区与包含与分区定义不匹配的行的表交换时，数据库管理员有责任修复不匹配的行，这可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font><font style="vertical-align: inherit;">执行
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... REPAIR PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h4><a name="idm140527982344256"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在没有逐行验证的情况下交换分区</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了避免在与具有多行的表交换分区时进行耗时的验证，可以通过附加</font></font><code class="literal">WITHOUT
        VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">来跳过逐行验证步骤</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下示例比较了使用非分区表交换分区时的执行时间与使用和不使用验证之间的差异。</font><font style="vertical-align: inherit;">分区表（表
         </font></font><code class="literal">e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）包含两个一百万行的分区。</font><font style="vertical-align: inherit;">表e的p0中的行被删除，p0与一百万行的未分区表交换。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">WITH
        VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作需要0.74秒。</font><font style="vertical-align: inherit;">相比之下，该</font></font><code class="literal">WITHOUT VALIDATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作需要0.01秒。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃在每个分区中创建一个包含100万行的分区表</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE e（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（id）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p0值小于（1000001），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p1的值小于（2000001），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT COUNT（*）FROM e;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">COUNT（*）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.27秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃查看每个分区中的行</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT PARTITION_NAME，TABLE_ROWS FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_NAME ='e';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建一个具有相同结构的非分区表，并用100万行填充它</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE e2（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; SELECT COUNT（*）FROM e2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">COUNT（*）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.24秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃创建另一个具有相同结构的非分区表，并用100万行填充它</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE e3（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（30）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
    <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; SELECT COUNT（*）FROM e3;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">COUNT（*）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.25秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃从表e的p0中删除行</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; DELETE FROM e WHERE id &lt;1000001;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1000000行受影响（5.55秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃确认分区p0中没有行</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; SELECT PARTITION_NAME，TABLE_ROWS FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_NAME ='e';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
    <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃将表e的分区p0与表e2'WITH VALIDATION'</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; ALTER TABLE e EXCHANGE PARTITION p0 WITH TABLE e2 WITH VALIDATION;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.74秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃确认分区与表e2交换</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; SELECT PARTITION_NAME，TABLE_ROWS FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_NAME ='e';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃再一次从表e的p0中删除行</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; DELETE FROM e WHERE id &lt;1000001;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1000000行受影响（5.55秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃确认分区p0中没有行</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; SELECT PARTITION_NAME，TABLE_ROWS FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_NAME ='e';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃使用表e3'WITHOUT VALIDATION'交换表e的分区p0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; ALTER TABLE e EXCHANGE PARTITION p0 WITH TABLE e3 WITHOUT VALIDATION;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.01秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃确认分区与表e3交换</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; SELECT PARTITION_NAME，TABLE_ROWS FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_NAME ='e';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">1000000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）    </font></font><font></font>
      </pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果分区与包含与分区定义不匹配的行的表交换，数据库管理员有责任修复不匹配的行，这可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font><font style="vertical-align: inherit;">执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... REPAIR PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h4><a name="idm140527982329312"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与非分区表交换子分区</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您还可以</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">与未</font><font style="vertical-align: inherit;">分区的表交换子分区表的子分区（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-subpartitions" title="22.2.6子分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.6节“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子分区</font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-subpartitions" title="22.2.6子分区"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">）
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE ...
        EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在下面的例子中，我们首先创建一个</font></font><code class="literal">es</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由分区</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和子分区的
         </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，填充此表格
         </font></font><code class="literal">e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后创建一个空</font></font><code class="literal">es2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的表格的</font><font style="vertical-align: inherit;">非分区副本</font><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE es (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>id INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>fname VARCHAR(30),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>lname VARCHAR(30)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION BY RANGE (id)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>SUBPARTITION BY KEY (lname)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>SUBPARTITIONS 2 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (50),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (100),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (150),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN (MAXVALUE)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（2.76秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO es VALUES</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(1669, "Jim", "Smith"),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(337, "Mary", "Jones"),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>(16, "Frank", "White"),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>(2005, "Linda", "Black");</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，4行受影响（0.04秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：4个重复：0个警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE es2 LIKE es;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（1.27秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE es2 REMOVE PARTITIONING;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.70秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        虽然创建表的时候，我们并没有明确指定任何的子分区</font></font><code class="literal">es</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以通过包括获取这些生成的名称
         </font></font><code class="literal">SUBPARTITION_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表从
         </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从该表中选择时，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME, SUBPARTITION_NAME, TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'es';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">SUBPARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">p0sp0 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">p0sp1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">p1sp0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">p1sp1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">p2sp0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">p2sp1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">p3sp0 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">p3sp1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
集合中的8行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下面
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的语句交流子分区
         </font></font><code class="literal">p3sp0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font><code class="literal">es</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与非分区表</font></font><code class="literal">es2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE es EXCHANGE PARTITION p3sp0 WITH TABLE es2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.29秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以通过发出以下查询来验证行是否已交换：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT PARTITION_NAME, SUBPARTITION_NAME, TABLE_ROWS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM INFORMATION_SCHEMA.PARTITIONS</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE TABLE_NAME = 'es';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">PARTITION_NAME | </font><font style="vertical-align: inherit;">SUBPARTITION_NAME | </font><font style="vertical-align: inherit;">TABLE_ROWS |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">p0sp0 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p0 | </font><font style="vertical-align: inherit;">p0sp1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">p1sp0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p1 | </font><font style="vertical-align: inherit;">p1sp1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">p2sp0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p2 | </font><font style="vertical-align: inherit;">p2sp1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">p3sp0 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">p3 | </font><font style="vertical-align: inherit;">p3sp1 | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------- + ------------------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
集合中的8行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM es2;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1669 | </font><font style="vertical-align: inherit;">吉姆| </font><font style="vertical-align: inherit;">史密斯|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">337 | </font><font style="vertical-align: inherit;">Mary | </font><font style="vertical-align: inherit;">琼斯|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2005 | </font><font style="vertical-align: inherit;">琳达| </font><font style="vertical-align: inherit;">黑色|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------- ------- + +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置3行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果表是子分区的，则只能交换表的子分区（不是整个分区）和未分区的表，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1704（HY000）：子分区表，使用子分区而不是分区</font></span></font><strong class="userinput"><code>ALTER TABLE es EXCHANGE PARTITION p3 WITH TABLE es2;</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL使用的表结构的比较非常严格。</font><font style="vertical-align: inherit;">分区表和非分区表的列和索引的数量，顺序，名称和类型必须完全匹配。</font><font style="vertical-align: inherit;">另外，两个表都必须使用相同的存储引擎：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE es3 LIKE e;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（1.31秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE es3 REMOVE PARTITIONING;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.53秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW CREATE TABLE es3\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       表：es3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建表：CREATE TABLE`es3`（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `id` int（11）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `fname` varchar（30）DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `lname` varchar（30）DEFAULT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB DEFAULT CHARSET = latin1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE es3 ENGINE = MyISAM;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.15秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1497（HY000）：在这个版本的MySQL中不允许混合分区中的处理程序</font></span></font><strong class="userinput"><code>ALTER TABLE es EXCHANGE PARTITION p3sp0 WITH TABLE es3;</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-maintenance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.4分区维护</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140527982276480"></a><a class="indexterm" name="idm140527982274992"></a><a class="indexterm" name="idm140527982273504"></a><a class="indexterm" name="idm140527982272016"></a><a class="indexterm" name="idm140527982270528"></a><a class="indexterm" name="idm140527982269040"></a><a class="indexterm" name="idm140527982267552"></a><a class="indexterm" name="idm140527982266064"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        大量的表和分区维护任务可以使用MySQL 5.7中的分区表上用于这种目的的SQL语句来执行。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区表的表维护可以使用语句来实现</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，被支撑为分区表。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以使用多个扩展来
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接在一个或多个分区上执行此类操作，如以下列表中所述：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重建分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              重建分区; </font><font style="vertical-align: inherit;">这与删除存储在分区中的所有记录的效果相同，然后重新插入它们。</font><font style="vertical-align: inherit;">这对于碎片整理很有用。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t1 REBUILD PARTITION p0，p1;
</font></font></pre></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果已经从一个分区删除大量行的，或者如果你已与可变长度行许多变化，以一个分区表（即，具有</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列），可以使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
              TABLE ... OPTIMIZE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以回收任何未使用的空间和整理分区数据文件。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t1 OPTIMIZE PARTITION p0，p1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><code class="literal">OPTIMIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定分区上相当于跑步</font></font><code class="literal">CHECK
            PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">ANALYZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">REPAIR PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该分区上。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一些MySQL存储引擎，包括
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，不支持每分区优化; </font><font style="vertical-align: inherit;">在这些情况下，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
            TABLE ... OPTIMIZE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析和重建整个表格，并发出适当的警告。</font><font style="vertical-align: inherit;">（错误＃11751825，错误＃42822）使用</font></font><code class="literal">ALTER TABLE
            ... REBUILD PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">ALTER TABLE ...
            ANALYZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是，以避免此问题。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这读取和存储分区的密钥分配。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t1 ANALYZE PARTITION p3;
</font></font></pre></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修复分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这修复了损坏的分区。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t1 REPAIR PARTITION p0，p1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常，</font></font><code class="literal">REPAIR PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区包含重复键错误时失败。</font><font style="vertical-align: inherit;">在MySQL 5.7.2和更高版本中，可以使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
            IGNORE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该选项，在这种情况下，由于存在重复密钥而无法移动的所有行都将从分区中删除（错误＃16900947）。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查分区。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您可以像使用</font></font><code class="literal">CHECK TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非分区表</font><font style="vertical-align: inherit;">一样检查分区是否有错误</font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE trb3 CHECK PARTITION p1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个命令会告诉你</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">表
             </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">的数据或索引</font><font style="vertical-align: inherit;">是否损坏。</font><font style="vertical-align: inherit;">如果是这种情况，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
            TABLE ... REPAIR PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修复分区。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常，</font></font><code class="literal">CHECK PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区包含重复键错误时失败。</font><font style="vertical-align: inherit;">在MySQL 5.7.2和更高版本中，您可以使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
            IGNORE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此选项，在这种情况下，该语句将返回发现重复密钥违例的分区中每行的内容。</font><font style="vertical-align: inherit;">仅报告表格的分区表达式中的列的值。</font><font style="vertical-align: inherit;">（Bug＃16900947）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        刚刚显示的列表中的每个语句还支持使用关键字</font></font><code class="literal">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替分区名称列表。</font><font style="vertical-align: inherit;">使用将</font></font><code class="literal">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致语句对表中的所有分区执行操作。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表不支持</font><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlcheck" title="4.5.3 mysqlcheck  - 一个表维护程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlcheck</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7中，你也可以使用截断分区</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE
        ... TRUNCATE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该语句可用于删除一个或多个分区中的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有行，这与从表</font><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">删除所有行</font><font style="vertical-align: inherit;">非常相似</font><font style="vertical-align: inherit;">。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE ...
        TRUNCATE PARTITION ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 截断表中的所有分区。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        到MySQL 5.7.2，在此之前</font></font><code class="literal">ANALYZE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">CHECK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">OPTIMIZE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">REBUILD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">REPAIR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><code class="literal">TRUNCATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作不允许在子分区（错误＃14028340，错误＃65184）。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-info"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.5获取有关分区的信息</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140527982202352"></a><a class="indexterm" name="idm140527982201296"></a><a class="indexterm" name="idm140527982200208"></a><a class="indexterm" name="idm140527982199120"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节讨论获取有关现有分区的信息，这些信息可以通过多种方式完成。</font><font style="vertical-align: inherit;">获得这些信息的方法包括以下内容：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE语法"><code class="literal">SHOW CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句查看用于创建分区表的分区子句。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS语法"><code class="literal">SHOW TABLE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句来确定表是否已分区。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查询
             </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">INFORMATION_SCHEMA.PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表格。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用该语句
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
            SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看给定的分区
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        正如本章其他部分所讨论的那样，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE语法"><code class="literal">SHOW CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其输出中包含</font></font><code class="literal">PARTITION BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于创建分区表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW CREATE TABLE trb3\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       表：trb3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建表：CREATE TABLE`trb3`（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `id` int（11）默认为NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `name` varchar（50）默认为NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `购买'日期默认为空</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = MyISAM DEFAULT CHARSET = latin1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（年份（购买））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PARTITION p0值小于（1990）ENGINE = MyISAM，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PARTITION p1值小于（1995）ENGINE = MyISAM，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PARTITION p2的值小于（2000）ENGINE = MyISAM，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PARTITION p3值小于（2005）ENGINE = MyISAM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS语法"><code class="literal">SHOW TABLE STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区表</font><font style="vertical-align: inherit;">
        的输出与非</font><font style="vertical-align: inherit;">分区表</font><font style="vertical-align: inherit;">的输出</font><font style="vertical-align: inherit;">相同，只是该</font></font><code class="literal">Create_options</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列包含字符串</font></font><code class="literal">partitioned</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该
         </font></font><code class="literal">Engine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列包含表的所有分区使用的存储引擎的名称。</font><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">有关此语句的更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#show-table-status" title="13.7.5.36 SHOW TABLE STATUS语法"><font style="vertical-align: inherit;">第13.7.5.36节“SHOW TABLE STATUS语法”</font></a><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您还可以从中获取有关分区的信息
         </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含一个
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第24.15节“INFORMATION_SCHEMA分区表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><a class="indexterm" name="idm140527982174880"></a><a class="indexterm" name="idm140527982173392"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">一个给定的</font><font style="vertical-align: inherit;">查询
         </font><font style="vertical-align: inherit;">来确定分区表中的哪些分区
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该
         </font></font><code class="literal">partitions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出列出了哪些记录将被查询匹配的分区。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设您</font></font><code class="literal">trb1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建并填充了如下</font><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE trb1（id INT，name VARCHAR（50），购买日期）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p0值小于（3），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p1的值小于（7），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p2的值小于（9），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p3值小于（11）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插入到trb1值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （1，'desk organizer'，'2003-10-15'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （2，'CD player'，'1993-11-05'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （3，'电视机'，'1996-03-10'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （4，'书柜'，'1982-01-10'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （5，'运动自行车'，'2004-05-09'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （6，'沙发'，'1987-06-05'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （7，'爆米花机'，'2001-11-22'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （8，'水族馆'，'1992-08-04'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （9，'学习台'，'1984-09-16'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （10，'熔岩灯'，'1998-12-25'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以看到在查询中使用了哪些分区
         </font></font><code class="literal">SELECT * FROM trb1;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM trb1\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格：trb1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：p0，p1，p2，p3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用filesort</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，搜索所有四个分区。</font><font style="vertical-align: inherit;">但是，如果将使用分区键的限制条件添加到查询中，则可以看到只扫描包含匹配值的分区，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM trb1 WHERE id &lt; 5\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格：trb1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：p0，p1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：在哪里使用</font></font><font></font>
</pre><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN </code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 还提供有关使用的密钥和可能的密钥的信息：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE trb1 ADD PRIMARY KEY (id);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，10行受影响（0.03秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：10重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM trb1 WHERE id &lt; 5\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格：trb1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：p0，p1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：主键</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：在哪里使用</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
        PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于检查针对未分区表的查询，则不会生成错误，但该</font></font><code class="literal">partitions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">始终为空
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        所述</font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的柱
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的输出显示表中的行的总数。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        另请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.8.2节“EXPLAIN语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="partitioning-pruning"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.4分区修剪</font></font></h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140527982146160"></a><a class="indexterm" name="idm140527982145088"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节讨论一种称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区修剪</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的优化
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">分区修剪背后的核心概念相对简单，可以描述为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要扫描无法匹配值的分区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设您有一个</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由此语句定义</font><font style="vertical-align: inherit;">的分区表
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    region_code TINYINT UNSIGNED NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    dob DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY RANGE（region_code）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0的值小于（64），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1的值小于（128），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p2值小于（192），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区p3的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      考虑你希望从这样的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">陈述中</font><font style="vertical-align: inherit;">获得结果的情况
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT fname，lname，region_code，dob</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    从t1开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    WHERE region_code&gt; 125 AND region_code &lt;130;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这是很容易看到，没有任何行应使之返回将在任一分区</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">p3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">也就是说，我们只需要在分区中搜索</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到匹配的行。</font><font style="vertical-align: inherit;">通过这样做，可以在寻找匹配的行时花费比查找表中所有分区所需的时间和精力更少的时间和精力。</font><font style="vertical-align: inherit;">这种</font><font style="vertical-align: inherit;">
      不需要的分区的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切除</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被称为
       </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修剪</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当优化程序可以在执行此查询时使用分区修剪时，查询的执行速度可能比针对包含相同列定义和数据的未分区表的相同查询快一个数量级。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在分区</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上执行修剪时
         </font><font style="vertical-align: inherit;">，由于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">的设计，所有分区都会打开，无论它们是否被检查</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着您必须有足够数量的文件描述符可用于覆盖表的所有分区。</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-myisam-file-descriptors" title="MyISAM和分区文件描述符用法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyISAM和分区文件描述符用法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此限制不适用于使用其他MySQL存储引擎（例如）的分区表
         </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      只要</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件可以缩减为以下两种情况之一，</font><font style="vertical-align: inherit;">优化程序就可以执行修剪
       </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal"><em class="replaceable"><code>partition_column</code></em> =
          <em class="replaceable"><code>constant</code></em></code>
        </p></li><li class="listitem"><p>
          <code class="literal"><em class="replaceable"><code>partition_column</code></em> IN
          (<em class="replaceable"><code>constant1</code></em>,
          <em class="replaceable"><code>constant2</code></em>, ...,
          <em class="replaceable"><code>constantN</code></em>)</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在第一种情况下，优化器仅评估给定值的分区表达式，确定哪个分区包含该值，并仅扫描此分区。</font><font style="vertical-align: inherit;">在许多情况下，等号可以与另一个算术比较来代替，包括</font></font><code class="literal">&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">&lt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">&gt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
       </font></font><code class="literal">&lt;&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="literal">BETWEEN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">使用的一些查询
       </font><font style="vertical-align: inherit;">也可以利用分区修剪。</font><font style="vertical-align: inherit;">请参阅本节后面的示例。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在第二种情况下，优化程序评估列表中每个值的分区表达式，创建匹配分区列表，然后仅扫描此分区列表中的分区。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL能够适用分区修剪
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
      </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前不能修剪报表。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      修剪也可以应用于短程，优化器可以将其转换为等效的值列表。</font><font style="vertical-align: inherit;">例如，在前面的例子中，该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句可以转换为</font></font><code class="literal">WHERE region_code IN (126, 127, 128,
      129)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后优化器可以确定列表中的前两个值在分区中
       </font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其余两个值在分区中
       </font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其他分区不包含相关值，因此不需要搜索匹配的行。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      优化程序还可以对</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及比较使用</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">LIST
      COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区的</font><font style="vertical-align: inherit;">表的多个列上的前述类型的条件
       </font><font style="vertical-align: inherit;">执行修剪
       </font><font style="vertical-align: inherit;">。
    </font></font></p><a class="indexterm" name="idm140527982101664"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      只要分区表达式包含一个等式或一个可以简化为一组等式的范围，或者分区表达式表示增加或减少的关系时，就可以应用此类优化。</font><font style="vertical-align: inherit;">当分区表达式使用</font><font style="vertical-align: inherit;">or
       </font><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">时，</font><font style="vertical-align: inherit;">修剪也可以应用于分区在a </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
       </font><font style="vertical-align: inherit;">上的表
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另外，在MySQL 5.7中，当分区表达式使用该</font><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">时，修剪可以应用于这样的表
       </font><font style="vertical-align: inherit;">。
    </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR()</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-days"><code class="literal">TO_DAYS()</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-seconds"><code class="literal">TO_SECONDS()</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      假设</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照此处所示定义的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">被分区到一</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t2（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    region_code TINYINT UNSIGNED NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    dob DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（年（dob））（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION d0值小于（1970），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION d1值小于（1975），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区d2值小于（1980），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区d3值小于（1985），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区d4值小于（1990），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区d5值小于（2000），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区d6的价值小于（2005），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区d7的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      下面的语句</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用分区修剪：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t2 WHERE dob ='1982-06-23';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE t2 SET region_code = 8 WHERE dob BETWEEN'1991-02-15'和'1997-04-25';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DELETE FROM t2 WHERE dob&gt; ='1984-06-21'AND dob &lt;='1999-06-21'</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在最后一条语句的情况下，优化器也可以如下操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到包含范围低端的分区</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p>
          <a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR('1984-06-21')</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生</font></font><code class="literal">1984</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在分区中找到
           </font><font style="vertical-align: inherit;">的值</font></font><code class="literal">d3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到包含范围高端的分区</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p>
          <a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR('1999-06-21')</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估为
           </font></font><code class="literal">1999</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它在分区中找到
           </font></font><code class="literal">d5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只扫描这两个分区和可能位于它们之间的任何分区</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下，这意味着只有分区
           </font></font><code class="literal">d3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">d4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
           </font></font><code class="literal">d5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被扫描。</font><font style="vertical-align: inherit;">剩下的分区可以安全地忽略（并且被忽略）。
</font></font></p></li></ol>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在</font><font style="vertical-align: inherit;">针对分区表的语句条件中</font><font style="vertical-align: inherit;">引用的</font><font style="vertical-align: inherit;">
        无效</font><font style="vertical-align: inherit;">值</font></font><code class="literal">DATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">DATETIME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被视为
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着诸如</font><font style="vertical-align: inherit;">不返回任何值</font><font style="vertical-align: inherit;">的查询
         </font><font style="vertical-align: inherit;">（请参阅错误＃40972）。
</font></font><code class="literal">SELECT * FROM
        <em class="replaceable"><code>partitioned_table</code></em> WHERE
        <em class="replaceable"><code>date_column</code></em> &lt;
        '2008-12-00'</code><font style="vertical-align: inherit;"></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      到目前为止，我们只查看使用</font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区的</font><font style="vertical-align: inherit;">示例
       </font><font style="vertical-align: inherit;">，但修剪也可以与其他分区类型一起应用。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      考虑</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表达式在分区表达式增加或减少的情况下分区的表格，例如</font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处显示</font><font style="vertical-align: inherit;">的表格</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（在这个例子中，为了简洁起见，我们假定
       </font></font><code class="literal">region_code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列被限制在1到10之间的值）。
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t3（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    region_code TINYINT UNSIGNED NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    dob DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY LIST（region_code）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION r0值（1，3），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION r1值（2，5，8），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （4，9）中的分区r2值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （6，7，10）中的分区r3值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于这样的语句</font></font><code class="literal">SELECT * FROM t3 WHERE
      region_code BETWEEN 1 AND 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，优化器确定在哪个分区中找到值1,2和3 </font></font><code class="literal">r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">r1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并跳过剩下的（</font></font><code class="literal">r2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">r3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于由分区表</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">[LINEAR] KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，分区修剪也可以在其中的情况下</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句使用一个简单的</font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对在分隔表达式中使用的列的关系。</font><font style="vertical-align: inherit;">考虑一个像这样创建的表格：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t4（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（50）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    region_code TINYINT UNSIGNED NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    dob DATE NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按键分区（region_code）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区8;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可以修剪将列值与常数进行比较的语句：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE t4 WHERE region_code = 7;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      修剪也可以用于短距离，因为优化器可以将这些条件转化为</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      关系。</font><font style="vertical-align: inherit;">例如，使用与</font></font><code class="literal">t4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      之前定义的</font><font style="vertical-align: inherit;">表相同的表格</font><font style="vertical-align: inherit;">，可以修剪这些查询：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t4 WHERE region_code&gt; 2 AND region_code &lt;6;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t4 WHERE region_code BETWEEN 3 AND 5;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在这两种情况下，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化程序都会</font><font style="vertical-align: inherit;">将该</font><font style="vertical-align: inherit;">子句转换为</font></font><code class="literal">WHERE region_code IN
      (3, 4, 5)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        仅当范围大小小于分区数时才使用此优化。</font><font style="vertical-align: inherit;">考虑这个说法：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DELETE FROM t4 WHERE region_code BETWEEN 4 AND 12;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        中相应的范围</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句涵盖9个值（4，5，6，7，8，9，10，11，12），但</font></font><code class="literal">t4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅具有8个分区。</font><font style="vertical-align: inherit;">这意味着</font></font><code class="literal">DELETE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不能修剪。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当一个表由</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
       </font><font style="vertical-align: inherit;">分割时</font></font><code class="literal">[LINEAR] KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，修剪只能在整数列上使用。</font><font style="vertical-align: inherit;">例如，这个语句不能使用修剪，因为它</font></font><code class="literal">dob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t4 WHERE dob&gt; ='2001-04-14'AND dob &lt;='2005-10-15';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      但是，如果该表在一</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">INT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">中存储年份值
       </font><font style="vertical-align: inherit;">，则</font></font><code class="literal">WHERE year_col &gt;= 2001 AND year_col &lt;=
      2005</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以修剪</font><font style="vertical-align: inherit;">具有该查询的查询
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在MySQL 5.7.1之前，使用提供自动分区的</font></font><code class="literal">NDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">（例如</font><font style="vertical-align: inherit;">NDB集群</font><font style="vertical-align: inherit;">使用的存储引擎）禁用所有表的分区修剪</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（错误＃14672885）从MySQL 5.7.1开始，如果这些表被明确分区，它们可以被修剪。</font><font style="vertical-align: inherit;">（错误＃14827952）
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="partitioning-selection"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.5分区选择</font></font></h2>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL 5.7支持显式选择分区和子分区，在执行语句时，应检查是否符合给定</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      条件的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">分区选择类似于分区修剪，因为只检查特定分区的匹配，但在两个关键方面有所不同：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要检查的分区由语句的发布者指定，不像分区修剪是自动的。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          尽管分区修剪仅适用于查询，但对于查询和许多DML语句都支持显式选择分区。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这里列出了支持显式分区选择的SQL语句：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-xml" title="13.2.7 LOAD XML语法"><code class="literal">LOAD XML</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节的其余部分讨论显式分区选择，因为它通常适用于刚刚列出的语句，并提供了一些示例。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      显式分区选择是使用</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">实现的
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于所有支持的语句，该选项使用此处显示的语法：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">      PARTITION（</font></font><em class="replaceable"><code>partition_names</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font>
<font></font>
      <em class="replaceable"><code>partition_names</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
           </font></font><em class="replaceable"><code>partition_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该选项总是遵循该分区所属的表的名称。
      </font></font><em class="replaceable"><code>partition_names</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是要使用的分区或子分区的逗号分隔列表。</font><font style="vertical-align: inherit;">此列表中的每个名称必须是指定表的现有分区或子分区的名称; </font><font style="vertical-align: inherit;">如果没有找到任何分区或子分区，则语句会失败并显示错误（</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区' </font></font><em class="replaceable"><code>partition_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'不存在</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">指定的分区和子分区
       </font></font><em class="replaceable"><code>partition_names</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以按任意顺序列出，并可能重叠。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用该</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项时，只检查列出的分区和子分区以检查匹配的行。</font><font style="vertical-align: inherit;">此选项可用于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      语句中以确定哪​​些行属于给定的分区。</font><font style="vertical-align: inherit;">考虑一个名为分区表</font></font><code class="literal">employees</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用以下显示的语句创建和填充：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @@ SQL_MODE ='';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE employees（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    fname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    lname VARCHAR（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    store_id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    department_id INT NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按范围划分（id）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p0值小于（5），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p1的值小于（10），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        PARTITION p2的值小于（15），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区p3的值小于MAXVALUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO员工VALUES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Bob'，'Taylor'，3,2），（''，'Frank'，'Williams'，1,2），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Ellen'，'Johnson'，3,4），（''，'Jim'，'Smith'，2，4），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'玛丽'，'琼斯'，1，1），（''，'琳达'，'黑'，2，3），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Ed'，'Jones'，2,1），（''，'June'，'Wilson'，3,1），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Andy'，'Smith'，1,3），（''，'Lou'，'Waters'，2,4），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Jill'，'Stone'，1,4），（''，'Roger'，'White'，3,2），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Howard'，'Andrews'，1,2），（''，'Fred'，'Goldberg'，3，3），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'芭芭拉'，'布朗'，2，3），（''，'爱丽丝'，'罗杰斯'，2，2），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Mark'，'Morgan'，3，3），（''，'Karen'，'Cole'，3，2）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以看到哪些行存储在分区中，
       </font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM employees PARTITION (p1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- + -------- + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname | </font><font style="vertical-align: inherit;">store_id | </font><font style="vertical-align: inherit;">department_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- + -------- + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">Mary | </font><font style="vertical-align: inherit;">琼斯| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">琳达| </font><font style="vertical-align: inherit;">黑色| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">Ed | </font><font style="vertical-align: inherit;">琼斯| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">六月| </font><font style="vertical-align: inherit;">威尔逊| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">安迪| </font><font style="vertical-align: inherit;">史密斯| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- + -------- + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      结果与查询获得的结果相同</font></font><code class="literal">SELECT *
      FROM employees WHERE id BETWEEN 5 AND 9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要从多个分区获取行，请将其名称作为逗号分隔列表提供。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">SELECT * FROM
      employees PARTITION (p1, p2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回分区中的所有行，</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从其余分区中排除行。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      针对分区表的任何有效查询都可以用一个</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来</font><font style="vertical-align: inherit;">重写，</font><font style="vertical-align: inherit;">以将结果限制为一个或多个所需的分区。</font><font style="vertical-align: inherit;">您可以使用
       </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      和</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项等。</font><font style="vertical-align: inherit;">您也可以使用集合函数</font></font><code class="literal">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font></font><code class="literal">employees</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照以前定义的方式</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">表格上</font><font style="vertical-align: inherit;">运行时，以下每个查询都会生成有效结果
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT * FROM employees PARTITION (p0, p2)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE lname LIKE 'S%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname | </font><font style="vertical-align: inherit;">store_id | </font><font style="vertical-align: inherit;">department_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">吉姆| </font><font style="vertical-align: inherit;">史密斯| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">吉尔| </font><font style="vertical-align: inherit;">石头| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT id, CONCAT(fname, ' ', lname) AS name</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>FROM employees PARTITION (p0) ORDER BY lname;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">名称|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">埃伦约翰逊|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">吉姆史密斯|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">鲍勃泰勒|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">弗兰克威廉斯|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4行（0.06秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT store_id, COUNT(department_id) AS c</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>FROM employees PARTITION (p1,p2,p3)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>GROUP BY store_id HAVING c &gt; 4;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+  -  + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">c | </font><font style="vertical-align: inherit;">store_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+  -  + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+  -  + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用分区选择的语句可以使用MySQL 5.7支持的任何分区类型。</font><font style="vertical-align: inherit;">当使用创建表</font></font><code class="literal">[LINEAR]
      HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">[LINEAR] KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区而不是指定分区的名字，MySQL的自动命名分区</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...
       </font><font style="vertical-align: inherit;">，那里
       </font><font style="vertical-align: inherit;">是分区的数量。</font><font style="vertical-align: inherit;">对于子分区不明确命名，MySQL的自动分配到每个分区中的子分区
       </font><font style="vertical-align: inherit;">的名称
       </font><font style="vertical-align: inherit;">，
       </font><font style="vertical-align: inherit;">，
       </font><font style="vertical-align: inherit;">，...
       </font><font style="vertical-align: inherit;">，那里</font><font style="vertical-align: inherit;">是子分区的数量。</font><font style="vertical-align: inherit;">在对这个表执行时a
      </font></font><code class="literal">p<em class="replaceable"><code>N-1</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font><code class="literal">p<em class="replaceable"><code>X</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">p<em class="replaceable"><code>X</code></em>sp0</code><font style="vertical-align: inherit;"></font><code class="literal">p<em class="replaceable"><code>X</code></em>sp1</code><font style="vertical-align: inherit;"></font><code class="literal">p<em class="replaceable"><code>X</code></em>sp2</code><font style="vertical-align: inherit;"></font><code class="literal">p<em class="replaceable"><code>X</code></em>sp<em class="replaceable"><code>M-1</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或其他允许显式分区选择的SQL语句），您可以在一个</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项中</font><font style="vertical-align: inherit;">使用这些生成的名称</font><font style="vertical-align: inherit;">，如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE employees_sub  (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>id INT NOT NULL AUTO_INCREMENT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>fname VARCHAR(25) NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>lname VARCHAR(25) NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>store_id INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>department_id INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PRIMARY KEY pk (id, lname)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
    - &gt;      </font></font><strong class="userinput"><code>PARTITION BY RANGE(id)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>SUBPARTITION BY KEY (lname)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>SUBPARTITIONS 2 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (5),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (10),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (15),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN MAXVALUE</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（1.14秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO employees_sub</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   ＃在雇员表中重新使用数据</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>SELECT * FROM employees;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，18行受影响（0.09秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：18重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SELECT id, CONCAT(fname, ' ', lname) AS name</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>FROM employees_sub PARTITION (p2sp1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">名称|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">Lou Waters |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">14 | </font><font style="vertical-align: inherit;">弗雷德戈德堡|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您也</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在</font><font style="vertical-align: inherit;">声明</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分
       </font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">选项
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT ...
      SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CREATE TABLE employees_copy LIKE employees;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.28秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO employees_copy</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>SELECT * FROM employees PARTITION (p2);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，5行受影响（0.04秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：5个重复：0个警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM employees_copy;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + -------- + ---------- + ---------- + ------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname | </font><font style="vertical-align: inherit;">store_id | </font><font style="vertical-align: inherit;">department_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + -------- + ---------- + ---------- + ------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">Lou | </font><font style="vertical-align: inherit;">沃特世| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">吉尔| </font><font style="vertical-align: inherit;">石头| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">12 | </font><font style="vertical-align: inherit;">罗杰| </font><font style="vertical-align: inherit;">白色| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">13 | </font><font style="vertical-align: inherit;">霍华德| </font><font style="vertical-align: inherit;">安德鲁斯| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">14 | </font><font style="vertical-align: inherit;">弗雷德| </font><font style="vertical-align: inherit;">Goldberg | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">3 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + -------- + ---------- + ---------- + ------------- -  +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      分区选择也可以用于连接。</font><font style="vertical-align: inherit;">假设我们使用这里显示的语句创建并填充两个表：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE存储（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    city VARCHAR（30）NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION BY HASH（id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区2;</font></font><font></font>
  <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO存储VALUES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Nambucca'），（''，'Uranga'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Bellingen'），（''，'Grafton'）;</font></font><font></font>
  <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE部门（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    名称VARCHAR（30）NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    按键分区（id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区2;</font></font><font></font>
  <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO部门VALUES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'销售'），（''，'客户服务'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （''，'Delivery'），（''，'Accounting'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以明确地从联接中的任何或所有表中选择分区（或子分区，或两者）。</font><font style="vertical-align: inherit;">（</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于从给定表中选择分区</font><font style="vertical-align: inherit;">的
       </font><font style="vertical-align: inherit;">选项紧跟在表的名称之后，位于所有其他选项（包括任何表别名）之前）。例如，以下查询将获取所有员工的姓名，职员ID，部门和城市谁在销售或交付部门工作（分区</font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的
       </font></font><code class="literal">departments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在商店表）在任的Nambucca和贝林根（分区的城市
       </font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font></font><code class="literal">stores</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表）：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SELECT</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>e.id AS 'Employee ID', CONCAT(e.fname, ' ', e.lname) AS Name,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>s.city AS City, d.name AS department</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>FROM employees AS e</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>JOIN stores PARTITION (p1) AS s ON e.store_id=s.id</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>JOIN departments PARTITION (p0) AS d ON e.department_id=d.id</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>ORDER BY e.lname;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- + ----------- + ------- ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">员工ID | </font><font style="vertical-align: inherit;">名称| </font><font style="vertical-align: inherit;">城市| </font><font style="vertical-align: inherit;">部门|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- + ----------- + ------- ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">14 | </font><font style="vertical-align: inherit;">弗雷德戈德堡| </font><font style="vertical-align: inherit;">Bellingen | </font><font style="vertical-align: inherit;">送货|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">玛丽琼斯| </font><font style="vertical-align: inherit;">Nambucca | </font><font style="vertical-align: inherit;">销售|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">17 | </font><font style="vertical-align: inherit;">马克摩根| </font><font style="vertical-align: inherit;">Bellingen | </font><font style="vertical-align: inherit;">送货|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">安迪史密斯| </font><font style="vertical-align: inherit;">Nambucca | </font><font style="vertical-align: inherit;">送货|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">June Wilson | </font><font style="vertical-align: inherit;">Bellingen | </font><font style="vertical-align: inherit;">销售|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------- + --------------- + ----------- + ------- ----- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5行（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关MySQL中连接的一般信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#join" title="13.2.9.2 JOIN语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.9.2节“JOIN语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当该</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句一起</font><font style="vertical-align: inherit;">使用时
       </font><font style="vertical-align: inherit;">，只会检查使用该选项列出的那些分区（以及子分区，如果有的话）是否要删除要删除的行。</font><font style="vertical-align: inherit;">任何其他分区都将被忽略，如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM employees WHERE fname LIKE 'j%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- + -------- + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname | </font><font style="vertical-align: inherit;">store_id | </font><font style="vertical-align: inherit;">department_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- + -------- + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">吉姆| </font><font style="vertical-align: inherit;">史密斯| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">六月| </font><font style="vertical-align: inherit;">威尔逊| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">吉尔| </font><font style="vertical-align: inherit;">石头| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- + -------- + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置3行（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>DELETE FROM employees PARTITION (p0, p1)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>WHERE fname LIKE 'j%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，2行受影响（0.09秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM employees WHERE fname LIKE 'j%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname | </font><font style="vertical-align: inherit;">store_id | </font><font style="vertical-align: inherit;">department_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">吉尔| </font><font style="vertical-align: inherit;">石头| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      只有在分区中的两行</font></font><code class="literal">p0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
       </font></font><code class="literal">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符合</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      条件被删除。</font><font style="vertical-align: inherit;">正如您从</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二次运行</font><font style="vertical-align: inherit;">结果中所看到的，
       </font><font style="vertical-align: inherit;">表中仍然有一行匹配</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      条件，但位于不同的分区（</font></font><code class="literal">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中。
    </font></font></p><p>
      <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用显式分区选择的语句的行为方式相同; </font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在确定要更新的行时，</font><font style="vertical-align: inherit;">只会</font><font style="vertical-align: inherit;">考虑</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">引用的分区中</font><font style="vertical-align: inherit;">的行，如执行以下语句所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>UPDATE employees PARTITION (p0) </code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>SET store_id = 2 WHERE fname = 'Jill';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
匹配的行数：0已更改：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM employees WHERE fname = 'Jill';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname | </font><font style="vertical-align: inherit;">store_id | </font><font style="vertical-align: inherit;">department_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">吉尔| </font><font style="vertical-align: inherit;">石头| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>UPDATE employees PARTITION (p2)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>SET store_id = 2 WHERE fname = 'Jill';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.09秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
匹配行数：1更改：1警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM employees WHERE fname = 'Jill';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">fname | </font><font style="vertical-align: inherit;">lname | </font><font style="vertical-align: inherit;">store_id | </font><font style="vertical-align: inherit;">department_id |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">吉尔| </font><font style="vertical-align: inherit;">石头| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------- ------- + + ---------- + --------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以同样的方式</font></font><code class="literal">PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用时
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只检查分区列表中指定的一个或多个分区中的行以进行删除。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于插入行的语句，行为会有所不同，因为找不到合适的分区会导致语句失败。</font><font style="vertical-align: inherit;">这两个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">都是如此</font><font style="vertical-align: inherit;">，如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1729（HY000）：发现一行不符合给定的分区集</font></span><font style="vertical-align: inherit;"> 
mysql&gt;</font></font><strong class="userinput"><code>INSERT INTO employees PARTITION (p2) VALUES (20, 'Jan', 'Jones', 1, 3);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font><strong class="userinput"><code>INSERT INTO employees PARTITION (p3) VALUES (20, 'Jan', 'Jones', 1, 3);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，1行受影响（0.07秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; REPLACE INTO employees PARTITION（p0）VALUES（20，'Jan'，'Jones'，3，2）;</font></font><font></font>
<span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1729（HY000）：发现一行不符合给定的分区集</font></font></span><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; REPLACE INTO employees PARTITION（p3）VALUES（20，'Jan'，'Jones'，3，2）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，2行受影响（0.09秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于将多行写入使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">的分区表的语句</font><font style="vertical-align: inherit;">：如果列表中的任何行</font></font><code class="literal">VALUES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能写入</font></font><em class="replaceable"><code>partition_names</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表中</font><font style="vertical-align: inherit;">指定的分区之一
       </font><font style="vertical-align: inherit;">，则整个语句将失败并且不会写入行。</font><font style="vertical-align: inherit;">这</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下示例中</font><font style="vertical-align: inherit;">显示为
       </font><font style="vertical-align: inherit;">语句，重用</font></font><code class="literal">employees</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前创建</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>ALTER TABLE employees</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>REORGANIZE PARTITION p3 INTO (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN (20),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p4 VALUES LESS THAN (25),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p5 VALUES LESS THAN MAXVALUE</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，6行受影响（2.09秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：6重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW CREATE TABLE employees\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       表：员工</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建表：CREATE TABLE`employees`（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `id` int（11）NOT NULL AUTO_INCREMENT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `fname` varchar（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `lname` varchar（25）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `store_id` int（11）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `department_id` int（11）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PRIMARY KEY（`id`）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB AUTO_INCREMENT = 27 DEFAULT CHARSET = latin1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ *！50100 PARTITION BY RANGE（id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（PARTITION p0值小于（5）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p1值小于（10）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p2的值小于（15）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p3值小于（20）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p4的值小于（25）ENGINE = InnoDB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION p5的值小于MAXVALUE ENGINE = InnoDB）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO employees PARTITION (p3, p4) VALUES</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>(24, 'Tim', 'Greene', 3, 1),  (26, 'Linda', 'Mills', 2, 1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1729（HY000）：发现一行不符合给定的分区集</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO employees PARTITION (p3, p4. p5) VALUES</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>(24, 'Tim', 'Greene', 3, 1),  (26, 'Linda', 'Mills', 2, 1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，2行受影响（0.06秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：2重复：0警告：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于</font><font style="vertical-align: inherit;">写入多行的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，</font><font style="vertical-align: inherit;">前面的内容都是正确的
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在MySQL 5.7.1及更高版本中，对于使用提供自动分区的存储引擎的表，禁用分区选择</font></font><code class="literal">NDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（错误＃14827952）
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="partitioning-limitations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6分区的限制和限制</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.1分区键，主键和唯一键</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-storage-engines"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.2有关存储引擎的分区限制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-functions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.3与功能相关的分区限制</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.4分区和锁定</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140527981875184"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节讨论当前对MySQL分区支持的限制和限制。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁止构造。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区表达式中不允许使用以下结构：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          存储过程，存储函数，UDF或插件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          声明的变量或用户变量。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关分区表达式中允许的SQL函数列表，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-functions" title="22.6.3与功能相关的分区限制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.6.3节“关于函数的分区限制”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算术和逻辑运算符。&nbsp;</font></font></b>
        <a class="indexterm" name="idm140527981867696"></a>

        <a class="indexterm" name="idm140527981866176"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

        使用算术运算符
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_plus"><code class="literal">+</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_minus"><code class="literal">-</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_times"><code class="literal">*</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在分区表达式中被允许。</font><font style="vertical-align: inherit;">但是，结果必须是整数值或</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（除非在</font></font><code class="literal">[LINEAR] KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">的情况下
         </font><font style="vertical-align: inherit;">，如本章其他部分所讨论; </font><font style="vertical-align: inherit;">有关更多信息，</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-types" title="22.2分区类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2节“分区类型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_div"><code class="literal">DIV</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运营商也支持，而</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_divide"><code class="literal">/</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运营商是不允许的。</font><font style="vertical-align: inherit;">（错误＃30188，错误＃33182）
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该位运营商
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_bitwise-or"><code class="literal">|</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_bitwise-and"><code class="literal">&amp;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_bitwise-xor"><code class="literal">^</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_left-shift"><code class="literal">&lt;&lt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_right-shift"><code class="literal">&gt;&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
       </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_bitwise-invert"><code class="literal">~</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有在分区表达式允许的。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HANDLER报表。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以前，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#handler" title="13.2.4 HANDLER语法"><code class="literal">HANDLER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表不支持分区表。</font><font style="vertical-align: inherit;">这个限制从MySQL 5.7.1开始被删除。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器SQL模式。&nbsp;</font></font></b>
        <a class="indexterm" name="idm140527981844256"></a>

        <a class="indexterm" name="idm140527981842768"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

        使用用户定义的分区的表不保留在创建时有效的SQL模式。</font><font style="vertical-align: inherit;">如</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#sql-mode" title="5.1.8服务器SQL模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.8节“服务器SQL模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中所述，许多MySQL函数和运算符的结果可能会根据服务器SQL模式而改变。</font><font style="vertical-align: inherit;">因此，在创建分区表后随时更改SQL模式可能会导致此类表的行为发生重大变化，并且很容易导致数据损坏或丢失。</font><font style="vertical-align: inherit;">出于这些原因，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强烈建议您在创建分区表后不要更改服务器SQL模式</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例子。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下示例说明了由于服务器SQL模式更改而导致的分区表行为的一些变化：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误处理。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设您创建一个分区表，其分区表达式是一个如
             </font></font><code class="literal"><em class="replaceable"><code>column</code></em> DIV 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或</font></font><code class="literal"><em class="replaceable"><code>column</code></em> MOD
            0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE tn (c1 INT)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION BY LIST(1 DIV c1) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;        </font></font><strong class="userinput"><code>PARTITION p0 VALUES IN (NULL),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;        </font></font><strong class="userinput"><code>PARTITION p1 VALUES IN (1)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.05秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL的默认行为是返回
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">零除结果而不产生任何错误：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@sql_mode;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ sql_mode |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>INSERT INTO tn VALUES (NULL), (0), (1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，3行受影响（0.00秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：3重复：0警告：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          但是，如果将服务器SQL模式更改为将零除以错误并强制执行严格的错误处理，则会导致相同的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句失败，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET sql_mode='STRICT_ALL_TABLES,ERROR_FOR_DIVISION_BY_ZERO';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1365（22012）：除以0</font></span></font><strong class="userinput"><code>INSERT INTO tn VALUES (NULL), (0), (1);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表可访问性。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有时，服务器SQL模式的更改可能会导致分区表无法使用。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有在</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_unsigned_subtraction"><code class="literal">NO_UNSIGNED_SUBTRACTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            模式</font><font style="vertical-align: inherit;">有效时，才能成功执行</font><font style="vertical-align: inherit;">以下
             </font><font style="vertical-align: inherit;">语句
             </font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@sql_mode;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ sql_mode |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE tu (c1 BIGINT UNSIGNED)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;    </font></font><strong class="userinput"><code>PARTITION BY RANGE(c1 - 10) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (-5),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (0),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (5),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN (10),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p4 VALUES LESS THAN (MAXVALUE)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font><span class="errortext"><font style="vertical-align: inherit;">ERROR 1563（HY000）：分区常量超出分区功能域</font></span></font><strong class="userinput"><code>);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SET sql_mode='NO_UNSIGNED_SUBTRACTION';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@sql_mode;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ sql_mode |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NO_UNSIGNED_SUBTRACTION |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE tu (c1 BIGINT UNSIGNED)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;    </font></font><strong class="userinput"><code>PARTITION BY RANGE(c1 - 10) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (-5),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (0),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (5),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN (10),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p4 VALUES LESS THAN (MAXVALUE)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.05秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_no_unsigned_subtraction"><code class="literal">NO_UNSIGNED_SUBTRACTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在创建后</font><font style="vertical-align: inherit;">删除
           </font><font style="vertical-align: inherit;">服务器SQL模式</font></font><code class="literal">tu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则可能无法再访问此表：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET sql_mode='';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1563（HY000）：分区常量超出分区功能域</font></span><font style="vertical-align: inherit;"> 
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1563（HY000）：分区常量超出分区功能域</font></span></font><strong class="userinput"><code>SELECT * FROM tu;</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font><strong class="userinput"><code>INSERT INTO tu VALUES (20);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#sql-mode" title="5.1.8服务器SQL模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.8节“服务器SQL模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      服务器SQL模式也会影响分区表的复制。</font><font style="vertical-align: inherit;">主站和从站上不同的SQL模式可导致分区表达式的计算方式不同; </font><font style="vertical-align: inherit;">这可能会导致分区间的数据分配在给定表的主从副本中不同，甚至可能会导致插入到主分区成功的分区表中，从而导致从分区故障。</font><font style="vertical-align: inherit;">为了获得最佳结果，您应始终在主服务器和从服务器上使用相同的服务器SQL模式。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能考虑。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表给出了分区操作对性能的一些影响：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="partitioning-limitations-file-system-ops"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统操作。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            分区和重新分区操作（如
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="literal">PARTITION BY ...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">REORGANIZE PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">REMOVE
            PARTITIONING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）依赖于文件系统操作的实施。</font><font style="vertical-align: inherit;">这意味着这些操作的速度受文件系统类型和特征，磁盘速度，交换空间，操作系统的文件处理效率，以及与服务器文件处理有关的MySQL服务器选项和变量等因素的影响。</font><font style="vertical-align: inherit;">尤其是，您应确保
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_large_files_support"><code class="literal">large_files_support</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已启用并且
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_open_files_limit"><code class="literal">open_files_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置正确。</font><font style="vertical-align: inherit;">对于使用</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">分区表
             </font><font style="vertical-align: inherit;">，增加
            </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可能会提高性能; </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过启用，</font><font style="vertical-align: inherit;">涉及</font><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">分区和重新分区操作</font><font style="vertical-align: inherit;">可以变得更高效
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-max-partitions" title="分区的最大数量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区的最大数量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><a name="partitioning-limitations-myisam-file-descriptors"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyISAM和分区文件描述符用法。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于分区</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，MySQL为每个分区打开2个文件描述符。</font><font style="vertical-align: inherit;">这意味着您需要更多的文件描述符才能在分区</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上</font><font style="vertical-align: inherit;">执行操作，而</font><font style="vertical-align: inherit;">不是在与其相同的表</font><font style="vertical-align: inherit;">上执行操作，
             </font><font style="vertical-align: inherit;">只是后者表未分区，特别是在执行
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作时。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有100个分区，如通过这条SQL语句创建的表：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t（c1 VARCHAR（50））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按键分区（c1）分区100</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ENGINE = MYISAM;</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为简洁起见，我们</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对此示例中所示的表</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">分区，但此处所述的文件描述符用法适用于所有分区
             </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，而不管所使用的分区类型如何。</font><font style="vertical-align: inherit;">使用其他存储引擎进行分区表
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不受此问题的影响。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在假定你想重新分区</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ，使它有101个分区，使用这里显示的语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t PARTITION BY KEY（c1）PARTITIONS 101;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了处理这个</font></font><code class="literal">ALTER TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，MySQL使用了402个文件描述符 - 即100个原始分区中的每一个分别有两个文件描述符，另外还有两个用于101个新分区中的每一个。</font><font style="vertical-align: inherit;">这是因为在重组表数据期间必须同时打开所有分区（旧的和新的）。</font><font style="vertical-align: inherit;">建议，如果您希望执行此类操作，则应确保该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_open-files-limit"><code class="option">--open-files-limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置不会太低以至于无法适应这些操作。
        </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表锁。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通常，对表执行分区操作的进程会对该表进行写锁定。</font><font style="vertical-align: inherit;">从这些表中读取相对不受影响; </font><font style="vertical-align: inherit;">分区操作完成后立即执行</font><font style="vertical-align: inherit;">挂起
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作。</font><font style="vertical-align: inherit;">有关</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此限制的特定例外，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#online-ddl-partitioning" title="14.13.7分区表的联机DDL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.13.7节“分区表的联机DDL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            分区操作，查询和更新操作通常</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            比使用</font><font style="vertical-align: inherit;">表</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">更快</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指标; </font><font style="vertical-align: inherit;">分区修剪。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与非分区表一样，正确使用索引可以显着加快分区表上的查询速度。</font><font style="vertical-align: inherit;">此外，在这些表上设计分区表和查询以利用
             </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区修剪</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可显着提高性能。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning" title="22.4分区修剪"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning" title="22.4分区修剪"><font style="vertical-align: inherit;">第22.4节“分区修剪”</font></a><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以前，分区表不支持索引条件下推。</font><font style="vertical-align: inherit;">MySQL 5.7.3中删除了这个限制。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-condition-pushdown-optimization" title="8.2.1.5索引条件下推优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.5节“索引条件下推优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载数据的性能。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在MySQL 5.7中，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
            DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用缓冲来提高性能。</font><font style="vertical-align: inherit;">您应该知道缓冲区使用每个分区130 KB的内存来实现此目的。
</font></font></p></li></ul>
</div>
<p><a name="partitioning-limitations-max-partitions"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区的最大数量。&nbsp;</font></font></b><a class="indexterm" name="idm140527981738640"></a><a class="indexterm" name="idm140527981737136"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不使用</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">的给定表的最大可能分区数</font><font style="vertical-align: inherit;">为8192.此数字包含子分区。
      </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据所使用的NDB Cluster软件的版本，数据节点的数量和其他因素确定</font><font style="vertical-align: inherit;">
      使用</font><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">的表的最大可能数量的用户定义分区</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息，</font><font style="vertical-align: inherit;">请参阅
       </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-nodes-groups-user-partitioning" title="NDB和用户定义的分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDB和用户定义的分区</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果在创建包含大量分区（但小于最大值）的表时遇到错误消息，例如</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自存储引擎</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的错误消息
       </font><span class="errortext"><font style="vertical-align: inherit;">：打开文件时资源不足</font></span><font style="vertical-align: inherit;">，您可能可以解决问题通过增加</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_open_files_limit"><code class="literal">open_files_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，这取决于操作系统，并且在所有平台上可能都不可行或不可取; </font><font style="vertical-align: inherit;">有关更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#not-enough-file-handles" title="B.5.2.17未找到文件和类似的错误"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#not-enough-file-handles" title="B.5.2.17未找到文件和类似的错误"><font style="vertical-align: inherit;">第B.5.2.17节“找不到文件和类似的错误”</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在某些情况下，由于其他问题，使用大量（数百个）分区也可能不可取，因此使用更多分区不会自动导致更好的结果。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      另请参阅
       </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-file-system-ops" title="文件系统操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件系统操作</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询缓存不受支持。&nbsp;</font></font></b><a class="indexterm" name="idm140527981725648"></a><a class="indexterm" name="idm140527981724160"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区表不支持查询缓存，并且在涉及分区表的查询中自动禁用查询缓存。</font><font style="vertical-align: inherit;">查询缓存无法启用此类查询。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每分区键缓存。&nbsp;</font></font></b><a class="indexterm" name="idm140527981721248"></a><a class="indexterm" name="idm140527981719760"></a><a class="indexterm" name="idm140527981718272"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7中，</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#cache-index" title="13.7.6.2 CACHE INDEX语法"><code class="literal">CACHE INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-index" title="13.7.6.5 LOAD INDEX INTO CACHE语法"><code class="literal">LOAD INDEX INTO
        CACHE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">支持分区</font><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">键缓存</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可以为一个，多个或所有分区定义密钥缓存，并且可以将一个，几个或所有分区的索引预加载到密钥缓存中。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区的InnoDB表不支持外键。&nbsp;</font></font></b><a class="indexterm" name="idm140527981711568"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        存储引擎</font><font style="vertical-align: inherit;">分区的表</font><font style="vertical-align: inherit;">不支持外键。</font><font style="vertical-align: inherit;">更具体地说，这意味着以下两个陈述是正确的：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          没有</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户定义分区</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表的定义可能包含外键引用; </font><font style="vertical-align: inherit;">没有</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义包含外键引用的表可能会被分区。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          没有</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表定义可能包含对用户分区表的外键引用; </font><font style="vertical-align: inherit;">没有
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义分区的表可能包含外键引用的列。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      刚刚列出的限制范围包括使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">所有表</font><font style="vertical-align: inherit;">。
      </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-foreign-keys" title="13.1.18.6使用FOREIGN KEY约束"><code class="literal">CREATE
      TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      会导致违反这些限制的表的声明是不允许的。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE ... ORDER BY。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对分区表运行</font><font style="vertical-align: inherit;">
        的</font><font style="vertical-align: inherit;">语句会导致仅在每个分区内对行进行排序。
      </font></font><code class="literal">ALTER TABLE ... ORDER BY
        <em class="replaceable"><code>column</code></em></code><font style="vertical-align: inherit;"></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过修改主键对REPLACE语句的影响。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在某些情况下（参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys" title="22.6.1分区键，主键和唯一键"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.6.1节“分区键，主键和唯一键”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），可能需要修改表的主键。</font><font style="vertical-align: inherit;">请注意，如果您的应用程序使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句并且执行此操作，则可以彻底更改这些语句的结果。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息和示例，</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.8节“REPLACE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FULLTEXT索引。&nbsp;</font></font></b><a class="indexterm" name="idm140527981691472"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区表不支持</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        索引或搜索，甚至采用分区表
         </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空间列。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        具有空间数据类型的列（如</font></font><code class="literal">POINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或</font></font><code class="literal">GEOMETRY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能用于分区表）。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">临时表。&nbsp;</font></font></b><a class="indexterm" name="idm140527981682768"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        临时表不能分区。</font><font style="vertical-align: inherit;">（错误＃17497）
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志表。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区日志表是不可能的; </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... PARTITION BY ...</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的表上</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">声明失败并出现错误。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区键的数据类型。&nbsp;</font></font></b><a class="indexterm" name="idm140527981677392"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区键必须是整数列或解析为整数的表达式。</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#enum" title="11.4.4 ENUM类型"><code class="literal">ENUM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的</font><font style="vertical-align: inherit;">表达式
         </font><font style="vertical-align: inherit;">不能使用。</font><font style="vertical-align: inherit;">列或表达式值也可以是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-handling-nulls" title="22.2.7 MySQL分区如何处理NULL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.2.7节“MySQL分区如何处理NULL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这个限制有两个例外：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当用[ </font></font><code class="literal">LINEAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]进行
           </font><font style="vertical-align: inherit;">分区时</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以使用任何有效的MySQL数据类型而不是
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为分区键的列，因为MySQL的内部密钥散列函数会根据这些类型生成正确的数据类型。</font><font style="vertical-align: inherit;">例如，以下两条</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句是有效的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE tkc（c1 CHAR）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按键分区（c1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE tke</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （c1 ENUM（'红'，'橙'，'黄'，'绿'，'蓝'，'靛蓝'，'紫'）））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
线性密钥分区（c1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区6;</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用</font></font><code class="literal">RANGE COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
           </font><font style="vertical-align: inherit;">分区时</font></font><code class="literal">LIST COLUMNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以使用string
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">columns。</font><font style="vertical-align: inherit;">例如，以下每个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句都是有效的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE rc（c1 INT，c2 DATE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各种色谱柱的分区（c2）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0值小于（'1990-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1值小于（'1995-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2的值小于（'2000-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p3的值小于（'2005-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p4的值小于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE lc（c1 INT，c2 CHAR（1））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
列表列分区（c2）（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p0 VALUES IN（'a'，'d'，'g'，'j'，'m'，'p'，'s'，'v'，'y'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p1 VALUE IN（'b'，'e'，'h'，'k'，'n'，'q'，'t'，'w'，'z'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION p2 VALUES IN（'c'，'f'，'i'，'l'，'o'，'r'，'u'，'x'，NULL）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      前面的例外都不适用于
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列类型。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询。&nbsp;</font></font></b><a class="indexterm" name="idm140527981652640"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区键可能不是子查询，即使该子查询解析为整数值或</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><a name="partitioning-limitations-subpartitions"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子分区的问题。&nbsp;</font></font></b><a class="indexterm" name="idm140527981648704"></a><a class="indexterm" name="idm140527981647216"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        子</font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">必须使用</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区。</font><font style="vertical-align: inherit;">只有
         </font></font><code class="literal">RANGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区可能是子分区的; </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
         </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区不能被子分区。
      </font></font></p><p>
      <a class="indexterm" name="idm140527981640576"></a>

      <code class="literal">SUBPARTITION BY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求显式指定子分区列，不同于</font></font><code class="literal">PARTITION BY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以省略的情况（在这种情况下，默认情况下使用表的主键列）。</font><font style="vertical-align: inherit;">考虑这个声明创建的表格：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    名称VARCHAR（30）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用诸如此类的语句</font><font style="vertical-align: inherit;">创建具有相同列的表格，并使用该表格进行分区
       </font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    名称VARCHAR（30）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按键分区（）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      前面的语句被看作是像这样写的，表中的主键列用作分区列：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE ts（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    名称VARCHAR（30）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按键分区（id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
        </pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      但是，以下尝试使用默认列作为子分区列创建子分区表的操作失败，并且必须为该语句指定该列才能成功，如下所示：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE ts (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>name VARCHAR(30)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY RANGE(id)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>SUBPARTITION BY KEY()</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>SUBPARTITIONS 4</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>(</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (100),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (MAXVALUE)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ERROR 1064（42000）：你的SQL语法错误; </font><font style="vertical-align: inherit;">检查手册</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对应于您的MySQL服务器版本，以便在''附近'使用正确的语法'）</font></font></span><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE ts (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>name VARCHAR(30)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY RANGE(id)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>SUBPARTITION BY KEY(id)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>SUBPARTITIONS 4</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>(</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (100),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (MAXVALUE)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.07秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这是一个已知问题（请参阅错误＃51470）。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DATA DIRECTORY和INDEX DIRECTORY选项。&nbsp;</font></font></b>
        <code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">INDEX
        DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用分区表中使用时受到以下限制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表级</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">INDEX DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项被忽略（请参阅错误＃32091）。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Windows上，</font><font style="vertical-align: inherit;">单个分区或</font><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">子分区不支持</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">INDEX DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
           </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，您可以使用</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个分区或</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">子分区
           </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修复和重建分区表。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该声明</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持分区表。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      另外，您可以使用</font></font><code class="literal">ALTER TABLE ... REBUILD
      PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重建分区表的一个或多个分区; </font></font><code class="literal">ALTER TABLE ... REORGANIZE
      PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也会导致分区被重建。</font><font style="vertical-align: inherit;">有关这两个语句的更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><font style="vertical-align: inherit;">第13.1.8节“ALTER TABLE语法”</font></a><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      开始在MySQL 5.7.2， ，</font></font><code class="literal">ANALYZE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="literal">CHECK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">OPTIMIZE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
      </font></font><code class="literal">REPAIR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">TRUNCATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      操作与子分区支持。
      </font></font><code class="literal">REBUILD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也被接受MySQL 5.7.5之前的语法，尽管这没有效果。</font><font style="vertical-align: inherit;">（错误＃19075411，错误＃73130）另请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8.1节“ALTER TABLE分区操作”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p>
      <a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlcheck" title="4.5.3 mysqlcheck  - 一个表维护程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表不支持</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlcheck" title="4.5.3 mysqlcheck  - 一个表维护程序"><span class="command"><strong><font style="vertical-align: inherit;"> mysqlcheck</font></strong></span></a><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FOR EXPORT选项（FLUSH TABLES）。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 5.7.4及更早版本的</font><font style="vertical-align: inherit;">
        分区</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">不支持</font><font style="vertical-align: inherit;">
        该
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
        TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的</font></font><code class="literal">FOR EXPORT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（Bug＃16943907）
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-limitations-partitioning-keys-unique-keys"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.1分区键，主键和唯一键</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140527981579184"></a><a class="indexterm" name="idm140527981578144"></a><a class="indexterm" name="idm140527981576656"></a><a class="indexterm" name="idm140527981575568"></a><a class="indexterm" name="idm140527981574080"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节讨论分区键与主键和唯一键的关系。</font><font style="vertical-align: inherit;">控制这种关系的规则可以表示如下：在分区表中用于分区表的所有列必须是该表可能具有的每个唯一键的一部分。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        换句话说，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的每个唯一键必须使用表的分区表达式中的每一列</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这也包括表的主键，因为它是按照定义的唯一键，这个特殊情况将在本节后面讨论）。例如，下面的每个表创建语句都是无效的：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 DATE NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    UNIQUE KEY（col1，col2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY HASH（col3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE t2（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 DATE NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    UNIQUE KEY（col1），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    唯一键（col3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY HASH（col1 + col3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在每种情况下，建议的表至少有一个唯一键，不包括分区表达式中使用的所有列。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下每个语句都是有效的，并且表示相应的无效表创建语句可以工作的一种方式：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 DATE NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    UNIQUE KEY（col1，col2，col3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY HASH（col3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE t2（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 DATE NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    唯一键（col1，col3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY HASH（col1 + col3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这个例子显示了在这种情况下产生的错误：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t3 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>col1 INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>col2 DATE NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>col3 INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>col4 INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>UNIQUE KEY (col1, col2),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>UNIQUE KEY (col3)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY HASH(col1 + col3)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font><span class="errortext"><font style="vertical-align: inherit;">ERROR 1491（HY000）：PRIMARY KEY必须包含表的分区函数中的所有列</font></span></font><strong class="userinput"><code>PARTITIONS 4;</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句失败，因为两者</font></font><code class="literal">col1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">col3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        包含在建议分区键，但是没有这些列既是餐桌上唯一键的一部分。</font><font style="vertical-align: inherit;">这显示了无效表定义的一种可能的修复方法：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t3 (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>col1 INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>col2 DATE NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>col3 INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>col4 INT NOT NULL,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>UNIQUE KEY (col1, col2, col3),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>UNIQUE KEY (col3)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>PARTITION BY HASH(col3)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>PARTITIONS 4;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.05秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，建议的分区键
         </font></font><code class="literal">col3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是两个唯一键的一部分，并且表创建语句成功。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        下表不能根据分区进行分区，因为无法在分区键中包含属于这两个唯一键的所有列：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t4（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    UNIQUE KEY（col1，col3），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    唯一键（col2，col4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于每个主键在定义上都是唯一键，所以这个限制还包括表的主键（如果有）。</font><font style="vertical-align: inherit;">例如，接下来的两条语句是无效的：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t5（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 DATE NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（col1，col2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY HASH（col3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE t6（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 DATE NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（col1，col3），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    UNIQUE KEY（col2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HASH分区（年份（col2））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这两种情况下，主键都不包括分区表达式中引用的所有列。</font><font style="vertical-align: inherit;">但是，接下来的两个陈述都是有效的：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t7（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 DATE NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（col1，col2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY HASH（col1 + YEAR（col2））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE TABLE t8（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col1 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col2 DATE NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col3 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    col4 INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（col1，col2，col4），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    UNIQUE KEY（col2，col1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITION BY HASH（col1 + YEAR（col2））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分区4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果一个表没有唯一键 - 这包括没有主键 - 那么这个限制不适用，并且只要列类型与分区类型兼容，您就可以使用分区表达式中的任何列或列。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        出于同样的原因，除非该键包含表的分区表达式使用的所有列，否则以后不能在分区表中添加唯一键。</font><font style="vertical-align: inherit;">考虑如下所示创建的分区表：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t_no_pk (c1 INT, c2 INT)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION BY RANGE(c1) (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p0 VALUES LESS THAN (10),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p1 VALUES LESS THAN (20),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p2 VALUES LESS THAN (30),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;          </font></font><strong class="userinput"><code>PARTITION p3 VALUES LESS THAN (40)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.12秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可以添加一个主键来
         </font></font><code class="literal">t_no_pk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用这些</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中的</font><font style="vertical-align: inherit;">任何一个
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃可能的PK</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE t_no_pk ADD PRIMARY KEY(c1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.13秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃放下这个PK</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE t_no_pk DROP PRIMARY KEY;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.10秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃使用另一个可能的PK</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE t_no_pk ADD PRIMARY KEY(c1, c2);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.12秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃放下这个PK</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE t_no_pk DROP PRIMARY KEY;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.09秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，下一个语句失败，因为它</font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        是分区键的一部分，但不是建议的主键的一部分：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃失败，错误1503</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1503（HY000）：PRIMARY KEY必须包含表的分区功能中的所有列</font></span></font><strong class="userinput"><code>ALTER TABLE t_no_pk ADD PRIMARY KEY(c2);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于</font></font><code class="literal">t_no_pk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有</font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在其分区表达式中，试图</font></font><code class="literal">c2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单独</font><font style="vertical-align: inherit;">添加唯一密钥</font><font style="vertical-align: inherit;">失败。</font><font style="vertical-align: inherit;">但是，您可以添加使用</font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
         </font><font style="vertical-align: inherit;">的唯一键</font></font><code class="literal">c2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些规则也适用于您希望使用分区的现有非分区表
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... PARTITION BY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">考虑一个</font></font><code class="literal">np_pk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示创建</font><font style="vertical-align: inherit;">的表格
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE np_pk (</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>id INT NOT NULL AUTO_INCREMENT,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>name VARCHAR(50),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>added DATE,</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PRIMARY KEY (id)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.08秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句因错误而失败，因为该
         </font></font><code class="literal">added</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列不是表中任何唯一键的一部分：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>ALTER TABLE np_pk</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION BY HASH( TO_DAYS(added) )</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font><span class="errortext"><font style="vertical-align: inherit;">错误1503（HY000）：PRIMARY KEY必须包含表的分区函数中的所有列</font></span></font><strong class="userinput"><code>PARTITIONS 4;</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，使用</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列分区列的</font><font style="vertical-align: inherit;">此语句</font><font style="vertical-align: inherit;">是有效的，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>ALTER TABLE np_pk</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION BY HASH(id)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;     </font></font><strong class="userinput"><code>PARTITIONS 4;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.11秒）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记录：0重复：0警告：0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下</font></font><code class="literal">np_pk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以用作分区表达式一部分的唯一列是
         </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果您希望使用分区表达式中的任何其他列进行分区，则必须首先修改表，方法是将所需的一列或多列添加到主键，或者将主键全部删除。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-limitations-storage-engines"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.2有关存储引擎的分区限制</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140527981495776"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下限制适用于使用具有用户定义的表格分区的存储引擎。
      </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MERGE存储引擎。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用户定义的分区和</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          存储引擎不兼容。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎的</font><font style="vertical-align: inherit;">表
           </font><font style="vertical-align: inherit;">不能被分区。</font><font style="vertical-align: inherit;">分区表不能合并。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FEDERATED存储引擎。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分区的</font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表不被支持; </font><font style="vertical-align: inherit;">无法创建分区
           </font></font><code class="literal">FEDERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSV存储引擎。&nbsp;</font></font></b><font style="vertical-align: inherit;"></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持</font><font style="vertical-align: inherit;">
          使用</font><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">分区表</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">无法创建分区</font></font><code class="literal">CSV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InnoDB存储引擎。&nbsp;</font></font></b>
          <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外键和MySQL分区不兼容。</font><font style="vertical-align: inherit;">分区
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表不能有外键引用，也不能有被外键引用的列。</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有或由外键引用的表不能被分区。
        </font></font></p><p>
        <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持将多个磁盘用于子分区。</font><font style="vertical-align: inherit;">（目前仅支持该功能
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        另外，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... OPTIMIZE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        存储引擎的</font><font style="vertical-align: inherit;">分区表无法正常工作</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">ALTER TABLE ... REBUILD
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">ALTER TABLE ... ANALYZE
        PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，相反，这样的表。</font><font style="vertical-align: inherit;">有关更多信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8.1节“ALTER TABLE分区操作”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><a name="partitioning-limitations-ndb"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户定义的分区和NDB存储引擎（NDB集群）。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          按</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（包括
           </font></font><code class="literal">LINEAR KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）进行分区是</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">支持的唯一分区类型
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在NDB集群的正常情况下，使用除[ </font></font><code class="literal">LINEAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font><font style="vertical-align: inherit;">之外的任何分区类型创建NDB集群表是不可能的</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且尝试这样做会失败并出现错误。
        </font></font></p><p>
        <span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">异常（不适用于生产）</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：可以通过将</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_new"><code class="literal">new</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDB Cluster SQL节点上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">设置为，来覆盖此限制
        </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您选择这样做，您应该意识到使用分区类型以外的表</font></font><code class="literal">[LINEAR] KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在生产中不受支持。</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，您可以创建和使用分区类型不是</font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或的</font><font style="vertical-align: inherit;">表格</font></font><code class="literal">LINEAR KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是您完全需要自行承担风险</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可为</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">定义的最大分区数
         </font><font style="vertical-align: inherit;">取决于群集中的数据节点和节点组的数量，使用的NDB群集软件的版本以及其他因素。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息，</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-nodes-groups-user-partitioning" title="NDB和用户定义的分区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDB和用户定义的分区</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        从MySQL NDB Cluster 7.5.2开始，</font></font><code class="literal">NDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">每个分区可以存储的最大固定大小数据量
         </font><font style="vertical-align: inherit;">为128 TB。</font><font style="vertical-align: inherit;">以前，这是16 GB。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会导致用户分区
         </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表不符合以下两个要求中的任何一个或两个的声明是不允许的，并且会失败并显示错误：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该表必须具有明确的主键。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表的分区表达式中列出的所有列必须是主键的一部分。
</font></font></p></li></ol>
</div>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用空列列表创建</font><font style="vertical-align: inherit;">用户分区</font><font style="vertical-align: inherit;">表（即使用
           </font></font><code class="literal">PARTITION BY KEY()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">PARTITION BY
          LINEAR KEY()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），则不需要明确的主键。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级分区表。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          执行升级时，</font><font style="vertical-align: inherit;">必须转储并重新加载</font><font style="vertical-align: inherit;">由其分区
           </font></font><code class="literal">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用任何存储引擎以外的表</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有分区都使用相同的存储引擎&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分区表中的所有分区必须使用相同的存储引擎，并且它必须与整个表所使用的存储引擎相同。</font><font style="vertical-align: inherit;">另外，如果没有在表级别指定引擎，则在创建或更改分区表时，必须执行以下任一操作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不要</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定任何引擎
             </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的任何</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区或子分区
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区或子分区
 </font><font style="vertical-align: inherit;">指定引擎</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-limitations-functions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.3与功能相关的分区限制</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节讨论MySQL分区中与分区表达式中使用的函数相关的限制。
      </font></font></p><a class="indexterm" name="idm140527981438320"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        分区表达式中只允许以下列表中显示的MySQL函数：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_abs"><code class="literal">ABS()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_ceiling"><code class="literal">CEILING()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-ceiling-floor" title="CEILING（）和FLOOR（）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CEILING（）和FLOOR（）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_datediff"><code class="literal">DATEDIFF()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_day"><code class="literal">DAY()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_dayofmonth"><code class="literal">DAYOFMONTH()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_dayofweek"><code class="literal">DAYOFWEEK()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_dayofyear"><code class="literal">DAYOFYEAR()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_extract"><code class="literal">EXTRACT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-extract" title="使用WEEK说明符的EXTRACT（）函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用WEEK说明符的EXTRACT（）函数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_floor"><code class="literal">FLOOR()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-ceiling-floor" title="CEILING（）和FLOOR（）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CEILING（）和FLOOR（）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_hour"><code class="literal">HOUR()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_microsecond"><code class="literal">MICROSECOND()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_minute"><code class="literal">MINUTE()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_mod"><code class="literal">MOD()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_month"><code class="literal">MONTH()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_quarter"><code class="literal">QUARTER()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_second"><code class="literal">SECOND()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_time-to-sec"><code class="literal">TIME_TO_SEC()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-days"><code class="literal">TO_DAYS()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-seconds"><code class="literal">TO_SECONDS()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（有
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专栏）
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_weekday"><code class="literal">WEEKDAY()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR()</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/functions.html#function_yearweek"><code class="literal">YEARWEEK()</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.7，分区修剪是支持的</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-days"><code class="literal">TO_DAYS()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_to-seconds"><code class="literal">TO_SECONDS()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_year"><code class="literal">YEAR()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning" title="22.4分区修剪"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-pruning" title="22.4分区修剪"><font style="vertical-align: inherit;">第22.4节“分区修剪”</font></a><font style="vertical-align: inherit;">。
      </font></font></p><p><a name="partitioning-limitations-ceiling-floor"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CEILING（）和FLOOR（）。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个函数只有在传递了一个精确的数字类型的参数时才会返回整数，例如其中一个</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">INT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型或
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#fixed-point-types" title="11.2.2定点类型（准确值） -  DECIMAL，NUMERIC"><code class="literal">DECIMAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着，例如，以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句失败并出现错误，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE t (c FLOAT) PARTITION BY LIST( FLOOR(c) )(</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p0 VALUES IN (1,3,5),</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;      </font></font><strong class="userinput"><code>PARTITION p1 VALUES IN (2,4,6)</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font><span class="errortext"><font style="vertical-align: inherit;">错误1490（HY000）：PARTITION函数返回错误的类型</font></span></font><strong class="userinput"><code>);</code></strong>
<span class="errortext"><font style="vertical-align: inherit;"></font></span>
</pre><p><a name="partitioning-limitations-extract"></a><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用WEEK说明符的EXTRACT（）函数。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          函数返回的值
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_extract"><code class="literal">EXTRACT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用时</font><font style="vertical-align: inherit;">取决于</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">出于这个原因，</font><font style="vertical-align: inherit;">当它指定单位</font><font style="vertical-align: inherit;">为时，
           </font><font style="vertical-align: inherit;">不允许它作为分区函数
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（错误＃54483）
        </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_extract"><code class="literal">EXTRACT(WEEK FROM
          <em class="replaceable"><code>col</code></em>)</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_default_week_format"><code class="literal">default_week_format</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_extract"><code class="literal">EXTRACT()</code></a><font style="vertical-align: inherit;"></font><code class="literal">WEEK</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关</font><font style="vertical-align: inherit;">这些函数的返回类型以及</font><a class="xref" href="/mysql-5.7-google-zh/data-types.html#numeric-types" title="11.2数字类型"><font style="vertical-align: inherit;">第11.2节“数字类型”的</font></a><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#mathematical-functions" title="12.6.2数学函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/functions.html#mathematical-functions" title="12.6.2数学函数"><font style="vertical-align: inherit;">第12.6.2节“数学函数</font></a></font><a class="xref" href="/mysql-5.7-google-zh/data-types.html#numeric-types" title="11.2数字类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partitioning-limitations-locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.4分区和锁定</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        执行DML或DDL语句时实际执行表级锁的</font><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">，影响分区表的老版本MySQL（5.6.5及更早版本）中的这样一条语句强加了对表的锁定; </font><font style="vertical-align: inherit;">也就是说，所有分区都被锁定，直到语句结束。</font><font style="vertical-align: inherit;">在MySQL 5.7中，</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区锁修剪</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在很多情况下消除了不必要的锁，大多数语句读取或更新分区
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表时只会导致受影响的分区被锁定。</font><font style="vertical-align: inherit;">例如，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自分区
        </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">只锁定那些实际上包含符合条件的行的分区
        </font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的
         </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态被锁定。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于使用存储引擎影响分区表的语句，例如</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用行级锁定并且在分区修剪之前不实际执行（或需要执行）锁，这不是问题。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        接下来的几段将讨论分区锁修剪对使用表级锁的存储引擎的各种MySQL语句的影响。
</font></font></p>
<h4><a name="idm140527981350560"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对DML语句的影响</font></font></h4>
<p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（包括那些包含联合或连接的语句）只锁定那些实际需要读取的分区。</font><font style="vertical-align: inherit;">这也适用于
         </font></font><code class="literal">SELECT ... PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只为表梅干锁上没有分区列被更新。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只锁定那些要插入或替换行的分区。</font><font style="vertical-align: inherit;">但是，如果
         </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为任何分区列生成值，则所有分区都将被锁定。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-on-duplicate" title="13.2.5.2 INSERT ... ON DUPLICATE KEY UPDATE语法"><code class="literal">INSERT ...
        ON DUPLICATE KEY UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 只要没有更新分区列就会被修剪。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT ...
        SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 尽管目标表中的所有分区都被锁定，但只锁定源表中需要读取的那些分区。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
        DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区表上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">施加的锁</font><font style="vertical-align: inherit;">不能被修剪。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用分区表的任何分区列</font><font style="vertical-align: inherit;">
        的存在</font></font><code class="literal">BEFORE INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">BEFORE UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发器意味着锁定
         </font></font><code class="literal">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        更新此表的语句不能被修剪，因为触发器可以更改它的值：</font></font><code class="literal">BEFORE INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        任何表的分区列上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">触发器意味着设置</font></font><code class="literal">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">REPLACE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能</font><font style="vertical-align: inherit;">设置锁</font><font style="vertical-align: inherit;">因为在
         </font></font><code class="literal">BEFORE INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入行之前触发器可能会更改行的分区列，因此强制该行进入不同于其他分区的分区。</font><font style="vertical-align: inherit;">甲
         </font></font><code class="literal">BEFORE UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的分区列触发意味着锁所规定</font></font><code class="literal">UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">INSERT ... ON DUPLICATE KEY UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能被修剪。
</font></font></p>
<h4><a name="idm140527981327872"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受影响的DDL语句</font></font></h4>
<p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-view" title="13.1.21 CREATE VIEW语法"><code class="literal">CREATE VIEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 不会造成任何锁定。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... EXCHANGE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修剪锁; </font><font style="vertical-align: inherit;">只有交换的表和交换的分区被锁定。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table-partition-operations" title="13.1.8.1 ALTER TABLE分区操作"><code class="literal">ALTER
        TABLE ... TRUNCATE PARTITION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修剪锁; </font><font style="vertical-align: inherit;">只有被清空的分区被锁定。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        另外，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句在表级别上使用元数据锁。
</font></font></p>
<h4><a name="idm140527981320336"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他陈述</font></font></h4>
<p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 不能修剪分区锁。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#call" title="13.2.1 CALL语法"><code class="literal">CALL
        stored_procedure(<em class="replaceable"><code>expr</code></em>)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        支持锁修剪，但评估</font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font><font style="vertical-align: inherit;">支持
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#do" title="13.2.3 DO语法"><code class="literal">DO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句不支持分区锁修剪。
</font></font></p>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tbody><tr>
<td width="40%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/mysql-cluster.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a></td>
<td width="20%" align="center"><a accesskey="u" href="/mysql-5.7-google-zh/partitioning.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向上</font></font></a></td>
<td width="40%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/stored-programs-views.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21章MySQL NDB集群7.5和NDB集群7.6</font></font></td>
<td width="20%" align="center"><a accesskey="h" href="/mysql-5.7-google-zh/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家</font></font></a></td>
<td width="40%" align="right" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第23章存储程序和视图</font></font></td>
</tr>
</tbody></table>
</div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./images/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>