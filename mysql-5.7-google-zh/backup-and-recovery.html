<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>第7章备份和恢复</title>
<link rel="stylesheet" href="./images/mvl.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
<link rel="start" href="/mysql-5.7-google-zh/index.html" title="{书名}">
<link rel="up" href="/mysql-5.7-google-zh/backup-and-recovery.html" title="">
<link rel="prev" href="/mysql-5.7-google-zh/security.html" title="第6章安全">
<link rel="next" href="/mysql-5.7-google-zh/optimization.html" title="第8章优化">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./images/translateelement.css"></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tbody><tr>
<th colspan="3" align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7章备份和恢复</font></font></th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/security.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a>&nbsp;</td>
<th width="60%" align="center"></th>
<td width="20%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/optimization.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
</tbody></table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="backup-and-recovery"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7章备份和恢复</font></font></h1>

</div>

</div>

</div>
<div class="toc">
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></b></p><dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1备份和恢复类型</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2数据库备份方法</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-strategy-example"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3示例备份和恢复策略</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-policy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.1建立备份策略</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#recovery-from-backups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.2使用备份进行恢复</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-strategy-summary"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.3备份策略摘要</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#using-mysqldump"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4使用mysqldump进行备份</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-sql-format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.1使用mysqldump以SQL格式转储数据</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#reloading-sql-format-dumps"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.2重新加载SQL格式备份</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-delimited-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.3使用mysqldump以分隔文本格式转储数据</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#reloading-delimited-text-dumps"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.4重新加载分隔文本格式备份</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-tips"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5 mysqldump提示</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#point-in-time-recovery"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5使用二进制日志的时间点（增量）恢复</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#point-in-time-recovery-times"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5.1使用事件时间进行时间点恢复</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#point-in-time-recovery-positions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5.2使用事件位置的时间点恢复</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-table-maintenance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6 MyISAM表维护和崩溃恢复</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-crash-recovery"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.1使用myisamchk进行崩溃恢复</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-check"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.2如何检查MyISAM表错误</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-repair"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.3如何修复MyISAM表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.4 MyISAM表优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-maintenance-schedule"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.5设置MyISAM表维护计划</font></font></a></span></dt></dl></dd></dl>
</div>
<a class="indexterm" name="idm140528108456960"></a><a class="indexterm" name="idm140528108455472"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    备份数据库非常重要，以便您可以恢复数据并在发生问题时再次启动并运行，例如系统崩溃，硬件故障或用户错误地删除数据。</font><font style="vertical-align: inherit;">在升级MySQL安装之前，备份也是必不可少的安全措施，它们可用于将MySQL安装传输到另一个系统或设置复制从服务器。
  </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    MySQL提供了多种备份策略，您可以从中选择最适合您安装要求的方法。</font><font style="vertical-align: inherit;">本章讨论您应该熟悉的几个备份和恢复主题：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        备份类型：逻辑与物理，完整与增量等。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        创建备份的方法。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        恢复方法，包括时间点恢复。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        备份调度，压缩和加密。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表维护，以便恢复损坏的表。
</font></font></p></li></ul>
</div>
<h2><a name="idm140528108448240"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他资源</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    与备份或保持数据可用性相关的资源包括以下内容：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL企业版的客户可以使用MySQL企业备份产品进行备份。</font><font style="vertical-align: inherit;">有关MySQL企业备份产品的概述，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-enterprise.html#mysql-enterprise-backup" title="29.2 MySQL企业备份概述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第29.2节“MySQL企业备份概述”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        致力于备份问题的论坛可在
         </font></font><a class="ulink" href="http://forums.mysql.com/list.php?28" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://forums.mysql.com/list.php?28上找到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细信息，请</font><font style="vertical-align: inherit;">参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html" title="第4章MySQL程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL程序</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这里描述的SQL语句的语法在
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html" title="第13章SQL语句语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语句语法中给出</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        备份过程的</font><font style="vertical-align: inherit;">更多信息</font><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-backup" title="14.18.1 InnoDB备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.18.1节“InnoDB备份”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        复制使您能够在多台服务器上保持相同的数据。</font><font style="vertical-align: inherit;">这具有几个好处，例如，使客户端查询负载能够分布在服务器上，即使给定服务器脱机或失败，数据的可用性也可以通过使用从服务器进行备份而不影响主服务器。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html" title="第16章复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL InnoDB集群是一起工作的产品集合，以提供高可用性解决方案。</font><font style="vertical-align: inherit;">一组MySQL服务器可以配置为使用MySQL Shell创建一个集群。</font><font style="vertical-align: inherit;">服务器集群有一个主节点，称为主节点，它充当读写主节点。</font><font style="vertical-align: inherit;">多个辅助服务器是主服务器的副本。</font><font style="vertical-align: inherit;">创建高可用性群集至少需要三台服务器。</font><font style="vertical-align: inherit;">客户端应用程序通过MySQL路由器连接到主要应用程序。</font><font style="vertical-align: inherit;">如果主服务器出现故障，辅助服务器会自动提升为主服务器的角色，并且MySQL路由器会将请求路由到新的主服务器。
      </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        NDB集群提供了适用于分布式计算环境的高可用性，高冗余版本的MySQL。</font><font style="vertical-align: inherit;">请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第21章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL NDB Cluster 7.5和NDB Cluster 7.6</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中提供了有关MySQL NDB Cluster 7.5（基于MySQL 5.7，但包含</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">的最新改进和修复
         </font><font style="vertical-align: inherit;">）的信息。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="backup-types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1备份和恢复类型</font></font></h2>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍不同类型备份的特点。
</font></font></p>
<h3><a name="idm140528108428864"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理（原始）与逻辑备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      物理备份由存储数据库内容的目录和文件的原始副本组成。</font><font style="vertical-align: inherit;">这种类型的备份适用于需要在出现问题时快速恢复的大型重要数据库。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      逻辑备份保存表示为逻辑数据库结构（</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句）和内容（</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或分隔文本文件）的信息。</font><font style="vertical-align: inherit;">这种类型的备份适用于可能编辑数据值或表结构的较小数据量，或者在不同的计算机体系结构上重新创建数据。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      物理备份方法具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          备份由数据库目录和文件的确切副本组成。</font><font style="vertical-align: inherit;">通常这是MySQL数据目录的全部或部分的副本。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          物理备份方法比逻辑更快，因为它们只涉及文件复制而无需转换。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          输出比逻辑备份更紧凑。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          由于备份速度和紧凑性对繁忙，重要的数据库非常重要，MySQL企业备份产品可以执行物理备份。</font><font style="vertical-align: inherit;">有关MySQL企业备份产品的概述，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-enterprise.html#mysql-enterprise-backup" title="29.2 MySQL企业备份概述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第29.2节“MySQL企业备份概述”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          备份和恢复从整个数据目录级别到单个文件级别的粒度范围。</font><font style="vertical-align: inherit;">这可能会也可能不会提供表级粒度，具体取决于存储引擎。</font><font style="vertical-align: inherit;">例如，
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表可以分别放在一个单独的文件中，或与其他</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">共享文件存储
           </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">每个
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格唯一对应一组文件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          除了数据库之外，备份还可以包含任何相关文件，例如日志或配置文件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          来自</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格的</font><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">很难以这种方式备份，因为它们的内容不存储在磁盘上。</font><font style="vertical-align: inherit;">（MySQL Enterprise Backup产品具有可</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在备份期间</font><font style="vertical-align: inherit;">从</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">检索数据的功能</font><font style="vertical-align: inherit;">。）
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          备份只能移植到具有相同或相似硬件特征的其他机器。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          备份可以在MySQL服务器不运行时执行。</font><font style="vertical-align: inherit;">如果服务器正在运行，则需要执行适当的锁定，以便服务器在备份过程中不会更改数据库内容。</font><font style="vertical-align: inherit;">MySQL Enterprise Backup为需要它的表自动执行此锁定。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          物理备份工具包括</font><font style="vertical-align: inherit;">MySQL企业备份</font><font style="vertical-align: inherit;">或任何其他表</font><font style="vertical-align: inherit;">的
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbackup</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或表的文件系统级命令（如</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scp</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tar</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rsync</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了恢复：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL企业备份还原</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和其备份的其他表。
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html#mysql-cluster-programs-ndb-restore" title="21.4.24 ndb_restore  - 恢复NDB群集备份"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ndb_restore</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恢复
              </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可以使用文件系统命令将在文件系统级别复制的文件复制回其原始位置。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      逻辑备份方法具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          备份是通过查询MySQL服务器来获得数据库结构和内容信息来完成的。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          备份比物理方法慢，因为服务器必须访问数据库信息并将其转换为逻辑格式。</font><font style="vertical-align: inherit;">如果输出写入客户端，则服务器还必须将其发送到备份程序。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          输出大于物理备份，尤其是以文本格式保存时。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器级别（所有数据库），数据库级别（特定数据库中的所有表）或表级别都可以使用备份和还原粒度。</font><font style="vertical-align: inherit;">无论存储引擎如何，情况都是如此。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          备份不包括日志或配置文件，或不包含不属于数据库的其他数据库相关文件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以逻辑格式存储的备份与机器无关并且非常便携。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          逻辑备份在MySQL服务器运行时执行。</font><font style="vertical-align: inherit;">服务器未脱机。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          逻辑备份工具包括</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          程序和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT
          ... INTO OUTFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">这些适用于任何存储引擎，甚至</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要恢复逻辑备份，可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">处理SQL格式的转储文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要加载分隔文本文件，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
          INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlimport" title="4.5.5 mysqlimport  - 数据导入程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlimport</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端。
</font></font></p></li></ul>
</div>
<h3><a name="idm140528108379712"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线与离线备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL服务器正在运行时进行在线备份，以便可以从服务器获取数据库信息。</font><font style="vertical-align: inherit;">离线备份发生在服务器停止时。</font><font style="vertical-align: inherit;">这种区别也可以被描述为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">热</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
       </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冷</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份; </font><font style="vertical-align: inherit;">一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温暖</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的备份是一个在服务器保持运行，但锁定，以防止当你从外部访问数据库文件修改数据。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在线备份方法具有以下特点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该备份对其他客户端的侵扰性较小，这些客户端可以在备份期间连接到MySQL服务器，并且可以根据他们需要执行的操作访问数据。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          必须小心强加适当的锁定，以便不会发生损害备份完整性的数据修改。</font><font style="vertical-align: inherit;">MySQL企业备份产品会自动进行这种锁定。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      脱机备份方法具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          客户端可能会受到不利影响，因为服务器在备份过程中不可用。</font><font style="vertical-align: inherit;">出于这个原因，这种备份通常从复制从属服务器获取，该服务器可以在不影响可用性的情况下脱机。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          备份程序更简单，因为客户端活动不会有干扰。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在线和离线之间的类似区别适用于恢复操作，并应用类似的特征。</font><font style="vertical-align: inherit;">但是，由于恢复需要更强的锁定，因此联机恢复中的客户端更有可能会受到在线备份的影响。</font><font style="vertical-align: inherit;">在备份期间，客户端可能在备份数据时读取数据。</font><font style="vertical-align: inherit;">恢复修改数据并不只是读取数据，因此客户端在恢复时必须防止其访问数据。
</font></font></p>
<h3><a name="idm140528108370192"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地与远程备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本地备份是在运行MySQL服务器的同一主机上执行的，而远程备份是从不同的主机完成的。</font><font style="vertical-align: inherit;">对于某些类型的备份，即使输出写入服务器本地，也可以从远程主机启动备份。</font><font style="vertical-align: inherit;">主办。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以连接到本地或远程服务器。</font><font style="vertical-align: inherit;">对于SQL输出（</font></font><code class="literal">CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
          </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句），可以完成本地或远程转储，并在客户端上生成输出。</font><font style="vertical-align: inherit;">对于分隔文本输出（使用该
          </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_tab"><code class="option">--tab</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项），将在服务器主机上创建数据文件。
        </font></font></p></li><li class="listitem"><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO语法"><code class="literal">SELECT ... INTO
          OUTFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 可以从本地或远程客户端主机启动，但输出文件是在服务器主机上创建的。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          物理备份方法通常在MySQL服务器主机上本地启动，以便服务器可以脱机，但复制文件的目标可能是远程的。
</font></font></p></li></ul>
</div>
<h3><a name="idm140528108360112"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快照备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      某些文件系统实现可以实现</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快照</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
      。</font><font style="vertical-align: inherit;">它们在给定的时间点提供文件系统的逻辑副本，而不需要整个文件系统的物理副本。</font><font style="vertical-align: inherit;">（例如，该实现可能使用写时复制技术，以便在复制快照时间之后只修改部分文件系统。）MySQL本身不提供获取文件系统快照的功能。</font><font style="vertical-align: inherit;">它可以通过第三方解决方案获得，例如Veritas，LVM或ZFS。
</font></font></p>
<h3><a name="idm140528108358032"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全与增量备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      完整备份包括在特定时间点由MySQL服务器管理的所有数据。</font><font style="vertical-align: inherit;">增量备份包括在给定时间段内（从一个时间点到另一个时间点）对数据所做的更改。</font><font style="vertical-align: inherit;">MySQL有不同的方法来执行完整备份，如本节前面所述。</font><font style="vertical-align: inherit;">通过启用服务器的二进制日志（服务器用于记录数据更改）来实现增量备份。
</font></font></p>
<h3><a name="idm140528108356432"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全对比时间点（增量）恢复</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      完全恢复将恢复完整备份中的所有数据。</font><font style="vertical-align: inherit;">这会将服务器实例恢复到进行备份时的状态。</font><font style="vertical-align: inherit;">如果该状态不是最新状态，则完全恢复后可以恢复自完整备份以来进行的增量备份，以使服务器处于更新状态。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      增量恢复是恢复在给定时间范围内所做的更改。</font><font style="vertical-align: inherit;">这也称为时间点恢复，因为它使服务器的状态达到特定时间。</font><font style="vertical-align: inherit;">时间点恢复基于二进制日志，通常在从备份文件完全恢复后，将服务器恢复到进行备份时的状态。</font><font style="vertical-align: inherit;">然后，将写入二进制日志文件的数据更改作为增量恢复应用于重做数据修改，并使服务器达到所需的时间点。
</font></font></p>
<h3><a name="idm140528108353920"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表维护</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果表损坏，数据完整性可能会受到影响。</font><font style="vertical-align: inherit;">对于
       </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，这不是一个典型的问题。</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果</font><font style="vertical-align: inherit;">程序检查</font><font style="vertical-align: inherit;">表并在发现问题时进行修复，请参阅
       </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-table-maintenance" title="7.6 MyISAM表维护和崩溃恢复"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.6节“MyISAM表维护和故障恢复”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h3><a name="idm140528108349440"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份调度，压缩和加密</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      备份调度对于自动执行备份过程非常重要。</font><font style="vertical-align: inherit;">压缩备份输出可减少对空间的需求，并且对输出进行加密可提供更好的安全性，防止对备份数据进行未经授权的访问。</font><font style="vertical-align: inherit;">MySQL本身不提供这些功能。</font><font style="vertical-align: inherit;">MySQL企业备份产品可以压缩</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份，使用文件系统实用程序可以实现备份输出的压缩或加密。</font><font style="vertical-align: inherit;">其他第三方解决方案可能可用。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="backup-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2数据库备份方法</font></font></h2>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节总结了一些制作备份的一般方法。
</font></font></p>
<h3><a name="idm140528108345360"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用MySQL企业备份进行热备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL企业版的客户可以使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_mysql_enterprise_backup" title="MySQL企业备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL企业备份</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产品对</font><font style="vertical-align: inherit;">整个实例或选定的数据库，表格或两者</font><font style="vertical-align: inherit;">进行
       </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_physical" title="物理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份。</font><font style="vertical-align: inherit;">本产品包含
       </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_incremental_backup" title="增量备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">增量</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份</font><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_compressed_backup" title="压缩备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份的功能。</font><font style="vertical-align: inherit;">备份物理数据库文件使恢复比诸如</font></font><code class="literal">mysqldump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      命令</font><font style="vertical-align: inherit;">等逻辑技术快得多</font><font style="vertical-align: inherit;">。</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表使用</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_hot_backup" title="热备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">热备份</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机制</font><font style="vertical-align: inherit;">进行复制
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（理想情况下，这些</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表应该占绝大多数数据量。）使用</font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_warm_backup" title="热备份"><font style="vertical-align: inherit;">热备份</font></a><font style="vertical-align: inherit;">复制其他存储引擎的表</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_warm_backup" title="热备份"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机制。</font><font style="vertical-align: inherit;">有关MySQL企业备份产品的概述，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-enterprise.html#mysql-enterprise-backup" title="29.2 MySQL企业备份概述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第29.2节“MySQL企业备份概述”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h3><a name="idm140528108335008"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用mysqldump进行备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序可以进行备份。</font><font style="vertical-align: inherit;">它可以备份各种表格。</font><font style="vertical-align: inherit;">（请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#using-mysqldump" title="7.4使用mysqldump进行备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.4节“使用mysqldump进行备份”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，可以使用</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;">mysqldump</font></strong></span></a></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
       </font><font style="vertical-align: inherit;">执行不锁定表的在线备份
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-policy" title="7.3.1建立备份策略"><font style="vertical-align: inherit;">第7.3.1节“建立备份策略”</font></a><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-policy" title="7.3.1建立备份策略"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<h3><a name="idm140528108327600"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过复制表文件进行备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于使用自己的文件表示每个表的存储引擎，可以通过复制这些文件来备份表。</font><font style="vertical-align: inherit;">例如，
       </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表作为文件存储，所以很容易被复制文件（做一个备份</font></font><code class="filename">*.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
       </font></font><code class="filename">*.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="filename">*.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件）。</font><font style="vertical-align: inherit;">要获得一致的备份，请停止服务器或锁定并刷新相关表格：
    </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带</font></font><em class="replaceable"><code>tbl_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读锁的平板电脑;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      你只需要一个读锁; </font><font style="vertical-align: inherit;">这使其他客户端可以在制作数据库目录中的文件副本时继续查询表。</font><font style="vertical-align: inherit;">需要刷新以确保在开始备份之前将所有活动的索引页面写入磁盘。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.3.5节“LOCK TABLES和UNLOCK TABLES Syntax”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#flush" title="13.7.6.3 FLUSH语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.6.3节“FLUSH语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      只要服务器没有更新任何内容，您也可以简单地通过复制所有表文件来创建二进制备份。</font><font style="vertical-align: inherit;">（但是请注意，如果数据库包含</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">，表格文件复制方法不起作用，</font><font style="vertical-align: inherit;">并且即使服务器没有主动更新数据，</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      也可能会修改已缓存在内存中的数据，而不会刷新到磁盘。）
</font></font></p>
<h3><a name="idm140528108317680"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制作分隔文本文件备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要创建包含表格数据的文本文件，您可以使用
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该文件在MySQL服务器主机上创建，而不是在客户端主机上创建。</font><font style="vertical-align: inherit;">对于此语句，输出文件不可能已经存在，因为允许文件被覆盖构成安全风险。</font><font style="vertical-align: inherit;">请参见
       </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><font style="vertical-align: inherit;">第13.2.9节“SELECT语法”</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此方法适用于任何类型的数据文件，但仅保存表数据，而不保存表结构。
    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO语法"><code class="literal">SELECT * INTO OUTFILE
      '<em class="replaceable"><code>file_name</code></em>' FROM
      <em class="replaceable"><code>tbl_name</code></em></code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      创建文本数据文件的另一种方式（以及包含</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份表语句的</font><font style="vertical-align: inherit;">文件
       </font><font style="vertical-align: inherit;">）是使用</font><font style="vertical-align: inherit;">带有
       </font><font style="vertical-align: inherit;">选项的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_tab"><code class="option">--tab</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-delimited-text" title="7.4.3使用mysqldump以分隔文本格式转储数据"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.4.3节“使用mysqldump以分隔文本格式转储数据”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要重新加载分隔文本数据文件，请使用
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
      INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlimport" title="4.5.5 mysqlimport  - 数据导入程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlimport</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h3><a name="idm140528108305856"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过启用二进制日志进行增量备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL支持增量备份：您必须使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用二进制日志记录</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">二进制日志文件为您提供复制数据库更改所需的信息，这些更改是在执行备份的位置之后进行的。</font><font style="vertical-align: inherit;">在您想要进行增量备份（包含自上次完整备份或增量备份以来发生的所有更改）的时候，您应该通过使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">完成后，您需要将所有二进制日志复制到备份位置，范围从最后一次完整备份或增量备份时刻到最后一次备份时刻之间的所有二进制日志。</font><font style="vertical-align: inherit;">这些二进制日志是增量备份; </font><font style="vertical-align: inherit;">在恢复时，按照</font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#point-in-time-recovery" title="7.5使用二进制日志的时间点（增量）恢复"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.5节“使用二进制日志进行时间点恢复（增量）恢复”中的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明应用它们
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">下一次进行完全备份时，还应该使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump --flush-logs</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旋转二进制
       </font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;">日志</font></strong></span></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.5.4节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 数据库备份程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h3><a name="idm140528108297184"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用复制从站进行备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果在进行备份时您的主服务器出现性能问题，一种可以帮助的策略是设置复制并在从服务器而不是主服务器上执行备份。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-solutions-backups" title="16.3.1使用复制进行备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.3.1节“使用复制进行备份”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果要备份从属复制服务器，则备份从属数据库时应备份其主数据库和中继日志信息存储库（请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#slave-logs" title="16.2.4复制中继和状态日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16.2.4节“复制中继和状态日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），而不考虑备份方法你选。</font><font style="vertical-align: inherit;">恢复从站的数据后，总需要这些信息文件来恢复复制。</font><font style="vertical-align: inherit;">如果从站正在复制
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
      INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，则还应备份</font></font><code class="filename">SQL_LOAD-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从站用于此目录的</font><font style="vertical-align: inherit;">所有
       </font><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">从机需要这些文件来恢复任何中断</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
      INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作的</font><font style="vertical-align: inherit;">复制
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该目录的位置是该值的位置</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_slave-load-tmpdir"><code class="option">--slave-load-tmpdir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      选项。</font><font style="vertical-align: inherit;">如果服务器未使用该选项启动，则目录位置是</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<h3><a name="idm140528108287776"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恢复损坏的表格</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您必须还原</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已损坏的表，请先尝试使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -r</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恢复它们
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这应该在99.9％的案例中起作用。</font><font style="vertical-align: inherit;">如果
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败，请参阅
       </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-table-maintenance" title="7.6 MyISAM表维护和崩溃恢复"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.6节“MyISAM表维护和崩溃恢复”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<h3><a name="idm140528108281344"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用文件系统快照进行备份</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您使用的是Veritas文件系统，则可以像这样进行备份：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从客户端程序中执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH
          TABLES WITH READ LOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从另一个shell中执行</font></font><code class="literal">mount vxfs
          snapshot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从第一个客户端执行
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">UNLOCK
          TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          复制快照中的文件。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          卸载快照。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      类似的快照功能可能在其他文件系统中可用，例如LVM或ZFS。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="backup-strategy-example"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3示例备份和恢复策略</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-policy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.1建立备份策略</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#recovery-from-backups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.2使用备份进行恢复</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-strategy-summary"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.3备份策略摘要</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节讨论执行备份的过程，使您可以在发生多种类型的崩溃后恢复数据：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          操作系统崩溃
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          电源（检测）失败
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          文件系统崩溃
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          硬件问题（硬盘驱动器，主板等）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该示例命令不包括诸如
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_user"><code class="option">--user</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_general_password"><code class="option">--password</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端程序。</font><font style="vertical-align: inherit;">您应该包含必要的选项以使客户端程序能够连接到MySQL服务器。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      假设数据存储在</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      存储引擎中，该引擎支持事务和自动崩溃恢复。</font><font style="vertical-align: inherit;">假设MySQL服务器在崩溃时处于负载状态。</font><font style="vertical-align: inherit;">如果不是，则不需要恢复。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于操作系统崩溃或电源故障，我们可以假定MySQL的磁盘数据在重新启动后可用。</font><font style="vertical-align: inherit;">该
       </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据文件可能不包含由于崩溃一致的数据，但</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取它的日志，并在其中发现挂起还没有被刷新到数据文件的提交和未提交的事务清单。</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动回滚那些未提交的事务，并将其提交的数据文件刷新到其数据文件中。</font><font style="vertical-align: inherit;">有关此恢复过程的信息通过MySQL错误日志传达给用户。</font><font style="vertical-align: inherit;">以下是日志摘录示例：
    </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InnoDB：数据库没有正常关闭。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：从日志文件开始恢复...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：根据检查点开始日志扫描</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：日志序号0 13674004</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：执行恢复：扫描到日志序号0 13739520</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：执行恢复：扫描到日志序号0 13805056</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：执行恢复：扫描到日志序号0 13870592</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：执行恢复：扫描到日志序号0 13936128</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：执行恢复：扫描到日志序号0 20555264</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：执行恢复：扫描到日志序号0 20620800</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：执行恢复：扫描到日志序号0 20664692</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：1个必须回滚的未提交的事务</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：开始回滚未提交的事务</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：回滚trx no 16745</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：完成trx no 16745的回滚</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：未完成交易的回滚已完成</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：开始对数据库应用一批日志记录...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：应用批处理完成</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
InnoDB：开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysqld：准备好连接</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于文件系统崩溃或硬件问题，我们可以假设MySQL磁盘数据</font><font style="vertical-align: inherit;">
      在重新启动后</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用。</font><font style="vertical-align: inherit;">这意味着MySQL无法成功启动，因为某些磁盘数据块不再可读。</font><font style="vertical-align: inherit;">在这种情况下，需要重新格式化磁盘，安装新磁盘，或者更正基本问题。</font><font style="vertical-align: inherit;">然后有必要从备份中恢复我们的MySQL数据，这意味着备份必须已经完成。</font><font style="vertical-align: inherit;">为了确保这种情况，请设计并实施备份策略。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="backup-policy"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.1建立备份策略</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了有用，必须定期安排备份。</font><font style="vertical-align: inherit;">可以使用多种工具在MySQL中完成完整备份（数据在某个时间点的快照）。</font><font style="vertical-align: inherit;">例如，
         </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-enterprise.html#mysql-enterprise-backup" title="29.2 MySQL企业备份概述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL企业备份</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以执行</font><font style="vertical-align: inherit;">整个实例</font><font style="vertical-align: inherit;">的
         </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_physical_backup" title="物理备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理备份</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，通过优化可以最大限度地减少开销并避免备份</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据文件</font><font style="vertical-align: inherit;">时发生中断</font><font style="vertical-align: inherit;">; </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供在线
         </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_logical_backup" title="逻辑备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逻辑备份</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这个讨论使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设我们</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在周日下午1点使用以下命令在负载较低时对所有数据库中</font><font style="vertical-align: inherit;">的所有</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">进行完整备份
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --all-databases --master-data --single-transaction &gt; backup_sunday_1_PM.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"></font><code class="filename">.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        生成的结果</font><font style="vertical-align: inherit;">文件
         </font><font style="vertical-align: inherit;">包含一组SQL
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，可用于稍后重新加载转储的表。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此备份操作在转储（使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH
        TABLES WITH READ LOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">开始处的所有表上获取全局读取锁定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一旦获得该锁，就会读取二进制日志坐标并释放锁。</font><font style="vertical-align: inherit;">如果在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush" title="13.7.6.3 FLUSH语法"><code class="literal">FLUSH</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布语句</font><font style="vertical-align: inherit;">时长时间更新语句正在运行
         </font><font style="vertical-align: inherit;">，备份操作可能会停止，直到这些语句完成。</font><font style="vertical-align: inherit;">之后，转储变得无锁并且不会干扰读取和写入表格。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        之前假定要备份的表是
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，因此
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用一致的读取并保证</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到的数据
         </font><font style="vertical-align: inherit;">不会改变。</font><font style="vertical-align: inherit;">（其他客户端对</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表进行的</font><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">不会被</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程</font><font style="vertical-align: inherit;">看到</font><font style="vertical-align: inherit;">。）如果备份操作包含非事务表，则一致性要求在备份过程中它们不会更改。</font><font style="vertical-align: inherit;">例如，对于</font><font style="vertical-align: inherit;">
        数据库中</font><font style="vertical-align: inherit;">的
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在备份过程中不得对MySQL帐户进行管理性更改。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        完整的备份是必要的，但创建它们并不总是方便的。</font><font style="vertical-align: inherit;">他们会生成大量的备份文件并需要时间来生成。</font><font style="vertical-align: inherit;">从每次连续完整备份包含所有数据的意义上说，它们并不是最佳选择，即使那些自上次完全备份以来没有更改的部分也是如此。</font><font style="vertical-align: inherit;">进行初始完整备份，然后进行增量备份会更高效。</font><font style="vertical-align: inherit;">增量备份更小，生产时间更短。</font><font style="vertical-align: inherit;">折中的是，在恢复时，只能通过重新加载完整备份来恢复数据。</font><font style="vertical-align: inherit;">您还必须处理增量备份以恢复增量更改。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要进行增量备份，我们需要保存增量更改。</font><font style="vertical-align: inherit;">在MySQL中，这些更改用二进制日志表示，所以MySQL服务器应该始终启动并
         </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用该日志。</font><font style="vertical-align: inherit;">启用二进制日志记录后，服务器在更新数据时将每个数据更改写入文件。</font><font style="vertical-align: inherit;">查看使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动的MySQL服务器的数据目录，该服务器
         </font><font style="vertical-align: inherit;">已经运行了一段时间，我们发现这些MySQL二进制日志文件：
      </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-rw ---- 1 guilhem guilhem 1277324 11月10日23:59 gbichot2-bin.000001</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-rw-rw ---- 1 guilhem guilhem 4 11月10日23:59 gbichot2-bin.000002</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-rw-rw ---- 1 guilhem guilhem 79 11月11日11:06 gbichot2-bin.000003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-rw-rw ---- 1 guilhem guilhem 508 Nov 11 11:08 gbichot2-bin.000004</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-rw-rw ---- 1 guilhem guilhem 220047446 Nov 12 16:47 gbichot2-bin.000005</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-rw-rw ---- 1 guilhem guilhem 998412 Nov 14 10:08 gbichot2-bin.000006</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-rw-rw ---- 1 guilhem guilhem 361 Nov 14 10:07 gbichot2-bin.index</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每次重新启动时，MySQL服务器都会使用序列中的下一个数字创建一个新的二进制日志文件。</font><font style="vertical-align: inherit;">当服务器正在运行时，您还可以通过发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语句或使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-logs</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">来告诉它关闭当前的二进制日志文件并手动开始一个新文件
         </font><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也有一个选项来刷新日志。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">.index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据目录文件中包含该目录下所有MySQL二进制日志的清单。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL二进制日志对恢复很重要，因为它们构成了增量备份集。</font><font style="vertical-align: inherit;">如果您确保在进行完整备份时刷新日志，则以后创建的二进制日志文件将包含自备份以来所做的所有数据更改。</font><font style="vertical-align: inherit;">让我们修改一下前面的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        命令，以便在完整备份时刷新MySQL二进制日志，并使转储文件包含新的当前二进制日志的名称：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --single-transaction --flush-logs --master-data=2 \</code></strong>
         <strong class="userinput"><code>--all-databases &gt; backup_sunday_1_PM.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        执行此命令后，数据目录包含一个新的二进制日志文件</font></font><code class="filename">gbichot2-bin.000007</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_flush-logs"><code class="option">--flush-logs</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项会导致服务器刷新其日志。</font><font style="vertical-align: inherit;">该
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_master-data"><code class="option">--master-data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项会导致
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将二进制日志信息写入其输出，因此生成的</font></font><code class="filename">.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储文件包含以下行：
      </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 从开始复制或时间点恢复的位置</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- 将主设备更改为MASTER_LOG_FILE ='gbichot2-bin.000007'，MASTER_LOG_POS = 4;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令进行了完整备份，因此这些行意味着两件事情：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            转储文件包含在写入</font></font><code class="filename">gbichot2-bin.000007</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            二进制日志文件或更高版本的</font><font style="vertical-align: inherit;">任何更改之前所做的所有更改</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            备份后记录的所有数据更改都不存在于转储文件中，但存在于
             </font></font><code class="filename">gbichot2-bin.000007</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制日志文件或更高版本中。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        星期一下午1点，我们可以通过刷新日志创建一个增量备份来开始一个新的二进制日志文件。</font><font style="vertical-align: inherit;">例如，执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-logs</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令会创建</font></font><code class="filename">gbichot2-bin.000008</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">星期日下午1点全部备份和星期一下午1点之间的所有更改将在</font></font><code class="filename">gbichot2-bin.000007</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中。</font><font style="vertical-align: inherit;">这种增量备份非常重要，因此将其复制到安全的地方是一个不错的主意。</font><font style="vertical-align: inherit;">（例如，将其备份到磁带或DVD上，或将其复制到另一台计算机上。）星期二下午1点，执行另一个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-logs</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">周一下午1点到周一下午1点之间的所有更改都将在
         </font></font><code class="filename">gbichot2-bin.000008</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中（也应该在安全的地方复制）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL二进制日志占用磁盘空间。</font><font style="vertical-align: inherit;">为了释放空间，不时清除它们。</font><font style="vertical-align: inherit;">一种方法是通过删除不再需要的二进制日志，例如当我们进行完整备份时：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --single-transaction --flush-logs --master-data=2 \</code></strong>
         <strong class="userinput"><code>--all-databases --delete-master-logs &gt; backup_sunday_1_PM.sql</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的服务器是复制主服务器，那么</font><font style="vertical-align: inherit;">
          使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump --delete-master-logs</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除MySQL二进制日志</font><font style="vertical-align: inherit;">可能很危险，因为从属服务器可能尚未完全处理二进制日志的内容。</font><font style="vertical-align: inherit;">该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#purge-binary-logs" title="13.4.1.1 PURGE BINARY LOGS语法"><code class="literal">PURGE BINARY
          LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的说明解释了在删除MySQL二进制日志之前应该验证的内容。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#purge-binary-logs" title="13.4.1.1 PURGE BINARY LOGS语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.4.1.1节“PURGE BINARY LOGS语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="recovery-from-backups"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.2使用备份进行恢复</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        现在，假设我们周三早上8点发生灾难性的崩溃，需要从备份中恢复。</font><font style="vertical-align: inherit;">要恢复，首先我们要恢复上次完整备份（从星期日下午1点开始）。</font><font style="vertical-align: inherit;">完整备份文件只是一组SQL语句，因此恢复它非常简单：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql &lt; backup_sunday_1_PM.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此时，数据将恢复到星期日下午1点的状态。</font><font style="vertical-align: inherit;">为了恢复从那时起所做的更改，我们必须使用增量备份; </font><font style="vertical-align: inherit;">即，
         </font></font><code class="filename">gbichot2-bin.000007</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="filename">gbichot2-bin.000008</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制日志文件。</font><font style="vertical-align: inherit;">如果需要，从文件备份位置获取文件，然后像这样处理它们的内容：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog gbichot2-bin.000007 gbichot2-bin.000008 | mysql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        我们现在已经将数据恢复到了星期二下午1点的状态，但仍然缺少从该日期到崩溃日期的更改。</font><font style="vertical-align: inherit;">为了不丢失它们，我们需要让MySQL服务器将其MySQL二进制日志存储到与存储数据文件的地方不同的安全位置（RAID磁盘，SAN，...），以便这些日志不是在被毁坏的磁盘上。</font><font style="vertical-align: inherit;">（也就是说，我们可以使用一个</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">来启动服务器，该
         </font><font style="vertical-align: inherit;">选项指定与数据目录所在的设备不同的物理设备上的位置，这样，即使包含该目录的设备丢失，日志也是安全的。）如果我们已经做到了这一点，我们会有</font></font><code class="filename">gbichot2-bin.000009</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        文件（以及任何后续文件），我们可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">应用它们</font><font style="vertical-align: inherit;">以恢复最近的数据更改，直到崩溃时刻为止没有任何损失：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog gbichot2-bin.000009 ... | mysql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        处理二进制日志文件的</font><font style="vertical-align: inherit;">更多信息</font><font style="vertical-align: inherit;">，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#point-in-time-recovery" title="7.5使用二进制日志的时间点（增量）恢复"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.5节“使用二进制日志进行时间点恢复（增量）”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="backup-strategy-summary"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.3备份策略摘要</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在操作系统崩溃或电源故障的情况下，
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它自己完成恢复数据的所有工作。</font><font style="vertical-align: inherit;">但要确保您可以安然入睡，请遵守以下准则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            始终使用该</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">运行MySQL服务器
             </font><font style="vertical-align: inherit;">，或者甚至
             </font><font style="vertical-align: inherit;">在日志文件名位于与数据目录所在的驱动器不同的安全介质上的位置。</font><font style="vertical-align: inherit;">如果你有这样安全的介质，这种技术对磁盘负载平衡也是很好的（这可以提高性能）。
          </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin=<em class="replaceable"><code>log_name</code></em></code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-policy" title="7.3.1建立备份策略"><font style="vertical-align: inherit;">第7.3.1节“建立备份策略”</font></a><font style="vertical-align: inherit;">中的前面所示</font><font style="vertical-align: inherit;">的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">定期进行完整备份，该
             </font><font style="vertical-align: inherit;">命令
             </font><font style="vertical-align: inherit;">可进行在线非阻塞备份。
          </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-policy" title="7.3.1建立备份策略"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-logs刷新日志来</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期进行增量备份
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="using-mysqldump"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4使用mysqldump进行备份</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-sql-format"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.1使用mysqldump以SQL格式转储数据</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#reloading-sql-format-dumps"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.2重新加载SQL格式备份</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-delimited-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.3使用mysqldump以分隔文本格式转储数据</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#reloading-delimited-text-dumps"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.4重新加载分隔文本格式备份</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-tips"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5 mysqldump提示</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528108155840"></a><a class="indexterm" name="idm140528108154384"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节介绍如何使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成转储文件，以及如何重新加载转储文件。</font><font style="vertical-align: inherit;">转储文件可以以多种方式使用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          作为在数据丢失的情况下启用数据恢复的备份。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          作为设置复制从站的数据源。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          作为实验数据的来源：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在不更改原始数据的情况下制作可以使用的数据库的副本。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              测试潜在的升级不兼容性。
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p>
      <a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成两种类型的输出，具体取决于是否</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_tab"><code class="option">--tab</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      给出选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          没有</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_tab"><code class="option">--tab</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将SQL语句写入标准输出。</font><font style="vertical-align: inherit;">此输出包含
           </font></font><code class="literal">CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于创建转储对象（数据库，表，存储例程等）的</font></font><code class="literal">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">以及
           </font><font style="vertical-align: inherit;">用于将数据加载到表中的语句。</font><font style="vertical-align: inherit;">输出可以保存在文件中，稍后使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新创建转储的对象。</font><font style="vertical-align: inherit;">选项可用于修改SQL语句的格式，并控制转储哪些对象。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_tab"><code class="option">--tab</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个转储的表生成两个输出文件。</font><font style="vertical-align: inherit;">服务器将一个文件写为制表符分隔的文本，每行一行一行。</font><font style="vertical-align: inherit;">该文件</font></font><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在输出目录中</font><font style="vertical-align: inherit;">命名
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">服务器还将</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">发送
           </font><font style="vertical-align: inherit;">给</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">语句将</font><font style="vertical-align: inherit;">其写为</font></font><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          输出目录中</font><font style="vertical-align: inherit;">指定的文件
           </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysqldump-sql-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.1使用mysqldump以SQL格式转储数据</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        创建SQL格式的转储文件。</font><font style="vertical-align: inherit;">有关重新加载此类转储文件的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#reloading-sql-format-dumps" title="7.4.2重新加载SQL格式备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.4.2节“重新加载SQL格式备份”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        默认情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将信息作为SQL语句写入标准输出。</font><font style="vertical-align: inherit;">您可以将输出保存在文件中：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump [<em class="replaceable"><code>arguments</code></em>] &gt; <em class="replaceable"><code>file_name</code></em></code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要转储所有数据库，请</font><font style="vertical-align: inherit;">使用以下</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">调用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_all-databases"><code class="option">--all-databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --all-databases &gt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要仅转储特定的数据库，请在命令行上对其进行命名并使用以下</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --databases db1 db2 db3 &gt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项会将命令行上的所有名称视为数据库名称。</font><font style="vertical-align: inherit;">如果没有这个选项，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会将第一个名称视为数据库名称，将其后面的名称视为表名称。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_all-databases"><code class="option">--all-databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        会在每个数据库的转储输出之前</font><font style="vertical-align: inherit;">写入</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE
        DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。</font><font style="vertical-align: inherit;">这确保了在转储文件重新加载时，它会创建每个数据库（如果它不存在并使其成为默认数据库），以便将数据库内容加载到它们所来自的同一个数据库中。</font><font style="vertical-align: inherit;">如果您希望在重新创建转储文件之前强制删除每个数据库，请使用该
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_add-drop-database"><code class="option">--add-drop-database</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">前</font><font style="vertical-align: inherit;">写入一条
         </font><font style="vertical-align: inherit;">语句。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要转储单个数据库，请在命令行中将其命名：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --databases test &gt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在单数据库的情况下，可以省略
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump test &gt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        前两个命令之间的区别在于，没有</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，转储输出包含no </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE
        DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句。</font><font style="vertical-align: inherit;">这有几个含义：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当您重新加载转储文件时，您必须指定一个默认的数据库名称，以便服务器知道要重新加载哪个数据库。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于重新加载，您可以指定一个与原始名称不同的数据库名称，这使您可以将数据重新加载到不同的数据库中。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果要重新加载的数据库不存在，则必须先创建它。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于输出将不包含
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，因此该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_add-drop-database"><code class="option">--add-drop-database</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项不起作用。</font><font style="vertical-align: inherit;">如果你使用它，它不会产生任何
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要仅转储数据库中的特定表，请在数据库名称后面的命令行中对其进行命名：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump test t1 t3 t7 &gt; dump.sql</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="reloading-sql-format-dumps"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.2重新加载SQL格式备份</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要重新加载由</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写的</font><font style="vertical-align: inherit;">
        由SQL语句组成的</font><font style="vertical-align: inherit;">转储文件</font><font style="vertical-align: inherit;">，请将其用作</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端的</font><font style="vertical-align: inherit;">输入
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果转储文件是</font><font style="vertical-align: inherit;">使用
         </font><font style="vertical-align: inherit;">or
         </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">由</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的
         </font><font style="vertical-align: inherit;">，则它包含</font><font style="vertical-align: inherit;">和
         </font><font style="vertical-align: inherit;">语句，并且不需要指定加载数据的默认数据库：
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_all-databases"><code class="option">--all-databases</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql &lt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或者，从</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部</font><font style="vertical-align: inherit;">，使用一个
         </font></font><code class="literal">source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>source dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果该文件是不包含</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的单数据库转储
         </font><font style="vertical-align: inherit;">，请首先创建数据库（如有必要）：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqladmin create db1</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        然后在加载转储文件时指定数据库名称：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql db1 &lt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        另外，从</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部</font><font style="vertical-align: inherit;">，创建数据库，选择它作为默认数据库，并加载转储文件：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE DATABASE IF NOT EXISTS db1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>USE db1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>source dump.sql</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于Windows PowerShell用户：由于“&lt;”字符保留供将来在PowerShell中使用，因此需要使用替代方法，例如使用引号</font></font><code class="literal">cmd.exe /c "mysql
          &lt; dump.sql"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysqldump-delimited-text"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.3使用mysqldump以分隔文本格式转储数据</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        创建分隔文本转储文件。</font><font style="vertical-align: inherit;">有关重新加载此转储文件的信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#reloading-delimited-text-dumps" title="7.4.4重新加载分隔文本格式备份"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.4.4节“重新加载分隔文本格式备份”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果</font><font style="vertical-align: inherit;">使用该
         </font><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">调用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将使用</font><font style="vertical-align: inherit;">输出目录并在每个表中使用两个文件在该目录中单独转储表。</font><font style="vertical-align: inherit;">表名是这些文件的基本名称。</font><font style="vertical-align: inherit;">对于名为的表</font><font style="vertical-align: inherit;">，这些文件被命名为</font><font style="vertical-align: inherit;">和
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">文件包含</font><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">文件包含表格数据，每行表格一行。
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_tab"><code class="option">--tab=<em class="replaceable"><code>dir_name</code></em></code></a><font style="vertical-align: inherit;"></font><em class="replaceable"><code>dir_name</code></em><font style="vertical-align: inherit;"></font><code class="literal">t1</code><font style="vertical-align: inherit;"></font><code class="filename">t1.sql</code><font style="vertical-align: inherit;"></font><code class="filename">t1.txt</code><font style="vertical-align: inherit;"></font><code class="filename">.sql</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"></font><code class="filename">.txt</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下命令将</font></font><code class="literal">db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">的内容转储到
         </font><font style="vertical-align: inherit;">数据库中的文件中
         </font></font><code class="filename">/tmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --tab=/tmp db1</code></strong>
</pre><p><font style="vertical-align: inherit;"></font><code class="filename">.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含表格数据</font><font style="vertical-align: inherit;">
        的</font><font style="vertical-align: inherit;">文件由服务器编写，因此它们由用于运行服务器的系统帐户拥有。</font><font style="vertical-align: inherit;">服务器用于
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO语法"><code class="literal">SELECT ... INTO
        OUTFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入文件，因此您必须有权
         </font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_file"><code class="literal">FILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行此操作，并且如果给定</font></font><code class="filename">.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件已存在，</font><font style="vertical-align: inherit;">则会发生错误
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器将</font></font><code class="literal">CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">发送</font><font style="vertical-align: inherit;">给</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;">mysqldump</font></strong></span></a><font style="vertical-align: inherit;">将它们写入</font></font><code class="filename">.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">这些文件因此由执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的用户拥有</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        最好</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_tab"><code class="option">--tab</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只用于转储本地服务器。</font><font style="vertical-align: inherit;">如果您与远程服务器使用，该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_tab"><code class="option">--tab</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录必须存在于本地和远程主机都和
         </font></font><code class="filename">.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件将通过在远程目录服务器（服务器主机上）写，而
         </font></font><code class="filename">.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件将被写入
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本地目录（在客户端主机上）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump --tab</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，默认情况下，服务器将表数据写入</font></font><code class="filename">.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，每行一行，列值之间为制表符，列值周围没有引号，行换行符为换行符。</font><font style="vertical-align: inherit;">（这些与默认值相同
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO语法"><code class="literal">SELECT ... INTO
        OUTFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要使用不同的格式写入数据文件，
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持以下选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_fields"><code class="option">--fields-terminated-by=<em class="replaceable"><code>str</code></em></code></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于分隔列值的字符串（默认值：tab）。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_fields"><code class="option">--fields-enclosed-by=<em class="replaceable"><code>char</code></em></code></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            包含列值的字符（默认值：无字符）。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_fields"><code class="option">--fields-optionally-enclosed-by=<em class="replaceable"><code>char</code></em></code></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            包含非数字列值的字符（默认值：无字符）。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_fields"><code class="option">--fields-escaped-by=<em class="replaceable"><code>char</code></em></code></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            转义特殊字符的字符（默认：不转义）。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_lines-terminated-by"><code class="option">--lines-terminated-by=<em class="replaceable"><code>str</code></em></code></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            行终止字符串（默认值：换行符）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        根据您为任何这些选项指定的值，可能需要在命令行上为您的命令解释器引用或转义适当的值。</font><font style="vertical-align: inherit;">或者，使用十六进制表示法指定值。</font><font style="vertical-align: inherit;">假设您希望
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在双引号内引用列值。</font><font style="vertical-align: inherit;">为此，请将双引号指定为该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_fields"><code class="option">--fields-enclosed-by</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">的值
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是这个角色通常是专门指挥口译员的，并且必须特别对待。</font><font style="vertical-align: inherit;">例如，在Unix上，你可以引用这样的双引号：
      </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--fields封闭逐=““”
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在任何平台上，您都可以用十六进制指定值：
      </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--fields封闭逐=为0x22
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一起使用几个数据格式化选项是很常见的。</font><font style="vertical-align: inherit;">例如，要以逗号分隔值格式转储表格，并用由回车/换行符对（</font></font><code class="literal">\r\n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">结尾的行</font><font style="vertical-align: inherit;">，请使用以下命令（在一行中输入）：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --tab=/tmp --fields-terminated-by=,</code></strong>
         <strong class="userinput"><code>--fields-enclosed-by='"' --lines-terminated-by=0x0d0a db1</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您使用任何数据格式化选项来转储表数据，则在稍后重新加载数据文件时，您需要指定相同的格式，以确保正确解释文件内容。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="reloading-delimited-text-dumps"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.4重新加载分隔文本格式备份</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump --tab</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的备份</font><font style="vertical-align: inherit;">，每个表在输出目录中都由
         </font></font><code class="filename">.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的
         </font><font style="vertical-align: inherit;">语句的</font></font><code class="filename">.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">包含表数据</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">文件表示。</font><font style="vertical-align: inherit;">要重新加载表格，请首先将位置更改为输出目录。</font><font style="vertical-align: inherit;">然后</font></font><code class="filename">.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理</font><font style="vertical-align: inherit;">文件
         </font><font style="vertical-align: inherit;">以创建一个空表并处理</font></font><code class="filename">.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件以将数据加载到表中：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysql db1 &lt; t1.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>mysqlimport db1 t1.txt</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlimport" title="4.5.5 mysqlimport  - 数据导入程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlimport</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载数据文件</font><font style="vertical-align: inherit;">的另一种方法</font><font style="vertical-align: inherit;">是使用</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;">mysql</font></strong></span></a><font style="vertical-align: inherit;">客户端中</font><font style="vertical-align: inherit;">的
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
         </font><font style="vertical-align: inherit;">：
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>USE db1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>LOAD DATA INFILE 't1.txt' INTO TABLE t1;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您</font><font style="vertical-align: inherit;">在初始转储表时</font><font style="vertical-align: inherit;">使用了任何具有</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据格式化选项
         </font><font style="vertical-align: inherit;">，则必须使用与</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlimport" title="4.5.5 mysqlimport  - 数据导入程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlimport</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同的选项
         </font><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保正确解释数据文件内容：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlimport --fields-terminated-by=,</code></strong>
         <strong class="userinput"><code>--fields-enclosed-by='"' --lines-terminated-by=0x0d0a db1 t1.txt</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要么：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>USE db1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>LOAD DATA INFILE 't1.txt' INTO TABLE t1</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt; </font></font><strong class="userinput"><code>FIELDS TERMINATED BY ',' FIELDS ENCLOSED BY '"'</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    - &gt;</font></font><strong class="userinput"><code>LINES TERMINATED BY '\r\n';</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysqldump-tips"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5 mysqldump提示</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-copying-database"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.1复制数据库</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-copying-to-other-server"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.2将数据库从一台服务器复制到另一台服务器</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-stored-programs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.3倾销存储程序</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-definition-data-dumps"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.4单独转储表定义和内容</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#mysqldump-upgrade-testing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.5使用mysqldump测试升级不兼容性</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节将调查使您能够使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决特定问题的技术：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如何复制一个数据库
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如何将数据库从一台服务器复制到另一台服务器
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如何转储存储的程序（存储过程和函数，触发器和事件）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如何分别转储定义和数据
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="mysqldump-copying-database"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.1复制数据库</font></font></h4>

</div>

</div>

</div>
<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysqldump db1 &gt; dump.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt; </font></font><strong class="userinput"><code>mysqladmin create db2</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>mysql db2 &lt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不要使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为这会导致命令行</font></font><code class="literal">USE db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要包含在转储文件，它覆盖命名的效果
           </font></font><code class="literal">db2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="mysqldump-copying-to-other-server"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.2将数据库从一台服务器复制到另一台服务器</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器1上：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --databases db1 &gt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将转储文件从服务器1复制到服务器2。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器2上：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql &lt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行导致转储文件，包括</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-database" title="13.1.11 CREATE DATABASE语法"><code class="literal">CREATE DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#use" title="13.8.4 USE语法"><code class="literal">USE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建数据库语句，如果它确实存在，并使其成为默认的数据库为重新加载数据。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，您可以</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令中</font><font style="vertical-align: inherit;">省略
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，您需要在服务器2上创建数据库（如有必要），并在重新加载转储文件时将其指定为默认数据库。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器1上：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump db1 &gt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器2上：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysqladmin create db1</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>mysql db1 &lt; dump.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下，您可以指定不同的数据库名称，因此，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_databases"><code class="option">--databases</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令中</font><font style="vertical-align: inherit;">省略</font><font style="vertical-align: inherit;">可以从一个数据库转储数据并将其加载到另一个数据库中。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="mysqldump-stored-programs"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.3倾销存储程序</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有几个选项控制</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何</font><font style="vertical-align: inherit;">
          处理存储的程序（存储过程和函数，触发器和事件）：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_events"><code class="option">--events</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：转储事件调度程序事件
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_routines"><code class="option">--routines</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：转储存储过程和函数
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_triggers"><code class="option">--triggers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：转储表的触发器
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_triggers"><code class="option">--triggers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项在默认情况下处于启用状态，所以当表被转储时，它们会伴随着它们所具有的任何触发器。</font><font style="vertical-align: inherit;">其他选项默认是禁用的，必须明确指定才能转储相应的对象。</font><font style="vertical-align: inherit;">要禁用的任何选项明确，利用其跳跃的形式：
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_events"><code class="option">--skip-events</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_routines"><code class="option">--skip-routines</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_triggers"><code class="option">--skip-triggers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="mysqldump-definition-data-dumps"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.4单独转储表定义和内容</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_no-data"><code class="option">--no-data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项告诉
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要转储表数据，导致只包含用于创建表的语句的转储文件。</font><font style="vertical-align: inherit;">相反，该
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_no-create-info"><code class="option">--no-create-info</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项告诉</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump</font></font></strong></span></a><font style="vertical-align: inherit;"></font><code class="literal">CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从输出中</font><font style="vertical-align: inherit;">抑制
           </font><font style="vertical-align: inherit;">语句，以便转储文件仅包含表数据。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例如，要为</font></font><code class="literal">test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">分别转储表定义和数据</font><font style="vertical-align: inherit;">，请使用以下命令：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysqldump --no-data test &gt; dump-defs.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>mysqldump --no-create-info test &gt; dump-data.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于仅定义转储，添加
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_routines"><code class="option">--routines</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_events"><code class="option">--events</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项以包含存储的例程和事件定义：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --no-data --routines --events test &gt; dump-defs.sql</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="mysqldump-upgrade-testing"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5.5使用mysqldump测试升级不兼容性</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在考虑进行MySQL升级时，谨慎地安装与当前生产版本分开的新版本。</font><font style="vertical-align: inherit;">然后，您可以从生产服务器转储数据库和数据库对象定义，并将它们加载到新服务器中，以验证它们是否得到正确处理。</font><font style="vertical-align: inherit;">（这对于测试降级也很有用。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在生产服务器上：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --all-databases --no-data --routines --events &gt; dump-defs.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在升级后的服务器上：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql &lt; dump-defs.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          由于转储文件不包含表格数据，因此可以快速处理。</font><font style="vertical-align: inherit;">这使您能够发现潜在的不兼容性，而无需等待冗长的数据加载操作。</font><font style="vertical-align: inherit;">正在处理转储文件时查找警告或错误。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在验证了定义处理正确之后，转储数据并尝试将其加载到升级后的服务器中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在生产服务器上：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqldump --all-databases --no-create-info &gt; dump-data.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在升级后的服务器上：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql &lt; dump-data.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在检查表格内容并运行一些测试查询。
</font></font></p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="point-in-time-recovery"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5使用二进制日志的时间点（增量）恢复</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#point-in-time-recovery-times"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5.1使用事件时间进行时间点恢复</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#point-in-time-recovery-positions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5.2使用事件位置的时间点恢复</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528107883600"></a><a class="indexterm" name="idm140528107882560"></a><a class="indexterm" name="idm140528107881072"></a><a class="indexterm" name="idm140528107880000"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      时间点恢复是指恢复自给定时间点以来所做的数据更改。</font><font style="vertical-align: inherit;">通常，这种类型的恢复是在恢复完整备份后执行的，该备份会将服务器置于其进行备份时的状态。</font><font style="vertical-align: inherit;">（完整备份可以通过多种方式进行，例如</font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-methods" title="7.2数据库备份方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.2节“数据库备份方法”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出的那些
       </font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#backup-methods" title="7.2数据库备份方法"><font style="vertical-align: inherit;">方法）</font></a><font style="vertical-align: inherit;">。时间点恢复使服务器从完全备份时间开始逐步更新到更多最近时间。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这里的许多示例使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        客户端来处理由</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的二进制日志输出
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果你的二进制日志包含
         </font></font><code class="literal">\0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（空）字符，那么这个输出不能被</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析，</font><font style="vertical-align: inherit;">除非你用这个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_binary-mode"><code class="option">--binary-mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">调用它
         </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      时间点恢复基于以下原则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          时间点恢复信息的来源是由完整备份操作后生成的二进制日志文件所代表的一组增量备份。</font><font style="vertical-align: inherit;">因此，服务器必须启动，
           </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才能启用二进制日志记录（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要从二进制日志中恢复数据，您必须知道当前二进制日志文件的名称和位置。</font><font style="vertical-align: inherit;">默认情况下，服务器会在数据目录中创建二进制日志文件，但可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将文件放置在不同位置</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">指定路径名
           </font><font style="vertical-align: inherit;">。</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要查看所有二进制日志文件的列表，请使用以下语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW BINARY LOGS;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要确定当前二进制日志文件的名称，请发出以下语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW MASTER STATUS;</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog可以</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用转换从二进制格式的二进制日志文件的事件文本，以便他们可以执行或查看。</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          有根据事件时间或日志内事件的位置选择二进制日志部分的选项。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.7节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 处理二进制日志文件的实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          从二进制日志中执行事件会导致它们所代表的数据修改重做。</font><font style="vertical-align: inherit;">这使得能够在给定的时间范围内恢复数据更改。</font><font style="vertical-align: inherit;">要从二进制日志中执行事件，请</font><font style="vertical-align: inherit;">使用</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;">mysql</font></strong></span></a><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">处理
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出
           </font><font style="vertical-align: inherit;">：
        </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog <em class="replaceable"><code>binlog_files</code></em> | mysql -u root -p</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当您需要确定事件时间或位置以在执行事件之前选择部分日志内容时，查看日志内容可能很有用。</font><font style="vertical-align: inherit;">要查看日志中的事件，请将</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出</font><font style="vertical-align: inherit;">发送
           </font><font style="vertical-align: inherit;">到分页程序中：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog <em class="replaceable"><code>binlog_files</code></em> | more</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          或者，将输出保存在文件中并在文本编辑器中查看该文件：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt; ... </font><font style="vertical-align: inherit;">...
</font></font><strong class="userinput"><code>mysqlbinlog <em class="replaceable"><code>binlog_files</code></em> &gt; tmpfile</code></strong><font style="vertical-align: inherit;"></font><em class="replaceable"><code>edit tmpfile</code></em><font style="vertical-align: inherit;"></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将输出结果保存在文件中对于在删除某些事件（如意外事件）时执行日志内容的初步情况非常有用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在执行其内容之前，您可以从文件中删除任何不被执行的语句。</font><font style="vertical-align: inherit;">编辑文件后，执行如下内容：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql -u root -p &lt; tmpfile</code></strong>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果您在MySQL服务器上有多个二进制日志要执行，那么安全的方法是使用到服务器的单一连接来处理它们。</font><font style="vertical-align: inherit;">下面是一个演示可能</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的例子</font><font style="vertical-align: inherit;">：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysqlbinlog binlog.000001 | mysql -u root -p # DANGER!!</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>mysqlbinlog binlog.000002 | mysql -u root -p # DANGER!!</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果第一个日志文件包含</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TEMPORARY
      TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句并且第二个日志包含使用临时表的语句，则使用与</font><font style="vertical-align: inherit;">服务器的不同连接以这种方式处理二进制日志会导致问题
       </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当第一个
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程终止时，服务器删除临时表。</font><font style="vertical-align: inherit;">当第二个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程尝试使用该表时，服务器报告</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未知表”。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span>
    </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      为避免这样的问题，请使用</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
      连接来执行您要处理的所有二进制日志的内容。</font><font style="vertical-align: inherit;">这是一种方法：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog binlog.000001 binlog.000002 | mysql -u root -p</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      另一种方法是将所有日志写入单个文件，然后处理该文件：
    </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysqlbinlog binlog.000001 &gt;  /tmp/statements.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt; </font></font><strong class="userinput"><code>mysqlbinlog binlog.000002 &gt;&gt; /tmp/statements.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>mysql -u root -p -e "source /tmp/statements.sql"</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在从包含GTID的二进制日志中读回时写入转储文件时（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16.1.3 </font><a class="xref" href="/mysql-5.7-google-zh/replication.html#replication-gtids" title="16.1.3使用全局事务标识符进行复制"><font style="vertical-align: inherit;">节“使用全局事务标识符进行复制”</font></a><font style="vertical-align: inherit;">），请使用</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;">mysqlbinlog</font></strong></span></a></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_skip-gtids"><code class="option">--skip-gtids</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
       </font><font style="vertical-align: inherit;">，如下所示：
    </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mysqlbinlog --skip-gtids binlog.000001 &gt;  /tmp/dump.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt; </font></font><strong class="userinput"><code>mysqlbinlog --skip-gtids binlog.000002 &gt;&gt; /tmp/dump.sql</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>mysql -u root -p -e "source /tmp/dump.sql"</code></strong>
</pre>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="point-in-time-recovery-times"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5.1使用事件时间进行时间点恢复</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要指示恢复的开始和结束时间</font><font style="vertical-align: inherit;">，请以
         </font><font style="vertical-align: inherit;">格式</font><font style="vertical-align: inherit;">指定
         </font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;">mysqlbinlog</font></strong></span></a></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_start-datetime"><code class="option">--start-datetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_stop-datetime"><code class="option">--stop-datetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，假设恰好在2005年4月20日上午10点执行了一条删除大表的SQL语句。</font><font style="vertical-align: inherit;">要恢复表和数据，可以恢复前一夜的备份，然后执行以下命令：
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">DATETIME</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog --stop-datetime="2005-04-20 9:59:59" \</code></strong>
         <strong class="userinput"><code>/var/log/mysql/bin.123456 | mysql -u root -p</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该命令恢复所有数据直到</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_stop-datetime"><code class="option">--stop-datetime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">给出的日期和时间</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您未检测到数小时后输入的错误SQL语句，那么您可能还想要恢复之后发生的活动。</font><font style="vertical-align: inherit;">基于此，您可以</font><font style="vertical-align: inherit;">使用开始日期和时间再次</font><font style="vertical-align: inherit;">运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog --start-datetime="2005-04-20 10:01:00" \</code></strong>
         <strong class="userinput"><code>/var/log/mysql/bin.123456 | mysql -u root -p</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在此命令中，从上午10:01开始记录的SQL语句将被重新执行。</font><font style="vertical-align: inherit;">恢复前一天的转储文件和两个
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令的组合可以恢复所有内容，直到上午10:00之前一秒钟以及上午10:01之前的所有内容。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要使用这种时间点恢复方法，您应该检查日志以确保为命令指定的确切时间。</font><font style="vertical-align: inherit;">要显示日志文件内容而不执行它们，请使用以下命令：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog /var/log/mysql/bin.123456 &gt; /tmp/mysql_restore.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        然后</font></font><code class="filename">/tmp/mysql_restore.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用文本编辑器</font><font style="vertical-align: inherit;">打开</font><font style="vertical-align: inherit;">文件来检查它。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果多个语句与被排除的语句同时执行，那么</font><font style="vertical-align: inherit;">
        通过指定</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间排除特定更改
         </font><font style="vertical-align: inherit;">不会有效。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="point-in-time-recovery-positions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5.2使用事件位置的时间点恢复</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        而不是指定日期和时间，</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;">mysqlbinlog</font></strong></span></a><font style="vertical-align: inherit;">的
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_start-position"><code class="option">--start-position</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqlbinlog_stop-position"><code class="option">--stop-position</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
         </font><font style="vertical-align: inherit;">可用于指定日志位置。</font><font style="vertical-align: inherit;">除了指定日志位置编号而不是日期之外，它们的工作方式与开始日期和停止日期选项相同。</font><font style="vertical-align: inherit;">使用职位可以使您更精确地确定要恢复的日志的哪一部分，特别是如果许多事务与损坏的SQL语句大约在同一时间发生。</font><font style="vertical-align: inherit;">要确定位置编号，请</font><font style="vertical-align: inherit;">在执行不需要的事务时接近</font><font style="vertical-align: inherit;">运行
         </font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;">mysqlbinlog</font></strong></span></a><font style="vertical-align: inherit;">一段时间，但将结果重定向到文本文件以供检查。</font><font style="vertical-align: inherit;">这可以这样做：
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog --start-datetime="2005-04-20 9:55:00" \</code></strong>
         <strong class="userinput"><code>--stop-datetime="2005-04-20 10:05:00" \</code></strong>
         <strong class="userinput"><code>/var/log/mysql/bin.123456 &gt; /tmp/mysql_restore.sql</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此命令</font></font><code class="filename">/tmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在执行有害SQL语句的时间周围包含SQL语句</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">目录中</font><font style="vertical-align: inherit;">创建一个小型文本文件
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">用文本编辑器打开此文件，并查找您不想重复的语句。</font><font style="vertical-align: inherit;">确定二进制日志中停止和恢复恢复的位置并记录它们。</font><font style="vertical-align: inherit;">职位被标记为
         </font></font><code class="literal">log_pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后跟一个数字。</font><font style="vertical-align: inherit;">恢复以前的备份文件后，请使用位置编号来处理二进制日志文件。</font><font style="vertical-align: inherit;">例如，你可以使用类似这样的命令：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog --stop-position=368312 /var/log/mysql/bin.123456 \</code></strong>
         <strong class="userinput"><code>| mysql -u root -p</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
外壳&gt; </font></font><strong class="userinput"><code>mysqlbinlog --start-position=368315 /var/log/mysql/bin.123456 \</code></strong>
         <strong class="userinput"><code>| mysql -u root -p</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        第一条命令恢复所有交易，直到给出停止位置。</font><font style="vertical-align: inherit;">第二个命令从给定的起始位置恢复所有事务，直到二进制日志结束。</font><font style="vertical-align: inherit;">由于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog  - 处理二进制日志文件的实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlbinlog</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的输出
         </font></font><code class="literal">SET
        TIMESTAMP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每条SQL语句记录之前</font><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">语句，因此恢复的数据和相关的MySQL日志将反映事务执行的原始时间。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="myisam-table-maintenance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6 MyISAM表维护和崩溃恢复</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-crash-recovery"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.1使用myisamchk进行崩溃恢复</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-check"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.2如何检查MyISAM表错误</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-repair"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.3如何修复MyISAM表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.4 MyISAM表优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-maintenance-schedule"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.5设置MyISAM表维护计划</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节讨论如何使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来检查或修复</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表（具有</font><font style="vertical-align: inherit;">存储数据和索引的</font><font style="vertical-align: inherit;">表
       </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于存储数据和索引的文件）。</font><font style="vertical-align: inherit;">对于一般的
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.3节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  MyISAM表维护实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">其他表格修复信息可在</font></font><a class="xref" href="/mysql-5.7-google-zh/installing.html#rebuilding-tables" title="2.11.3重建或修复表或索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.11.3节“重建或修复表格或索引”中找到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来检查，修复或优化数据库表。</font><font style="vertical-align: inherit;">以下各节介绍如何执行这些操作以及如何设置表维护计划。</font><font style="vertical-align: inherit;">有关使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
      获取有关表的信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk-table-info" title="4.6.3.5使用myisamchk获取表信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.3.5节“使用myisamchk获取表信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      尽管使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk进行</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格修复</font><font style="vertical-align: inherit;">是非常安全的，但</font><font style="vertical-align: inherit;">在进行修复或任何可能会对表格进行大量修改的维护操作</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行</font><font style="vertical-align: inherit;">备份始终是个好主意
       </font><font style="vertical-align: inherit;">。
    </font></font></p><p>
      <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响索引的</font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"> myisamchk</font></strong></span></a><font style="vertical-align: inherit;">操作可能会导致</font></font><code class="literal">MyISAM</code> <code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使用与MySQL服务器使用的值不兼容的全文参数来重建索引。</font><font style="vertical-align: inherit;">为避免此问题，请按照</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk-general-options" title="4.6.3.1 myisamchk一般选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.3.1节“myisamchk常规选项”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的指导进行
      </font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk-general-options" title="4.6.3.1 myisamchk一般选项"><font style="vertical-align: inherit;">操作</font></a><font style="vertical-align: inherit;">。
    </font></font></p><p>
      <code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用执行类似于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以</font><font style="vertical-align: inherit;">执行的操作的SQL语句完成表维护
       </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要检查</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要修复</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要优化</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要分析</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      有关这些语句的更多信息，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#table-maintenance-sql" title="13.7.2表维护陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2节“表维护语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这些语句可以直接使用或通过
       </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlcheck" title="4.5.3 mysqlcheck  - 一个表维护程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlcheck</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端程序使用。</font><font style="vertical-align: inherit;">这些对</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明的一个优点</font><font style="vertical-align: inherit;">是服务器完成所有工作。</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk时</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您必须确保服务器不会同时使用这些表，这样</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和服务器</font><font style="vertical-align: inherit;">之间就不会发生不必要的交互
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-crash-recovery"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.1使用myisamchk进行崩溃恢复</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528107737552"></a><a class="indexterm" name="idm140528107736096"></a><a class="indexterm" name="idm140528107734608"></a><a class="indexterm" name="idm140528107733536"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节介绍如何检查和处理MySQL数据库中的数据损坏。</font><font style="vertical-align: inherit;">如果你的表经常被破坏，你应该试着找出原因。</font><font style="vertical-align: inherit;">参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#crashing" title="B.5.3.3如果MySQL保持崩溃，该怎么办"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.3.3节“如果MySQL保持崩溃怎么办”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关如何</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破坏表</font><font style="vertical-align: inherit;">的说明</font><font style="vertical-align: inherit;">，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#myisam-table-problems" title="15.2.4 MyISAM表问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15.2.4节“MyISAM表问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果在</font><font style="vertical-align: inherit;">禁用外部锁定的情况下</font><font style="vertical-align: inherit;">运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这是默认设置），那么</font><font style="vertical-align: inherit;">当</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;">mysqld</font></strong></span></a><font style="vertical-align: inherit;">使用同</font><font style="vertical-align: inherit;">一个表时</font><font style="vertical-align: inherit;">，无法可靠地使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查
         </font><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">如果您可以确定没有人会</font><font style="vertical-align: inherit;">在运行
         </font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk时</font></strong></span></a><font style="vertical-align: inherit;">通过</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;">mysqld</font></strong></span></a><font style="vertical-align: inherit;">访问表
         </font><font style="vertical-align: inherit;">，则只需</font><font style="vertical-align: inherit;">在开始检查</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;">表</font></strong></span></a><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">执行
         </font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;">mysqladmin flush-</font></strong></span></a><font style="vertical-align: inherit;"> tables。</font><font style="vertical-align: inherit;">如果你不能保证这一点，你必须</font><font style="vertical-align: inherit;">在检查表格时</font><font style="vertical-align: inherit;">停止
         </font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;">mysqld</font></strong></span></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果你运行
         </font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><font style="vertical-align: inherit;">来检查</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;">mysqld</font></strong></span></a><font style="vertical-align: inherit;">表
        </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在同一时间更新时，即使不是，表格也可能会损坏。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果服务器在启用外部锁定的情况下运行，则可以随时使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查表。</font><font style="vertical-align: inherit;">在这种情况下，如果服务器尝试更新</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在使用</font><font style="vertical-align: inherit;">的表，
         </font><font style="vertical-align: inherit;">服务器将</font><font style="vertical-align: inherit;">在继续之前</font><font style="vertical-align: inherit;">等待
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修复或优化表，则</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终确保
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器不使用表（这也适用于禁用外部锁定的情况）。</font><font style="vertical-align: inherit;">如果你不停止</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你至少应该在
         </font><font style="vertical-align: inherit;">运行</font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><font style="vertical-align: inherit;">之前执行
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-tables</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果服务器和
         </font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><font style="vertical-align: inherit;">同时访问表，</font><font style="vertical-align: inherit;">您的表</font><span class="emphasis"><em><font style="vertical-align: inherit;">可能会损坏</font></em></span><font style="vertical-align: inherit;">。
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        执行故障恢复时，重要的是要了解</font><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">中的每个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表
         </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与下表中显示的数据库目录中的三个文件相对应。
</font></font></p>
<div class="informaltable">
<table summary="The three files in the database directory that correspond to each MyISAM table."><colgroup><col width="20%"><col width="40%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.frm</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义（格式）文件</font></font></td>
          </tr><tr>
            <td scope="row"><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYD</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据文件</font></font></td>
          </tr><tr>
            <td scope="row"><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引文件</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这三种文件类型中的每一种都受到各种方式的破坏，但是在数据文件和索引文件中经常出现问题。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过逐行</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">数据文件</font><font style="vertical-align: inherit;">的副本来工作
        </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它通过删除旧</font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件并将新文件重命名为原始文件名来</font><font style="vertical-align: inherit;">结束修复阶段</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果使用
        </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_quick"><code class="option">--quick</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
        </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会创建临时
        </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，而是会假定该
        </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件是正确的，并且只生成一个新的索引文件而不触及该</font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        文件。</font><font style="vertical-align: inherit;">这是安全的，因为</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> myisamchk会</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        自动检测</font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件是否损坏，如果是，则会中止修复。</font><font style="vertical-align: inherit;">您也可以</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_quick"><code class="option">--quick</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">两次选项
        </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，
        </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会中止某些错误（如重复键错误），而是尝试通过修改</font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">来解决它们</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_quick"><code class="option">--quick</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有当您的可用磁盘空间太少才能执行正常修复时</font><font style="vertical-align: inherit;">，两个</font><font style="vertical-align: inherit;">选项的使用才有用。</font><font style="vertical-align: inherit;">在这种情况下，您至少应该在运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前备份表</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-check"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.2如何检查MyISAM表错误</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528107668512"></a><a class="indexterm" name="idm140528107667056"></a><a class="indexterm" name="idm140528107665568"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要检查</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，请使用以下命令：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk的
            </font></font><em class="replaceable"><code>tbl_name</code></em></strong></span></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这找到了99.99％的所有错误。</font><font style="vertical-align: inherit;">它无法找到的是</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及</font><font style="vertical-align: inherit;">数据文件的</font><font style="vertical-align: inherit;">腐败</font><font style="vertical-align: inherit;">（这非常不寻常）。</font><font style="vertical-align: inherit;">如果你想检查一张表，你通常应该运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不用选项或者使用</font></font><code class="option">-s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（silent）选项。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -m
            </font></font><em class="replaceable"><code>tbl_name</code></em></strong></span></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这找到了99.999％的所有错误。</font><font style="vertical-align: inherit;">它首先检查所有索引条目的错误，然后读取所有行。</font><font style="vertical-align: inherit;">它计算行中所有键值的校验和，并验证校验和与索引树中键的校验和相匹配。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -e
            </font></font><em class="replaceable"><code>tbl_name</code></em></strong></span></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这对所有数据进行了全面彻底的检查（</font></font><code class="option">-e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意思是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展检查</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">它会对每一行的每个键进行检查读取，以确认它们确实指向了正确的行。</font><font style="vertical-align: inherit;">对于有很多索引的大表来说，这可能需要很长时间。</font><font style="vertical-align: inherit;">通常，
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在找到第一个错误后停止。</font><font style="vertical-align: inherit;">如果您想获取更多信息，可以添加</font></font><code class="option">-v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（详细）选项。</font><font style="vertical-align: inherit;">这导致
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续前进，最多发生20次错误。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -e -i
            </font></font><em class="replaceable"><code>tbl_name</code></em></strong></span></a>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这与上一个命令类似，但该
             </font></font><code class="option">-i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项告诉
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印其他统计信息。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在大多数情况下，一个简单的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令不需要表名以外的参数就足以检查一个表。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-repair"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.3如何修复MyISAM表</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528107640096"></a><a class="indexterm" name="idm140528107638640"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节中的讨论描述了如何</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（扩展</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您也可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来检查和修复</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.2节“CHECK TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.5节“REPAIR TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        损坏的表的症状包括异常中止以及可观察错误的查询，例如：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            被锁定以防止改变
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            找不到文件
             </font></font><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （ERRCODE： </font></font><em class="replaceable"><code>nnn</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            意外的文件结束
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            记录文件崩溃
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>nnn</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从表处理程序中
 </font><font style="vertical-align: inherit;">
            得到错误</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要获得有关错误的更多信息，请运行
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#perror" title="4.8.2 perror  - 解释错误代码"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perror</font></font></strong></span></a> <em class="replaceable"><code>nnn</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>nnn</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误编号</font><font style="vertical-align: inherit;">在哪里
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下示例显示如何使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#perror" title="4.8.2 perror  - 解释错误代码"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perror</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来查找指示表存在问题的最常见错误编号的含义：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>perror 126 127 132 134 135 136 141 144 145</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码126 =索引文件崩溃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码127 =记录文件崩溃</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码132 =旧的数据库文件</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码134 =记录已被删除（或记录文件崩溃）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码135 =记录文件没有更多空间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码136 =索引文件没有更多空间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码141 =在写入或更新时重复唯一键或约束</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码144 =表崩溃，上次修复失败</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL错误代码145 =表被标记为崩溃，应该修复</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        请注意，错误135（记录文件中没有更多空间）和错误136（索引文件中没有更多空间）不是可以通过简单修复修复的错误。</font><font style="vertical-align: inherit;">在这种情况下，您必须使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">增加
         </font></font><code class="literal">MAX_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">AVG_ROW_LENGTH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表选项值：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_ROWS = </font></font><em class="replaceable"><code>xxx</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVG_ROW_LENGTH = </font></font><em class="replaceable"><code>yyy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您不知道当前表格选项值，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-create-table" title="13.7.5.10 SHOW CREATE TABLE语法"><code class="literal">SHOW CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于其他错误，您必须修复您的表格。
        </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常可以检测并修复大多数发生的问题。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        修复过程涉及多达四个阶段，如下所述。</font><font style="vertical-align: inherit;">在开始之前，您应该将位置更改为数据库目录并检查表格文件的权限。</font><font style="vertical-align: inherit;">在Unix上，确保它们可以被</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font><font style="vertical-align: inherit;">的用户读取
         </font><font style="vertical-align: inherit;">（并且由于您需要访问正在检查的文件）。</font><font style="vertical-align: inherit;">如果事实证明您需要修改文件，则它们也必须由您写入。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节适用于表检查失败的情况（例如</font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-check" title="7.6.2如何检查MyISAM表错误"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.6.2节“如何检查MyISAM表中是否有错误”中所述的情况</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），或者您想要使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        提供</font><font style="vertical-align: inherit;">的扩展功能</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;">第4.6.3节“ </font></a><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"> -  MyISAM表维护实用程序”</font></a><font style="vertical-align: inherit;">中介绍了用于维护表</font><font style="vertical-align: inherit;">
        的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">。
        </font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><font style="vertical-align: inherit;">还具有可以设置的变量来控制可以提高性能的内存分配。</font><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk-memory" title="4.6.3.6 myisamchk内存使用情况"><font style="vertical-align: inherit;">第4.6.3.6节“myisamchk内存使用情况”</font></a><font style="vertical-align: inherit;">。
      </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"></font><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk-memory" title="4.6.3.6 myisamchk内存使用情况"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您要从命令行修复表，您必须先停止</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器。</font><font style="vertical-align: inherit;">请注意，当您</font><font style="vertical-align: inherit;">在远程服务器上</font><font style="vertical-align: inherit;">执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin shutdown</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，在</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;">mysqladmin</font></strong></span></a><font style="vertical-align: inherit;">返回</font><font style="vertical-align: inherit;">后</font><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器仍可用一段时间</font><font style="vertical-align: inherit;">，直到所有语句处理已停止并且所有索引更改已刷新到磁盘。
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段1：检查你的桌子</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您有更多时间，请</font><font style="vertical-align: inherit;">
        运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk * .MYI</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -e * .MYI</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用
         </font></font><code class="option">-s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（无声）选项来抑制不必要的信息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器已停止，则应使用该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_update-state"><code class="option">--update-state</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项告诉</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将该表标记为
         </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“已</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查”。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您只能修复</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布错误的</font><font style="vertical-align: inherit;">表格
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于这样的表格，进入第2阶段。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果检查时出现意外错误（如</font></font><code class="literal">out
        of memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误），或者</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        崩溃，请转到第3阶段。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二阶段：安全维修简单</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        首先，尝试</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -r -q
        </font></font><em class="replaceable"><code>tbl_name</code></em></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="option">-r
        -q</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意思是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速恢复模式</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这会尝试修复索引文件而不触及数据文件。</font><font style="vertical-align: inherit;">如果数据文件包含它应该包含的所有内容，并且删除链接指向数据文件中的正确位置，则应该可以工作，并且表格已修复。</font><font style="vertical-align: inherit;">开始修复下一张桌子。</font><font style="vertical-align: inherit;">否则，请使用以下步骤：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在继续之前先备份数据文件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -r
            </font></font><em class="replaceable"><code>tbl_name</code></em></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            （</font></font><code class="option">-r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意思是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恢复模式</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这将从数据文件中删除不正确的行和删除的行并重建索引文件。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果上述步骤失败，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --safe-recover
            </font></font><em class="replaceable"><code>tbl_name</code></em></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">安全恢复模式使用旧的恢复方法来处理常规恢复模式不支持的一些情况（但速度较慢）。
</font></font></p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你想有一个修复操作去得更快，你应该设置的值
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时，每一个变量到您的可用内存的大约25％
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果修复时出现意外错误（例如
         </font></font><code class="literal">out of memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误），或者
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">崩溃，请转到第3阶段。
      </font></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段3：难以修复</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有索引文件中的第一个16KB块被销毁或包含不正确的信息，或索引文件丢失时，才应该到达此阶段。</font><font style="vertical-align: inherit;">在这种情况下，有必要创建一个新的索引文件。</font><font style="vertical-align: inherit;">这样做如下：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将数据文件移到安全的地方。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用表格描述文件来创建新的（空的）数据和索引文件：
          </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>mysql <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>SET autocommit=1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>TRUNCATE TABLE <em class="replaceable"><code>tbl_name</code></em>;</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>quit</code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将旧数据文件复制回新创建的数据文件。</font><font style="vertical-align: inherit;">（不要将旧文件移回到新文件中，如果出现问题，您需要保留副本。）
</font></font></p></li></ol>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您正在使用复制，则应在执行上述过程之前停止它，因为它涉及文件系统操作，并且这些操作不会被MySQL记录。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        回到第二阶段</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。myisamchk -r -q</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该可以工作。</font><font style="vertical-align: inherit;">（这不应该是一个无限循环。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您也可以使用</font><font style="vertical-align: inherit;">自动执行整个过程</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">SQL语句。</font><font style="vertical-align: inherit;">在实用程序和服务器之间也不可能发生不必要的交互，因为服务器在您使用时会执行所有工作</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><font style="vertical-align: inherit;">第13.7.2.5节“REPAIR TABLE语法”</font></a><font style="vertical-align: inherit;">。
      </font></font><code class="literal">REPAIR TABLE
        <em class="replaceable"><code>tbl_name</code></em> USE_FRM</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段4：非常困难的修复</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有在</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述文件也崩溃的情况下，</font><font style="vertical-align: inherit;">才应该到达这个阶段
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这绝不应该发生，因为描述文件在创建表后不会更改：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            从备份恢复描述文件并返回到阶段3.您还可以恢复索引文件并返回到阶段2.在后一种情况下，您应该以</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -r</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开头
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您没有备份但确切知道表的创建方式，请在另一个数据库中创建该表的副本。</font><font style="vertical-align: inherit;">删除新的数据文件，然后将
             </font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述和
             </font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引文件从其他数据库移动到崩溃的数据库。</font><font style="vertical-align: inherit;">这为您提供了新的描述和索引文件，但保留了
             </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据文件。</font><font style="vertical-align: inherit;">返回到第2阶段并尝试重建索引文件。
</font></font></p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.4 MyISAM表优化</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528107531152"></a><a class="indexterm" name="idm140528107529696"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要合并碎片行并消除删除或更新行所导致的浪费空间，请</font><font style="vertical-align: inherit;">在恢复模式下</font><font style="vertical-align: inherit;">运行
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>myisamchk -r <em class="replaceable"><code>tbl_name</code></em></code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语句</font><font style="vertical-align: inherit;">以相同的方式优化表
         </font><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行表修复和关键分析，并对索引树进行排序，以便快速查找关键字。</font><font style="vertical-align: inherit;">在实用程序和服务器之间也不可能发生不必要的交互，因为服务器在您使用时会执行所有工作</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.4节“OPTIMIZE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有许多其他选项可用于提高表的性能：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_analyze"><code class="option">--analyze</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
             </font></font><code class="option">-a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：执行密钥分发分析。</font><font style="vertical-align: inherit;">这可以通过使联接优化器更好地选择联接表的顺序以及应该使用的索引来提高联接性能。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_sort-index"><code class="option">--sort-index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
             </font></font><code class="option">-S</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：对索引块进行排序。</font><font style="vertical-align: inherit;">这优化了查找并使表索引更快地使用索引。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_sort-records"><code class="option">--sort-records=<em class="replaceable"><code>index_num</code></em></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或者</font><font style="vertical-align: inherit;">：根据给定的索引对数据行进行排序。</font><font style="vertical-align: inherit;">这使你的数据更局部化并且可以加快基于范围的
             </font><font style="vertical-align: inherit;">，并</font><font style="vertical-align: inherit;">使用该索引操作。
</font></font><code class="option">-R <em class="replaceable"><code>index_num</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"></font><code class="literal">ORDER
            BY</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关所有可用选项的完整说明，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.3节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -  MyISAM表维护实用程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-maintenance-schedule"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6.5设置MyISAM表维护计划</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528107505280"></a><a class="indexterm" name="idm140528107503792"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        定期执行表格检查是一个好主意，而不是等待问题发生。</font><font style="vertical-align: inherit;">检查和修复</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">一种方法</font><font style="vertical-align: inherit;">是使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#table-maintenance-sql" title="13.7.2表维护陈述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2节“表维护语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        检查表的另一种方法是使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">出于维护目的，您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -s</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><code class="option">-s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项（简称</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_myisamchk_silent"><code class="option">--silent</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）使</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以静默模式运行，仅在发生错误时才打印消息。
      </font></font></p><a class="indexterm" name="idm140528107492272"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        启用自动</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格检查</font><font style="vertical-align: inherit;">也是一个好主意
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，无论何时机器在更新过程中完成重新启动，通常都需要检查每个可能受到影响的表，然后再进一步使用它。</font><font style="vertical-align: inherit;">（这些都是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预计坠毁表</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），使服务器检查
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动表，与启动</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-options" title="5.1.4服务器命令选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.4节“服务器命令选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您应该在系统正常运行期间定期检查您的表格。</font><font style="vertical-align: inherit;">例如，您可以运行一个</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cron</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        作业来每周检查一次重要的表格，在</font></font><code class="filename">crontab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用这样的一行</font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="simple" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35 0 * * 0  - </font></font><em class="replaceable"><code>/path/to/myisamchk</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast --silent </font></font><em class="replaceable"><code>/path/to/datadir</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/*/*.MYI
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这会打印出有关坠毁表的信息，以便您可以根据需要检查和修复它们。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        首先，</font><font style="vertical-align: inherit;">在过去24小时内更新的所有表上</font><font style="vertical-align: inherit;">执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -s</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">正如你所看到的那样，问题很少发生，你可以将检查频率恢复到每周一次左右。
      </font></font></p><a class="indexterm" name="idm140528107480608"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通常，MySQL表需要很少的维护。</font><font style="vertical-align: inherit;">如果要对</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有动态大小的行（具有</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的表）的</font><font style="vertical-align: inherit;">表
         </font><font style="vertical-align: inherit;">执行许多更新</font><font style="vertical-align: inherit;">，或者
         </font><font style="vertical-align: inherit;">具有许多删除行的表，则可能需要不时从表中整理/回收空间。</font><font style="vertical-align: inherit;">您可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在相关表格上</font><font style="vertical-align: inherit;">使用
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，如果您可以暂停
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器一段时间，请将位置更改为数据目录，并在服务器停止时使用此命令：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>myisamchk -r -s --sort-index --myisam_sort_buffer_size=16M */*.MYI</code></strong>
</pre>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tbody><tr>
<td width="40%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/security.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a></td>
<td width="20%" align="center"><a accesskey="u" href="/mysql-5.7-google-zh/backup-and-recovery.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向上</font></font></a></td>
<td width="40%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/optimization.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章安全</font></font></td>
<td width="20%" align="center"><a accesskey="h" href="/mysql-5.7-google-zh/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家</font></font></a></td>
<td width="40%" align="right" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8章优化</font></font></td>
</tr>
</tbody></table>
</div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./images/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>