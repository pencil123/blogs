<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>第8章优化</title>
<link rel="stylesheet" href="./images/mvl.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
<link rel="start" href="/mysql-5.7-google-zh/index.html" title="{书名}">
<link rel="up" href="/mysql-5.7-google-zh/optimization.html" title="">
<link rel="prev" href="/mysql-5.7-google-zh/backup-and-recovery.html" title="第7章备份和恢复">
<link rel="next" href="/mysql-5.7-google-zh/language-structure.html" title="第9章语言结构">
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./images/translateelement.css"></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tbody><tr>
<th colspan="3" align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8章优化</font></font></th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/backup-and-recovery.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a>&nbsp;</td>
<th width="60%" align="center"></th>
<td width="20%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/language-structure.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
</tbody></table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8章优化</font></font></h1>

</div>

</div>

</div>
<div class="toc">
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></b></p><dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-overview"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1优化概述</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#statement-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2优化SQL语句</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#select-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1优化SELECT语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#subquery-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2优化子查询，派生表和视图引用</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#information-schema-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.3优化INFORMATION_SCHEMA查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#data-change-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4优化数据更改语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#permission-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.5优化数据库权限</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#miscellaneous-optimization-tips"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.6其他优化技巧</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimization-indexes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3优化和索引</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#mysql-indexes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.1 MySQL如何使用索引</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#primary-key-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.2主键优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#foreign-key-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.3外键优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#column-indexes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.4列索引</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#multiple-column-indexes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.5多列索引</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#verifying-index-usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.6检验索引使用情况</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-statistics"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.7 InnoDB和MyISAM指数统计收集</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-btree-hash"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.8 B树和散列索引的比较</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-extensions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.9使用索引扩展</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#generated-column-index-optimizations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.10优化器使用生成的列索引</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-database-structure"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4优化数据库结构</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#data-size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.1优化数据大小</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-data-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2优化MySQL数据类型</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-multi-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.3优化许多表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#internal-temporary-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.4在MySQL中使用内部临时表</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5优化InnoDB表</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-storage-layout"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.1优化InnoDB表的存储布局</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-transaction-management"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.2优化InnoDB事务管理</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#innodb-performance-ro-txn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.3优化InnoDB只读事务</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-logging"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.4优化InnoDB重做日志</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-bulk-data-loading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.5 InnoDB表的批量数据加载</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-queries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.6优化InnoDB查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-ddl-operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.7优化InnoDB DDL操作</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-diskio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.8优化InnoDB磁盘I / O</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-configuration-variables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.9优化InnoDB配置变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-many-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.10为具有多个表的系统优化InnoDB</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-myisam"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6优化MyISAM表</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-queries-myisam"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.1优化MyISAM查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-myisam-bulk-data-loading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.2 MyISAM表的批量数据加载</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#repair-table-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.3优化REPAIR TABLE语句</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-memory-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.7优化MEMORY表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#execution-plan-information"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8了解查询执行计划</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#using-explain"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.1使用EXPLAIN优化查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#explain-output"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.2 EXPLAIN输出格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#explain-extended"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.3扩展的EXPLAIN输出格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#explain-for-connection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.4获取命名连接的执行计划信息</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#estimating-performance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.5估计查询性能</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#controlling-optimizer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9控制查询优化器</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#controlling-query-plan-evaluation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.1控制查询计划评估</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizer-hints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.2优化器提示</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.3可切换优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-hints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.4索引提示</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#cost-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.5优化器成本模型</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#buffering-caching"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10缓冲和高速缓存</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#innodb-buffer-pool-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.1 InnoDB缓冲池优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#myisam-key-cache"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2 MyISAM密钥缓存</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#query-cache"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3 MySQL查询缓存</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#statement-caching"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.4缓存准备好的语句和存储的程序</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#locking-issues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11优化锁定操作</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#internal-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.1内部锁定方法</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#table-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.2表锁定问题</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#concurrent-inserts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.3并发插入</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#metadata-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.4元数据锁定</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#external-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.5外部锁定</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-server"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12优化MySQL服务器</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#system-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.1系统因素</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#disk-issues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.2优化磁盘I / O</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#symbolic-links"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3使用符号链接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-memory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.4优化内存使用</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-network"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.5优化网络使用</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-benchmarking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13衡量绩效（标杆管理）</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#select-benchmarking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.1测量表达式和函数的速度</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#custom-benchmarks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.2使用你自己的基准</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#monitoring-performance-schema"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.3使用performance_schema测量绩效</font></font></a></span></dt></dl></dd><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#thread-information"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14检查线程信息</font></font></a></span></dt><dd><dl><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#thread-commands"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.1线程命令值</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#general-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.2一般线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#query-cache-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.3查询缓存线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#master-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.4复制主线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#slave-io-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.5复制从属I / O线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#slave-sql-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.6复制从SQL SQL线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#slave-connection-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.7复制从属连接线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#mysql-cluster-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.8 NDB集群线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#event-scheduler-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.9事件调度程序线程状态</font></font></a></span></dt></dl></dd></dl>
</div>
<a class="indexterm" name="idm140528107468128"></a><a class="indexterm" name="idm140528107467056"></a><a class="indexterm" name="idm140528107465984"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本章介绍如何优化MySQL性能并提供示例。</font><font style="vertical-align: inherit;">优化涉及在多个级别配置，调整和衡量性能。</font><font style="vertical-align: inherit;">根据您的工作角色（开发人员，DBA或两者的组合），您可以在单个SQL语句，整个应用程序，单个数据库服务器或多个联网数据库服务器的级别进行优化。</font><font style="vertical-align: inherit;">有时，您可以提前预测性能，而有时您可能会在问题发生后解决配置或代码问题。</font><font style="vertical-align: inherit;">优化CPU和内存使用率还可以提高可伸缩性，使数据库可以处理更多的负载而不会减慢速度。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimize-overview"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1优化概述</font></font></h2>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      数据库性能取决于数据库级别的几个因素，如表，查询和配置设置。</font><font style="vertical-align: inherit;">这些软件结构在硬件级别上产生CPU和I / O操作，您必须尽可能降低和尽可能提高效率。</font><font style="vertical-align: inherit;">在您处理数据库性能时，您首先要学习软件方面的高级规则和准则，并使用挂钟时间来衡量性能。</font><font style="vertical-align: inherit;">随着您成为专家，您将更多地了解内部发生的情况，并开始测量诸如CPU周期和I / O操作等事情。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      典型的用户旨在从现有的软件和硬件配置中获得最佳的数据库性能。</font><font style="vertical-align: inherit;">高级用户寻找改进MySQL软件本身的机会，或者开发自己的存储引擎和硬件设备来扩展MySQL生态系统。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimize-database-level" title="在数据库级别进行优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据库级别进行优化</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimize-hardware-level" title="在硬件级别进行优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在硬件级别进行优化</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimize-portability-performance" title="平衡可移植性和性能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平衡可移植性和性能</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h3 class="title"><a name="optimize-database-level"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据库级别进行优化</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使数据库应用程序快速化的最重要因素是其基本设计：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表格结构是否正确？</font><font style="vertical-align: inherit;">特别是，列是否具有正确的数据类型，每个表是否都有适合于工作类型的列？</font><font style="vertical-align: inherit;">例如，执行频繁更新的应用程序通常具有许多列，列数很少，而分析大量数据的应用程序通常只有很少的列具有多个列。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            是否有正确的
             </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimization-indexes" title="8.3优化和索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来提高查询的效率？
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您是否为每个表使用适当的存储引擎，并利用您使用的每个存储引擎的优势和特性？</font><font style="vertical-align: inherit;">特别是，诸如事务性存储引擎</font></font><code class="literal"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">InnoDB</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或非
             </font><font style="vertical-align: inherit;">事务性存储引擎的选择
             </font></font><code class="literal"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizing-myisam" title="8.6 Optimizing for MyISAM Tables">MyISAM</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对性能和可伸缩性非常重要。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
              <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是新表的默认存储引擎。</font><font style="vertical-align: inherit;">实际上，高级
               </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能特征意味着
               </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格通常优于简单</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，特别是对于繁忙的数据库。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            每个表格是否使用适当的行格式？</font><font style="vertical-align: inherit;">这个选择还取决于用于表格的存储引擎。</font><font style="vertical-align: inherit;">特别是，压缩表使用较少的磁盘空间，因此需要较少的磁盘I / O来读取和写入数据。</font><font style="vertical-align: inherit;">压缩适用于各种</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格和只读表格
             </font><font style="vertical-align: inherit;">的工作负载
             </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            应用程序是否使用适当的
             </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#locking-issues" title="8.11优化锁定操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定策略</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">例如，在可能的情况下允许共享访问，以便数据库操作可以并发运行，并在适当时请求独占访问，从而使关键操作成为最高优先级。</font><font style="vertical-align: inherit;">同样，存储引擎的选择也很重要。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎处理大部分锁定的问题，而不需要您的参与，允许在数据库更好的并发，减少试验和调整的金额，让您的代码。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#buffering-caching" title="8.10缓冲和高速缓存"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于缓存</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小的</font><font style="vertical-align: inherit;">
            所有</font><a class="link" href="/mysql-5.7-google-zh/optimization.html#buffering-caching" title="8.10 Buffering and Caching"><font style="vertical-align: inherit;">内存区域的</font></a><font style="vertical-align: inherit;">大小是否正确？</font><font style="vertical-align: inherit;">也就是说，足够大以容纳经常访问的数据，但不会太大以至于超载物理内存并导致分页。</font><font style="vertical-align: inherit;">要配置的主要内存区域是</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池，</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥缓存和MySQL查询缓存。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="optimize-hardware-level"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在硬件级别进行优化</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        随着数据库变得越来越繁忙，任何数据库应用程序最终都会遇到硬件限制。</font><font style="vertical-align: inherit;">DBA必须评估是否可以调整应用程序或重新配置服务器以避免这些
         </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_bottleneck" title="瓶颈"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">瓶颈</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者是否需要更多硬件资源。</font><font style="vertical-align: inherit;">系统瓶颈通常来自这些来源：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            磁盘寻求。</font><font style="vertical-align: inherit;">磁盘需要一段时间才能找到一段数据。</font><font style="vertical-align: inherit;">使用现代磁盘时，平均时间通常低于10毫秒，因此我们理论上可以做到大约100秒。</font><font style="vertical-align: inherit;">这次用新磁盘缓慢地改进，并且很难针对单个表进行优化。</font><font style="vertical-align: inherit;">优化查找时间的方法是将数据分配到多个磁盘上。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            磁盘读取和写入。</font><font style="vertical-align: inherit;">当磁盘位于正确的位置时，我们需要读取或写入数据。</font><font style="vertical-align: inherit;">使用现代磁盘，一个磁盘的吞吐量至少可达10-20MB / s。</font><font style="vertical-align: inherit;">这比寻求更容易优化，因为您可以从多个磁盘并行读取。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            CPU周期。</font><font style="vertical-align: inherit;">当数据在主内存中时，我们必须对其进行处理以得到我们的结果。</font><font style="vertical-align: inherit;">与内存数量相比，大表格是最常见的限制因素。</font><font style="vertical-align: inherit;">但对于小桌子，速度通常不是问题。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            内存带宽。</font><font style="vertical-align: inherit;">当CPU需要的数据量超过CPU缓存容量时，主内存带宽就成为瓶颈。</font><font style="vertical-align: inherit;">对大多数系统来说，这是一个罕见的瓶颈，但需要注意的一个瓶颈。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="optimize-portability-performance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平衡可移植性和性能</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528107426016"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在便携式MySQL程序中使用面向性能的SQL扩展，可以将MySQL特定的关键字包装在</font></font><code class="literal">/*! */</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释分隔符</font><font style="vertical-align: inherit;">中的语句中</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">其他SQL服务器会忽略注释的关键字。</font><font style="vertical-align: inherit;">有关编写注释的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#comments" title="9.6注释语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.6节“注释语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="statement-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2优化SQL语句</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#select-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1优化SELECT语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#subquery-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2优化子查询，派生表和视图引用</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#information-schema-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.3优化INFORMATION_SCHEMA查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#data-change-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4优化数据更改语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#permission-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.5优化数据库权限</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#miscellaneous-optimization-tips"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.6其他优化技巧</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528107421424"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      数据库应用程序的核心逻辑是通过SQL语句执行的，无论是直接通过解释器发布还是通过API在幕后提交。</font><font style="vertical-align: inherit;">本节中的调整准则有助于加速各种MySQL应用程序。</font><font style="vertical-align: inherit;">这些指导原则涵盖了读取和写入数据的SQL操作，SQL操作的幕后开销以及特定场景（如数据库监控）中使用的操作。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="select-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1优化SELECT语句</font></font></h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#where-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.1 WHERE子句优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#range-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.2范围优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-merge-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.3索引合并优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#condition-pushdown-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.4引擎状况下推优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-condition-pushdown-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.5索引条件下推优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#nested-loop-joins"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.6嵌套循环连接算法</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#nested-join-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.7嵌套连接优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#left-join-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.8左连接和右连接优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#outer-join-simplification"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.9外连接简化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#mrr-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.10多范围读取优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#bnl-bka-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.11块嵌套循环和批处理键访问联接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#is-null-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.12 IS NULL优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#order-by-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.13 ORDER BY优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#group-by-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.14 GROUP BY优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#distinct-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.15 DISTINCT优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#limit-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.16限制查询优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#function-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.17函数调用优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#row-constructor-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.18行构造器表达式优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#table-scan-avoidance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.19避免全表扫描</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528107417920"></a><a class="indexterm" name="idm140528107416464"></a><a class="indexterm" name="idm140528107414976"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句</font><font style="vertical-align: inherit;">的形式</font><font style="vertical-align: inherit;">执行数据库中的所有查找操作。</font><font style="vertical-align: inherit;">调整这些语句是首要任务，无论是实现动态网页的亚秒响应时间还是缩短产生大量隔夜报告的时间。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此外</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，进行查询调谐技术也适用于结构，如
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table-select" title="13.1.18.5 CREATE TABLE ... SELECT语法"><code class="literal">CREATE
        TABLE...AS SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT
        INTO...SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在条款
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的语句。</font><font style="vertical-align: inherit;">这些语句具有额外的性能考虑，因为它们将写操作与面向读取的查询操作结合在一起。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        NDB集群支持联合下推优化，从而将合格联接全部发送到NDB集群数据节点，并在其中分布并可并行执行。</font><font style="vertical-align: inherit;">有关此优化的更多信息，请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/mysql-cluster.html#ndb_join_pushdown-conditions" title="NDB下推连接的条件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NDB下推联结的条件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化查询的主要考虑因素是：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了</font></font><code class="literal">SELECT ... WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加快查询速度，首先要检查的是您是否可以添加
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_index" title="指数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">使用的列上设置索引</font><font style="vertical-align: inherit;">，以加速评估，筛选和最终检索结果。</font><font style="vertical-align: inherit;">为了避免浪费磁盘空间，构建一组索引，以加快应用程序中使用的许多相关查询。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于引用不同表的查询，索引尤其重要，可以使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_join" title="加入"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_foreign_key" title="外键"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外键等功能</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来确定哪些索引用于a
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#mysql-indexes" title="8.3.1 MySQL如何使用索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.3.1节“MySQL如何使用索引”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            隔离并调整查询的任何部分，例如函数调用，这会花费过多的时间。</font><font style="vertical-align: inherit;">根据查询结构的不同，可以为结果集中的每一行调用一次函数，或者为表中的每一行调用一次函数，从而大大放大任何低效率。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            尽量减少</font><font style="vertical-align: inherit;">
            查询</font><font style="vertical-align: inherit;">中</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_full_table_scan" title="全表扫描"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全表扫描</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的次数
             </font><font style="vertical-align: inherit;">，特别是对于大表格。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">来保持表的统计数据是最新的
             </font><font style="vertical-align: inherit;">，所以优化器具有构建高效执行计划所需的信息。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            了解特定于每个表的存储引擎的调整技术，索引技术和配置参数。</font><font style="vertical-align: inherit;">双方</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
             </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有两套准则的实现和维持查询高性能。</font><font style="vertical-align: inherit;">有关详细信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-queries" title="8.5.6优化InnoDB查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.5.6节“优化InnoDB查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizing-queries-myisam" title="8.6.1优化MyISAM查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.6.1节“优化MyISAM查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.5.3节“优化InnoDB只读事务”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的技术</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务"><font style="vertical-align: inherit;">优化</font></a><font style="vertical-align: inherit;">表的
             </font><font style="vertical-align: inherit;">单一查询事务
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            避免以难以理解的方式转换查询，特别是如果优化器自动执行一些相同的转换。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果性能问题不能通过基本准则之一轻易解决，请通过阅读</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划并调整索引，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，连接子句等来</font><font style="vertical-align: inherit;">调查特定查询的内部详细信息
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（当您达到一定的专业水平时，阅读
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划可能是您每次查询的第一步。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            调整MySQL用于缓存的内存区域的大小和属性。</font><font style="vertical-align: inherit;">通过高效地使用
             </font></font><code class="literal">InnoDB</code>
            <a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_buffer_pool" title="缓冲池"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥缓存和MySQL查询缓存，重复查询运行速度更快，因为第二次和随后都会从内存中检索结果。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            即使对于使用高速缓存区快速运行的查询，您仍可能进一步优化，以便它们需要更少的高速缓存内存，从而使您的应用程序更具可扩展性。</font><font style="vertical-align: inherit;">可伸缩性意味着您的应用程序可以同时处理更多的用户，更大的请求等等，而不会出现性能大幅下降的情况。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            处理锁定问题，其中查询速度可能会受到其他会话同时访问表的影响。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="where-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.1 WHERE子句优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528107368320"></a><a class="indexterm" name="idm140528107367280"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节讨论可以处理</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的</font><font style="vertical-align: inherit;">优化</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些示例使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，但是相同的优化适用于</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于MySQL优化器的工作正在进行，因此并不是MySQL执行的所有优化都记录在此处。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可能会试图重写您的查询以加快算术运算速度，同时牺牲可读性。</font><font style="vertical-align: inherit;">因为MySQL会自动执行类似的优化，所以通常可以避免这种工作，并且使查询更易于理解和维护。</font><font style="vertical-align: inherit;">MySQL执行的一些优化如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              删除不必要的括号：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   （（a AND b）和c OR（（（a AND b）AND（c AND d））））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- &gt;（a和b和c）或（a和b和c和d）</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              持续折叠：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   （a &lt;b AND b = c）AND a = 5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- &gt; b&gt; 5 AND b = c AND a = 5</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              恒定的条件去除（由于不断的折叠需要）：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   （B = 5 AND B = 5）OR（B = 6 AND 5 = 5）OR（B = 7 AND 5 = 6）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- &gt; B = 5或B = 6</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由索引使用的常量表达式仅评估一次。
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_count"><code class="literal">COUNT(*)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在没有a的单个表上</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接从表信息</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">检索</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于</font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅与一个表一起使用的</font><font style="vertical-align: inherit;">任何</font><font style="vertical-align: inherit;">表达式，</font><font style="vertical-align: inherit;">这也是完成的</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              及早检测无效的常量表达式。</font><font style="vertical-align: inherit;">MySQL快速检测到某些
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句是不可能的并且不返回任何行。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">HAVING</code><font style="vertical-align: inherit;"></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您不使用</font></font><code class="literal">GROUP
              BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或聚合函数（</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_count"><code class="literal">COUNT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等），</font><font style="vertical-align: inherit;">则合并
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于连接中的每个表，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造</font><font style="vertical-align: inherit;">一个更简单
               </font><font style="vertical-align: inherit;">的表达式以快速
               </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估表，并尽快跳过行。
            </font></font></p></li><li class="listitem"><p>
              <a class="indexterm" name="idm140528107336016"></a>

              <a class="indexterm" name="idm140528107334944"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

              在查询中的任何其他表之前首先读取所有常量表。</font><font style="vertical-align: inherit;">常数表是以下任何一项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  一张空的桌子或一排有一排的桌子。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  与a </font><font style="vertical-align: inherit;">或
                   </font><font style="vertical-align: inherit;">索引</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句一起</font><font style="vertical-align: inherit;">使用的表</font><font style="vertical-align: inherit;">，其中所有索引部分与常量表达式进行比较并定义为</font><font style="vertical-align: inherit;">。
</font></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              以下所有表格均用作常量表格：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t WHERE </font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1。</font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1和t2。</font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= t1.id;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过尝试所有可能性来找到加入表格的最佳联合组合。</font><font style="vertical-align: inherit;">如果所有列
               </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">GROUP
              BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句来自同一个表，那么在加入时首先选择该表。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果有一个</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句和一个不同的</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，或者如果
               </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              包含除联接队列中第一个表以外的表的列，则会创建一个临时表。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果你使用</font></font><code class="literal">SQL_SMALL_RESULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              修饰符，MySQL使用内存中的临时表。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              查询每个表索引，并使用最佳索引，除非优化器认为使用表扫描更高效。</font><font style="vertical-align: inherit;">有一次，根据最佳索引是否超过表格的30％来使用扫描，但固定百分比不再决定使用索引或扫描之间的选择。</font><font style="vertical-align: inherit;">优化器现在更加复杂，并将其估计基于其他因素，如表大小，行数和I / O块大小。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在某些情况下，MySQL可以从索引中读取行，而无需咨询数据文件。</font><font style="vertical-align: inherit;">如果索引中使用的所有列都是数字，则仅使用索引树来解析查询。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在输出每行之前，不匹配
               </font></font><code class="literal">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的内容将被跳过。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一些非常快速的查询示例：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT MIN（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），MAX（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT MAX（</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... LIMIT 10;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，... LIMIT 10;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设索引列是数字型的，MySQL仅使用索引树来解析以下查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT COUNT（*）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下查询使用索引来按照排序顺序检索行，而无需单独的排序传递：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，...;
</font></font></pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="range-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.2范围优化</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          的</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问方法使用单个索引来检索包含一个或若干个索引值的时间间隔内表行的子集。</font><font style="vertical-align: inherit;">它可以用于单部分索引或多部分索引。</font><font style="vertical-align: inherit;">以下各节将介绍优化程序使用范围访问的条件。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#range-access-single-part" title="单部分索引的范围访问方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单部分索引的范围访问方法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#range-access-multi-part" title="多部分索引的范围访问方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多部分索引的范围访问方法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#equality-range-optimization" title="多值比较的等式范围优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多值比较的等式范围优化</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#range-optimization-memory-use" title="限制内存使用范围优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制内存使用范围优化</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#row-constructor-range-optimization" title="行构造器表达式的范围优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行构造器表达式的范围优化</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="range-access-single-part"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单部分索引的范围访问方法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于单部分索引，索引值间隔可以方便地用条款中的相应条件
             </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示，表示为
             </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围条件</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            而不是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">间隔”。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            单部分索引的范围条件定义如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于这两种</font></font><code class="literal">BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                 </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引，使用时具有恒定值的关键部分的比较是一个范围条件
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal"><code class="literal">=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS NULL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-not-null"><code class="literal">IS NOT NULL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运营商。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                另外，对于</font></font><code class="literal">BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引，使用时具有恒定值的关键部分的比较是一个范围条件
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than"><code class="literal">&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than"><code class="literal">&lt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">!=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                运营商，或者</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                比较，如果该参数
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个常数字符串不与通配符开始。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于所有索引类型，多个范围条件结合</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形成范围条件。
</font></font></p></li></ul>
</div>
<p>
            <span class="quote"><font style="vertical-align: inherit;"></font><span class="quote"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面描述中的</font><span class="quote"><font style="vertical-align: inherit;">“ </font></span><span class="quote"><span class="quote"><font style="vertical-align: inherit;">常数值</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”</font></span><font style="vertical-align: inherit;">表示以下之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                来自查询字符串的常量
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自同一个连接</font><font style="vertical-align: inherit;">
                的a </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                或</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_system"><code class="literal">system</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的
               </font><font style="vertical-align: inherit;">列</font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                不相关子查询的结果
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                任何表达完全由前述类型的子表达式组成
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下是在</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">使用范围条件查询的一些示例</font><font style="vertical-align: inherit;">：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;10;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  OR </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（15,18,20）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'ab％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  或</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'bar'和'foo'之间;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在优化器常量传播阶段，某些非常量值可能会转换为常量。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL试图从</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中为每个可能的索引</font><font style="vertical-align: inherit;">提取范围条件
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在提取过程中，会删除无法用于构建范围条件的条件，将产生重叠范围的条件合并，并删除产生空范围的条件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            请考虑以下语句，其中
             </font></font><code class="literal">key1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是索引列，
             </font></font><code class="literal">nonkey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且未编入索引：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （key1 &lt;'abc'AND（key1 LIKE'abcde％'或key1 LIKE'％b'））或者</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （key1 &lt;'bar'AND nonkey = 4）或者</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （key1 &lt;'uux'AND key1&gt;'z'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            密钥的提取过程</font></font><code class="literal">key1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                从原始</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款</font><font style="vertical-align: inherit;">开始</font><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'abc'AND（key1 LIKE'abcde％'或key1 LIKE'％b'））或者</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（key1 &lt;'bar'AND nonkey = 4）或者</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（key1 &lt;'uux'AND key1&gt;'z'）</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                删除</font></font><code class="literal">nonkey = 4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">key1
                LIKE '%b'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它们不能用于范围扫描。</font><font style="vertical-align: inherit;">删除它们的正确方法是用它们替换</font></font><code class="literal">TRUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以便在进行范围扫描时不会错过任何匹配的行。</font><font style="vertical-align: inherit;">用</font></font><code class="literal">TRUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产量</font><font style="vertical-align: inherit;">代替它们</font><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'abc'AND（key1 LIKE'abcde％'OR TRUE））OR</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（key1 &lt;'bar'AND TRUE）或</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（key1 &lt;'uux'AND key1&gt;'z'）</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                折叠条件始终为真或假：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <code class="literal">(key1 LIKE 'abcde%' OR TRUE)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 永远是真的
                  </font></font></p></li><li class="listitem"><p>
                    <code class="literal">(key1 &lt; 'uux' AND key1 &gt;
                    'z')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 总是假的
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                用常数代替这些条件产生：
              </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'abc'AND TRUE）OR（key1 &lt;'bar'AND TRUE）OR（FALSE）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                删除不必要的</font></font><code class="literal">TRUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                 </font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常量会产生：
              </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'abc'）OR（key1 &lt;'bar'）
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                将重叠的时间间隔合并为一个得出用于范围扫描的最终条件：
              </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'bar'）
</font></font></pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一般来说（和前面的例子一样），用于范围扫描的条件比</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款</font><font style="vertical-align: inherit;">限制性更小</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">MySQL执行额外的检查来筛选满足范围条件但不满足全部</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款的行。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            范围条件提取算法可以处理</font><font style="vertical-align: inherit;">
            任意深度的</font><font style="vertical-align: inherit;">嵌套
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造，其输出不依赖条件中出现条件的顺序
             </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL不支持</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空间索引</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">访问方法</font><font style="vertical-align: inherit;">合并多个范围
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要解决这个限制，</font><font style="vertical-align: inherit;">除了将每个空间谓词放在不同的位置之外</font><font style="vertical-align: inherit;">，您可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同的
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="range-access-multi-part"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多部分索引的范围访问方法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            多部分索引的范围条件是单部分索引的范围条件的扩展。</font><font style="vertical-align: inherit;">多部分索引的范围条件将索引行限制在一个或多个关键元组间隔内。</font><font style="vertical-align: inherit;">关键元组间隔定义在一组关键元组上，使用索引中的排序。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例如，考虑将多部分索引定义为
             </font><font style="vertical-align: inherit;">以及按键顺序列出的以下关键元组集合：
          </font></font><code class="literal">key1(<em class="replaceable"><code>key_part1</code></em>,
            <em class="replaceable"><code>key_part2</code></em>,
            <em class="replaceable"><code>key_part3</code></em>)</code><font style="vertical-align: inherit;"></font></p><pre data-lang="clike" class="programlisting"><em class="replaceable"><code>key_part1</code></em>  <em class="replaceable"><code>key_part2</code></em>  <em class="replaceable"><code>key_part3</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  NULL 1'abc'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  NULL 1'xyz'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  NULL 2'foo'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   1 1'abc'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   1 1'xyz'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   1 2'abc'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   2 1'aaa'</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            条件</font></font><code class="literal"><em class="replaceable"><code>key_part1</code></em>
            = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义了这个时间间隔：
          </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1，-INF，-INF）&lt;=（ ，</font><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> </font><font style="vertical-align: inherit;">）&lt;（1，+ INF，+ INF）
</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该区间覆盖了前述数据集中的第4,5和6个元组，并且可以由范围访问方法使用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            相反，该条件
             </font></font><code class="literal"><em class="replaceable"><code>key_part3</code></em> =
            'abc'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有定义单个时间间隔，并且不能被范围访问方法使用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下描述更详细地指出了范围条件如何适用于多部分索引。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引，可以使用包含相同值的每个区间。</font><font style="vertical-align: inherit;">这意味着间隔只能在以下形式的条件下生成：
              </font></font></p><pre data-lang="sql" class="programlisting">    <em class="replaceable"><code>key_part1</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和 </font></font><em class="replaceable"><code>key_part2</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>const2</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND </font><font style="vertical-align: inherit;">;
</font></font><em class="replaceable"><code>key_partN</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>constN</code></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这里</font></font><em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><em class="replaceable"><code>const2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...是常数，</font></font><em class="replaceable"><code>cmp</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal"><code class="literal">=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS NULL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比较运营商，以及条件覆盖所有指数部分。</font><font style="vertical-align: inherit;">（也就是说，</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                有条件，每个部分对应一个部分
                 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引。）例如，以下是三部分</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">的范围条件
                 </font><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是NULL AND </font></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='foo'
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                有关被认为是常量的定义，请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#range-access-single-part" title="单部分索引的范围访问方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单部分索引的范围访问方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于一个</font></font><code class="literal">BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引，以一定间隔可能是条件组合可用
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中每个条件使用的恒定值的关键部分进行比较
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal"><code class="literal">=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS NULL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than"><code class="literal">&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than"><code class="literal">&lt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">!=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
                 </font><font style="vertical-align: inherit;">（其中
                </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE
                '<em class="replaceable"><code>pattern</code></em>'</code></a><font style="vertical-align: inherit;"></font><code class="literal">'<em class="replaceable"><code>pattern</code></em>'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                不以通配符开头）。</font><font style="vertical-align: inherit;">只要可以确定包含与条件匹配的所有行的单个关键元组（或者</font><font style="vertical-align: inherit;">
                使用</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                或</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">!=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">两个间隔），就</font><font style="vertical-align: inherit;">可以使用</font><font style="vertical-align: inherit;">间隔
                 </font><font style="vertical-align: inherit;">。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                只要比较运算符是</font><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal"><code class="literal">=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则
                 </font><font style="vertical-align: inherit;">优化器会尝试使用其他关键部分来确定间隔
                 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果操作是
                 </font><font style="vertical-align: inherit;">，
                 </font><font style="vertical-align: inherit;">，
                 </font><font style="vertical-align: inherit;">，
                 </font><font style="vertical-align: inherit;">，
                 </font><font style="vertical-align: inherit;">，
                 </font><font style="vertical-align: inherit;">，
                 </font><font style="vertical-align: inherit;">，或者
                 </font><font style="vertical-align: inherit;">，优化器使用它，但认为没有更多的关键部分。</font><font style="vertical-align: inherit;">对于以下表达式，优化器使用
                 </font><font style="vertical-align: inherit;">第一个比较。</font><font style="vertical-align: inherit;">它也使用
                </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS NULL</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than"><code class="literal">&gt;</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than"><code class="literal">&lt;</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">!=</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal"><code class="literal">=</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                从第二次比较，但没有考虑进一步的关键部分，并没有使用第三次比较进行区间构造：
              </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='foo'AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; = 10 AND </font></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 10
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                单个时间间隔是：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ '富'，10，-INF）&lt;（ ，</font><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> </font><font style="vertical-align: inherit;">）&lt;（ '富'，+ INF，+ INF）
</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                创建的区间可能包含比初始条件更多的行。</font><font style="vertical-align: inherit;">例如，前面的间隔包括</font></font><code class="literal">('foo',
                11, 0)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不满足原始条件的值。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果组合包含在时间间隔内的行集合的条件与</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们</font><font style="vertical-align: inherit;">组合
                 </font><font style="vertical-align: inherit;">，则它们形成一个条件，该条件涵盖包含在它们间隔的并集中的一组行。</font><font style="vertical-align: inherit;">如果条件与</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们</font><font style="vertical-align: inherit;">结合
                 </font><font style="vertical-align: inherit;">，它们形成一个条件，它涵盖了包含在它们的区间交集内的一组行。</font><font style="vertical-align: inherit;">例如，对于两部分索引中的这种情况：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;2）或（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 5）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                间隔是：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1，-inf）&lt;（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）&lt;（1,2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（5，-inf）&lt;（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在此示例中，第一行的间隔对左边界使用一个关键部分，右边界使用两个关键部分。</font><font style="vertical-align: inherit;">第二行的间隔只使用一个关键部分。</font><font style="vertical-align: inherit;">输出中</font><font style="vertical-align: inherit;">的</font></font><code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示所用密钥前缀的最大长度。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在某些情况下，</font></font><code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能表明使用了关键部分，但这可能不是您所期望的。</font><font style="vertical-align: inherit;">假设
                 </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                 </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以
                 </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后该
                 </font></font><code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列显示以下条件的两个关键部件长度：
              </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; = 1 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;2
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                但是，事实上，条件转换为：
              </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; = 1 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不为NULL
</font></font></pre></li></ul>
</div>
<p>
            <a class="xref" href="/mysql-5.7-google-zh/optimization.html#range-access-single-part" title="单部分索引的范围访问方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单部分索引的范围访问方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述了如何执行优化来合并或消除单部分索引上的范围条件的间隔。</font><font style="vertical-align: inherit;">类似的步骤是针对多部分索引的范围条件执行的。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="equality-range-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多值比较的等式范围优化</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            考虑这些表达式，其中
             </font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是索引列：
          </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>valN</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
 </font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR ... OR </font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>valN</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于几个值中的任何一个，</font><font style="vertical-align: inherit;">则每个表达式都为真
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些比较是等同范围比较（其中</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是单个值）。</font><font style="vertical-align: inherit;">优化程序估算阅读符合等级范围比较的合格行的成本，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果开启了唯一索引
                 </font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则每个范围的行估计值为1，因为最多有一行可以具有给定值。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                否则，任何索引
                 </font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都是非唯一的，并且优化程序可以使用索引或索引统计信息来估计每个范围的行数。
</font></font></p></li></ul>
</div>
<a class="indexterm" name="idm140528107098896"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用索引潜水时，优化程序在范围的每个末端进行潜水并使用该范围内的行数作为估计值。</font><font style="vertical-align: inherit;">例如，表达式
             </font></font><code class="literal"><em class="replaceable"><code>col_name</code></em> IN (10, 20,
            30)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有三个相等范围，优化器每个范围进行两次潜水以生成行估计。</font><font style="vertical-align: inherit;">每对潜水产生具有给定值的行数的估计值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            索引潜水提供准确的行估计，但随着表达式中比较值的数量增加，优化程序需要更长时间才能生成行估计。</font><font style="vertical-align: inherit;">使用索引统计信息不如索引潜水准确，但允许对大值列表进行更快速的行估计。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量，您可以配置优化程序从一行估计策略切换到另一行的值的数量。</font><font style="vertical-align: inherit;">要允许使用索引潜水来比较最高</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            相等范围，请将其设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 1.要禁用统计数据并始终使用索引潜水
             </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请将其设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为0。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要更新的最佳估计表索引统计信息，使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            即使在索引潜水可能被使用的情况下，它们也会被跳过以满足所有这些条件的查询：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                存在单索引</font></font><code class="literal">FORCE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引提示。</font><font style="vertical-align: inherit;">我们的想法是，如果强制使用索引，那么从索引中执行潜水的额外开销就没有任何收获。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该指数是不唯一的，而不是一个
                 </font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指数。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                没有子查询存在。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                不</font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">GROUP
                BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款存在。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些跳水条件仅适用于单表查询。</font><font style="vertical-align: inherit;">对于多表查询（联接），索引潜水不会被跳过。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="range-optimization-memory-use"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制内存使用范围优化</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要控制范围优化器可用的内存，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_range_optimizer_max_mem_size"><code class="literal">range_optimizer_max_mem_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                值为0意味着</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有限制。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span>
              </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果值大于0，那么优化器会在考虑范围访问方法时跟踪消耗的内存。</font><font style="vertical-align: inherit;">如果将超过指定的限制，则会放弃范围访问方法，而是考虑其他方法（包括全表扫描）。</font><font style="vertical-align: inherit;">这可能不太理想。</font><font style="vertical-align: inherit;">如果发生这种情况，会发生以下警告（其中
                 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是当前
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_range_optimizer_max_mem_size"><code class="literal">range_optimizer_max_mem_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                值）：
              </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告3170 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节的</font><font style="vertical-align: inherit;">内存容量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                   'range_optimizer_max_mem_size'超出。</font><font style="vertical-align: inherit;">范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                   这个查询没有完成优化。</font></font><font></font>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于超出可用范围优化内存并且优化器退回到次优计划的单个查询，增加该
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_range_optimizer_max_mem_size"><code class="literal">range_optimizer_max_mem_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值可能会提高性能。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要估计处理范围表达式所需的内存量，请使用以下指导原则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于如下所示的简单查询，其中有一个用于范围访问方法的候选键，每个谓词组合</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用大约230个字节：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中a = 1或a = 2或a = 3或.. </font><font style="vertical-align: inherit;">a = </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                同样，对于如下所示的查询，每个谓词组合</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用大约125个字节：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中a = 1和b = 1并且c = 1 ... </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于具有</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                谓词</font><font style="vertical-align: inherit;">的查询</font><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IN（1,2，...，</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和b IN（1,2，...，</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">
                中的每个文字值都被
                 </font><font style="vertical-align: inherit;">视为一个谓词</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果有两个</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                列表，则谓词
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数量是每个列表中文字值的乘积。</font><font style="vertical-align: inherit;">因此，</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的例子中</font><font style="vertical-align: inherit;">与谓词结合的数量
                 </font><font style="vertical-align: inherit;">是
                 </font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">×
                 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在5.7.11之前，每个谓词组合的字节数</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更高，约700字节。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="row-constructor-range-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行构造器表达式的范围优化</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化器能够将范围扫描访问方法应用于此表单的查询：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM t1 WHERE（col_1，col_2）IN（（'a'，'b'），（'c'，'d'））;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以前，对于要使用的范围扫描，有必要将查询写为：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM t1 WHERE（col_1 ='a'和col_2 ='b'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OR（col_1 ='c'AND col_2 ='d'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了优化器使用范围扫描，查询必须满足以下条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                只有</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谓词被使用，而不是</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_not-in"><code class="literal">NOT IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谓词</font><font style="vertical-align: inherit;">的左侧
                 </font><font style="vertical-align: inherit;">，行构造函数仅包含列引用。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谓词</font><font style="vertical-align: inherit;">的右侧
                 </font><font style="vertical-align: inherit;">，行构造函数只包含运行时常量，它们是在执行期间绑定到常量的文字或本地列引用。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谓词</font><font style="vertical-align: inherit;">的右侧
                 </font><font style="vertical-align: inherit;">，有多个行构造函数。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关优化程序和行构造函数的更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#row-constructor-optimization" title="8.2.1.18行构造器表达式优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.18节“行构造函数表达式优化”</font></font></a>
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="index-merge-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.3索引合并优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528107028160"></a><a class="indexterm" name="idm140528107027120"></a><a class="indexterm" name="idm140528107026032"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指数合并</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问方法检索与多行
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描和他们的结果合并到一个。</font><font style="vertical-align: inherit;">此访问方法合并来自单个表的索引扫描; </font><font style="vertical-align: inherit;">它不会将扫描合并到多个表中。</font><font style="vertical-align: inherit;">合并可以产生工会，交叉点或其基础扫描的交叉点。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以使用索引合并的示例查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10 OR </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 20;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10 OR </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 20）AND </font></font><em class="replaceable"><code>non_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 30;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t1。IN </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1,2）或</font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1。LIKE' </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  和t2。</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= t1。</font></font><em class="replaceable"><code>some_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1。</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND（t2。</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= t1。OR </font></font><em class="replaceable"><code>some_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t2。</font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= t1。</font></font><em class="replaceable"><code>some_col2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出时，索引合并方法显示为
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
           </font></font><code class="literal">type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中。</font><font style="vertical-align: inherit;">在这种情况下，该
           </font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列包含使用的索引列表，并</font></font><code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含这些索引的最长键部分的列表。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            索引合并优化算法具有以下已知缺陷：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果您的查询</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                包含深层</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                嵌套</font><font style="vertical-align: inherit;">的复杂</font><font style="vertical-align: inherit;">子句，
                 </font><font style="vertical-align: inherit;">并且MySQL不选择最佳计划，请尝试使用以下标识转换来分配术语：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>x</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>y</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）OR </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;（</font></font><em class="replaceable"><code>x</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）AND（</font></font><em class="replaceable"><code>y</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><em class="replaceable"><code>x</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>y</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）AND </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;（</font></font><em class="replaceable"><code>x</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）OR（</font></font><em class="replaceable"><code>y</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                索引合并不适用于全文索引。
</font></font></p></li></ul>
</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引合并访问方法有几种算法，这些算法显示在</font><font style="vertical-align: inherit;">输出</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段中
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">Using intersect(...)</code>
            </p></li><li class="listitem"><p>
              <code class="literal">Using union(...)</code>
            </p></li><li class="listitem"><p>
              <code class="literal">Using sort_union(...)</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下各节将更详细地介绍这些算法。</font><font style="vertical-align: inherit;">优化器根据各种可用选项的成本估算，在不同的可能的索引合并算法和其他访问方法之间进行选择。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引合并的使用是受价值
           </font></font><code class="literal">index_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">index_merge_intersection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">index_merge_union</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><code class="literal">index_merge_sort_union</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该旗
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，所有这些标志都是</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">仅启用某些算法，设置</font></font><code class="literal">index_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为
           </font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并仅启用应该允许的其他</font><font style="vertical-align: inherit;">算法</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-merge-intersection" title="索引合并交集访问算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引合并交集访问算法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-merge-union" title="索引合并联盟访问算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引合并联盟访问算法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-merge-sort-union" title="索引合并排序联合访问算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引合并排序联合访问算法</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="index-merge-intersection"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引合并交集访问算法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此访问算法适用于将</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句转换为与不同键结合使用</font><font style="vertical-align: inherit;">时的
             </font><font style="vertical-align: inherit;">几个范围条件
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且每个条件都是以下条件之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种形式</font><font style="vertical-align: inherit;">
                的</font><font style="vertical-align: inherit;">部分表达式，其中索引具有完全
                 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分（即，涵盖所有索引部分）：
              </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... AND </font></font><em class="replaceable"><code>key_partN</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>constN</code></em>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">
                的主键上的任何范围条件
                 </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例子：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>innodb_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;10 AND </font></font><em class="replaceable"><code>key_col1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 20;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（</font></font><em class="replaceable"><code>key1_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>key1_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2）AND </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            Index Merge交集算法对所有使用的索引执行同时扫描，并产生它从合并索引扫描中接收到的行序列的交集。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果查询中使用的所有列都被使用的索引覆盖，则不检索全表行（</font><font style="vertical-align: inherit;">
            在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出包含
             </font></font><code class="literal">Using index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段中）。</font><font style="vertical-align: inherit;">这是一个这样的查询的例子：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM t1 WHERE key1 = 1 AND key2 = 1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果使用的索引不涵盖查询中使用的所有列，则只有满足所有使用的键的范围条件时才会检索完整行。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果其中一个合并条件是</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的主键条件</font><font style="vertical-align: inherit;">，则不用于行检索，但用于过滤使用其他条件检索的行。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="index-merge-union"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引合并联盟访问算法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该算法的标准与Index Merge交集算法的标准相似。</font><font style="vertical-align: inherit;">该算法适用于将表格的</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句转换为与不同键结合使用时的几个范围条件</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且每个条件为以下之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种形式</font><font style="vertical-align: inherit;">
                的</font><font style="vertical-align: inherit;">部分表达式，其中索引具有完全
                 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分（即，涵盖所有索引部分）：
              </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... AND </font></font><em class="replaceable"><code>key_partN</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>constN</code></em>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">
                的主键上的任何范围条件
                 </font><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Index Merge交集算法适用的条件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例子：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 OR </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 OR </font></font><em class="replaceable"><code>key3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 3;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>innodb_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     OR（</font></font><em class="replaceable"><code>key3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='foo'AND </font></font><em class="replaceable"><code>key4</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='bar'）AND </font></font><em class="replaceable"><code>key5</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 5;
</font></font></pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="index-merge-sort-union"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引合并排序联合访问算法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句转换为多个范围条件组合
             </font><font style="vertical-align: inherit;">时，此访问算法适用
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但索引合并联合算法不适用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例子：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_col1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;10或</font></font><em class="replaceable"><code>key_col2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;20;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（</font></font><em class="replaceable"><code>key_col1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 10 OR </font></font><em class="replaceable"><code>key_col2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 20）AND </font></font><em class="replaceable"><code>nonkey_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 30;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            排序联合算法和联合算法的区别在于排序联合算法必须首先为所有行提取行ID并在返回任何行之前对它们进行排序。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="condition-pushdown-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.4引擎状况下推优化</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此优化可提高非索引列与常数之间的直接比较效率。</font><font style="vertical-align: inherit;">在这种情况下，条件会</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下推</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到存储引擎进行评估。</font><font style="vertical-align: inherit;">此优化只能由</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎使用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于NDB集群，这种优化可以消除在群集的数据节点和发出查询的MySQL服务器之间通过网络发送不匹配行的需要，并且可以加速比使用5到10倍的查询更快的查询条件下推可能但不被使用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设NDB簇表定义如下：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    b INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    KEY（一）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = NDB;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          条件下推可用于查询，如下所示，其中包括非索引列和常数之间的比较：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT a，b FROM t1 WHERE b = 10;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在以下输出中可以看到使用条件下推
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT a,b FROM t1 WHERE b = 10\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：在推动条件下使用</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          但是，条件下推</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于这两个查询中的任何一个：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT a，b FROM t1 WHERE a = 10;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT a，b FROM t1 WHERE b + 1 = 10;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          条件下推不适用于第一个查询，因为索引存在于列上</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（索引访问方法会更高效，因此会优先选择条件下推。）第二个查询不能使用条件下推，因为涉及非索引列的比较
           </font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是间接的。</font><font style="vertical-align: inherit;">（但是，如果要减少</font></font><code class="literal">b + 1 =
          10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font><font style="vertical-align: inherit;">子句</font></font><code class="literal">b = 9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中，
           </font><font style="vertical-align: inherit;">则可以应用条件下推</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用</font></font><code class="literal">&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><code class="literal">&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font><font style="vertical-align: inherit;">将索引列与常量进行比较时，也可以使用条件下推</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT a, b FROM t1 WHERE a &lt; 2\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：在推动条件下使用</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          其他支持的条件下推比较包括以下内容：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> [NOT] LIKE
              <em class="replaceable"><code>pattern</code></em></code>
            </p><p>
              <em class="replaceable"><code>pattern</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须是包含要匹配的模式的字符串文字; </font><font style="vertical-align: inherit;">有关语法，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#string-comparison-functions" title="12.5.1字符串比较函数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.5.1节“字符串比较函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> IS [NOT]
              NULL</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> IN
              (<em class="replaceable"><code>value_list</code></em>)</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              每个项目</font></font><em class="replaceable"><code>value_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              必须是一个常数，字面值。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> BETWEEN
              <em class="replaceable"><code>constant1</code></em> AND
              <em class="replaceable"><code>constant2</code></em></code>
            </p><p>
              <em class="replaceable"><code>constant1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
               </font></font><em class="replaceable"><code>constant2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个都必须是一个不变的字面值。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在上述列表中的所有情况下，条件可能会转换为列与常量之间的一个或多个直接比较形式。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          引擎条件下推是默认启用的。</font><font style="vertical-align: inherit;">要在服务器启动时禁用它，请设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">例如，在一个</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中，使用这些行：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
optimizer_switch = engine_condition_pushdown =关</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在运行时，像这样禁用条件下推：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='engine_condition_pushdown = off';
</font></font></pre><p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制。&nbsp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            引擎状况下推受以下限制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              条件下推仅受</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">支持
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              列可能只与常量进行比较; </font><font style="vertical-align: inherit;">但是，这包括评估为常数值的表达式。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              比较中使用的列不能是任何
               </font><font style="vertical-align: inherit;">类型</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要与列进行比较的字符串值必须使用与列相同的排序规则。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              联合不直接支持; </font><font style="vertical-align: inherit;">涉及多个表格的条件在可能的情况下单独推送 </font><font style="vertical-align: inherit;">使用扩展</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出来确定哪些条件实际被推下。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-extended" title="8.8.3扩展的EXPLAIN输出格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.3节“扩展EXPLAIN输出格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="index-condition-pushdown-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.5索引条件下推优化</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引条件下推（ICP）是针对MySQL使用索引从表中检索行的情况的优化。</font><font style="vertical-align: inherit;">如果没有ICP，存储引擎将遍历索引来查找基表中的行，并将它们返回给MySQL服务器，以评估</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">条件。</font><font style="vertical-align: inherit;">启用ICP后，如果</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只能使用索引中的列来评估条件的</font><font style="vertical-align: inherit;">某些部分
           </font><font style="vertical-align: inherit;">，MySQL服务器会将这部分</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件下降到存储引擎。</font><font style="vertical-align: inherit;">然后，存储引擎使用索引条目评估推送索引条件，并且只有满足时才从表中读取该行。</font><font style="vertical-align: inherit;">ICP可以减少存储引擎必须访问基表的次数以及MySQL服务器必须访问存储引擎的次数。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引条件的适用性下推优化受以下条件限制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ICP用于
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问方法时，有必要访问完整的表行。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ICP可用于</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，包括分区</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，ICP仅用于二级索引。</font><font style="vertical-align: inherit;">ICP的目标是减少全行读取次数，从而减少I / O操作。</font><font style="vertical-align: inherit;">对于
               </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聚簇索引，完整记录已被读入</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              缓冲区。</font><font style="vertical-align: inherit;">在这种情况下使用ICP不会减少I / O。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在虚拟生成的列上创建的二级索引不支持ICP。</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              支持虚拟生成列上的二级索引。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              引用子查询的条件不能被推下。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              涉及存储功能的条件无法下推。</font><font style="vertical-align: inherit;">存储引擎不能调用存储的函数。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              触发条件不能被推低。</font><font style="vertical-align: inherit;">（有关触发条件的信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#subquery-optimization-with-exists" title="8.2.2.4使用EXISTS策略优化子查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.4节“使用EXISTS策略优化子查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要理解这种优化的工作方式，首先要考虑索引扫描如何在不使用索引条件下推时进行：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              获取下一行，首先通过读取索引元组，然后使用索引元组来定位并读取整个表格行。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              测试</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于该表</font><font style="vertical-align: inherit;">的部分</font><font style="vertical-align: inherit;">条件。</font><font style="vertical-align: inherit;">根据测试结果接受或拒绝该行。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用索引条件下推，扫描将像这样进行：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              获取下一行的索引元组（但不是全表行）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              测试</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于此表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">部分，</font><font style="vertical-align: inherit;">并且可以仅使用索引列进行检查。</font><font style="vertical-align: inherit;">如果条件不满足，则转到下一行的索引元组。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果满足条件，则使用索引元组来定位并读取整个表格行。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              测试</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              适用于此表</font><font style="vertical-align: inherit;">的其余部分</font><font style="vertical-align: inherit;">条件。</font><font style="vertical-align: inherit;">根据测试结果接受或拒绝该行。
</font></font></p></li></ol>
</div>
<p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示
           </font></font><code class="literal">Using index condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引条件下推按钮</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">列中。</font><font style="vertical-align: inherit;">它不会显示，</font></font><code class="literal">Using index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因为在完整表格行必须被读取时不适用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设一个表包含有关人员及其地址的信息，并且该表的索引定义为
           </font></font><code class="literal">INDEX (zipcode, lastname, firstname)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果我们知道一个人的</font></font><code class="literal">zipcode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值，但不知道姓氏的话，我们可以像这样搜索：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择*从人</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE zipcode ='95054'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND lastname LIKE'％etrunia％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  和地址LIKE'％Main Street％';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL可以使用索引来扫描人们
           </font></font><code class="literal">zipcode='95054'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">第二部分（</font></font><code class="literal">lastname LIKE '%etrunia%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）不能用于限制必须扫描的行数，因此如果没有索引条件下推，此查询必须为所有拥有的人检索完整的表行
           </font></font><code class="literal">zipcode='95054'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用索引条件下推，MySQL </font></font><code class="literal">lastname LIKE '%etrunia%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在读取整个表格行之前</font><font style="vertical-align: inherit;">检查
           </font><font style="vertical-align: inherit;">零件。</font><font style="vertical-align: inherit;">这样可以避免读取与符合</font></font><code class="literal">zipcode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件但不</font><font style="vertical-align: inherit;">符合</font><font style="vertical-align: inherit;">条件的
           </font><font style="vertical-align: inherit;">索引元组相对应的完整行
           </font></font><code class="literal">lastname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引条件下推是默认启用的。</font><font style="vertical-align: inherit;">它可以</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过设置</font></font><code class="literal">index_condition_pushdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">来控制
           </font><font style="vertical-align: inherit;">系统变量
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='index_condition_pushdown = off';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET optimizer_switch ='index_condition_pushdown = on';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="nested-loop-joins"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.6嵌套循环连接算法</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106820688"></a><a class="indexterm" name="idm140528106819632"></a><a class="indexterm" name="idm140528106818144"></a><a class="indexterm" name="idm140528106817056"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL使用嵌套循环算法或其变体来执行表之间的连接。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#nested-loop-join-algorithm" title="嵌套循环连接算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套循环连接算法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#block-nested-loop-join-algorithm" title="块嵌套循环连接算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块嵌套循环连接算法</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="nested-loop-join-algorithm"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套循环连接算法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个简单的嵌套循环连接（NLJ）算法从循环中的第一个表中逐行读取一行，将每行传递给处理连接中下一个表的嵌套循环。</font><font style="vertical-align: inherit;">这个过程会重复多次，因为还有要加入的表格。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设三个表之间的连接
             </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
             </font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是使用以下类型的连接来执行：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表联接类型</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t1范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t2 ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t3 ALL</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果使用简单的NLJ算法，则会像这样处理连接：
          </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于t1匹配范围中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于t2中的每一行匹配参考键{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于t3中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果行满足连接条件，则发送给客户端</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于NLJ算法每次从外循环向内循环传递一行，因此它通常会多次读取在内循环中处理的表格。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="block-nested-loop-join-algorithm"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块嵌套循环连接算法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            块嵌套循环（BNL）连接算法使用在外部循环中读取的行的缓冲来减少必须读取内部循环中的表的次数。</font><font style="vertical-align: inherit;">例如，如果将10行读入缓冲区并将缓冲区传递给下一个内部循环，则可以将内部循环中读取的每行与缓冲区中的所有10行进行比较。</font><font style="vertical-align: inherit;">这会减少内部表格必须读取的次数。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL连接缓冲具有以下特点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当连接类型为</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
                 </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index"><code class="literal">index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（换句话说，当不可能使用任何密钥，并且完成对数据行或索引行的完全扫描
                 </font><font style="vertical-align: inherit;">时），可以使用连接缓冲
                 </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bnl-bka-optimization" title="8.2.1.11块嵌套循环和批处理键访问联接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.11节“块嵌套循环和批处理键访问连接”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，缓冲的使用也适用于外连接</font><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                第一个非常量表永远不会分配连接缓冲区，即使它是类型
                 </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index"><code class="literal">index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                只有连接感兴趣的列存储在其连接缓冲区中，而不是整行。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                的</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量来确定每个的大小联接缓冲液用于处理查询。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                为每个可以缓冲的连接分配一个缓冲区，因此可以使用多个连接缓冲区处理给定的查询。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在执行连接之前分配连接缓冲区，并在查询完成后释放连接缓冲区。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于前面介绍的NLJ算法（无缓冲）的连接示例，使用连接缓冲按如下方式完成连接：
          </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于t1匹配范围中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于t2中的每一行匹配参考键{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    在连接缓冲区中存储t1，t2中使用的列</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    如果缓冲区已满{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于t3中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于每个t1，t2在连接缓冲区中的组合{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果行满足连接条件，则发送给客户端</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      空连接缓冲区</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果缓冲区不是空的{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于t3中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于每个t1，t2在连接缓冲区中的组合{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果行满足连接条件，则发送给客户端</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><em class="replaceable"><code>S</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是每个存储的大小
             </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组合是联接缓冲区，并且</font></font><em class="replaceable"><code>C</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">缓冲区</font><font style="vertical-align: inherit;">中组合的数量，则表</font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描</font><font style="vertical-align: inherit;">次数</font><font style="vertical-align: inherit;">为：
          </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>S</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* </font></font><em class="replaceable"><code>C</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）/ join_buffer_size + 1
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            数</font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描降低为价值</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            时增加，最高可达点
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是大到足以容纳所有上一行组合。</font><font style="vertical-align: inherit;">在那个时候，通过增大速度并不能获得速度。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="nested-join-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.7嵌套连接优化</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表达连接的语法允许嵌套连接。</font><font style="vertical-align: inherit;">以下讨论引用了</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#join" title="13.2.9.2 JOIN语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.9.2节“JOIN语法”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的连接语法
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>table_factor</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与SQL标准相比，扩展</font><font style="vertical-align: inherit;">
          语法</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">后者只接受</font></font><em class="replaceable"><code>table_reference</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是他们在一对括号内的列表。</font><font style="vertical-align: inherit;">如果我们将</font></font><em class="replaceable"><code>table_reference</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font><font style="vertical-align: inherit;">列表中的每个逗号</font><font style="vertical-align: inherit;">等同于内部</font><font style="vertical-align: inherit;">联接，这是一个保守的扩展
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN（t2，t3，t4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 ON（t2.a = t1.a AND t3.b = t1.b AND t4.c = t1.c）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          相当于：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN（t2 CROSS JOIN t3 CROSS JOIN t4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 ON（t2.a = t1.a AND t3.b = t1.b AND t4.c = t1.c）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL中，</font></font><code class="literal">CROSS JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在语法上等同于</font></font><code class="literal">INNER JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">他们可以互相取代。</font><font style="vertical-align: inherit;">在标准的SQL中，它们不是等价的。
          </font></font><code class="literal">INNER JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与一个</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款</font><font style="vertical-align: inherit;">一起使用
           </font><font style="vertical-align: inherit;">; </font></font><code class="literal">CROSS JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否则使用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通常，在仅包含内连接操作的连接表达式中可以忽略括号。</font><font style="vertical-align: inherit;">考虑这个连接表达式：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1 LEFT JOIN（t2 LEFT JOIN t3 ON t2.b = t3.b OR t2.b IS NULL）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   ON t1.a = t2.a</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          删除左括号和分组操作后，该连接表达式转换为以下表达式：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（t1 LEFT JOIN t2 ON t1.a = t2.a）LEFT JOIN t3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ON t2.b = t3.b OR t2.b IS NULL</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          然而，这两个表达式并不等同。</font><font style="vertical-align: inherit;">看到这一点，假设表</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有以下状态：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表格</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含行
               </font></font><code class="literal">(1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">(2)</code>
            </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表格</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含行
              </font></font><code class="literal">(1,101)</code>
            </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表格</font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含行
              </font></font><code class="literal">(101)</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下，第一个表达式返回结果集包括行</font></font><code class="literal">(1,1,101,101)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">(2,NULL,NULL,NULL)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而第二表达式返回的行</font></font><code class="literal">(1,1,101,101)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">(2,NULL,NULL,101)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM t1</code></strong>
            <strong class="userinput"><code>LEFT JOIN</code></strong>
            <strong class="userinput"><code>(t2 LEFT JOIN t3 ON t2.b=t3.b OR t2.b IS NULL)</code></strong>
            <strong class="userinput"><code>ON t1.a=t2.a;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">101 | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM (t1 LEFT JOIN t2 ON t1.a=t2.a)</code></strong>
            <strong class="userinput"><code>LEFT JOIN t3</code></strong>
            <strong class="userinput"><code>ON t2.b=t3.b OR t2.b IS NULL;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">101 | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在以下示例中，外连接操作与内连接操作一起使用：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1 LEFT JOIN（t2，t3）ON t1.a = t2.a
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该表达式不能转换为以下表达式：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1 LEFT JOIN t2 ON t1.a = t2.a，t3
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于给定的表状态，这两个表达式返回不同的行集合：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM t1 LEFT JOIN (t2, t3) ON t1.a=t2.a;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">101 | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM t1 LEFT JOIN t2 ON t1.a=t2.a, t3;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">101 | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因此，如果我们使用外连接运算符省略连接表达式中的括号，我们可能会更改原始表达式的结果集。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          更确切地说，我们不能忽略左外部连接操作的右操作数和右连接操作的左操作数中的括号。</font><font style="vertical-align: inherit;">换句话说，我们不能忽略外连接操作的内部表表达式的括号。</font><font style="vertical-align: inherit;">其他操作数的括号（外部表的操作数）可以忽略。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下表达式：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（t1，t2）LEFT JOIN t3 ON P（t2.b，t3.b）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          相当于这个表达式的任何表
           </font></font><code class="literal">t1,t2,t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和任何条件
           </font></font><code class="literal">P</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的属性</font></font><code class="literal">t2.b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和</font></font><code class="literal">t3.b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1，t2 LEFT JOIN t3 ON P（t2.b，t3.b）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每当连接表达式（</font></font><em class="replaceable"><code>join_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中</font><font style="vertical-align: inherit;">的连接操作的执行顺序</font><font style="vertical-align: inherit;">不是从左到右，我们讨论嵌套连接。</font><font style="vertical-align: inherit;">考虑以下查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN（t2 LEFT JOIN t3 ON t2.b = t3.b）ON t1.a = t2.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里t1.a&gt; 1</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1 LEFT JOIN（t2，t3）ON t1.a = t2.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t2.b = t3.b OR t2.b IS NULL）AND t1.a&gt; 1</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些查询被认为包含这些嵌套连接：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t2 LEFT JOIN t3 ON t2.b = t3.b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t2，t3</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在第一个查询中，嵌套连接由左连接操作构成。</font><font style="vertical-align: inherit;">在第二个查询中，它由一个内部联接操作组成。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在第一个查询中，括号可以省略：连接表达式的语法结构将决定连接操作的执行顺序。</font><font style="vertical-align: inherit;">对于第二个查询，不能省略括号，尽管这里的连接表达式可以毫无歧义地解释。</font><font style="vertical-align: inherit;">在我们的扩展语法中，</font></font><code class="literal">(t2,
          t3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个查询中</font><font style="vertical-align: inherit;">的括号</font><font style="vertical-align: inherit;">是必需的，虽然理论上查询可以在没有它们的情况下进行分析：我们仍然会为查询设置明确的语法结构，因为</font></font><code class="literal">LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它会</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          发挥表达式的左右分隔符的作用</font></font><code class="literal">(t2,t3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          前面的例子证明了这些观点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于仅涉及内部连接（而不涉及外部连接）的连接表达式，可以删除括号并将连接从左向右计算。</font><font style="vertical-align: inherit;">事实上，表格可以按任何顺序进行评估。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一般而言，对于外部连接或外部连接与内部连接混合，情况也是如此。</font><font style="vertical-align: inherit;">删除括号可能会改变结果。
</font></font></p></li></ul>
</div>
<a class="indexterm" name="idm140528106714128"></a><a class="indexterm" name="idm140528106712640"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用嵌套外连接的查询以与使用内连接的查询相同的管道方式执行。</font><font style="vertical-align: inherit;">更准确地说，嵌套循环连接算法的一个变体被利用。</font><font style="vertical-align: inherit;">回想一下嵌套循环连接执行查询的算法（见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#nested-loop-joins" title="8.2.1.6嵌套循环连接算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.6节“嵌套循环连接算法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">假设3个表的连接查询</font></font><code class="literal">T1,T2,T3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有这种形式：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 INNER JOIN T2 ON P1（T1，T2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 内部连接T3打开P2（T2，T3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里P（T1，T2，T3）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这里，</font></font><code class="literal">P1(T1,T2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">P2(T3,T3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一些连接条件（上表达），而</font></font><code class="literal">P(T1,T2,T3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超过表中的列的条件</font></font><code class="literal">T1,T2,T3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          嵌套循环连接算法将以下列方式执行该查询：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3，使得P2（t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          符号</font></font><code class="literal">t1||t2||t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示通过连接的行的列构成的行
           </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在以下某些示例中，
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出现表名时表示</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该表的每列使用</font><font style="vertical-align: inherit;">的行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">t1||t2||NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          指示通过连接的行的列构成的行</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于每一列
           </font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">据说这样的行被完成
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><a class="indexterm" name="idm140528106694224"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在考虑使用嵌套外连接的查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （在T2（T2，T3）上的T2 LEFT JOIN T3 ON）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              开P1（T1，T2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里P（T1，T2，T3）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于此查询，修改嵌套循环模式以获取：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BOOL f1：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    BOOL f2：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3，使得P2（t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F2 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF（！f2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，NULL）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 NULL; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IF（！f1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF P（t1，NULL，NULL）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      T：= T 1 || || NULL NULL; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通常，对于外连接操作中的第一个内表的任何嵌套循环，都会引入一个标志，该标志在循环之前关闭并在循环之后进行检查。</font><font style="vertical-align: inherit;">当外部表中的当前行与来自表示内部操作数的表的匹配被找到时，该标志被打开。</font><font style="vertical-align: inherit;">如果在循环结束时该标志仍然关闭，则不会为外表的当前行找到匹配。</font><font style="vertical-align: inherit;">在这种情况下，该行由</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部表的列的值</font><font style="vertical-align: inherit;">补充
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">结果行被传递到输出或下一个嵌套循环的最终检查，但只有当该行满足所有嵌入的外部联接的联接条件时才行。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在该示例中，嵌入由以下表达式表示的外部联接表：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在T2（T2，T3）上的T2 LEFT JOIN T3 ON）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于具有内连接的查询，优化器可以选择不同的嵌套循环顺序，例如：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T3中的每一行t3 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P2（t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T1中的每一行t1，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于具有外部连接的查询，优化器只能选择外部表的循环先于内部表的循环的这种顺序。</font><font style="vertical-align: inherit;">因此，对于使用外连接的查询，只有一个嵌套顺序是可能的。</font><font style="vertical-align: inherit;">对于以下查询，优化器评估两个不同的嵌套。</font><font style="vertical-align: inherit;">在两个嵌套中，都
           </font></font><code class="literal">T1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须在外部循环中处理，因为它在外部连接中使用。</font></font><code class="literal">T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
           </font></font><code class="literal">T3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于内部联接，因此联接必须在内部循环中处理。</font><font style="vertical-align: inherit;">但是，因为联接是内部联接，</font></font><code class="literal">T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
           </font></font><code class="literal">T3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以按任一顺序处理。
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * T1 LEFT JOIN（T2，T3）ON P1（T1，T2）和P2（T1，T3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里P（T1，T2，T3）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个嵌套评估</font></font><code class="literal">T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后
           </font></font><code class="literal">T3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BOOL f1：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3，使得P2（t1，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1：= TRUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IF（！f1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF P（t1，NULL，NULL）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      T：= T 1 || || NULL NULL; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          其他嵌套评估</font></font><code class="literal">T3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后
           </font></font><code class="literal">T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BOOL f1：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T3中的每一行t3，使得P2（t1，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T2中的每一行t2，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1：= TRUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IF（！f1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF P（t1，NULL，NULL）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      T：= T 1 || || NULL NULL; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在讨论内连接的嵌套循环算法时，我们省略了一些对查询执行性能影响巨大的细节。</font><font style="vertical-align: inherit;">我们没有提到所谓的
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推倒</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件。</font><font style="vertical-align: inherit;">假设我们的
           </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件
           </font></font><code class="literal">P(T1,T2,T3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用一个连接的公式表示：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P（T1，T2，T2）= C1（T1）和C2（T2）和C3（T3）。
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下，MySQL实际上使用以下嵌套循环算法来执行带有内部连接的查询：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1，使得C1（t1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P1（t1，t2）AND C2（t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3，使得P2（t2，t3）和C3（t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          你看，每个合取的</font></font><code class="literal">C1(T1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">C2(T2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">C3(T3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是最内环的推到最外环的地方进行评估。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">C1(T1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一种非常严格的条件，则此条件下推可能会大大减少</font></font><code class="literal">T1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          传递给内部循环的</font><font style="vertical-align: inherit;">表的行数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，查询的执行时间可能会大大提高。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于具有外部联接的查询，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          只有在发现外部表中的当前行在内部表中匹配后才能检查</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">条件。</font><font style="vertical-align: inherit;">因此，从内部嵌套循环中推出条件的优化不能直接应用于具有外部连接的查询。</font><font style="vertical-align: inherit;">在这里，我们必须介绍在遇到匹配时打开的标志保护的条件下推谓词。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          回想一下有关外连接的这个例子：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P（T1，T2，T3）= C1（T1）AND C（T2）AND C3（T3）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于这个例子，使用守护下推条件的嵌套循环算法如下所示：
        </font></font></p><pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1，使得C1（t1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BOOL f1：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      使得P1（t1，t2）AND（f1→C2（t2）：TRUE）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    BOOL f2：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    T3中的每一行t3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使得P2（t2，t3）AND（f1 &amp;&amp; f2？C3（t3）：TRUE）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF（f1 &amp;&amp; f2？TRUE：（C2（t2）AND C3（t3）））{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F2 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF（！f2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF（f1→TRUE：C2（t2）&amp;&amp; P（t1，t2，NULL））{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 NULL; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IF（！f1 &amp;&amp; P（t1，NULL，NULL））{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      T：= T 1 || || NULL NULL; </font><font style="vertical-align: inherit;">OUTPUT t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通常，可以从连接条件（如</font></font><code class="literal">P1(T1,T2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和）中
           </font><font style="vertical-align: inherit;">提取下推谓词</font></font><code class="literal">P(T2,T3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，下拉谓词也由一个标志保护，该标志防止检查</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由相应外部联接操作生成的已完成行</font><font style="vertical-align: inherit;">的谓词</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果由来自</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">的谓词引发，则通过键从一个内部表访问到同一个嵌套连接中的另一个内部表是禁止的</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="left-join-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.8左连接和右连接优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106652352"></a><a class="indexterm" name="idm140528106651312"></a><a class="indexterm" name="idm140528106649824"></a><a class="indexterm" name="idm140528106648752"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL实现</font><font style="vertical-align: inherit;">如下：
</font></font><code class="literal"><em class="replaceable"><code>A</code></em> LEFT
          JOIN <em class="replaceable"><code>B</code></em> join_condition</code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表</font></font><em class="replaceable"><code>B</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被设置为依赖于表</font></font><em class="replaceable"><code>A</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和所</font><font style="vertical-align: inherit;">依赖的</font><font style="vertical-align: inherit;">所有表
               </font></font><em class="replaceable"><code>A</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表</font></font><em class="replaceable"><code>A</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被设置为依赖于</font><font style="vertical-align: inherit;">条件</font></font><em class="replaceable"><code>B</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中使用的</font><font style="vertical-align: inherit;">所有表（除外</font><font style="vertical-align: inherit;">）</font></font><code class="literal">LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件用于决定如何从表中检索行
               </font></font><em class="replaceable"><code>B</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（换句话说，条款中的任何条件</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都没有使用。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所有标准连接优化都会执行，但不同之处在于，表总是在它所依赖的所有表之后读取。</font><font style="vertical-align: inherit;">如果存在循环依赖关系，则会发生错误。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所有的标准</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化都被执行。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果有</font></font><em class="replaceable"><code>A</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">匹配的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">，但没有</font></font><em class="replaceable"><code>B</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与该</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">相匹配的
               </font></font><em class="replaceable"><code>B</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行，则会生成</font><font style="vertical-align: inherit;">一个额外的
               </font><font style="vertical-align: inherit;">行，并将所有列设置为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您使用</font></font><code class="literal">LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找某些表中不存在的行，并且您有以下测试：</font></font><code class="literal"><em class="replaceable"><code>col_name</code></em> IS
              NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分中，</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明为</font><font style="vertical-align: inherit;">哪里
               </font><font style="vertical-align: inherit;">的列</font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MySQL在找到后停止搜索更多行（对于特定的组合键）一行与</font></font><code class="literal">LEFT
              JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">匹配</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这个</font></font><code class="literal">RIGHT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现类似于</font></font><code class="literal">LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格角色颠倒的实现。</font><font style="vertical-align: inherit;">如</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#outer-join-simplification" title="8.2.1.9外连接简化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.9节“外连接简化”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，右连接转换为等效的左连接</font><font style="vertical-align: inherit;">。
        </font></font></p><a class="indexterm" name="idm140528106622368"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          连接优化程序计算连接表的顺序。</font><font style="vertical-align: inherit;">表的读取顺序被强制</font></font><code class="literal">LEFT
          JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有助于联接优化器更快地完成其工作，因为要排除的表排列更少。</font><font style="vertical-align: inherit;">这意味着如果您执行以下类型的查询，MySQL会进行全面扫描，</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为</font></font><code class="literal">LEFT
          JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前读取</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">力量是
           </font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM JOIN b LEFT JOIN c ON（c.key = a.key）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  LEFT JOIN d ON（d.key = a.key）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE b.key = d.key;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下的解决方法是反向，其中顺序
           </font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被中列出</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM b JOIN LEFT JOIN c ON（c.key = a.key）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  LEFT JOIN d ON（d.key = a.key）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE b.key = d.key;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于a </font></font><code class="literal">LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果
           </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件对于生成的</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">始终为false </font><font style="vertical-align: inherit;">，则将</font></font><code class="literal">LEFT
          JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其更改为正常连接。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code class="literal">t2.column1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
           </font><font style="vertical-align: inherit;">以下查询</font><font style="vertical-align: inherit;">，该
           </font><font style="vertical-align: inherit;">子句将为false </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN t2 ON（column1）WHERE t2.column2 = 5;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因此，将查询转换为正常联接是安全的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1，t2 WHERE t2.column2 = 5 AND t1.column1 = t2.column1;
</font></font></pre><a class="indexterm" name="idm140528106604352"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在优化器可以在表</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">使用表</font><font style="vertical-align: inherit;">，</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果这样做会导致更好的查询计划。</font><font style="vertical-align: inherit;">要提供有关表连接顺序的提示，请使用</font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.9节“SELECT语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，
           </font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会阻止索引被使用，因为它会禁用半连接转换; </font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="outer-join-simplification"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.9外连接简化</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在许多情况下，查询</font><font style="vertical-align: inherit;">
          的</font><font style="vertical-align: inherit;">子句中的</font><font style="vertical-align: inherit;">表达式</font><font style="vertical-align: inherit;">被简化了。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在解析器阶段，具有右外连接操作的查询将转换为仅包含左连接操作的等同查询。</font><font style="vertical-align: inherit;">在一般情况下，转换是这样进行的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（T1，...）右连接（T2，...）打开P（T1，...，T2，...）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          成为这个等效的左连接：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（T2，...）LEFT JOIN（T1，...）ON P（T1，...，T2，...）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表单</font></font><code class="literal">T1 INNER JOIN
          T2 ON P(T1,T2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">所有内部</font><font style="vertical-align: inherit;">联接</font><font style="vertical-align: inherit;">表达式</font><font style="vertical-align: inherit;">都将被列表替换
           </font></font><code class="literal">T1,T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">P(T1,T2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并以</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件（或嵌入</font><font style="vertical-align: inherit;">联接的联接</font><font style="vertical-align: inherit;">条件（如果存在）作为联合体加入）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当优化器评估外连接操作计划时，它只考虑计划，对于每个这样的操作，在内表之前访问外表。</font><font style="vertical-align: inherit;">优化器的选择是有限的，因为只有这样的计划才能使用嵌套循环算法执行外部连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          考虑一下这种形式的查询，其中</font></font><code class="literal">R(T2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          大大缩小了表中匹配行的数量
           </font></font><code class="literal">T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * T1 LEFT JOIN T2 ON P1（T1，T2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中P（T1，T2）和R（T2）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果查询以书面形式执行，则优化器别无选择，只能在限制</font></font><code class="literal">T1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">较多的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">访问限制较少的
           </font><font style="vertical-align: inherit;">表
           </font></font><code class="literal">T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这可能会产生非常低效的执行计划。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          相反，如果</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件为空拒绝</font><font style="vertical-align: inherit;">，MySQL会将查询转换为不带外连接操作的查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（也就是说，它将外部联接转换为内部联接。）如果对外部联接操作的条件评估为</font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">针对为该操作生成的</font></font><code class="literal">UNKNOWN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何已完成的
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行，</font><font style="vertical-align: inherit;">则说该条件为空拒绝
           </font><font style="vertical-align: inherit;">。
        </font></font></p><a class="indexterm" name="idm140528106580000"></a><a class="indexterm" name="idm140528106578928"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因此，对于这个外连接：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T1 LEFT JOIN T2 ON T1.A = T2.A
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          诸如这些的条件是空拒绝的，因为它们对于任何已完成的</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行（
           </font></font><code class="literal">T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列设置为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">都不为真</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T2.B不是NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T2.B&gt; 3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T2.C &lt;= T1.C</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T2.B &lt;2或T2.C&gt; 1</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          诸如这些的条件不为null，因为它们对于已完成的</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">可能是正确的</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T2.B IS NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T1.B &lt;3或T2.B不是NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T1.B &lt;3或T2.B&gt; 3</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          用于检查外部联接操作的条件是否为空的一般规则很简单：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它的形式</font><font style="vertical-align: inherit;">是，任何内部表的属性
             </font></font><code class="literal">A IS NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里
              </font></font><code class="literal">A</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它是一个包含对内部表格的引用的谓词，</font></font><code class="literal">UNKNOWN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当它的一个参数被</font><font style="vertical-align: inherit;">赋值</font><font style="vertical-align: inherit;">时，该</font><font style="vertical-align: inherit;">表格就会被计算</font><font style="vertical-align: inherit;">出来</font></font><code class="literal">NULL</code>
            </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它是一个包含null-rejected条件的连接词作为合成词
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它是无效拒绝条件的分解
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于查询中的一个外连接操作，条件可以为空，否则为空。</font><font style="vertical-align: inherit;">在此查询中，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个外连接操作</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">条件为空 - 拒绝，但不为空 - 第一个拒绝：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN T2 ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 在T3.B = T1.B时左加入T3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于查询中的外部联接操作，条件为空 - 拒绝，则外部联接操作将由内部联接操作替换。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例如，在前面的查询中，第二个外部联接是null拒绝的，并且可以由内部联接替换：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN T2 ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 INNER JOIN T3 ON T3.B = T1.B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于原始查询，优化器仅评估与单个表访问顺序兼容的计划
           </font></font><code class="literal">T1,T2,T3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于重写的查询，它还会考虑访问顺序
           </font></font><code class="literal">T3,T1,T2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个外部联接操作的转换可能触发另一个的转换。</font><font style="vertical-align: inherit;">因此，查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN T2 ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 在T3.B = T2.B上左加入T3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          首先转换为查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN T2 ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 INNER JOIN T3 ON T3.B = T2.B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这相当于查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM（T1 LEFT JOIN T2 ON T2.A = T1.A），T3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0且T3.B = T2.B</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          剩余的外部联接操作也可以由内部联接替换，因为条件</font></font><code class="literal">T3.B=T2.B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为空拒绝。</font><font style="vertical-align: inherit;">这导致一个查询没有外连接：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM（T1 INNER JOIN T2 ON T2.A = T1.A），T3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0且T3.B = T2.B</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有时候，优化器会成功替换嵌入的外部联接操作，但不能转换嵌入的外部联接。</font><font style="vertical-align: inherit;">以下查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2 LEFT JOIN T3 ON T3.B = T2.B）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          转换为：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2 INNER JOIN T3 ON T3.B = T2.B）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          只能对仍包含嵌入外连接操作的表单重写：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2，T3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ON（T2.A = T1.A和T3.B = T2.B）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.C&gt; 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          任何尝试在查询中转换嵌入的外连接操作都必须考虑嵌入外连接的连接条件以及
           </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件。</font><font style="vertical-align: inherit;">在此查询中，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌入外部联接</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">条件不为空 - 拒绝，但嵌入外部联接的联接条件</font></font><code class="literal">T2.A=T1.A AND
          T3.C=T1.C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空 - 拒绝：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2 LEFT JOIN T3 ON T3.B = T2.B）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ON T2.A = T1.A AND T3.C = T1.C</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.D&gt; 0或T1.D&gt; 0</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因此，该查询可以转换为：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2，T3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ON T2.A = T1.A AND T3.C = T1.C AND T3.B = T2.B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中T3.D&gt; 0或T1.D&gt; 0</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="mrr-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.10多范围读取优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106536672"></a><a class="indexterm" name="idm140528106535216"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当表很大并且没有存储在存储引擎的缓存中时，使用二级索引上的范围扫描读取行可能导致许多随机磁盘访问基表。</font><font style="vertical-align: inherit;">通过磁盘扫描多范围读取（MRR）优化，MySQL通过首先扫描索引并收集相关行的密钥，尝试减少范围扫描的随机磁盘访问次数。</font><font style="vertical-align: inherit;">然后对键进行排序，最后使用主键的顺序从基表中检索行。</font><font style="vertical-align: inherit;">磁盘扫描MRR的动机是减少随机磁盘访问的次数，而不是实现基本表数据的更多顺序扫描。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          多范围读取优化提供了以下好处：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              基于索引元组，MRR使数据行能够按顺序访问，而不是按随机顺序访问。</font><font style="vertical-align: inherit;">服务器获取满足查询条件的一组索引元组，并按照数据行ID顺序对它们进行排序，并使用排序后的元组按顺序检索数据行。</font><font style="vertical-align: inherit;">这使得数据访问效率更高，成本更低。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MRR支持批量处理需要通过索引元组访问数据行的操作的密钥访问请求，例如范围索引扫描和使用连接属性索引的等连接。</font><font style="vertical-align: inherit;">MRR迭代一系列索引范围以获取合格的索引元组。</font><font style="vertical-align: inherit;">随着这些结果的积累，它们将用于访问相应的数据行。</font><font style="vertical-align: inherit;">在开始读取数据行之前，不需要获取所有索引元组。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在虚拟生成的列上创建的二级索引不支持MRR优化。
          </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持虚拟生成列上的二级索引。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下情况说明MRR优化何时可能有优势：
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          方案A：MRR可用于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引范围扫描和表相等联接的操作。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一部分索引元组被累积在一个缓冲区中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              缓冲区中的元组按其数据行ID排序。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              数据行根据排序后的索引元组序列进行访问。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          场景B：MRR可以
           </font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于多范围索引扫描的表格或通过属性执行等连接时使用。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一部分范围（可能是单键范围）累积在提交查询的中央节点的缓冲区中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              范围被发送到访问数据行的执行节点。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              被访问的行被打包成包，并发送回中央节点。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              收到的包含数据行的包放在缓冲区中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              数据行从缓冲区读取。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用MRR时，</font><font style="vertical-align: inherit;">显示输出中
           </font><font style="vertical-align: inherit;">的</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
           </font><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"></font><code class="literal">Using MRR</code><font style="vertical-align: inherit;"></font></p><p>
          <code class="literal">InnoDB</code><font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果不需要访问全表行来生成查询结果</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">则不要使用MRR。</font><font style="vertical-align: inherit;">如果结果可以完全基于索引元组中的信息（通过</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_covering_index" title="覆盖指数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">产生，则是这种情况</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">MRR没有任何好处。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设有一个索引，可以使用MRR的示例查询</font><font style="vertical-align: inherit;">：
        </font></font><code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
          <em class="replaceable"><code>key_part2</code></em>)</code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; = 1000 AND </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;2000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10000;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引由</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">的元组组成
           </font><font style="vertical-align: inherit;">，首先按顺序排列</font><font style="vertical-align: inherit;">，然后按</font><font style="vertical-align: inherit;">顺序排列</font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
          <em class="replaceable"><code>key_part2</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果没有MRR，索引扫描涵盖</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从1000到2000范围内的</font><font style="vertical-align: inherit;">所有索引元组
           </font><font style="vertical-align: inherit;">，无论</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些元组</font><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">如何</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该扫描做了额外的工作，范围内的元组包含的
           </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不是10000。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过MRR，扫描被分成多个范围，每个范围为单个值</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1000,1001，...，1999）。</font><font style="vertical-align: inherit;">这些扫描中的每一个都只需要查看</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10000的</font><font style="vertical-align: inherit;">元组</font><font style="vertical-align: inherit;">。如果索引包含许多</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是10000的</font><font style="vertical-align: inherit;">元组
           </font><font style="vertical-align: inherit;">，MRR会导致读取的索引元组更少。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了使用区间表示法来表示这种情况，非MRR扫描必须检查索引范围</font></font><code class="literal">[{1000, 10000}, {2000,
          MIN_INT})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">索引范围</font><font style="vertical-align: inherit;">可以包括除那些</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10000 </font><font style="vertical-align: inherit;">以外的许多元组</font><font style="vertical-align: inherit;">.MRR扫描检查多个单点间隔
           </font></font><code class="literal">[{1000, 10000}]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，... </font></font><code class="literal">[{1999,
          10000}]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其仅包括元组与
           </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10000。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          两个</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量标志为使用MRR优化提供了一个接口。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">mrr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志控制是否启用MRR。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">mrr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用（</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），该</font></font><code class="literal">mrr_cost_based</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          标志控制优化器是否尝试在使用和不使用MRR（</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">之间进行基于开销的选择，</font><font style="vertical-align: inherit;">或者在可能的情况下使用MRR（</font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">默认情况下，</font></font><code class="literal">mrr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          是</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">mrr_cost_based</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          是</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于MRR，存储引擎使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">作为它可以为其缓冲区分配多少内存的指导。</font><font style="vertical-align: inherit;">引擎最多使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节并确定一次处理的范围数量。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="bnl-bka-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.11块嵌套循环和批处理键访问联接</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106479168"></a><a class="indexterm" name="idm140528106477712"></a><a class="indexterm" name="idm140528106476224"></a><a class="indexterm" name="idm140528106474736"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL中，可以使用批处理密钥访问（BKA）连接算法，该算法同时使用对连接表和连接缓冲区的索引访问。</font><font style="vertical-align: inherit;">BKA算法支持内连接，外连接和半连接操作，包括嵌套外连接。</font><font style="vertical-align: inherit;">由于更高效的表格扫描，BKA的优势包括改进的连接性能。</font><font style="vertical-align: inherit;">此外，之前仅用于内连接的块嵌套循环（BNL）连接算法已扩展，可用于外连接和半连接操作，包括嵌套外连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下各节讨论加入缓冲区管理，它们是扩展原始BNL算法，扩展BNL算法和BKA算法的基础。</font><font style="vertical-align: inherit;">有关半连接策略的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表和视图引用”</font></font></a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#join-buffer-management" title="加入缓冲区管理以实现块嵌套循环和批量键访问算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入缓冲区管理以实现块嵌套循环和批量键访问算法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bnl-optimization" title="用于外连接和半连接的块嵌套循环算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于外连接和半连接的块嵌套循环算法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bka-optimization" title="批量密钥访问加入"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批量密钥访问加入</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bnl-bka-optimizer-hints" title="用于块嵌套循环和批量键访问算法的优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于块嵌套循环和批量键访问算法的优化器提示</font></font></a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="join-buffer-management"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入缓冲区管理以实现块嵌套循环和批量键访问算法</font></font></h5>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL可以使用连接缓冲区来执行不仅对内部表无索引访问的内部连接，还可以执行子查询展平后出现的外部连接和半连接。</font><font style="vertical-align: inherit;">而且，当有内存表的索引访问时，可以有效地使用连接缓冲区。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当存储有趣的行列值时，连接缓冲区管理代码稍微更高效地利用连接缓冲区空间：如果行列的缓冲区中没有额外的字节被分配
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且最小字节数被分配给任何值该
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该代码支持两种类型的缓冲区，常规和增量。</font><font style="vertical-align: inherit;">假设使用连接缓冲区</font></font><code class="literal">B1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            来连接表</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用连接缓冲区</font><font style="vertical-align: inherit;">将此操作的结果与表</font><font style="vertical-align: inherit;">连接起来
             </font></font><code class="literal">B2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                常规连接缓冲区包含每个连接操作数的列。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">B2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个普通的加入缓冲液，每行</font></font><em class="replaceable"><code>r</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投入
                 </font></font><code class="literal">B2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由行的列</font></font><em class="replaceable"><code>r1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从
                 </font></font><code class="literal">B1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和匹配行的有趣列</font></font><em class="replaceable"><code>r2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从表
                 </font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                增量连接缓冲区只包含来自第二个连接操作数生成的表的行的列。</font><font style="vertical-align: inherit;">也就是说，它是从第一个操作数缓冲区开始增加的。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">B2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是增量加入缓冲液，它包含行的有趣列</font></font><em class="replaceable"><code>r2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                有链接到一起排
                 </font></font><em class="replaceable"><code>r1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
                 </font></font><code class="literal">B1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            增量连接缓冲区始终是相对于来自先前连接操作的连接缓冲区的增量，因此来自第一个连接操作的缓冲区始终是常规缓冲区。</font><font style="vertical-align: inherit;">在刚刚给出的实例中，缓冲</font></font><code class="literal">B1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用来连接表</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须是常规缓冲区。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于连接操作的增量缓冲区的每一行仅包含要连接的表中一行的有趣列。</font><font style="vertical-align: inherit;">这些列增加了对第一个连接操作数生成的表中匹配行的有趣列的引用。</font><font style="vertical-align: inherit;">增量缓冲区中的多行可引用</font></font><em class="replaceable"><code>r</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其列存储在先前连接缓冲区中</font><font style="vertical-align: inherit;">的同一行
             </font><font style="vertical-align: inherit;">，只要这些行与行匹配
             </font></font><em class="replaceable"><code>r</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            增量缓冲区可以减少从先前加入操作所用的缓冲区中复制列的次数。</font><font style="vertical-align: inherit;">这提供了缓存空间的节省，因为在一般情况下，第一个连接操作数产生的行可以与第二个连接操作数产生的若干行匹配。</font><font style="vertical-align: inherit;">没有必要从第一个操作数开始创建几行副本。</font><font style="vertical-align: inherit;">由于减少了复制时间，增量缓冲区还节省了处理时间。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">
            的</font></font><code class="literal">block_nested_loop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">batched_key_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制优化器如何使用块嵌套循环和批处理键访问连接算法。</font><font style="vertical-align: inherit;">默认情况下，</font></font><code class="literal">block_nested_loop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
             </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">batched_key_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
             </font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化器提示也可以应用; </font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bnl-bka-optimizer-hints" title="用于块嵌套循环和批量键访问算法的优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止嵌套循环和批处理密钥访问算法的优化器提示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关半连接策略的信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表和视图引用”</font></font></a>
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="bnl-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于外连接和半连接的块嵌套循环算法</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106432560"></a><a class="indexterm" name="idm140528106431104"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL BNL算法的原始实现扩展为支持外连接和半连接操作。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用连接缓冲区执行这些操作时，放入缓冲区的每一行都会提供一个匹配标志。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果使用连接缓冲区执行外连接操作，则会检查第二个操作数生成的表的每一行，以便与连接缓冲区中的每一行进行匹配。</font><font style="vertical-align: inherit;">当找到匹配项时，会形成一个新的扩展行（原始行加上第二个操作数的列），并通过剩余的联接操作发送进一步的扩展。</font><font style="vertical-align: inherit;">另外，缓冲区中匹配行的匹配标志被使能。</font><font style="vertical-align: inherit;">在所有要连接的表的行都被检查完之后，扫描连接缓冲区。</font><font style="vertical-align: inherit;">未启用其匹配标志的缓冲区中的每一行都通过</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">补充进行</font><font style="vertical-align: inherit;">扩展</font><font style="vertical-align: inherit;">（</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 第二个操作数中每列的值），并通过剩余的联接操作发送进一步的扩展。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">
            的</font></font><code class="literal">block_nested_loop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制优化器如何使用Block Nested-Loop算法。</font><font style="vertical-align: inherit;">默认情况下
             </font></font><code class="literal">block_nested_loop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
             </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化器提示也可以应用; </font><font style="vertical-align: inherit;">请参阅
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bnl-bka-optimizer-hints" title="用于块嵌套循环和批量键访问算法的优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止嵌套循环和批处理密钥访问算法的优化器提示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出端，为表使用BNL的当被所指</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值包含</font></font><code class="literal">Using join buffer (Block Nested
            Loop)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与所述</font></font><code class="literal">type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是
             </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index"><code class="literal">index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
             </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关半连接策略的信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表和视图引用”</font></font></a>
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="bka-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批量密钥访问加入</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106410528"></a><a class="indexterm" name="idm140528106409072"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL实现了一种连接表的方法，称为批处理密钥访问（BKA）连接算法。</font><font style="vertical-align: inherit;">当有第二个连接操作数生成的表的索引访问时，可以应用BKA。</font><font style="vertical-align: inherit;">与BNL连接算法类似，BKA连接算法使用连接缓冲区来累积由连接操作的第一个操作数生成的行的有趣列。</font><font style="vertical-align: inherit;">然后，BKA算法构建密钥以访问要加入缓冲区中所有行的表并将这些密钥批量提交给数据库引擎以进行索引查找。</font><font style="vertical-align: inherit;">钥匙通过多量程读取（MRR）接口提交给发动机（见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#mrr-optimization" title="8.2.1.10多范围读取优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.10节“多量程读取优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在提交密钥后，MRR引擎功能以最佳方式在索引中执行查找，获取由这些密钥找到的连接表的行，并开始提供具有匹配行的BKA连接算法。</font><font style="vertical-align: inherit;">每个匹配行都与对加入缓冲区中的行的引用相关联。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当使用BKA时，值
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义了每次向存储引擎发出请求时密钥批次的大小。</font><font style="vertical-align: inherit;">缓冲区越大，对连接操作的右手边表的顺序访问就越多，这可以显着提高性能。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要使用BKA，</font><font style="vertical-align: inherit;">必须将系统变量</font><font style="vertical-align: inherit;">的
             </font></font><code class="literal">batched_key_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">BKA使用MRR，因此</font></font><code class="literal">mrr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旗帜也必须如此
             </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">目前，MRR的成本估算过于悲观。</font><font style="vertical-align: inherit;">因此，也有必要对
             </font></font><code class="literal">mrr_cost_based</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要
             </font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于要使用的BKA。</font><font style="vertical-align: inherit;">以下设置启用BKA：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET optimizer_switch='mrr=on,mrr_cost_based=off,batched_key_access=on';</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MRR功能有两种执行方式：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                第一种方案用于传统的基于磁盘的存储引擎，如
                 </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于这些引擎，通常会将来自连接缓冲区的所有行的键一次提交给MRR接口。</font><font style="vertical-align: inherit;">特定于引擎的MRR函数对提交的键执行索引查找，从中获取行ID（或主键），然后根据BKA算法的请求逐个获取所有这些选定行ID的行。</font><font style="vertical-align: inherit;">每行都返回一个关联引用，该引用允许访问连接缓冲区中的匹配行。</font><font style="vertical-align: inherit;">MRR函数以最佳方式获取行：它们在行ID（主键）顺序中获取。</font><font style="vertical-align: inherit;">这提高了性能，因为读取按照磁盘顺序而不是随机顺序。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                第二种方案用于远程存储引擎，如</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一个来自连接缓冲区的行的一部分密钥及其关联由MySQL服务器（SQL节点）发送到NDB群集数据节点。</font><font style="vertical-align: inherit;">作为回报，SQL节点接收匹配行的包（或多个包）以及相应的关联。</font><font style="vertical-align: inherit;">BKA连接算法采用这些行并构建新的连接行。</font><font style="vertical-align: inherit;">然后将一组新的密钥发送到数据节点，并使用返回的包中的行构建新的连接行。</font><font style="vertical-align: inherit;">该过程继续进行，直到连接缓冲区中的最后一个键被发送到数据节点，并且SQL节点已收到并加入了与这些键匹配的所有行。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在第一种情况下，连接缓冲区的一部分被保留以存储通过索引查找选择的行ID（主键），并作为参数传递给MRR功能。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            没有专门的缓冲区来存储为连接缓冲区中的行构建的密钥。</font><font style="vertical-align: inherit;">相反，构建缓冲区中下一行键的函数作为参数传递给MRR函数。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出中，当</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值包含</font></font><code class="literal">Using join buffer (Batched Key
            Access)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">且</font></font><code class="literal">type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为
             </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font><font style="vertical-align: inherit;">时，对表格使用BKA </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="bnl-bka-optimizer-hints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于块嵌套循环和批量键访问算法的优化器提示</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            除了使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量来控制优化器对会话范围内的BNL和BKA算法的使用外，MySQL还支持优化器提示，以便基于每个语句影响优化器。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints" title="8.9.2优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.2节“优化器提示”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要使用BNL或BKA提示为外连接的任何内部表启用连接缓冲，必须为外连接的所有内部表启用连接缓冲。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="is-null-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.12 IS NULL优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106373968"></a><a class="indexterm" name="idm140528106372896"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL可以</font><font style="vertical-align: inherit;">使用它
           </font><font style="vertical-align: inherit;">来执行相同的优化
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，MySQL能使用索引和范围来搜索
           </font><font style="vertical-align: inherit;">与</font><font style="vertical-align: inherit;">。
        </font></font><em class="replaceable"><code>col_name</code></em> <a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a><font style="vertical-align: inherit;"></font><em class="replaceable"><code>col_name</code></em> <code class="literal">=</code>
          <em class="replaceable"><code>constant_value</code></em><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例子：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是NULL;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;=&gt; NULL;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IS NULL;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果一个</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句包含一个</font><font style="vertical-align: inherit;">声明为的列</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">条件
           </font><font style="vertical-align: inherit;">，那么该表达式就被优化了。</font><font style="vertical-align: inherit;">这种优化不会发生在柱子可能产生的情况下</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">例如，如果它来自一个右侧的表格
           </font><font style="vertical-align: inherit;">。
        </font></font><em class="replaceable"><code>col_name</code></em> <a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a><font style="vertical-align: inherit;"></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font><code class="literal">LEFT JOIN</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL还可以优化组合
           </font><font style="vertical-align: inherit;">，这是解决子查询中常见的一种形式。
          </font><font style="vertical-align: inherit;">显示
           </font><font style="vertical-align: inherit;">何时使用此优化。
        </font></font><code class="literal"><em class="replaceable"><code>col_name</code></em> =
          <em class="replaceable"><code>expr</code></em> OR
          <em class="replaceable"><code>col_name</code></em> IS NULL</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这个优化可以处理</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何关键部分。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设在列</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上存在索引，则优化查询的一些示例</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE t1.a = </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR t1.a IS NULL;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2 WHERE t1.a = t2.a OR t2.a IS NULL;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t1.a = t2.a或t2.a IS NULL）和t2.b = t1.b;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE t1.a = t2.a AND（t2.b = t1.b OR t2.b IS NULL）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t1.a = t2.a AND t2.a IS NULL AND ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  OR（t1.a = t2.a AND t2.a IS NULL AND ...）;</font></font><font></font>
</pre><p>
          <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先对引用键进行读取，然后单独搜索具有</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键值的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化只能处理一个</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别。</font><font style="vertical-align: inherit;">在以下查询中，MySQL仅在表达式上使用键查找，</font></font><code class="literal">(t1.a=t2.a AND t2.a IS
          NULL)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且无法使用关键部分
           </font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t1.a = t2.a AND t2.a IS NULL）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  OR（t1.b = t2.b AND t2.b IS NULL）;</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="order-by-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.13 ORDER BY优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106336368"></a><a class="indexterm" name="idm140528106335296"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍MySQL何时可以使用索引来满足</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，</font><font style="vertical-align: inherit;">当不能使用索引时使用</font><font style="vertical-align: inherit;">的
           </font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法，以及优化程序提供的执行计划信息</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-index-use" title="使用索引满足ORDER BY"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用索引满足ORDER BY</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-filesort" title="使用filesort优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用filesort优化</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-filesort-original" title="原始filesort算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始filesort算法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-filesort-modified" title="Modified filesort算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modified filesort算法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-filesort-in-memory" title="内存中的文件排列算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中的文件排列算法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-filesort-algorithm-comparison" title="filesort算法的比较"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filesort算法的比较</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-optimizer-control" title="影响ORDER BY优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响ORDER BY优化</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-diagnostic-information" title="ORDER BY执行计划信息可用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORDER BY执行计划信息可用</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="order-by-index-use"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用索引满足ORDER BY</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在某些情况下，MySQL可以使用索引来满足一个
             </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，而无需进行额外的排序。
          </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">ORDER
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要所有未使用的索引部分和所有额外的</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列都是</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">中的常量，
             </font><font style="vertical-align: inherit;">
            即使</font><font style="vertical-align: inherit;">索引不完全匹配索引，</font><font style="vertical-align: inherit;">也可以使用</font><font style="vertical-align: inherit;">索引
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下查询使用索引来解析</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">零件：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASC;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt; </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; </font></font><em class="replaceable"><code>constant2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在某些情况下，MySQL </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用索引来解析索引</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，尽管它仍然可以使用索引来查找与该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">匹配的行
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例子：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该查询使用</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的索引：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 ORDER BY </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                查询</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在索引的不连续部分</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 WHERE </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                查询混合</font></font><code class="literal">ASC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
                 </font></font><code class="literal">DESC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASC;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                用于提取行的索引不同于以下内容中使用的索引</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORDER BY </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                查询使用</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的表达式包含索引列名以外的其他术语：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 ORDER BY ABS（</font></font><em class="replaceable"><code>key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1 ORDER BY  - </font></font><em class="replaceable"><code>key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                查询连接多个表，并且这些列中的列
                 </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是全部来自用于检索行的第一个非常数表。</font><font style="vertical-align: inherit;">（这是</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出中没有</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接类型</font><font style="vertical-align: inherit;">的第一个表
                 </font><font style="vertical-align: inherit;">。）
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                查询有不同的</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                 </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表情。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                只有在该</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">命名的列的前缀上有一个索引</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，索引不能用于完全解决排序顺序。</font><font style="vertical-align: inherit;">例如，如果仅对列的前10个字节
                 </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR(20)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行索引，则索引无法区分超过第10个字节的值，并且</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要a。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                索引不按顺序存储行。</font><font style="vertical-align: inherit;">例如，对于</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的</font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引
                 </font><font style="vertical-align: inherit;">，这是正确的</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            用于排序的索引的可用性可能受到使用列别名的影响。</font><font style="vertical-align: inherit;">假设列
             </font></font><code class="literal">t1.a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被索引。</font><font style="vertical-align: inherit;">在此声明中，选择列表中的列名称为
             </font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它指的是</font></font><code class="literal">t1.a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，作为基准确实给</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
             </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以上的索引
             </font></font><code class="literal">t1.a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT a FROM t1 ORDER BY a;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在此语句中，选择列表中列的名称也是</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但它是别名。</font><font style="vertical-align: inherit;">它指的是</font></font><code class="literal">ABS(a)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，作为基准确实给</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以上的索引</font></font><code class="literal">t1.a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能使用：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择ABS（a）作为一个FROM t1 ORDER BY a;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在以下语句中，</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            引用的名称不是选择列表中列的名称。</font><font style="vertical-align: inherit;">但是有一列</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            名为</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以</font><font style="vertical-align: inherit;">可以使用</font></font><code class="literal">ORDER
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用</font></font><code class="literal">t1.a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和索引</font></font><code class="literal">t1.a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（当然，得到的排序顺序可能与顺序完全不同
             </font></font><code class="literal">ABS(a)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ABS（a）AS b FROM t1 ORDER BY a;
</font></font></pre><a class="indexterm" name="idm140528106253968"></a><a class="indexterm" name="idm140528106252480"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认情况下，MySQL按照</font><font style="vertical-align: inherit;">在查询中</font><font style="vertical-align: inherit;">指定的</font><font style="vertical-align: inherit;">顺序对所有</font><font style="vertical-align: inherit;">查询进行</font><font style="vertical-align: inherit;">排序</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果你包含一个</font><font style="vertical-align: inherit;">包含相同列列表</font><font style="vertical-align: inherit;">的显式</font><font style="vertical-align: inherit;">子句，MySQL会优化它，而不会受到任何速度的损失，尽管排序仍然存在。
          </font></font><code class="literal">GROUP BY
            <em class="replaceable"><code>col1</code></em>,
            <em class="replaceable"><code>col2</code></em>, ...</code><font style="vertical-align: inherit;"></font><code class="literal">ORDER BY
            <em class="replaceable"><code>col1</code></em>,
            <em class="replaceable"><code>col2</code></em>, ...</code><font style="vertical-align: inherit;"></font><code class="literal">ORDER
            BY</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果查询包含</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但您希望避免排序结果的开销，则可以通过指定来禁止排序</font></font><code class="literal">ORDER BY
            NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT a，COUNT（*）FROM bar GROUP BY ORDER BY NULL;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化器仍然可以选择使用排序来实现分组操作。</font></font><code class="literal">ORDER BY NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            抑制结果的排序，而不是事先通过分组操作进行排序以确定结果。
</font></font></p><a class="indexterm" name="idm140528106242016"></a><a class="indexterm" name="idm140528106240528"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
              <code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐式排序默认情况下（即没有</font></font><code class="literal">ASC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">DESC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定者），但依赖于隐式</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序已被弃用。</font><font style="vertical-align: inherit;">要生成给定的排序顺序，请使用显式
               </font></font><code class="literal">ASC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">列</font></font><code class="literal">DESC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              标识符</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或提供一个</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。
              </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序是一个MySQL扩展，可能在未来版本中发生变化; </font><font style="vertical-align: inherit;">例如，可以让优化器以任何它认为最有效的方式排序分组，并避免排序开销。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="order-by-filesort"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用filesort优化</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106230576"></a><a class="indexterm" name="idm140528106229536"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            MySQL有多种</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序和检索结果的算法。</font><font style="vertical-align: inherit;">原始算法仅使用</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">修改的算法不仅使用</font></font><code class="literal">ORDER
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，而且使用查询引用的所有列。</font><font style="vertical-align: inherit;">还有一种小型结果集的算法，它使用排序缓冲区作为优先级队列在内存中排序，而不使用合并文件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化器选择</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font><font style="vertical-align: inherit;">哪种</font><font style="vertical-align: inherit;">算法。</font><font style="vertical-align: inherit;">它通常使用修改的算法，除了</font><font style="vertical-align: inherit;">包含列</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">，在这种情况下它使用原始算法。</font><font style="vertical-align: inherit;">对于每种算法，排序缓冲区大小都是
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量值。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="order-by-filesort-original"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始filesort算法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            原始</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法的工作原理如下：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                根据键或表格扫描读取所有行。</font><font style="vertical-align: inherit;">跳过与该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                子句</font><font style="vertical-align: inherit;">不匹配的行</font><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于每一行，在排序缓冲区中存储由一对值（排序键值和行ID）组成的元组。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果所有对都适合排序缓冲区，则不会创建临时文件。</font><font style="vertical-align: inherit;">否则，当排序缓冲区变满时，在内存中对其执行快速排序并将其写入临时文件。</font><font style="vertical-align: inherit;">保存一个指向已排序块的指针。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                重复前面的步骤，直到读取所有行。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                将多达</font></font><code class="literal">MERGEBUFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                （7）个区域</font><font style="vertical-align: inherit;">多重合并到</font><font style="vertical-align: inherit;">另一个临时文件中的一个块中。</font><font style="vertical-align: inherit;">重复，直到第一个文件中的所有块都在第二个文件中。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                重复以下操作，直到</font></font><code class="literal">MERGEBUFF2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">剩余的块</font><font style="vertical-align: inherit;">数少于
                 </font><font style="vertical-align: inherit;">（15）个。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在最后的多重合并中，只有行ID（值对的最后一部分）被写入结果文件。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用结果文件中的行ID按排序顺序读取行。</font><font style="vertical-align: inherit;">为了优化这一点，请读入一大块行ID，对它们进行排序，然后使用它们按排序顺序将行读入行缓冲区。</font><font style="vertical-align: inherit;">行缓冲区大小是
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量值。</font><font style="vertical-align: inherit;">此步骤的代码位于
                 </font></font><code class="filename">sql/records.cc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源文件中。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这种方法的一个问题是它会读取两行：一是在</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句评估</font><font style="vertical-align: inherit;">期间，另一个是</font><font style="vertical-align: inherit;">在对值对进行排序之后。</font><font style="vertical-align: inherit;">即使第一次连续访问这些行（例如，如果进行了表扫描），也是第二次随机访问它们。</font><font style="vertical-align: inherit;">（排序键是有序的，但行位置不是。）
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="order-by-filesort-modified"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modified filesort算法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            修改后的</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法包含一个优化，以避免两次读取行：它记录排序键值，但不是行ID，而是记录查询引用的列。</font><font style="vertical-align: inherit;">修改后的</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法如下所示：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                读取与该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                子句</font><font style="vertical-align: inherit;">匹配的行</font><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于每一行，在排序缓冲区中存储由排序键值和查询引用的列组成的元组。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当排序缓冲区变满时，通过内存中的排序键值对元组进行排序，并将其写入临时文件。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                合并排序临时文件后，按排序顺序检索行，但直接从排序的元组中读取查询所需的列，而不是第二次访问表。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            修改后的</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            算法所</font><font style="vertical-align: inherit;">使用的元组长度</font><font style="vertical-align: inherit;">比原始算法使用</font><font style="vertical-align: inherit;">的元组长</font><font style="vertical-align: inherit;">，并且它们中的较少元素适合排序缓冲区。</font><font style="vertical-align: inherit;">因此，额外的I / O可以使修改的方法变得更慢，而不是更快。</font><font style="vertical-align: inherit;">为避免减速，只有在排序元组中的额外列的总大小不超过</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_length_for_sort_data"><code class="literal">max_length_for_sort_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量</font><font style="vertical-align: inherit;">的值时，优化器才使用修改后的算法
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（将此变量的值设置得太高的一个症状是高磁盘活动和低CPU活动的组合。）
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            修改后的</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法包括被设计为使多个元组装配到排序缓冲器的额外优化：对于类型的附加列
             </font></font><code class="literal">CHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或任何可为空的固定大小的数据类型，值被包装。</font><font style="vertical-align: inherit;">例如，如果没有打包，</font></font><code class="literal">VARCHAR(255)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则排序缓冲区中只包含3个字符</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">列值需要255个字符。</font><font style="vertical-align: inherit;">通过打包，该值只需要3个字符加上一个双字节长度指示符。</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值只需要一个位掩码。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于包含比最大列长度或许多</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值</font><font style="vertical-align: inherit;">短的可压缩字符串的数据</font><font style="vertical-align: inherit;">，更多记录适合排序缓冲区。</font><font style="vertical-align: inherit;">这改进了排序缓冲区的内存中排序和基于磁盘的临时文件合并排序的性能。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在边缘情况下，打包可能是不利的：如果可打包字符串是最大列长度或</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">很少
             </font><font style="vertical-align: inherit;">，则长度指示符所需的空间减少了适合排序缓冲区的记录数，并且内存和磁盘中的排序速度较慢。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="order-by-filesort-in-memory"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中的文件排列算法</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于以下形式的查询（和子查询），优化器可以</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用来高效地处理</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">操作，而无需合并文件：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM </font></font><em class="replaceable"><code>single_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... ORDER BY </font></font><em class="replaceable"><code>non_index_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DESC] LIMIT [ </font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，] </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这种类型的查询在Web应用程序中很常见，它只显示较大结果集中的几行。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT col1，... FROM t1 ... ORDER BY name LIMIT 10;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT col1，... FROM t1 ... ORDER BY RAND（）LIMIT 15;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            排序缓冲区的大小为
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">的排序元素</font><font style="vertical-align: inherit;">足够小以适应排序缓冲区（</font><font style="vertical-align: inherit;">
            如果</font><font style="vertical-align: inherit;">指定了</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），则服务器可避免使用合并文件，并通过将排序缓冲区视为优先级队列来执行内存中排序：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                扫描表格，按排序顺序在队列中插入每个选定行的选择列表列。</font><font style="vertical-align: inherit;">如果队列已满，请按排序顺序排出最后一行。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从队列中</font><font style="vertical-align: inherit;">
                返回第一</font><font style="vertical-align: inherit;">行。</font><font style="vertical-align: inherit;">（如果</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已指定，则跳过第一</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                行并返回下一</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                行。）
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果缺少该优化，则服务器通过使用合并文件进行排序来执行此操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                扫描表格，在表格末尾重复以上步骤：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    选择行，直到排序缓冲区被填满。
                  </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将缓冲区中</font><font style="vertical-align: inherit;">
                    的第一</font><font style="vertical-align: inherit;">行（</font><font style="vertical-align: inherit;">
                    如果</font><font style="vertical-align: inherit;">指定了</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）写入合并文件。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对合并文件进行排序并返回第一
                 </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行。</font><font style="vertical-align: inherit;">（如果
                 </font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已指定，则跳过第一</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行并返回下一</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行。）
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表扫描操作的成本与队列和合并文件方法相同，因此优化器会根据其他成本在两种方法之间进行选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                队列方法涉及更多的CPU按顺序将行插入到队列中。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                合并文件方法具有写入和读取文件和CPU成本的I​​ / O成本以对其进行排序。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化器考虑这些因素的特定值之间的平衡</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及行大小。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有和没有
             </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能以不同的顺序返回行，在讨论
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#limit-optimization" title="8.2.1.16限制查询优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.16，“LIMIT查询优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="order-by-filesort-algorithm-comparison"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filesort算法的比较</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设一个表</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有四
             </font></font><code class="literal">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
             </font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和，优化程序使用
             </font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 ORDER BY a，b;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该查询按照</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但返回所有列，因此查询所引用的列是</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
             </font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">根据</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化器选择</font><font style="vertical-align: inherit;">哪种
             </font><font style="vertical-align: inherit;">算法，查询执行如下：
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于原始算法，排序缓冲区元组具有以下内容：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（固定大小的值，固定大小的b值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行ID转换为t1）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化器对固定大小的值进行排序。</font><font style="vertical-align: inherit;">排序后，优化器按顺序读取元组，并使用每个元组中的行ID从中读取行</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取选择列表列值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于没有打包的修改算法，排序缓冲区元组具有以下内容：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（固定大小的值，固定大小的b值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a值，b值，c值，d值）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化器对固定大小的值进行排序。</font><font style="vertical-align: inherit;">排序后，优化读的元组为了和使用值</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得选择列表的列值不读
             </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于带有打包的修改算法，排序缓冲区元组具有以下内容：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（固定大小的值，固定大小的b值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一个长度，一个值，一个长度，一个b值，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c长度，包装c值，d长度，包装d值）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果有任何的</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者</font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，他们采取比在其他位掩码排序缓冲的空间。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化器对固定大小的值进行排序。</font><font style="vertical-align: inherit;">排序后，优化读的元组为了和使用值</font></font><code class="literal">a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得选择列表的列值不读
             </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="order-by-optimizer-control"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响ORDER BY优化</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font><font style="vertical-align: inherit;">未使用的</font><font style="vertical-align: inherit;">慢</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询
             </font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请尝试降低
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_length_for_sort_data"><code class="literal">max_length_for_sort_data</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到适合触发a的值
             </font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了提高</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">速度，请检查是否可以让MySQL使用索引而不是额外的分类阶段。</font><font style="vertical-align: inherit;">如果这不可行，您可以尝试以下策略：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                增加
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                变量值。</font><font style="vertical-align: inherit;">理想情况下，值应该足够大，以便整个结果集适合排序缓冲区（以避免写入磁盘和合并过程），但最小值必须足够大以容纳15个元组。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                考虑到存储在排序缓冲区中的列值的大小受
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_sort_length"><code class="literal">max_sort_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量值影响。</font><font style="vertical-align: inherit;">例如，如果元组存储了长字符串列的值，并增加了值
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_sort_length"><code class="literal">max_sort_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，排序缓冲区元组的大小也会增加，并且可能需要增加
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于由字符串表达式计算的列值（如调用字符串值函数的那些值），该</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法无法分辨表达式值的最大长度，因此它必须分配
                </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_sort_length"><code class="literal">max_sort_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 每个元组的字节数。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要监视合并通道的数量，请检查
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Sort_merge_passes"><code class="literal">Sort_merge_passes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                状态变量。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                增加
                 </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                变量值。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                通过声明列的大小，每列使用更少的RAM，因为它们需要保存存储在其中的值。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">CHAR(16)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比</font></font><code class="literal">CHAR(200)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数值不超过16个字符</font><font style="vertical-align: inherit;">更好
                 </font><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                将</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                系统变量</font><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">为指向具有大量可用空间的专用文件系统。</font><font style="vertical-align: inherit;">变量值可以列出以循环方式使用的多个路径; </font><font style="vertical-align: inherit;">您可以使用此功能将负载分散到多个目录中。</font><font style="vertical-align: inherit;">用</font></font><code class="literal">:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unix上</font><font style="vertical-align: inherit;">的冒号（</font><font style="vertical-align: inherit;">）和</font></font><code class="literal">;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows上的</font><font style="vertical-align: inherit;">分号（</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">分隔</font><font style="vertical-align: inherit;">路径</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">路径应为位于不同</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘</font><font style="vertical-align: inherit;">上的文件系统中的目录命名
                 </font><font style="vertical-align: inherit;">，而不是同一磁盘上的不同分区中的目录。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="order-by-diagnostic-information"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORDER BY执行计划信息可用</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有了</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN SELECT
            ... ORDER BY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你可以检查MySQL是否可以使用索引来解决查询。</font><font style="vertical-align: inherit;">如果您</font></font><code class="literal">Using filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
             </font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中</font><font style="vertical-align: inherit;">看到它，则不能
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Filesort使用类似于</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎所</font><font style="vertical-align: inherit;">使用的固定长度的行存储格式
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">诸如</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用固定长度存储的</font><font style="vertical-align: inherit;">可变长度类型
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果a </font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成，则
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出包括
             </font></font><code class="literal">Using filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
             </font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中。</font><font style="vertical-align: inherit;">另外，优化器跟踪输出包含一个</font></font><code class="literal">filesort_summary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块。</font><font style="vertical-align: inherit;">例如：
          </font></font></p><pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“filesort_summary”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “行”：100，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “examine_rows”：100，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “number_of_tmp_files”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “sort_buffer_size”：25192，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “sort_mode”：“&lt;sort_key，packed_additional_fields&gt;”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">sort_mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值提供有关使用的</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法和排序缓冲区中的元组内容的信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">&lt;sort_key, rowid&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这表示使用原始算法。</font><font style="vertical-align: inherit;">排序缓冲区元组是包含原始表行的排序键值和行ID的对。</font><font style="vertical-align: inherit;">元组按排序键值进行排序，行ID用于读取表中的行。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">&lt;sort_key, additional_fields&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这表示使用修改后的算法。</font><font style="vertical-align: inherit;">排序缓冲区元组包含查询引用的排序键值和列。</font><font style="vertical-align: inherit;">元组按排序键值排序，列值直接从元组中读取。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">&lt;sort_key,
                packed_additional_fields&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这表示使用修改后的算法。</font><font style="vertical-align: inherit;">排序缓冲区元组包含查询引用的排序键值和打包列。</font><font style="vertical-align: inherit;">元组按排序键值排序，列值直接从元组中读取。
</font></font></p></li></ul>
</div>
<p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不区分使用修改的和内存中（优先级队列）算法。</font><font style="vertical-align: inherit;">在优化器跟踪输出中可以看到使用内存中算法。</font><font style="vertical-align: inherit;">寻找
             </font></font><code class="literal">filesort_priority_queue_optimization</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关优化程序跟踪的信息，请参阅
             </font></font><a class="ulink" href="http://dev.mysql.com/doc/internals/en/optimizer-tracing.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL内部：跟踪优化程序</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="group-by-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.14 GROUP BY优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106067680"></a><a class="indexterm" name="idm140528106066608"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          满足</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          子句</font><font style="vertical-align: inherit;">的最常用方法</font><font style="vertical-align: inherit;">是扫描整个表并创建一个新的临时表，其中每个组的所有行都是连续的，然后使用此临时表来发现组并应用聚合函数（如果有）。</font><font style="vertical-align: inherit;">在某些情况下，MySQL可以做得比这更好，并避免使用索引访问来创建临时表。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用索引的最重要的先决条件
           </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是所有</font></font><code class="literal">GROUP
          BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列都引用来自同一索引的属性，并且索引按顺序存储其键（例如，这是</font></font><code class="literal">BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引而不是
           </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引）。</font><font style="vertical-align: inherit;">是否可以通过索引访问来替换临时表的使用还取决于查询中使用索引的哪些部分，为这些部分指定的条件以及选定的聚合函数。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有两种方法可以</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过索引访问</font><font style="vertical-align: inherit;">来执行</font><font style="vertical-align: inherit;">查询，如以下各节所述。</font><font style="vertical-align: inherit;">在第一种方法中，分组操作与所有范围谓词（如果有的话）一起应用。</font><font style="vertical-align: inherit;">第二种方法首先执行范围扫描，然后对得到的元组进行分组。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL中，</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于排序，因此服务器也可以将</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化应用于分组。</font><font style="vertical-align: inherit;">但是，依靠隐式
           </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排序已被弃用。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-optimization" title="8.2.1.13 ORDER BY优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.13节“按优化排序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#loose-index-scan" title="松散索引扫描"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">松散索引扫描</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#tight-index-scan" title="紧索引扫描"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紧索引扫描</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="loose-index-scan"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">松散索引扫描</font></font></h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140528106051616"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            处理最有效的方法</font></font><code class="literal">GROUP
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是使用索引直接检索分组列。</font><font style="vertical-align: inherit;">使用此访问方法，MySQL使用某些索引类型的属性（例如，</font></font><code class="literal">BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">来对索引进行排序</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该属性支持在索引中使用查找组，而不必考虑索引中满足所有</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件的</font><font style="vertical-align: inherit;">所有键
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此访问方法仅考虑索引中的一部分键，因此称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">松散索引扫描</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当没有</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            子句时，松散索引扫描会读取与组数相同的密钥，这可能比所有密钥的数量少得多。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句包含范围谓词（请参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询"><font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”</font></a><font style="vertical-align: inherit;">中关于</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接类型
             </font><font style="vertical-align: inherit;">的讨论
             </font><font style="vertical-align: inherit;">），宽松索引扫描查找每个组中满足范围条件的第一个键，并再次读取最少的可能密钥数量。</font><font style="vertical-align: inherit;">在以下情况下可以这样做：
</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                查询在一个表上。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一名称构成的指数，没有其他列的最左边的前缀列。</font><font style="vertical-align: inherit;">（如果</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">不是</font><font style="vertical-align: inherit;">具有</font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，则所有不同的属性都指的是构成索引最左边前缀的列。）例如，如果表上
                 </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有索引
                 </font></font><code class="literal">(c1,c2,c3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则松散索引扫描适用于查询</font></font><code class="literal">GROUP BY c1,
                c2,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果查询有</font></font><code class="literal">GROUP BY c2, c3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（列不是最左边的前缀）或</font></font><code class="literal">GROUP BY c1, c2,
                c4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="literal">c4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不在索引中），</font><font style="vertical-align: inherit;">则不适用
                 </font><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                选择列表中使用的唯一聚合函数（如果有的话）是</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_max"><code class="literal">MAX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且它们都指向同一列。</font><font style="vertical-align: inherit;">该列必须位于索引中，并且必须紧跟在列中
                 </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该指数比那些来自的任何其它部分
                 </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询中引用必须是常数（即，它们必须与常量等式来引用），除了的参数
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_max"><code class="literal">MAX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于索引中的列，必须对全列值进行索引，而不仅仅是前缀。</font><font style="vertical-align: inherit;">例如，与
                 </font></font><code class="literal">c1 VARCHAR(20), INDEX (c1(10))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该索引不能用于松散索引扫描。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果松散索引扫描适用于查询，则
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示
             </font></font><code class="literal">Using index for group-by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
             </font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设</font></font><code class="literal">idx(c1,c2,c3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上
             </font><font style="vertical-align: inherit;">有一个索引
             </font></font><code class="literal">t1(c1,c2,c3,c4)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">松散索引扫描访问方法可用于以下查询：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c2 FROM t1 GROUP BY c1，c2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT DISTINCT c1，c2 FROM t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c1，MIN（c2）FROM t1 GROUP BY c1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c1，c2 FROM t1 WHERE c1 &lt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY c1，c2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT MAX（c3），MIN（c3），c1，c2 FROM t1 WHERE c2&gt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY c1，c2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c2 FROM t1 WHERE c1 &lt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY c1，c2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c1，c2 FROM t1 WHERE c3 = </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY c1，c2;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            出于以下原因，使用此快速选择方法无法执行以下查询：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                除了</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
                 </font><font style="vertical-align: inherit;">之外，还有集合函数
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_max"><code class="literal">MAX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，SUM（c2）FROM t1 GROUP BY c1;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">
                的列</font><font style="vertical-align: inherit;">不构成索引的最左边的前缀：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c2 FROM t1 GROUP BY c2，c3;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该查询引用了该部分之后的一个关键字的</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一部分，并且</font><font style="vertical-align: inherit;">该关键字
                 </font><font style="vertical-align: inherit;">与常量不相等：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c3 FROM t1 GROUP BY c1，c2;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果查询包含</font><font style="vertical-align: inherit;">，可以使用松散索引扫描。
</font></font><code class="literal">WHERE c3 =
                <em class="replaceable"><code>const</code></em></code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            松散索引扫描访问方法可以应用于选择列表中其他形式的聚合函数引用，</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_max"><code class="literal">MAX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经支持的引用</font><font style="vertical-align: inherit;">和
             </font><font style="vertical-align: inherit;">引用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/functions.html#function_avg"><code class="literal">AVG(DISTINCT)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sum"><code class="literal">SUM(DISTINCT)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                 </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_count"><code class="literal">COUNT(DISTINCT)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持。</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_avg"><code class="literal">AVG(DISTINCT)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                并</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sum"><code class="literal">SUM(DISTINCT)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">采取一个单一的论点。
                </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_count"><code class="literal">COUNT(DISTINCT)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以有多个列参数。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询中</font><font style="vertical-align: inherit;">
                必须没有</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或有
                 </font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                前面描述的松散扫描限制仍然适用。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设</font></font><code class="literal">idx(c1,c2,c3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上
             </font><font style="vertical-align: inherit;">有一个索引
             </font></font><code class="literal">t1(c1,c2,c3,c4)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">松散索引扫描访问方法可用于以下查询：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（DISTINCT c1），SUM（DISTINCT c1）FROM t1;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT COUNT（DISTINCT c1，c2），COUNT（DISTINCT c2，c1）FROM t1;</font></font><font></font>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="tight-index-scan"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紧索引扫描</font></font></h5>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            严格的索引扫描可能是全索引扫描或范围索引扫描，具体取决于查询条件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当不满足松散索引扫描的条件时，仍可以避免为</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">创建临时表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">有范围条件，则</font><font style="vertical-align: inherit;">此方法只读取满足这些条件的键。</font><font style="vertical-align: inherit;">否则，它会执行索引扫描。</font><font style="vertical-align: inherit;">因为这个方法读取由该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">定义的每个范围内的所有键
             </font><font style="vertical-align: inherit;">，或者如果没有范围条件，则扫描整个索引，所以我们称其为
             </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紧密索引扫描</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用紧密索引扫描时，只有在找到满足范围条件的所有键后才执行分组操作。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了使这种方法起作用，查询中的所有列都有一个常量相等条件就足够了，该条件引用键之前或之间的</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键</font><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">来自相等条件的常量填充</font><font style="vertical-align: inherit;">
            搜索关键字</font><font style="vertical-align: inherit;">中的任何</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">间隙</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以便可以形成索引的完整前缀。</font><font style="vertical-align: inherit;">这些索引前缀可以用于索引查找。</font><font style="vertical-align: inherit;">如果我们需要排序的话
            </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 结果，并且可以形成作为索引前缀的搜索关键字，MySQL也避免了额外的排序操作，因为使用有序索引中的前缀搜索已经按顺序检索所有关键字。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设</font></font><code class="literal">idx(c1,c2,c3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表上
             </font><font style="vertical-align: inherit;">有一个索引
             </font></font><code class="literal">t1(c1,c2,c3,c4)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下查询不适用于前面描述的宽松索引扫描访问方法，但仍然适用于紧凑的索引扫描访问方法。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                有一个差距</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但它是由条件覆盖</font></font><code class="literal">c2 =
                'a'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c2，c3 FROM t1 WHERE c2 ='a'GROUP BY c1，c3;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不与钥匙的第一部分开始，但它提供了该部分恒定的条件：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c2，c3 FROM t1 WHERE c1 ='a'GROUP BY c2，c3;
</font></font></pre></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="distinct-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.15 DISTINCT优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105966640"></a><a class="indexterm" name="idm140528105965568"></a><p>
          <code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联合</font></font><code class="literal">ORDER
          BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要一个临时表在许多情况下。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因为</font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会使用</font></font><code class="literal">GROUP
          BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请学习MySQL如何处理
           </font><font style="vertical-align: inherit;">
          不属于选定列的列</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#group-by-handling" title="12.19.3 MySQL处理GROUP BY"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.19.3节“MySQL处理GROUP BY”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在大多数情况下，一个</font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款可以被认为是一个特例</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，以下两个查询是等同的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT DISTINCT c1，c2，c3 FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
哪里c1&gt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c1，c2，c3 FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE c1&gt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY c1，c2，c3;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          由于这种等价性，适用于</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">的优化
           </font><font style="vertical-align: inherit;">也可以应用于具有</font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的</font><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，有关</font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">优化可能性的更多细节
           </font><font style="vertical-align: inherit;">，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#group-by-optimization" title="8.2.1.14 GROUP BY优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.14节“GROUP BY优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          结合</font><font style="vertical-align: inherit;">使用时
           </font><font style="vertical-align: inherit;">，只要发现</font><font style="vertical-align: inherit;">唯一行</font><font style="vertical-align: inherit;">，MySQL就会停下来
           </font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">LIMIT
          <em class="replaceable"><code>row_count</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>row_count</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您不使用查询中命名的所有表中的列，那么MySQL一找到第一个匹配就立即停止扫描任何未使用的表。</font><font style="vertical-align: inherit;">在下面的情况下，假设
           </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前使用过</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          （可以检查
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），MySQL </font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到第一行时</font><font style="vertical-align: inherit;">停止读取</font><font style="vertical-align: inherit;">（对于任何特定行
           </font><font style="vertical-align: inherit;">）
           </font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT DISTINCT t1.a FROM t1，t2其中t1.a = t2.a;
</font></font></pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="limit-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.16限制查询优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105940368"></a><a class="indexterm" name="idm140528105938912"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您只需要结果集中指定数量的行，请</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询中</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">子句，而不是获取整个结果集并丢弃额外的数据。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL有时会优化具有</font><font style="vertical-align: inherit;">子句和无
           </font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">的查询</font><font style="vertical-align: inherit;">：
</font></font><code class="literal">LIMIT
          <em class="replaceable"><code>row_count</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">HAVING</code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果你只选择几行
               </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MySQL在某些情况下会使用索引，通常情况下它会倾向于执行全表扫描。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果结合</font><font style="vertical-align: inherit;">使用
               </font><font style="vertical-align: inherit;">，MySQL的停止，因为已经找到了第尽快排序
               </font><font style="vertical-align: inherit;">排序结果的行，而不是排序整个结果。</font><font style="vertical-align: inherit;">如果使用索引完成排序，则速度非常快。</font><font style="vertical-align: inherit;">如果必须完成一个文件夹，那么</font><font style="vertical-align: inherit;">选择与</font><font style="vertical-align: inherit;">没有该</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">的查询相匹配的所有行</font><font style="vertical-align: inherit;">，并且在</font><font style="vertical-align: inherit;">找到</font><font style="vertical-align: inherit;">第一个之前，大部分或全部都是排序的
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在找到最初的行后，MySQL不会对结果集的任何其余部分进行排序。
            </font></font><code class="literal">LIMIT
              <em class="replaceable"><code>row_count</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>row_count</code></em><font style="vertical-align: inherit;"></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>row_count</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这种行为的一种表现是，</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有和不</font><font style="vertical-align: inherit;">带有
               </font><font style="vertical-align: inherit;">查询的查询
               </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会按照不同的顺序返回行，如本节后面所述。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果结合</font><font style="vertical-align: inherit;">使用
               </font><font style="vertical-align: inherit;">，MySQL只要找到</font><font style="vertical-align: inherit;">唯一行</font><font style="vertical-align: inherit;">就会停下来</font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">LIMIT
              <em class="replaceable"><code>row_count</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>row_count</code></em><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在某些情况下，</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过按顺序读取索引（或对索引进行排序），然后计算摘要直到索引值发生更改来解决。</font><font style="vertical-align: inherit;">在这种情况下，</font><font style="vertical-align: inherit;">不计算任何不必要的</font><font style="vertical-align: inherit;">
              值。
            </font></font><code class="literal">LIMIT
              <em class="replaceable"><code>row_count</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <a class="indexterm" name="idm140528105918240"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

              只要MySQL已将所需数量的行发送到客户端，它会中止查询，除非您正在使用
               </font></font><code class="literal">SQL_CALC_FOUND_ROWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，行数可以通过检索</font></font><code class="literal">SELECT
              FOUND_ROWS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#information-functions" title="12.14信息功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.14节“信息功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">LIMIT 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速返回一个空集。</font><font style="vertical-align: inherit;">这对于检查查询的有效性很有用。</font><font style="vertical-align: inherit;">还可以使用它来获取使用可使结果集元数据可用的MySQL API的应用程序中结果列的类型。</font><font style="vertical-align: inherit;">使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端程序，您可以使用该
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_column-type-info"><code class="option">--column-type-info</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来显示结果列类型。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果服务器使用临时表来解析查询，它将使用该</font><font style="vertical-align: inherit;">子句来计算需要多少空间。
            </font></font><code class="literal">LIMIT
              <em class="replaceable"><code>row_count</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果索引不用于</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              但</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句也存在，则优化程序可能能够避免使用合并文件并使用内存中</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">对内存中的行进行排序
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关详细信息，请参阅
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-filesort-in-memory" title="内存中的文件排列算法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中的filesort算法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果多个行在列中具有相同的值</font></font><code class="literal">ORDER
          BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则服务器可以按任意顺序自由返回这些行，并且根据总体执行计划可能会有所不同。</font><font style="vertical-align: inherit;">换句话说，这些行的排序顺序对于无序列是非确定性的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          影响执行计划的一个因素是
           </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有和没有</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">查询</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会以不同的顺序返回行。</font><font style="vertical-align: inherit;">考虑这个查询，该</font></font><code class="literal">category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">按</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">排序，</font><font style="vertical-align: inherit;">但</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">列</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">rating</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">不确定</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM ratings ORDER BY category;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">类别| </font><font style="vertical-align: inherit;">评级|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">5.0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          包括</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会影响每个</font></font><code class="literal">category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">内的行的顺序</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，这是一个有效的查询结果：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM ratings ORDER BY category LIMIT 5;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">类别| </font><font style="vertical-align: inherit;">评级|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在每种情况下，行都按列进行排序</font></font><code class="literal">ORDER
          BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是SQL标准所需的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果确保有和没有相同的行顺序很重要，请</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">包含其他列</font><font style="vertical-align: inherit;">以使订单具有确定性。</font><font style="vertical-align: inherit;">例如，如果</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是唯一的，则可以按照如下</font><font style="vertical-align: inherit;">顺序排列</font><font style="vertical-align: inherit;">给定</font></font><code class="literal">category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的
           </font><font style="vertical-align: inherit;">行
           </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM ratings ORDER BY category, id;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">类别| </font><font style="vertical-align: inherit;">评级|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">5.0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM ratings ORDER BY category, id LIMIT 5;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">类别| </font><font style="vertical-align: inherit;">评级|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="function-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.17函数调用优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105882352"></a><a class="indexterm" name="idm140528105880880"></a><a class="indexterm" name="idm140528105879376"></a><a class="indexterm" name="idm140528105877872"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL函数在内部被标记为确定性或非确定性。</font><font style="vertical-align: inherit;">如果给定参数的固定值，它可以为不同的调用返回不同的结果，函数是非确定性的。</font><font style="vertical-align: inherit;">的非确定性函数的示例：
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid"><code class="literal">UUID()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果函数被标记为非确定性，则在</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个行（从一个表中选择时）或行的组合（在从多表连接中选择时）下</font><font style="vertical-align: inherit;">，对子</font><font style="vertical-align: inherit;">句中</font><font style="vertical-align: inherit;">的引用进行</font><font style="vertical-align: inherit;">评估。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL还根据参数类型确定何时评估函数，参数是表列还是常量值。</font><font style="vertical-align: inherit;">只要该列更改值，就必须评估以表列作为参数的确定性函数。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          非确定性函数可能会影响查询性能。</font><font style="vertical-align: inherit;">例如，某些优化可能不可用，或者可能需要更多的锁定。</font><font style="vertical-align: inherit;">以下讨论使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但也适用于其他非确定性功能。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设一张表</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有这样的定义：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t（id INT NOT NULL PRIMARY KEY，col_a VARCHAR（100））;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          考虑这两个查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t WHERE id = POW（1,2）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t WHERE id = FLOOR（1 + RAND（）* 49）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这两个查询似乎都使用主键查找，因为与主键的比较相等，但仅在第一个查询中才是如此：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              第一个查询总是最多生成一行，因为</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_pow"><code class="literal">POW()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用常量参数是一个常数值并用于索引查找。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              第二个查询包含一个使用非确定性函数的表达式，该函数
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询中不是常量，但实际上每个表的行都有一个新值</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，查询读取表的每一行，评估每行的谓词，并输出主键与随机值匹配的所有行。</font><font style="vertical-align: inherit;">这可能是零个，一个或多个行，具体取决于
               </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值和</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序列中</font><font style="vertical-align: inherit;">的值
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          非确定性的影响不限于
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">陈述。</font><font style="vertical-align: inherit;">该
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句使用非确定性函数来选择要修改的行：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE t SET col_a = </font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE id = FLOOR（1 + RAND（）* 49）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          据推测，其意图是至多更新主键与表达式匹配的单个行。</font><font style="vertical-align: inherit;">但是，它可能会更新零个，一个或多个行，具体取决于
           </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值和</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序列中</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          刚刚描述的行为对性能和复制有影响：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于非确定性函数不会生成常量值，因此优化程序无法使用可能适用的策略，如索引查找。</font><font style="vertical-align: inherit;">结果可能是表扫描。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 可能会升级到范围键锁而不是为一个匹配行取单行锁。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              未确定执行的更新对复制不安全。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          困难源于这样一个事实，即该
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数对表的每一行都进行一次评估。</font><font style="vertical-align: inherit;">要避免多个功能评估，请使用以下技术之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将包含非确定性函数的表达式移动到单独的语句中，并将该值保存在变量中。</font><font style="vertical-align: inherit;">在原始语句中，将表达式替换为对变量的引用，优化程序可将其视为常量值：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @keyval = FLOOR（1 + RAND（）* 49）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE t SET col_a = </font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE id = @keyval;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将随机值分配给派生表中的变量。</font><font style="vertical-align: inherit;">该技术在变量被用于</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款</font><font style="vertical-align: inherit;">中的比较之前会使变量被赋值一次
               </font><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='derived_merge = off';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE t，（SELECT @keyval：= FLOOR（1 + RAND（）* 49））AS dt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET col_a = </font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE id = @keyval;
</font></font></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如前所述，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">的不确定表达式
           </font><font style="vertical-align: inherit;">可能会阻止优化并导致表扫描。</font><font style="vertical-align: inherit;">但是，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果其他表达式是确定性的</font><font style="vertical-align: inherit;">，则可以部分优化该</font><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t WHERE partial_key = 5 AND some_column = RAND（）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果优化器可以</font></font><code class="literal">partial_key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用来减少选定的行集合，
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则执行次数会减少，这会减少非确定性对优化的影响。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="row-constructor-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.18行构造器表达式优化</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105830864"></a><a class="indexterm" name="idm140528105829376"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          行构造函数允许同时比较多个值。</font><font style="vertical-align: inherit;">例如，这两个语句在语义上是等效的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE（column1，column2）=（1,1）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1 WHERE column1 = 1 AND column2 = 1;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          另外，优化器也以相同的方式处理两个表达式。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果行构造器列不包含索引的前缀，则优化器不太可能使用可用索引。</font><font style="vertical-align: inherit;">考虑下面的表格，它有一个主键
           </font></font><code class="literal">(c1, c2, c3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  c1 INT，c2 INT，c3 INT，c4 CHAR（100），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  主键（c1，c2，c3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在此查询中，该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句使用索引中的所有列。</font><font style="vertical-align: inherit;">但是，行构造函数本身不包含索引前缀，结果是优化器仅使用</font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="literal">key_len=4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，的大小</font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM t1</code></strong>
       <strong class="userinput"><code>WHERE c1=1 AND (c2,c3) &gt; (1,1)\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：主键</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：在哪里使用</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下，使用等效的非构造函数表达式重写行构造函数表达式可能会导致更完整的索引使用。</font><font style="vertical-align: inherit;">对于给定的查询，行构造函数和等价的非构造函数表达式是：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（c2，c3）&gt;（1,1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c2&gt; 1 OR（（c2 = 1）AND（c3&gt; 1））</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          重写查询以使用非构造函数表达式会导致优化器使用索引（</font></font><code class="literal">key_len=12</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">中的所有三列</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM t1</code></strong>
       <strong class="userinput"><code>WHERE c1 = 1 AND (c2 &gt; 1 OR ((c2 = 1) AND (c3 &gt; 1)))\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：主键</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：12</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：在哪里使用</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因此，为了获得更好的结果，请避免将行构造函数与</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表达式</font><font style="vertical-align: inherit;">混合
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用一个或另一个。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在某些情况下，优化器可以将范围访问方法应用于</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          具有行构造函数参数的表达式。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#row-constructor-range-optimization" title="行构造器表达式的范围优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行构造函数表达式的范围优化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="table-scan-avoidance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1.19避免全表扫描</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105804976"></a><a class="indexterm" name="idm140528105803520"></a><a class="indexterm" name="idm140528105802032"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL使用</font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_full_table_scan" title="全表扫描"><font style="vertical-align: inherit;">全表扫描</font></a><font style="vertical-align: inherit;">来解析查询</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">，
           </font><font style="vertical-align: inherit;">列中
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示
           </font><font style="vertical-align: inherit;">
          的输出</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这通常发生在下列条件下：
</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"></font><code class="literal">type</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_full_table_scan" title="全表扫描"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该表非常小，执行表扫描的速度要快于查找关键字的速度。</font><font style="vertical-align: inherit;">这对于行数少于10行且行长度较短的表很常见。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引列</font><font style="vertical-align: inherit;">
              的</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">中没有可用限制
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您正在将索引列与常量值进行比较，并且MySQL已经计算（基于索引树）常量覆盖了表的一部分，并且表扫描速度会更快。</font><font style="vertical-align: inherit;">参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#where-optimization" title="8.2.1.1 WHERE子句优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.1节“WHERE子句优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您正在通过另一列使用基数较低的键（许多行与键值匹配）。</font><font style="vertical-align: inherit;">在这种情况下，MySQL假设通过使用密钥，它可能会执行许多密钥查找，并且表扫描会更快。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于小型表格，表格扫描通常是合适的，对性能的影响可以忽略不计。</font><font style="vertical-align: inherit;">对于大型表格，请尝试以下技巧以避免优化器错误地选择表格扫描：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font><font style="vertical-align: inherit;">更新的扫描表的键分布。</font><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><font style="vertical-align: inherit;">第13.7.2.1节“ANALYZE TABLE语法”</font></a><font style="vertical-align: inherit;">。
            </font></font><code class="literal">ANALYZE TABLE
              <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font></font><code class="literal">FORCE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描表来告诉MySQL，与使用给定索引相比，表扫描非常昂贵：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1，t2 FORCE INDEX（</font></font><em class="replaceable"><code>index_for_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1。</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= T2。</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-hints" title="8.9.4索引提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.4节“索引提示”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该</font><font style="vertical-align: inherit;">
              选项</font><font style="vertical-align: inherit;">
              启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_seeks_for_key"><code class="option">--max-seeks-for-key=1000</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者使用</font></font><code class="literal">SET
              max_seeks_for_key=1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它告诉优化器假定没有键扫描会导致超过1,000个密钥查找。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="subquery-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2优化子查询，派生表和视图引用</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#semi-joins"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2.1使用半连接变换优化子查询，派生表和视图引用</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#subquery-materialization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2.2使用物化优化子查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#derived-table-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2.3优化派生表和视图引用</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#subquery-optimization-with-exists"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2.4使用EXISTS策略优化子查询</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528105775152"></a><a class="indexterm" name="idm140528105773696"></a><a class="indexterm" name="idm140528105772208"></a><a class="indexterm" name="idm140528105770720"></a><a class="indexterm" name="idm140528105769232"></a><a class="indexterm" name="idm140528105767744"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL查询优化器有不同的策略来评估子查询。</font><font style="vertical-align: inherit;">对于</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
         </font></font><code class="literal">=ANY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）子查询，优化器可以有以下选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            半连接
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            实体化
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 战略
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><code class="literal">NOT IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
         </font></font><code class="literal">&lt;&gt;ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）子查询，优化器可以有以下选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            实体化
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 战略
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于派生表（</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        子句中的</font><font style="vertical-align: inherit;">子查询</font><font style="vertical-align: inherit;">），优化器具有以下选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将派生表合并到外部查询块中
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将派生表物化为内部临时表
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于视图引用，优化器具有与派生表相同的选择。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下讨论提供了有关上述优化策略的更多信息。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用子查询修改单个表</font><font style="vertical-align: inherit;">
          的限制</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句是，优化器不使用半连接或实现子查询优化。</font><font style="vertical-align: inherit;">作为一种解决方法，尝试将它们重写为</font><font style="vertical-align: inherit;">使用连接而不是子查询的</font><font style="vertical-align: inherit;">多表
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="semi-joins"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2.1使用半连接变换优化子查询，派生表和视图引用</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528105744576"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如本节所述，优化器使用半连接策略来改善子查询的执行。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于两个表之间的内部联接，联接会从一个表中返回一个行，其数量与另一个表中的匹配次数相同。</font><font style="vertical-align: inherit;">但是对于一些问题，唯一重要的信息是是否有匹配，而不是匹配的数量。</font><font style="vertical-align: inherit;">假设</font><font style="vertical-align: inherit;">在课程表和课程名册（分别在每个班级注册的学生）中分别</font><font style="vertical-align: inherit;">有表名
           </font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">roster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表类。</font><font style="vertical-align: inherit;">要列出真正让学生注册的课程，您可以使用以下连接：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT class.class_num，class.class_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM类INNER JOIN名单</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE class.class_num = roster.class_num;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          但是，结果会为每个已注册的学生列出每个课程一次。</font><font style="vertical-align: inherit;">对于被问到的问题，这是不必要的重复信息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设这</font></font><code class="literal">class_num</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的主键，</font><font style="vertical-align: inherit;">则可以通过使用重复抑制
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT
          DISTINCT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是先生成所有匹配的行，以便稍后消除重复项是低效的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用子查询可以获得相同的无重复结果：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT class_num，class_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM类</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE class_num IN（SELECT class_num FROM roster）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这里，优化器可以识别出该
           </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句要求子查询仅从</font></font><code class="literal">roster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">返回每个类号的一个实例
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，查询可以使用</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半连接</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">也就是说，仅返回一个中的每一行的实例的操作
           </font></font><code class="literal">class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由按行匹配
           </font></font><code class="literal">roster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          外连接和内连接语法在外部查询规范中是允许的，并且表引用可以是基表，派生表或视图引用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL中，子查询必须满足这些条件才能作为半连接进行处理：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它必须是</font><font style="vertical-align: inherit;">出现在</font><font style="vertical-align: inherit;">or
               </font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">顶部</font><font style="vertical-align: inherit;">的</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
               </font></font><code class="literal">=ANY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）子查询</font><font style="vertical-align: inherit;">，可能是</font><font style="vertical-align: inherit;">表达式中的</font><font style="vertical-align: inherit;">一个术语
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
            </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"></font><code class="literal">ON</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM ot1，...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE（oe1，...）IN（SELECT ie1，... FROM it1，... WHERE ...）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这里，</font><font style="vertical-align: inherit;">
              和</font><font style="vertical-align: inherit;">
              表示在该查询的外侧和内侧的部分表，和
               </font><font style="vertical-align: inherit;">与
               </font><font style="vertical-align: inherit;">
              表示参照列中的外和内表中的表达式。
            </font></font><code class="literal">ot_<em class="replaceable"><code>i</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">it_<em class="replaceable"><code>i</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">oe_<em class="replaceable"><code>i</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">ie_<em class="replaceable"><code>i</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它必须是一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造</font><font style="vertical-align: inherit;">的单个</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它不得包含一个</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font><font style="vertical-align: inherit;">一个</font></font><code class="literal">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它不能被隐式分组（它不能包含聚合函数）。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它不能</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
               </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该语句不得</font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在外部查询中</font><font style="vertical-align: inherit;">使用
               </font><font style="vertical-align: inherit;">连接类型。
            </font></font></p><a class="indexterm" name="idm140528105707936"></a></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改必须不存在。
            </font></font></p><a class="indexterm" name="idm140528105704880"></a></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              外部和内部表格的数量必须小于连接中允许的最大表格数量。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          子查询可能相关或不相关。
          </font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被允许，
           </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除非</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也被使用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果一个子查询符合上述标准，MySQL会将其转换为半连接，并根据这些策略进行基于成本的选择：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将子查询转换为连接，或者使用表拉出并将查询作为子查询表和外部表之间的内部连接运行。</font><font style="vertical-align: inherit;">表拉出从子查询中拉出一个表到外部查询。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              Duplicate Weedout：运行半连接，就像它是一个连接一样，并使用临时表删除重复的记录。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              FirstMatch：当为行组合扫描内部表格并且存在给定值组的多个实例时，选择一个而不是全部返回它们。</font><font style="vertical-align: inherit;">这种“快捷方式”扫描并消除了不必要的行的产生。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LooseScan：使用能够从每个子查询的值组中选择单个值的索引来扫描子查询表。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将子查询实现为一个索引临时表，用于执行联接，其中索引用于删除重复项。</font><font style="vertical-align: inherit;">当用外表连接临时表时，该索引也可能稍后用于查找; </font><font style="vertical-align: inherit;">如果不是，则扫描该表格。</font><font style="vertical-align: inherit;">有关实现的更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#subquery-materialization" title="8.2.2.2使用物化优化子查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.2节“使用实现优化子查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用以下</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量标志</font><font style="vertical-align: inherit;">可以启用或禁用这些策略中的每一个</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">semijoin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志控制是否使用半连接。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><code class="literal">semijoin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使能，
               </font></font><code class="literal">firstmatch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">loosescan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">duplicateweedout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><code class="literal">materialization</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旗帜能够在允许的半连接策略更精细的控制。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><code class="literal">duplicateweedout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用半连接策略，则不会使用半连接策略，除非所有其他适用的策略也被禁用。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><code class="literal">duplicateweedout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被禁用，则有时优化器可能会生成一个远离最佳状态的查询计划。</font><font style="vertical-align: inherit;">这发生在贪婪搜索期间的启发式修剪，可以通过设置来避免
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_prune_level"><code class="literal">optimizer_prune_level=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些标志默认是启用的。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器最大限度地减少了处理视图和派生表的不同之处（</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          子句中的</font><font style="vertical-align: inherit;">子查询</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这会影响使用
           </font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修饰符的</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">和带有</font><font style="vertical-align: inherit;">可以转换为半连接</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子查询</font><font style="vertical-align: inherit;">的视图
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下查询对此进行了说明，因为处理中的更改会导致转换发生更改，从而产生不同的执行策略：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE VIEW v AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从t1开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE IN（选择b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           FROM t2）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT STRAIGHT_JOIN *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM t3 JOIN v ON t3.x = va;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器首先查看视图并将
           </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询转换为半连接，然后检查是否可以将视图合并到外部查询中。</font><font style="vertical-align: inherit;">由于</font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部查询中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">修饰符阻止了半连接，因此优化器会拒绝合并，从而导致使用物化表进行派生表评估。
        </font></font></p><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 输出表示使用半连接策略如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              半连接表显示在外部选择中。</font><font style="vertical-align: inherit;">对于扩展</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出，以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示</font><font style="vertical-align: inherit;">的文本显示
               </font><font style="vertical-align: inherit;">重写的查询，该查询显示半连接结构。</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-extended" title="8.8.3扩展的EXPLAIN输出格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.3节“扩展EXPLAIN输出格式”）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。由此您可以了解哪些表已从半连接中移出。</font><font style="vertical-align: inherit;">如果子查询转换为半连接，则会看到子查询谓词已消失，并将其表和</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句合并到外部查询连接列表和
               </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于重复Weedout临时表的使用是由指示
               </font></font><code class="literal">Start temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">End
              temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              列。</font><font style="vertical-align: inherit;">那些没有拉出表是在范围内</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所涵盖的输出行</font></font><code class="literal">Start temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
               </font></font><code class="literal">End temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有自己
               </font></font><code class="literal">rowid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的临时表。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">FirstMatch(<em class="replaceable"><code>tbl_name</code></em>)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中指示加入快捷方式。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">LooseScan(<em class="replaceable"><code>m</code></em>..<em class="replaceable"><code>n</code></em>)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中指示使用LooseScan策略。</font></font><em class="replaceable"><code>m</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
               </font></font><em class="replaceable"><code>n</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是关键部件号码。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为物化临时表的使用是通过行与所指示</font></font><code class="literal">select_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
               </font></font><code class="literal">MATERIALIZED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和行用
               </font></font><code class="literal">table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值
               </font><font style="vertical-align: inherit;">。
</font></font><code class="literal">&lt;subquery<em class="replaceable"><code>N</code></em>&gt;</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="subquery-materialization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2.2使用物化优化子查询</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105645664"></a><a class="indexterm" name="idm140528105644624"></a><a class="indexterm" name="idm140528105643136"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器使用实现来实现更高效的子查询处理。</font><font style="vertical-align: inherit;">实体化通过生成子查询结果作为临时表（通常在内存中）来加速查询的执行。</font><font style="vertical-align: inherit;">MySQL第一次需要子查询结果时，它将结果转化为一个临时表。</font><font style="vertical-align: inherit;">随后的任何时候都需要结果，MySQL再次引用临时表。</font><font style="vertical-align: inherit;">优化器可以使用散列索引来索引表以使查找快速并且便宜。</font><font style="vertical-align: inherit;">索引是唯一的，它消除了重复并使表格变小。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          子查询实现尽可能使用内存中的临时表，如果表过大，则回退到磁盘存储。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-temporary-tables" title="8.4.4在MySQL中使用内部临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果未使用实例化，则优化器有时会将不相关的子查询重写为相关的子查询。</font><font style="vertical-align: inherit;">例如，以下</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询是不相关的（</font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          仅涉及来自</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和不
           </font><font style="vertical-align: inherit;">来自列的列</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE t1.a IN（SELECT t2.b FROM t2 WHERE </font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器可能会将其重写为
           </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关的子查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE EXISTS（SELECT t2.b FROM t2 WHERE </font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and t1.a = t2.b）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用临时表的子查询实现避免了这样的重写，并且使得可以仅对外部查询的每行执行一次子查询而不是执行一次。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了在MySQL中使用子查询实现，
           </font><font style="vertical-align: inherit;">必须启用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font><code class="literal">materialization</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志。</font><font style="vertical-align: inherit;">（参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节，“切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。随着</font></font><code class="literal">materialization</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用的标志，物化适用于子查询任何地方出现谓词（在选择列表中，</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），对于属于任何这些用例谓词：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              谓词有这种形式，当没有外部表达式
               </font></font><em class="replaceable"><code>oe_i</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或内部表达式可以
               </font></font><em class="replaceable"><code>ie_i</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空时。
              </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是1或更大。
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>oe_2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...，</font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）[NOT] IN（SELECT </font></font><em class="replaceable"><code>ie_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>i_2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...）
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              谓词有这种形式，当有一个外部表达式</font></font><em class="replaceable"><code>oe</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和内部表达式时</font></font><em class="replaceable"><code>ie</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">表达式可以为空。
            </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>oe</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NOT] IN（SELECT </font></font><em class="replaceable"><code>ie</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...）
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              谓词是</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">NOT
              IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">UNKNOWN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的结果</font><font style="vertical-align: inherit;">具有与结果相同的含义</font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下示例说明了如何使用等式</font></font><code class="literal">UNKNOWN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谓词评估</font><font style="vertical-align: inherit;">的要求</font><font style="vertical-align: inherit;">影响是否可以使用子查询实现。</font><font style="vertical-align: inherit;">假定
           </font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只涉及来自列的列</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          能使子查询不相关。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此查询需要实现：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE t1.a IN（SELECT t2.b FROM t2 WHERE </font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这里，</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          谓词返回</font></font><code class="literal">UNKNOWN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还是
           </font><font style="vertical-align: inherit;">无关紧要</font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">无论哪种方式，</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询结果中都不包含</font><font style="vertical-align: inherit;">该行
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不使用子查询实现的示例是以下查询，其中</font></font><code class="literal">t2.b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是可空列：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE（t1.a，t1.b）NOT IN（SELECT t2.a，t2.b FROM t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          WHERE </font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下限制适用于使用子查询实现：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              内部和外部表达式的类型必须匹配。</font><font style="vertical-align: inherit;">例如，如果两个表达式都是整数或两者都是十进制，则优化器可能能够使用实现，但如果一个表达式是整数而另一个是十进制，则优化器可能无法使用实现。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              内在的表达不能是一个
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询的使用提供了优化器是否使用子查询实现的一些指示。</font><font style="vertical-align: inherit;">与不使用实现的查询执行相比，</font></font><code class="literal">select_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可能会更改</font></font><code class="literal">DEPENDENT SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为
           </font></font><code class="literal">SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这表明，对于每个外部行将执行一次的子查询，实现使子查询只执行一次。</font><font style="vertical-align: inherit;">另外，对于扩展
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出，以下显示的文本</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW
          WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font><code class="literal">materialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">materialized-subquery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="derived-table-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2.3优化派生表和视图引用</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105584016"></a><a class="indexterm" name="idm140528105582528"></a><a class="indexterm" name="idm140528105581040"></a><a class="indexterm" name="idm140528105579552"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器可以</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用两种策略</font><font style="vertical-align: inherit;">处理派生表（</font><font style="vertical-align: inherit;">子句中的</font><font style="vertical-align: inherit;">子查询
           </font><font style="vertical-align: inherit;">）引用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将派生表合并到外部查询块中
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将派生表物化为内部临时表
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器使用相同的策略来处理视图引用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例1：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM（SELECT * FROM t1）AS derived_t1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过合并，该查询执行类似于：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例2：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM t1 JOIN（SELECT t2.f1 FROM t2）AS derived_t2 ON t1.f2 = derived_t2.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE t1.f1&gt; 0;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过合并，该查询执行类似于：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT t1。*，t2.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM t1 JOIN t2 ON t1.f2 = t2.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE t1.f1&gt; 0;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          具体化，</font></font><code class="literal">derived_t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
           </font></font><code class="literal">derived_t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在各自的查询中作为单独的表处理。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器以相同的方式处理派生表和视图引用：它尽可能地避免了不必要的实现，这使得从外部查询到派生表的条件被推下来并产生更高效的执行计划。</font><font style="vertical-align: inherit;">（有关示例，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#subquery-materialization" title="8.2.2.2使用物化优化子查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.2节“使用实现优化子查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果合并会导致引用超过61个基表的外部查询块，那么优化器会选择实现。
        </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果这些条件都为真</font><font style="vertical-align: inherit;">
          ，则优化器会将</font><font style="vertical-align: inherit;">派生表或视图引用中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">传播</font><font style="vertical-align: inherit;">到外部查询块：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              外部查询未分组或汇总。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              外部查询不指定
               </font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              外部查询具有此派生表或视图引用作为</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">唯一的源</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          否则，优化器会忽略该</font></font><code class="literal">ORDER
          BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下方法可用于影响优化程序是否尝试合并派生表并将查看引用查看到外部查询块中：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用系统变量</font><font style="vertical-align: inherit;">
              的</font></font><code class="literal">derived_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，假定没有其他规则会阻止合并。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，该标志被启用以允许合并。</font><font style="vertical-align: inherit;">禁用该标志可防止合并并避免
               </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_update_table_used"><code class="literal">ER_UPDATE_TABLE_USED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              错误。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">derived_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志也适用于不包含</font></font><code class="literal">ALGORITHM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的</font><font style="vertical-align: inherit;">视图</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_update_table_used"><code class="literal">ER_UPDATE_TABLE_USED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用等效于子查询的表达式的视图引用发生错误，则添加
               </font></font><code class="literal">ALGORITHM=TEMPTABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到视图定义将防止合并并优先于该
               </font></font><code class="literal">derived_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可以通过在子查询中使用任何阻止合并的构造来禁用合并，尽管这些构造对于实现的影响并不明确。</font><font style="vertical-align: inherit;">对于派生表和视图引用，阻止合并的构造是相同的：
</font></font></p>
<div class="itemizedlist">
<a class="indexterm" name="idm140528105544192"></a><a class="indexterm" name="idm140528105542736"></a><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  聚合函数（</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sum"><code class="literal">SUM()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                   </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                   </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_max"><code class="literal">MAX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                   </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_count"><code class="literal">COUNT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，等等）
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">DISTINCT</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">GROUP BY</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">HAVING</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">LIMIT</code>
                </p></li><li class="listitem"><p>
                  <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 要么
                  </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION
                  ALL</code></a>
                </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  子选择列表中的子查询
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  分配给用户变量
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  仅参考文字值（在这种情况下，不存在基础表）
</font></font></p></li></ul>
</div>
</li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">derived_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志也适用于不包含</font></font><code class="literal">ALGORITHM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的</font><font style="vertical-align: inherit;">视图</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，如果
           </font></font><a class="link" href="/mysql-5.7-google-zh/error-handling.html#error_er_update_table_used"><code class="literal">ER_UPDATE_TABLE_USED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用等效于子查询的表达式的视图引用发生错误，则添加</font></font><code class="literal">ALGORITHM=TEMPTABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          到视图定义将防止合并并优先于当前</font></font><code class="literal">derived_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果优化器选择实现策略而不是合并派生表，它将按如下方式处理查询：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              优化器推迟派生表实现，直到查询执行期间需要其内容为止。</font><font style="vertical-align: inherit;">这可以提高性能，因为延迟实现可能导致根本无需执行此操作。</font><font style="vertical-align: inherit;">考虑将派生表结果连接到另一个表的查询：如果优化器首先处理其他表，并且发现它不返回任何行，则不需要进一步执行连接，并且优化器可以完全忽略派生表的实现。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在查询执行期间，优化程序可能会将索引添加到派生表中以加快从其中检索行。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          考虑以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句，子查询出现在查询的
           </font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN SELECT * FROM（SELECT * FROM t1）AS derived_t1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器通过延迟它来避免实现子查询，直到</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">期间需要结果为止
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，查询不会被执行（因为它发生在一个
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中），所以结果是不需要的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          即使对于执行的查询，延迟子查询实现可能会使优化器完全避免实现。</font><font style="vertical-align: inherit;">发生这种情况时，执行实现所需的时间会更快地执行查询。</font><font style="vertical-align: inherit;">考虑下面的查询，它将子查询的结果连接</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到另一个表中：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM t1 JOIN（SELECT t2.f1 FROM t2）AS derived_t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ON t1.f2 = derived_t2.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE t1.f1&gt; 0;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果优化过程</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一次，并且</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句产生空结果，则联接必须为空，并且子查询不必实现。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于派生表需要实现的情况，优化器可以向物化表添加索引以加速对其的访问。</font><font style="vertical-align: inherit;">如果这样的索引允许
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问表，那么可以大大减少查询执行期间读取的数据量。</font><font style="vertical-align: inherit;">考虑以下查询：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 FROM t1 JOIN（SELECT DISTINCT f1 FROM t2）AS derived_t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         ON t1.f1 = derived_t2.f1;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器</font></font><code class="literal">f1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font><font style="vertical-align: inherit;">列构建索引
           </font><font style="vertical-align: inherit;">，</font></font><code class="literal">derived_t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果这样做可以使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问权限来实现最低成本的执行计划。</font><font style="vertical-align: inherit;">在添加索引之后，优化器可以将物化派生表与具有索引的常规表一样对待，并且与生成的索引类似。</font><font style="vertical-align: inherit;">与没有索引的查询执行成本相比，索引创建的开销可以忽略不计。</font><font style="vertical-align: inherit;">如果
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问会导致比其他访问方法更高的成本，那么优化器不会创建任何索引并且不会丢失任何内容。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于优化器跟踪输出，合并的派生表或视图引用不会显示为节点。</font><font style="vertical-align: inherit;">只有其基础表出现在顶部查询的计划中。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="subquery-optimization-with-exists"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2.4使用EXISTS策略优化子查询</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105493264"></a><a class="indexterm" name="idm140528105491776"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          某些优化适用于使用</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或</font></font><code class="literal">=ANY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）运算符来测试子查询结果的比较。</font><font style="vertical-align: inherit;">本节讨论这些优化，特别是关于</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的问题。</font><font style="vertical-align: inherit;">讨论的最后部分建议你如何帮助优化器。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          考虑下面的子查询比较：
        </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从... </font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL的评估查询</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从外到内。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          也就是说，它首先获取外部表达式的值
           </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后运行子查询并捕获它生成的行。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个非常有用的优化是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询，唯一感兴趣的行是那些内部表达式</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于的行</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是通过向子查询的</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">按下适当的等式</font><font style="vertical-align: inherit;">来实现</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">，从而使其更具限制性。</font><font style="vertical-align: inherit;">转换后的比较如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（SELECT 1 FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在转换之后，MySQL可以使用下推的相等性来限制为评估子查询必须检查的行数。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          更一般地说，将</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值与一个返回</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-value行</font><font style="vertical-align: inherit;">的子查询
           </font><font style="vertical-align: inherit;">进行比较</font><font style="vertical-align: inherit;">会受到相同的转换。</font><font style="vertical-align: inherit;">如果</font></font><em class="replaceable"><code>oe_i</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
           </font></font><em class="replaceable"><code>ie_i</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示相应的外部和内部表达式值，则此子查询比较：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）IN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （SELECT </font></font><em class="replaceable"><code>ie_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          变为：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（SELECT 1 FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND </font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>ie_1</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND </font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了简单起见，以下讨论假设一对外部和内部表达式值。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          刚刚描述的转换有其局限性。</font><font style="vertical-align: inherit;">只有我们忽略可能的</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">才有效</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，</font><font style="vertical-align: inherit;">只要这两个条件都是正确的</font><font style="vertical-align: inherit;">，</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下推</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略就会起作用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而
               </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              你不必区分</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从
               </font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询结果。</font><font style="vertical-align: inherit;">如果子查询是</font><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">的一个</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_or"><code class="literal">OR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式
               </font><font style="vertical-align: inherit;">的一部分</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MySQL假定您不关心。</font><font style="vertical-align: inherit;">其中优化注意到另一个实例</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              子查询结果不需要区分是这样的结构：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...在哪里</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>subquery</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在这种情况下，该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句拒绝该行是否</font><font style="vertical-align: inherit;">返回
               </font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">。
</font></font><code class="literal">IN
              (<em class="replaceable"><code>subquery</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当这些条件中的任何一个或两个都不成立时，优化会更复杂。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已知它是一个非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，但子查询不会产生这样的行
           </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= =
           </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后
           </font></font><code class="literal"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT
          ...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中，如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生任何行，其中</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
              </font></font><code class="literal">NULL</code>
            </p></li><li class="listitem"><p>
              <code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只产生非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值或不产生任何东西
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种情况下，查找行的方法
           </font><font style="vertical-align: inherit;">不再有效。</font><font style="vertical-align: inherit;">有必要找这样的行，但如果没有找到，还找行，其中
           </font><font style="vertical-align: inherit;">是
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">粗略地说，子查询可以转换成这样的东西：
        </font></font><code class="literal"><em class="replaceable"><code>outer_expr</code></em> =
          <em class="replaceable"><code>inner_expr</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（选择1从...在哪里</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IS NULL））
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          评估额外</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">的必要性</font><font style="vertical-align: inherit;">是为什么MySQL有
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问方法：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN</code></strong>
       <strong class="userinput"><code>SELECT <em class="replaceable"><code>outer_expr</code></em> IN (SELECT t2.maybe_null_key</code></strong>
                             <strong class="userinput"><code>FROM t2, t3 WHERE ...)</code></strong>
       <strong class="userinput"><code>FROM t1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：依赖子查询</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格：t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ref_or_null</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：maybe_null_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：may_null_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：func</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用where; </font><font style="vertical-align: inherit;">使用索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          子查询，具体的访问方法也有</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
          </font></font><code class="literal">NULL</code></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变体。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          附加</font></font><code class="literal">OR ... IS NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件使查询执行稍微复杂一些（并且子查询中的一些优化不适用），但通常这是可以容忍的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          的情况更糟糕的时候
           </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">根据SQL解释</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未知值</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，</font></font></span>
          <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应评估为：
</font></font><code class="literal">NULL IN (SELECT <em class="replaceable"><code>inner_expr</code></em>
          ...)</code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生任何行
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有生成行
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了正确评估，必须能够检查是否</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经产生了任何行，因此
           </font><font style="vertical-align: inherit;">不能被推入子查询中。</font><font style="vertical-align: inherit;">这是一个问题，因为除非平等可以被压低，否则许多现实世界子查询变得非常缓慢。
        </font></font><code class="literal"><em class="replaceable"><code>outer_expr</code></em> =
          <em class="replaceable"><code>inner_expr</code></em></code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          实质上，根据值的不同，必须有不同的方式来执行子查询
           </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化选择超速SQL合规性，所以它占的可能性
           </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能是
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，要评估以下表达式，有必要执行
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以确定它是否产生任何行：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL IN（SELECT </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里</font><font style="vertical-align: inherit;">执行原始文件是必要的
               </font><font style="vertical-align: inherit;">，没有任何前面提到的类型的下推平等。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              另一方面，当
               </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样做时，这种比较是绝对必要的：
            </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从... </font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              转换为使用下推条件的表达式：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（SELECT 1 FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有这种转换，子查询将会很慢。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了解决是否将条件推入子查询的困境，条件被包含在
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触发</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数中。</font><font style="vertical-align: inherit;">因此，表达式如下：
        </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从... </font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          转换为：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（SELECT 1 FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND trigcond（</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">））
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          更一般地说，如果子查询比较基于几对外部和内部表达式，则转换将进行以下比较：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）IN（SELECT </font></font><em class="replaceable"><code>ie_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          并将其转换为以下表达式：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（SELECT 1 FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND trigcond（</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>ie_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND trigcond（</font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个</font><font style="vertical-align: inherit;">
          函数都是一个特殊的函数，它的计算结果如下：
</font></font><code class="literal">trigcond(<em class="replaceable"><code>X</code></em>)</code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>X</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当
               </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外表达
               </font></font><em class="replaceable"><code>oe_i</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是
              </font></font><code class="literal">NULL</code>
            </p></li><li class="listitem"><p>
              <code class="literal">TRUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接的</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
              外部表达式</font></font><em class="replaceable"><code>oe_i</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
              </font></font><code class="literal">NULL</code>
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            触发器函数</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您创建的类型的触发器</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-trigger" title="13.1.20 CREATE TRIGGER语法"><code class="literal">CREATE
            TRIGGER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          包装在</font></font><code class="literal">trigcond()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数中的</font><font style="vertical-align: inherit;">等式
           </font><font style="vertical-align: inherit;">不是查询优化器的头等谓词。</font><font style="vertical-align: inherit;">大多数优化不能处理在查询执行时可能打开和关闭的谓词，因此它们假定任何
           </font><font style="vertical-align: inherit;">是未知函数并忽略它。</font><font style="vertical-align: inherit;">这些优化可以使用触发的等式：
</font></font><code class="literal">trigcond(<em class="replaceable"><code>X</code></em>)</code><font style="vertical-align: inherit;"></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              参考优化：
               </font><font style="vertical-align: inherit;">可用于构建
               </font><font style="vertical-align: inherit;">，
               </font><font style="vertical-align: inherit;">或
               </font><font style="vertical-align: inherit;">表访问。
            </font></font><code class="literal">trigcond(<em class="replaceable"><code>X</code></em>=<em class="replaceable"><code>Y</code></em>
              [OR <em class="replaceable"><code>Y</code></em> IS NULL])</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              基于索引查找的子查询执行引擎：
               </font><font style="vertical-align: inherit;">
              可用于构建
               </font><font style="vertical-align: inherit;">或
               </font><font style="vertical-align: inherit;">
              访问。
            </font></font><code class="literal">trigcond(<em class="replaceable"><code>X</code></em>=<em class="replaceable"><code>Y</code></em>)</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表条件生成器：如果子查询是多个表的连接，则尽快检查触发条件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当优化程序使用触发条件创建某种基于索引查找的访问（如上述列表的前两项）时，对于条件关闭的情况，它必须具有回退策略。</font><font style="vertical-align: inherit;">这种回退策略总是相同的：执行全表扫描。</font><font style="vertical-align: inherit;">在
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出中，回退显示</font></font><code class="literal">Full scan on NULL key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
           </font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT t1.col1,</code></strong>
       <strong class="userinput"><code>t1.col1 IN (SELECT t2.key1 FROM t2 WHERE t2.col2=t1.col2) FROM t1\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：依赖子查询</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格：t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：index_subquery</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：key1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：key1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：func</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用where; </font><font style="vertical-align: inherit;">完全扫描NULL键</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你运行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之后
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你可以看到触发条件：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  级别：注意</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
信息：select`test`.`t1`.`col1` as`col1`，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;in_optimizer&gt;（`test`.`t1`.`col1`，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;exists&gt;（&lt;index_lookup&gt;（&lt;cache&gt;（`test`.`t1`.`col1`）in t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         在key1上检查NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         where（`test`.`t2`.`col2` =`test`.``1'.`col2`）having</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         trigcond（&lt;is_not_null_test&gt;（`test`.`t2`.`key1`）））））AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         `t1.col1 IN（从t2选择t2.key1，其中t2.col2 = t1.col2）`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         从`test`.`t1`</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          触发条件的使用具有一些性能影响。</font><font style="vertical-align: inherit;">甲</font></font><code class="literal">NULL IN (SELECT ...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在表达可能会导致全表扫描（这是慢）时，它以前没有。</font><font style="vertical-align: inherit;">这是支付正确结果的价格（触发条件策略的目标是提高合规性，而不是速度）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于多表子查询，执行</font></font><code class="literal">NULL IN
          (SELECT ...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">速度特别慢，因为连接优化器不针对外表达式的情况进行优化</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它假设</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左侧的</font><font style="vertical-align: inherit;">子查询评估</font><font style="vertical-align: inherit;">非常罕见，即使有统计数据表明不是。</font><font style="vertical-align: inherit;">另一方面，如果外在的表达可能是，
           </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但实际上从来没有，那么就没有表现的惩罚。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了帮助查询优化器更好地执行查询，请使用以下建议：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              声明一个列，就</font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好像它真的一样。</font><font style="vertical-align: inherit;">这也通过简化列的条件测试来帮助优化器的其他方面。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您不需要区分</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自
               </font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询的结果，你可以很容易地避免慢的执行路径。</font><font style="vertical-align: inherit;">替换看起来像这样的比较：
            </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从...中</font><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              用这个表达式：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IS NOT NULL）AND（</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（SELECT </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ...））
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              然后</font></font><code class="literal">NULL IN (SELECT ...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永远不会被评估，因为</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要表达式结果清晰，</font><font style="vertical-align: inherit;">MySQL就会停止评估
               </font><font style="vertical-align: inherit;">部分。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              另一个可能的重写：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（SELECT </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        WHERE </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当你需要分不清这将适用于
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code class="literal">FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              子查询结果，在这种情况下，你可能真的想
               </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><code class="literal">subquery_materialization_cost_based</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          所述的标志</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量使得能够在子查询物化和之间的选择控制
           </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-到- </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询变换。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="information-schema-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.3优化INFORMATION_SCHEMA查询</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528105311088"></a><a class="indexterm" name="idm140528105309584"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        监视数据库的应用程序可能会频繁使用
         </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">某些类型的</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">可以优化以更快执行。</font><font style="vertical-align: inherit;">目标是最小化文件操作（例如，扫描目录或打开表文件）以收集组成这些动态表的信息。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询中</font><font style="vertical-align: inherit;">
          数据库和表名称的比较行为
           </font><font style="vertical-align: inherit;">可能与您所期望的不同。</font><font style="vertical-align: inherit;">有关详细信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/charset.html#charset-collation-information-schema" title="10.8.7在INFORMATION_SCHEMA搜索中使用排序规则"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第10.8.7节“在INFORMATION_SCHEMA搜索中使用排序规则”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1）尝试在</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        子句中</font><font style="vertical-align: inherit;">为数据库和表名使用常量查找值</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        你可以利用这个原则如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要查找数据库或表，请使用计算常量的表达式，例如文字值，返回常量或标量子查询的函数。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            避免使用非恒定数据库名称查询值（或无查找值）的查询，因为它们需要扫描数据目录以查找匹配的数据库目录名称。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在数据库中，避免使用非恒定表名查找值（或没有查找值）的查询，因为它们需要扫描数据库目录才能找到匹配的表文件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该原则适用于下
         </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中显示的表格，该表格显示了一个常数查找值使服务器能够避免目录扫描的列。</font><font style="vertical-align: inherit;">例如，如果您从中进行选择，则
         </font><font style="vertical-align: inherit;">在
         </font><font style="vertical-align: inherit;">子句中</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#tables-table" title="24.24 INFORMATION_SCHEMA表格表"><code class="literal">TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用常数查找值</font><font style="vertical-align: inherit;">可以避免数据目录扫描。
</font></font><code class="literal">TABLE_SCHEMA</code><font style="vertical-align: inherit;"></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"></font></p>
<div class="informaltable">
<table summary="INFORMATION_SCHEMA tables and table columns for which a constant lookup value enables the server to avoid directory scans."><colgroup><col width="34%"><col width="33%"><col width="33%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列指定以避免数据目录扫描</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要指定的列以避免数据库目录扫描</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#columns-table" title="24.4 INFORMATION_SCHEMA COLUMNS表"><code class="literal">COLUMNS</code></a></td>
            <td><code class="literal">TABLE_SCHEMA</code></td>
            <td><code class="literal">TABLE_NAME</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#key-column-usage-table" title="24.11 INFORMATION_SCHEMA KEY_COLUMN_USAGE表"><code class="literal">KEY_COLUMN_USAGE</code></a></td>
            <td><code class="literal">TABLE_SCHEMA</code></td>
            <td><code class="literal">TABLE_NAME</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">PARTITIONS</code></a></td>
            <td><code class="literal">TABLE_SCHEMA</code></td>
            <td><code class="literal">TABLE_NAME</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#referential-constraints-table" title="24.19 INFORMATION_SCHEMA REFERENTIAL_CONSTRAINTS表"><code class="literal">REFERENTIAL_CONSTRAINTS</code></a></td>
            <td><code class="literal">CONSTRAINT_SCHEMA</code></td>
            <td><code class="literal">TABLE_NAME</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#statistics-table" title="24.23 INFORMATION_SCHEMA统计表"><code class="literal">STATISTICS</code></a></td>
            <td><code class="literal">TABLE_SCHEMA</code></td>
            <td><code class="literal">TABLE_NAME</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#tables-table" title="24.24 INFORMATION_SCHEMA表格表"><code class="literal">TABLES</code></a></td>
            <td><code class="literal">TABLE_SCHEMA</code></td>
            <td><code class="literal">TABLE_NAME</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#table-constraints-table" title="24.26 INFORMATION_SCHEMA TABLE_CONSTRAINTS表"><code class="literal">TABLE_CONSTRAINTS</code></a></td>
            <td><code class="literal">TABLE_SCHEMA</code></td>
            <td><code class="literal">TABLE_NAME</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#triggers-table" title="24.28 INFORMATION_SCHEMA触发器表"><code class="literal">TRIGGERS</code></a></td>
            <td><code class="literal">EVENT_OBJECT_SCHEMA</code></td>
            <td><code class="literal">EVENT_OBJECT_TABLE</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="/mysql-5.7-google-zh/information-schema.html#views-table" title="24.30 INFORMATION_SCHEMA视图表"><code class="literal">VIEWS</code></a></td>
            <td><code class="literal">TABLE_SCHEMA</code></td>
            <td><code class="literal">TABLE_NAME</code></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        限于特定常量数据库名称的查询的好处在于，只需对指定的数据库目录进行检查。</font><font style="vertical-align: inherit;">例：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE TABLE_SCHEMA ='test';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用文字数据库名称</font></font><code class="literal">test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使服务器仅检查</font></font><code class="literal">test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库目录，而不管可能有多少个数据库。</font><font style="vertical-align: inherit;">相比之下，以下查询效率较低，因为它需要扫描数据目录以确定哪些数据库名称与模式匹配</font></font><code class="literal">'test%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE TABLE_SCHEMA LIKE'test％';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于仅限于特定常量表名称的查询，只需对相应数据库目录中的指定表进行检查。</font><font style="vertical-align: inherit;">例：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE TABLE_SCHEMA ='test'AND TABLE_NAME ='t1';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用文字表名</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可使服务器仅检查</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表</font><font style="vertical-align: inherit;">的文件</font><font style="vertical-align: inherit;">，而不管</font></font><code class="literal">test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">可能有多少表
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">相比之下，以下查询需要扫描</font></font><code class="literal">test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库目录以确定哪些表名与模式匹配
         </font></font><code class="literal">'t%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE TABLE_SCHEMA ='test'AND TABLE_NAME LIKE't％';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下查询需要扫描数据库目录以确定模式的匹配数据库名称
         </font></font><code class="literal">'test%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且对于每个匹配的数据库，它需要扫描数据库目录以确定模式的匹配表名称</font></font><code class="literal">'t%'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE TABLE_SCHEMA ='test％'AND TABLE_NAME LIKE't％';</font></font><font></font>
</pre><p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2）编写查询，以尽量减少必须打开的表文件的数量</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于引用某些</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表列的</font><font style="vertical-align: inherit;">查询，可以使用
         </font><font style="vertical-align: inherit;">几种优化来最小化必须打开的表文件的数量。</font><font style="vertical-align: inherit;">例：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT TABLE_NAME，ENGINE FROM INFORMATION_SCHEMA.TABLES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE TABLE_SCHEMA ='test';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，在服务器扫描数据库目录以确定数据库中表的名称之后，这些名称将变为可用，而不需要进一步的文件系统查找。</font><font style="vertical-align: inherit;">因此，</font></font><code class="literal">TABLE_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要打开文件。</font><font style="vertical-align: inherit;">的</font></font><code class="literal">ENGINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（存储引擎）值可以通过打开表的确定
         </font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，而不接触其它表文件，例如</font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一些价值观，如</font></font><code class="literal">INDEX_LENGTH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，需要打开
         </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        文件开放优化类型如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">SKIP_OPEN_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：表格文件不需要打开。</font><font style="vertical-align: inherit;">通过扫描数据库目录，查询中的信息已经可用。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">OPEN_FRM_ONLY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：只</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要打开</font><font style="vertical-align: inherit;">表格
             </font><font style="vertical-align: inherit;">文件。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">OPEN_TRIGGER_ONLY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：只</font></font><code class="filename">.TRG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要打开</font><font style="vertical-align: inherit;">表格
             </font><font style="vertical-align: inherit;">文件。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">OPEN_FULL_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：未优化的信息查询。</font><font style="vertical-align: inherit;">的</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            文件必须被打开。
</font></font></p></li></ul>
</div>
<a class="indexterm" name="idm140528105202576"></a><a class="indexterm" name="idm140528105201072"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表显示了上述优化类型如何应用于</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格列。</font><font style="vertical-align: inherit;">对于未命名的表和列，不应用任何优化。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#columns-table" title="24.4 INFORMATION_SCHEMA COLUMNS表"><code class="literal">COLUMNS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><code class="literal">OPEN_FRM_ONLY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于所有列
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#key-column-usage-table" title="24.11 INFORMATION_SCHEMA KEY_COLUMN_USAGE表"><code class="literal">KEY_COLUMN_USAGE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><code class="literal">OPEN_FULL_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于所有列
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#partitions-table" title="24.15 INFORMATION_SCHEMA分区表"><code class="literal">PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><code class="literal">OPEN_FULL_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于所有列
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#referential-constraints-table" title="24.19 INFORMATION_SCHEMA REFERENTIAL_CONSTRAINTS表"><code class="literal">REFERENTIAL_CONSTRAINTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><code class="literal">OPEN_FULL_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于所有列
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#statistics-table" title="24.23 INFORMATION_SCHEMA统计表"><code class="literal">STATISTICS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="informaltable">
<table summary="Optimization types that apply to INFORMATION_SCHEMA STATISTICS table columns."><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化类型</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">TABLE_CATALOG</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_SCHEMA</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_NAME</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">NON_UNIQUE</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">INDEX_SCHEMA</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">INDEX_NAME</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">SEQ_IN_INDEX</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">COLUMN_NAME</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">COLLATION</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">CARDINALITY</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">SUB_PART</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">PACKED</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">NULLABLE</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">INDEX_TYPE</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">COMMENT</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
</tr></tbody></table>
</div>
</li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#tables-table" title="24.24 INFORMATION_SCHEMA表格表"><code class="literal">TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="informaltable">
<table summary="Optimization types that apply to INFORMATION_SCHEMA TABLES table columns."><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化类型</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">TABLE_CATALOG</code></td>
                <td><code class="literal">SKIP_OPEN_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_SCHEMA</code></td>
                <td><code class="literal">SKIP_OPEN_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_NAME</code></td>
                <td><code class="literal">SKIP_OPEN_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_TYPE</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">ENGINE</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">VERSION</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">ROW_FORMAT</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_ROWS</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">AVG_ROW_LENGTH</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">DATA_LENGTH</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">MAX_DATA_LENGTH</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">INDEX_LENGTH</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">DATA_FREE</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">AUTO_INCREMENT</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">CREATE_TIME</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">UPDATE_TIME</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">CHECK_TIME</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_COLLATION</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">CHECKSUM</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">CREATE_OPTIONS</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_COMMENT</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
</tr></tbody></table>
</div>
</li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#table-constraints-table" title="24.26 INFORMATION_SCHEMA TABLE_CONSTRAINTS表"><code class="literal">TABLE_CONSTRAINTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><code class="literal">OPEN_FULL_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于所有列
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#triggers-table" title="24.28 INFORMATION_SCHEMA触发器表"><code class="literal">TRIGGERS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
             </font></font><code class="literal">OPEN_TRIGGER_ONLY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于所有列
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/information-schema.html#views-table" title="24.30 INFORMATION_SCHEMA视图表"><code class="literal">VIEWS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="informaltable">
<table summary="Optimization types that apply to INFORMATION_SCHEMA VIEWS table columns."><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱</font></font></th>
                <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化类型</font></font></th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">TABLE_CATALOG</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_SCHEMA</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">TABLE_NAME</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">VIEW_DEFINITION</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">CHECK_OPTION</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">IS_UPDATABLE</code></td>
                <td><code class="literal">OPEN_FULL_TABLE</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">DEFINER</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">SECURITY_TYPE</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">CHARACTER_SET_CLIENT</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
              </tr><tr>
                <td scope="row"><code class="literal">COLLATION_CONNECTION</code></td>
                <td><code class="literal">OPEN_FRM_ONLY</code></td>
</tr></tbody></table>
</div>
</li></ul>
</div>
<p>
        <span class="bold"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3）
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于确定服务器是否可以</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对查询</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">优化</font></font></strong></span>
      </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这尤其适用
         </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于从多个数据库搜索信息的查询，这可能需要很长时间并影响性能。</font><font style="vertical-align: inherit;">输出中</font><font style="vertical-align: inherit;">的</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示服务器可以使用哪些优化（如果有的话）评估</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询。</font><font style="vertical-align: inherit;">以下示例演示了您可以在</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值中</font><font style="vertical-align: inherit;">看到的各种信息
         </font><font style="vertical-align: inherit;">。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME FROM INFORMATION_SCHEMA.VIEWS WHERE</code></strong>
       <strong class="userinput"><code>TABLE_SCHEMA = 'test' AND TABLE_NAME = 'v1'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：视图</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：TABLE_SCHEMA，TABLE_NAME</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用where; </font><font style="vertical-align: inherit;">Open_frm_only; </font><font style="vertical-align: inherit;">扫描0个数据库</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用常量数据库和表查找值可使服务器避免目录扫描。</font><font style="vertical-align: inherit;">为了引用
         </font></font><code class="literal">VIEWS.TABLE_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要打开</font><font style="vertical-align: inherit;">该
         </font><font style="vertical-align: inherit;">文件。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME, ROW_FORMAT FROM INFORMATION_SCHEMA.TABLES\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        桌子：桌子</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：Open_full_table; </font><font style="vertical-align: inherit;">扫描所有数据库</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        没有提供查找值（没有
         </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句），所以服务器必须扫描数据目录和每个数据库目录。</font><font style="vertical-align: inherit;">对于如此识别的每个表格，选择表格名称和行格式。
        </font></font><code class="literal">TABLE_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要打开其他表格文件（</font></font><code class="literal">SKIP_OPEN_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化适用）。</font></font><code class="literal">ROW_FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要打开所有表格文件（</font></font><code class="literal">OPEN_FULL_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用）。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告，
         </font></font><code class="literal">OPEN_FULL_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它比</font></font><code class="literal">SKIP_OPEN_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME, TABLE_TYPE FROM INFORMATION_SCHEMA.TABLES</code></strong>
       <strong class="userinput"><code>WHERE TABLE_SCHEMA = 'test'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        桌子：桌子</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：TABLE_SCHEMA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用where; </font><font style="vertical-align: inherit;">Open_frm_only; </font><font style="vertical-align: inherit;">扫描了1个数据库</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        没有提供表名查找值，所以服务器必须扫描</font></font><code class="literal">test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库目录。</font><font style="vertical-align: inherit;">对于
         </font></font><code class="literal">TABLE_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">TABLE_TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        列</font><font style="vertical-align: inherit;">，分别应用</font></font><code class="literal">SKIP_OPEN_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">OPEN_FRM_ONLY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告，
         </font></font><code class="literal">OPEN_FRM_ONLY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它更昂贵。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT B.TABLE_NAME</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.TABLES AS A, INFORMATION_SCHEMA.COLUMNS AS B</code></strong>
       <strong class="userinput"><code>WHERE A.TABLE_SCHEMA = 'test'</code></strong>
       <strong class="userinput"><code>AND A.TABLE_NAME = 't1'</code></strong>
       <strong class="userinput"><code>AND B.TABLE_NAME = A.TABLE_NAME\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：TABLE_SCHEMA，TABLE_NAME</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用where; </font><font style="vertical-align: inherit;">Skip_open_table; </font><font style="vertical-align: inherit;">扫描0个数据库</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用where; </font><font style="vertical-align: inherit;">Open_frm_only; </font><font style="vertical-align: inherit;">扫描所有数据库;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               使用连接缓冲区</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于第一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出行：常量数据库和表查找值使服务器可以避免目录扫描</font></font><code class="literal">TABLES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">引用</font></font><code class="literal">TABLES.TABLE_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要更多的表文件。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于第二个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出行：所有</font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#columns-table" title="24.4 INFORMATION_SCHEMA COLUMNS表"><code class="literal">COLUMNS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表值都是
         </font></font><code class="literal">OPEN_FRM_ONLY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找，因此
         </font></font><code class="literal">COLUMNS.TABLE_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要打开
         </font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM INFORMATION_SCHEMA.COLLATIONS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：COLLATIONS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，不应优化，因为
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#collations-table" title="24.2 INFORMATION_SCHEMA COLLATIONS表"><code class="literal">COLLATIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以优化</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">之一
         </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="data-change-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4优化数据更改语句</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#insert-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4.1优化INSERT语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#update-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4.2优化UPDATE语句</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#delete-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4.3优化DELETE语句</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528104960832"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这部分解释了如何加快数据更改语句：
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">传统的OLTP应用程序和现代Web应用程序通常会执行许多小型数据更改操作，其中并发性至关重要。</font><font style="vertical-align: inherit;">数据分析和报告应用程序通常会运行一次影响多行的数据更改操作，其中主要考虑因素是编写大量数据并使索引保持最新状态的I / O。</font><font style="vertical-align: inherit;">为了插入和更新大量数据的（在工业中ETL已知的，
         </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提取变换负荷</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font><font style="vertical-align: inherit;">有时使用其他SQL语句或外部命令，模拟的效果
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="insert-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4.1优化INSERT语句</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528104949296"></a><a class="indexterm" name="idm140528104948256"></a><a class="indexterm" name="idm140528104946768"></a><a class="indexterm" name="idm140528104945280"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了优化插入速度，将许多小操作合并为一个大操作。</font><font style="vertical-align: inherit;">理想情况下，您建立一个连接，一次发送多个新行的数据，并延迟所有索引更新和一致性检查直到最后。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          插入行所需的时间由以下因素决定，其中数字表示大致的比例：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              连接：（3）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              发送查询到服务器：（2）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              解析查询：（2）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              插入行：（1×行的大小）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              插入索引：（1×索引数）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              闭幕式：（1）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这并没有考虑到打开表的初始开销，对于每个并发运行的查询都要执行一次。
        </font></font></p><p><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设B树索引，</font><font style="vertical-align: inherit;">
          表的大小通过日志减慢索引的插入</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以使用以下方法来加速插入：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您要同时从同一客户端插入多行，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              具有多个</font></font><code class="literal">VALUES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">一次</font><font style="vertical-align: inherit;">插入多行。</font><font style="vertical-align: inherit;">这比使用单独的单行快得多（在某些情况下要快很多倍）</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
              语句</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果要将数据添加到非空表中，则可以调整该
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_bulk_insert_buffer_size"><code class="literal">bulk_insert_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              变量以使数据插入更快。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从文本文件加载表格时，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
              INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这通常比使用快20倍</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.6节“LOAD DATA INFILE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              利用列具有默认值的事实。</font><font style="vertical-align: inherit;">仅当要插入的值不同于默认值时才显式插入值。</font><font style="vertical-align: inherit;">这减少了MySQL必须执行的解析并提高了插入速度。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-bulk-data-loading" title="8.5.5 InnoDB表的批量数据加载"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.5.5节“InnoDB表的批量数据加载”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
              特定于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格的</font><font style="vertical-align: inherit;">提示</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizing-myisam-bulk-data-loading" title="8.6.2 MyISAM表的批量数据加载"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
              的提示</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizing-myisam-bulk-data-loading" title="8.6.2 Bulk Data Loading for MyISAM Tables"><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizing-myisam-bulk-data-loading" title="8.6.2 Bulk Data Loading for MyISAM Tables"><font style="vertical-align: inherit;">第8.6.2节“MyISAM表格的批量数据加载”</font></a></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="update-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4.2优化UPDATE语句</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104916944"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          更新语句的优化类似于
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有写入额外开销的查询。</font><font style="vertical-align: inherit;">写入的速度取决于正在更新的数据量和更新的索引数量。</font><font style="vertical-align: inherit;">没有更改的索引不会更新。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          获得快速更新的另一种方法是延迟更新，然后在一行中进行多次更新。</font><font style="vertical-align: inherit;">如果锁定表格，一次执行多个更新比一次执行多个更快。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用动态行格式</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表，将行更新为更长的总长度可能会拆分该行。</font><font style="vertical-align: inherit;">如果你经常这样做，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偶尔</font><font style="vertical-align: inherit;">使用它非常重要
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.4节“OPTIMIZE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="delete-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4.3优化DELETE语句</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104908368"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          删除</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">单个行所需的时间
           </font><font style="vertical-align: inherit;">与索引的数量成正比。</font><font style="vertical-align: inherit;">要更快地删除行，可以通过增加</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">来增加密钥缓存的大小
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-configuration" title="5.1.1配置服务器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要从</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">删除所有行</font><font style="vertical-align: inherit;">，
           </font><font style="vertical-align: inherit;">速度比
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">截断操作不是事务安全的; </font><font style="vertical-align: inherit;">在活动事务或活动表锁定过程中尝试一个错误时发生错误。</font><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><font style="vertical-align: inherit;">第13.1.34节“TRUNCATE TABLE语法”</font></a><font style="vertical-align: inherit;">。
</font></font><code class="literal">TRUNCATE TABLE
          <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">DELETE FROM
          <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="permission-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.5优化数据库权限</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104898160"></a><a class="indexterm" name="idm140528104896704"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您的权限设置越复杂，适用于所有SQL语句的开销就越多。</font><font style="vertical-align: inherit;">简化</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">建立的权限
         </font><font style="vertical-align: inherit;">使MySQL在客户端执行语句时减少了权限检查开销。</font><font style="vertical-align: inherit;">例如，如果您不授予任何表级或列级权限，则服务器无需检查</font></font><code class="literal">tables_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">columns_priv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的内容</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同样，如果您对任何帐户没有资源限制，则服务器不必执行资源计数。</font><font style="vertical-align: inherit;">如果您的语句处理负载非常高，请考虑使用简化的授权结构来减少权限检查开销。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="miscellaneous-optimization-tips"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.6其他优化技巧</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104890096"></a><a class="indexterm" name="idm140528104888608"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节列出了一些提高查询处理速度的提示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您的应用程序发出多个数据库请求来执行相关更新，则将这些语句组合到存储例程中可以提高性能。</font><font style="vertical-align: inherit;">同样，如果您的应用程序基于多个列值或大量数据计算单个结果，则将计算组合到UDF（用户定义的函数）中可以提高性能。</font><font style="vertical-align: inherit;">由此产生的快速数据库操作可供其他查询，应用程序甚至用不同编程语言编写的代码重用。</font><font style="vertical-align: inherit;">有关更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-routines" title="23.2使用存储例程（过程和函数）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/stored-programs-views.html#stored-routines" title="23.2使用存储例程（过程和函数）"><font style="vertical-align: inherit;">第23.2节“使用存储例程（过程和函数）”</font></a><font style="vertical-align: inherit;">和
             </font></font><a class="xref" href="/mysql-5.7-google-zh/extending-mysql.html#adding-functions" title="28.4为MySQL添加新功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第28.4节“向MySQL添加新函数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要修复与</font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">发生的任何压缩问题
             </font><font style="vertical-align: inherit;">，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#archive-storage-engine" title="15.5 ARCHIVE存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15.5节“ARCHIVE存储引擎”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果可能，请将报告归类为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实时</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">统计</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中统计报告所需的数据仅由从实时数据定期生成的汇总表创建。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您的数据不符合行和列表结构，则可以将数据打包并存储到</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中。</font><font style="vertical-align: inherit;">在这种情况下，您必须在应用程序中提供代码来打包和解压缩信息，但这可能会节省I / O操作以读取和写入相关值集。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用Web服务器，将图像和其他二进制资产存储为文件，路径名称存储在数据库中，而不是文件本身。</font><font style="vertical-align: inherit;">大多数Web服务器在缓存文件方面比数据库内容更好，因此使用文件通常更快。</font><font style="vertical-align: inherit;">（尽管在这种情况下您必须自己处理备份和存储问题。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您需要非常高的速度，请查看底层的MySQL接口。</font><font style="vertical-align: inherit;">例如，通过</font><font style="vertical-align: inherit;">
            直接</font><font style="vertical-align: inherit;">访问MySQL
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，与使用SQL接口相比，您可以大幅提高速度。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            复制可以为某些操作提供性能优势。</font><font style="vertical-align: inherit;">您可以在复制服务器之间分发客户端检索以分割负载。</font><font style="vertical-align: inherit;">为避免在备份时减慢主服务器的速度，可以使用从服务器进行备份。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/replication.html" title="第16章复制"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第16章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimization-indexes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3优化和索引</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#mysql-indexes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.1 MySQL如何使用索引</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#primary-key-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.2主键优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#foreign-key-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.3外键优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#column-indexes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.4列索引</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#multiple-column-indexes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.5多列索引</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#verifying-index-usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.6检验索引使用情况</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-statistics"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.7 InnoDB和MyISAM指数统计收集</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-btree-hash"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.8 B树和散列索引的比较</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-extensions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.9使用索引扩展</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#generated-column-index-optimizations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.10优化器使用生成的列索引</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528104868784"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      提高操作性能的最佳方法
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在查询中测试的一列或多列上创建索引。</font><font style="vertical-align: inherit;">索引条目就像指向表行的指针，允许查询快速确定哪些行与条件匹配</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">，并检索这些行的其他列值。</font><font style="vertical-align: inherit;">所有的MySQL数据类型都可以被索引。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      尽管为查询中使用的每个可能的列创建索引是很诱人的，但不必要的索引会浪费空间并浪费时间让MySQL确定要使用的索引。</font><font style="vertical-align: inherit;">索引还会增加插入，更新和删除的成本，因为每个索引都必须更新。</font><font style="vertical-align: inherit;">您必须找到适当的平衡，才能使用最佳索引集实现快速查询。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-indexes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.1 MySQL如何使用索引</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528104862656"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        索引用于快速查找具有特定列值的行。</font><font style="vertical-align: inherit;">如果没有索引，MySQL必须从第一行开始，然后读取整个表以查找相关行。</font><font style="vertical-align: inherit;">表格越大，成本越高。</font><font style="vertical-align: inherit;">如果表中有相关​​列的索引，MySQL可以快速确定在数据文件中间寻找的位置，而无需查看所有数据。</font><font style="vertical-align: inherit;">这比按顺序读取每一行要快得多。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        大多数MySQL索引（</font></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）存储在
         </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_b_tree" title="B树"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B树</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例外：空间数据类型的索引使用R树; </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表还支持</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_hash_index" title="散列索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">索引</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用倒排列表</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一般来说，索引的使用将在下面的讨论中描述。</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-btree-hash" title="8.3.8 B树和散列索引的比较"><font style="vertical-align: inherit;">第8.3.8节“B树和散列索引的比较”</font></a></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中描述了</font><font style="vertical-align: inherit;">特定于散列索引的特性（如</font><font style="vertical-align: inherit;">表中所</font><font style="vertical-align: inherit;">用
         </font><font style="vertical-align: inherit;">）
         </font><font style="vertical-align: inherit;">。
      </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-btree-hash" title="8.3.8 B树和散列索引的比较"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL使用这些操作的索引：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速</font><font style="vertical-align: inherit;">
            查找与</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">匹配的行</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            考虑排除行。</font><font style="vertical-align: inherit;">如果在多个索引之间有选择，MySQL通常使用找到最少行数的</font><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">（最具
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_selectivity" title="选择性"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择性的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引）。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528104845792"></a>

            <a class="indexterm" name="idm140528104844304"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

            如果表具有多列索引，则优化器可以使用该索引的任何最左边的前缀来查找行。</font><font style="vertical-align: inherit;">例如，如果你有一个三列索引上
             </font></font><code class="literal">(col1, col2, col3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你有索引的搜索功能</font></font><code class="literal">(col1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">(col1, col2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="literal">(col1, col2,
            col3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#multiple-column-indexes" title="8.3.5多列索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.3.5节“多列索引”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在执行连接时从其他表中检索行。</font><font style="vertical-align: inherit;">如果它们被声明为相同的类型和大小，MySQL可以更有效地在列上使用索引。</font><font style="vertical-align: inherit;">在这种情况下，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被认为是相同的，如果它们被声明为相同的大小。</font><font style="vertical-align: inherit;">例如，
             </font></font><code class="literal">VARCHAR(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">CHAR(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小相同，但
             </font></font><code class="literal">VARCHAR(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
             </font></font><code class="literal">CHAR(15)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了比较非二进制字符串列，两列应使用相同的字符集。</font><font style="vertical-align: inherit;">例如，将</font></font><code class="literal">utf8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列与
             </font></font><code class="literal">latin1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">进行比较将</font><font style="vertical-align: inherit;">排除索引的使用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            比较不同的列（例如，比较字符串列与时间或数字列）可能会阻止使用索引，如果无法直接比较值而不进行转换。</font><font style="vertical-align: inherit;">对于给定的值，如</font></font><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在数值列，它可能比较等于在字符串列，例如任何数量的值
             </font></font><code class="literal">'1'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">'&nbsp;1'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">'00001'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font><code class="literal">'01.e1'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这排除了字符串列的任何索引的使用。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查找</font><font style="vertical-align: inherit;">特定索引列的值</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_max"><code class="literal">MAX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这由预处理器进行了优化，该预处理器检查您是否使用</font><font style="vertical-align: inherit;">
            索引中</font><font style="vertical-align: inherit;">之前发生的所有关键部分</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，MySQL会为每个</font><font style="vertical-align: inherit;">或
             </font><font style="vertical-align: inherit;">表达式</font><font style="vertical-align: inherit;">进行单键查找</font><font style="vertical-align: inherit;">并用常量替换它。</font><font style="vertical-align: inherit;">如果所有表达式都被常量替换，则查询立即返回。</font><font style="vertical-align: inherit;">例如：
          </font></font><code class="literal">WHERE <em class="replaceable"><code>key_part_N</code></em> =
            <em class="replaceable"><code>constant</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_max"><code class="literal">MAX()</code></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MIN（</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），MAX（</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果排序或分组是在可用索引的最左侧前缀（例如，</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">上完成，则对表排序或分组
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果所有关键部件都紧随其后</font><font style="vertical-align: inherit;">，则按相反的顺序读取钥匙。</font><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-optimization" title="8.2.1.13 ORDER BY优化"><font style="vertical-align: inherit;">第8.2.1.13节“按优化</font></a><a class="xref" href="/mysql-5.7-google-zh/optimization.html#group-by-optimization" title="8.2.1.14 GROUP BY优化"><font style="vertical-align: inherit;">排序”</font></a><font style="vertical-align: inherit;">和
             </font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#group-by-optimization" title="8.2.1.14 GROUP BY优化"><font style="vertical-align: inherit;">第8.2.1.14节“GROUP BY优化”</font></a><font style="vertical-align: inherit;">。
          </font></font><code class="literal">ORDER BY <em class="replaceable"><code>key_part1</code></em>,
            <em class="replaceable"><code>key_part2</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">DESC</code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-optimization" title="8.2.1.13 ORDER BY优化"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#group-by-optimization" title="8.2.1.14 GROUP BY优化"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在某些情况下，可以优化查询以在不查询数据行的情况下检索值。</font><font style="vertical-align: inherit;">（为查询提供所有必要结果的</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_covering_index" title="覆盖指数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为
             </font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_covering_index" title="覆盖指数"><font style="vertical-align: inherit;">覆盖索引</font></a><font style="vertical-align: inherit;">。）如果查询仅使用表中某些索引中包含的列，则可以从索引树中检索所选值以获得更快的速度：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT </font></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1
</font></font></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        索引对于小型表或查询处理大部分或全部行的大型表的查询不太重要。</font><font style="vertical-align: inherit;">当查询需要访问大多数行时，顺序读取比通过索引处理更快。</font><font style="vertical-align: inherit;">即使并非查询所需的所有行，顺序读取也会使磁盘搜索次数最小化。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#table-scan-avoidance" title="8.2.1.19避免全表扫描"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#table-scan-avoidance" title="8.2.1.19避免全表扫描"><font style="vertical-align: inherit;">第8.2.1.19节“避免全表扫描”</font></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="primary-key-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.2主键优化</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104802960"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表的主键表示您在最重要的查询中使用的一列或一组列。</font><font style="vertical-align: inherit;">它有一个关联索引，用于快速查询性能。</font><font style="vertical-align: inherit;">查询性能从</font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化中</font><font style="vertical-align: inherit;">受益</font><font style="vertical-align: inherit;">，因为它不能包含任何</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">通过</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，表格数据的物理组织可以进行超快速查找，并根据主键列进行排序。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您的表格很重要，但没有明显的列或一组列作为主键，那么您可以创建一个带有自动增量值的单独列作为主键。</font><font style="vertical-align: inherit;">当您使用外键连接表时，这些唯一ID可用作指向其他表中相应行的指针。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="foreign-key-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.3外键优化</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104796464"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果一个表有许多列，并且查询了许多不同的列组合，将不常用的数据拆分成每列都有几列的单独表，并通过复制数字ID将它们关联到主表主表中的列。</font><font style="vertical-align: inherit;">这样，每个小表可以有一个快速查找其数据的主键，并且可以使用连接操作仅查询需要的一组列。</font><font style="vertical-align: inherit;">根据数据的分布情况，查询可能会执行较少的I / O并占用较少的缓存内存，因为相关的列在磁盘上打包在一起。</font><font style="vertical-align: inherit;">（为了最大限度提高性能，查询尝试从磁盘读取尽可能少的数据块;
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="column-indexes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.4列索引</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104792480"></a><a class="indexterm" name="idm140528104790992"></a><a class="indexterm" name="idm140528104789504"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        最常见的索引类型涉及单列，将该列中值的副本存储在数据结构中，从而允许快速查找具有相应列值的行。</font><font style="vertical-align: inherit;">B树数据结构可以让索引快速查找特定值，一组值，或值的范围，对应于运营商，如</font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">≤</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">BETWEEN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，等等，一在</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个表的最大索引数和最大索引长度是根据每个存储引擎定义的。</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InnoDB存储引擎</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html" title="第15章备用存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备用存储引擎</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有存储引擎每个表至少支持16个索引，总索引长度至少为256个字节。</font><font style="vertical-align: inherit;">大多数存储引擎有更高的限制。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关列索引的其他信息，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-index" title="13.1.14 CREATE INDEX语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.14节“CREATE INDEX语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#column-indexes-prefix" title="索引前缀"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引前缀</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#column-indexes-fulltext" title="FULLTEXT索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FULLTEXT索引</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#column-indexes-spatial" title="空间索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空间索引</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#column-indexes-memory-storage-engine" title="MEMORY存储引擎中的索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEMORY存储引擎中的索引</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="column-indexes-prefix"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引前缀</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104774592"></a><a class="indexterm" name="idm140528104773104"></a><a class="indexterm" name="idm140528104771616"></a><a class="indexterm" name="idm140528104770128"></a><a class="indexterm" name="idm140528104768640"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用
           </font><font style="vertical-align: inherit;">
          字符串列的索引规范中的语法，可以创建仅使用</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的前</font><font style="vertical-align: inherit;">几个字符</font><font style="vertical-align: inherit;">的索引
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以这种方式仅索引列值的前缀可以使索引文件更小。</font><font style="vertical-align: inherit;">索引一
           </font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">或一
           </font><font style="vertical-align: inherit;">列时，您
           </font><span class="emphasis"><em><font style="vertical-align: inherit;">必须</font></em></span><font style="vertical-align: inherit;">指定索引的前缀长度。</font><font style="vertical-align: inherit;">例如：
        </font></font><code class="literal"><em class="replaceable"><code>col_name</code></em>(<em class="replaceable"><code>N</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"></font><span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE测试（blob_col BLOB，INDEX（blob_col（10）））;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          前缀长度可以达到1000字节（</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">为767字节
           </font><font style="vertical-align: inherit;">，除非已
           </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置）。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            前缀限制以字节为单位，而在前缀长度</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-index" title="13.1.14 CREATE INDEX语法"><code class="literal">CREATE INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句被解释为非二进制串类型的字符数（</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制串类型（）和字节数</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">BINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">VARBINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">为使用多字节字符集的非二进制字符串列指定前缀长度时，请考虑这一点。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关索引前缀的更多信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-index" title="13.1.14 CREATE INDEX语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.14节“CREATE INDEX语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="column-indexes-fulltext"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FULLTEXT索引</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104743696"></a><a class="indexterm" name="idm140528104742208"></a><p>
          <code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引用于全文搜索。</font><font style="vertical-align: inherit;">只有</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎支持
           </font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引和仅适用于
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">索引始终在整个列上进行，并且不支持列前缀索引。</font><font style="vertical-align: inherit;">有关详细信息，请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#fulltext-search" title="12.9全文搜索功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.9节“全文搜索功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化适用于</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对单个</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">某些类型的
           </font><font style="vertical-align: inherit;">查询
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">具有这些特征的查询特别有效：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 只返回文档ID或文档ID和搜索等级的查询。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询按匹配的降序对匹配的行进行排序，并应用一个
               </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句获取前N个匹配行。</font><font style="vertical-align: inherit;">为了应用这种优化，不得有
               </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款并且只有一个
               </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款按降序排列。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只检索</font></font><code class="literal">COUNT(*)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与搜索词相匹配的行</font><font style="vertical-align: inherit;">的
               </font><font style="vertical-align: inherit;">值的查询，没有附加</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              子句。</font><font style="vertical-align: inherit;">将该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">编码</font><font style="vertical-align: inherit;">为
               </font><font style="vertical-align: inherit;">没有任何</font><font style="vertical-align: inherit;">比较运算符。
</font></font><code class="literal">WHERE MATCH(<em class="replaceable"><code>text</code></em>)
              AGAINST
              ('<em class="replaceable"><code>other_text</code></em>')</code><font style="vertical-align: inherit;"></font><code class="literal">&gt; 0</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于包含全文表达式的查询，MySQL会在查询执行的优化阶段评估这些表达式。</font><font style="vertical-align: inherit;">优化器不仅查看全文表达式并进行估计，而且在开发执行计划的过程中实际评估它们。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此行为的含义是，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于全文查询，通常比在优化阶段没有进行表达式评估的非全文查询要慢。
        </font></font></p><p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于在优化过程中发生匹配，</font><font style="vertical-align: inherit;">全文查询可能会显示</font></font><code class="literal">Select tables optimized away</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中; </font><font style="vertical-align: inherit;">在这种情况下，在稍后的执行过程中不需要进行表访问。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="column-indexes-spatial"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空间索引</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104710576"></a><a class="indexterm" name="idm140528104709088"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以创建空间数据类型的索引。
          </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          支持空间类型的R-tree索引。</font><font style="vertical-align: inherit;">其他存储引擎使用B树来索引空间类型（除了
           </font></font><code class="literal">ARCHIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持空间类型索引）。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="column-indexes-memory-storage-engine"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEMORY存储引擎中的索引</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104703520"></a><a class="indexterm" name="idm140528104702032"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎使用
           </font></font><code class="literal">HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认的索引，而且还支持
           </font></font><code class="literal">BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="multiple-column-indexes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.5多列索引</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104696624"></a><a class="indexterm" name="idm140528104695552"></a><a class="indexterm" name="idm140528104694064"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL可以创建复合索引（即多列索引）。</font><font style="vertical-align: inherit;">索引最多可以包含16列。</font><font style="vertical-align: inherit;">对于某些数据类型，您可以索引列的前缀（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#column-indexes" title="8.3.4列索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.3.4节“列索引”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL可以对测试索引中所有列的查询使用多列索引，或者只测试第一列，前两列，前三列等等的查询。</font><font style="vertical-align: inherit;">如果您在索引定义中以正确的顺序指定列，则单个组合索引可以加速同一个表上的多种查询。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        多列索引可以被认为是一个有序数组，其行包含通过连接索引列的值创建的值。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          作为组合索引的替代方法，您可以引入</font><font style="vertical-align: inherit;">基于来自其他列的信息的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">如果此列较短，合理唯一且编制索引，则它可能比</font><font style="vertical-align: inherit;">许多列上</font><font style="vertical-align: inherit;">的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宽</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">更快</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在MySQL中，使用这个额外的列非常容易：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>hash_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= MD5（CONCAT（</font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND </font></font><em class="replaceable"><code>col1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>col2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设一张表具有以下规格：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE测试（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    last_name CHAR（30）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    first_name CHAR（30）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（id），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INDEX名称（姓氏，名字）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指数是在一个索引
         </font></font><code class="literal">last_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">first_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        列。</font><font style="vertical-align: inherit;">该索引可用于在查询中查找，以指定已知范围中的</font><font style="vertical-align: inherit;">
        值</font></font><code class="literal">last_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">first_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">组合
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它也可以用于仅指定</font></font><code class="literal">last_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">查询，
         </font><font style="vertical-align: inherit;">因为该列是索引的最左边的前缀（如本节后面所述）。</font><font style="vertical-align: inherit;">因此，该</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引用于以下查询中的查找：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM test WHERE last_name ='Widenius';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM测试</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE last_name ='Widenius'AND first_name ='Michael';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM测试</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE last_name ='Widenius'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND（first_name ='Michael'OR first_name ='Monty'）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM测试</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE last_name ='Widenius'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND first_name&gt; ='M'AND first_name &lt;'N';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引
         </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于以下查询中的查找：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM test WHERE first_name ='Michael';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM测试</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE last_name ='Widenius'OR first_name ='Michael';</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设您发出以下
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE col1 = </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND col2 = </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果一个多列索引存在于</font></font><code class="literal">col1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">col2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，相应的行可以直接取出。</font><font style="vertical-align: inherit;">如果在</font></font><code class="literal">col1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和上</font><font style="vertical-align: inherit;">存在单独的单列索引
         </font></font><code class="literal">col2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，优化器将尝试使用索引合并优化（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），或尝试通过确定哪个索引排除更多行并使用它来尝试查找最具限制性的索引该索引来获取行。
      </font></font></p><a class="indexterm" name="idm140528104663568"></a><a class="indexterm" name="idm140528104662080"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果表具有多列索引，则优化器可以使用该索引的任何最左边的前缀来查找行。</font><font style="vertical-align: inherit;">例如，如果你有一个三列索引上</font></font><code class="literal">(col1,
        col2, col3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你有索引的搜索功能
         </font></font><code class="literal">(col1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">(col1, col2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
         </font></font><code class="literal">(col1, col2, col3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果列不构成索引的最左边的前缀，则MySQL不能使用索引执行查找。</font><font style="vertical-align: inherit;">假设你有</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE col1 = </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE col1 = </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND col2 = </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE col2 = </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE col2 = </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND col3 = </font></font><em class="replaceable"><code>val3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果索引存在</font></font><code class="literal">(col1, col2, col3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则只有前两个查询使用该索引。</font><font style="vertical-align: inherit;">第三和第四个查询确实包括索引的列，但不使用索引来进行查找，因为</font></font><code class="literal">(col2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">(col2, col3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是的最左边的前缀
         </font></font><code class="literal">(col1, col2, col3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="verifying-index-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.6检验索引使用情况</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        始终检查您的所有查询是否确实使用您在表中创建的索引。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述</font><font style="vertical-align: inherit;">使用该
         </font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="index-statistics"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.7 InnoDB和MyISAM指数统计收集</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        存储引擎收集关于优化器使用的表的统计信息。</font><font style="vertical-align: inherit;">表统计信息基于值组，其中值组是具有相同关键字前缀值的一组行。</font><font style="vertical-align: inherit;">为了优化器的目的，重要的统计数据是平均值组大小。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL通过以下方式使用平均值组大小：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            估计每次</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问
           </font><font style="vertical-align: inherit;">必须读取的行数
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            估计部分连接将产生多少行; </font><font style="vertical-align: inherit;">也就是说，这个表单的操作将会产生的行数：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（...）JOIN </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ON </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>expr</code></em>
</pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        随着索引的平均值组大小增加，索引对于这两个目的的用处不大，因为每次查找的平均行数增加：为了使索引适合优化，最好每个索引值的目标是小表格中的行数。</font><font style="vertical-align: inherit;">当一个给定的索引值产生大量的行时，该索引不太有用，而MySQL不太可能使用它。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        平均值组大小与表基数有关，这是值组的数量。</font><font style="vertical-align: inherit;">该
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-index" title="13.7.5.22 SHOW INDEX语法"><code class="literal">SHOW INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句基于以下内容显示基数值：</font></font><em class="replaceable"><code>N/S</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中
         </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是表中的行数，并且</font></font><em class="replaceable"><code>S</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是平均值组大小。</font><font style="vertical-align: inherit;">该比率在表格中产生了近似数量的值组。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为联接基础上，</font></font><code class="literal">&lt;=&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比较运营商，</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有从任何其它值区别对待：</font></font><code class="literal">NULL &lt;=&gt; NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，就像</font><font style="vertical-align: inherit;">任何其他
         </font><font style="vertical-align: inherit;">。
      </font></font><code class="literal"><em class="replaceable"><code>N</code></em> &lt;=&gt;
        <em class="replaceable"><code>N</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但是，对于基于</font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符的连接，
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">不同</font><font style="vertical-align: inherit;">：
         </font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">或
         </font><font style="vertical-align: inherit;">（或两者）都不
         </font><font style="vertical-align: inherit;">是真时
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这会影响
         </font><font style="vertical-align: inherit;">对表单进行比较的访问</font><font style="vertical-align: inherit;">：如果当前值为</font><font style="vertical-align: inherit;">is </font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">则MySQL将不访问表
         </font><font style="vertical-align: inherit;">，因为比较不成立。
      </font></font><code class="literal"><em class="replaceable"><code>expr1</code></em> =
        <em class="replaceable"><code>expr2</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>expr1</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>expr2</code></em><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>tbl_name.key</code></em> =
        <em class="replaceable"><code>expr</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了</font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比较，</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中有</font><font style="vertical-align: inherit;">多少个</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">并不重要</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">出于优化目的，相关值是非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值组</font><font style="vertical-align: inherit;">的平均大小</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，MySQL目前不支持收集或使用平均大小。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font><font style="vertical-align: inherit;">
        表</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，您可以</font><font style="vertical-align: inherit;">分别</font><font style="vertical-align: inherit;">通过</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量来</font><font style="vertical-align: inherit;">控制表统计信息的收集
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些变量有三个可能的值，其不同之处如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当变量设置为时</font></font><code class="literal">nulls_equal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所有</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值都被视为相同（即它们都形成单个值组）。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值组大小远高于平均非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值组大小，则此方法会向上倾斜平均值组大小。</font><font style="vertical-align: inherit;">这使得索引对于优化器来说显得不如对于查找非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">联接有用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，该
             </font></font><code class="literal">nulls_equal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法可能会导致优化器</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在应该访问时</font><font style="vertical-align: inherit;">不使用索引进行
             </font><font style="vertical-align: inherit;">访问。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当变量设置为时
             </font></font><code class="literal">nulls_unequal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值不被视为相同。</font><font style="vertical-align: inherit;">相反，每个
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值形成一个大小为1的单独值组。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您有很多</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，则此方法会向下倾斜平均值组大小。</font><font style="vertical-align: inherit;">如果平均非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值组大小较大，</font><font style="vertical-align: inherit;">则将</font><font style="vertical-align: inherit;">值计算</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为一组大小1会导致优化程序高估查找非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值的</font><font style="vertical-align: inherit;">连接的索引</font><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">因此，</font><font style="vertical-align: inherit;">当其他方法可能更好时</font><font style="vertical-align: inherit;">，该</font></font><code class="literal">nulls_unequal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            方法可以使优化器使用该索引进行
             </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当变量设置为时
             </font></font><code class="literal">nulls_ignored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值将被忽略。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果你倾向于使用很多连接在使用
         </font></font><code class="literal">&lt;=&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是</font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值并不特殊，在比较和一个</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于另一个。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><code class="literal">nulls_equal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是适当的统计方法。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量具有全局值; </font><font style="vertical-align: inherit;">该
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量有全局和会话值。</font><font style="vertical-align: inherit;">设置全局值会影响相应存储引擎中表的统计信息收集。</font><font style="vertical-align: inherit;">设置会话值仅影响当前客户端连接的统计信息收集。</font><font style="vertical-align: inherit;">这意味着您可以强制使用给定方法重新生成表的统计信息，而不会通过设置会话值来影响其他客户端
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要重新生成</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格统计信息，可以使用以下任何一种方法：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --stats_method =  - </font></font><em class="replaceable"><code>method_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            分析</font></font></strong></span></a>
          </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            更改表使其统计信息过期（例如，插入一行然后删除它），然后设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并发布一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        关于使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的
         </font><font style="vertical-align: inherit;">一些注意事项
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如刚才所描述的，您可以强制显示表格统计信息。</font><font style="vertical-align: inherit;">但是，MySQL也可能会自动收集统计信息。</font><font style="vertical-align: inherit;">例如，如果在为表执行语句的过程中，其中一些语句会修改表，MySQL可能会收集统计信息。</font><font style="vertical-align: inherit;">（例如，对于批量插入或删除或某些</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，</font><font style="vertical-align: inherit;">可能会发生
             </font><font style="vertical-align: inherit;">这种情况。）如果发生这种情况，统计信息将使用任何值
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
            </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在那个时候。</font><font style="vertical-align: inherit;">因此，如果您使用一种方法收集统计信息，但是稍后自动收集表的统计信息时将系统变量设置为其他方法，则将使用其他方法。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            无法确定哪种方法用于为给定的表生成统计信息。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些变量仅适用于</font><font style="vertical-align: inherit;">表格</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。</font><font style="vertical-align: inherit;">其他存储引擎只有一种收集表格统计信息的方法。</font><font style="vertical-align: inherit;">通常它更接近该</font></font><code class="literal">nulls_equal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="index-btree-hash"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.8 B树和散列索引的比较</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104560656"></a><a class="indexterm" name="idm140528104559616"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        了解B树和散列数据结构可以帮助预测不同的查询在使用索引中的这些数据结构的不同存储引擎上的性能，特别是用于</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许您选择B树或散列索引</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">存储引擎。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#btree-index-characteristics" title="B树索引特征"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B树索引特征</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#hash-index-characteristics" title="哈希指数特征"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希指数特征</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="btree-index-characteristics"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B树索引特征</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104553632"></a><a class="indexterm" name="idm140528104552144"></a><a class="indexterm" name="idm140528104550656"></a><a class="indexterm" name="idm140528104549168"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          A B树索引可以在使用表达式中使用的对列的比较
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal"><code class="literal">=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than"><code class="literal">&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than"><code class="literal">&lt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运营商。</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果参数为</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是以通配符开头的常量字符串，则</font><font style="vertical-align: inherit;">索引也可用于</font><font style="vertical-align: inherit;">比较
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句使用索引：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择*从</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪里</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'帕特里克％';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIKE '％专利％_ck';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在第一条语句中，只</font><font style="vertical-align: inherit;">考虑了</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在第二条语句中，只</font><font style="vertical-align: inherit;">考虑了</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">。
        </font></font><code class="literal">'Patrick'
          &lt;= <em class="replaceable"><code>key_col</code></em> &lt;
          'Patricl'</code><font style="vertical-align: inherit;"></font><code class="literal">'Pat' &lt;=
          <em class="replaceable"><code>key_col</code></em> &lt; 'Pau'</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句不使用索引：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择*从</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪里</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'％Patrick％';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIKE </font></font><em class="replaceable"><code>other_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在第一个语句中，该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值以通配符开头。</font><font style="vertical-align: inherit;">在第二个声明中，该</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_like"><code class="literal">LIKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不是一个常数。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您使用</font><font style="vertical-align: inherit;">并且
           </font><font style="vertical-align: inherit;">长度超过三个字符，则MySQL使用</font><span class="firstterm"><font style="vertical-align: inherit;">Turbo Boyer-Moore算法</font></span><font style="vertical-align: inherit;">来初始化字符串的模式，然后使用此模式更快地执行搜索。
        </font></font><code class="literal">... LIKE
          '%<em class="replaceable"><code>string</code></em>%'</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>string</code></em><font style="vertical-align: inherit;"></font><span class="firstterm"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></p><a class="indexterm" name="idm140528104519424"></a><a class="indexterm" name="idm140528104517936"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><code class="literal"><em class="replaceable"><code>col_name</code></em> IS
          NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引
           </font><font style="vertical-align: inherit;">搜索</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不跨越</font><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">所有</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别的
           </font><font style="vertical-align: inherit;">任何索引
           </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都不用于优化查询。</font><font style="vertical-align: inherit;">换句话说，为了能够使用索引，必须在每个</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_and"><code class="literal">AND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组中</font><font style="vertical-align: inherit;">使用索引的前缀
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款使用索引：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... WHERE </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>index_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 AND </font></font><em class="replaceable"><code>other_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 3</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / * </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 OR </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... WHERE </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1或A = 10 AND </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / *优化如“ </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='hello'”* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... WHERE </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='你好'AND </font></font><em class="replaceable"><code>index_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 5</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / *可以使用索引</font></font><em class="replaceable"><code>index1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不是</font></font><em class="replaceable"><code>index2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em class="replaceable"><code>index3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... WHERE </font></font><em class="replaceable"><code>index1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>index2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 OR </font></font><em class="replaceable"><code>index1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 3 AND </font></font><em class="replaceable"><code>index3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 3;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款
           </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用索引：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    / * </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未使用* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... WHERE </font></font><em class="replaceable"><code>index_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>index_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / *索引不用于WHERE子句的两个部分* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... WHERE </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1或A = 10</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / *没有索引跨越所有行* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... WHERE </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 OR </font></font><em class="replaceable"><code>index_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有时MySQL不使用索引，即使有索引。</font><font style="vertical-align: inherit;">出现这种情况的一种情况是，优化程序估计使用索引需要MySQL访问表中非常大部分的行。</font><font style="vertical-align: inherit;">（在这种情况下，表扫描可能会快得多，因为它需要更少的搜索。）但是，如果这样的查询</font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅用于检索某些行，则MySQL无论如何都会使用索引，因为它可以更快地找到结果中返回的行数很少。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="hash-index-characteristics"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希指数特征</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104492784"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          哈希索引与刚刚讨论的哈希索引有些不同：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它们只用于使用等于比较
               </font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">&lt;=&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              运营商（但</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快）。</font><font style="vertical-align: inherit;">它们不用于比较运算符，比如
               </font></font><code class="literal">&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到一系列值。</font><font style="vertical-align: inherit;">依赖这种单值查找的系统被称为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键值存储</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">为这些应用程序使用MySQL，尽可能使用散列索引。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              优化器不能使用散列索引来加速
               </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作。</font><font style="vertical-align: inherit;">（这种类型的索引不能用于按顺序搜索下一个条目。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL不能确定两个值之间大约有多少行（范围优化器使用它来决定使用哪个索引）。</font><font style="vertical-align: inherit;">如果您将某个</font><font style="vertical-align: inherit;">表</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表更改为散列索引
               </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，</font><font style="vertical-align: inherit;">这可能会影响某些查询</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              只有整个键才能用来搜索一行。</font><font style="vertical-align: inherit;">（使用B树索引，可以使用密钥的任何最左边的前缀来查找行。）
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="index-extensions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.9使用索引扩展</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104479360"></a><p>
        <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过附加主键列来自动扩展每个二级索引。</font><font style="vertical-align: inherit;">考虑这个表格定义：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  i1 INT NOT NULL DEFAULT 0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  i2 INT NOT NULL DEFAULT 0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  d DATE DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PRIMARY KEY（i1，i2），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  INDEX k_d（d）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该表定义列上的主键</font></font><code class="literal">(i1,
        i2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它还</font></font><code class="literal">k_d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在列上</font><font style="vertical-align: inherit;">定义了二级索引
         </font></font><code class="literal">(d)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但在内部</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展了该索引并将其视为列</font></font><code class="literal">(d, i1, i2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化程序在确定如何以及是否使用该索引时会考虑扩展二级索引的主键列。</font><font style="vertical-align: inherit;">这可以导致更高效的查询执行计划和更好的性能。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化器可以使用扩展次要索引
         </font></font><code class="literal">ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">index_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引访问，为松散索引扫描，对于加入和排序的优化，以及用于
         </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_min"><code class="literal">MIN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_max"><code class="literal">MAX()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下示例显示了执行计划如何受到优化程序是否使用扩展辅助索引的影响。</font><font style="vertical-align: inherit;">假设</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些行被填充：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO t1 VALUES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（1,1，'1998-01-01'），（1,2，'1999-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（1，3，'2000-01-01'），（1，4，'2001-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（1，5，'2002-01-01'），（2,1，'1998-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（2，2，'1999-01-01'），（2,3，'2000-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（2,4，'2001-01-01'），（2，5，'2002-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（3,1，'1998-01-01'），（3,2，'1999-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（3,3，'2000-01-01'），（3,4，'2001-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（3，5，'2002-01-01'），（4,1，'1998-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（4，2，'1999-01-01'），（4，3，'2000-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（4，4，'2001-01-01'），（4，5，'2002-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（5,1，'1998-01-01'），（5,2，'1999-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（5，3，'2000-01-01'），（5，4，'2001-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（5，5，'2002-01-01'）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        现在考虑这个查询：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN SELECT COUNT（*）FROM t1 WHERE i1 = 3 AND d ='2000-01-01'
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这种情况下，优化程序不能使用主键，因为它包含列</font></font><code class="literal">(i1, i2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">且查询未引用</font></font><code class="literal">i2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">取而代之的是，优化器可以使用二级索引</font></font><code class="literal">k_d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上
         </font></font><code class="literal">(d)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且执行计划依赖于扩展索引是否被使用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当优化器不考虑索引扩展时，它将索引</font></font><code class="literal">k_d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视为唯一</font></font><code class="literal">(d)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为查询产生这个结果：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = '2000-01-01'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY，k_d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：k_d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用where; </font><font style="vertical-align: inherit;">使用索引</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当优化需要索引扩展到帐户，它把</font></font><code class="literal">k_d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><code class="literal">(d, i1, i2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，它可以使用最左边的索引前缀</font></font><code class="literal">(d,
        i1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来产生更好的执行计划：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = '2000-01-01'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY，k_d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：k_d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const，const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在这两种情况下，都</font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表明优化器将使用二级索引，</font></font><code class="literal">k_d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示了使用扩展索引的这些改进：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从4个字节到8个字节去，表明键查找中使用的列</font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            和</font></font><code class="literal">i1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不仅仅是</font></font><code class="literal">d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从价值变动
             </font></font><code class="literal">const</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><code class="literal">const,const</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            ，因为键查找使用两个关键部分，没有之一。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的</font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计数降低从5到1，表明</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该需要检查更少的行，以产生结果。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值从变化
             </font></font><code class="literal">Using where; Using index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到
             </font></font><code class="literal">Using index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着可以仅使用索引读取行，而无需查阅数据行中的列。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用扩展索引的优化器行为差异也可以通过以下方式看出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FLUSH TABLE t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH STATUS;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT COUNT（*）FROM t1 WHERE i1 = 3 AND d ='2000-01-01';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHOW STATUS LIKE'handler_read％'</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        前面的语句包含</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH
        TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-status"><code class="literal">FLUSH STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        刷新表缓存并清除状态计数器。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        没有索引扩展，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生这样的结果：
      </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ----------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_first | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_key | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_last | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_next | </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_prev | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_rnd | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_rnd_next | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过索引扩展，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成此结果。</font><font style="vertical-align: inherit;">该
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Handler_read_next"><code class="literal">Handler_read_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值从5减少到1，表示更有效地使用该指数：
      </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ----------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_first | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_key | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_last | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_next | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_prev | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_rnd | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_rnd_next | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在确定如何使用</font><font style="vertical-align: inherit;">表的二级索引</font><font style="vertical-align: inherit;">时</font></font><code class="literal">use_index_extensions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">
        的</font><font style="vertical-align: inherit;">标志
         </font><font style="vertical-align: inherit;">允许控制优化程序是否考虑主键列
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，
         </font></font><code class="literal">use_index_extensions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已启用。</font><font style="vertical-align: inherit;">要检查禁用索引扩展是否会提高性能，请使用以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='use_index_extensions = off';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化器使用索引扩展受索引（16）中关键部分数量和最大关键字长度（3072字节）的通常限制。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="generated-column-index-optimizations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.10优化器使用生成的列索引</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL支持生成列上的索引。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（f1 INT，gc INT AS（f1 + 1）STORED，INDEX（gc））;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        生成的列</font></font><code class="literal">gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被定义为表达式</font></font><code class="literal">f1 + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该列也被编入索引，并且优化程序可以在执行计划构建期间考虑该索引。</font><font style="vertical-align: inherit;">在以下查询中，该
         </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句引用</font></font><code class="literal">gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        并且优化器考虑该列上的索引是否产生更高效的计划：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE gc&gt; 9;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化器可以在生成的列上使用索引来生成执行计划，即使没有按名称对这些列进行查询时的直接引用。</font><font style="vertical-align: inherit;">会发生此如果
         </font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款是指一些索引生成列的定义相匹配的表达式。</font><font style="vertical-align: inherit;">以下查询不直接引用，</font></font><code class="literal">gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        但使用的表达式符合以下定义
         </font></font><code class="literal">gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE f1 + 1&gt; 9;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化器识别出表达</font></font><code class="literal">f1 +
        1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的定义相匹配</font></font><code class="literal">gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且</font></font><code class="literal">gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被索引，因此它认为执行计划在施工期间的索引。</font><font style="vertical-align: inherit;">你可以看到这个使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM t1 WHERE f1 + 1 &gt; 9\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：gc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：gc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引条件</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        实际上，优化程序已将表达式替换为与表达式</font></font><code class="literal">f1
        + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配的生成列的名称。</font><font style="vertical-align: inherit;">在以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        显示</font><font style="vertical-align: inherit;">的扩展</font><font style="vertical-align: inherit;">信息中</font><font style="vertical-align: inherit;">可用的重写查询中也很明显</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW
        WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  级别：注意</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Message：/ * select＃1 * / select`test`.`t1`.`f1` as``f1`，`test`.`t1`.`gc`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         as```````````````gc`</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下限制和条件适用于优化器使用生成的列索引：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于查询表达式来匹配生成的列定义，表达式必须相同，并且它必须具有相同的结果类型。</font><font style="vertical-align: inherit;">例如，如果生成的列表达式是</font></font><code class="literal">f1 + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果查询使用</font></font><code class="literal">1 + f1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者</font></font><code class="literal">f1 + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            （整数表达式）与字符串进行比较</font><font style="vertical-align: inherit;">，则优化器不会识别匹配
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化适用于这些操作符：
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal"><code class="literal">=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than"><code class="literal">&lt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than"><code class="literal">&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font><font style="vertical-align: inherit;">以外的
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作符，可以用匹配的生成列替换操作数。</font><font style="vertical-align: inherit;">对于
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只有第一个参数可以被匹配的生成列替换，其他参数必须具有相同的结果类型。
            </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尚未支持涉及JSON值的比较。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            生成的列必须被定义为一个表达式，该表达式至少包含一个函数调用或上述项目中提到的操作符之一。</font><font style="vertical-align: inherit;">表达式不能包含对另一列的简单引用。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">gc INT AS (f1) STORED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅由一个列引用组成，因此</font></font><code class="literal">gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不考虑</font><font style="vertical-align: inherit;">索引
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了将字符串与索引生成列进行比较，这些字段从返回带引号字符串的JSON函数计算值，</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_json-unquote"><code class="literal">JSON_UNQUOTE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要在列定义中从函数值中删除多余的引号。</font><font style="vertical-align: inherit;">（对于字符串与函数结果的直接比较，JSON比较器处理引用移除，但这不会发生在索引查找中）。例如，不是像这样写一个列定义：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doc_name TEXT AS（JSON_EXTRACT（jdoc，'$ .name'））存储
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这样写：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doc_name TEXT AS（JSON_UNQUOTE（JSON_EXTRACT（jdoc，'$ .name'）））STORED
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于后者的定义，优化器可以检测这两个比较的匹配情况：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... WHERE JSON_EXTRACT（jdoc，'$ .name'）=' </font></font><em class="replaceable"><code>some_string</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... WHERE JSON_UNQUOTE（JSON_EXTRACT（jdoc，'$ .name'））=' </font></font><em class="replaceable"><code>some_string</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'...
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果没有</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_json-unquote"><code class="literal">JSON_UNQUOTE()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在列定义中，优化器只会对这些比较中的第一个进行匹配。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果优化器未能选择所需的索引，则可以使用索引提示来强制优化器做出不同的选择。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-database-structure"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4优化数据库结构</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#data-size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.1优化数据大小</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-data-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2优化MySQL数据类型</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-multi-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.3优化许多表</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#internal-temporary-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.4在MySQL中使用内部临时表</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在作为数据库设计师的角色中，寻找组织模式，表和列的最有效方式。</font><font style="vertical-align: inherit;">与调整应用程序代码时一样，您可以最大限度地减少I / O，将相关项目集中在一起，并提前进行计划，以便随着数据量的增加性能保持在较高水平 </font><font style="vertical-align: inherit;">从高效的数据库设计开始，团队成员可以更轻松地编写高性能的应用程序代码，并使数据库可以随应用程序的演变和重写而持续下去。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="data-size"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.1优化数据大小</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528104351472"></a><a class="indexterm" name="idm140528104349984"></a><a class="indexterm" name="idm140528104348496"></a><a class="indexterm" name="idm140528104347008"></a><a class="indexterm" name="idm140528104345520"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        设计您的表格以尽量减少磁盘空间。</font><font style="vertical-align: inherit;">这可以通过减少写入和读取磁盘的数据量来实现巨大的改进。</font><font style="vertical-align: inherit;">在查询执行期间，较小的表格通常需要较少的主存储器，而其内容正在被主动处理。</font><font style="vertical-align: inherit;">表数据的任何空间减少也会导致可以更快处理的较小索引。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL支持许多不同的存储引擎（表格类型）和行格式。</font><font style="vertical-align: inherit;">对于每个表格，您可以决定使用哪种存储和索引方法。</font><font style="vertical-align: inherit;">为您的应用程序选择适当的表格格式可以为您带来巨大的性能提升。</font><font style="vertical-align: inherit;">请参阅
         </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InnoDB存储引擎</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html" title="第15章备用存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备用存储引擎</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通过使用此处列出的技术，您可以获得更好的表格性能并最小化存储空间：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#data-size-table-columns" title="表列"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表列</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#data-size-row-format" title="行格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行格式</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#data-size-indexes" title="索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#data-size-joins" title="加盟"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加盟</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#data-size-normalization" title="正常化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常化</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="data-size-table-columns"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表列</font></font></h4>

</div>

</div>

</div>

<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              尽可能使用最有效（最小）的数据类型。</font><font style="vertical-align: inherit;">MySQL有很多专门的类型可以节省磁盘空间和内存。</font><font style="vertical-align: inherit;">例如，如果可能的话，使用较小的整数类型来获取较小的表格。
              </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">MEDIUMINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常是一个更好的选择，</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">INT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为一
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">MEDIUMINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列使用的空间减少了25％。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果可能的话，</font><font style="vertical-align: inherit;">
              声明列</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过更好地使用索引并消除测试每个值是否存在开销，它使SQL操作更快</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您还可以节省一些存储空间，每列一位。</font><font style="vertical-align: inherit;">如果您真的需要</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格中的值，请使用它们。</font><font style="vertical-align: inherit;">只需避免允许</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每列中的值</font><font style="vertical-align: inherit;">的默认设置
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="data-size-row-format"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行格式</font></font></h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font></font><code class="literal">DYNAMIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">行格式</font><font style="vertical-align: inherit;">创建
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要</font><font style="vertical-align: inherit;">在a </font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">明确</font><font style="vertical-align: inherit;">使用除了</font></font><code class="literal">DYNAMIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，配置
               </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或指定</font></font><code class="literal">ROW_FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">以外的行格式</font><font style="vertical-align: inherit;">。
            </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
              TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
              TABLE</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              行格式的紧凑系列，其中包括
               </font></font><code class="literal">COMPACT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">DYNAMIC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">COMPRESSED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以减少某些操作的CPU使用为代价来减少行存储空间。</font><font style="vertical-align: inherit;">如果您的工作负载是受缓存命中率和磁盘速度限制的典型负载，则可能会更快。</font><font style="vertical-align: inherit;">如果这是一个受CPU速度限制的罕见情况，则可能会变慢。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              紧凑的行格式系列还可以</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用诸如</font></font><code class="literal">utf8mb3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">的可变长度字符集时</font><font style="vertical-align: inherit;">优化
               </font><font style="vertical-align: inherit;">列存储
               </font></font><code class="literal">utf8mb4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">ROW_FORMAT=REDUNDANT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font><font style="vertical-align: inherit;">
              占用</font><font style="vertical-align: inherit;">字符集的最大字节长度×。</font><font style="vertical-align: inherit;">许多语言主要使用单字节</font><font style="vertical-align: inherit;">字符</font><font style="vertical-align: inherit;">编写
               </font><font style="vertical-align: inherit;">，因此固定的存储长度通常会浪费空间。</font><font style="vertical-align: inherit;">使用紧凑的行格式</font><font style="vertical-align: inherit;">系列，</font><font style="vertical-align: inherit;">可</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">to
               </font><font style="vertical-align: inherit;">范围内分配可变数量的存储空间
              </font></font><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font><code class="literal">utf8</code><font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">×通过去除尾部空格来为这些列设置字符集的最大字节长度。</font><font style="vertical-align: inherit;">最小存储长度为
               </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节，便于在典型情况下进行就地更新。</font><font style="vertical-align: inherit;">有关更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-physical-record" title="14.8.1.2 InnoDB表的物理行结构"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.8.1.2节“InnoDB表的物理行结构”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要通过以压缩形式存储表数据来进一步减少空间，请</font></font><code class="literal">ROW_FORMAT=COMPRESSED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在创建</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">时
               </font><font style="vertical-align: inherit;">指定
               </font><font style="vertical-align: inherit;">，或</font><font style="vertical-align: inherit;">在现有</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">运行
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令
               </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩表是可读可写的，而</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩表是只读的。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中，如果没有任何可变长度列（</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列），一个固定大小的行格式被使用。</font><font style="vertical-align: inherit;">这会更快，但可能会浪费一些空间。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#myisam-table-formats" title="15.2.3 MyISAM表格存储格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15.2.3节“MyISAM表格存储格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">即使</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中包含</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
               </font><font style="vertical-align: inherit;">，您也可以提示您想要固定长度的行</font></font><code class="literal">ROW_FORMAT=FIXED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="data-size-indexes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表格的主要索引应尽可能短。</font><font style="vertical-align: inherit;">这使得每一行的识别简单而有效。</font><font style="vertical-align: inherit;">对于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，主键列在每个二级索引条目中都是重复的，所以如果有很多二级索引，则较短的主键会节省相当多的空间。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              只创建您需要提高查询性能的索引。</font><font style="vertical-align: inherit;">索引很适合检索，但会减慢插入和更新操作。</font><font style="vertical-align: inherit;">如果您主要通过在列组合上搜索来访问表，请在其上创建一个合成索引，而不是每个列的单独索引。</font><font style="vertical-align: inherit;">指数的第一部分应该是最常用的列。</font><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">从表格中选择时</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用多列，则索引中的第一列应该是重复次数最多的列，以便更好地压缩索引。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果长字符串列很可能在第一个字符数上有一个唯一的前缀，那么最好只索引这个前缀，使用MySQL支持在列的最左边部分创建一个索引（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-index" title="13.1.14 CREATE INDEX语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.14节，“CREATE INDEX Syntax”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">更短的索引速度更快，不仅因为它们需要更少的磁盘空间，而且还因为它们还会在索引缓存中为您提供更多的点击量，因此磁盘搜索量也更少。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-configuration" title="5.1.1配置服务器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="data-size-joins"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加盟</font></font></h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在某些情况下，分割成两个经常扫描的表格可能是有益的。</font><font style="vertical-align: inherit;">如果它是一个动态格式的表格，并且可以使用一个较小的静态格式表格来扫描表格时可以用来查找相关的行，那么情况尤其如此。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在具有相同数据类型的不同表中使用相同信息声明列，以根据相应列加快联接。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              保持列名简单，以便您可以在不同的表中使用相同的名称并简化连接查询。</font><font style="vertical-align: inherit;">例如，在一个名为table的表中</font></font><code class="literal">customer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用一个列名来</font></font><code class="literal">name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替
               </font></font><code class="literal">customer_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了让您的名字可移植到其他SQL服务器，请考虑将它们保持为少于18个字符。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="data-size-normalization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常化</font></font></h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通常，尽量保持所有数据不冗余（观察数据库理论中提到的
               </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三范式</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">不必重复诸如名称和地址之类的冗长值，而是为它们分配唯一的ID，根据需要在多个较小的表中重复这些ID，并通过引用join子句中的ID来加入查询中的表。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果速度比磁盘空间更重要以及保留多个数据副本的维护成本（例如，在分析大型表中的所有数据的商业智能场景中），则可以放宽规范化规则，复制信息或创建汇总表以获得更多速度。
</font></font></p></li></ul>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimize-data-types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2优化MySQL数据类型</font></font></h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-numeric"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2.1优化数字数据</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-character"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2.2优化字符和字符串类型</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimize-blob"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2.3优化BLOB类型</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#procedure-analyse"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2.4使用PROCEDURE ANALYZE</font></font></a></span></dt></dl>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="optimize-numeric"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2.1优化数字数据</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104264880"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于可以表示为字符串或数字的唯一ID或其他值，首选数字列来对字符串进行字符串。</font><font style="vertical-align: inherit;">由于较大的数字值可以以比相应的字符串更少的字节存储，因此速度更快，并且需要更少的内存来传输和比较它们。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您使用的是数字数据，在许多情况下访问数据库（使用实时连接）的信息比访问文本文件要快。</font><font style="vertical-align: inherit;">数据库中的信息可能以比文本文件更紧凑的格式存储，因此访问它涉及更少的磁盘访问。</font><font style="vertical-align: inherit;">您还可以将代码保存在应用程序中，因为您可以避免解析文本文件以查找行和列边界。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="optimize-character"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2.2优化字符和字符串类型</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104259216"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于字符和字符串列，请遵循以下准则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果不需要特定于语言的归类功能，请使用二进制归类顺序进行快速比较和排序操作。</font><font style="vertical-align: inherit;">您可以使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_binary"><code class="literal">BINARY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作员在特定查询中使用二进制排序规则。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在比较不同列的值时，请尽可能使用相同的字符集和归类来声明这些列，以避免在运行查询时进行字符串转换。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于小于8KB大小的列值，请使用二进制
               </font></font><code class="literal">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替
               </font></font><code class="literal">BLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              和</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款可以生成临时表，这些临时表可以使用的
               </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，如果原来的表不包含任何</font></font><code class="literal">BLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              列。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果一个表包含字符串列（如名称和地址），但许多查询不检索这些列，请考虑将字符串列拆分为单独的表，并在必要时使用具有外键的连接查询。</font><font style="vertical-align: inherit;">当MySQL从一行中检索任何值时，它会读取一个包含该行所有列（可能还有其他相邻行）的数据块。</font><font style="vertical-align: inherit;">保持每行较小，只有最常用的列，允许更多的行适合每个数据块。</font><font style="vertical-align: inherit;">这些紧凑的表格减少了常见查询的磁盘I / O和内存使用量。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在表中使用随机生成的值作为主键</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，如果可能，请使用升序值（如当前日期和时间）作为前缀。</font><font style="vertical-align: inherit;">当连续的主值被物理地存储在彼此附近时，</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以更快地插入和检索它们。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关</font><font style="vertical-align: inherit;">数字列通常比等效字符串列更可取的原因</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimize-numeric" title="8.4.2.1优化数字数据"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimize-numeric" title="8.4.2.1优化数字数据"><font style="vertical-align: inherit;">第8.4.2.1节“针对数字数据优化”</font></a><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="optimize-blob"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2.3优化BLOB类型</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104241088"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              存储包含文本数据的大块时，请考虑先压缩它。</font><font style="vertical-align: inherit;">当整个表被压缩，则不能使用这种技术
               </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于包含多个列的表，为了减少不使用BLOB列的查询的内存要求，请考虑将BLOB列拆分为单独的表，并在需要时使用连接查询引用它。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于检索和显示BLOB值的性能要求可能与其他数据类型有很大的不同，因此可以将BLOB特定的表放在不同的存储设备上，甚至是单独的数据库实例中。</font><font style="vertical-align: inherit;">例如，要检索BLOB可能需要大量的顺序磁盘读取，这比较适合传统硬盘驱动器而非
               </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_ssd" title="SSD"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSD设备</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有关</font><font style="vertical-align: inherit;">二进制</font><font style="vertical-align: inherit;">列有时比等效BLOB列更可取的</font><font style="vertical-align: inherit;">原因</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimize-character" title="8.4.2.2优化字符和字符串类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimize-character" title="8.4.2.2优化字符和字符串类型"><font style="vertical-align: inherit;">第8.4.2.2节“针对字符和字符串类型优化”</font></a></font><code class="literal">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您可以将列值的散列存储在单独的列中，对该列进行索引并在查询中测试散列值，而不是针对非常长的文本字符串测试相等性。</font><font style="vertical-align: inherit;">（使用</font></font><code class="literal">MD5()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">CRC32()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数来生成散列值。）由于散列函数可能会为不同的输入产生重复结果，因此您仍然</font><font style="vertical-align: inherit;">在查询中</font><font style="vertical-align: inherit;">包含一个子句
               </font><font style="vertical-align: inherit;">以防止错误匹配; </font><font style="vertical-align: inherit;">性能优势来自散列值的更小，易于扫描的索引。
</font></font><code class="literal">AND <em class="replaceable"><code>blob_column</code></em> =
              <em class="replaceable"><code>long_string_value</code></em></code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="procedure-analyse"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2.4使用PROCEDURE ANALYZE</font></font></h4>

</div>

</div>

</div>
<p>
          <code class="literal">ANALYSE([<em class="replaceable"><code>max_elements</code></em>[,<em class="replaceable"><code>max_memory</code></em>]])</code>
</p><a class="indexterm" name="idm140528104219696"></a><a class="indexterm" name="idm140528104218624"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
            <code class="literal">PROCEDURE ANALYSE()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 从MySQL 5.7.18开始已弃用，并在MySQL 8.0中删除。
</font></font></p>
</div>
<p>
          <code class="literal">ANALYSE()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查查询的结果并返回结果分析，为每列提供最佳数据类型，这可能有助于减小表格大小。</font><font style="vertical-align: inherit;">要获得此分析，请附加</font></font><code class="literal">PROCEDURE
          ANALYSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">的结尾处
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM ... WHERE ... PROCEDURE ANALYZE（[ </font></font><em class="replaceable"><code>max_elements</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，[ </font></font><em class="replaceable"><code>max_memory</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]]）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT col1，col2 FROM table1 PROCEDURE ANALYZE（10，2000）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          结果显示查询返回值的一些统计信息，并为列提出最佳数据类型。</font><font style="vertical-align: inherit;">这对于检查现有表格或导入新数据后可能会有所帮助。</font><font style="vertical-align: inherit;">您可能需要为参数尝试不同的设置，以便在</font></font><code class="literal">PROCEDURE
          ANALYSE()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#enum" title="11.4.4 ENUM类型"><code class="literal">ENUM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当时</font><font style="vertical-align: inherit;">不会显示
           </font><font style="vertical-align: inherit;">数据类型。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          参数是可选的，使用如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>max_elements</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认值为256）是</font></font><code class="literal">ANALYSE()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每列通知</font><font style="vertical-align: inherit;">的最大不同值的数量
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这用于</font></font><code class="literal">ANALYSE()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查最佳数据类型是否应该是类型的
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#enum" title="11.4.4 ENUM类型"><code class="literal">ENUM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">如果有多个</font></font><em class="replaceable"><code>max_elements</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的值，则</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#enum" title="11.4.4 ENUM类型"><code class="literal">ENUM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是建议的类型。
            </font></font></p></li><li class="listitem"><p>
              <em class="replaceable"><code>max_memory</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认8192）是</font></font><code class="literal">ANALYSE()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在尝试查找所有不同值时应分配每列</font><font style="vertical-align: inherit;">的最大内存量
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          一个</font></font><code class="literal">PROCEDURE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款是不是在允许的
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimize-multi-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.3优化许多表</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#table-cache"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.3.1 MySQL如何打开和关闭表格</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#creating-many-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.3.2在同一数据库中创建多个表的缺点</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528104193184"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一些快速保存单个查询的技术涉及将数据分割到多个表中。</font><font style="vertical-align: inherit;">当表的数量达到数千甚至数百万时，处理所有这些表的开销成为新的性能考虑因素。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="table-cache"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.3.1 MySQL如何打开和关闭表格</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528104189936"></a><a class="indexterm" name="idm140528104188896"></a><a class="indexterm" name="idm140528104187408"></a><a class="indexterm" name="idm140528104185920"></a><a class="indexterm" name="idm140528104184432"></a><a class="indexterm" name="idm140528104182944"></a><a class="indexterm" name="idm140528104181872"></a><a class="indexterm" name="idm140528104180384"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当你执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin status</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          命令时，你应该看到如下所示的内容：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常运行时间：426正在运行的线程：1问题：11082</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重新加载：1打开表格：12</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><code class="literal">Open tables</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果你只有六张桌子，12 </font><font style="vertical-align: inherit;">
          的</font><font style="vertical-align: inherit;">价值可能会有点令人费解。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL是多线程的，因此可能有很多客户端同时为给定的表发出查询。</font><font style="vertical-align: inherit;">为了尽量减少多个客户端会话在同一个表上具有不同状态的问题，该表由每个并发会话独立打开。</font><font style="vertical-align: inherit;">这使用额外的内存，但通常会提高性能。</font><font style="vertical-align: inherit;">使用</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，打开表格的每个客户端的数据文件都需要一个额外的文件描述符。</font><font style="vertical-align: inherit;">（相比之下，索引文件描述符在所有会话之间共享。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量影响服务器保持打开的文件的最大数量。</font><font style="vertical-align: inherit;">如果您增加这些值中的一个或两个值，则可能会受到操作系统对每个进程打开的文件描述符数量的限制。</font><font style="vertical-align: inherit;">许多操作系统允许您增加打开文件的限制，但方法在系统之间差别很大。</font><font style="vertical-align: inherit;">请查阅您的操作系统文档以确定是否可以增加限制以及如何这样做。
        </font></font></p><p>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与...有关</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，对于200个并发运行连接，请至少指定一个表缓存大小</font><font style="vertical-align: inherit;">，其中
           </font><font style="vertical-align: inherit;">是您执行的任何查询中每个连接的最大表数量。</font><font style="vertical-align: inherit;">您还必须为临时表和文件保留一些额外的文件描述符。
        </font></font><code class="literal">200 *
          <em class="replaceable"><code>N</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          确保您的操作系统可以处理</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">隐含的打开文件描述符的数量
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置得太高，MySQL可能会耗尽文件描述符并拒绝连接，无法执行查询，并且非常不可靠。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您还应该考虑到</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎对于每个独特的打开表格需要两个文件描述符</font><font style="vertical-align: inherit;">的事实
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于分区
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，打开的表的每个分区都需要两个文件描述符。</font><font style="vertical-align: inherit;">（还要注意，当</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开一个分区表时，它会打开这个表的每个分区，不管是否实际使用了一个给定的分区，参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-limitations-myisam-file-descriptors" title="MyISAM和分区文件描述符用法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyISAM和分区文件描述符的用法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）你可以增加MySQL可用的文件描述符的数量
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_open-files-limit"><code class="option">--open-files-limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动选项到</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#not-enough-file-handles" title="B.5.2.17未找到文件和类似的错误"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.2.17节“找不到文件和类似的错误”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          打开表格的缓存保存在</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目</font><font style="vertical-align: inherit;">级别
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">服务器在启动时自动调整缓存大小。</font><font style="vertical-align: inherit;">要明确设置大小，请</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启动时</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">请注意，MySQL可能暂时打开更多的表来执行查询。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在下列情况下，MySQL会关闭一个未使用的表并将其从表缓存中删除：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当缓存已满并且线程尝试打开不在缓存中的表时。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当缓存包含多个</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目并且</font><font style="vertical-align: inherit;">缓存中
               </font><font style="vertical-align: inherit;">的表不再被任何线程使用时。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表冲洗操作发生时。</font><font style="vertical-align: inherit;">当有人发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH
              TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或执行
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-tables</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin refresh</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">时会发生这种情况</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当表缓存填满时，服务器使用以下过程来查找要使用的缓存条目：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当前未使用的表格被释放，从最近使用的表格开始。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果需要打开新表，但缓存已满并且没有表可以释放，则缓存将根据需要暂时扩展。</font><font style="vertical-align: inherit;">当缓存处于临时扩展状态并且表从已使用状态变为未使用状态时，表将关闭并从缓存中释放。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个并发访问打开</font><font style="vertical-align: inherit;">
          一个</font><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">这意味着如果两个线程访问同一个表或者一个线程在同一个查询中访问了两次表（例如，通过将表连接到它自己），则需要打开两次表。</font><font style="vertical-align: inherit;">每个并发打开需要表缓存中的条目。</font><font style="vertical-align: inherit;">任何</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的第一次打开
           </font><font style="vertical-align: inherit;">需要两个文件描述符：一个用于数据文件，一个用于索引文件。</font><font style="vertical-align: inherit;">该表的每次额外使用仅为数据文件提供一个文件描述符。</font><font style="vertical-align: inherit;">索引文件描述符在所有线程之间共享。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您正在使用该</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">打开一个表，</font><font style="vertical-align: inherit;">则会为该线程分配一个专用表对象。</font><font style="vertical-align: inherit;">此表对象不被其他线程共享，并且在线程调用</font><font style="vertical-align: inherit;">或线程终止</font><font style="vertical-align: inherit;">之前不会关闭</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">发生这种情况时，该表将放回表缓存中（如果缓存未满）。</font><font style="vertical-align: inherit;">请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#handler" title="13.2.4 HANDLER语法"><font style="vertical-align: inherit;">第13.2.4节“HANDLER语法”</font></a><font style="vertical-align: inherit;">。
        </font></font><code class="literal">HANDLER
          <em class="replaceable"><code>tbl_name</code></em> OPEN</code><font style="vertical-align: inherit;"></font><code class="literal">HANDLER
          <em class="replaceable"><code>tbl_name</code></em> CLOSE</code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#handler" title="13.2.4 HANDLER语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以通过检查</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font><font style="vertical-align: inherit;">来确定您的表缓存是否过小，该</font><font style="vertical-align: inherit;">变量
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Opened_tables"><code class="literal">Opened_tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示自服务器启动以来的表打开操作数：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Opened_tables';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Opened_tables | </font><font style="vertical-align: inherit;">2741 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果该值非常大或快速增加，即使您没有发出很多</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH
          TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，</font><font style="vertical-align: inherit;">也要</font><font style="vertical-align: inherit;">增加表缓存大小。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.7节“服务器状态变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-many-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.3.2在同一数据库中创建多个表的缺点</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104125248"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在同一数据库目录中</font><font style="vertical-align: inherit;">有多个</font><font style="vertical-align: inherit;">表，则打开，关闭和创建操作会很慢。</font><font style="vertical-align: inherit;">如果您</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在许多不同的表上</font><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">语句，那么当表缓存满时会有一些开销，因为对于每个必须打开的表，必须关闭另一个表。</font><font style="vertical-align: inherit;">您可以通过增加表缓存中允许的条目数来减少此开销。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="internal-temporary-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.4在MySQL中使用内部临时表</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528104119584"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在某些情况下，服务器在处理语句时创建内部临时表。</font><font style="vertical-align: inherit;">用户无法直接控制何时发生。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器在如下条件下创建临时表：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            报表的</font><font style="vertical-align: inherit;">评估，</font><font style="vertical-align: inherit;">稍后会有一些例外情况。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            评估一些视图，例如那些使用</font></font><code class="literal">TEMPTABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或聚合的</font><font style="vertical-align: inherit;">视图
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            派生表的评估（</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中的</font><font style="vertical-align: inherit;">子查询
             </font><font style="vertical-align: inherit;">）。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为子查询或半连接实现创建的表（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#subquery-optimization" title="8.2.2优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2节“优化子查询，派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            评估包含一个</font></font><code class="literal">ORDER
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句和一个不同</font></font><code class="literal">GROUP
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的语句，</font></font><code class="literal">ORDER
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含来自除连接队列中的第一个表以外的表的列</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">包含该列</font><font style="vertical-align: inherit;">的语句</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结合
             </font><font style="vertical-align: inherit;">
            评估</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能需要临时表。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于使用</font></font><code class="literal">SQL_SMALL_RESULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            修饰符的</font><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">，MySQL使用内存中的临时表，除非查询还包含需要磁盘存储的元素（稍后介绍）。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了评估
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT ...
            SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从同一个表中选择并插入到同一个表中的语句，MySQL创建一个内部临时表来存放来自该表的行
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后将这些行插入到目标表中。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.5.1节“INSERT ... SELECT语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            评估多表
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报表。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            评估</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_group-concat"><code class="literal">GROUP_CONCAT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_count"><code class="literal">COUNT(DISTINCT)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表达。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要确定某个语句是否需要临时表，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并检查该
         </font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列以查看它是否显示
         </font></font><code class="literal">Using temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">对于派生或物化的临时表格</font></font><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不一定会说</font></font><code class="literal">Using temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当服务器创建内部临时表（无论是在内存中还是在磁盘上）时，它都会增加
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Created_tmp_tables"><code class="literal">Created_tmp_tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量。</font><font style="vertical-align: inherit;">如果服务器在磁盘上创建表（最初或通过转换内存表），它将增加
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Created_tmp_disk_tables"><code class="literal">Created_tmp_disk_tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        某些查询条件会阻止使用内存中的临时表，在这种情况下，服务器会使用磁盘上的表：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表中存在一</font><font style="vertical-align: inherit;">列</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或一
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">这包括具有字符串值的用户定义变量，因为它们被视为
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，这取决于它们的值分别是二进制还是非二进制字符串。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font><font style="vertical-align: inherit;">列表中</font><font style="vertical-align: inherit;">
            最大长度大于512（二进制字符串的字节，非二进制字符串的字符）的任何字符串列</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-columns" title="13.7.5.5 SHOW COLUMNS语法"><code class="literal">SHOW COLUMNS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#describe" title="13.8.1 DESCRIBE语法"><code class="literal">DESCRIBE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中使用
             </font></font><code class="literal">BLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为用于某些列的类型，从而用于结果的临时表是磁盘上的表。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器不会为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符合某些资格的语句</font><font style="vertical-align: inherit;">使用临时表
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">相反，它从临时表创建中仅保留执行结果列类型转换所需的数据结构。</font><font style="vertical-align: inherit;">该表没有完全实例化，没有行被写入或读取; </font><font style="vertical-align: inherit;">行直接发送到客户端。</font><font style="vertical-align: inherit;">结果是内存和磁盘需求减少，第一行发送到客户端之前的延迟更小，因为服务器不需要等到最后一个查询块被执行。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而优化器跟踪输出反映了这种执行策略：
        </font></font><code class="literal">UNION RESULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 查询块不存在，因为该块对应于从临时表读取的部分。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些条件有资格在</font></font><code class="literal">UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有临时表的</font><font style="vertical-align: inherit;">情况下</font><font style="vertical-align: inherit;">进行评估：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            工会是</font></font><code class="literal">UNION ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，不是
             </font></font><code class="literal">UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">UNION
            DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            没有全球</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            联合不是</font></font><code class="literal">{INSERT | REPLACE} ... SELECT ...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句</font><font style="vertical-align: inherit;">的顶级查询块
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="internal-temporary-tables-engines"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部临时表存储引擎</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          内部临时表可以在内存中保持并且由处理</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，或者由存储在磁盘上</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果内部临时表被创建为内存表，但变得太大，MySQL会自动将其转换为磁盘上的表。</font><font style="vertical-align: inherit;">内存中临时表的最大大小取决于哪个值</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更小</font><font style="vertical-align: inherit;">值
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这与</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显式创建的表</font><font style="vertical-align: inherit;">有所不同</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
          TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：对于这些表，只有
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量决定允许表增长多少，并且没有转换为磁盘格式。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          所述
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量确定哪个存储引擎服务器使用来管理的磁盘上的内部临时表。</font><font style="vertical-align: inherit;">允许的值是</font></font><code class="literal">INNODB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认值）和
           </font></font><code class="literal">MYISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用时
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine=INNODB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，生成超出</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-restrictions" title="14.8.1.7 InnoDB表的限制"><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            行或列限制</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的磁盘内部临时表的查询
             </font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-restrictions" title="14.8.1.7 InnoDB表的限制"><font style="vertical-align: inherit;">将</font></a><font style="vertical-align: inherit;">返回</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行大小过大</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            错误</font><span class="errortext"><font style="vertical-align: inherit;">过多</font></span><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">解决方法是设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为</font></font><code class="literal">MYISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="internal-temporary-tables-storage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部临时表格存储格式</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          内存中的临时表由</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">管理，该
           </font><font style="vertical-align: inherit;">引擎使用固定长度的行格式。</font></font><code class="literal">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
           </font></font><code class="literal">VARBINARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列值被填充到最大列长度，实际上将它们存储为
           </font></font><code class="literal">CHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">BINARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在磁盘上的临时表由管理
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎（取决于
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置）。</font><font style="vertical-align: inherit;">两个引擎都使用动态宽度行格式存储临时表。</font><font style="vertical-align: inherit;">列只根据需​​要获取尽可能多的存储空间，与使用固定长度行的磁盘表相比，它减少了磁盘I / O和空间要求，并减少了处理时间。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于最初在内存中创建内部临时表的语句，然后将其转换为磁盘上表，通过跳过转换步骤并在磁盘上创建表开始，可以获得更好的性能。</font><font style="vertical-align: inherit;">所述
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_big_tables"><code class="literal">big_tables</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量可以用来迫使内部临时表的磁盘存储。
</font></font></p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-innodb"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5优化InnoDB表</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-storage-layout"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.1优化InnoDB表的存储布局</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-transaction-management"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.2优化InnoDB事务管理</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#innodb-performance-ro-txn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.3优化InnoDB只读事务</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-logging"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.4优化InnoDB重做日志</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-bulk-data-loading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.5 InnoDB表的批量数据加载</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-queries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.6优化InnoDB查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-ddl-operations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.7优化InnoDB DDL操作</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-diskio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.8优化InnoDB磁盘I / O</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-configuration-variables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.9优化InnoDB配置变量</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-many-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.10为具有多个表的系统优化InnoDB</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528104021856"></a><a class="indexterm" name="idm140528104019984"></a><p>
      <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是MySQL客户通常在可靠性和并发性非常重要的生产数据库中使用的存储引擎。
      </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是MySQL中的默认存储引擎。</font><font style="vertical-align: inherit;">本节介绍如何优化</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">数据库操作
       </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-storage-layout"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.1优化InnoDB表的存储布局</font></font></h3>
</div>
</div>
</div>

<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一旦数据达到稳定的大小，或者增长表增加了几十或几百兆字节，请考虑使用该</font></font><code class="literal">OPTIMIZE TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来重新组织表并压缩任何浪费的空间。</font><font style="vertical-align: inherit;">重新组织的表需要更少的磁盘I / O来执行全表扫描。</font><font style="vertical-align: inherit;">当其他技术（如改进索引使用或调整应用程序代码）不切实际时，这是一种直接技术，可以提高性能。
          </font></font></p><p>
            <code class="literal">OPTIMIZE TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制表格的数据部分并重建索引。</font><font style="vertical-align: inherit;">好处来自改进索引内数据的打包，并减少表空间和磁盘内的碎片。</font><font style="vertical-align: inherit;">好处取决于每个表中的数据。</font><font style="vertical-align: inherit;">您可能会发现某些人有显着的收益，而不是其他人，或者收益会随着时间的推移而下降，直到您再次优化表。</font><font style="vertical-align: inherit;">如果表很大或者重建的索引不适合缓冲池，则此操作可能会很慢。</font><font style="vertical-align: inherit;">向表中添加大量数据后的第一次运行通常比后期运行慢得多。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在中</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，有一个很长的</font></font><code class="literal">PRIMARY
            KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（无论是一个长的值的单个列，还是多个形成一个长复合值的列）浪费了大量的磁盘空间。</font><font style="vertical-align: inherit;">一行中的主键值在所有指向同一行的二级索引记录中都是重复的。</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-index-types" title="14.8.2.1聚类索引和二级索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.8.2.1节“集群索引和二级索引”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）</font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果主键很长，或者索引长</font></font><code class="literal">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">的前缀</font><font style="vertical-align: inherit;">而不是整列</font><font style="vertical-align: inherit;">，则</font><font style="vertical-align: inherit;">创建一个</font><font style="vertical-align: inherit;">列作为主键</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据类型而不是</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储可变长度的字符串或具有多个</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">列
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">甲
             </font><font style="vertical-align: inherit;">
            列总是占据</font><font style="vertical-align: inherit;">字符来存储数据，即使该字符串是较短，或者其值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">较小的表适合缓冲池，并减少磁盘I / O。
          </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><code class="literal">COMPACT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行格式（默认</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式）和可变长度字符集（如
             </font></font><code class="literal">utf8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或）时</font></font><code class="literal">sjis</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">
            列占用可变数量的空间，但仍至少为</font><font style="vertical-align: inherit;">字节。
          </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于大的表或者包含大量重复的文本或数字数据的表，请考虑使用
             </font></font><code class="literal">COMPRESSED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行格式。</font><font style="vertical-align: inherit;">将数据带入缓冲池或执行全表扫描需要较少的磁盘I / O。</font><font style="vertical-align: inherit;">在做出永久性决定之前，请测量使用</font><font style="vertical-align: inherit;">行格式</font></font><code class="literal">COMPRESSED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
             </font><font style="vertical-align: inherit;">您可以实现的压缩量
             </font></font><code class="literal">COMPACT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-transaction-management"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.2优化InnoDB事务管理</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要优化</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务处理，请在事务功能的性能开销与服务器的工作负载之间找到理想的平衡点。</font><font style="vertical-align: inherit;">例如，如果应用程序每秒提交数千次，则应用程序可能会遇到性能问题，如果应用程序每2-3小时提交一次，则会出现不同的性能问题。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            默认的MySQL设置</font></font><code class="literal">AUTOCOMMIT=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可能会对繁忙的数据库服务器造成性能限制。</font><font style="vertical-align: inherit;">在可行的情况下，</font><font style="vertical-align: inherit;">在进行所有更改后</font><font style="vertical-align: inherit;">，通过发布</font></font><code class="literal">SET AUTOCOMMIT=0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">START
            TRANSACTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">将几个相关的数据更改操作包括到单个事务中
             </font><font style="vertical-align: inherit;">，然后包含
             </font></font><code class="literal">COMMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。
          </font></font></p><p>
            <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果该事务对数据库进行了修改，则必须在每次事务提交时将日志刷新到磁盘。</font><font style="vertical-align: inherit;">当每次更改之后都进行提交（与默认的自动提交设置一样）时，存储设备的I / O吞吐量会对每秒潜在操作的数量设置上限。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或者，对于仅由单个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">组成的事务</font><font style="vertical-align: inherit;">，开启</font></font><code class="literal">AUTOCOMMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有助于
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别只读事务并对其进行优化。</font><font style="vertical-align: inherit;">有关要求</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务"><font style="vertical-align: inherit;">第8.5.3节“优化InnoDB只读事务”</font></a><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            避免在插入，更新或删除大量行后执行回滚。</font><font style="vertical-align: inherit;">如果一个大事务正在降低服务器的性能，那么回滚会导致问题变得更糟，可能需要几次才能执行原始数据更改操作。</font><font style="vertical-align: inherit;">杀死数据库进程无济于事，因为在服务器启动时会再次开始回滚。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了尽量减少发生此问题的机会：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                增加</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_buffer_pool" title="缓冲池"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的大小，
                 </font><font style="vertical-align: inherit;">以便可以缓存所有数据更改更改，而不是立即写入磁盘。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                设置
                 </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=all</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                以便更新和删除操作在插入之外进行缓冲。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                考虑</font></font><code class="literal">COMMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在大数据更改操作期间定期</font><font style="vertical-align: inherit;">发布</font><font style="vertical-align: inherit;">语句，可能会将单个删除或更新分为多个在较少数量的行上操作的语句。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为避免出现失控回滚，请增加缓冲池，以便回滚变为受CPU限制且运行速度很快，或者</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery=3</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-recovery" title="14.18.2 InnoDB恢复"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.18.2节“InnoDB恢复”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，</font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-recovery" title="14.18.2 InnoDB恢复"><font style="vertical-align: inherit;">终止</font></a><font style="vertical-align: inherit;">服务器并重新启动
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            预计这个问题很少出现在默认设置下
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=all</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这会允许将更新和删除操作缓存到内存中，使它们在第一时间更快地执行，并且如果需要还可以更快地回滚。</font><font style="vertical-align: inherit;">确保在处理长时间运行事务的服务器上使用此参数设置，并进行多次插入，更新或删除操作。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果发生崩溃时可以承受某些最新已提交事务的丢失，则可以将该</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            参数</font><font style="vertical-align: inherit;">设置
             </font><font style="vertical-align: inherit;">为0. </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管无法保证刷新，但试图每秒刷新一次日志。</font><font style="vertical-align: inherit;">另外，将值设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0，这将减少由于在磁盘数据和二进制日志上同步而导致的磁盘刷新次数。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
              <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已弃用，将在未来版本中删除。</font><font style="vertical-align: inherit;">从MySQL 5.7.10开始，</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对XA事务中的两阶段提交的支持始终处于启用状态，并且</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不再允许</font><font style="vertical-align: inherit;">禁用
               </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当行被修改或删除时，行和关联的
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_undo_log" title="撤消日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">撤销日志</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会立即被物理删除，甚至在事务提交后立即被删除。</font><font style="vertical-align: inherit;">保留旧数据，直到完成较早或同时开始的事务，以便这些事务可以访问修改行或已删除行的先前状态。</font><font style="vertical-align: inherit;">因此，长时间运行的事务可以防止</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除不同事务更改的数据。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当在长时间运行的事务中修改或删除行时，使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隔离级别的</font><font style="vertical-align: inherit;">其他事务在
             </font><font style="vertical-align: inherit;">读取相同行时必须执行更多工作才能重新构建旧数据。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当长时间运行的事务修改表时，其他事务对该表的查询不使用</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_covering_index" title="覆盖指数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术。</font><font style="vertical-align: inherit;">通常可以从辅助索引中检索所有结果列的查询，而是从表格数据中查找适当的值。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果发现二级索引页面
             </font></font><code class="literal">PAGE_MAX_TRX_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">太新，或者二级索引中的记录被删除标记，则
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能需要使用聚簇索引查找记录。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-ro-txn"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.3优化InnoDB只读事务</font></font></h3>

</div>

</div>

</div>
<p>
        <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以避免与</font><font style="vertical-align: inherit;">为已知为只读</font><font style="vertical-align: inherit;">的</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_transaction_id" title="交易ID"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_transaction_id" title="交易ID"><font style="vertical-align: inherit;">事务ID</font></a><font style="vertical-align: inherit;">（</font></font><code class="literal">TRX_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段）</font><font style="vertical-align: inherit;">相关联的开销</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">只有</font><font style="vertical-align: inherit;">可能执行写入操作或</font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_locking_read" title="锁定读取"><font style="vertical-align: inherit;">锁定读取</font></a><font style="vertical-align: inherit;">的</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_transaction" title="交易"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才需要事务ID </font><font style="vertical-align: inherit;">，
         </font><font style="vertical-align: inherit;">例如
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">消除不必要的事务ID会减少每次查询或数据更改语句构造</font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_read_view" title="读取视图"><font style="vertical-align: inherit;">读取视图</font></a><font style="vertical-align: inherit;">时查阅的内部数据结构的大小</font><font style="vertical-align: inherit;">。
      </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_locking_read" title="锁定读取"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code class="literal">SELECT ... FOR UPDATE</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_read_view" title="读取视图"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p>
        <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在以下情况下检测只读事务：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            交易以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">START TRANSACTION
            READ ONLY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">开始
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，尝试更改数据库（for </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或其他类型的表）会导致错误，并且事务以只读状态继续：
          </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误1792（25006）：不能在READ ONLY事务中执行语句。
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您仍然可以在只读事务中更改特定于会话的临时表，或者为它们发出锁定查询，因为这些更改和锁对任何其他事务都不可见。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置处于打开状态，以便事务保证为单个语句，构成事务的单个语句为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非锁定</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">也就是说
             </font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它不使用一个</font></font><code class="literal">FOR
            UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">一个</font></font><code class="literal">LOCK IN SHARED MODE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            子句。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            事务在没有</font></font><code class="literal">READ
            ONLY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项的</font><font style="vertical-align: inherit;">情况下启动</font><font style="vertical-align: inherit;">，但没有显式锁定行的更新或语句已经执行。</font><font style="vertical-align: inherit;">在需要更新或显式锁定之前，事务处于只读模式。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        因此，对于读取密集型应用，如报表生成器，您可以调整的序列，</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由内而外将它们分组查询
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">START TRANSACTION READ
        ONLY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或通过打开</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        运行之前设置</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，或简单地避免与查询穿插任何数据更改语句。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关信息
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">START
        TRANSACTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3.1节，“START TRANSACTION，COMMIT和ROLLBACK语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          具有自动提交，非锁定和只读（AC-NL-RO）资格的事务处于特定内部
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据结构之外，因此未在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE语法"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出中</font><font style="vertical-align: inherit;">列出
           </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-logging"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.4优化InnoDB重做日志</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        考虑以下关于优化重做日志的指导原则：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使您的重做日志文件变大，甚至与</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_buffer_pool" title="缓冲池"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一样大
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写完重做日志文件时，它必须将</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_checkpoint" title="检查站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查点中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池的修改内容写入磁盘
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">小的重做日志文件导致许多不必要的磁盘写入。</font><font style="vertical-align: inherit;">虽然历史上重要的重做日志文件会导致冗长的恢复时间，但现在恢复速度更快，您可以放心地使用大型重做日志文件。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            重做日志文件的大小和数量使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            和
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            配置选项</font><font style="vertical-align: inherit;">进行</font><font style="vertical-align: inherit;">配置。</font><font style="vertical-align: inherit;">有关修改现有重做日志文件配置的信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-data-log-reconfiguration" title="14.7.2更改InnoDB重做日志文件的数量或大小"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.7.2节“更改InnoDB重做日志文件的数量或大小”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            考虑增加</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_log_buffer" title="日志缓冲区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志缓冲区</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的大小
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">大型日志缓冲区允许大型
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_transaction" title="交易"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行，而无需在事务</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_commit" title="承诺"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前将日志写入磁盘</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，如果您有更新，插入或删除多行的事务，则使日志缓冲区更大可节省磁盘I / O。</font><font style="vertical-align: inherit;">日志缓冲区大小使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            配置选项</font><font style="vertical-align: inherit;">进行
             </font><font style="vertical-align: inherit;">配置。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-bulk-data-loading"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.5 InnoDB表的批量数据加载</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528103891616"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些性能提示补充了</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#insert-optimization" title="8.2.4.1优化INSERT语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.4.1节“优化INSERT语句”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关快速插入的一般准则</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将数据导入时</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请关闭自动提交模式，因为它会为每个插入操作执行日志刷新到磁盘。</font><font style="vertical-align: inherit;">为了您的导入操作过程中禁用自动提交，与环绕它
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">SET
            autocommit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET autocommit = 0;
</font></font><em class="replaceable"><code>... SQL import statements ...</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
承诺;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqldump的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysqldump_opt"><code class="option">--opt</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建这样的快速导入到转储文件</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表，即使没有与他们包装
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">SET
            autocommit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code class="literal">COMMIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报表。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您</font></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对辅助键</font><font style="vertical-align: inherit;">有</font><font style="vertical-align: inherit;">限制，可以通过在导入会话期间暂时关闭唯一性检查来加快表导入的速度：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET unique_checks = 0;
</font></font><em class="replaceable"><code>... SQL import statements ...</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET unique_checks = 1;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于大表而言，这可以节省大量的磁盘I / O，因为
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用其更改缓冲区来批量写入二级索引记录。</font><font style="vertical-align: inherit;">确保数据不包含重复的密钥。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您</font></font><code class="literal">FOREIGN KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的表中</font><font style="vertical-align: inherit;">存在</font><font style="vertical-align: inherit;">约束，则可以通过在导入会话期间关闭外键检查来加速表导入：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET foreign_key_checks = 0;
</font></font><em class="replaceable"><code>... SQL import statements ...</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET foreign_key_checks = 1;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于大表，这可以节省大量的磁盘I / O。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您需要插入多行，</font><font style="vertical-align: inherit;">
            请使用多行</font><font style="vertical-align: inherit;">语法来减少客户端和服务器之间的通信开销：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO的值（1,2），（5,5），...;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此提示适用于插入任何表格，而不仅限于
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当对具有自动增量列的表进行批量插入时，请将其设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为2而不是默认值1.有关</font><font style="vertical-align: inherit;">详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-auto-increment-handling" title="14.8.1.5在InnoDB中处理AUTO_INCREMENT"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-auto-increment-handling" title="14.8.1.5在InnoDB中处理AUTO_INCREMENT"><font style="vertical-align: inherit;">第14.8.1.5节“InnoDB中的AUTO_INCREMENT处理”</font></a><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            执行批量插入时，按</font></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顺序</font><font style="vertical-align: inherit;">插入行速度更快
             </font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_clustered_index" title="聚簇索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聚集索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这使得使用数据的顺序相对较快</font></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">按</font></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顺序</font><font style="vertical-align: inherit;">执行批量插入</font><font style="vertical-align: inherit;">对于完全不适合缓冲池的表格尤为重要。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了将数据加载到</font></font><code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">时获得最佳性能
             </font><font style="vertical-align: inherit;">，请按照以下步骤操作：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">FTS_DOC_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在创建表的时候</font><font style="vertical-align: inherit;">
                定义一个</font><font style="vertical-align: inherit;">类型为</font></font><code class="literal">BIGINT UNSIGNED NOT
                NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，具有唯一索引的列
                 </font></font><code class="literal">FTS_DOC_ID_INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FTS_DOC_ID BIGINT unsigned NOT NULL AUTO_INCREMENT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
title varchar（255）NOT NULL DEFAULT''，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
文本中文NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PRIMARY KEY（`FTS_DOC_ID`）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB DEFAULT CHARSET = latin1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在t1（FTS_DOC_ID）上创建唯一索引FTS_DOC_ID_INDEX;</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                将数据加载到表中。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据加载完成后</font><font style="vertical-align: inherit;">
                创建</font><font style="vertical-align: inherit;">索引。
</font></font></p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"></font><code class="literal">FTS_DOC_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表创建</font><font style="vertical-align: inherit;">
              时添加</font><font style="vertical-align: inherit;">列时，请确保在
               </font></font><code class="literal">FTS_DOC_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新
               </font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引列时更新列，因为</font></font><code class="literal">FTS_DOC_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
               </font><font style="vertical-align: inherit;">必须单调递增
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您选择不添加</font></font><code class="literal">FTS_DOC_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at表创建时间并</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为您管理DOC ID，</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则会</font></font><code class="literal">FTS_DOC_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下一次</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-index" title="13.1.14 CREATE INDEX语法"><code class="literal">CREATE
              FULLTEXT INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用时</font><font style="vertical-align: inherit;">将其添加
               </font><font style="vertical-align: inherit;">为隐藏列</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，这种方法需要重建表格，这会影响性能。
</font></font></p>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-queries"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.6优化InnoDB查询</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要调整</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">查询，请</font><font style="vertical-align: inherit;">在每个表上创建一组适当的索引。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#mysql-indexes" title="8.3.1 MySQL如何使用索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#mysql-indexes" title="8.3.1 MySQL如何使用索引"><font style="vertical-align: inherit;">第8.3.1节“MySQL如何使用索引”</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">遵循这些</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引的指标：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于每个</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表都有一个
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_primary_key" title="首要的关键"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主键</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（无论您是否要求），请为每个表指定一组主键列，这些列用于最重要且时间关键的查询中。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不要在主键中指定太多或太长的列，因为这些列值在每个二级索引中都是重复的。</font><font style="vertical-align: inherit;">当索引包含不必要的数据时，读取此数据和内存以进行缓存的I / O会降低服务器的性能和可伸缩性。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不要</font><font style="vertical-align: inherit;">
            为每列</font><font style="vertical-align: inherit;">创建单独的
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_secondary_index" title="二级指标"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二级索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为每个查询只能使用一个索引。</font><font style="vertical-align: inherit;">仅有少数不同值的很少测试的列或列索引可能对任何查询都没有帮助。</font><font style="vertical-align: inherit;">如果对同一个表有许多查询，那么测试不同的列组合，尝试创建少量
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_concatenated_index" title="串联索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是大量的单列索引。</font><font style="vertical-align: inherit;">如果索引包含结果集所需的所有列（称为
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_covering_index" title="覆盖指数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），则查询可能完全避免读取表数据。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果索引列不能包含任何
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，请</font></font><code class="literal">NOT
            NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在创建表时</font><font style="vertical-align: inherit;">声明它</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当知道每列是否包含</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">时，优化器可以更好地确定哪个索引最有效地用于查询
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.5.3节“优化InnoDB只读事务”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的技术</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务"><font style="vertical-align: inherit;">优化</font></a><font style="vertical-align: inherit;">表的
             </font><font style="vertical-align: inherit;">单一查询事务
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-ddl-operations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.7优化InnoDB DDL操作</font></font></h3>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于表和索引（</font></font><code class="literal">CREATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">ALTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">DROP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句）的</font><font style="vertical-align: inherit;">DDL操作，表中</font><font style="vertical-align: inherit;">最重要的方面</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在MySQL 5.5和更高版本中创建和删除二级索引比在早期版本中快得多。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-create-index-overview" title="14.13.1在线DDL概述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
             </font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-create-index-overview" title="14.13.1在线DDL概述"><font style="vertical-align: inherit;">第14.13.1节“在线DDL概述”</font></a><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速索引创建</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使得在某些情况下，在将数据加载到表中之前删除索引，然后在加载数据后重新创建索引会更快。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空表，不</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">外键约束，可以使一个</font><font style="vertical-align: inherit;">语句的工作像一个普通的</font><font style="vertical-align: inherit;">声明，在这种情况下，命令序列喜欢
             </font><font style="vertical-align: inherit;">和
             </font><font style="vertical-align: inherit;">可能是最快的。
          </font></font><code class="literal">DELETE FROM
            <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">TRUNCATE</code><font style="vertical-align: inherit;"></font><code class="literal">DELETE</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            因为主键是每个</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的存储布局不可分割的组成部分</font><font style="vertical-align: inherit;">，并且更改主键的定义涉及重新组织整个表，所以始终将主键设置为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的</font><font style="vertical-align: inherit;">一部分
             </font><font style="vertical-align: inherit;">，并提前进行计划，以便您不需要
             </font></font><code class="literal">ALTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">DROP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之后的主键。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-diskio"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.8优化InnoDB磁盘I / O</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528103797632"></a><a class="indexterm" name="idm140528103796144"></a><a class="indexterm" name="idm140528103795072"></a><a class="indexterm" name="idm140528103794000"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您遵循SQL操作的数据库设计和调优技术的最佳实践，但由于繁重的磁盘I / O活动导致数据库仍然很慢，请考虑这些磁盘I / O优化。</font><font style="vertical-align: inherit;">如果Unix </font></font><code class="filename">top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具或Windows任务管理器显示工作负载的CPU使用百分比低于70％，那么您的工作负载可能是磁盘限制的。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            增加缓冲池大小
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当表数据缓存在</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            缓冲池中时，可以通过查询重复访问它，而不需要任何磁盘I / O。</font><font style="vertical-align: inherit;">用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">指定缓冲池的大小
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该内存区域非常重要，通常建议将
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其配置为系统内存的50％至75％。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#memory-use" title="8.12.4.1 MySQL如何使用内存"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.12.4.1节“MySQL如何使用内存”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            调整冲洗方法
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在GNU / Linux和Unix的某些版本中</font></font><code class="literal">fsync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">Unix </font><font style="vertical-align: inherit;">调用（
             </font><font style="vertical-align: inherit;">默认使用）和类似方法将</font><font style="vertical-align: inherit;">文件刷新到磁盘的</font><font style="vertical-align: inherit;">速度惊人地慢。</font><font style="vertical-align: inherit;">如果数据库写入性能出现问题，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            参数集</font><font style="vertical-align: inherit;">进行基准测试
             </font></font><code class="literal">O_DSYNC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在Linux上使用本机AIO的noop或截止日期I / O调度程序
          </font></font></p><p>
            <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Linux上的异步I / O子系统（本机AIO）来执行数据文件页面的预读和写入请求。</font><font style="vertical-align: inherit;">此行为</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由默认情况下启用</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">配置选项</font><font style="vertical-align: inherit;">控制
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用本机AIO时，I / O调度程序的类型对I / O性能有更大的影响。</font><font style="vertical-align: inherit;">通常，建议使用noop和截止日期I / O调度程序。</font><font style="vertical-align: inherit;">进行基准测试以确定哪个I / O调度程序为您的工作负载和环境提供最佳结果。</font><font style="vertical-align: inherit;">有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-linux-native-aio" title="14.6.8在Linux上使用异步I / O"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.8节“在Linux上使用异步I / O”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在x86_64体系结构的Solaris 10上使用直接I / O
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86_64体系结构（AMD Opteron）的Solaris 10上</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">存储引擎时，请使用直接I / O </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关文件以避免性能下降</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要为用于存储</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关文件</font><font style="vertical-align: inherit;">的整个UFS文件系统使用直接I / O，请
             </font><font style="vertical-align: inherit;">使用该</font></font><code class="literal">forcedirectio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">安装它
             </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">见
             </font></font><code class="literal">mount_ufs(1M)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（Solaris 10 / x86_64上的默认设置</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此选项。）要仅将直接I / O应用于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件操作而不是整个文件系统，请设置
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method =
            O_DIRECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用此设置，
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫
             </font></font><code class="literal">directio()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是
            </font></font><code class="literal">fcntl()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 用于I / O到数据文件（不用于I / O到日志文件）。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在Solaris 2.6或更高版本中使用原始存储来存储数据和日志文件
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在任何版本的Solaris 2.6及更高版本和任何平台（sparc / x86 / x64 / amd64）上</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用具有较大</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">
            的</font><font style="vertical-align: inherit;">存储引擎时，请
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在裸设备上或单独的直接I / O UFS上</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">数据文件和日志文件</font><font style="vertical-align: inherit;">进行基准测试
             </font><font style="vertical-align: inherit;">文件系统，使用</font></font><code class="literal">forcedirectio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面</font><font style="vertical-align: inherit;">所述的</font><font style="vertical-align: inherit;">安装选项。</font><font style="vertical-align: inherit;">（</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果需要对日志文件进行直接I / O </font><font style="vertical-align: inherit;">，则必须使用装入选项而不是设置
             </font><font style="vertical-align: inherit;">。）Veritas文件系统VxFS的用户应使用
             </font></font><code class="literal">convosync=direct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">装入选项。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不要将其他MySQL数据文件（如</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">那些文件）
             </font><font style="vertical-align: inherit;">放在直接I / O文件系统上。</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">可执行文件或库</font><font style="vertical-align: inherit;">放置在直接I / O文件系统上。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用额外的存储设备
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            可以使用其他存储设备来设置RAID配置。</font><font style="vertical-align: inherit;">有关相关信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#disk-issues" title="8.12.2优化磁盘I / O"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.12.2节“优化磁盘I / O”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            或者，</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表空间数据文件和日志文件可以放在不同的物理磁盘上。</font><font style="vertical-align: inherit;">有关更多信息，请参阅以下部分：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-init-startup-configuration" title="14.6.1 InnoDB启动配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.1节“InnoDB启动配置”</font></font></a>
              </p></li><li class="listitem"><p>
                <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#tablespace-placing" title="14.7.5在数据目录之外创建文件每表的表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.7.5节“在数据目录之外创建文件 - 表 - 表 - 表空间”</font></font></a>
              </p></li><li class="listitem"><p>
                <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#general-tablespaces-creating" title="创建一个通用表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个通用表空间</font></font></a>
              </p></li><li class="listitem"><p>
                <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-migration" title="14.8.1.3移动或复制InnoDB表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.8.1.3节“移动或复制InnoDB表”</font></font></a>
</p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            考虑非旋转存储
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            非循环存储通常为随机I / O操作提供更好的性能; </font><font style="vertical-align: inherit;">和顺序I / O操作的旋转存储。</font><font style="vertical-align: inherit;">在通过旋转和非旋转存储设备分发数据和日志文件时，请考虑主要在每个文件上执行的I / O操作的类型。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            随机I /面向O形文件通常包括
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_file_per_table" title="文件的每个表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件的每个表</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            和</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_general_tablespace" title="一般的表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通表空间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数据文件，
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_undo_tablespace" title="撤消表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">撤销表空间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            文件和
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_temporary_tablespace" title="临时表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">临时表空间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">连续的面向I / O的文件包括</font></font><code class="literal">InnoDB</code>
            <a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_system_tablespace" title="系统表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统表空间</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件（由于
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_doublewrite_buffer" title="双写缓冲区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二次写入缓冲</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_change_buffer" title="更改缓冲区"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改缓冲</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）以及日志文件（如</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_binary_log" title="二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制日志</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件和</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_redo_log" title="重做日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重做日志</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件）。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用非循环存储时，请查看以下配置选项的设置：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该</font></font><code class="literal">crc32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选件使用更快的校验和算法，推荐用于快速存储系统。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_flush_neighbors"><code class="literal">innodb_flush_neighbors</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该选项优化了旋转存储设备的I / O。</font><font style="vertical-align: inherit;">禁用它用于非旋转存储或混合旋转和非旋转存储。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于较低端的非旋转存储设备，默认设置200通常是足够的。</font><font style="vertical-align: inherit;">对于更高端的总线连接设备，请考虑更高的设置，例如1000。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                默认值2000适用于使用非循环存储的工作负载。</font><font style="vertical-align: inherit;">对于高端，总线连接的非旋转存储设备，考虑更高的设置，如2500。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_log_compressed_pages"><code class="literal">innodb_log_compressed_pages</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果重做日志位于非循环存储中，请考虑禁用此选项以减少日志记录。</font><font style="vertical-align: inherit;">请参阅
                 </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#innodb-disable-log-compressed-pages"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用压缩页面的记录</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果重做日志位于非循环存储中，请配置此选项以最大化高速缓存和写入组合。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                考虑使用与磁盘的内部扇区大小相匹配的页面大小。</font><font style="vertical-align: inherit;">早期的SSD设备通常具有4k扇区大小。</font><font style="vertical-align: inherit;">一些较新的设备具有16k扇区大小。</font><font style="vertical-align: inherit;">默认</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                页面大小为16k。</font><font style="vertical-align: inherit;">保持页面大小接近存储设备块大小可将重写到磁盘的未更改数据量减到最少。
              </font></font></p></li><li class="listitem"><p>
                <a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_binlog_row_image"><code class="literal">binlog_row_image</code></a>
              </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果二进制日志位于非循环存储中，并且所有表都有主键，请考虑设置此选项</font></font><code class="literal">minimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以减少日志记录。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            确保为您的操作系统启用TRIM支持。</font><font style="vertical-align: inherit;">它通常默认启用。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            增加I / O容量以避免积压
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果由于</font></font><code class="literal">InnoDB</code>
            <a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_checkpoint" title="检查站"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查点</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            操作</font><font style="vertical-align: inherit;">导致吞吐量周期性下降
             </font><font style="vertical-align: inherit;">，请考虑增加</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            配置选项</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">较高的值会导致更频繁的
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_flush" title="红晕"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，避免可能导致吞吐量下降的工作积压。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果冲洗不落后，则I / O容量降低
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果系统不会因</font></font><code class="literal">InnoDB</code>
            <a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_flush" title="红晕"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冲洗</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">而落后
             </font><font style="vertical-align: inherit;">，请考虑降低</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            配置选项</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常情况下，您保持该选项的值尽可能低，但不能太低，以至于导致吞吐量的周期性下降，如前面的项目符号所述。</font><font style="vertical-align: inherit;">在可以降低选项值的典型场景中，您可能会在以下输出中看到类似的组合
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-engine" title="13.7.5.15 SHOW ENGINE语法"><code class="literal">SHOW ENGINE
            INNODB STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                历史名单长度低，低于几千。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                插入缓冲区合并接近插入的行。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                修改缓冲池中的页面始终远低于
                 </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                缓冲池。</font><font style="vertical-align: inherit;">（在服务器没有进行批量插入的时候测量;在批量插入时修改的页面百分比显着增加，这是正常的。）
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">Log sequence number - Last checkpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                小于7/8或理想情况下小于</font></font><code class="literal">InnoDB</code>
                <a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_log_file" title="日志文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总大小的6/8 </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将系统表空间文件存储在Fusion-io设备上
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过</font><font style="vertical-align: inherit;">在支持原子写入的Fusion-io设备上</font><font style="vertical-align: inherit;">存储系统表空间文件（</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ibdata文件</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font><font style="vertical-align: inherit;">您可以利用与双写缓冲区相关的I / O优化</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动禁用</font><font style="vertical-align: inherit;">doublewrite buffering（</font><font style="vertical-align: inherit;">），并且Fusion-io原子写入用于所有数据文件。</font><font style="vertical-align: inherit;">此功能仅在Fusion-io硬件上受支持，并且仅适用于Linux上的Fusion-io NVMFS。</font><font style="vertical-align: inherit;">要充分利用此功能，</font><font style="vertical-align: inherit;">建议使用</font><font style="vertical-align: inherit;">此
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font></font><code class="literal">O_DIRECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于双写缓冲区设置是全局性的，所以对于驻留在非Fusion-io硬件上的数据文件，也会禁用双写缓冲。
</font></font></p>
</div>
</li><li class="listitem"><p><a name="innodb-disable-log-compressed-pages"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            禁用压缩页面的日志记录
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_compression" title="压缩"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能时，</font><font style="vertical-align: inherit;">当对压缩数据进行更改时</font><font style="vertical-align: inherit;">，重新压缩</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_page" title="页"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页面的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像
             </font><font style="vertical-align: inherit;">将写入
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_redo_log" title="重做日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重做日志</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此行为</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_log_compressed_pages"><code class="literal">innodb_log_compressed_pages</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由默认情况下启用的</font><font style="vertical-align: inherit;">控制
             </font><font style="vertical-align: inherit;">，以防止</font></font><code class="literal">zlib</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在恢复期间使用</font><font style="vertical-align: inherit;">不同版本的</font><font style="vertical-align: inherit;">压缩算法时</font><font style="vertical-align: inherit;">可能发生的损坏</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您确定</font></font><code class="literal">zlib</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本不会更改，请禁用
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_log_compressed_pages"><code class="literal">innodb_log_compressed_pages</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以减少修改压缩数据的工作负载的重做日志生成。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-configuration-variables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.9优化InnoDB配置变量</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不同的设置对于服务器的工作效率最高，可以预测负载较轻，而服务器则始终处于满负荷运行状态，或者遇到高活动的峰值。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎会自动执行许多优化，因此许多性能调整任务都需要进行监视，以确保数据库性能良好，并在性能下降时更改配置选项。</font><font style="vertical-align: inherit;">有关详细的</font><font style="vertical-align: inherit;">性能监控</font><font style="vertical-align: inherit;">信息</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-schema" title="14.16 InnoDB与MySQL性能模式的集成"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
         </font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-schema" title="14.16 InnoDB Integration with MySQL Performance Schema"><font style="vertical-align: inherit;">第14.16节“InnoDB与MySQL性能架构的集成”</font></a></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以执行的主要配置步骤包括：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            允许</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在包含它们的系统上使用高性能内存分配器。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-use_sys_malloc" title="14.6.4配置InnoDB的内存分配器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.4节“为InnoDB配置内存分配器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制哪些</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区更改数据</font><font style="vertical-align: inherit;">的数据更改操作的类型
             </font><font style="vertical-align: inherit;">，以避免频繁的小磁盘写入。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-change_buffering" title="14.6.5配置InnoDB变更缓存"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.5节“配置InnoDB更改缓冲”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于默认设置是缓冲所有类型的数据更改操作，因此只有在需要减少缓冲量时才更改此设置。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用该</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">打开和关闭自适应哈希索引功能
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-adaptive-hash" title="14.4.3自适应哈希索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-adaptive-hash" title="14.4.3自适应哈希索引"><font style="vertical-align: inherit;">第14.4.3节“自适应散列索引”</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可能会在非正常活动期间更改此设置，然后将其恢复到原始设置。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果上下文切换是瓶颈，则</font><font style="vertical-align: inherit;">
            设置对并发线程数量的
             </font><font style="vertical-align: inherit;">限制。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.6.6配置InnoDB的线程并发"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.6节“为InnoDB配置线程并发”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其</font><font style="vertical-align: inherit;">预</font><font style="vertical-align: inherit;">读操作相关</font><font style="vertical-align: inherit;">的预取量
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当系统没有使用I / O容量时，更多的预读可以提高查询的性能。</font><font style="vertical-align: inherit;">预读过多会导致重负载系统的性能周期性下降。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-read_ahead" title="14.6.3.5配置InnoDB缓冲池预取（预读）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.5节“配置InnoDB缓冲池预取（预读）”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您有一个高端I / O子系统未被默认值充分利用，则增加读取或写入操作的后台线程数。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="14.6.7配置背景InnoDB I / O线程数量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.7节“配置背景InnoDB I / O线程数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制I / O </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在后台执行</font><font style="vertical-align: inherit;">多少操作</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-thread_io_rate" title="14.6.9配置InnoDB主线程I / O速率"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.9节“配置InnoDB主线程I / O速率”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您观察到性能的周期性下降，您可能会缩减此设置。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            控制确定何时</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行某些类型的背景写入</font><font style="vertical-align: inherit;">的算法
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="14.6.3.6配置InnoDB缓冲池刷新"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.6节“配置InnoDB缓冲池刷新”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该算法适用于某些类型的工作负载，但不适用于其他类型的工作负载，因此如果观察到性能下降，可能会关闭此设置。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            利用多核处理器及其高速缓存存储器配置，尽量减少上下文切换的延迟。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-spin_lock_polling" title="14.6.10配置自旋锁定轮询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.10节“配置旋转锁定轮询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            防止诸如表扫描之类的一次性操作干扰存储在</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区高速缓存中</font><font style="vertical-align: inherit;">的经常访问的数据
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="14.6.3.4使缓冲池抗扫描"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.4节“使缓冲池抗扫描”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将日志文件调整为适合可靠性和崩溃恢复的大小。</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            日志文件通常保持很小以避免崩溃后的长时间启动。</font><font style="vertical-align: inherit;">MySQL 5.5中引入的优化加速了崩溃</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_crash_recovery" title="崩溃恢复"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恢复</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程的</font><font style="vertical-align: inherit;">某些步骤
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">尤其是，</font><font style="vertical-align: inherit;">由于改进了内存管理算法</font><font style="vertical-align: inherit;">，扫描
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_redo_log" title="重做日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重做日志</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和应用重做日志速度更快。</font><font style="vertical-align: inherit;">如果为了避免很长的启动时间而将您的日志文件人为保留较小，现在可以考虑增加日志文件大小以减少由于重做日志记录的回收而发生的I / O。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池</font><font style="vertical-align: inherit;">配置实例的大小和数量，
             </font><font style="vertical-align: inherit;">对于具有多千兆字节缓冲池的系统尤为重要。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-multiple-buffer-pools" title="14.6.3.3配置多个缓冲池实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.3节“配置多个缓冲池实例”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            增加并发事务的最大数量，这极大地提高了最繁忙数据库的可伸缩性。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-undo-logs" title="14.4.8撤消日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.4.8节“撤消日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            将清除操作（一种垃圾收集）移动到后台线程中。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-improved-purge-scheduling" title="14.6.11配置InnoDB清除调度"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.11节“配置InnoDB清除计划”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要有效测量此设置的结果，请首先调整其他I / O相关和线程相关的配置设置。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            减少</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并发线程之间</font><font style="vertical-align: inherit;">的切换量
             </font><font style="vertical-align: inherit;">，以便繁忙服务器上的SQL操作不会排队并形成</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交通拥堵</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为该</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">设置一个值，
             </font><font style="vertical-align: inherit;">对于高性能的现代系统，最高可达约32。</font><font style="vertical-align: inherit;">增加该</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">的值
             </font><font style="vertical-align: inherit;">，通常为5000左右。</font><font style="vertical-align: inherit;">这些选项的组合设置了线程数量的上限
            </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在任何时候都可以进行处理，并且允许每个线程在被换出之前做大量的工作，以便等待的线程数量保持低，并且可以在没有过度上下文切换的情况下完成操作。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-many-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5.10为具有多个表的系统优化InnoDB</font></font></h3>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您已配置
             </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-statistics-estimation" title="14.6.12.2配置非持久性优化器统计参数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的非持久性优化统计</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（非默认配置），
             </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算指标
             </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_cardinality" title="基数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值表中的第一次表，启动后访问，而不是在表中存储这些值。</font><font style="vertical-align: inherit;">在将数据分割成多个表的系统上，此步骤可能会花费大量时间。</font><font style="vertical-align: inherit;">由于这方面的开销仅适用于初始表打开操作，来</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">热身</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            以备后用一个表，通过发出声明，如立即访问它启动后</font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">SELECT 1 FROM
            <em class="replaceable"><code>tbl_name</code></em> LIMIT 1</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            优化器统计信息默认保存到磁盘，由</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            配置选项</font><font style="vertical-align: inherit;">启用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关持久化优化器统计信息的信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-persistent-stats" title="14.6.12.1配置持久优化器统计参数"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.12.1节“配置持久性优化器统计信息参数”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-myisam"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6优化MyISAM表</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-queries-myisam"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.1优化MyISAM查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-myisam-bulk-data-loading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.2 MyISAM表的批量数据加载</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#repair-table-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.3优化REPAIR TABLE语句</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528103616096"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      该</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎与读数据或低并发操作的性能最佳，因为表锁限制进行同步更新的能力。</font><font style="vertical-align: inherit;">在MySQL中，</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是默认的存储引擎而不是</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-queries-myisam"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.1优化MyISAM查询</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        加快查询</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">一些常规提示
         </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了帮助MySQL更好地优化查询，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或运行
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk  -</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在载入数据之后对其进行分析。</font><font style="vertical-align: inherit;">这会更新每个索引部分的值，以指示具有相同值的平均行数。</font><font style="vertical-align: inherit;">（对于唯一索引，这总是1.）当你基于非常量表达式连接两个表时，MySQL使用它来决定选择哪个索引。</font><font style="vertical-align: inherit;">您可以通过使用</font><font style="vertical-align: inherit;">和检查</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">检查</font><font style="vertical-align: inherit;">表分析的结果
             </font><font style="vertical-align: inherit;">。</font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk --description --verbose</font></strong></span></a><font style="vertical-align: inherit;">显示索引分布信息。
          </font></font><code class="literal">SHOW INDEX FROM
            <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">Cardinality</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要根据索引对索引和数据进行排序，请使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --sort-index --sort-records = 1</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            （假设您要对索引1进行排序）。</font><font style="vertical-align: inherit;">如果您有一个唯一索引，您希望根据索引按顺序读取所有行，则这是一种更快查询的好方法。</font><font style="vertical-align: inherit;">第一次以这种方式排列大表时，可能需要很长时间。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            尽量避免</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经常更新的表</font><font style="vertical-align: inherit;">进行复杂的</font><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">，以避免由于读者和作者之间的争用而发生的表锁定问题。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持并发插入：如果某个表在数据文件中间没有空闲块，则可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其他线程正在从表中读取</font><font style="vertical-align: inherit;">数据的同时将</font><font style="vertical-align: inherit;">新行插入到该表中。</font><font style="vertical-align: inherit;">如果能做到这一点很重要，请考虑以避免删除行的方式使用表。</font><font style="vertical-align: inherit;">另一种可能性是</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在删除了很多行之后</font><font style="vertical-align: inherit;">运行</font><font style="vertical-align: inherit;">对表进行碎片整理。</font><font style="vertical-align: inherit;">这种行为是通过设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">来改变的
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以强制添加新行（因此允许并发插入），即使在已删除行的表中也是如此。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#concurrent-inserts" title="8.11.3并发插入"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.3节“并发插入”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频繁更改的表，尽量避免所有变长列（</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
             </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果该表甚至包含单个可变长度列，该表使用动态行格式。</font><font style="vertical-align: inherit;">请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html" title="第15章备用存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备用存储引擎</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            仅仅因为行变大，将表分割成不同的表通常是没有用的。</font><font style="vertical-align: inherit;">在访问行时，最大的性能影响是找到行的第一个字节所需的磁盘查找。</font><font style="vertical-align: inherit;">找到数据后，大多数现代磁盘可以为大多数应用程序快速读取整行。</font><font style="vertical-align: inherit;">分割表格的唯一情况是显而易见的，如果它是一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用动态行格式</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">表格，您可以更改为固定的行大小，或者您经常需要扫描表格但不需要大多数列。</font><font style="vertical-align: inherit;">请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html" title="第15章备用存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15章，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备用存储引擎</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您通常按</font><font style="vertical-align: inherit;">顺序</font><font style="vertical-align: inherit;">检索行，</font><font style="vertical-align: inherit;">
            请使用</font><font style="vertical-align: inherit;">它
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在对表格进行大量更改后使用此选项，您可能会获得更高的性能。
          </font></font><code class="literal">ALTER TABLE ... ORDER BY
            <em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>, ...</code><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>, ...</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您经常需要根据来自很多行的信息计算结果（如计数），则最好引入一个新表并实时更新计数器。</font><font style="vertical-align: inherit;">以下表单的更新速度非常快：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET </font></font><em class="replaceable"><code>count_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>count_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+1 WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当你使用MySQL存储引擎时，这是非常重要的，例如</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有表级锁定的多</font><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这也为大多数数据库系统提供了更好的性能，因为在这种情况下行锁管理器不太容易。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            定期</font><font style="vertical-align: inherit;">
            使用</font><font style="vertical-align: inherit;">以避免使用动态格式</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表进行</font><font style="vertical-align: inherit;">分段
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#myisam-table-formats" title="15.2.3 MyISAM表格存储格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15.2.3节“MyISAM表格存储格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="literal">DELAY_KEY_WRITE=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table选项</font><font style="vertical-align: inherit;">
            声明一个</font><font style="vertical-align: inherit;">表
             </font><font style="vertical-align: inherit;">会使索引更新速度更快，因为它们在表关闭之前不会刷新到磁盘。</font><font style="vertical-align: inherit;">缺点是，如果某个表在打开时杀死服务器，则必须通过运行带有该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">的服务器</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">在重新启动服务器之前</font><font style="vertical-align: inherit;">运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来确保表可以正常运行
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（但是，即使在这种情况下，也不能</font></font><code class="literal">DELAY_KEY_WRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为</font><font style="vertical-align: inherit;">使用而丢失任何东西
             </font><font style="vertical-align: inherit;">，因为密钥信息总是可以从数据行中生成。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            字符串会自动在</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">中进行前缀和结尾空间压缩</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-index" title="13.1.14 CREATE INDEX语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.14节“CREATE INDEX语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以通过在应用程序中缓存查询或答案，然后一起执行许多插入或更新来提高性能。</font><font style="vertical-align: inherit;">在此操作期间锁定表可确保索引缓存在所有更新后仅刷新一次。</font><font style="vertical-align: inherit;">您还可以利用MySQL的查询缓存来获得类似的结果; </font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache" title="8.10.3 MySQL查询缓存"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3节“MySQL查询缓存”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-myisam-bulk-data-loading"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.2 MyISAM表的批量数据加载</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528103556112"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些性能提示补充了</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#insert-optimization" title="8.2.4.1优化INSERT语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.4.1节“优化INSERT语句”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关快速插入的一般准则</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果数据文件中间没有删除的行，则</font><font style="vertical-align: inherit;">可以使用并行插入在</font><font style="vertical-align: inherit;">语句正在运行</font><font style="vertical-align: inherit;">的同时添加行
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#concurrent-inserts" title="8.11.3并发插入"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.3节“并发插入”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过一些额外的工作，</font><font style="vertical-align: inherit;">当表有很多索引时，</font><font style="vertical-align: inherit;">可以使
             </font><font style="vertical-align: inherit;">表的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行速度更快
             </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用以下步骤：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                语句或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-tables</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --keys-used = 0 -rq
                </font></font><em class="replaceable"><code>/path/to/db/tbl_name</code></em></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
                删除表中所有索引的使用。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                用数据插入表格
                 </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
                INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这不会更新任何索引，因此速度非常快。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                如果您打算以后只从表中读取数据，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行压缩。</font><font style="vertical-align: inherit;">请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/storage-engines.html#compressed-format" title="15.2.3.3压缩表特征"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第15.2.3.3节“压缩表特征”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk -rq
                </font></font><em class="replaceable"><code>/path/to/db/tbl_name</code></em></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新创建索引</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这会在将内容写入磁盘之前在内存中创建索引树，这比在更新索引期间快得多，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
                DATA INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它避免了大量磁盘搜索。</font><font style="vertical-align: inherit;">得到的索引树也是完美平衡的。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                语句或</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-tables</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。
</font></font></p></li></ol>
</div>
<p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入数据</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表为空，</font><font style="vertical-align: inherit;">则自动执行上述优化</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">自动优化和明确使用过程之间的主要区别是，您可以让</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为索引创建分配更多的临时内存，而不是您希望服务器在执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
            DATA INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">时为索引重新创建分配内存</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您还可以</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下语句而不是</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来禁用或启用</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的非唯一索引
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您使用这些语句，则可以跳过这些
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISABLE KEYS;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENABLE KEYS;
</font></font></pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要加快</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用多个非事务表的语句执行的操作，请锁定您的表：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定表写一个;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插入一个值（1,23），（2,34），（4,33）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插入一个值（8,26），（6,29）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解锁表;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这有利于性能，因为在所有</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句完成</font><font style="vertical-align: inherit;">后，索引缓冲区只刷新一次
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常情况下，会有多少个索引缓冲区刷新与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句一样多。</font><font style="vertical-align: inherit;">如果可以插入所有行，则不需要显式锁定语句
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            锁定还会降低多连接测试的总时间，但个别连接的最长等待时间可能会因为等待锁定而增加。</font><font style="vertical-align: inherit;">假设五个客户端尝试同时执行插入操作，如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                连接1有1000个插入
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                连接2,3和4做1插入
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                连接5有1000个插入
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果不使用锁定，则连接2,3和4会在1和5之前完成。如果使用锁定，连接2,3和4可能在1或5之前未完成，但总时间应该约为40％更快。
          </font></font></p><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL中的操作非常快，但是通过在所有超过大约五次连续插入或更新的事物中添加锁，您可以获得更好的整体性能。</font><font style="vertical-align: inherit;">如果你做了很多次连续的插入操作，你可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK
            TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稍后
             </font><font style="vertical-align: inherit;">再做</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">UNLOCK
            TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次（每1,000行左右），以允许其他线程访问表。</font><font style="vertical-align: inherit;">这仍然会带来不错的性能提升。
          </font></font></p><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载数据的速度仍然比</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用刚刚列出的策略时</font><font style="vertical-align: inherit;">慢得多
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            要提高</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表的</font><font style="vertical-align: inherit;">性能</font><font style="vertical-align: inherit;">，对于这两者，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过增加</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量来</font><font style="vertical-align: inherit;">放大密钥缓存
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-configuration" title="5.1.1配置服务器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="repair-table-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6.3优化REPAIR TABLE语句</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528103487456"></a><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格类似于使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行修复操作，以及一些相同的性能优化适用：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有控制内存分配的变量。</font><font style="vertical-align: inherit;">您可以通过设置这些变量来提高性能，如
            </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#myisamchk-memory" title="4.6.3.6 myisamchk内存使用情况"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.6.3.6节“myisamchk内存使用情况”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            因为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，同样的原则适用，但由于修复是由服务器完成的，因此您可以设置服务器系统变量而不是
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量。</font><font style="vertical-align: inherit;">此外，除了设置内存分配变量之外，增加
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量还会增加修复将使用更快的文件排序方法的可能性，并避免缓存键方法的修复速度降低。</font><font style="vertical-align: inherit;">检查并确保有足够的可用空间来存放表文件的副本后，将该变量设置为系统的最大文件大小。</font><font style="vertical-align: inherit;">可用空间必须在包含原始表格文件的文件系统中可用。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        假设</font><font style="vertical-align: inherit;">使用以下选项设置</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表修复操作来设置其内存分配变量：
      </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--key_buffer_size = 128M --myisam_sort_buffer_size = 256M</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--read_buffer_size = 64M --write_buffer_size = 64M</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        其中一些</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量对应于服务器系统变量：
</font></font></p>
<div class="informaltable">
<table summary="myisamchk variables and corresponding server system variables."><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr>
            <th scope="col"><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">key_buffer_size</code></td>
            <td><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a></td>
          </tr><tr>
            <td scope="row"><code class="literal">myisam_sort_buffer_size</code></td>
            <td><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a></td>
          </tr><tr>
            <td scope="row"><code class="literal">read_buffer_size</code></td>
            <td><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a></td>
          </tr><tr>
            <td scope="row"><code class="literal">write_buffer_size</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个服务器系统变量都可以在运行时设置，其中一些（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）除了全局值之外还有一个会话值。</font><font style="vertical-align: inherit;">设置会话值会限制更改对当前会话的影响，并且不会影响其他用户。</font><font style="vertical-align: inherit;">更改全局变量（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）也会影响其他用户。</font><font style="vertical-align: inherit;">因为
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您必须考虑到缓冲区是与这些用户共享的。</font><font style="vertical-align: inherit;">例如，如果将</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a>
        <code class="literal">key_buffer_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为128MB，则可以设置相应的值
        </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量大于此值（如果它尚未设置为较大），以允许按其他会话中的活动使用密钥缓冲区。</font><font style="vertical-align: inherit;">但是，更改全局密钥缓冲区大小会使缓冲区失效，从而导致磁盘I / O增加以及其他会话减速。</font><font style="vertical-align: inherit;">避免此问题的替代方法是使用单独的密钥缓存，为其分配要修复的表中的索引，并在修复完成时将其解除分配。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#multiple-key-caches" title="8.10.2.2多个密钥缓存"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.2.2节“多键缓存”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        根据前面的说明，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以按如下所示进行操作，以使用与</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">类似的设置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这里分配了一个单独的128MB密钥缓冲区，假定文件系统允许至少100GB的文件大小。
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET SESSION myisam_sort_buffer_size = 256 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET SESSION read_buffer_size = 64 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL myisam_max_sort_file_size = 100 * 1024 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL repair_cache.key_buffer_size = 128 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CACHE INDEX </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN repair_cache;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LOAD INDEX INTO CACHE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
修理桌</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL repair_cache.key_buffer_size = 0;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您打算更改全局变量，但希望仅在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">期间这样做</font><font style="vertical-align: inherit;">才能最小化影响其他用户，请将其值保存在用户变量中，然后再恢复。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @old_myisam_sort_buffer_size = @@ global.myisam_max_sort_file_size;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL myisam_max_sort_file_size = 100 * 1024 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REPAIR TABLE tbl_name;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL myisam_max_sort_file_size = @old_myisam_max_sort_file_size;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您希望这些值在默认情况下有效，那么可以在服务器启动时全局设置</font><font style="vertical-align: inherit;">
        影响的系统变量</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，将这些行添加到服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中：
      </font></font></p><pre data-lang="init" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
myisam_sort_buffer_size = 256M</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的key_buffer_size = 1G</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
myisam_max_sort_file_size = 100G</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些设置不包括
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局</font><font style="vertical-align: inherit;">设置
         </font><font style="vertical-align: inherit;">为较大的值对于所有会话都是如此，并且可能会导致性能受损，原因是具有多个同时会话的服务器的内存分配过多。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-memory-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.7优化MEMORY表</font></font></h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140528103419760"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      考虑</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对经常访问的非关键数据</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">表，并且是只读或很少更新的表。</font><font style="vertical-align: inherit;">在真实工作负载下</font><font style="vertical-align: inherit;">针对等效</font><font style="vertical-align: inherit;">表</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">应用程序</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">对应用程序进行基准测试
       </font><font style="vertical-align: inherit;">，以确认任何其他性能值得丢失数据的风险，或在应用程序启动时从基于磁盘的表中复制数据的开销。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要获得</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">最佳性能</font><font style="vertical-align: inherit;">，请检查每个表的查询种类，并指定要用于每个关联索引（B树索引或哈希索引）的类型。</font><font style="vertical-align: inherit;">在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-index" title="13.1.14 CREATE INDEX语法"><code class="literal">CREATE INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      声明中，使用该子句</font></font><code class="literal">USING BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
       </font></font><code class="literal">USING HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于通过诸如</font></font><code class="literal">&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or之类的</font><font style="vertical-align: inherit;">运算符进行比较的查询，B-树索引的查询速度非常快</font></font><code class="literal">BETWEEN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于通过</font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font><font style="vertical-align: inherit;">查找单个值的查询</font><font style="vertical-align: inherit;">或运算符中的一组受限</font><font style="vertical-align: inherit;">值的查询，散列索引只是很快</font><font style="vertical-align: inherit;">的</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为什么
       </font></font><code class="literal">USING BTREE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常比默认选择更好</font></font><code class="literal">USING HASH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#table-scan-avoidance" title="8.2.1.19避免全表扫描"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.19节“避免全表扫描”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关不同类型</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引的</font><font style="vertical-align: inherit;">实现细节</font><font style="vertical-align: inherit;">，请参见
       </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-btree-hash" title="8.3.8 B树和散列索引的比较"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.3.8节“B树和散列索引的比较”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="execution-plan-information"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8了解查询执行计划</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#using-explain"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.1使用EXPLAIN优化查询</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#explain-output"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.2 EXPLAIN输出格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#explain-extended"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.3扩展的EXPLAIN输出格式</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#explain-for-connection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.4获取命名连接的执行计划信息</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#estimating-performance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.5估计查询性能</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      根据您的表，列，索引和</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">的条件的细节</font><font style="vertical-align: inherit;">，MySQL优化器会考虑许多技术来高效地执行SQ​​L查询中涉及的查找。</font><font style="vertical-align: inherit;">可以在不读取所有行的情况下执行对巨大表格的查询; </font><font style="vertical-align: inherit;">可以执行涉及多个表的联接，而无需比较每个行的组合。</font><font style="vertical-align: inherit;">优化程序选择执行最高效查询的一组操作称为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询执行计划</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，也称为
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划。</font><font style="vertical-align: inherit;">你的目标是认识到方面的问题
      </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 计划表明查询得到了优化，并学习SQL语法和索引技术，以便在出现一些效率低下的操作时改进计划。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="using-explain"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.1使用EXPLAIN优化查询</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528103397520"></a><a class="indexterm" name="idm140528103396480"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句提供有关MySQL如何执行语句的信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作品有
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与可解释的语句一起使用时，MySQL会显示来自优化器的关于语句执行计划的信息。</font><font style="vertical-align: inherit;">也就是说，MySQL解释了它将如何处理该语句，包括有关表如何连接以及按何种顺序的信息。</font><font style="vertical-align: inherit;">有关使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取执行计划信息的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-output" title="8.8.2 EXPLAIN输出格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.2节“EXPLAIN输出格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
             </font><font style="vertical-align: inherit;">可解释的语句一起使用时，它显示在命名连接中执行的语句的执行计划。</font><font style="vertical-align: inherit;">请参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-for-connection" title="8.8.4获取命名连接的执行计划信息"><font style="vertical-align: inherit;">第8.8.4节“获取命名连接的执行计划信息”</font></a><font style="vertical-align: inherit;">。
          </font></font><code class="literal">FOR CONNECTION
            <em class="replaceable"><code>connection_id</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-for-connection" title="8.8.4获取命名连接的执行计划信息"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生可以使用显示的附加执行计划信息
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-extended" title="8.8.3扩展的EXPLAIN输出格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.3节“扩展EXPLAIN输出格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于检查涉及分区表的查询很有用。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-info" title="22.3.5获取有关分区的信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3.5节“获取有关分区的信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项可用于选择输出格式。</font></font><code class="literal">TRADITIONAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以表格格式显示输出。</font><font style="vertical-align: inherit;">如果没有</font></font><code class="literal">FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，</font><font style="vertical-align: inherit;">这是默认值
             </font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式以JSON格式显示信息。
</font></font></p></li></ul>
</div>
<p>
        <a class="indexterm" name="idm140528103363248"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

        借助于此</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以看到应该在哪里添加索引，以便通过使用索引来查找行来更快地执行语句。</font><font style="vertical-align: inherit;">您还可以
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用来检查优化程序是否以最佳顺序加入表。</font><font style="vertical-align: inherit;">为了给优化器提示使用与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">中命名表的顺序相对应的连接顺序
         </font><font style="vertical-align: inherit;">，请使用</font></font><code class="literal">SELECT STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是仅仅</font><font style="vertical-align: inherit;">开始语句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.9节“SELECT语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）但是，
         </font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会阻止使用索引，因为它会禁用半连接转换。</font><font style="vertical-align: inherit;">看到
        </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化器跟踪有时可以提供与之相辅相成的信息</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，优化器跟踪格式和内容在版本之间可能会发生变化。</font><font style="vertical-align: inherit;">有关详细信息，请参阅
         </font></font><a class="ulink" href="http://dev.mysql.com/doc/internals/en/optimizer-tracing.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL内部：跟踪优化器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您在确定索引时没有使用索引时遇到问题，请运行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以更新表格统计信息（如键的基数），这些</font><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">可能会影响优化程序的选择。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.1节“ANALYZE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p>
          <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以用于获取有关表中列的信息。
          </font><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">和的
           </font><font style="vertical-align: inherit;">同义词</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#describe" title="13.8.1 DESCRIBE语法"><font style="vertical-align: inherit;">第13.8.1节“DESCRIBE语法”</font></a><font style="vertical-align: inherit;">和
           </font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#show-columns" title="13.7.5.5 SHOW COLUMNS语法"><font style="vertical-align: inherit;">第13.7.5.5节“SHOW COLUMNS语法”</font></a><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
          <em class="replaceable"><code>tbl_name</code></em></code></a><font style="vertical-align: inherit;"></font><code class="literal">DESCRIBE
          <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">SHOW COLUMNS FROM
          <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#describe" title="13.8.1 DESCRIBE语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#show-columns" title="13.7.5.5 SHOW COLUMNS语法"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="explain-output"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.2 EXPLAIN输出格式</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句提供有关MySQL如何执行语句的信息。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作品有
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">中使用的每个表返回一行信息
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它按照MySQL在处理语句时读取它们的顺序列出输出中的表。</font><font style="vertical-align: inherit;">MySQL使用嵌套循环连接方法解析所有连接。</font><font style="vertical-align: inherit;">这意味着MySQL从第一个表中读取一行，然后在第二个表，第三个表中找到匹配的行，等等。</font><font style="vertical-align: inherit;">处理完所有表后，MySQL通过表列表输出选定的列和回溯，直到找到有更多匹配行的表。</font><font style="vertical-align: inherit;">下一行从该表中读取，并且该过程继续下一个表。
      </font></font></p><p>
        <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出包括分区信息。</font><font style="vertical-align: inherit;">另外，对于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        语句，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成扩展信息，可以按照</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下
         </font><font style="vertical-align: inherit;">方式显示
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-extended" title="8.8.3扩展的EXPLAIN输出格式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.8.3节“扩展EXPLAIN输出格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在较旧的MySQL版本中，使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
          PARTITIONS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font><font style="vertical-align: inherit;">生成分区和扩展信息
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
          EXTENDED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些语法仍然被认为是向后兼容的，但分区和扩展输出现在默认启用，所以</font></font><code class="literal">PARTITIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和</font></font><code class="literal">EXTENDED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字是多余的，并且已被弃用。</font><font style="vertical-align: inherit;">它们的使用会导致警告，并且它们将</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在未来的MySQL版本中</font><font style="vertical-align: inherit;">从</font><font style="vertical-align: inherit;">语法中</font><font style="vertical-align: inherit;">删除</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您不能</font><font style="vertical-align: inherit;">在相同的</font><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">一起</font><font style="vertical-align: inherit;">使用弃用</font></font><code class="literal">PARTITIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和</font></font><code class="literal">EXTENDED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另外，这些关键字都不能与</font></font><code class="literal">FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">一起使用
           </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL Workbench具有Visual Explain功能，可提供</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出</font><font style="vertical-align: inherit;">的可视表示
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参阅
           </font></font><a class="ulink" href="http://dev.mysql.com/doc/workbench/en/wb-tutorial-visual-explain-dbt3.html" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">教程：使用说明来提高查询性能</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-output-columns" title="EXPLAIN输出列"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN输出列</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-join-types" title="EXPLAIN加入类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN加入类型</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-extra-information" title="解释额外信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解释额外信息</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-output-interpretation" title="EXPLAIN输出解释"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN输出解释</font></font></a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="explain-output-columns"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN输出列</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本部分介绍由产生的输出列
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">后面几节提供了关于</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain-join-types" title="EXPLAIN加入类型"><code class="literal">type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          和
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain-extra-information" title="解释额外信息"><code class="literal">Extra</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          列的</font><font style="vertical-align: inherit;">更多信息
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个输出行都</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提供有关一个表的信息。</font><font style="vertical-align: inherit;">每行包含</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-output-column-table" title="表8.1 EXPLAIN输出列"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表8.1“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇总</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#explain-output-column-table" title="表8.1 EXPLAIN输出列"><font style="vertical-align: inherit;">输出列”中</font></a><font style="vertical-align: inherit;">汇总的值
           </font><font style="vertical-align: inherit;">，并在表格后面详细介绍。</font><font style="vertical-align: inherit;">列名显示在表格的第一列中; </font><font style="vertical-align: inherit;">第二列提供</font></font><code class="literal">FORMAT=JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">时输出中显示的等效属性名称
           </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="table">
<a name="explain-output-column-table"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表8.1 EXPLAIN输出列</font></font></b></p>
<div class="table-contents">
<table summary="Output columns produced by the EXPLAIN statement."><colgroup><col width="25%"><col width="25%"><col width="50%"></colgroup><thead><tr>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱</font></font></th>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON名称</font></font></th>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含义</font></font></th>
            </tr></thead><tbody><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_id"><code class="literal">id</code></a></td>
              <td><code class="literal">select_id</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标识符</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_select_type"><code class="literal">select_type</code></a></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_table"><code class="literal">table</code></a></td>
              <td><code class="literal">table_name</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出行的表格</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_partitions"><code class="literal">partitions</code></a></td>
              <td><code class="literal">partitions</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配的分区</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_type"><code class="literal">type</code></a></td>
              <td><code class="literal">access_type</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接类型</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_possible_keys"><code class="literal">possible_keys</code></a></td>
              <td><code class="literal">possible_keys</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能的索引选择</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_key"><code class="literal">key</code></a></td>
              <td><code class="literal">key</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该指数实际选择</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_key_len"><code class="literal">key_len</code></a></td>
              <td><code class="literal">key_length</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所选键的长度</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_ref"><code class="literal">ref</code></a></td>
              <td><code class="literal">ref</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列与索引进行比较</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_rows"><code class="literal">rows</code></a></td>
              <td><code class="literal">rows</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要检查的行的估计</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_filtered"><code class="literal">filtered</code></a></td>
              <td><code class="literal">filtered</code></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按表条件过滤的行的百分比</font></font></td>
            </tr><tr>
              <td scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain_extra"><code class="literal">Extra</code></a></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加信息</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            JSON属性</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会显示在JSON格式的</font></font><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            输出中。
</font></font></p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="explain_id"></a>
              <code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：
               </font></font><code class="literal">select_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标识符。</font><font style="vertical-align: inherit;">这是</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询内部的</font><font style="vertical-align: inherit;">连续编号
               </font><font style="vertical-align: inherit;">。</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果该行引用其他行的联合结果，则</font><font style="vertical-align: inherit;">该值可以是该值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，
               </font></font><code class="literal">table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列显示的值喜欢
               </font><font style="vertical-align: inherit;">
              以指示该行是指行的联合与</font><font style="vertical-align: inherit;">的值
               </font><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">&lt;union<em class="replaceable"><code>M</code></em>,<em class="replaceable"><code>N</code></em>&gt;</code><font style="vertical-align: inherit;"></font><code class="literal">id</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><a name="explain_select_type"></a>
              <code class="literal">select_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （JSON名称：无）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              类型</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以是下表中显示的任何</font><font style="vertical-align: inherit;">类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">JSON格式</font></font><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font><font style="vertical-align: inherit;">公开
               </font><font style="vertical-align: inherit;">为a的属性
               </font></font><code class="literal">query_block</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，除非它是
               </font></font><code class="literal">SIMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">PRIMARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">表中还显示了JSON名称（如果适用）。
</font></font></p>
<div class="informaltable">
<table summary="select_type values and the meaning of each value."><colgroup><col width="25%"><col width="25%"><col width="50%"></colgroup><thead><tr>
                  <th scope="col"><code class="literal">select_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 值</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON名称</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含义</font></font></th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">SIMPLE</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不使用
                     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或子查询）</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">PRIMARY</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最 </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a></td>
                </tr><tr>
                  <td scope="row"><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二次或以后的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明
                    </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a></td>
                </tr><tr>
                  <td scope="row"><code class="literal">DEPENDENT UNION</code></td>
                  <td><code class="literal">dependent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="literal">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个或更晚的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
                     </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依赖于外部查询</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">UNION RESULT</code></td>
                  <td><code class="literal">union_result</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">SUBQUERY</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在子查询中</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">DEPENDENT SUBQUERY</code></td>
                  <td><code class="literal">dependent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="literal">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在子查询中，依赖于外部查询</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">DERIVED</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">派生表</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（子查询中的子查询
                     </font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">MATERIALIZED</code></td>
                  <td><code class="literal">materialized_from_subquery</code></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化子查询</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">UNCACHEABLE SUBQUERY</code></td>
                  <td><code class="literal">cacheable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="literal">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法缓存结果的子查询，必须对外部查询的每一行重新评估</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">UNCACHEABLE UNION</code></td>
                  <td><code class="literal">cacheable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="literal">false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></td>
                  <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个或更高版本选择</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#union" title="13.2.9.3 UNION语法"><code class="literal">UNION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    属于不可缓存的子查询（请参阅
                     </font></font><code class="literal">UNCACHEABLE SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></td>
</tr></tbody></table>
</div>
<p>
              <code class="literal">DEPENDENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常表示使用相关的子查询。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#correlated-subqueries" title="13.2.10.7相关子查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.10.7节“相关子查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p>
              <code class="literal">DEPENDENT SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估与评估不同</font></font><code class="literal">UNCACHEABLE SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因为</font></font><code class="literal">DEPENDENT SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，子查询</font><font style="vertical-align: inherit;">对于</font><font style="vertical-align: inherit;">来自外部上下文的变量的每个不同值集合仅重新评估一次。</font><font style="vertical-align: inherit;">因为
               </font></font><code class="literal">UNCACHEABLE SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询是针对外部上下文的每一行重新评估的。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              子查询的可缓存性与查询缓存中查询结果的缓存不同（
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache-operation" title="8.10.3.1查询缓存如何操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3.1节“查询缓存如何操作”中有描述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">子查询缓存发生在查询执行期间，而查询缓存仅在查询执行完成后用于存储结果。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当您指定</font></font><code class="literal">FORMAT=JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时
               </font></font><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，输出没有直接等价于的单个属性
               </font></font><code class="literal">select_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">该
               </font></font><code class="literal">query_block</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性对应于给定的</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">相当于</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刚刚显示的</font><font style="vertical-align: inherit;">大多数</font><font style="vertical-align: inherit;">子查询类型的</font><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">都可用（示例
               </font></font><code class="literal">materialized_from_subquery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用
               </font></font><code class="literal">MATERIALIZED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并在适当时显示。</font></font><code class="literal">SIMPLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font><font style="vertical-align: inherit;">没有JSON等价物
               </font></font><code class="literal">PRIMARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">select_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">
              的</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">显示受影响的表的语句类型。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">select_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
               </font></font><code class="literal">DELETE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报表。
            </font></font></p></li><li class="listitem"><p><a name="explain_table"></a>
              <code class="literal">table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：
               </font></font><code class="literal">table_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              输出行涉及的表的名称。</font><font style="vertical-align: inherit;">这也可以是以下值之一：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">&lt;union<em class="replaceable"><code>M</code></em>,<em class="replaceable"><code>N</code></em>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：该行指与行的工会
                   </font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的价值
                   </font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                   </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">&lt;derived<em class="replaceable"><code>N</code></em>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：该行指的是具有</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为
                   </font><font style="vertical-align: inherit;">的行的派生表结果</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，派生表可能来自</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">的子查询
                   </font><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">&lt;subquery<em class="replaceable"><code>N</code></em>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：该行指的是具有</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  值为</font><font style="vertical-align: inherit;">的行的物化子查询的结果</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
                   </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#subquery-materialization" title="8.2.2.2使用物化优化子查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.2节“使用实现优化子查询”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><a name="explain_partitions"></a>
              <code class="literal">partitions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：
               </font></font><code class="literal">partitions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              记录将与查询匹配的分区。</font><font style="vertical-align: inherit;">该值适用</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于未分区的表格。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/partitioning.html#partitioning-info" title="22.3.5获取有关分区的信息"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第22.3.5节“获取有关分区的信息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="explain_type"></a>
              <code class="literal">type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：
               </font></font><code class="literal">access_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              连接类型。</font><font style="vertical-align: inherit;">有关不同类型的说明，请参阅
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain-join-types" title="EXPLAIN加入类型"><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              联接类型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="explain_possible_keys"></a>
              <code class="literal">possible_keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：
               </font></font><code class="literal">possible_keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">possible_keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列指示MySQL可以从中选择哪些索引来查找此表中的行。</font><font style="vertical-align: inherit;">请注意，此列完全独立于输出中显示的表的顺序
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着某些键</font></font><code class="literal">possible_keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能无法在生成的表格顺序中使用。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果此列是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或在JSON格式的输出中未定义），则没有相关索引。</font><font style="vertical-align: inherit;">在这种情况下，您可以通过检查该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              子句来检查是否引用适合索引的一列或多列，</font><font style="vertical-align: inherit;">从而提高查询的性能</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果是这样，请创建一个适当的索引并</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次</font><font style="vertical-align: inherit;">检查查询
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.8节“ALTER TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要查看表格具有哪些索引，请使用</font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">SHOW INDEX
              FROM <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><a name="explain_key"></a>
              <code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：</font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表示MySQL实际决定使用的键（索引）。</font><font style="vertical-align: inherit;">如果MySQL决定使用其中一个</font></font><code class="literal">possible_keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              索引来查找行，那么该索引将被列为关键值。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              有可能</font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会命名该值中不存在的索引
               </font></font><code class="literal">possible_keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果没有</font></font><code class="literal">possible_keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引适合查找行，</font><font style="vertical-align: inherit;">则会发生这种情况</font><font style="vertical-align: inherit;">，但查询选择的所有列都是其他索引的列。</font><font style="vertical-align: inherit;">也就是说，指定的索引覆盖了选定的列，因此虽然它不用于确定要检索哪些行，但索引扫描比数据行扫描更有效。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              因为</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即使查询也选择主键，辅助索引可能会覆盖所选列，因为</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将主键值存储在每个辅助索引中。</font><font style="vertical-align: inherit;">如果
               </font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，MySQL发现没有索引用于更有效地执行查询。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要强制MySQL使用或忽略列出的索引
               </font></font><code class="literal">possible_keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，使用
               </font></font><code class="literal">FORCE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">USE
              INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">IGNORE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的查询。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-hints" title="8.9.4索引提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.4节“索引提示”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，运行
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有助于优化器选择更好的索引。</font><font style="vertical-align: inherit;">对于
               </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk --analyze</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是一样。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.2.1节“ANALYZE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="xref" href="/mysql-5.7-google-zh/backup-and-recovery.html#myisam-table-maintenance" title="7.6 MyISAM表维护和崩溃恢复"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.6节“MyISAM表维护和崩溃恢复”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="explain_key_len"></a>
              <code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：
               </font></font><code class="literal">key_length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表示MySQL决定使用的密钥的长度。</font><font style="vertical-align: inherit;">这个值
               </font></font><code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使您能够确定MySQL实际使用的多部分密钥的多少部分。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专栏说
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">len_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              专栏也说</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于密钥存储格式，密钥长度大于该可以是列一个</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              比一个</font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。
            </font></font></p></li><li class="listitem"><p><a name="explain_ref"></a>
              <code class="literal">ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：</font></font><code class="literal">ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列显示哪些列或常量与列中指定的索引进行比较以
               </font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从表中选择行。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果值是</font></font><code class="literal">func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则使用的值是某个函数的结果。</font><font style="vertical-align: inherit;">要查看哪个功能，请使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下内容
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看扩展
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出。</font><font style="vertical-align: inherit;">该函数实际上可能是算术运算符等运算符。
            </font></font></p></li><li class="listitem"><p><a name="explain_rows"></a>
              <code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：
               </font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表示MySQL认为它必须检查以执行查询的行数。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格，这个数字是一个估计值，可能并不总是准确的。
            </font></font></p></li><li class="listitem"><p><a name="explain_filtered"></a>
              <code class="literal">filtered</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON名：
               </font></font><code class="literal">filtered</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">filtered</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表示将根据表条件过滤的表行的估计百分比。</font><font style="vertical-align: inherit;">即，</font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              显示检查的估计行数，
               </font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">×
               </font></font><code class="literal">filtered</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code class="literal">100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示将与先前表连接的行数。
            </font></font></p></li><li class="listitem"><p><a name="explain_extra"></a>
              <code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （JSON名称：无）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此列包含有关MySQL如何解析查询的其他信息。</font><font style="vertical-align: inherit;">有关不同值的说明，请参阅
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain-extra-information" title="解释额外信息"><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              附加信息</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有与该</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">对应的单个JSON属性
               </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">但是，此列中可能出现的值将作为JSON属性或属性的文本公开</font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="explain-join-types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN加入类型</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出介绍如何联接表。</font><font style="vertical-align: inherit;">在JSON格式的输出中，这些被作为</font></font><code class="literal">access_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性的</font><font style="vertical-align: inherit;">值查找</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下列表描述了从最佳类型到最差类型的连接类型：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="jointype_system"></a>
              <a class="indexterm" name="idm140528103014288"></a>

              <a class="indexterm" name="idm140528103012832"></a>

              <a class="indexterm" name="idm140528103011344"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_system"><code class="literal">system</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该表只有一行（=系统表）。</font><font style="vertical-align: inherit;">这是</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接类型</font><font style="vertical-align: inherit;">的特例
               </font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="jointype_const"></a>
              <a class="indexterm" name="idm140528103005664"></a>

              <a class="indexterm" name="idm140528103004208"></a>

              <a class="indexterm" name="idm140528103002720"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该表至多有一个匹配行，在查询开始时读取。</font><font style="vertical-align: inherit;">因为只有一行，所以该行中列的值可以被优化器的其余部分视为常量。
              </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格非常快，因为它们只能读取一次。
            </font></font></p><p>
              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于将a </font></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引的</font><font style="vertical-align: inherit;">所有部分</font><font style="vertical-align: inherit;">与常量值</font><font style="vertical-align: inherit;">进行比较时使用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在以下查询中，</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用作</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表格：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>primary_key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>primary_key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2;
</font></font></pre></li><li class="listitem"><p><a name="jointype_eq_ref"></a>
              <a class="indexterm" name="idm140528102988880"></a>

              <a class="indexterm" name="idm140528102987424"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从这张表中读取一行，用于前面表格的每行组合。</font><font style="vertical-align: inherit;">除了
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_system"><code class="literal">system</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型之外，这是最好的连接类型。</font><font style="vertical-align: inherit;">它在索引的所有部分被连接使用并且索引是a
               </font></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">UNIQUE NOT
              NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引时使用。
            </font></font></p><p>
              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用于使用</font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font><font style="vertical-align: inherit;">进行比较的索引列
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">比较值可以是一个常量，或者是一个表达式，该表达式使用来自该表格之前的表格中的列。</font><font style="vertical-align: inherit;">在以下示例中，MySQL可以使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接来处理
               </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择*从</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在</font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择*从</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在</font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  和</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1;
</font></font></pre></li><li class="listitem"><p><a name="jointype_ref"></a>
              <a class="indexterm" name="idm140528102967760"></a>

              <a class="indexterm" name="idm140528102966336"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从该表中读取具有匹配索引值的所有行，用于来自先前表的各行的组合。</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果连接仅使用键的最左侧前缀或者键不是a </font></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引（换句话说，如果连接无法基于键值选择单个行），则使用该键。</font><font style="vertical-align: inherit;">如果使用的键只匹配几行，这是一个很好的连接类型。
            </font></font></p><p>
              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用于使用</font></font><code class="literal">=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="literal">&lt;=&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              运算符</font><font style="vertical-align: inherit;">进行比较的索引列
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在以下示例中，MySQL可以使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接来处理
               </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择*从</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在</font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择*从</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在</font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  哪里</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  和</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1;
</font></font></pre></li><li class="listitem"><p><a name="jointype_fulltext"></a>
              <a class="indexterm" name="idm140528102945008"></a>

              <a class="indexterm" name="idm140528102943552"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_fulltext"><code class="literal">fulltext</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              连接使用</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              索引</font><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="jointype_ref_or_null"></a>
              <a class="indexterm" name="idm140528102938384"></a>

              <a class="indexterm" name="idm140528102936928"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这种连接类型很像
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是另外MySQL会额外搜索包含</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这种连接类型优化最常用于解析子查询。</font><font style="vertical-align: inherit;">在以下示例中，MySQL可以使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接来处理</font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是NULL;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#is-null-optimization" title="8.2.1.12 IS NULL优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.12节“IS NULL优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="jointype_index_merge"></a>
              <a class="indexterm" name="idm140528102924800"></a>

              <a class="indexterm" name="idm140528102923344"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此连接类型表示使用索引合并优化。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出行中的列包含使用的索引列表，并</font></font><code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含所用</font><font style="vertical-align: inherit;">索引
               </font><font style="vertical-align: inherit;">的最长关键部分列表。</font><font style="vertical-align: inherit;">有关更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><a name="jointype_unique_subquery"></a>
              <a class="indexterm" name="idm140528102916576"></a>

              <a class="indexterm" name="idm140528102915088"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这种类型取代
               </font><font style="vertical-align: inherit;">了以下形式的</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些
               </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询：
            </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><em class="replaceable"><code>single_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪里</font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p>
              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 只是一个索引查找函数，它可以完全替代子查询以提高效率。
            </font></font></p></li><li class="listitem"><p><a name="jointype_index_subquery"></a>
              <a class="indexterm" name="idm140528102904288"></a>

              <a class="indexterm" name="idm140528102902832"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这种连接类型与
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它取代了</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询，但它适用于以下形式的子查询中的非唯一索引：
            </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><em class="replaceable"><code>single_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪里</font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre></li><li class="listitem"><p><a name="jointype_range"></a>
              <a class="indexterm" name="idm140528102893760"></a>

              <a class="indexterm" name="idm140528102892304"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              只有在给定范围内的行才会被检索到，使用索引来选择行。</font><font style="vertical-align: inherit;">的</font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              输出行中的列指示使用哪个索引。</font><font style="vertical-align: inherit;">将</font></font><code class="literal">key_len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含已使用的时间最长的关键部分。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于此类型。
            </font></font></p><p>
              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当一个键列使用任何的相比于恒定可使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal"><code class="literal">=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than"><code class="literal">&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than"><code class="literal">&lt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_is-null"><code class="literal">IS NULL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#operator_between"><code class="literal">BETWEEN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_in"><code class="literal">IN()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运营商：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10和20之间;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（10,20,30）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（10,20,30）;
</font></font></pre></li><li class="listitem"><p><a name="jointype_index"></a>
              <a class="indexterm" name="idm140528102865840"></a>

              <a class="indexterm" name="idm140528102864384"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index"><code class="literal">index</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联接类型是一样的
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只是索引树被扫描。</font><font style="vertical-align: inherit;">这发生在两个方面：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  如果索引是查询的覆盖索引并且可用于满足表中所需的所有数据，则只扫描索引树。</font><font style="vertical-align: inherit;">在这种情况下，该</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专栏说
                   </font></font><code class="literal">Using index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">仅索引扫描通常比</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于索引大小通常小于表数据</font><font style="vertical-align: inherit;">而更快
                   </font><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  使用索引中的读取来执行全表扫描，以按索引顺序查找数据行。
                  </font></font><code class="literal">Uses index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有出现在
                   </font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当查询仅使用属于单个索引一部分的列时，MySQL可以使用此连接类型。
            </font></font></p></li><li class="listitem"><p><a name="jointype_all"></a>
              <a class="indexterm" name="idm140528102850880"></a>

              <a class="indexterm" name="idm140528102849456"></a>

              <a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              全表扫描是针对先前表中的每一行组合完成的。</font><font style="vertical-align: inherit;">如果表格是没有标记的第一个表格</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，通常</font><font style="vertical-align: inherit;">情况</font><font style="vertical-align: inherit;">下并不好
               </font><font style="vertical-align: inherit;">，而</font><font style="vertical-align: inherit;">在其他所有情况下</font><font style="vertical-align: inherit;">通常
               </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都很</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">糟糕。</font><font style="vertical-align: inherit;">通常情况下，您可以</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过添加索引</font><font style="vertical-align: inherit;">来避免
               </font><font style="vertical-align: inherit;">这些索引，这些索引可以基于来自较早表的常量值或列值从表中检索行。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="explain-extra-information"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解释额外信息</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出包含MySQL解决查询的额外信息。</font><font style="vertical-align: inherit;">以下列表解释了可以在此列中显示的值。</font><font style="vertical-align: inherit;">每个项目还指示JSON格式的输出，该属性显示该</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">对于其中的一些，有一个特定的属性。</font><font style="vertical-align: inherit;">其他显示为</font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          属性</font><font style="vertical-align: inherit;">的文本</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果你想使你的查询尽可能快，看出来</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的列值</font></font><code class="literal">Using
          filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">Using temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或在JSON格式的</font></font><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出，用于
           </font></font><code class="literal">using_filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">using_temporary_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于性能
           </font></font><code class="literal">true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">Child of '<em class="replaceable"><code>table</code></em>'
              pushed join@1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON：</font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              文本）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该表被引用为</font></font><em class="replaceable"><code>table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以下推到NDB内核的连接中</font><font style="vertical-align: inherit;">的子
               </font><font style="vertical-align: inherit;">节点。</font><font style="vertical-align: inherit;">仅在启用了下推连接时才适用于NDB群集。</font><font style="vertical-align: inherit;">有关</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html#sysvar_ndb_join_pushdown"><code class="literal">ndb_join_pushdown</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多信息和示例，</font><font style="vertical-align: inherit;">请参阅
               </font><font style="vertical-align: inherit;">服务器系统变量的说明。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">const row not found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">const_row_not_found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于诸如此类的查询</font><font style="vertical-align: inherit;">，该表是空的。
            </font></font><code class="literal">SELECT ... FROM
              <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <code class="literal">Deleting all rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              因为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，一些存储引擎（例如</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）支持一种处理器方法，以简单快捷的方式删除所有表格行。</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果引擎使用此优化，则会显示</font><font style="vertical-align: inherit;">此</font><font style="vertical-align: inherit;">值。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Distinct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">distinct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL正在寻找不同的值，所以当它找到第一个匹配的行后，它会停止为当前行组合搜索更多的行。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">FirstMatch(<em class="replaceable"><code>tbl_name</code></em>)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （JSON属性：</font></font><code class="literal">first_match</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              半连接FirstMatch加入快捷方式策略用于</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Full scan on NULL key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当优化程序不能使用索引查找访问方法时，会发生子查询优化作为回退策略。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Impossible HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句始终为false，不能选择任何行。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Impossible WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句始终为false，不能选择任何行。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Impossible WHERE noticed after reading const
              tables</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL已经读取了所有
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（和
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_system"><code class="literal">system</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）表并注意到该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句总是为false。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">LooseScan(<em class="replaceable"><code>m</code></em>..<em class="replaceable"><code>n</code></em>)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （JSON属性：</font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用半连接LooseScan策略。
              </font></font><em class="replaceable"><code>m</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且
               </font></font><em class="replaceable"><code>n</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是关键部件号码。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">No matching min/max row</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              没有行满足查询条件，如
               </font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">SELECT MIN(...) FROM ... WHERE
              <em class="replaceable"><code>condition</code></em></code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <code class="literal">no matching row in const table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：</font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于包含联接的查询，存在一个空表或没有满足唯一索引条件的行的表。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">No matching rows after partition
              pruning</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，优化器在分区修剪后没有发现任何要删除或更新的内容。</font><font style="vertical-align: inherit;">这是在意义上类似</font></font><code class="literal">Impossible WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">No tables used</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该查询没有</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，或者有一个
               </font></font><code class="literal">FROM DUAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当没有</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              部分</font><font style="vertical-align: inherit;">时显示此值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，它似乎是</font></font><code class="literal">EXPLAIN INSERT
              INTO t VALUES(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为这相当于
               </font></font><code class="literal">EXPLAIN INSERT INTO t SELECT 10 FROM
              DUAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Not exists</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL能够对</font></font><code class="literal">LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              查询</font><font style="vertical-align: inherit;">进行</font><font style="vertical-align: inherit;">优化，并且在查找到符合</font></font><code class="literal">LEFT
              JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件的</font><font style="vertical-align: inherit;">一行后，不会在该表中检查前一行组合的更多行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下是可以用这种方式进行优化的查询类型的示例：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN t2 ON t1.id = t2.id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE t2.id IS NULL;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              假定</font></font><code class="literal">t2.id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被定义为
               </font></font><code class="literal">NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，MySQL </font><font style="vertical-align: inherit;">使用值来
               </font><font style="vertical-align: inherit;">扫描
               </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并查找行
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果MySQL找到匹配的行
               </font><font style="vertical-align: inherit;">，它知道
               </font><font style="vertical-align: inherit;">永远不会
               </font><font style="vertical-align: inherit;">，并且不扫描</font><font style="vertical-align: inherit;">具有相同</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">的其余行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">换句话说，对于每一行</font><font style="vertical-align: inherit;">，MySQL都只需要进行一次查询</font><font style="vertical-align: inherit;">，而不管有多少行匹配</font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">t2</code><font style="vertical-align: inherit;"></font><code class="literal">t1.id</code><font style="vertical-align: inherit;"></font><code class="literal">t2</code><font style="vertical-align: inherit;"></font><code class="literal">t2.id</code><font style="vertical-align: inherit;"></font><code class="literal">NULL</code><font style="vertical-align: inherit;"></font><code class="literal">t2</code><font style="vertical-align: inherit;"></font><code class="literal">id</code><font style="vertical-align: inherit;"></font><code class="literal">t1</code><font style="vertical-align: inherit;"></font><code class="literal">t2</code><font style="vertical-align: inherit;"></font><code class="literal">t2</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <code class="literal">Plan isn't ready yet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （JSON属性：无）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该值</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain-for-connection" title="8.8.4获取命名连接的执行计划信息"><code class="literal">EXPLAIN FOR
              CONNECTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在优化器没有完成为在命名连接中执行的语句创建执行计划时</font><font style="vertical-align: inherit;">发生</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果执行计划输出包含多行，那么</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据优化程序在确定完整执行计划时的进度，</font><font style="vertical-align: inherit;">它们中的任何一个或全部都可以具有此
               </font><font style="vertical-align: inherit;">值。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Range checked for each record (index map:
              <em class="replaceable"><code>N</code></em>)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL发现没有好的索引来使用，但发现一些索引可能在前面表格的列值已知之后使用。</font><font style="vertical-align: inherit;">对于上表中的每一行组合，MySQL检查是否可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_range"><code class="literal">range</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问方法来检索行。</font><font style="vertical-align: inherit;">这不是非常快，但比执行没有索引的连接要快。</font><font style="vertical-align: inherit;">适用性标准如
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#range-optimization" title="8.2.1.2范围优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.2节“范围优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”中所述。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，除了前面表格的所有列值是已知的并被认为是常量。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              索引从1开始编号，顺序</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-index" title="13.7.5.22 SHOW INDEX语法"><code class="literal">SHOW INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与表中</font><font style="vertical-align: inherit;">所示的顺序相同</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">索引映射值
               </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是指示哪些索引是候选的位掩码值。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">0x19</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（二进制11001）</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">意味着将考虑索引1,4和5。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Scanned <em class="replaceable"><code>N</code></em>
              databases</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这表示在处理</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">查询时服务器执行的目录扫描次数
               </font><font style="vertical-align: inherit;">，如</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#information-schema-optimization" title="8.2.3优化INFORMATION_SCHEMA查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.3节“优化INFORMATION_SCHEMA查询”所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">值</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以是0,1或
               </font></font><code class="literal">all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Select tables optimized away</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：</font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              优化器确定1）至多应该返回一行，并且2）为了产生该行，必须读取确定性的一组行。</font><font style="vertical-align: inherit;">当在优化阶段读取的行可以被读取（例如通过读取索引行）时，在查询执行期间不需要读取任何表。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当查询被隐式分组（包含一个聚合函数但没有</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句）</font><font style="vertical-align: inherit;">时，满足第一个条件
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当使用每个索引执行一个行查找时，满足第二个条件。</font><font style="vertical-align: inherit;">读取的索引数量决定了要读取的行数。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              考虑以下隐式分组查询：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MIN（c1），MIN（c2）FROM t1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              假设</font></font><code class="literal">MIN(c1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过读取一个索引行</font></font><code class="literal">MIN(c2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              来检索，</font><font style="vertical-align: inherit;">并且</font><font style="vertical-align: inherit;">可以通过从不同索引读取一行来检索。</font><font style="vertical-align: inherit;">即，对于每一列</font></font><code class="literal">c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">c2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，存在其中列是索引的第一列的索引。</font><font style="vertical-align: inherit;">在这种情况下，返回一行，通过读取两个确定性行产生。
            </font></font></p><p><font style="vertical-align: inherit;"></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要读取的行不是确定性的，则不会发生</font><font style="vertical-align: inherit;">
              此</font><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">考虑这个查询：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MIN（c2）FROM t1 WHERE c1 &lt;= 10;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              假设这</font></font><code class="literal">(c1, c2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个覆盖索引。</font><font style="vertical-align: inherit;">使用此索引，</font></font><code class="literal">c1 &lt;=
              10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须扫描</font><font style="vertical-align: inherit;">所有行</font><font style="vertical-align: inherit;">以查找最小值
               </font></font><code class="literal">c2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">相比之下，考虑这个查询：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MIN（c2）FROM t1 WHERE c1 = 10;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在这种情况下，第一个索引行</font></font><code class="literal">c1 =
              10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含最小值</font></font><code class="literal">c2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              。</font><font style="vertical-align: inherit;">只有一行必须被读取以产生返回的行。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于每个表保持精确行数的存储引擎（例如</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不是
               </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font><font style="vertical-align: inherit;">对于</font><font style="vertical-align: inherit;">子句缺失或始终为真且没有</font><font style="vertical-align: inherit;">
              子句的</font><font style="vertical-align: inherit;">查询，</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可能会发生</font><font style="vertical-align: inherit;">此</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这是隐式分组查询的一个实例，其中存储引擎影响是否可读取确定数量的行。）
            </font></font><code class="literal">COUNT(*)</code><font style="vertical-align: inherit;"></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <code class="literal">Skip_open_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Open_frm_only</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Open_full_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些值表示适用于查询</font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表的</font><font style="vertical-align: inherit;">文件打开优化</font><font style="vertical-align: inherit;">，如
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#information-schema-optimization" title="8.2.3优化INFORMATION_SCHEMA查询"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.3节“优化INFORMATION_SCHEMA查询”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">Skip_open_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：表格文件不需要打开。</font><font style="vertical-align: inherit;">通过扫描数据库目录，查询中的信息已经可用。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">Open_frm_only</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：只</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要打开</font><font style="vertical-align: inherit;">表格
                   </font><font style="vertical-align: inherit;">文件。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">Open_full_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：未优化的信息查询。</font><font style="vertical-align: inherit;">的</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                   </font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                   </font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件必须被打开。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p>
              <code class="literal">Start temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">End
              temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这表示半连接Duplicate Weedout策略的临时表使用情况。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">unique row not found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于像这样的查询</font><font style="vertical-align: inherit;">，没有行满足</font><font style="vertical-align: inherit;">
              索引</font><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">表上的</font><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">。
            </font></font><code class="literal">SELECT ... FROM
              <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">UNIQUE</code><font style="vertical-align: inherit;"></font><code class="literal">PRIMARY KEY</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
              <code class="literal">Using filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">using_filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL必须执行额外的传递以了解如何按排序顺序检索行。</font><font style="vertical-align: inherit;">排序是按照连接类型遍历所有行并存储排序键和指向与该</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">匹配的所有行的行的指针</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后对键进行排序，并按排序顺序检索行。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#order-by-optimization" title="8.2.1.13 ORDER BY优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.13节“按优化排序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">using_index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              只使用索引树中的信息从表中检索列信息，而不必执行额外的查找来读取实际行。</font><font style="vertical-align: inherit;">当查询仅使用属于单个索引一部分的列时，可以使用此策略。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有用户定义的聚簇索引的表格，即使</font><font style="vertical-align: inherit;">列中</font></font><code class="literal">Using index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不存在，
               </font><font style="vertical-align: inherit;">也可以使用该索引</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
               </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index"><code class="literal">index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是，</font><font style="vertical-align: inherit;">就是这种情况
               </font></font><code class="literal">PRIMARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using index condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">using_index_condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过访问索引元组并首先对其进行测试以确定是否读取全表行来读取表。</font><font style="vertical-align: inherit;">这样，</font><font style="vertical-align: inherit;">除非必要，否则</font><font style="vertical-align: inherit;">索引信息用于推迟（</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“下</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）读取全表行。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-condition-pushdown-optimization" title="8.2.1.5索引条件下推优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.5节“索引条件下推优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using index for group-by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：</font></font><code class="literal">using_index_for_group_by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与</font></font><code class="literal">Using index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表访问方法</font><font style="vertical-align: inherit;">类似</font><font style="vertical-align: inherit;">，</font></font><code class="literal">Using index for group-by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表明MySQL找到了一个索引，可用于检索某个</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font><font style="vertical-align: inherit;">某个</font></font><code class="literal">DISTINCT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询的</font><font style="vertical-align: inherit;">所有列，</font><font style="vertical-align: inherit;">而无需对实际表进行任何额外的磁盘访问。</font><font style="vertical-align: inherit;">此外，索引以最有效的方式使用，因此对于每个组，只有少数索引条目被读取。</font><font style="vertical-align: inherit;">有关详细信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#group-by-optimization" title="8.2.1.14 GROUP BY优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.14节“GROUP BY优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using join buffer (Block Nested Loop)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">Using join buffer (Batched Key Access)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （JSON属性：</font></font><code class="literal">using_join_buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              先前连接的表被分成几部分读入连接缓冲区，然后从缓冲区中使用它们的行来执行与当前表的连接。
              </font></font><code class="literal">(Block Nested Loop)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示使用块嵌套循环算法并</font></font><code class="literal">(Batched Key
              Access)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示使用批处理密钥访问算法。</font><font style="vertical-align: inherit;">也就是说，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出</font><font style="vertical-align: inherit;">的前一行表格中的键
               </font><font style="vertical-align: inherit;">将被缓冲，匹配的行将从</font></font><code class="literal">Using join buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出现</font><font style="vertical-align: inherit;">的行所表示的表中批量提取
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在JSON格式的输出中，值
               </font></font><code class="literal">using_join_buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终是</font></font><code class="literal">Block Nested Loop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或之一
               </font></font><code class="literal">Batched Key Access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using MRR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用多范围读取优化策略读取表格。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#mrr-optimization" title="8.2.1.10多范围读取优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.10节“多量程读取优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using sort_union(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Using
              union(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">Using
              intersect(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些表明特定的算法显示了如何合并</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接类型的</font><font style="vertical-align: inherit;">索引扫描
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using temporary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">using_temporary_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              为了解决这个查询，MySQL需要创建一个临时表来保存结果。</font><font style="vertical-align: inherit;">这通常发生在查询包含</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出不同列的子句的情况下。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using where</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">attached_condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              甲</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句用于限制匹配哪些行针对下一个表或发送到客户端。</font><font style="vertical-align: inherit;">除非特意打算从表中读取或检查所有行，否则如果</font></font><code class="literal">Extra</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不是
               </font></font><code class="literal">Using where</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">且表连接类型为</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font><font style="vertical-align: inherit;">，则
               </font><font style="vertical-align: inherit;">查询中可能有问题</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_index"><code class="literal">index</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p>
              <code class="literal">Using where</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在JSON格式的输出中没有直接的对应; </font><font style="vertical-align: inherit;">该
               </font></font><code class="literal">attached_condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性包含使用的任何</font></font><code class="literal">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Using where with pushed condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：</font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此产品适用于</font></font><a class="link" href="/mysql-5.7-google-zh/mysql-cluster.html" title="第21章MySQL NDB集群7.5和NDB集群7.6"><code class="literal">NDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着NDB集群正在使用条件下推优化来提高非索引列和常量之间的直接比较效率。</font><font style="vertical-align: inherit;">在这种情况下，条件被</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推下</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到集群的数据节点，并在所有数据节点上同时进行评估。</font><font style="vertical-align: inherit;">这消除了通过网络发送不匹配的行的需要，并且在情况下推可能但未被使用的情况下，可以将这些查询加速5到10倍。</font><font style="vertical-align: inherit;">有关更多信息，请参阅
              </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#condition-pushdown-optimization" title="8.2.1.4引擎状况下推优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.4节“发动机状态下推优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">Zero limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（JSON属性：
               </font></font><code class="literal">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              查询有一个</font></font><code class="literal">LIMIT 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，不能选择任何行。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="explain-output-interpretation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN输出解释</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过获取</font><font style="vertical-align: inherit;">输出</font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          列中的</font><font style="vertical-align: inherit;">值的乘积，可以很好地指示连接有多好</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这应该大致告诉你MySQL必须检查多少行来执行查询。</font><font style="vertical-align: inherit;">如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_join_size"><code class="literal">max_join_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">限制查询，则
           </font><font style="vertical-align: inherit;">该行产品还用于确定</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要执行</font><font style="vertical-align: inherit;">哪个多表</font><font style="vertical-align: inherit;">语句以及要中止</font><font style="vertical-align: inherit;">哪个多表</font><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-configuration" title="5.1.1配置服务器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下示例显示了如何根据提供的信息逐步优化多表连接
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设您有</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里显示</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">语句，并且您打算使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下</font><font style="vertical-align: inherit;">语句进行检查
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN SELECT tt.TicketNumber，tt.TimeIn，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.ProjectReference，tt.EstimatedShipDate，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.ActualShipDate，tt.ClientID，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.ServiceCodes，tt.RepetitiveID，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.CurrentProcess，tt.CurrentDPerson，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.RecordVolume，tt.DPPrinted，et.COUNTRY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               et_1.COUNTRY，do.CUSTNAME</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        FROM tt，et，et et al，do</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        WHERE tt.SubmitTime是NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          AND tt.ActualPC = et.EMPLOYID</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          AND tt.AssignedPC = et_1.EMPLOYID</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          AND tt.ClientID = do.CUSTNMBR;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于这个例子，做出以下假设：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              被比较的列已被声明如下。
</font></font></p>
<div class="informaltable">
<table summary="Table names, column names, and data types for the columns being compared in the EXPLAIN example described in the preceding text."><colgroup><col width="10%"><col width="25%"><col width="25%"></colgroup><thead><tr>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柱</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据类型</font></font></th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">tt</code></td>
                  <td><code class="literal">ActualPC</code></td>
                  <td><code class="literal">CHAR(10)</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">tt</code></td>
                  <td><code class="literal">AssignedPC</code></td>
                  <td><code class="literal">CHAR(10)</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">tt</code></td>
                  <td><code class="literal">ClientID</code></td>
                  <td><code class="literal">CHAR(10)</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">et</code></td>
                  <td><code class="literal">EMPLOYID</code></td>
                  <td><code class="literal">CHAR(15)</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">do</code></td>
                  <td><code class="literal">CUSTNMBR</code></td>
                  <td><code class="literal">CHAR(15)</code></td>
</tr></tbody></table>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这些表具有以下索引。
</font></font></p>
<div class="informaltable">
<table summary="Indexes for each of the tables that are part of the EXPLAIN example described in the preceding text."><colgroup><col width="10%"><col width="40%"></colgroup><thead><tr>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font></font></th>
                  <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指数</font></font></th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">tt</code></td>
                  <td><code class="literal">ActualPC</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">tt</code></td>
                  <td><code class="literal">AssignedPC</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">tt</code></td>
                  <td><code class="literal">ClientID</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">et</code></td>
                  <td><code class="literal">EMPLOYID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （首要的关键）</font></font></td>
                </tr><tr>
                  <td scope="row"><code class="literal">do</code></td>
                  <td><code class="literal">CUSTNMBR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （首要的关键）</font></font></td>
</tr></tbody></table>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该</font></font><code class="literal">tt.ActualPC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不是均匀分布的。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          最初，在执行任何优化之前，该
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句会生成以下信息：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表类型possible_keys键key_len参考行额外</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et ALL PRIMARY NULL NULL NULL 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
做所有主要的空NULL NULL 2135</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et_1 ALL PRIMARY NULL NULL NULL 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t ALL ALL AssignedPC，NULL NULL NULL 3872</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           客户端ID，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ActualPC的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      范围检查每个记录（索引映射：0x23）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          因为</font></font><code class="literal">type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_all"><code class="literal">ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个表，这个输出表明MySQL正在生成的所有表的笛卡儿积; </font><font style="vertical-align: inherit;">也就是每行的组合。</font><font style="vertical-align: inherit;">这需要相当长的时间，因为必须检查每个表中行数的乘积。</font><font style="vertical-align: inherit;">对于手头的情况，该产品为74×2135×74×3872 = 45,268,558,720行。</font><font style="vertical-align: inherit;">如果桌子更大，你只能想象需要多长时间。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这里的一个问题是，如果MySQL声明为相同的类型和大小，MySQL可以更有效地在列上使用索引。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
           </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被认为是相同的，如果它们被声明为相同的大小。
          </font></font><code class="literal">tt.ActualPC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被声明为
           </font></font><code class="literal">CHAR(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">et.EMPLOYID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          是</font></font><code class="literal">CHAR(15)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以有一个长度不匹配。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以固定柱长度上的不同，使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加长
           </font></font><code class="literal">ActualPC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从10个字符到15个字符：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE tt MODIFY ActualPC VARCHAR(15);</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          现在</font></font><code class="literal">tt.ActualPC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">et.EMPLOYID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都是
           </font></font><code class="literal">VARCHAR(15)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次</font><font style="vertical-align: inherit;">执行该
           </font><font style="vertical-align: inherit;">语句会产生以下结果：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表类型possible_keys键key_len参考行额外</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tt ALL AssignedPC，NULL NULL NULL 3872使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ClientID，其中</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ActualPC的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
做所有主要的空NULL NULL 2135</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个记录检查范围（索引图：0x1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et_1 ALL PRIMARY NULL NULL NULL 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个记录检查范围（索引图：0x1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et eq_ref主要小计15 tt.ActualPC 1</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这并不完美，但要好得多：</font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">的乘积
           </font><font style="vertical-align: inherit;">减少了74倍。该版本在几秒钟内执行。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以进行第二次更改以消除</font></font><code class="literal">tt.AssignedPC =
          et_1.EMPLOYID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">tt.ClientID =
          do.CUSTNMBR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比较</font><font style="vertical-align: inherit;">的列长度不匹配</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE tt MODIFY AssignedPC VARCHAR(15),</code></strong>
                      <strong class="userinput"><code>MODIFY ClientID   VARCHAR(15);</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修改完成后，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成如下所示的输出：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表类型possible_keys键key_len参考行额外</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et ALL PRIMARY NULL NULL NULL 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tt ref AssignedPC，ActualPC 15 et.EMPLOYID 52使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ClientID，其中</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ActualPC的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et_1 eq_ref初级小学15 tt.AssignedPC 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
do eq_ref PRIMARY PRIMARY 15 tt.ClientID 1</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这一点上，查询几乎尽可能地被优化。</font><font style="vertical-align: inherit;">剩下的问题是，默认情况下，MySQL假设</font></font><code class="literal">tt.ActualPC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          列中的</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">是均匀分布的，而</font></font><code class="literal">tt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">则不是这种情况</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">幸运的是，很容易告诉MySQL分析密钥分发：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ANALYZE TABLE tt;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过额外的索引信息，连接是完美的，并
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生这样的结果：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表类型possible_keys键key_len参考行额外</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tt ALL AssignedPC NULL NULL NULL 3872使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ClientID，其中</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ActualPC的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et eq_ref主要小计15 tt.ActualPC 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et_1 eq_ref初级小学15 tt.AssignedPC 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
do eq_ref PRIMARY PRIMARY 15 tt.ClientID 1</font></font><font></font>
</pre><p>
          <a class="indexterm" name="idm140528102509808"></a><font style="vertical-align: inherit;"></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出中</font><font style="vertical-align: inherit;">

          的</font><font style="vertical-align: inherit;">列
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是来自MySQL连接优化器的有根据的猜测。</font><font style="vertical-align: inherit;">通过将</font></font><code class="literal">rows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产品与查询返回的实际行数</font><font style="vertical-align: inherit;">进行比较，检查数字是否接近真相
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果数字非常不同，则可以通过</font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中使用并尝试在</font></font><code class="literal">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">中以不同顺序列出表，来
           </font><font style="vertical-align: inherit;">获得更好的性能
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（但是，
           </font></font><code class="literal">STRAIGHT_JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会阻止使用索引，因为它会禁用半连接转换。请参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;">第8.2.2.1节“</font></a><font style="vertical-align: inherit;">使用半连接转换
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化子查询，派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在某些情况下，可能会执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
          SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与子查询一起使用</font><font style="vertical-align: inherit;">时修改数据的语句</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#derived-tables" title="13.2.10.8派生表（FROM子句中的子查询）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.10.8节“派生表（FROM子句中的子查询）”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="explain-extended"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.3扩展的EXPLAIN输出格式</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，该
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句会生成额外的（</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）信息，这些信息不是</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出的</font><font style="vertical-align: inherit;">一部分，
         </font><font style="vertical-align: inherit;">但可以通过在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        后面</font><font style="vertical-align: inherit;">发布</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">来查看</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">输出中</font><font style="vertical-align: inherit;">的
         </font></font><code class="literal">Message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW
        WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示优化程序如何限定</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
         </font><font style="vertical-align: inherit;">中的表名和列名
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，重写和优化规则的应用程序后的外观，以及可能有关优化过程的其他说明。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        可以通过</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下语句
         </font><font style="vertical-align: inherit;">显示的扩展信息
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅用于
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示其他可解释语句（一个空的结果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在较旧的MySQL版本中，使用扩展信息</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
          EXTENDED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该语法仍被认为是向后兼容的，但扩展输出现在默认启用，所以</font></font><code class="literal">EXTENDED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字是多余的并被弃用。</font><font style="vertical-align: inherit;">它的使用会导致警告，并且它将</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在未来的MySQL版本中</font><font style="vertical-align: inherit;">从</font><font style="vertical-align: inherit;">语法中</font><font style="vertical-align: inherit;">删除</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这是一个扩展</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出</font><font style="vertical-align: inherit;">的例子
         </font><font style="vertical-align: inherit;">：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN</code></strong>
       <strong class="userinput"><code>SELECT t1.a, t1.a IN (SELECT t2.a FROM t2) FROM t1\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：index</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          键：主键</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ID：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SUBQUERY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表格：t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         键入：index</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行数：3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置2行，1警告（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  级别：注意</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息：/ * select＃1 * / select`test`.`t1`.`a` as`a`，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;in_optimizer&gt;（`test`.`t1`.`a``，`test`.``t1`.`a` in</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         （&lt;materialize&gt;（/ *选择＃2 * /选择`test`.`t2`.`a`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         from`test`.`t2` where 1 has 1），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;primary_index_lookup&gt;（`test`.```t1`.`a` in</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;auto_key&gt;上的&lt;临时表&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         where（（'test`.`t1`.`a` =`materialized-subquery`.`a`）））））AS`t1.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         IN（SELECT t2.a FROM t2）`from`test`.`t1`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        由于显示的语句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW
        WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能包含特殊标记以提供有关查询重写或优化程序操作的信息，因此该语句不一定是有效的SQL，并且不打算执行。</font><font style="vertical-align: inherit;">输出还可能包含具有</font></font><code class="literal">Message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值的</font><font style="vertical-align: inherit;">行，
         </font><font style="vertical-align: inherit;">以提供有关优化程序执行的操作的附加非SQL说明性注释。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表描述了可以显示在扩展输出中的特殊标记</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW
        WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">&lt;auto_key&gt;</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个临时表的自动生成的密钥。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;cache&gt;(<em class="replaceable"><code>expr</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            表达式（例如标量子查询）会执行一次，并将结果值保存在内存中供以后使用。</font><font style="vertical-align: inherit;">对于由多个值组成的结果，可能会创建一个临时表，您将看到</font></font><code class="literal">&lt;temporary
            table&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;exists&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            子查询谓词转换为
             </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谓词，并且子查询被转换，以便它可以与</font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谓词</font><font style="vertical-align: inherit;">一起使用
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;in_optimizer&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这是一个没有用户意义的内部优化器对象。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;index_lookup&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用索引查找处理查询片段以查找合格的行。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;if&gt;(<em class="replaceable"><code>condition</code></em>,
            <em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果条件成立，则评估为
             </font></font><em class="replaceable"><code>expr1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否则
             </font></font><em class="replaceable"><code>expr2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;is_not_null_test&gt;(<em class="replaceable"><code>expr</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            验证表达式不评估的测试
             </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;materialize&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用子查询实现。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">`materialized-subquery`.<em class="replaceable"><code>col_name</code></em></code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部临时表中</font><font style="vertical-align: inherit;">的列的引用，具体化为
             </font><font style="vertical-align: inherit;">保留评估子查询的结果。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;primary_index_lookup&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用主键查找处理查询片段以查找合格的行。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;ref_null_helper&gt;(<em class="replaceable"><code>expr</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这是一个没有用户意义的内部优化器对象。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">/* select#<em class="replaceable"><code>N</code></em> */
            <em class="replaceable"><code>select_stmt</code></em></code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行与非扩展</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出中具有</font></font><code class="literal">id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值
             </font><font style="vertical-align: inherit;">的行相关联</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal"><em class="replaceable"><code>outer_tables</code></em> semi join
            (<em class="replaceable"><code>inner_tables</code></em>)</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            半连接操作。
            </font></font><em class="replaceable"><code>inner_tables</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示没有拔出的表格。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">&lt;temporary table&gt;</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这表示为创建缓存中间结果而创建的内部临时表。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当某些表是</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_system"><code class="literal">system</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型时，涉及这些表中的列的表达式由优化器提前评估，而不是显示的语句的一部分。</font><font style="vertical-align: inherit;">但是，</font></font><code class="literal">FORMAT=JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有些
         </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_const"><code class="literal">const</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表访问显示为</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#jointype_ref"><code class="literal">ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用const值</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">访问。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="explain-for-connection"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.4获取命名连接的执行计划信息</font></font></h3>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要获取在命名连接中执行的可解释语句的执行计划，请使用以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN [ </font></font><em class="replaceable"><code>options</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]连接</font></font><em class="replaceable"><code>connection_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre><p>
        <a class="link" href="/mysql-5.7-google-zh/optimization.html#explain-for-connection" title="8.8.4获取命名连接的执行计划信息"><code class="literal">EXPLAIN FOR CONNECTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前用于在给定连接中执行查询</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">信息。</font><font style="vertical-align: inherit;">由于数据（和支持统计）的更改，它可能会产生与运行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等效查询文本</font><font style="vertical-align: inherit;">不同的结果
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这种行为差异可用于诊断更多暂时性能问题。</font><font style="vertical-align: inherit;">例如，如果您在一个需要很长时间才能完成的会话中运行语句，则</font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#explain-for-connection" title="8.8.4获取命名连接的执行计划信息"><code class="literal">EXPLAIN FOR
        CONNECTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在另一个会话中使用可能会产生有关延迟原因的有用信息。
      </font></font></p><p>
        <em class="replaceable"><code>connection_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是从</font></font><code class="literal">INFORMATION_SCHEMA</code>
        <a class="link" href="/mysql-5.7-google-zh/information-schema.html#processlist-table" title="24.17 INFORMATION_SCHEMA PROCESSLIST表"><code class="literal">PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表或者
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">获得的连接标识符
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您有</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_process"><code class="literal">PROCESS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限，则可以为任何连接指定标识符。</font><font style="vertical-align: inherit;">否则，您只能为自己的连接指定标识符。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果指定的连接未执行语句，则结果为空。</font><font style="vertical-align: inherit;">否则，</font></font><code class="literal">EXPLAIN FOR CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        仅适用于在指定连接中执行的语句是可解释的情况。</font><font style="vertical-align: inherit;">这包括
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（但是，
         </font></font><code class="literal">EXPLAIN FOR CONNECTION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于准备好的语句，即使是这些类型的准备语句也不起作用。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果指定的连接正在执行可解释的语句，则输出是您</font></font><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在语句本身上</font><font style="vertical-align: inherit;">使用的
         </font><font style="vertical-align: inherit;">内容。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果指定的连接正在执行不可解释的语句，则会发生错误。</font><font style="vertical-align: inherit;">例如，您不能为当前会话命名连接标识符，因为
         </font></font><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法解释：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT CONNECTION_ID();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CONNECTION_ID（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">373 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN FOR CONNECTION 373;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1889（HY000）：EXPLAIN FOR CONNECTION命令受支持</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仅适用于SELECT / UPDATE / INSERT / DELETE / REPLACE</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">Com_explain_other</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量表示的数
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN FOR
        CONNECTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行的语句。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="estimating-performance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8.5估计查询性能</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528102378032"></a><a class="indexterm" name="idm140528102376576"></a><a class="indexterm" name="idm140528102375088"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在大多数情况下，您可以通过计算磁盘查找来估计查询性能。</font><font style="vertical-align: inherit;">对于小型表格，通常可以在一次磁盘寻道中找到一行（因为索引可能被缓存）。</font><font style="vertical-align: inherit;">对于更大的表格，你可以估计，使用B树索引，你需要这么多的查找来找到一行：
         </font><font style="vertical-align: inherit;">。
      </font></font><code class="literal">log(<em class="replaceable"><code>row_count</code></em>) /
        log(<em class="replaceable"><code>index_block_length</code></em> / 3 * 2 /
        (<em class="replaceable"><code>index_length</code></em> +
        <em class="replaceable"><code>data_pointer_length</code></em>)) + 1</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL中，索引块通常是1024个字节，数据指针通常是4个字节。</font><font style="vertical-align: inherit;">对于密钥长度为三个字节（大小为</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#integer-types" title="11.2.1整型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code class="literal">MEDIUMINT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的500,000行表
         </font><font style="vertical-align: inherit;">，该公式指示
         </font></font><code class="literal">log(500,000)/log(1024/3*2/(3+4)) + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=
         </font></font><code class="literal">4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这个索引需要大约500,000 * 7 * 3/2 = 5.2MB的存储空间（假设一个典型的索引缓冲区填充率为2/3），所以你可能在内存中有很多索引，所以只需要一两个调用读取数据以查找该行。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        然而，对于写操作，需要四个查找请求来查找放置新索引值的位置，通常需要两次查找来更新索引并写入行。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        上述讨论并不意味着您的应用程序性能会通过日志缓慢退化
         </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">只要所有东西都被操作系统或MySQL服务器缓存，随着表变大，事情变得稍微慢一些。</font><font style="vertical-align: inherit;">数据变得太大而无法缓存后，事情开始变得缓慢，直到您的应用程序仅受磁盘查找（日志增加</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">约束
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为避免这种情况，请在数据增长时增加密钥缓存大小。</font><font style="vertical-align: inherit;">对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表，键缓存大小由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">控制
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-configuration" title="5.1.1配置服务器"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="controlling-optimizer"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9控制查询优化器</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#controlling-query-plan-evaluation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.1控制查询计划评估</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizer-hints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.2优化器提示</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.3可切换优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-hints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.4索引提示</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#cost-model"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.5优化器成本模型</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528102359952"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL通过影响查询计划如何评估，可切换优化，优化器和索引提示以及优化器成本模型的系统变量提供优化器控制。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="controlling-query-plan-evaluation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.1控制查询计划评估</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528102356688"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询优化器的任务是查找执行SQL查询的最佳计划。</font><font style="vertical-align: inherit;">由于</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><span class="quote"><font style="vertical-align: inherit;">“ </font></span><span class="quote"><span class="quote"><font style="vertical-align: inherit;">坏</font></span></span><span class="quote"><font style="vertical-align: inherit;"> ”</font></span><font style="vertical-align: inherit;">之间的表现差异</font></font><span class="quote"><font style="vertical-align: inherit;"></font><span class="quote"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划可以是数量级（即秒数与数小时甚至数天），大多数查询优化器（包括MySQL的查询优化器）在所有可能的查询评估计划中执行或多或少的穷举搜索优化计划。</font><font style="vertical-align: inherit;">对于连接查询，由MySQL优化器调查的可能计划的数量随着查询中引用的表的数量呈指数增长。</font><font style="vertical-align: inherit;">对于少量表格（通常小于7到10），这不是问题。</font><font style="vertical-align: inherit;">但是，当提交更大的查询时，查询优化花费的时间可能很容易成为服务器性能的主要瓶颈。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        用于查询优化的更灵活的方法使用户能够控制优化器在搜索最优查询评估计划时的详尽程度。</font><font style="vertical-align: inherit;">总体思路是，优化程序调查的计划越少，编译查询花费的时间就越少。</font><font style="vertical-align: inherit;">另一方面，因为优化器跳过了一些计划，所以可能会错过找到最佳计划。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化程序相对于其计算的计划数量的行为可以使用两个系统变量进行控制：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_prune_level"><code class="literal">optimizer_prune_level</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            变量告诉优化器根据每个表访问的行数的估计值跳过某些计划。</font><font style="vertical-align: inherit;">我们的经验表明，这种</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受过教育的猜测</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很少会错过最佳计划，并且可能大大减少查询编译时间。</font><font style="vertical-align: inherit;">这就是为什么这个选项</font></font><code class="literal">optimizer_prune_level=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font><font style="vertical-align: inherit;">是on（</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">但是，如果您认为优化器错过了更好的查询计划，则可以关闭此选项（</font></font><code class="literal">optimizer_prune_level=0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）与查询编译可能花费更长时间的风险有关。</font><font style="vertical-align: inherit;">请注意，即使使用这种启发式，优化器仍然会探索大致指数级的计划。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            变量告诉</font><font style="vertical-align: inherit;">优化器应该看看每个不完整计划</font><font style="vertical-align: inherit;">的</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未来</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font><font style="vertical-align: inherit;">多远，</font><font style="vertical-align: inherit;">以评估它是否应该进一步扩展。</font><font style="vertical-align: inherit;">较小的值
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会导致查询编译时间缩短几个数量级。</font><font style="vertical-align: inherit;">例如，如果</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接近查询中的表的数量，</font><font style="vertical-align: inherit;">具有12,13或更多表的查询可能很容易需要数小时甚至数天来编译
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同时，如果编译一下
            </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            等于3或4，优化器可以在不到一分钟的时间内编译相同的查询。</font><font style="vertical-align: inherit;">如果您不确定合理的值是什么
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则可以将此变量设置为0，以通知优化器自动确定该值。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizer-hints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.2优化器提示</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528102336320"></a><a class="indexterm" name="idm140528102335248"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        控制优化器策略的一种方法是设置
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量（参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#switchable-optimizations" title="8.9.3可切换优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.3节“可切换优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">对此变量的更改影响所有后续查询的执行; </font><font style="vertical-align: inherit;">为了对另一个查询产生不同的影响，有必要</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个</font><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">进行更改
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        另一种控制优化器的方法是使用优化器提示，它可以在单个语句中指定。</font><font style="vertical-align: inherit;">由于优化器提示适用于每个语句的基础上，因此它们提供了对语句执行计划的更好的控制，而不是使用的方式
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，您可以在语句中为一个表启用优化，并禁用针对其他表的优化。</font><font style="vertical-align: inherit;">语句中的提示优先于
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        例子：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + NO_RANGE_OPTIMIZATION（t3 PRIMARY，f2_idx）* / f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM t3 where f1&gt; 30 AND f1 &lt;33;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + BKA（t1）NO_BKA（t2）* / *从t1 INNER JOIN t2 WHERE ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + NO_ICP（t1，t2）* / * FROM t1 INNER JOIN t2 WHERE ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + SEMIJOIN（FIRSTMATCH，LOOSESCAN）* / * FROM t1 ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EXPLAIN SELECT / * + NO_ICP（t1）* / * FROM t1 WHERE ...;</font></font><font></font>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下</font><font style="vertical-align: inherit;">
          ，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端从发送到服务器的SQL语句（包括优化器提示）中删除注释，直到MySQL 5.7.7更改为将优化器提示传递给服务器。</font><font style="vertical-align: inherit;">为了确保如果您使用旧版本的</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端与理解优化器提示的服务器版本</font><font style="vertical-align: inherit;">，优化器提示不会被剥离，请使用
           </font><font style="vertical-align: inherit;">该
           </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">调用
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#option_mysql_comments"><code class="option">--comments</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        此处介绍的优化器提示与</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-hints" title="8.9.4索引提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.4节“索引提示”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍的索引提示有所不同</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化器和索引提示可以单独使用或一起使用。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-overview" title="优化器提示概述"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化器提示概述</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-syntax" title="优化器提示语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化器提示语法</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-table-level" title="表级优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表级优化器提示</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引级优化器提示</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询优化器提示</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-execution-time" title="语句执行时间优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句执行时间优化器提示</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于命名查询块的优化器提示</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="optimizer-hints-overview"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化器提示概述</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器提示适用于不同的范围级别：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              全局：提示影响整个陈述
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              查询块：提示影响语句中的特定查询块
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表级别：提示影响查询块中的特定表
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              索引级别：提示影响表格中的特定索引
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          下表总结了可用的优化器提示，它们影响的优化器策略以及它们所应用的范围。</font><font style="vertical-align: inherit;">更多细节在后面给出。
</font></font></p>
<div class="table">
<a name="optimizer-hints-table"></a><p class="title"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表8.2可用的优化器提示</font></font></b></p>
<div class="table-contents">
<table summary="Optimizer hint names, descriptions, and contexts in which they apply."><colgroup><col width="30%"><col width="40%"><col width="30%"></colgroup><thead><tr>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示名称</font></font></th>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
              <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用范围</font></font></th>
            </tr></thead><tbody><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">BKA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_BKA</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响批量键访问连接处理</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询块，表</font></font></td>
            </tr><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">BNL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_BNL</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响块嵌套循环连接处理</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询块，表</font></font></td>
            </tr><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-execution-time" title="语句执行时间优化器提示"><code class="literal">MAX_EXECUTION_TIME</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制语句执行时间</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球</font></font></td>
            </tr><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">MRR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_MRR</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响多范围读取优化</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，索引</font></font></td>
            </tr><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_ICP</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响索引条件下推优化</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，索引</font></font></td>
            </tr><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_RANGE_OPTIMIZATION</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响范围优化</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，索引</font></font></td>
            </tr><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><code class="literal">QB_NAME</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将名称分配给查询块</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询块</font></font></td>
            </tr><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">SEMIJOIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">NO_SEMIJOIN</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响半连接策略</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询块</font></font></td>
            </tr><tr>
              <td align="left" scope="row"><a class="link" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">SUBQUERY</code></a></td>
              <td align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影响物化，
                 </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至- </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                子查询配置的对策探讨</font></font></td>
              <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询块</font></font></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          禁用优化可防止优化器使用它。</font><font style="vertical-align: inherit;">启用优化意味着如果优化程序适用于语句执行，则可以自由使用策略，而不是优化程序必须使用它。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="optimizer-hints-syntax"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化器提示语法</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如</font></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#comments" title="9.6注释语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.6节“注释语法”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述，MySQL支持SQL语句中的
           </font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#comments" title="9.6注释语法"><font style="vertical-align: inherit;">注释</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化器提示必须在</font></font><code class="literal">/*+ ... */</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，优化器提示使用</font></font><code class="literal">/* ... */</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          C样式注释语法</font><font style="vertical-align: inherit;">的变体</font><font style="vertical-align: inherit;">，并</font></font><code class="literal">+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="literal">/*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释打开序列</font><font style="vertical-align: inherit;">后面</font><font style="vertical-align: inherit;">加上一个</font><font style="vertical-align: inherit;">字符</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例子：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + BKA（t1）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ * + BNL（t1，t2）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ * + NO_RANGE_OPTIMIZATION（t4 PRIMARY）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ * + QB_NAME（qb2）* /</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><code class="literal">+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          字符</font><font style="vertical-align: inherit;">后面允许使用空格</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分析器的初始关键字后承认优化提示意见</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#replace" title="13.2.8 REPLACE语法"><code class="literal">REPLACE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">在这些情况下允许提示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在查询和数据更改语句的开始处：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REPLACE / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
删除/ * + ... * / ...</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在查询块的开始处：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SELECT / * + ... * / ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（SELECT ...）UNION（SELECT / * + ... * / ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（SELECT / * + ... * / ...）UNION（SELECT / * + ... * / ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE ... WHERE x IN（SELECT / * + ... * / ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT ... SELECT / * + ... * / ...</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在由...开头的暗示性陈述中
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN SELECT / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EXPLAIN UPDATE ... WHERE x IN（SELECT / * + ... * / ...）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              这意味着您可以使用它
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来查看优化器提示如何影响执行计划。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之后立即</font><font style="vertical-align: inherit;">使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，看看如何使用提示。</font></font><code class="literal">EXPLAIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              以下</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-warnings" title="13.7.5.40 SHOW WARNINGS语法"><code class="literal">SHOW
              WARNINGS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示</font><font style="vertical-align: inherit;">的扩展</font><font style="vertical-align: inherit;">输出</font><font style="vertical-align: inherit;">指示使用了哪些提示。</font><font style="vertical-align: inherit;">不显示忽略的提示。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提示注释可能包含多个提示，但查询块不能包含多个提示注释。</font><font style="vertical-align: inherit;">这是有效的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BNL（t1）BKA（t2）* / ...
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          但这是无效的：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BNL（t1）* / / * BKA（t2）* / ...
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当提示注释包含多个提示时，存在重复和冲突的可能性。</font><font style="vertical-align: inherit;">以下一般准则适用。</font><font style="vertical-align: inherit;">对于特定的提示类型，可能会应用其他规则，如提示说明中所述。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              重复提示：对于一个提示，如</font></font><code class="literal">/*+ MRR(idx1)
              MRR(idx1) */</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL使用第一个提示并发出关于重复提示的警告。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              冲突提示：对于一个提示，如</font></font><code class="literal">/*+
              MRR(idx1) NO_MRR(idx1) */</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL使用第一个提示并发出关于第二个冲突提示的警告。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询块名称是标识符，并遵循关于哪些名称有效以及如何引用它们的通用规则（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#identifiers" title="9.2模式对象名称"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2节“模式对象名称”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提示名称，查询块名称和策略名称不区分大小写。</font><font style="vertical-align: inherit;">对表和索引名称的引用遵循通常的标识符区分大小写规则（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#identifier-case-sensitivity" title="9.2.2标识符大小写敏感性"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2.2节“标识符区分大小写”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="optimizer-hints-table-level"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表级优化器提示</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表级提示影响使用块嵌套循环（BNL）和批处理键访问（BKA）连接处理算法（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bnl-bka-optimization" title="8.2.1.11块嵌套循环和批处理键访问联接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.11节“块嵌套循环和批处理键访问连接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这些提示类型适用于特定表或查询块中的所有表。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表级提示的语法：
        </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [ </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
 </font></font><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[ </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语法引用了这些术语：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这些提示名称是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">BKA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">NO_BKA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：为指定的表启用或禁用BKA。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">BNL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">NO_BNL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：启用或禁用指定表的BNL。
</font></font></p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要使用BNL或BKA提示为外连接的任何内部表启用连接缓冲，必须为外连接的所有内部表启用连接缓冲。
</font></font></p>
</div>
</li><li class="listitem"><p>
              <em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：声明中使用的表的名称。</font><font style="vertical-align: inherit;">该提示适用于它命名的所有表。</font><font style="vertical-align: inherit;">如果提示不命名表，它将应用于它出现的查询块的所有表。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果表有别名，提示必须引用别名，而不是表名。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              提示中的表名称不能用模式名称限定。
            </font></font></p></li><li class="listitem"><p>
              <em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：提示适用的查询块。</font><font style="vertical-align: inherit;">如果提示不包含前导
               </font><font style="vertical-align: inherit;">，则该提示将应用于其发生的查询块。</font><font style="vertical-align: inherit;">对于
               </font><font style="vertical-align: inherit;">
              语法，该提示适用于指定查询块中的指定表。</font><font style="vertical-align: inherit;">要为查询块分配名称，请参阅
               </font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><font style="vertical-align: inherit;">命名查询块的优化器提示</font></a><font style="vertical-align: inherit;">。
</font></font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>tbl_name</code></em>@<em class="replaceable"><code>query_block_name</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例子：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + NO_BKA（t1，t2）* / t1。* FROM t1 INNER JOIN t2 INNER JOIN t3;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + NO_BNL（）BKA（t1）* / t1。* FROM t1 INNER JOIN t2 INNER JOIN t3;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表级提示适用于从前面的表中接收记录的表，而不是发送者表。</font><font style="vertical-align: inherit;">考虑这个说法：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BNL（t2）* / FROM t1，t2;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果优化器选择</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          首先</font><font style="vertical-align: inherit;">进行处理</font><font style="vertical-align: inherit;">，则会</font><font style="vertical-align: inherit;">在开始读取之前
           </font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过缓冲行来
           </font><font style="vertical-align: inherit;">应用块嵌套循环连接
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果优化器选择首先处理</font><font style="vertical-align: inherit;">，则提示不起作用，因为</font><font style="vertical-align: inherit;">是发送者表。
</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"></font><code class="literal">t2</code><font style="vertical-align: inherit;"></font><code class="literal">t2</code><font style="vertical-align: inherit;"></font><code class="literal">t2</code><font style="vertical-align: inherit;"></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="optimizer-hints-index-level"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引级优化器提示</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引级提示会影响优化程序对特定表或索引使用的索引处理策略。</font><font style="vertical-align: inherit;">这些提示类型影响使用索引条件下推（ICP），多范围读取（MRR）和范围优化（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#select-optimization" title="8.2.1优化SELECT语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1节“优化SELECT语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引级提示的语法：
        </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
 </font></font><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语法引用了这些术语：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这些提示名称是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">MRR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">NO_MRR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：启用或禁用指定表或索引的MRR。</font><font style="vertical-align: inherit;">MRR提示仅适用于
                   </font><font style="vertical-align: inherit;">表格</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
                   </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">NO_ICP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：为指定的表或索引禁用ICP。</font><font style="vertical-align: inherit;">默认情况下，ICP是一个候选优化策略，所以没有启用它的提示。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">NO_RANGE_OPTIMIZATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：禁用指定表或索引的索引范围访问。</font><font style="vertical-align: inherit;">此提示还会禁用索引合并和索引扫描以查找表或索引。</font><font style="vertical-align: inherit;">默认情况下，范围访问是一个候选优化策略，所以没有启用它的提示。
                </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  当范围数可能很高并且范围优化需要许多资源时，这个提示可能是有用的。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p>
              <em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：提示适用的表格
            </font></font></p></li><li class="listitem"><p>
              <em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：指定表中索引的名称。</font><font style="vertical-align: inherit;">该提示适用于它命名的所有索引。</font><font style="vertical-align: inherit;">如果提示不命名索引，则它适用于表中的所有索引。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要引用主键，请使用该名称
               </font></font><code class="literal">PRIMARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要查看表格的索引名称，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-index" title="13.7.5.22 SHOW INDEX语法"><code class="literal">SHOW INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：提示适用的查询块。</font><font style="vertical-align: inherit;">如果提示不包含前导
               </font><font style="vertical-align: inherit;">，则该提示将应用于其发生的查询块。</font><font style="vertical-align: inherit;">对于
               </font><font style="vertical-align: inherit;">
              语法，该提示适用于指定查询块中的指定表。</font><font style="vertical-align: inherit;">要为查询块分配名称，请参阅
               </font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><font style="vertical-align: inherit;">命名查询块的优化器提示</font></a><font style="vertical-align: inherit;">。
</font></font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>tbl_name</code></em>@<em class="replaceable"><code>query_block_name</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例子：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + MRR（t1）* / * FROM t1 WHERE f2 &lt;= 3 AND 3 &lt;= f3;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + NO_RANGE_OPTIMIZATION（t3 PRIMARY，f2_idx）* / f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM t3 where f1&gt; 30 AND f1 &lt;33;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t3（f1，f2，f3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （SELECT / * + NO_ICP（t2）* / t2.f1，t2.f2，t2.f3 FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   WHERE t1.f1 = t2.f1 AND t2.f2 BETWEEN t1.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   AND t1.f2 AND t2.f2 + 1&gt; = t1.f1 + 1）;</font></font><font></font>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="optimizer-hints-subquery"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询优化器提示</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          子查询提示影响是否使用半连接的转换和半连接策略允许，而当半联接未使用，是否使用子查询物化或
           </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至- </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          变换。</font><font style="vertical-align: inherit;">有关这些优化的更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#subquery-optimization" title="8.2.2优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2节“优化子查询，派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          影响半连接策略的提示语法：
        </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [ </font></font><em class="replaceable"><code>strategy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>strategy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语法引用了这些术语：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：这些提示名称是允许的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">SEMIJOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                   </font></font><code class="literal">NO_SEMIJOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：启用或禁用指定的半连接策略。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p>
              <em class="replaceable"><code>strategy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：启用或禁用半连接策略。</font><font style="vertical-align: inherit;">这些策略名允许：</font></font><code class="literal">DUPSWEEDOUT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">FIRSTMATCH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">LOOSESCAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">MATERIALIZATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">SEMIJOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示，如果未命名策略，则根据</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">启用的策略，尽可能使用半连接
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果战略被命名但不适用于该声明，</font></font><code class="literal">DUPSWEEDOUT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则会被使用。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">NO_SEMIJOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示，如果没有策略被命名，则不使用半连接。</font><font style="vertical-align: inherit;">如果策略被命名为排除声明的所有适用策略，</font></font><code class="literal">DUPSWEEDOUT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则使用</font><font style="vertical-align: inherit;">该策略
               </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果一个子查询嵌套在另一个子查询中，并且两者都合并到外部查询的半连接中，则最内层查询的任何半连接策略规范都将被忽略。
          </font></font><code class="literal">SEMIJOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="literal">NO_SEMIJOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          仍然可以使用提示来启用或禁用此类嵌套子查询的半连接转换。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">DUPSWEEDOUT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被禁用，则有时优化器可能会生成一个远离最佳状态的查询计划。</font><font style="vertical-align: inherit;">这发生在贪婪搜索期间的启发式修剪，可以通过设置来避免
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_prune_level"><code class="literal">optimizer_prune_level=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例子：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + NO_SEMIJOIN（@ subq1 FIRSTMATCH，LOOSESCAN）* / *从t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE t2.a IN（SELECT / * + QB_NAME（subq1）* / a FROM t3）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + SEMIJOIN（@ subq1 MATERIALIZATION，DUPSWEEDOUT）* / *从t2开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE t2.a IN（SELECT / * + QB_NAME（subq1）* / a FROM t3）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          影响是否使用子查询实现或</font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-to- </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          转换</font><font style="vertical-align: inherit;">的提示语法
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUBQUERY（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><em class="replaceable"><code>strategy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          提示名称总是</font></font><code class="literal">SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于</font></font><code class="literal">SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示，这些
           </font></font><em class="replaceable"><code>strategy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是允许的：
           </font></font><code class="literal">INTOEXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">MATERIALIZATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例子：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT id，IN（SELECT / * + SUBQUERY（MATERIALIZATION）* / a FROM t1）FROM t2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t2 WHERE t2.a IN（SELECT / * + SUBQUERY（INTOEXISTS）* / a FROM t1）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于半连接和</font></font><code class="literal">SUBQUERY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示，前导
           </font><font style="vertical-align: inherit;">
          指定提示适用的查询块。</font><font style="vertical-align: inherit;">如果提示不包含前导
           </font><font style="vertical-align: inherit;">，则该提示将应用于其发生的查询块。</font><font style="vertical-align: inherit;">要为查询块分配名称，请参阅
           </font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><font style="vertical-align: inherit;">命名查询块的优化器提示</font></a><font style="vertical-align: inherit;">。
        </font></font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code><font style="vertical-align: inherit;"></font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果提示注释包含多个子查询提示，则使用第一个。</font><font style="vertical-align: inherit;">如果还有其他类型的提示，则会发出警告。</font><font style="vertical-align: inherit;">其他类型的提示被默默忽略。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="optimizer-hints-execution-time"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句执行时间优化器提示</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">MAX_EXECUTION_TIME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示仅适用于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">它</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在语句允许在服务器终止之前执行多长时间内</font><font style="vertical-align: inherit;">放置一个限制</font><font style="vertical-align: inherit;">（以毫秒为单位的超时值）：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_EXECUTION_TIME（</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          超时时间为1秒（1000毫秒）的示例：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + MAX_EXECUTION_TIME（1000）* / *从t1 INNER JOIN t2 WHERE ...
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该
           </font><font style="vertical-align: inherit;">
          提示设置了</font><font style="vertical-align: inherit;">毫秒</font><font style="vertical-align: inherit;">的语句执行超时
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此选项不存在或</font><font style="vertical-align: inherit;">为0，则由</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">建立的语句超时
           </font><font style="vertical-align: inherit;">适用。
        </font></font><code class="literal">MAX_EXECUTION_TIME(<em class="replaceable"><code>N</code></em>)</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_execution_time"><code class="literal">max_execution_time</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">MAX_EXECUTION_TIME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示适用如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于具有多个</font></font><code class="literal">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              关键字的</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">（例如具有子查询的联合或语句）
               </font></font><code class="literal">MAX_EXECUTION_TIME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于整个语句，并且必须出现在第一个语句之后
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它适用于只读
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">不是只读的语句是那些调用一个存储函数，将数据修改为副作用的语句。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它不适用于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              存储程序中的语句，并且被忽略。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="optimizer-hints-query-block-naming"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于命名查询块的优化器提示</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表级别，索引级别和子查询优化器提示允许将特定查询块命名为其参数语法的一部分。</font><font style="vertical-align: inherit;">要创建这些名称，请使用
           </font></font><code class="literal">QB_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示，它为其发生的查询块分配一个名称：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QB_NAME（</font></font><em class="replaceable"><code>name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre><p>
          <code class="literal">QB_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示可以用来清楚地明确哪些查询块适用于其他提示。</font><font style="vertical-align: inherit;">它们还允许在单个提示注释中指定所有非查询块名称提示，以便于理解复杂语句。</font><font style="vertical-align: inherit;">考虑以下声明：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT ... FROM ...））...</font></font><font></font>
</pre><p>
          <code class="literal">QB_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 提示为语句中的查询块分配名称：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + QB_NAME（qb1）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（qb2）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（qb3）* / ... FROM ...））...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          然后其他提示可以使用这些名称来引用适当的查询块：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + QB_NAME（qb1）MRR（@ qb1 t1）BKA（@ qb2）NO_MRR（@ qb3t1 idx1，id2）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（qb2）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（qb3）* / ... FROM ...））...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          其结果如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">MRR(@qb1 t1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于查询块中的
               </font><font style="vertical-align: inherit;">表格
               </font></font><code class="literal">qb1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">BKA(@qb2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于查询块
               </font></font><code class="literal">qb2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">NO_MRR(@qb3 t1 idx1, id2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于索引</font></font><code class="literal">idx1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font><font style="vertical-align: inherit;">查询块</font></font><code class="literal">idx2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的表格</font><font style="vertical-align: inherit;">。
</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"></font><code class="literal">qb3</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询块名称是标识符，并遵循关于哪些名称有效以及如何引用它们的通用规则（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/language-structure.html#identifiers" title="9.2模式对象名称"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2节“模式对象名称”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如，包含空格的查询块名称必须用引号引起来，这可以使用反引号来完成：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BKA（@`my hint name`）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（`my hint name`）* / ...）...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sqlmode_ansi_quotes"><code class="literal">ANSI_QUOTES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">SQL模式，则也可以在双引号内引用查询块名称：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BKA（@“my hint name”）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（“my hint name”）* / ...）...</font></font><font></font>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="switchable-optimizations"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.3可切换优化</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528102056544"></a><a class="indexterm" name="idm140528102055456"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量能够在优化行为的控制。</font><font style="vertical-align: inherit;">它的值是一组标志，每个标志都有一个值</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        或</font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示相应的优化器行为是启用还是禁用。</font><font style="vertical-align: inherit;">该变量具有全局和会话值，并且可以在运行时更改。</font><font style="vertical-align: inherit;">全局默认值可以在服务器启动时设置。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要查看当前的优化器标志集，请选择变量值：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@@ optimizer_switch：index_merge = on，index_merge_union = on，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_sort_union =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_intersection =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    engine_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    MRR =开，上mrr_cost_based =，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    block_nested_loop =开，batched_key_access =关，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    物化=开，半连接=上，loosescan =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    firstmatch =开，duplicateweedout =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    subquery_materialization_cost_based =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    use_index_extensions =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    condition_fanout_filter =开，derived_merge =上</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要更改值
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请分配一个由逗号分隔的一个或多个命令列表组成的值：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET [GLOBAL | SESSION] optimizer_switch =' </font></font><em class="replaceable"><code>command</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>command</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个</font></font><em class="replaceable"><code>command</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值应具有下表中显示的一种形式。
</font></font></p>
<div class="informaltable">
<table summary="The syntax of the command value for SET optimizer_switch commands."><colgroup><col width="25%"><col width="75%"></colgroup><thead><tr>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令语法</font></font></th>
            <th scope="col"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含义</font></font></th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">default</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将每个优化重置为默认值</font></font></td>
          </tr><tr>
            <td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=default</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将指定的优化设置为其默认值</font></font></td>
          </tr><tr>
            <td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=off</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用命名优化</font></font></td>
          </tr><tr>
            <td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=on</code></td>
            <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用指定的优化</font></font></td>
</tr></tbody></table>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该值中的命令顺序无关紧要，但该</font></font><code class="literal">default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令如果存在则首先执行。</font><font style="vertical-align: inherit;">一个设置</font></font><em class="replaceable"><code>opt_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志
         </font></font><code class="literal">default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置它取的
         </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是它的默认值。</font></font><em class="replaceable"><code>opt_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        不允许多次</font><font style="vertical-align: inherit;">指定给定</font><font style="vertical-align: inherit;">的值并导致错误。</font><font style="vertical-align: inherit;">值中的任何错误都会导致分配失败，并显示错误，并使值
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保持不变。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表描述了</font></font><em class="replaceable"><code>opt_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按优化策略分组</font><font style="vertical-align: inherit;">的允许
         </font><font style="vertical-align: inherit;">标志名称：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            批量键访问标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">batched_key_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制BKA连接算法的使用。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了</font></font><code class="literal">batched_key_access</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在设置时有任何效果</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该
             </font></font><code class="literal">mrr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志也必须是
             </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">目前，MRR的成本估算过于悲观。</font><font style="vertical-align: inherit;">因此，也有必要对
             </font></font><code class="literal">mrr_cost_based</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要
             </font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于要使用的BKA。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bnl-bka-optimization" title="8.2.1.11块嵌套循环和批处理键访问联接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.11节“块嵌套循环和批处理键访问联接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            块嵌套循环标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">block_nested_loop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制使用BNL连接算法。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#bnl-bka-optimization" title="8.2.1.11块嵌套循环和批处理键访问联接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.11节“块嵌套循环和批处理键访问联接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            条件过滤标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">condition_fanout_filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制条件过滤的使用。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            派生表合并标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">derived_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制派生表和视图到外部查询块的合并。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">derived_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志控制优化程序是否尝试合并派生表并将引用视为外部查询块，假设没有其他规则会阻止合并; </font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">ALGORITHM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图</font><font style="vertical-align: inherit;">的
             </font><font style="vertical-align: inherit;">指令优先于该</font></font><code class="literal">derived_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            设置。</font><font style="vertical-align: inherit;">默认情况下，该标志</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于启用合并。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#derived-table-optimization" title="8.2.2.3优化派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.3节“优化派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            引擎状况下推标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">engine_condition_pushdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制发动机状况下推。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#condition-pushdown-optimization" title="8.2.1.4引擎状况下推优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.4节“引擎状况下推优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            索引条件下推标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">index_condition_pushdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制索引条件下推。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-condition-pushdown-optimization" title="8.2.1.5索引条件下推优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.5节“索引条件下推优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            索引扩展标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">use_index_extensions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制索引扩展的使用。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-extensions" title="8.3.9使用索引扩展"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.3.9节“使用索引扩展”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            索引合并标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">index_merge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制所有索引合并优化。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">index_merge_intersection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制索引合并相交访问优化。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">index_merge_sort_union</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制索引合并排序 - 联合访问优化。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">index_merge_union</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制索引合并联盟访问优化。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            多范围读取标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">mrr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制多范围读取策略。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">mrr_cost_based</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制使用基于成本的MRR
                 </font></font><code class="literal">mrr=on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#mrr-optimization" title="8.2.1.10多范围读取优化"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.1.10节“多范围读取优化”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            半连接标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">semijoin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制所有半连接策略。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">duplicateweedout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制半联合Duplicate Weedout策略。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">firstmatch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制半连接的FirstMatch策略。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">loosescan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制半连接LooseScan策略（不要与LooseScan混淆</font></font><code class="literal">GROUP
                BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在</font></font><code class="literal">semijoin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><code class="literal">firstmatch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">loosescan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="literal">duplicateweedout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超过半连接策略的标志使能控制。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">semijoin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            标志控制是否使用半连接。</font><font style="vertical-align: inherit;">如果它被设置为
             </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在</font></font><code class="literal">firstmatch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">loosescan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志启用了允许半连接策略更精细的控制。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><code class="literal">duplicateweedout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用半连接策略，则不会使用半连接策略，除非所有其他适用的策略也被禁用。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果</font></font><code class="literal">semijoin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">materialization</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是两个
             </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，半连接也适用使用物化。</font><font style="vertical-align: inherit;">这些标志是</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认的。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#semi-joins" title="8.2.2.1使用半连接变换优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            子查询物化标志
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">materialization</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认
                 </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                控制实现（包括半连接实现）。
              </font></font></p></li><li class="listitem"><p>
                <code class="literal">subquery_materialization_cost_based</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                （默认</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用基于成本的物化选择。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">materialization</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志控制是否使用子查询实现。</font><font style="vertical-align: inherit;">如果
             </font></font><code class="literal">semijoin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">materialization</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是两个
             </font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，半连接也适用使用物化。</font><font style="vertical-align: inherit;">这些标志是</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认的。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><code class="literal">subquery_materialization_cost_based</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            标志使得能够在子查询物化和之间的选择控制
             </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-到- </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询变换。</font><font style="vertical-align: inherit;">如果该标志为</font></font><code class="literal">on</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认值），优化器进行子查询物化和之间的基于成本的选择
             </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-到- </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询变换如果可以使用任一方法。</font><font style="vertical-align: inherit;">如果标志是</font></font><code class="literal">off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，优化器选择了子查询物化
             </font></font><code class="literal">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至- </font></font><code class="literal">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询的转变。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关更多信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#subquery-optimization" title="8.2.2优化子查询，派生表和视图引用"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2.2节“优化子查询，派生表和视图引用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当您为其赋值时
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，未提及的标志会保留其当前值。</font><font style="vertical-align: inherit;">这样可以在单个语句中启用或禁用特定的优化器行为，而不会影响其他行为。</font><font style="vertical-align: inherit;">该语句不依赖于其他优化器标志存在以及它们的值是什么。</font><font style="vertical-align: inherit;">假设启用了所有索引合并优化：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@@ optimizer_switch：index_merge = on，index_merge_union = on，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_sort_union =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_intersection =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    engine_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    MRR =开，上mrr_cost_based =，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    block_nested_loop =开，batched_key_access =关，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    物化=开，半连接=上，loosescan =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    firstmatch =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    subquery_materialization_cost_based =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    use_index_extensions =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    condition_fanout_filter =上</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果服务器对某些查询使用索引合并联合或索引合并排序联合访问方法，并且您希望检查优化程序在没有它们的情况下是否会更好地执行，请设置变量值，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET optimizer_switch='index_merge_union=off,index_merge_sort_union=off';</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@@ optimizer_switch：index_merge = on，index_merge_union = off，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_sort_union =关，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_intersection =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    engine_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    MRR =开，上mrr_cost_based =，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    block_nested_loop =开，batched_key_access =关，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    物化=开，半连接=上，loosescan =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    firstmatch =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    subquery_materialization_cost_based =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    use_index_extensions =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    condition_fanout_filter =上</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="index-hints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.4索引提示</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528101900832"></a><a class="indexterm" name="idm140528101899760"></a><a class="indexterm" name="idm140528101898272"></a><a class="indexterm" name="idm140528101897200"></a><a class="indexterm" name="idm140528101896128"></a><a class="indexterm" name="idm140528101895056"></a><a class="indexterm" name="idm140528101893984"></a><a class="indexterm" name="idm140528101892912"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        索引提示为优化程序提供有关如何在查询处理期间选择索引的信息。</font><font style="vertical-align: inherit;">这里描述的索引提示与</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints" title="8.9.2优化器提示"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.9.2节“优化器提示”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的
         </font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizer-hints" title="8.9.2优化器提示"><font style="vertical-align: inherit;">优化器提示不同</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">索引和优化器提示可以单独使用或一起使用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        索引提示是按照表名指定的。</font><font style="vertical-align: inherit;">（有关在语句中指定表的一般语法
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#join" title="13.2.9.2 JOIN语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.9.2节“JOIN语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）引用单个表（包括索引提示）的语法如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[[AS] </font></font><em class="replaceable"><code>alias</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [ </font></font><em class="replaceable"><code>index_hint_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font><font></font>
<font></font>
<em class="replaceable"><code>index_hint_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>index_hint</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><em class="replaceable"><code>index_hint</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...</font></font><font></font>
<font></font>
<em class="replaceable"><code>index_hint</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    USE {INDEX | KEY}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      [FOR {JOIN | ORDER BY | GROUP BY}]（[ </font></font><em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  | </font><font style="vertical-align: inherit;">IGNORE {INDEX | KEY}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      [FOR {JOIN | ORDER BY | GROUP BY}]（</font></font><em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  | </font><font style="vertical-align: inherit;">FORCE {INDEX | KEY}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      [FOR {JOIN | ORDER BY | GROUP BY}]（</font></font><em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font>
<font></font>
<em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font><font style="vertical-align: inherit;">提示告诉MySQL只使用其中一个命名索引来查找表中的行。</font><font style="vertical-align: inherit;">另一种语法</font><font style="vertical-align: inherit;">告诉MySQL不要使用某些特定的索引或索引。</font><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">显示MySQL使用可能索引列表中的错误索引，</font><font style="vertical-align: inherit;">这些提示很有</font><font style="vertical-align: inherit;">用。
      </font></font><code class="literal">USE INDEX
        (<em class="replaceable"><code>index_list</code></em>)</code><font style="vertical-align: inherit;"></font><code class="literal">IGNORE INDEX
        (<em class="replaceable"><code>index_list</code></em>)</code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这个</font></font><code class="literal">FORCE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示的作用就像</font><font style="vertical-align: inherit;">，另外一个表扫描被认为是
         </font><span class="emphasis"><em><font style="vertical-align: inherit;">非常</font></em></span><font style="vertical-align: inherit;">昂贵的。</font><font style="vertical-align: inherit;">换句话说，只有在无法使用其中一个指定索引来查找表中的行时才使用表扫描。
      </font></font><code class="literal">USE
        INDEX (<em class="replaceable"><code>index_list</code></em>)</code><font style="vertical-align: inherit;"></font><span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        每个提示都需要索引名称，而不是列名。</font><font style="vertical-align: inherit;">要引用主键，请使用该名称</font></font><code class="literal">PRIMARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要查看表的索引名称，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-index" title="13.7.5.22 SHOW INDEX语法"><code class="literal">SHOW
        INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或
         </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#statistics-table" title="24.23 INFORMATION_SCHEMA统计表"><code class="literal">INFORMATION_SCHEMA.STATISTICS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一个</font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不一定是一个完整的索引名称。</font><font style="vertical-align: inherit;">它可以是索引名称的明确前缀。</font><font style="vertical-align: inherit;">如果前缀不明确，则会发生错误。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        例子：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM table1 USE INDEX（col1_index，col2_index）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WH1 col1 = 1 AND col2 = 2 AND col3 = 3;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM table1 IGNORE INDEX（col3_index）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WH1 col1 = 1 AND col2 = 2 AND col3 = 3;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        索引提示的语法具有以下特征：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            它在语法上是有效的，省略
             </font></font><em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了</font></font><code class="literal">USE
            INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不使用索引。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            省略</font></font><em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
             </font></font><code class="literal">FORCE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">IGNORE
            INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个语法错误。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以通过向提示添加</font></font><code class="literal">FOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句来</font><font style="vertical-align: inherit;">指定索引提示的范围
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这提供了对查询处理的各个阶段的执行计划的优化器选择的更细粒度的控制。</font><font style="vertical-align: inherit;">要仅影响MySQL决定如何在表中查找行以及如何处理连接时使用的索引，请使用</font></font><code class="literal">FOR
            JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要影响用于排序或分组行的索引使用情况，请使用</font></font><code class="literal">FOR ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><code class="literal">FOR GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以指定多个索引提示：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 USE INDEX（i1）IGNORE INDEX FOR ORDER BY（i2）ORDER BY a;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在几个提示中命名相同的索引（即使在相同的提示中）也不是错误的：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 USE INDEX（i1）USE INDEX（i1，i1）;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            但是，它是混合错误</font></font><code class="literal">USE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            和</font></font><code class="literal">FORCE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同一个表：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 USE INDEX FOR JOIN（i1）FORCE INDEX FOR JOIN（i2）;
</font></font></pre></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果索引提示不包含</font></font><code class="literal">FOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，则提示的范围将应用于语句的所有部分。</font><font style="vertical-align: inherit;">例如，这个提示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IGNORE INDEX（i1）
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        相当于这种提示的组合：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IGNORE索引加入（i1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IGNORE索引（ORDER BY）（i1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IGNORE INDEX FOR GROUP BY（i1）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在MySQL 5.0中，不带</font></font><code class="literal">FOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句的</font><font style="vertical-align: inherit;">提示范围</font><font style="vertical-align: inherit;">仅适用于行检索。</font><font style="vertical-align: inherit;">当不存在</font></font><code class="literal">FOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">，要使</font><font style="vertical-align: inherit;">服务器使用此旧行为</font><font style="vertical-align: inherit;">，请</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_old"><code class="literal">old</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时</font><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">注意在复制设置中启用此变量。</font><font style="vertical-align: inherit;">使用基于语句的二进制日志记录时，主服务器和从服务器使用不同的模式可能会导致复制错误。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当索引提示进行处理，它们是由式（收集在一个单一的列表</font></font><code class="literal">USE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">FORCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">IGNORE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和范围（</font></font><code class="literal">FOR
        JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">FOR ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">FOR
        GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  USE INDEX（）IGNORE INDEX（i2）USE INDEX（i1）USE INDEX（i2）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        相当于：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   USE INDEX（i1，i2）IGNORE INDEX（i2）;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        索引提示然后按以下顺序应用于每个范围：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            <code class="literal">{USE|FORCE} INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果存在，则应用。</font><font style="vertical-align: inherit;">（如果不是，则使用优化程序确定的一组索引。）
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">IGNORE INDEX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用于上一步的结果。</font><font style="vertical-align: inherit;">例如，以下两个查询是等同的：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 USE INDEX（i1）IGNORE INDEX（i2）USE INDEX（i2）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1 USE INDEX（i1）;</font></font><font></font>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索，索引提示的工作如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于自然语言模式搜索，索引提示将被忽略。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">IGNORE INDEX(i1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在没有警告的情况下被忽略，索引仍然被使用。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于布尔模式搜索，带有</font></font><code class="literal">FOR
            ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者的</font><font style="vertical-align: inherit;">索引提示</font></font><code class="literal">FOR GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默默忽略。</font><font style="vertical-align: inherit;">带有</font></font><code class="literal">FOR
            JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或不带</font></font><code class="literal">FOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修饰符的</font><font style="vertical-align: inherit;">索引提示将</font><font style="vertical-align: inherit;">得到遵守。</font><font style="vertical-align: inherit;">与提示如何应用于非</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font><font style="vertical-align: inherit;">相反</font><font style="vertical-align: inherit;">，该提示用于查询执行的所有阶段（查找行和检索，分组和排序）。</font><font style="vertical-align: inherit;">即使给出非</font></font><code class="literal">FULLTEXT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font><font style="vertical-align: inherit;">的提示，也是如此</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例如，以下两个查询是等同的：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  USE INDEX（index1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IGNORE INDEX（index1）用于ORDER BY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IGNORE INDEX（index1）适用于GROUP BY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在......布尔模式中......;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  USE INDEX（index1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在......布尔模式中......;</font></font><font></font>
</pre></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="cost-model"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.9.5优化器成本模型</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528101820912"></a><a class="indexterm" name="idm140528101819456"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了生成执行计划，优化器使用基于对查询执行期间发生的各种操作的成本进行估计的成本模型。</font><font style="vertical-align: inherit;">优化器具有一组可编辑的默认</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成本常量</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于制定有关执行计划的决策。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        优化器还具有执行计划构建过程中使用的成本估算数据库。</font><font style="vertical-align: inherit;">这些估计值存储在中</font></font><code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><code class="literal">engine_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表
         </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库中，随时可配置的。</font><font style="vertical-align: inherit;">这些表的目的是使它能够轻松调整优化器在尝试到达查询执行计划时使用的成本估计。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#cost-model-operation" title="成本模型一般操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成本模型一般操作</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#cost-model-database" title="成本模型数据库"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成本模型数据库</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#cost-model-database-modifications" title="对成本模型数据库进行更改"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对成本模型数据库进行更改</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="cost-model-operation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成本模型一般操作</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可配置的优化器成本模型如下所示：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器在启动时将成本模型表读入内存，并在运行时使用内存中的值。</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中指定的</font><font style="vertical-align: inherit;">任何非</font><font style="vertical-align: inherit;">成本估算优先于相应的编译默认成本常数。</font><font style="vertical-align: inherit;">任何</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              估计都会向优化器指示使用编译的默认值。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在运行时，服务器可能重新读取成本表。</font><font style="vertical-align: inherit;">当存储引擎动态加载或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-optimizer-costs"><code class="literal">FLUSH OPTIMIZER_COSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              执行语句</font><font style="vertical-align: inherit;">时会发生这种情况</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              成本表使服务器管理员能够通过更改表中的条目来轻松调整成本估算。</font><font style="vertical-align: inherit;">通过将条目的成本设置为，也很容易恢复为默认值</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化程序使用内存中的开销值，因此对表的更改应随后</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-optimizer-costs"><code class="literal">FLUSH
              OPTIMIZER_COSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生效。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当客户端会话开始时，当前内存中的成本估算适用于整个会话，直到它结束。</font><font style="vertical-align: inherit;">特别是，如果服务器重新读取成本表格，则任何更改的估算值仅适用于随后开始的会话。</font><font style="vertical-align: inherit;">现有会话不受影响。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              成本表特定于给定的服务器实例。</font><font style="vertical-align: inherit;">服务器不会将成本表更改复制到复制从服务器。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="cost-model-database"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成本模型数据库</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          优化器成本模型数据库由</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数据库中</font><font style="vertical-align: inherit;">的两个表组成，</font><font style="vertical-align: inherit;">其中包含查询执行期间发生的操作的成本估算信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idm140528101795056"></a>

              <a class="indexterm" name="idm140528101793568"></a>

              <code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：一般服务器操作的优化器成本估算
            </font></font></p></li><li class="listitem"><p>
              <a class="indexterm" name="idm140528101790528"></a>

              <a class="indexterm" name="idm140528101789040"></a>

              <code class="literal">engine_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：特定于特定存储引擎的操作的优化器成本估算
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表包含这些列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">cost_name</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              成本模型中使用的成本估算的名称。</font><font style="vertical-align: inherit;">名称不区分大小写。</font><font style="vertical-align: inherit;">如果服务器在读取此表时未识别成本名称，则会向错误日志写入警告。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">cost_value</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              成本估算值。</font><font style="vertical-align: inherit;">如果该值不是</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则服务器将其用作成本。</font><font style="vertical-align: inherit;">否则，它使用默认估计值（编译值）。</font><font style="vertical-align: inherit;">DBA可以通过更新此列来更改成本估算。</font><font style="vertical-align: inherit;">如果服务器在读取此表时发现成本值无效（非正确），则会向错误日志写入警告。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要覆盖默认成本估算（对于指定的条目</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），请将成本设置为非</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">要恢复为默认值，请将该值设置为</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-optimizer-costs"><code class="literal">FLUSH
              OPTIMIZER_COSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以通知服务器重新读取成本表。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">last_update</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              最后一行更新的时间。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">comment</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与成本估算相关的描述性评论。</font><font style="vertical-align: inherit;">DBA可以使用此列来提供有关成本估算行为何存储特定值的信息。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的主键</font><font style="vertical-align: inherit;">是</font></font><code class="literal">cost_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，因此不可能为任何成本估算创建多个条目。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器识别这些</font><font style="vertical-align: inherit;">表的</font></font><code class="literal">cost_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值</font></font><code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">disk_temptable_create_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认40.0），</font></font><code class="literal">disk_temptable_row_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认1.0）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              存储在基于磁盘的存储引擎（</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中的</font><font style="vertical-align: inherit;">内部创建的临时表的成本估算
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">增加这些值会增加使用内部临时表的成本估计值，并使优化程序偏好使用较少的查询计划。</font><font style="vertical-align: inherit;">有关这些表的信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-temporary-tables" title="8.4.4在MySQL中使用内部临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与相应内存参数（</font></font><code class="literal">memory_temptable_create_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">memory_temptable_row_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的默认值相比，这些磁盘参数的较大默认值</font><font style="vertical-align: inherit;">反映了处理基于磁盘的表的较高成本。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">key_compare_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （默认0.1）
            </font></font></p><a class="indexterm" name="idm140528101758800"></a><a class="indexterm" name="idm140528101757728"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              比较记录密钥的成本。</font><font style="vertical-align: inherit;">增加此值会导致查询计划比较许多密钥变得更加昂贵。</font><font style="vertical-align: inherit;">例如，</font></font><code class="literal">filesort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与避免使用索引进行排序的查询计划相比</font><font style="vertical-align: inherit;">，执行a的查询计划
               </font><font style="vertical-align: inherit;">变得相对昂贵。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">memory_temptable_create_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认2.0），</font></font><code class="literal">memory_temptable_row_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （默认0.2）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              存储在</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">中的内部创建的临时表的成本估算</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">增加这些值会增加使用内部临时表的成本估计值，并使优化程序偏好使用较少的查询计划。</font><font style="vertical-align: inherit;">有关这些表的信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-temporary-tables" title="8.4.4在MySQL中使用内部临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与相应磁盘参数（</font></font><code class="literal">disk_temptable_create_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">disk_temptable_row_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的默认值相比，这些内存参数的较小默认值</font><font style="vertical-align: inherit;">反映了处理基于内存的表的较低成本。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">row_evaluate_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （默认0.2）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              评估记录条件的成本。</font><font style="vertical-align: inherit;">与查询更少行的查询计划相比，增加此值会导致查询计划检查许多行变得更加昂贵。</font><font style="vertical-align: inherit;">例如，与读取较少行的范围扫描相比，表扫描变得相对昂贵。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">engine_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表包含这些列：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">engine_name</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此成本估算适用的存储引擎的名称。</font><font style="vertical-align: inherit;">名称不区分大小写。</font><font style="vertical-align: inherit;">如果值是
               </font></font><code class="literal">default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则它适用于所有没有自己的命名条目的存储引擎。</font><font style="vertical-align: inherit;">如果服务器在读取此表时未识别引擎名称，则会向错误日志写入警告。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">device_type</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              此成本估算适用的设备类型。</font><font style="vertical-align: inherit;">该列旨在为不同的存储设备类型指定不同的成本估算，例如硬盘驱动器与固态驱动器。</font><font style="vertical-align: inherit;">目前，该信息未被使用，0是唯一的允许值。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">cost_name</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与</font></font><code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">cost_value</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与</font></font><code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">last_update</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与</font></font><code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">comment</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与</font></font><code class="literal">server_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于主键</font></font><code class="literal">engine_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表是包含（一个元组</font></font><code class="literal">cost_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">engine_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">device_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）个列，所以它不可能在这些列中的值的任意组合来创建多个条目。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器识别这些</font><font style="vertical-align: inherit;">表的</font></font><code class="literal">cost_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值</font></font><code class="literal">engine_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">io_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （默认1.0）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              从磁盘读取索引或数据块的成本。</font><font style="vertical-align: inherit;">与增加此值的查询计划相比，读取许多磁盘块的查询计划与读取更少磁盘块的查询计划相比变得更加昂贵。</font><font style="vertical-align: inherit;">例如，与读取较少块的范围扫描相比，表扫描变得相对昂贵。
            </font></font></p></li><li class="listitem"><p>
              <code class="literal">memory_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （默认1.0）
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              与</font></font><code class="literal">io_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存数据库缓冲区中的索引或数据块的读取</font><font style="vertical-align: inherit;">相似</font><font style="vertical-align: inherit;">，但代表了其成本。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><code class="literal">io_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">memory_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值不同，则执行计划可能会在相同查询的两次运行之间更改。</font><font style="vertical-align: inherit;">假设内存访问的成本低于磁盘访问的成本。</font><font style="vertical-align: inherit;">在这种情况下，在数据读入缓冲池之前的服务器启动时，您可能会得到与查询运行后不同的计划，因为这样数据将存储在内存中。
</font></font></p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="cost-model-database-modifications"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对成本模型数据库进行更改</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于希望从其默认值更改成本模型参数的DBA，请尝试将值加倍或减半并测量结果。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对</font><font style="vertical-align: inherit;">参数</font></font><code class="literal">io_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">memory_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数的</font><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">最有可能产生有价值的结果。</font><font style="vertical-align: inherit;">这些参数值使数据访问方法的成本模型能够考虑从不同来源读取信息的成本; </font><font style="vertical-align: inherit;">即从磁盘读取信息与读取存储器缓冲区中已有信息的成本。</font><font style="vertical-align: inherit;">例如，所有其他事情都是相同的，将</font></font><code class="literal">io_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">为大于</font></font><code class="literal">memory_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优先级的</font><font style="vertical-align: inherit;">值
           </font><font style="vertical-align: inherit;">会使优化器更喜欢查询计划，该计划将内存中已保存的信息读取到必须从磁盘读取的计划中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此示例显示如何更改以下内容的默认值
           </font></font><code class="literal">io_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新mysql.engine_cost</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SET cost_value = 2.0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE cost_name ='io_block_read_cost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH OPTIMIZER_COSTS;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          此示例显示如何</font></font><code class="literal">io_block_read_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅
           </font><font style="vertical-align: inherit;">更改</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO mysql.engine_cost</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  VALUES（'InnoDB'，0，'io_block_read_cost'，3.0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  CURRENT_TIMESTAMP，'为InnoDB使用较慢的磁盘'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH OPTIMIZER_COSTS;</font></font><font></font>
</pre>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="buffering-caching"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10缓冲和高速缓存</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#innodb-buffer-pool-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.1 InnoDB缓冲池优化</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#myisam-key-cache"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2 MyISAM密钥缓存</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#query-cache"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3 MySQL查询缓存</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#statement-caching"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.4缓存准备好的语句和存储的程序</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL使用多种策略缓存内存缓冲区中的信息以提高性能。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-buffer-pool-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.1 InnoDB缓冲池优化</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528101701200"></a><a class="indexterm" name="idm140528101700128"></a><a class="indexterm" name="idm140528101699056"></a><p>
        <a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维护一个称为</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_buffer_pool" title="缓冲池"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的存储区域，</font><font style="vertical-align: inherit;">
        用于在内存中缓存数据和索引。</font><font style="vertical-align: inherit;">了解</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池</font><font style="vertical-align: inherit;">如何
         </font><font style="vertical-align: inherit;">工作，并利用它来将频繁访问的数据保存在内存中，这是MySQL调优的一个重要方面。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池</font><font style="vertical-align: inherit;">内部工作的说明，
         </font><font style="vertical-align: inherit;">其LRU替换算法的概述和一般配置信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-buffer-pool" title="14.6.3.1 InnoDB缓冲池"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.1节“InnoDB缓冲池”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有关其他</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池配置和调整信息，请参阅以下部分：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-read_ahead" title="14.6.3.5配置InnoDB缓冲池预取（预读）"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.5节“配置InnoDB缓冲池预取（预读）”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="14.6.3.6配置InnoDB缓冲池刷新"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.6节“配置InnoDB缓冲池刷新”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="14.6.3.4使缓冲池抗扫描"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.4节“使缓冲池抗扫描”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-multiple-buffer-pools" title="14.6.3.3配置多个缓冲池实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.3节“配置多个缓冲池实例”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-preload-buffer-pool" title="14.6.3.8保存和恢复缓冲池状态"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.8节“保存和恢复缓冲池状态”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-lru-background-flushing" title="14.6.3.7微调InnoDB缓冲池刷新"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.7节“微调InnoDB缓冲池刷新”</font></font></a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-buffer-pool-resize" title="14.6.3.2配置InnoDB缓冲池大小"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.2节“配置InnoDB缓冲池大小”</font></font></a>
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-key-cache"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2 MyISAM密钥缓存</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#shared-key-cache"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.1共享密钥缓存访问</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#multiple-key-caches"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.2多个密钥缓存</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#midpoint-insertion"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.3中点插入策略</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#index-preloading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.4索引预加载</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#key-cache-block-size"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.5密钥缓存块大小</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#key-cache-restructuring"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.6重构密钥缓存</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528101679376"></a><a class="indexterm" name="idm140528101678304"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了最大限度地减少磁盘I / O，</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎采用了许多数据库管理系统使用的策略。</font><font style="vertical-align: inherit;">它采用缓存机制将最常访问的表格块保留在内存中：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于索引块，</font><font style="vertical-align: inherit;">维护</font><font style="vertical-align: inherit;">一个称为</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥缓存</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或
             </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥缓冲区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的特殊结构
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该结构包含大量使用最多索引块的块缓冲区。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于数据块，MySQL不使用特殊的缓存。</font><font style="vertical-align: inherit;">相反，它依赖于本机操作系统文件系统缓存。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节首先描述</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥缓存</font><font style="vertical-align: inherit;">的基本操作
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后讨论提高关键缓存性能的功能，并使您能够更好地控制缓存操作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            多个会话可以同时访问高速缓存。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以设置多个键缓存并将表索引分配给特定的缓存。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要控制密钥缓存的大小，请使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">如果此变量设置为零，则不使用密钥缓存。</font><font style="vertical-align: inherit;">如果该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值太小而无法分配最小数量的块缓冲区（8），</font><font style="vertical-align: inherit;">则不会使用密钥缓存
         </font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当密钥缓存不可操作时，仅使用操作系统提供的本机文件系统缓存来访问索引文件。</font><font style="vertical-align: inherit;">（换句话说，使用与用于表格数据块的策略相同的策略访问表格索引块。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        索引块是访问</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引文件</font><font style="vertical-align: inherit;">的连续单元
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常，索引块的大小等于索引B树的节点大小。</font><font style="vertical-align: inherit;">（索引在磁盘上使用B树数据结构表示，树底部的节点是叶节点，叶节点上方的节点是非叶节点。）
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        密钥缓存结构中的所有块缓存都具有相同的大小。</font><font style="vertical-align: inherit;">该大小可以等于，大于或小于表索引块的大小。</font><font style="vertical-align: inherit;">通常一个这两个值是另一个的倍数。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当必须访问来自任何表索引块的数据时，服务器首先检查它是否在密钥缓存的某个块缓冲区中可用。</font><font style="vertical-align: inherit;">如果是这样，服务器访问密钥缓存中的数据而不是磁盘上的数据。</font><font style="vertical-align: inherit;">也就是说，它从缓存读取数据或写入数据而不是读取或写入磁盘。</font><font style="vertical-align: inherit;">否则，服务器会选择一个包含不同表索引块（或多个块）的高速缓存块缓冲区，并通过所需表索引块的副本替换那里的数据。</font><font style="vertical-align: inherit;">只要新索引块在缓存中，就可以访问索引数据。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果碰巧选择替换的块已被修改，则该块被认为是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脏的”。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，在被替换之前，其内容被刷新到它来自的表索引。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        通常服务器遵循一个</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LRU（最近最少使用）</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略：当选择一个替换块时，它选择最近最少使用的索引块。</font><font style="vertical-align: inherit;">为了使选择更容易，密钥缓存模块将所有使用的块保存在</font><font style="vertical-align: inherit;">按使用时间排序</font><font style="vertical-align: inherit;">的特定列表（</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LRU链</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中。</font><font style="vertical-align: inherit;">当一个块被访问时，它是最近使用的并放在列表的末尾。</font><font style="vertical-align: inherit;">当需要替换块时，列表开始处的块最近被最少使用，并且成为驱逐的第一个候选者。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎还采用LRU算法来管理它的缓冲池。</font><font style="vertical-align: inherit;">请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-buffer-pool" title="14.6.3.1 InnoDB缓冲池"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.1节“InnoDB缓冲池”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="shared-key-cache"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.1共享密钥缓存访问</font></font></h4>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          线程可以同时访问键缓存缓冲区，但需满足以下条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              未更新的缓冲区可以被多个会话访问。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              正在更新的缓冲区会导致需要使用它的会话等待更新完成。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              只要不相互干扰（即只要它们需要不同的索引块，并因此导致不同的高速缓存块被替换），多个会话就可以启动导致高速缓存块替换的请求。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对密钥缓存的共享访问使服务器能够显着提高吞吐量。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="multiple-key-caches"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.2多个密钥缓存</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对密钥缓存的共享访问可以提高性能，但不会完全消除会话间的争用。</font><font style="vertical-align: inherit;">他们仍在争夺管理对密钥缓存缓冲区访问的控制结构。</font><font style="vertical-align: inherit;">为了进一步减少关键缓存访问争用，MySQL还提供了多个密钥缓存。</font><font style="vertical-align: inherit;">此功能使您可以将不同的表索引分配给不同的密钥缓存。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在有多个键缓存的情况下，服务器在处理给定</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">查询时必须知道使用哪个缓存
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，所有
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表索引都缓存在默认密钥缓存中。</font><font style="vertical-align: inherit;">要将表索引分配给特定的键缓存，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#cache-index" title="13.7.6.2 CACHE INDEX语法"><code class="literal">CACHE INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#cache-index" title="13.7.6.2 CACHE INDEX语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.6.2节“CACHE INDEX语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">例如，下面的语句从表中分配指标
           </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及
           </font></font><code class="literal">t3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为键缓存
           </font></font><code class="literal">hot_cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CACHE INDEX t1, t2, t3 IN hot_cache;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------------- + ---------- + ------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">操作| </font><font style="vertical-align: inherit;">Msg_type | </font><font style="vertical-align: inherit;">Msg_text |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------------- + ---------- + ------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t1 | </font><font style="vertical-align: inherit;">assign_to_keycache | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t2 | </font><font style="vertical-align: inherit;">assign_to_keycache | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t3 | </font><font style="vertical-align: inherit;">assign_to_keycache | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------------- + ---------- + ------- --- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#cache-index" title="13.7.6.2 CACHE INDEX语法"><code class="literal">CACHE
          INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明中</font><font style="vertical-align: inherit;">
          引用的键缓存</font><font style="vertical-align: inherit;">可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET
          GLOBAL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用参数设置语句或使用服务器启动选项</font><font style="vertical-align: inherit;">设置其大小来创建</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL keycache1.key_buffer_size=128*1024;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要销毁密钥缓存，请将其大小设置为零：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL keycache1.key_buffer_size=0;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您不能销毁默认密钥缓存。</font><font style="vertical-align: inherit;">任何尝试这样做都会被忽略：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL key_buffer_size = 0;</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'key_buffer_size';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">key_buffer_size | </font><font style="vertical-align: inherit;">8384512 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + --------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          密钥缓存变量是具有名称和组件的结构化系统变量。</font><font style="vertical-align: inherit;">对于
           </font></font><code class="literal">keycache1.key_buffer_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">keycache1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是缓存变量名称并且
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是缓存组件。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">用于引用结构化键缓存系统变量的语法的描述，</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#structured-system-variables" title="5.1.6.1结构化系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.6.1节“结构化系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          默认情况下，表索引分配给在服务器启动时创建的主（默认）键缓存。</font><font style="vertical-align: inherit;">当关键缓存被销毁时，分配给它的所有索引都被重新分配到默认键缓存。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于繁忙的服务器，您可以使用包含三个关键缓存的策略：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">热门</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥缓存，占用了为所有密钥缓存分配的空间的20％。</font><font style="vertical-align: inherit;">将其用于大量用于搜索但未更新的表格。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冷</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键缓存占用了为所有键缓存分配的空间的20％。</font><font style="vertical-align: inherit;">将此缓存用于中等大小，密集修改的表格，如临时表格。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温暖</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”的</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥缓存，占用了密钥缓存空间的60％。</font><font style="vertical-align: inherit;">将其用作默认键缓存，默认情况下用于所有其他表。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用三个关键缓存是有益的原因之一是访问一个关键缓存结构不会阻止访问其他关键缓存。</font><font style="vertical-align: inherit;">访问分配给一个缓存的表的语句不会与访问分配给另一个缓存的表的语句竞争。</font><font style="vertical-align: inherit;">绩效收益也出于其他原因：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              热缓存仅用于检索查询，因此其内容不会被修改。</font><font style="vertical-align: inherit;">因此，无论何时索引块需要从磁盘中取出，被选择用于替换的高速缓存块的内容都不需要先刷新。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于分配给热缓存的索引，如果没有查询需要索引扫描，则与索引B树的非叶节点相对应的索引块很可能保留在缓存中。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当更新的节点位于高速缓存中并且不需要首先从磁盘读入时，对临时表执行频率最高的更新操作执行得更快。</font><font style="vertical-align: inherit;">如果临时表的索引大小与冷关键字高速缓存的大小相当，则更新节点位于高速缓存中的概率非常高。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#cache-index" title="13.7.6.2 CACHE INDEX语法"><code class="literal">CACHE INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句在表和密钥缓存之间建立关联，但每次服务器重新启动时关联都会丢失。</font><font style="vertical-align: inherit;">如果您希望关联在服务器启动时生效，一种方法是使用选项文件：包含配置您的键缓存的变量设置，以及一个</font></font><code class="literal">init-file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名包含</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#cache-index" title="13.7.6.2 CACHE INDEX语法"><code class="literal">CACHE INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要执行的语句</font><font style="vertical-align: inherit;">的文件</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">key_buffer_size = 4G</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hot_cache.key_buffer_size = 2G</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cold_cache.key_buffer_size = 2G</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
init_file = / </font></font><em class="replaceable"><code>path</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><em class="replaceable"><code>to</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><em class="replaceable"><code>data-directory</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/mysqld_init.sql
</font></font></pre><p><font style="vertical-align: inherit;"></font><code class="filename">mysqld_init.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次服务器启动时都会执行</font><font style="vertical-align: inherit;">
          语句</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该文件应该包含每行一条SQL语句。</font><font style="vertical-align: inherit;">以下示例将几个表每到</font></font><code class="literal">hot_cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><code class="literal">cold_cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CACHE INDEX db1.t1，db1.t2，db2.t3 IN hot_cache</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CACHE INDEX db1.t4，db2.t5，db2.t6 IN cold_cache</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="midpoint-insertion"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.3中点插入策略</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          默认情况下，密钥缓存管理系统使用简单的LRU策略来选择要被驱逐的密钥缓存块，但它也支持更复杂的方法，称为
           </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中点插入策略。</font></font></span>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用中点插入策略时，LRU链分为两部分：热子列表和暖子列表。</font><font style="vertical-align: inherit;">两部分之间的划分点并不固定，但密钥缓存管理系统需要注意的是，加密部分不是
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">太短</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是至少包含
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键缓存块的百分比。
          </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是结构化键缓存变量的一个组件，因此它的值是一个可以为每个缓存设置的参数。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当索引块从表中读取到密钥缓存中时，它被放置在暖子列表的末尾。</font><font style="vertical-align: inherit;">经过一定次数的访问（块访问）后，它被提升到热子列表。</font><font style="vertical-align: inherit;">目前，促进块（3）所需的命中数对于所有索引块是相同的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          升级到热子列表的块放置在列表的末尾。</font><font style="vertical-align: inherit;">该块然后在这个子列表中循环。</font><font style="vertical-align: inherit;">如果该块在子列表的开始处停留足够长的时间，则将其降级到暖子列表。</font><font style="vertical-align: inherit;">这个时间由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_cache_age_threshold"><code class="literal">key_cache_age_threshold</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          密钥缓存</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">组件</font><font style="vertical-align: inherit;">的值决定
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该阈值规定，对于包含</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块</font><font style="vertical-align: inherit;">的键缓存</font><font style="vertical-align: inherit;">，在最后</font></font><code class="literal"><em class="replaceable"><code>N</code></em> *
          key_cache_age_threshold / 100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命中</font><font style="vertical-align: inherit;">内未被访问的热子列表的开始处的块
           </font><font style="vertical-align: inherit;">将被移动到暖子列表的开始处。</font><font style="vertical-align: inherit;">然后它成为驱逐的第一个候选对象，因为替换块始终是从暖子列表的开头取得的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          中点插入策略使您能够将更多值的块始终保存在缓存中。</font><font style="vertical-align: inherit;">如果您更喜欢使用简单的LRU策略，请将该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          值设置为默认值100。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当执行需要索引扫描的查询时，中点插入策略有助于提高性能，从而有效地将高价值高级别B树节点对应的所有索引块从缓存中移出。</font><font style="vertical-align: inherit;">为避免这种情况，您必须使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font><font style="vertical-align: inherit;">中点插入策略，
           </font><font style="vertical-align: inherit;">使其远小于100.然后，在索引扫描操作期间，热门子节点中保存的有价值的频繁命中节点也会保留。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="index-preloading"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.4索引预加载</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果密钥缓存中有足够的块来保存整个索引的块，或者至少包含与其非叶节点相对应的块，则在开始使用索引块之前预先加载索引块是有意义的。</font><font style="vertical-align: inherit;">通过预加载，您可以以最有效的方式将表索引块放入键高速缓存缓冲区中：通过顺序读取磁盘上的索引块。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在没有预加载的情况下，块仍然按照查询的需要放置在密钥缓存中。</font><font style="vertical-align: inherit;">尽管这些块将保留在缓存中，因为它们都有足够的缓冲区，但它们是以随机顺序从磁盘中获取的，而不是按顺序获取的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要将索引预加载到缓存中，请使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-index" title="13.7.6.5 LOAD INDEX INTO CACHE语法"><code class="literal">LOAD INDEX INTO
          CACHE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">例如，以下语句预加载表的索引节点（索引块），</font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>LOAD INDEX INTO CACHE t1, t2 IGNORE LEAVES;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">操作| </font><font style="vertical-align: inherit;">Msg_type | </font><font style="vertical-align: inherit;">Msg_text |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t1 | </font><font style="vertical-align: inherit;">preload_keys | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t2 | </font><font style="vertical-align: inherit;">preload_keys | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------- + ---------- + ---------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">IGNORE LEAVES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修饰符只会导致索引的非叶节点的块被预加载。</font><font style="vertical-align: inherit;">因此，所显示的语句预加载所有索引块
           </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但仅阻塞非叶节点</font></font><code class="literal">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#cache-index" title="13.7.6.2 CACHE INDEX语法"><code class="literal">CACHE INDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句将索引</font><font style="vertical-align: inherit;">分配给键缓存
           </font><font style="vertical-align: inherit;">，则预加载将索引块放入该缓存。</font><font style="vertical-align: inherit;">否则，索引将加载到默认密钥缓存中。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="key-cache-block-size"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.5密钥缓存块大小</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_cache_block_size"><code class="literal">key_cache_block_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          变量</font><font style="vertical-align: inherit;">为单个键缓存指定块缓冲区的大小
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这允许调整索引文件的I / O操作的性能。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当读取缓冲区的大小等于本机操作系统I / O缓冲区的大小时，可以实现I / O操作的最佳性能。</font><font style="vertical-align: inherit;">但是将关键节点的大小设置为等于I / O缓冲区的大小并不总能确保最佳的整体性能。</font><font style="vertical-align: inherit;">当读取大叶节点时，服务器拉入大量不必要的数据，有效地防止读取其他叶节点。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          索引文件</font><font style="vertical-align: inherit;">中块的大小，请</font><font style="vertical-align: inherit;">在服务器启动时</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_myisam-block-size"><code class="option">--myisam-block-size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="key-cache-restructuring"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.2.6重构密钥缓存</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通过更新其参数值，可以随时重新构建密钥缓存。</font><font style="vertical-align: inherit;">例如：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL cold_cache.key_buffer_size=4*1024*1024;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您向</font><font style="vertical-align: inherit;">组件</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_cache_block_size"><code class="literal">key_cache_block_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键缓存组件</font><font style="vertical-align: inherit;">分配了
           </font><font style="vertical-align: inherit;">与组件当前值不同的值，则服务器将销毁缓存的旧结构并根据新值创建一个新结构。</font><font style="vertical-align: inherit;">如果高速缓存包含任何脏块，则在销毁并重新创建高速缓存之前，服务器将它们保存到磁盘。</font><font style="vertical-align: inherit;">如果更改其他关键缓存参数，则不会发生重构。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          重构密钥缓存时，服务器首先将任何脏缓冲区的内容刷新到磁盘。</font><font style="vertical-align: inherit;">之后，缓存内容变得不可用。</font><font style="vertical-align: inherit;">但是，重构不会阻止需要使用分配给缓存的索引的查询。</font><font style="vertical-align: inherit;">相反，服务器使用本机文件系统缓存直接访问表索引。</font><font style="vertical-align: inherit;">文件系统缓存的效率不如使用密钥缓存的效率，因此虽然查询执行，但预计会减慢。</font><font style="vertical-align: inherit;">高速缓存重新构建后，它会再次用于缓存分配给它的索引，并且停止使用文件系统缓存。
</font></font></p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="query-cache"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3 MySQL查询缓存</font></font></h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#query-cache-operation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3.1查询缓存如何操作</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#query-cache-in-select"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3.2查询缓存SELECT选项</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#query-cache-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3.3查询缓存配置</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#query-cache-status-and-maintenance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3.4查询缓存状态和维护</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528101560432"></a><a class="indexterm" name="idm140528101559360"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询缓存从MySQL 5.7.20开始已弃用，并在MySQL 8.0中删除。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询缓存存储</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的文本以及
         </font><font style="vertical-align: inherit;">发送给客户端的相应结果。</font><font style="vertical-align: inherit;">如果稍后收到相同的语句，服务器将从查询缓存中检索结果，而不是再次解析并执行语句。</font><font style="vertical-align: inherit;">查询缓存在会话中共享，因此可以发送由一个客户端生成的结果集，以响应另一个客户端发出的相同查询。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询缓存可以用于您的表格不经常更改并且服务器接收到许多相同查询的环境中。</font><font style="vertical-align: inherit;">这是许多基于数据库内容生成许多动态页面的Web服务器的典型情况。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询缓存不会返回陈旧的数据。</font><font style="vertical-align: inherit;">当表被修改时，查询缓存中的任何相关条目都会被刷新。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询缓存在多个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器更新相同
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的环境中不起作用</font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询缓存用于</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache-operation" title="8.10.3.1查询缓存如何操作"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3.1节“查询缓存操作方式”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述条件下的预处理语句</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          分区表不支持查询缓存，并且在涉及分区表的查询中自动禁用查询缓存。</font><font style="vertical-align: inherit;">查询缓存无法启用此类查询。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询缓存的一些性能数据如下所示。</font><font style="vertical-align: inherit;">这些结果是通过在具有2GB RAM和64MB查询缓存的Linux Alpha 2×500MHz系统上运行MySQL基准套件生成的。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您正在执行的所有查询都很简单（例如从一行中的表中选择一行），但仍然存在差异，从而无法缓存查询，那么使查询缓存处于活动状态的开销为13％。</font><font style="vertical-align: inherit;">这可能被认为是最坏的情况。</font><font style="vertical-align: inherit;">在现实生活中，查询往往要复杂得多，所以开销通常要低得多。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在查询缓存中搜索单行表中的单个行比没有查询缓存快了238％。</font><font style="vertical-align: inherit;">这可以被认为接近于被缓存的查询所预期的最小加速比。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要在服务器启动时禁用查询缓存，请将</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">设置
         </font><font style="vertical-align: inherit;">为0.通过禁用查询缓存代码，没有明显的开销。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        查询缓存提供了显着提高性能的潜力，但不要以为它会在所有情况下都这样做。</font><font style="vertical-align: inherit;">对于某些查询缓存配置或服务器工作负载，实际上可能会看到性能下降：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            请谨慎对待查询缓存过大，这会增加维护缓存所需的开销，可能超出启用缓存的好处。</font><font style="vertical-align: inherit;">数十兆字节的大小通常是有益的。</font><font style="vertical-align: inherit;">数百兆字节的大小可能不是。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器工作负载对查询缓存效率有重大影响。</font><font style="vertical-align: inherit;">几乎完全由一组固定</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句</font><font style="vertical-align: inherit;">组成的查询组合</font><font style="vertical-align: inherit;">很有可能从启用缓存中受益，而不是混合体中频繁的
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句导致缓存中的结果不断失效。</font><font style="vertical-align: inherit;">在某些情况下，解决方法是使用该
             </font></font><code class="literal">SQL_NO_CACHE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来防止结果为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用频繁修改的表的语句</font><font style="vertical-align: inherit;">甚至输入缓存
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache-in-select" title="8.10.3.2查询缓存SELECT选项"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3.2节“查询高速缓存选择选项”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要验证启用查询缓存是否有益，请在启用和禁用缓存的情况下测试MySQL服务器的操作。</font><font style="vertical-align: inherit;">然后定期重新测试，因为查询缓存效率可能随着服务器工作负载的变化而改变
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-operation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3.1查询缓存如何操作</font></font></h4>

</div>

</div>

</div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查询缓存从MySQL 5.7.20开始已弃用，并在MySQL 8.0中删除。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍查询缓存在运行时的工作方式。</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache-configuration" title="8.10.3.3查询缓存配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3.3节“查询缓存配置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述了如何控制它是否可操作。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在解析之前将传入查询与查询缓存中的查询进行比较，因此以下两个查询被查询缓存视为不同：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择*从</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择*从</font></font><em class="replaceable"><code>tbl_name</code></em>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询必须</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全相同</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（字节的字节）才能被视为相同。</font><font style="vertical-align: inherit;">另外，由于其他原因，相同的查询字符串可能会被视为不同。</font><font style="vertical-align: inherit;">使用不同数据库，不同协议版本或不同默认字符集的查询被视为不同的查询，并分别进行缓存。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          缓存不用于以下类型的查询：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              查询是外部查询的子查询
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              查询在存储的函数，触发器或事件的主体内执行
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在从查询缓存中获取查询结果之前，MySQL会检查用户是否具有所
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及的所有数据库和表的特权。</font><font style="vertical-align: inherit;">如果不是这种情况，则不使用缓存的结果。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果查询缓存返回查询结果，则服务器将增加</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Qcache_hits"><code class="literal">Qcache_hits</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          状态变量，而不是</font></font><code class="literal">Com_select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache-status-and-maintenance" title="8.10.3.4查询缓存状态和维护"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3.4节“查询缓存状态和维护”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果表发生更改，则使用该表的所有缓存查询都将无效并从缓存中删除。</font><font style="vertical-align: inherit;">这包括使用</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射到已更改表的查询。</font><font style="vertical-align: inherit;">一个表可以被许多类型的语句，如被改变</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#truncate-table" title="13.1.34 TRUNCATE TABLE语法"><code class="literal">TRUNCATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-table" title="13.1.29 DROP TABLE语法"><code class="literal">DROP TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-database" title="13.1.22 DROP DATABASE语法"><code class="literal">DROP DATABASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询缓存在使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">时也可以在事务中使用
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对视图</font><font style="vertical-align: inherit;">
          的</font><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">结果</font><font style="vertical-align: inherit;">被缓存。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询缓存适用于</font></font><code class="literal">SELECT SQL_CALC_FOUND_ROWS
          ...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询并存储由以下</font></font><code class="literal">SELECT FOUND_ROWS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">返回的值</font><font style="vertical-align: inherit;">。
          </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使前面的查询是从缓存中获取的，也会返回正确的值，因为找到的行数也存储在缓存中。</font><font style="vertical-align: inherit;">该</font></font><code class="literal">SELECT FOUND_ROWS()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询本身不能被缓存。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-stmt-prepare" title="27.8.11.21 mysql_stmt_prepare（）"><code class="literal">mysql_stmt_prepare()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font><font style="vertical-align: inherit;">使用二进制协议发布的准备语句</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-stmt-execute" title="27.8.11.10 mysql_stmt_execute（）"><code class="literal">mysql_stmt_execute()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/connectors-apis.html#c-api-prepared-statements" title="27.8.8 C API准备的语句"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第27.8.8节“C API准备语句”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）受缓存的限制。</font><font style="vertical-align: inherit;">与查询缓存中的语句进行比较是基于扩展</font></font><code class="literal">?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数标记</font><font style="vertical-align: inherit;">后的语句文本</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该语句仅与使用二进制协议执行的其他缓存语句进行比较。</font><font style="vertical-align: inherit;">也就是说，对于查询缓存目的，使用二进制协议发布的预准备语句与使用文本协议发布的准备语句截然不同（请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#sql-syntax-prepared-statements" title="13.5准备的SQL语句语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.5节“准备的SQL语句语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果查询使用以下任何函数，则不能缓存该查询：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_aes-decrypt"><code class="literal">AES_DECRYPT()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_aes-encrypt"><code class="literal">AES_ENCRYPT()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_convert-tz"><code class="literal">CONVERT_TZ()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_curdate"><code class="literal">CURDATE()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-date"><code class="literal">CURRENT_DATE()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-time"><code class="literal">CURRENT_TIME()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-timestamp"><code class="literal">CURRENT_TIMESTAMP()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_curtime"><code class="literal">CURTIME()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_database"><code class="literal">DATABASE()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_encrypt"><code class="literal">ENCRYPT()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 有一个参数
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_is-free-lock"><code class="literal">IS_FREE_LOCK()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_is-used-lock"><code class="literal">IS_USED_LOCK()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_master-pos-wait"><code class="literal">MASTER_POS_WAIT()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_now"><code class="literal">NOW()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_password"><code class="literal">PASSWORD()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_rand"><code class="literal">RAND()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_random-bytes"><code class="literal">RANDOM_BYTES()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_release-all-locks"><code class="literal">RELEASE_ALL_LOCKS()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_sleep"><code class="literal">SLEEP()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 没有参数
            </font></font></p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_user"><code class="literal">USER()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid"><code class="literal">UUID()</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/functions.html#function_uuid-short"><code class="literal">UUID_SHORT()</code></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询也不会在这些条件下被缓存：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它是指用户定义的函数（UDF）或存储函数。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它引用用户变量或本地存储的程序变量。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它是指在表</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><code class="literal">INFORMATION_SCHEMA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">performance_schema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它指的是任何分区表。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它具有以下任何形式：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择...锁定共享模式</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... FOR UPDATE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... INTO OUTFILE ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... INTO DUMPFILE ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM ... WHERE autoincrement_col IS NULL</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              最后一个表单不被缓存，因为它用作获取最后一个插入ID值的ODBC解决方法。</font><font style="vertical-align: inherit;">请参阅</font></font><a class="xref" href="/mysql-5.7-google-zh/connectors-apis.html" title="第27章连接器和API"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第27章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接器和API中</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的连接器/ ODBC部分
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隔离级别的</font><font style="vertical-align: inherit;">事务中的语句
               </font><font style="vertical-align: inherit;">也不能被缓存，因为它们使用</font></font><code class="literal">LOCK
              IN SHARE MODE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它使用</font></font><code class="literal">TEMPORARY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它不使用任何表格。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              它会产生警告。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              用户具有任何涉及表的列级特权。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-in-select"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3.2查询缓存SELECT选项</font></font></h4>

</div>

</div>

</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查询缓存从MySQL 5.7.20开始已弃用，并在MySQL 8.0中删除。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          两个查询缓存相关的选项可以在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">指定
           </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idm140528101409328"></a>

              <code class="literal">SQL_CACHE</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果查询结果可缓存并且</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量的值为</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font><font style="vertical-align: inherit;">，则查询结果将被缓存
               </font></font><code class="literal">DEMAND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><a class="indexterm" name="idm140528101403888"></a><p>
              <code class="literal">SQL_NO_CACHE</code>
            </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器不使用查询缓存。</font><font style="vertical-align: inherit;">它既不检查查询缓存以查看结果是否已被缓存，也不缓存查询结果。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          例子：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT SQL_CACHE id，name FROM customer;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT SQL_NO_CACHE id，name FROM customer;</font></font><font></font>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3.3查询缓存配置</font></font></h4>

</div>

</div>

</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查询缓存从MySQL 5.7.20开始已弃用，并在MySQL 8.0中删除。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_have_query_cache"><code class="literal">have_query_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器系统变量指示查询缓存是否可用：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'have_query_cache';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">have_query_cache | </font><font style="vertical-align: inherit;">是|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当使用标准的MySQL二进制文件时</font></font><code class="literal">YES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即使查询缓存被禁用</font><font style="vertical-align: inherit;">，该值也是一直
           </font><font style="vertical-align: inherit;">存在的。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          其他几个系统变量控制查询缓存操作。</font><font style="vertical-align: inherit;">这些可以在启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时在选项文件或命令行中设置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">查询缓存系统变量都具有以开头的名称
           </font></font><code class="literal">query_cache_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中简要介绍了它们
           </font><font style="vertical-align: inherit;">，并给出了此处给出的其他配置信息。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要设置查询缓存的大小，请设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">将其设置为0将禁用查询缓存，设置也一样</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，查询缓存被禁用。</font><font style="vertical-align: inherit;">这是通过使用默认大小为1M的方式实现的，默认
           </font></font><code class="literal">query_cache_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为0。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了显着降低开销，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您不使用查询缓存</font><font style="vertical-align: inherit;">，请启动服务器
           </font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用Windows配置向导安装或配置MySQL时，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将根据可用的不同配置类型自动为您配置</font><font style="vertical-align: inherit;">默认值
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用Windows配置向导时，由于选定的配置，可能会启用查询缓存（即，设置为非零值）。</font><font style="vertical-align: inherit;">查询缓存也由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">的设置来控制
             </font><font style="vertical-align: inherit;">。</font></font><code class="filename">my.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在配置</font><font style="vertical-align: inherit;">完成</font><font style="vertical-align: inherit;">后</font><font style="vertical-align: inherit;">检查</font><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">设置的这些变量的值
             </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当您设置</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为非零值时，请记住查询缓存需要最小大小约为40KB来分配其结构。</font><font style="vertical-align: inherit;">（具体大小取决于系统架构。）如果设置的值太小，您将收到警告，如下例所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL query_cache_size = 40000;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询确定，0行受影响，1个警告（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  级别：警告</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1282</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息：查询缓存无法设置大小39936;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         新的查询缓存大小为0</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL query_cache_size = 41984;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'query_cache_size';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">query_cache_size | </font><font style="vertical-align: inherit;">41984 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为使查询缓存实际上能够保存任何查询结果，其大小必须设置得更大：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL query_cache_size = 1000000;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询OK，0行受影响（0.04秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'query_cache_size';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">query_cache_size | </font><font style="vertical-align: inherit;">999424 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.00秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值与最接近的1024字节块对齐。</font><font style="vertical-align: inherit;">因此报告的值可能与您分配的值不同。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果查询缓存大小大于0，则该
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量影响它的工作方式。</font><font style="vertical-align: inherit;">该变量可以设置为以下值：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              的值</font></font><code class="literal">0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              防止缓存或缓存的结果的检索。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              除了那些以开头的语句之外的</font><font style="vertical-align: inherit;">
              值</font></font><code class="literal">1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">ON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用缓存
               </font></font><code class="literal">SELECT SQL_NO_CACHE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个值</font></font><code class="literal">2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><code class="literal">DEMAND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致仅以那些开头的语句进行缓存</font></font><code class="literal">SELECT
              SQL_CACHE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为0，则还应该将</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">为0.在这种情况下，服务器根本不会获取查询缓存互斥锁，这意味着查询缓存无法在运行时启用，并且查询执行的开销也会降低。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          设置该</font></font><code class="literal">GLOBAL</code>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值将确定进行更改后连接的所有客户端的查询缓存行为。</font><font style="vertical-align: inherit;">各个客户端可以通过设置</font></font><code class="literal">SESSION</code>
          <a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">来控制自己连接的缓存行为
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，客户端可以禁止使用查询缓存来处理它自己的查询，如下所示：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET SESSION query_cache_type = OFF;</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器启动时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">（而不是在运行时使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          语句），则只允许使用数值。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制可以缓存的单个查询结果的最大大小，请设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_limit"><code class="literal">query_cache_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">默认值是1MB。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          小心不要将缓存大小设置得太大。</font><font style="vertical-align: inherit;">由于线程需要在更新过程中锁定缓存，因此您可能会看到使用非常大的缓存锁定争用问题。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您可以</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用</font><font style="vertical-align: inherit;">
            命令行或配置文件中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">选项，</font><font style="vertical-align: inherit;">通过语句
             </font><font style="vertical-align: inherit;">在运行时设置查询高速缓存可指定的最大大小
             </font><font style="vertical-align: inherit;">。
</font></font><code class="option">--maximum-query_cache_size=<em class="replaceable"><code>32M</code></em></code><font style="vertical-align: inherit;"></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当查询被缓存时，其结果（发送到客户端的数据）在结果检索期间存储在查询缓存中。</font><font style="vertical-align: inherit;">因此，数据通常不会在一个大块中处理。</font><font style="vertical-align: inherit;">查询缓存根据需要分配块来存储这些数据，因此当一个块被填充时，将分配一个新的块。</font><font style="vertical-align: inherit;">由于内存分配操作代价高昂（按时间），因此查询缓存会为</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          系统变量</font><font style="vertical-align: inherit;">提供的最小大小分配块
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当查询被执行时，最后的结果块被修剪成实际的数据大小，以便释放未使用的内存。</font><font style="vertical-align: inherit;">根据您的服务器执行的查询类型，您可能会发现调整以下值有帮助
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              默认值
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              是4KB。</font><font style="vertical-align: inherit;">这在大多数情况下应该是足够的。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果有很多查询的结果很少，那么默认的块大小可能会导致内存碎片化，如大量空闲块所示。</font><font style="vertical-align: inherit;">由于缺少内存，碎片可能会强制查询缓存修剪（删除）缓存中的查询。</font><font style="vertical-align: inherit;">在这种情况下，减少值
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">空闲块和由于修整而移出的查询的数量通过的给定值
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Qcache_free_blocks"><code class="literal">Qcache_free_blocks</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Qcache_lowmem_prunes"><code class="literal">Qcache_lowmem_prunes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              状态变量。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果大多数查询都有很大的结果（检查
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Qcache_total_blocks"><code class="literal">Qcache_total_blocks</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Qcache_queries_in_cache"><code class="literal">Qcache_queries_in_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              状态变量），则可以通过增加来提高性能
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，请注意不要太大（请参阅上一个项目）。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-status-and-maintenance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.3.4查询缓存状态和维护</font></font></h4>

</div>

</div>

</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查询缓存从MySQL 5.7.20开始已弃用，并在MySQL 8.0中删除。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要检查查询缓存是否存在于MySQL服务器中，请使用以下语句：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'have_query_cache';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">have_query_cache | </font><font style="vertical-align: inherit;">是|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------ + ------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以对查询缓存进行碎片整理，以更好地利用其内存</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-query-cache"><code class="literal">FLUSH QUERY
          CACHE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该语句不会从缓存中删除任何查询。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">RESET QUERY CACHE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句从查询缓存中删除所有查询结果。</font><font style="vertical-align: inherit;">该
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明也做到这一点。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要监视查询缓存的性能，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-status" title="13.7.5.35 SHOW STATUS语法"><code class="literal">SHOW STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看缓存状态变量：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW STATUS LIKE 'Qcache%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Qcache_free_blocks | </font><font style="vertical-align: inherit;">36 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Qcache_free_memory | </font><font style="vertical-align: inherit;">138488 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Qcache_hits | </font><font style="vertical-align: inherit;">79570 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Qcache_inserts | </font><font style="vertical-align: inherit;">27087 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Qcache_lowmem_prunes | </font><font style="vertical-align: inherit;">3114 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Qcache_not_cached | </font><font style="vertical-align: inherit;">22989 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Qcache_queries_in_cache | </font><font style="vertical-align: inherit;">415 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Qcache_total_blocks | </font><font style="vertical-align: inherit;">912 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------- + -------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.7节“服务器状态变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          中给出了每个变量的描述
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这里描述了它们的一些用途。
        </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询</font><font style="vertical-align: inherit;">
          总数</font><font style="vertical-align: inherit;">由以下公式给出：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  Com_select</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Qcache_hits</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+解析器发现的错误</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">Com_select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值由以下公式给出：
        </font></font></p><pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  Qcache_inserts</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Qcache_not_cached</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+在列特权检查期间发现错误并发现错误</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          查询缓存使用可变长度的块，所以
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Qcache_total_blocks"><code class="literal">Qcache_total_blocks</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Qcache_free_blocks"><code class="literal">Qcache_free_blocks</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可指示查询高速缓冲存储器碎片。</font><font style="vertical-align: inherit;">之后
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-query-cache"><code class="literal">FLUSH QUERY CACHE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只剩下一个空闲块。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          每个缓存查询至少需要两个块（一个用于查询文本，一个用于查询结果）。</font><font style="vertical-align: inherit;">另外，查询使用的每个表都需要一个块。</font><font style="vertical-align: inherit;">但是，如果两个或多个查询使用同一个表，则只需分配一个表块。
        </font></font></p><p><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Qcache_lowmem_prunes"><code class="literal">Qcache_lowmem_prunes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font><font style="vertical-align: inherit;">
          提供的信息
           </font><font style="vertical-align: inherit;">可以帮助您调整查询缓存大小。</font><font style="vertical-align: inherit;">它计算从缓存中删除的查询数量，以释放内存以缓存新查询。</font><font style="vertical-align: inherit;">查询缓存使用最近最少使用（LRU）策略来决定从缓存中删除哪些查询。</font><font style="vertical-align: inherit;">调整信息在
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache-configuration" title="8.10.3.3查询缓存配置"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3.3节“查询缓存配置”中给出</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="statement-caching"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.10.4缓存准备好的语句和存储的程序</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528101291808"></a><a class="indexterm" name="idm140528101290352"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于某个客户端可能在会话期间多次执行的某些语句，服务器将该语句转换为内部结构并缓存该结构以在执行期间使用。</font><font style="vertical-align: inherit;">缓存使服务器能够更有效地执行，因为它避免了在会话期间再次需要时重新转换语句的开销。</font><font style="vertical-align: inherit;">对这些语句进行转换和缓存：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            准备好的语句，既包括在SQL级别处理的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#prepare" title="13.5.1 PREPARE语法"><code class="literal">PREPARE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">（使用</font><font style="vertical-align: inherit;">语句），也包括使用二进制客户机/服务器协议（使用</font></font><a class="link" href="/mysql-5.7-google-zh/connectors-apis.html#mysql-stmt-prepare" title="27.8.11.21 mysql_stmt_prepare（）"><code class="literal">mysql_stmt_prepare()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C API函数）</font><font style="vertical-align: inherit;">处理</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">语句
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所述
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_prepared_stmt_count"><code class="literal">max_prepared_stmt_count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量控制语句的服务器高速缓存的总数量。</font><font style="vertical-align: inherit;">（所有会话中已准备好的语句数量的总和。）
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            存储的程序（存储过程和函数，触发器和事件）。</font><font style="vertical-align: inherit;">在这种情况下，服务器转换并缓存整个程序体。</font><font style="vertical-align: inherit;">该
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_stored_program_cache"><code class="literal">stored_program_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量指示存储的程序每个会话的服务器缓存的大致数量。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器在每个会话的基础上维护准备好的语句和存储程序的高速缓存。</font><font style="vertical-align: inherit;">其他会话无法访问为一个会话缓存的语句。</font><font style="vertical-align: inherit;">当会话结束时，服务器会放弃为其缓存的任何语句。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        当服务器使用缓存的内部语句结构时，必须注意结构不会过时。</font><font style="vertical-align: inherit;">对于语句使用的对象，可能会发生元数据更改，导致当前对象定义与定义之间的不匹配，如内部语句结构中所示。</font><font style="vertical-align: inherit;">DDL语句（如创建，删除，修改，重命名或截断表）或者分析，优化或修复表的DDL语句会发生元数据更改。</font><font style="vertical-align: inherit;">表格内容更改（例如，使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）不会更改元数据，也不会执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这是一个问题的例子。</font><font style="vertical-align: inherit;">假设一个客户准备这个陈述：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从'SELECT * FROM t1'中准备s1;
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在</font></font><code class="literal">SELECT *</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部结构上表中的列的列表展开。</font><font style="vertical-align: inherit;">如果表中的一组列被修改</font></font><code class="literal">ALTER
        TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则准备好的语句将过期。</font><font style="vertical-align: inherit;">如果服务器在下次客户端执行时未检测到此更改</font></font><code class="literal">s1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则准备好的语句将返回不正确的结果。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为避免由准备语句引用的表或视图的元数据更改导致的问题，服务器检测到这些更改并在下一次执行时自动重新声明该语句。</font><font style="vertical-align: inherit;">也就是说，服务器会重新解析语句并重建内部结构。</font><font style="vertical-align: inherit;">在从表定义缓存刷新引用的表或视图后，也会发生重新分析，或者隐式地为缓存中的新条目腾出空间，或者明确地归因于此</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH
        TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        同样，如果存储程序使用的对象发生更改，则服务器会重新解析程序中受影响的语句。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器还检测表达式中对象的元数据更改。</font><font style="vertical-align: inherit;">这些可能会在特定的存储方案，如语句中使用</font></font><code class="literal">DECLARE CURSOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或流量控制语句，如
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#if" title="13.6.5.2 IF语法"><code class="literal">IF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#case" title="13.6.5.1 CASE语法"><code class="literal">CASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#return" title="13.6.5.7 RETURN语法"><code class="literal">RETURN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为避免重新分析整个存储的程序，服务器仅在需要时才在程序中重新分析受影响的语句或表达式。</font><font style="vertical-align: inherit;">例子：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            假设表或视图的元数据已更改。</font></font><code class="literal">SELECT *</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在访问表或视图的程序中</font><font style="vertical-align: inherit;">发生重新解析</font><font style="vertical-align: inherit;">，但
             </font></font><code class="literal">SELECT *</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会访问不访问表或视图的程序。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当语句受到影响时，服务器只在可能的情况下部分解析它。</font><font style="vertical-align: inherit;">考虑这个
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#case" title="13.6.5.1 CASE语法"><code class="literal">CASE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说法：
          </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CASE </font></font><em class="replaceable"><code>case_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHEN </font></font><em class="replaceable"><code>when_expr1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  什么时候</font></font><em class="replaceable"><code>when_expr2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  什么时候</font></font><em class="replaceable"><code>when_expr3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
END CASE</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果元数据更改仅影响</font><font style="vertical-align: inherit;">该表达式，则会重新进行该表达式。</font><font style="vertical-align: inherit;">
            其他</font><font style="vertical-align: inherit;">表达式不会被重新解析。
</font></font><code class="literal">WHEN
            <em class="replaceable"><code>when_expr3</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>case_expr</code></em><font style="vertical-align: inherit;"></font><code class="literal">WHEN</code><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        重新分析使用原始转换为内部表单的默认数据库和SQL模式。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器尝试重新分析最多三次。</font><font style="vertical-align: inherit;">如果所有尝试失败都会发生错误。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        重新分析是自动的，但在发生时会减少准备好的语句和存储的程序性能。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于准备好的语句，
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Com_xxx"><code class="literal">Com_stmt_reprepare</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        状态变量会跟踪重新生成的次数。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="locking-issues"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11优化锁定操作</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#internal-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.1内部锁定方法</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#table-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.2表锁定问题</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#concurrent-inserts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.3并发插入</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#metadata-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.4元数据锁定</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#external-locking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.5外部锁定</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      MySQL使用</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_locking" title="锁定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理对表内容的争用
       </font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          内部锁定在MySQL服务器内部执行，以管理多个线程对表内容的争用。</font><font style="vertical-align: inherit;">这种类型的锁定是内部的，因为它完全由服务器执行并且不涉及其他程序。</font><font style="vertical-align: inherit;">参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-locking" title="8.11.1内部锁定方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.1节“内部锁定方法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当服务器和其他程序锁定</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表文件以相互协调哪个程序可以访问表时，</font><font style="vertical-align: inherit;">发生外部锁定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#external-locking" title="8.11.5外部锁定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.5节“外部锁定”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="internal-locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.1内部锁定方法</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528101239168"></a><a class="indexterm" name="idm140528101238128"></a><a class="indexterm" name="idm140528101236640"></a><a class="indexterm" name="idm140528101235568"></a><a class="indexterm" name="idm140528101234080"></a><a class="indexterm" name="idm140528101233008"></a><a class="indexterm" name="idm140528101231936"></a><a class="indexterm" name="idm140528101230448"></a><a class="indexterm" name="idm140528101228960"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        本节讨论内部锁定; </font><font style="vertical-align: inherit;">即在MySQL服务器本身内执行锁定以管理多个会话对表内容的争用。</font><font style="vertical-align: inherit;">这种类型的锁定是内部的，因为它完全由服务器执行并且不涉及其他程序。</font><font style="vertical-align: inherit;">对于其他程序在MySQL文件上执行的锁定，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#external-locking" title="8.11.5外部锁定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.5节“外部锁定”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-row-level-locking" title="行级锁定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行级锁定</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-table-level-locking" title="表级锁定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表级锁定</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-locking-choices" title="选择锁定类型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择锁定类型</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="internal-row-level-locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行级锁定</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL使用</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_row_lock" title="行锁"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行级锁定</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，以支持由多个会话并发写入权限，使其适用于多用户，高并发，和OLTP应用程序。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了避免</font><font style="vertical-align: inherit;">在单个</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">上执行多个并发写入操作时</font><font style="vertical-align: inherit;">发生</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_deadlock" title="僵局"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">死锁</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code class="literal">SELECT ...
          FOR UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每组预计要修改的行</font><font style="vertical-align: inherit;">发布</font><font style="vertical-align: inherit;">语句，即使数据更改语句稍后进入事务，也可以</font><font style="vertical-align: inherit;">在事务启动时获取必要的锁</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果交易修改或锁定多个表，请在每个交易中以相同的顺序发布适用的报表。</font><font style="vertical-align: inherit;">死锁会影响性能而不是表示严重的错误，因为它会
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动
           </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_deadlock_detection" title="死锁检测"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          死锁条件并回滚其中一个受影响的事务。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在高并发系统上，当大量线程等待相同的锁时，死锁检测会导致速度下降。</font><font style="vertical-align: inherit;">有时候，</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当死锁发生时</font><font style="vertical-align: inherit;">，禁用死锁检测并依赖</font><font style="vertical-align: inherit;">事务回滚</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">可能更有效
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_deadlock_detect"><code class="literal">innodb_deadlock_detect</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          配置选项</font><font style="vertical-align: inherit;">可以禁用死锁检测
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          行级锁定的优点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当不同的会话访问不同的行时，更少的锁冲突。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              回滚的更改更少。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              可能长时间锁定一行。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="internal-table-level-locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表级锁定</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL使用</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_table_lock" title="表锁"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表级锁</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表，只允许一个会话更新一次这些表。</font><font style="vertical-align: inherit;">这种锁定级别使得这些存储引擎更适合于只读，主要读取或单用户应用程序。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些存储引擎</font><font style="vertical-align: inherit;">通过始终在查询开始时一次请求所有需要的锁，并始终以相同的顺序锁定表来</font><font style="vertical-align: inherit;">避免
           </font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_deadlock" title="僵局"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">死锁</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">权衡是这种策略降低了并发性; </font><font style="vertical-align: inherit;">其他要修改表的会话必须等到当前数据更改语句结束。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表级锁定的优点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所需的内存相对较少（行锁定需要锁定每行或一组行的内存）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在大部分表格上使用时都很快，因为只涉及一个锁。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您经常</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对大部分数据</font><font style="vertical-align: inherit;">执行</font><font style="vertical-align: inherit;">操作，或者必须频繁扫描整个表，则速度很快。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL授予表写入锁定如下：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果表上没有锁，请在其上写入锁。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              否则，将锁定请求放入写入锁定队列中。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL授予表读取锁定如下：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果表上没有写入锁，请在其上放置读取锁。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              否则，将锁定请求放入读锁定队列中。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表格更新优先于表格检索。</font><font style="vertical-align: inherit;">因此，当释放一个锁时，该锁可用于写入锁定队列中的请求，然后可用于读取锁定队列中的请求。</font><font style="vertical-align: inherit;">这确保了</font><font style="vertical-align: inherit;">即使</font><font style="vertical-align: inherit;">桌子上</font><font style="vertical-align: inherit;">有大量</font><font style="vertical-align: inherit;">活动</font><font style="vertical-align: inherit;">时，</font><font style="vertical-align: inherit;">表格的更新也不会</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">饿死</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，如果有多个表的更新，则
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句会等待，直到没有更新。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          有关更改读取和写入优先级的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#table-locking" title="8.11.2表锁定问题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.2节“表锁定问题”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以通过检查</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Table_locks_immediate"><code class="literal">Table_locks_immediate</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Table_locks_waited"><code class="literal">Table_locks_waited</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量</font><font style="vertical-align: inherit;">来分析系统上的表锁争用
           </font><font style="vertical-align: inherit;">，这些变量分别表示可以立即授予表锁请求的次数和需要等待的数量：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW STATUS LIKE 'Table%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">变量名| </font><font style="vertical-align: inherit;">值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Table_locks_immediate | </font><font style="vertical-align: inherit;">1151552 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Table_locks_waited | </font><font style="vertical-align: inherit;">15324 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + --------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          性能模式锁定表还提供锁定信息。</font><font style="vertical-align: inherit;">请参见
           </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-lock-tables" title="25.11.12性能模式锁定表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.12节“性能架构锁表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><a class="indexterm" name="idm140528101179008"></a><a class="indexterm" name="idm140528101177936"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎支持并发插入，减少读者和作者之间的竞争给定表：如果一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表有数据文件的中间没有空闲块，行总是在数据文件的末尾插入。</font><font style="vertical-align: inherit;">在这种情况下，您可以自由地将</font><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">并发</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句
           </font><font style="vertical-align: inherit;">混合使用
           </font><font style="vertical-align: inherit;">，
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而无需锁定。</font><font style="vertical-align: inherit;">也就是说，你可以插入行到一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表同时其他客户正在阅读它。</font><font style="vertical-align: inherit;">在表中间删除或更新的行可能会产生空洞。</font><font style="vertical-align: inherit;">如果存在孔，则同时插入将被禁用，但当所有孔已填充新数据时将自动再次启用插入。</font><font style="vertical-align: inherit;">要控制此行为，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#concurrent-inserts" title="8.11.3并发插入"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.3节“并发插入”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您显式获取表锁
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以请求
           </font></font><code class="literal">READ LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁而不是
           </font></font><code class="literal">READ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁，以使其他会话在表锁定的情况下执行并发插入。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          执行许多</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作上的表
           </font></font><code class="literal">t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时并发的插入是不可能的，你可以插入行到一个临时表
           </font></font><code class="literal">temp_t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并从临时表中的行更新真正的表：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>LOCK TABLES t1 WRITE, temp_t1 WRITE;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO t1 SELECT * FROM temp_t1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>DELETE FROM temp_t1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="internal-locking-choices"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择锁定类型</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          通常，在以下情况下，表锁优于行级锁：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该表的大多数语句都是读取。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              该表的声明是读取和写入的混合，其中写入是对单个行的更新或删除，可以通过一次读取读取该行：
            </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET </font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>unique_key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>key_value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DELETE FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>unique_key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>key_value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre></li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结合并发</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句，并且很少
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              许多扫描或</font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整个表上的操作，没有任何作家。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于更高级别的锁定，您可以通过支持不同类型的锁定来更轻松地调整应用程序，因为锁定开销低于行级锁定。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          行级锁定以外的选项：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              版本控制（例如在MySQL中用于并发插入的版本），可以在多个读者的同一时间拥有一个作者。</font><font style="vertical-align: inherit;">这意味着根据访问何时开始，数据库或表支持不同数据视图。</font><font style="vertical-align: inherit;">这个其他常见的术语是
               </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间旅行</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span> <span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">” “ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上写副本</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
              或</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按需复制。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></span>
            </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在许多情况下，按需复制优于行级锁定。</font><font style="vertical-align: inherit;">但是，在最坏的情况下，它可以使用比使用普通锁更多的内存。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              而不是使用行级锁，你可以使用应用程序级锁，如提供的
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL。</font><font style="vertical-align: inherit;">这些是咨询锁，因此它们只能与相互合作的应用程序一起工作。</font><font style="vertical-align: inherit;">参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/functions.html#miscellaneous-functions" title="12.20杂项功能"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.20节“其他功能”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="table-locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.2表锁定问题</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528101130368"></a><p>
        <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表使用行级锁定，以便多个会话和应用程序可以同时读取和写入同一个表，而不会让对方等待或产生不一致的结果。</font><font style="vertical-align: inherit;">对于这个存储引擎，避免使用该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，因为它没有提供任何额外的保护，而是降低了并发性。</font><font style="vertical-align: inherit;">自动的行级锁定使得这些表适用于最繁忙的数据库和最重要的数据，同时还可以简化应用程序逻辑，因为您无需锁定和解锁表格。</font><font style="vertical-align: inherit;">因此，
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎是MySQL中的默认设置。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL除了为所有存储引擎使用表锁（而不是页锁，行锁或列锁）
         </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">锁定操作本身没有太多的开销。</font><font style="vertical-align: inherit;">但是，因为只有一个会话可以同时写入表中，为了获得其他存储引擎的最佳性能，请将其主要用于经常查询且很少插入或更新的表。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#table-locking-innodb" title="性能考虑因素支持InnoDB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能考虑因素支持InnoDB</font></font></a></p></li><li class="listitem"><p><a class="xref" href="/mysql-5.7-google-zh/optimization.html#table-locking-workarounds" title="锁定性能问题的解决方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定性能问题的解决方法</font></font></a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="table-locking-innodb"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能考虑因素支持InnoDB</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在选择是使用</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或不同的存储引擎</font><font style="vertical-align: inherit;">创建表时
           </font><font style="vertical-align: inherit;">，请记住表锁定的以下缺点：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              表锁定使许多会话可以同时从表中读取数据，但是如果会话要写入表中，它必须首先获得独占访问权，这意味着它可能必须先等待其他会话完成表。</font><font style="vertical-align: inherit;">在更新期间，想要访问此特定表的所有其他会话必须等到更新完成。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当会话正在等待时，表锁定会导致问题，因为磁盘已满并且在会话可继续之前需要有空闲空间。</font><font style="vertical-align: inherit;">在这种情况下，所有希望访问问题表的会话也会处于等待状态，直到有更多磁盘空间可用。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是需要长时间运行的语句防止其他会话更新表的同时，使其他场次出现缓慢或无响应。</font><font style="vertical-align: inherit;">虽然会话正在等待独占访问表以进行更新，但发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的</font><font style="vertical-align: inherit;">其他会话
               </font><font style="vertical-align: inherit;">将排在其后面，即使对于只读会话也会降低并发性。
</font></font></p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="table-locking-workarounds"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定性能问题的解决方法</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下各项介绍了一些避免或减少表锁定引起的争用的方法：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              考虑将表切换到
               </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎，无论是
               </font></font><code class="literal">CREATE TABLE ... ENGINE=INNODB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在安装期间使用，还是使用</font></font><code class="literal">ALTER TABLE ...
              ENGINE=INNODB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现有的表。</font><font style="vertical-align: inherit;">有关</font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><i><font style="vertical-align: inherit;">此存储引擎</font></i></a><font style="vertical-align: inherit;">的更多详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
               </font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><font style="vertical-align: inherit;">第14章，</font></a><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><i><font style="vertical-align: inherit;">InnoDB</font></i></a><font style="vertical-align: inherit;">存储引擎。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              优化</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句以加快运行速度，以便锁定表的时间更短。</font><font style="vertical-align: inherit;">您可能需要创建一些汇总表来执行此操作。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_low-priority-updates"><code class="option">--low-priority-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于仅使用表级锁（如存储引擎
               </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">MERGE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），这给所有的语句更新（修改），比表低优先级
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的语句。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              前面的场景中</font><font style="vertical-align: inherit;">的第二个</font><font style="vertical-align: inherit;">语句将在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">之前执行</font><font style="vertical-align: inherit;">，并且不会等待第一个语句
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要指定在特定连接中发出的所有更新应以低优先级完成，请将</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_low_priority_updates"><code class="literal">low_priority_updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器系统变量</font><font style="vertical-align: inherit;">设置
               </font><font style="vertical-align: inherit;">为1。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要给出特定的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句较低的优先级，请使用该</font></font><code class="literal">LOW_PRIORITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              属性。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要给出特定的</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              声明更高的优先级，请使用该
               </font></font><code class="literal">HIGH_PRIORITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.9节“SELECT语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以</font><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">的较低值</font><font style="vertical-align: inherit;">
              启动</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_write_lock_count"><code class="literal">max_write_lock_count</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以强制MySQL临时提升</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在发生特定数量的表插入后等待表</font><font style="vertical-align: inherit;">的所有</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的优先级</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这允许
               </font></font><code class="literal">READ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在一定数量的锁定之后进行
               </font></font><code class="literal">WRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              

              如果你有问题
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联合
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可考虑改用</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，它支持并发</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报表。</font><font style="vertical-align: inherit;">（参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#concurrent-inserts" title="8.11.3并发插入"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.3节“并发插入”）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果你有问题，混合
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报表，该
               </font></font><code class="literal">LIMIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会有帮助。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.2节“删除语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              使用</font></font><code class="literal">SQL_BUFFER_RESULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句可以帮助缩短表锁的持续时间。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.2.9节“SELECT语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过允许查询针对一个表中的列运行，而将更新限制在不同表中的列中，将表内容拆分为单独的表格可能会有所帮助。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您可以将锁定代码更改
               </font></font><code class="filename">mysys/thr_lock.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为使用单个队列。</font><font style="vertical-align: inherit;">在这种情况下，写入锁和读取锁具有相同的优先级，这可能有助于某些应用程序。
</font></font></p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="concurrent-inserts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.3并发插入</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528101054704"></a><a class="indexterm" name="idm140528101053632"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        该</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储引擎支持并发插入，减少读者和作者之间的竞争给定表：如果一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表已经在数据文件中没有孔（中删除的行），一个
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句可以执行行添加到表的末尾同时
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句正在读取表格中的行。</font><font style="vertical-align: inherit;">如果有多个
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，它们将按照顺序排列并执行，并与</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">同时执行
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">并发的结果</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能不会立即显示。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        所述</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量可以被设置为修改并发插入处理。</font><font style="vertical-align: inherit;">默认情况下，该变量设置为</font></font><code class="literal">AUTO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或1），并按前面所述处理并发插入。</font><font style="vertical-align: inherit;">如果
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为
         </font></font><code class="literal">NEVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或0），则禁用并发插入。</font><font style="vertical-align: inherit;">如果变量设置为</font></font><code class="literal">ALWAYS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （或2），即使对于已删除行的表，也允许在表的末尾进行并发插入。</font><font style="vertical-align: inherit;">另请参阅</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的说明</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您正在使用二进制日志，并发插入将转换为正常的插入</font></font><code class="literal">CREATE ...
        SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT语法"><code class="literal">INSERT ...
        SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">这样做是为了确保您可以通过在备份操作期间应用日志来重新创建表的精确副本。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#binary-log" title="5.4.4二进制日志"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另外，对于这些语句，在选定表上放置一个读锁，以便阻止插入到该表中。</font><font style="vertical-align: inherit;">结果是该表的并发插入必须等待。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        有了</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
        INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果你指定</font></font><code class="literal">CONCURRENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">满足并发插入的状态表（即，它包含在中间没有空闲块），其他会话可以从表中检索数据时</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在执行。</font><font style="vertical-align: inherit;">即使没有其他会话同时使用该表</font><font style="vertical-align: inherit;">，该</font></font><code class="literal">CONCURRENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项的</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD
        DATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也会</font><font style="vertical-align: inherit;">影响</font><font style="vertical-align: inherit;">一个位</font><font style="vertical-align: inherit;">的性能</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果指定</font></font><code class="literal">HIGH_PRIORITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则会覆盖该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_low-priority-updates"><code class="option">--low-priority-updates</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">的效果（
         </font><font style="vertical-align: inherit;">如果服务器是使用该选项启动的）。</font><font style="vertical-align: inherit;">这也会导致并发插入不被使用。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，之间的差</font></font><code class="literal">READ
        LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="literal">READ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是
         </font></font><code class="literal">READ LOCAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许非冲突性的
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句（并发插入），而锁被保持来执行。</font><font style="vertical-align: inherit;">但是，如果要在持有锁的同时使用服务器外部的进程来操作数据库，则无法使用此功能。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="metadata-locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.4元数据锁定</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528101017920"></a><a class="indexterm" name="idm140528101016432"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        MySQL使用元数据锁定来管理对数据库对象的并发访问并确保数据一致性。</font><font style="vertical-align: inherit;">元数据锁定不仅适用于表格，还适用于架构，存储的程序（过程，函数，触发器和预定事件）以及表空间。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        元数据锁定确实涉及一些开销，随着查询量的增加而增加。</font><font style="vertical-align: inherit;">元数据争用增加了多个查询尝试访问相同对象的次数越多。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        元数据锁定不是表格定义缓存的替代，其互斥锁和锁定与互斥锁不同
         </font></font><code class="literal">LOCK_open</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下讨论提供了有关元数据锁定工作原理的一些信息。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为确保事务可序列化，服务器不得允许一个会话在另一个会话的未完成显式或隐式启动事务中使用的表上执行数据定义语言（DDL）语句。</font><font style="vertical-align: inherit;">服务器通过获取事务内使用的表上的元数据锁，并推迟释放这些锁，直到事务结束为止。</font><font style="vertical-align: inherit;">表上的元数据锁可以防止对表的结构进行更改。</font><font style="vertical-align: inherit;">这种锁定方式意味着一个会话中的事务正在使用的表不能在其他会话的DDL语句中使用，直到事务结束。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这个原则不仅适用于事务表，也适用于非事务表。</font><font style="vertical-align: inherit;">假设一个会话开始一个使用事务表</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        和非</font><font style="vertical-align: inherit;">事务表的</font><font style="vertical-align: inherit;">事务</font></font><code class="literal">nt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始交易;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM nt;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        服务器在两端都保存了元数据锁</font></font><code class="literal">t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
         </font></font><code class="literal">nt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直到事务结束。</font><font style="vertical-align: inherit;">如果另一个会话尝试对任一表执行DDL或写入锁定操作，则会阻塞，直到事务结束时释放元数据锁。</font><font style="vertical-align: inherit;">例如，如果第二个会话尝试执行以下任何操作，则会阻止：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP TABLE t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE t ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP TABLE nt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE nt ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LOCK TABLE t ... WRITE;</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        The相同的行为适用于The
         </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK TABLES ...
        READ</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，更新任何表（事务性或非事务性）的显式或隐式启动事务将被阻塞并被</font></font><code class="literal">LOCK
        TABLES ... READ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该表</font><font style="vertical-align: inherit;">阻塞</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果服务器为语句有效但在执行期间失败的语句获取元数据锁，则它不会提前释放锁。</font><font style="vertical-align: inherit;">锁释放仍然延迟到事务结束，因为失败的语句被写入二进制日志，并且锁保护日志一致性。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在自动提交模式下，每条语句实际上是一个完整的事务，因此为语句获取的元数据锁只保留在语句的末尾。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#prepare" title="13.5.1 PREPARE语法"><code class="literal">PREPARE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备好声明后，即使在多语句事务中进行准备，也会释放</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">声明中</font><font style="vertical-align: inherit;">获取的元数据锁定
         </font><font style="vertical-align: inherit;">。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="external-locking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.11.5外部锁定</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100998048"></a><a class="indexterm" name="idm140528100996976"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        外部锁定是使用文件系统锁定来管理</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个进程</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">数据库表的</font><font style="vertical-align: inherit;">争用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">外部锁定用于单个进程（如MySQL服务器）不能被认为是唯一需要访问表的进程的情况。</font><font style="vertical-align: inherit;">这里有些例子：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果运行多个使用相同数据库目录的服务器（不推荐），则每台服务器都必须启用外部锁定。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表上执行表维护操作
             </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则必须确保服务器未运行，或者服务器启用了外部锁定，以便根据需要锁定表文件以与</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协调</font><font style="vertical-align: inherit;">
            访问表。</font><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打包
             </font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">也是如此
             </font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果服务器在启用外部锁定的情况下运行，则可以随时使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行读取操作，例如检查表。</font><font style="vertical-align: inherit;">在这种情况下，如果服务器尝试更新</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在使用</font><font style="vertical-align: inherit;">的表，
             </font><font style="vertical-align: inherit;">服务器将</font><font style="vertical-align: inherit;">在继续之前</font><font style="vertical-align: inherit;">等待</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行写入操作（例如修复或优化表），或者如果使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisampack" title="4.6.5 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisampack</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打包表，则
             </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终确保
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器未使用表。</font><font style="vertical-align: inherit;">如果您不停止</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，至少
             </font><font style="vertical-align: inherit;">在运行</font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><font style="vertical-align: inherit;">之前执行
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-tables</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果服务器和
             </font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><font style="vertical-align: inherit;">同时访问表，</font><font style="vertical-align: inherit;">您的表</font><span class="emphasis"><em><font style="vertical-align: inherit;">可能会损坏</font></em></span><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font><span class="emphasis"><em><font style="vertical-align: inherit;"></font></em></span><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在外部锁定生效的情况下，每个需要访问表的进程在继续访问表之前都会获取表文件的文件系统锁。</font><font style="vertical-align: inherit;">如果无法获取所有必需的锁，则会阻止该进程访问表，直到获得锁（在当前持有锁的进程释放它们之后）。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        外部锁定会影响服务器性能，因为服务器在访问表之前必须等待其他进程。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果您运行单个服务器来访问给定的数据目录（通常情况下），</font><font style="vertical-align: inherit;">并且在服务器运行</font><font style="vertical-align: inherit;">时没有其他程序（如</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk）</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要修改表，</font><font style="vertical-align: inherit;">则不需要外部锁定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果只
         </font><font style="vertical-align: inherit;">使用其他程序</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，则不需要外部锁定，尽管</font><font style="vertical-align: inherit;">
        如果服务器在</font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;">myisamchk</font></strong></span></a><font style="vertical-align: inherit;">正在读取</font><font style="vertical-align: inherit;">表格时更改表</font><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会报告警告
         </font><font style="vertical-align: inherit;">。
      </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        在禁用外部锁定的情况下，要使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，必须在</font><font style="vertical-align: inherit;">执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk时</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止服务器，</font><font style="vertical-align: inherit;">否则在运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前锁定并刷新表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#system-optimization" title="8.12.1系统因素"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.12.1节“系统因素”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）为避免此要求，请使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE语法"><code class="literal">CHECK TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        和</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句来检查和修复</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，外部锁定由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_skip_external_locking"><code class="literal">skip_external_locking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值控制
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当这个变量被启用时，外部锁定被禁用，反之亦然。</font><font style="vertical-align: inherit;">外部锁定默认是禁用的。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_external-locking"><code class="option">--skip-external-locking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        选项</font><font style="vertical-align: inherit;">可以在服务器启动时控制使用外部锁定</font><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        如果确实使用外部锁定选项来启用对</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自多个MySQL进程的表的</font><font style="vertical-align: inherit;">更新
         </font><font style="vertical-align: inherit;">，则必须确保满足以下条件：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不要将查询缓存用于使用另一个进程更新的表的查询。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            不要使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=ALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器，
             </font><font style="vertical-align: inherit;">或</font></font><code class="literal">DELAY_KEY_WRITE=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对任何共享表</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">表选项。</font><font style="vertical-align: inherit;">否则，可能会发生索引损坏。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        满足这些条件的最简单方法是始终
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=OFF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
         </font><font style="vertical-align: inherit;">一起使用
         </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_query_cache_size"><code class="option">--query-cache-size=0</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这不是默认完成的，因为在许多设置中，混合使用上述选项很有用。）
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-server"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12优化MySQL服务器</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#system-optimization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.1系统因素</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#disk-issues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.2优化磁盘I / O</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#symbolic-links"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3使用符号链接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-memory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.4优化内存使用</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#optimizing-network"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.5优化网络使用</font></font></a></span></dt></dl>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节讨论数据库服务器的优化技术，主要处理系统配置而不是调整SQL语句。</font><font style="vertical-align: inherit;">本节中的信息适用于希望确保他们管理的服务器之间的性能和可扩展性的DBA; </font><font style="vertical-align: inherit;">对于构建包括设置数据库的安装脚本的开发人员; </font><font style="vertical-align: inherit;">以及那些希望最大限度提高自身生产力的开发，测试等人员自己运行MySQL。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="system-optimization"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.1系统因素</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528100936832"></a><a class="indexterm" name="idm140528100935344"></a><a class="indexterm" name="idm140528100934272"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        一些系统级因素可能会以主要方式影响性能：
</font></font></p><a class="indexterm" name="idm140528100932304"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您有足够的RAM，则可以移除所有交换设备。</font><font style="vertical-align: inherit;">某些操作系统在某些情况下使用交换设备，即使您拥有可用内存。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            避免对</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格进行</font><font style="vertical-align: inherit;">外部锁定
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认值是禁用外部锁定。</font><font style="vertical-align: inherit;">在
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_external-locking"><code class="option">--skip-external-locking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项明确地启用和禁用外部锁定。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            只要您只运行一台服务器，禁用外部锁定不会影响MySQL的功能。</font><font style="vertical-align: inherit;">请记住在运行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前取下服务器（或者锁定并冲洗相关表格）
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在某些系统中，强制禁用外部锁定是因为它无法工作。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            唯一不能禁用外部锁定的情况是在</font><font style="vertical-align: inherit;">
            同一数据上</font><font style="vertical-align: inherit;">运行多个MySQL </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不是客户端），或者如果您运行
             </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查（而不是修复）表而不告知服务器先刷新并锁定表。</font><font style="vertical-align: inherit;">请注意</font><font style="vertical-align: inherit;">
            ，除了使用NDB群集时，</font><font style="vertical-align: inherit;">通常</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议</font><font style="vertical-align: inherit;">使用多个MySQL服务器同时访问相同的数据</font><font style="vertical-align: inherit;">。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">UNLOCK
            TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句使用内部锁定，所以你可以使用他们，即使外部锁定被禁用。
</font></font></p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="disk-issues"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.2优化磁盘I / O</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100916608"></a><a class="indexterm" name="idm140528100915536"></a><a class="indexterm" name="idm140528100914048"></a>
<div class="itemizedlist">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          本节介绍如何在您将更多更快的存储硬件投入数据库服务器时配置存储设备。</font><font style="vertical-align: inherit;">有关优化
           </font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置以提高I / O性能的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-diskio" title="8.5.8优化InnoDB磁盘I / O"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.5.8节“优化InnoDB磁盘I / O”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            磁盘寻求是一个巨大的性能瓶颈。</font><font style="vertical-align: inherit;">当数据量开始变得如此之大以至于不能有效缓存时，这个问题就会变得更加明显。</font><font style="vertical-align: inherit;">对于您可以随意访问数据的大型数据库，您可以确保至少需要一次磁盘查找以及一些磁盘写入操作。</font><font style="vertical-align: inherit;">为了尽量减少这个问题，请使用低寻道时间的磁盘。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            通过将文件符号链接到不同的磁盘或剥离磁盘来增加可用磁盘主轴的数量（从而减少查找开销）：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                使用符号链接
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                这意味着，对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，您将索引文件和数据文件从它们在数据目录中的常用位置符号链接到另一个磁盘（也可能是条带化的）。</font><font style="vertical-align: inherit;">这使得查找和读取时间更好，假设磁盘也不用于其他目的。</font><font style="vertical-align: inherit;">参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#symbolic-links" title="8.12.3使用符号链接"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.12.3节“使用符号链接”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                符号链接不支持与</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">一起使用
                 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，可以将</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据和日志文件放置在不同的物理磁盘上。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#optimizing-innodb-diskio" title="8.5.8优化InnoDB磁盘I / O"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.5.8节“优化InnoDB磁盘I / O”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p></li><li class="listitem"><p>
                <a class="indexterm" name="idm140528100901200"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

                条带化
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                条带化意味着您有许多磁盘，并将第一个磁盘块，第二个磁盘上的第二个磁盘</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块和（</font><font style="vertical-align: inherit;">）磁盘</font><font style="vertical-align: inherit;">上的第 - 个</font><font style="vertical-align: inherit;">磁盘</font><font style="vertical-align: inherit;">块</font><font style="vertical-align: inherit;">，依此类推。</font><font style="vertical-align: inherit;">这意味着如果您的正常数据大小小于条带大小（或完全对齐），则可以获得更好的性能。</font><font style="vertical-align: inherit;">分条非常依赖操作系统和条带大小，因此可以用不同的条带大小对应用程序进行基准测试。</font><font style="vertical-align: inherit;">参见</font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#custom-benchmarks" title="8.13.2使用你自己的基准"><font style="vertical-align: inherit;">第8.13.2节“使用自己的基准”</font></a><font style="vertical-align: inherit;">。
              </font></font><code class="literal"><em class="replaceable"><code>N</code></em> MOD
                <em class="replaceable"><code>number_of_disks</code></em></code><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#custom-benchmarks" title="8.13.2使用你自己的基准"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                对于分拆的速度差是
                 </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依赖的参数。</font><font style="vertical-align: inherit;">根据您设置条带参数和磁盘数量的方式，您可能会得到数量级差异。</font><font style="vertical-align: inherit;">您必须选择针对随机或顺序访问进行优化。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            为了保证可靠性，您可能需要使用RAID 0 + 1（分条加镜像），但在这种情况下，您需要2个
             </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器来保存
             </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据驱动器。</font><font style="vertical-align: inherit;">如果你有钱，这可能是最好的选择。</font><font style="vertical-align: inherit;">但是，您可能还需要投资一些卷管理软件来有效处理它。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            一个好的选择是根据数据类型的重要性来改变RAID级别。</font><font style="vertical-align: inherit;">例如，存储可在RAID 0磁盘上重新生成的半重要数据，但存储真正重要的数据，如主机信息和日志记录在RAID 0 + 1或RAID
             </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘上。</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于更新奇偶校验位所需的时间，如果您有很多写操作，则</font><font style="vertical-align: inherit;">RAID
             </font><font style="vertical-align: inherit;">可能会成为问题。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您还可以设置数据库使用的文件系统的参数：
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果您不需要知道上次访问文件的时间（这在数据库服务器上并不真正有用），则可以使用该</font></font><code class="option">-o noatime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">安装文件系统</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这会跳过对文件系统inode中最后一次访问时间的更新，从而避免一些磁盘搜索。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            在许多操作系统上，可以通过将该</font></font><code class="option">-o
            async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">挂载来将文件系统设置为异步更新</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您的计算机相当稳定，这应该可以提供更好的性能而不会牺牲太多的可靠性。</font><font style="vertical-align: inherit;">（这个标志在Linux上默认打开。）
</font></font></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="disk-issues-nfs"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL中使用NFS</font></font></h4>

</div>

</div>

</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          建议在考虑使用NFS与MySQL时谨慎。</font><font style="vertical-align: inherit;">潜在问题因操作系统和NFS版本而异，其中包括：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              放置在NFS卷上的MySQL数据和日志文件被锁定并无法使用。</font><font style="vertical-align: inherit;">例如，如果多个MySQL实例访问相同的数据目录，或由于停电等原因导致MySQL不正确关闭，则可能会出现锁定问题。</font><font style="vertical-align: inherit;">NFS版本4通过引入基于咨询和基于租约的锁定来解决潜在的锁定问题。</font><font style="vertical-align: inherit;">但是，不建议在MySQL实例中共享数据目录。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              由于收到的消息乱序或网络流量丢失而​​导致数据不一致。</font><font style="vertical-align: inherit;">要避免此问题，请使用TCP </font></font><code class="literal">hard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">intr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装选项。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              最大文件大小限制。</font><font style="vertical-align: inherit;">NFS版本2客户端只能访问文件的最低2GB（带符号32位偏移量）。</font><font style="vertical-align: inherit;">NFS版本3客户端支持较大的文件（最多64位偏移量）。</font><font style="vertical-align: inherit;">支持的最大文件大小还取决于NFS服务器的本地文件系统。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在专业SAN环境或其他存储系统中使用NFS往往比在这种环境之外使用NFS提供更高的可靠性。</font><font style="vertical-align: inherit;">但是，SAN环境中的NFS可能比直接连接或总线连接的非循环存储要慢。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您选择使用NFS，建议使用NFS版本4或更高版本，与在部署到生产环境之前彻底测试NFS设置一样。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="symbolic-links"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3使用符号链接</font></font></h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#symbolic-links-to-databases"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3.1在Unix上使用数据库的符号链接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#symbolic-links-to-tables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3.2在Unix上使用MyISAM表的符号链接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#windows-symbolic-links"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3.3在Windows上使用数据库的符号链接</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528100877312"></a><a class="indexterm" name="idm140528100876240"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以将数据库或表从数据库目录移动到其他位置，并用符号链接替换它们到新的位置。</font><font style="vertical-align: inherit;">例如，您可能希望这样做，即将数据库移动到具有更多可用空间的文件系统，或者通过将表分布到不同的磁盘来提高系统的速度。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，请使用</font><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">的</font></font><code class="literal">DATA
        DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE
        TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是符号链接，如</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#tablespace-placing" title="14.7.5在数据目录之外创建文件每表的表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.7.5节“在数据目录之外创建文件 - 表 - 表空间”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这项新功能是支持的跨平台技术。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        推荐的方法是将整个数据库目录符号链接到不同的磁盘。</font><font style="vertical-align: inherit;">符号链接
         </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表仅作为最后的手段。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要确定数据目录的位置，请使用以下语句：
      </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW VARIABLES LIKE'datadir';
</font></font></pre>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="symbolic-links-to-databases"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3.1在Unix上使用数据库的符号链接</font></font></h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140528100866144"></a><a class="indexterm" name="idm140528100864656"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Unix上，符号链接数据库的方式首先是在有空闲空间的磁盘上创建一个目录，然后从MySQL数据目录创建一个到它的软链接。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mkdir /dr1/databases/test</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>ln -s /dr1/databases/test <em class="replaceable"><code>/path/to/datadir</code></em></code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL不支持将一个目录链接到多个数据库。</font><font style="vertical-align: inherit;">只要不在数据库之间建立符号链接，用符号链接替换数据库目录就可以工作。</font><font style="vertical-align: inherit;">假设您</font></font><code class="literal">db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL数据目录下</font><font style="vertical-align: inherit;">有一个数据库
           </font><font style="vertical-align: inherit;">，然后创建一个符号链接</font></font><code class="literal">db2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向
           </font></font><code class="literal">db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>cd <em class="replaceable"><code>/path/to/datadir</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>ln -s db1 db2</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          其结果是，对于任何表</font></font><code class="literal">tbl_a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中
           </font></font><code class="literal">db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，也似乎是一个表
           </font></font><code class="literal">tbl_a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font></font><code class="literal">db2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果一个客户端更新</font></font><code class="literal">db1.tbl_a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且另一个客户端更新</font></font><code class="literal">db2.tbl_a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则可能出现问题。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="symbolic-links-to-tables"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3.2在Unix上使用MyISAM表的符号链接</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100848336"></a><a class="indexterm" name="idm140528100846848"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          符号链接仅完全支持
           </font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格。</font><font style="vertical-align: inherit;">对于其他存储引擎的表使用的文件，如果尝试使用符号链接，则可能会遇到奇怪的问题。</font><font style="vertical-align: inherit;">对于</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，请使用
           </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#tablespace-placing" title="14.7.5在数据目录之外创建文件每表的表空间"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.7.5节“在数据目录之外创建文件 - 表 - 表空间”中介绍的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替代技术。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          不要在没有完全可操作</font></font><code class="literal">realpath()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用的</font><font style="vertical-align: inherit;">系统上建立符号链接表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（Linux和Solaris支持</font></font><code class="literal">realpath()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">要确定您的系统是否支持符号链接，请</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_have_symlink"><code class="literal">have_symlink</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下语句</font><font style="vertical-align: inherit;">检查</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW VARIABLES LIKE'have_symlink';
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          处理</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表</font><font style="vertical-align: inherit;">的符号链接的</font><font style="vertical-align: inherit;">工作如下：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在数据目录中，您始终拥有表格format（</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）文件，data（</font></font><code class="filename">.MYD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）文件和index（</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）文件。</font><font style="vertical-align: inherit;">数据文件和索引文件可以在别处移动并通过符号链接替换到数据目录中。</font><font style="vertical-align: inherit;">格式文件不能。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              您可以将数据文件和索引文件独立链接到不同的目录。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              要指示正在运行的MySQL服务器执行符号链接，请使用</font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><code class="literal">INDEX DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.1.18节“CREATE TABLE语法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，如果
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未运行，则可以使用</font><font style="vertical-align: inherit;">
              命令行中的</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ln -s</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动完成符号链接</font><font style="vertical-align: inherit;">。
</font></font></p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                用的一方或双方使用的路径</font></font><code class="literal">DATA
                DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">INDEX
                DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项可能不包括MySQL的
                 </font></font><code class="literal">data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录。</font><font style="vertical-align: inherit;">（错误＃32167）
</font></font></p>
</div>
</li><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/programs.html#myisamchk" title="4.6.3 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myisamchk</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会替换数据文件或索引文件的符号链接。</font><font style="vertical-align: inherit;">它直接在符号链接指向的文件上工作。</font><font style="vertical-align: inherit;">任何临时文件都在数据文件或索引文件所在的目录中创建。</font><font style="vertical-align: inherit;">同样是真实的
              </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
              </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
              </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
</font></font></p></li><li class="listitem">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                当您删除使用符号链接的表时，符号
                 </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接和符号链接点将被删除的文件</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个非常好的理由，</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为系统
                 </font><font style="vertical-align: inherit;">运行
                 </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或允许系统用户拥有对MySQL数据库目录的写入权限。
</font></font></p>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE
              ... RENAME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font><font style="vertical-align: inherit;">重命名表
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#rename-table" title="13.1.33 RENAME TABLE语法"><code class="literal">RENAME
              TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且不将该表移动到另一个数据库，那么数据库目录中的符号链接将重命名为新名称，并相应地重命名数据文件和索引文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE
              ... RENAME</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#rename-table" title="13.1.33 RENAME TABLE语法"><code class="literal">RENAME
              TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将表移动到另一个数据库，则该表将移动到其他数据库目录。</font><font style="vertical-align: inherit;">如果表名更改，则新数据库目录中的符号链接将重命名为新名称，并相应地重命名数据文件和索引文件。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果您不使用符号链接，请</font><font style="vertical-align: inherit;">使用该</font><font style="vertical-align: inherit;">
              选项</font><font style="vertical-align: inherit;">启动
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以确保没有人可以使用
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除或重命名数据目录之外的文件。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          这些表符号链接操作不受支持：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略
               </font></font><code class="literal">DATA DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="literal">INDEX
              DIRECTORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表选项。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如前所述，只有数据和索引文件可以是符号链接。</font><font style="vertical-align: inherit;">该</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件绝
               </font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是符号链接。</font><font style="vertical-align: inherit;">尝试执行此操作（例如，使一个表名称成为另一个表的同义词）会产生不正确的结果。</font><font style="vertical-align: inherit;">假设你</font></font><code class="literal">db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL数据目录下</font><font style="vertical-align: inherit;">有一个数据库</font><font style="vertical-align: inherit;">，</font></font><code class="literal">tbl1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个数据库中</font><font style="vertical-align: inherit;">有一个表</font><font style="vertical-align: inherit;">，并且在</font></font><code class="literal">db1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你创建一个</font></font><code class="literal">tbl2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向</font><font style="vertical-align: inherit;">符号链接</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">目录</font><font style="vertical-align: inherit;">中
               </font></font><code class="literal">tbl1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt; </font><font style="vertical-align: inherit;">
shell&gt; </font><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>cd <em class="replaceable"><code>/path/to/datadir</code></em>/db1</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>ln -s tbl1.frm tbl2.frm</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>ln -s tbl1.MYD tbl2.MYD</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>ln -s tbl1.MYI tbl2.MYI</code></strong>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              问题的结果，如果一个线程读取
               </font></font><code class="literal">db1.tbl1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而另一个线程更新
               </font></font><code class="literal">db1.tbl2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  查询缓存是</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被愚弄的</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（它无法知道</font></font><code class="literal">tbl1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尚未更新，因此它会返回过期的结果）。
                </font></font></p></li><li class="listitem"><p>
                  <code class="literal">ALTER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明
                   </font></font><code class="literal">tbl2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败。
</font></font></p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="windows-symbolic-links"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.3.3在Windows上使用数据库的符号链接</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100778912"></a><a class="indexterm" name="idm140528100777872"></a><a class="indexterm" name="idm140528100776384"></a><a class="indexterm" name="idm140528100775296"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Windows上，符号链接可用于数据库目录。</font><font style="vertical-align: inherit;">这使您可以通过设置数据库目录的不同位置（例如，在不同的磁盘上）来设置数据库目录的符号链接。</font><font style="vertical-align: inherit;">在Windows上使用数据库符号链接与在Unix上使用数据库符号链接类似，尽管设置链接的过程有所不同。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设你想要放置一个名为</font></font><code class="literal">mydb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at
           </font><font style="vertical-align: inherit;">的数据库的数据库目录</font></font><code class="filename">D:\data\mydb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为此，请在指向的MySQL数据目录中创建一个符号链接
           </font></font><code class="filename">D:\data\mydb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，在创建符号链接之前，</font></font><code class="filename">D:\data\mydb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要时通过创建它</font><font style="vertical-align: inherit;">来确保该
           </font><font style="vertical-align: inherit;">目录存在。</font><font style="vertical-align: inherit;">如果您已</font></font><code class="filename">mydb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据目录中</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">一个数据库</font><font style="vertical-align: inherit;">目录，请将其移至</font></font><code class="filename">D:\data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，符号链接将无效。</font><font style="vertical-align: inherit;">为避免出现问题，请确保在移动数据库目录时服务器未运行。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          Windows Vista，Windows Server 2008或更新版本具有原生符号链接支持，因此您可以使用</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mklink</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">创建符号链接
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该命令需要管理权限。
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              将位置更改为数据目录：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\&gt; </font></font><strong class="userinput"><code>cd <em class="replaceable"><code>\path\to\datadir</code></em></code></strong>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在数据目录中，创建一个名为的</font></font><code class="filename">mydb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向数据库目录位置的</font><font style="vertical-align: inherit;">符号链接
               </font><font style="vertical-align: inherit;">：
            </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\&gt; </font></font><strong class="userinput"><code>mklink /d mydb D:\data\mydb</code></strong>
</pre></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在此之后，数据库</font></font><code class="literal">mydb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中创建的</font><font style="vertical-align: inherit;">所有表格
           </font><font style="vertical-align: inherit;">都将在中创建
           </font></font><code class="filename">D:\data\mydb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-memory"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.4优化内存使用</font></font></h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#memory-use"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.4.1 MySQL如何使用内存</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#large-page-support"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.4.2启用大页面支持</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528100756176"></a>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="memory-use"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.4.1 MySQL如何使用内存</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100753584"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL分配缓冲区和缓存以提高数据库操作的性能。</font><font style="vertical-align: inherit;">默认配置旨在允许MySQL服务器在具有大约512MB内存的虚拟机上启动。</font><font style="vertical-align: inherit;">您可以通过增加某些缓存和缓冲区相关系统变量的值来提高MySQL的性能。</font><font style="vertical-align: inherit;">您还可以修改默认配置以在内存有限的系统上运行MySQL。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          以下列表描述了MySQL使用内存的一些方式。</font><font style="vertical-align: inherit;">在适用的情况下，引用相关的系统变量。</font><font style="vertical-align: inherit;">有些项目是存储引擎或功能特定的。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所述</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲器池是保持缓存的存储区</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，索引，及其它辅助缓冲器中的数据。</font><font style="vertical-align: inherit;">为了提高高容量读取操作的效率，缓冲池分为</font><font style="vertical-align: inherit;">
              可能包含多行的</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_page" title="页"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页面</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了高速缓存管理的效率，缓冲池被实现为页面的链接列表; </font><font style="vertical-align: inherit;">很少使用的数据使用</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_lru" title="LRU"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LRU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法</font><font style="vertical-align: inherit;">的变体超时缓存
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-buffer-pool" title="14.6.3.1 InnoDB缓冲池"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.1节“InnoDB缓冲池”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              缓冲池的大小对系统性能很重要：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时使用</font></font><code class="literal">malloc()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">为整个缓冲池分配内存
                   </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所述
                   </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  系统变量定义缓冲池大小。</font><font style="vertical-align: inherit;">通常，推荐
                   </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  值是系统内存的50％到75％。
                  </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  可以在服务器运行时动态配置。</font><font style="vertical-align: inherit;">有关更多信息，请参见
                   </font></font><a class="xref" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-buffer-pool-resize" title="14.6.3.2配置InnoDB缓冲池大小"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14.6.3.2节“配置InnoDB缓冲池大小”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  在具有大量内存的系统上，可以通过将缓冲池分为多个</font></font><a class="link" href="/mysql-5.7-google-zh/glossary.html#glos_buffer_pool_instance" title="缓冲池实例"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池实例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来提高并发性
                   </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所述
                   </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  系统变量定义缓冲池实例的数量。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  缓冲池太小可能会导致过度搅动，因为页面仅从缓冲池刷新到短时间内再次需要。
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  由于竞争内存，缓冲池太大可能会导致交换。
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所有线程共享</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              密钥缓冲区。</font><font style="vertical-align: inherit;">的
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量决定其大小。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器打开的</font><font style="vertical-align: inherit;">每个</font><font style="vertical-align: inherit;">表，索引文件都打开一次; </font><font style="vertical-align: inherit;">对于每个访问表的并发运行线程，数据文件都会打开一次。</font><font style="vertical-align: inherit;">对于每个并发线程，</font><font style="vertical-align: inherit;">分配</font><font style="vertical-align: inherit;">一个表结构，每列的列结构和一个大小的缓冲区
               </font><font style="vertical-align: inherit;">（其中</font><font style="vertical-align: inherit;">是最大行长度，不包括
               </font><font style="vertical-align: inherit;">列）。</font><font style="vertical-align: inherit;">一
               </font><font style="vertical-align: inherit;">列需要五到八个字节加上</font><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">的长度
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该
               </font><font style="vertical-align: inherit;">存储引擎维护用于内部使用一个额外的行缓冲。
            </font></font><code class="literal">3 * <em class="replaceable"><code>N</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所述</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_myisam_use_mmap"><code class="literal">myisam_use_mmap</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量可以被设置为1，使能对所有内存映射</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果内部内存临时表变得太大（使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">确定
               </font><font style="vertical-align: inherit;">），MySQL会自动将表从内存转换为磁盘格式。</font><font style="vertical-align: inherit;">磁盘上的临时表使用由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量</font><font style="vertical-align: inherit;">定义的存储引擎
               </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以按照</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-temporary-tables" title="8.4.4在MySQL中使用内部临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述增加允许的临时表大小
               </font><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于使用</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#memory-storage-engine" title="15.3内存存储引擎"><code class="literal">MEMORY</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明确创建的表</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-table" title="13.1.18 CREATE TABLE语法"><code class="literal">CREATE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只有
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量决定允许表增长多少，并且没有转换为磁盘格式。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html" title="第25章MySQL性能模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL性能模式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在低级别监控MySQL服务器执行的功能。</font><font style="vertical-align: inherit;">性能模式以增量方式动态分配内存，将其内存使用扩展到实际的服务器负载，而不是在服务器启动期间分配所需的内存。</font><font style="vertical-align: inherit;">一旦分配内存，在服务器重新启动之前它不会被释放。</font><font style="vertical-align: inherit;">有关更多信息，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-memory-model" title="25.16性能模式内存分配模型"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.16节“性能模式内存分配模型”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器用于管理客户端连接的每个线程都需要一些线程特定的空间。</font><font style="vertical-align: inherit;">以下列表指示这些以及哪些系统变量控制其大小：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  堆栈（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_thread_stack"><code class="literal">thread_stack</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  连接缓冲区（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
                </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  结果缓冲区（</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              连接缓冲区和结果缓冲区每个都以大小等于</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节</font><font style="vertical-align: inherit;">的大小开始
               </font><font style="vertical-align: inherit;">，但</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要</font><font style="vertical-align: inherit;">动态放大到
               </font><font style="vertical-align: inherit;">字节。</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个SQL语句之后</font><font style="vertical-align: inherit;">，结果缓冲区会缩小为
               </font><font style="vertical-align: inherit;">字节。</font><font style="vertical-align: inherit;">当语句正在运行时，还会分配当前语句字符串的副本。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              每个连接线程都使用内存来计算语句摘要。</font><font style="vertical-align: inherit;">服务器分配
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_digest_length"><code class="literal">max_digest_length</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个会话的字节数。</font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-statement-digests" title="25.9性能架构语句摘要"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.9节“性能架构语句摘要”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所有线程共享相同的基本内存。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当不再需要线程时，分配给它的内存将被释放并返回到系统，除非线程回到线程缓存中。</font><font style="vertical-align: inherit;">在这种情况下，内存保持分配。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              每个执行表的顺序扫描的请求分配一个</font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取缓冲区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">的
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量决定缓冲器大小。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在以任意顺序读取行时（例如，在排序后），</font><font style="vertical-align: inherit;">
              可能会分配</font><font style="vertical-align: inherit;">一个
               </font></font><span class="firstterm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机读取缓冲区</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以避免磁盘搜索。</font><font style="vertical-align: inherit;">的
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量决定缓冲器大小。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              所有连接都在一次执行中执行，大多数连接都可以在不使用临时表的情况下完成。</font><font style="vertical-align: inherit;">大多数临时表是基于内存的哈希表。</font><font style="vertical-align: inherit;">具有较大行长度（以所有列长度的总和计算）或包含</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列的</font><font style="vertical-align: inherit;">临时表
               </font><font style="vertical-align: inherit;">存储在磁盘上。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              大多数执行排序的请求会根据结果集大小分配排序缓冲区和零到两个临时文件。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#temporary-files" title="B.5.3.5 MySQL在哪里存储临时文件"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.3.5节“MySQL存储临时文件的位置”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              几乎所有的解析和计算都是在线程本地和可重用的内存池中完成的。</font><font style="vertical-align: inherit;">小项目不需要内存开销，从而避免了正常的慢速内存分配和释放。</font><font style="vertical-align: inherit;">内存仅分配给意外大的字符串。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              对于每个包含</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              列的表，动态地放大缓冲区以读取更大的</font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">如果您扫描一个表格，缓冲区会增大到
               </font></font><a class="link" href="/mysql-5.7-google-zh/data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大值。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL需要表缓存的内存和描述符。</font><font style="vertical-align: inherit;">所有使用中表格的处理程序结构都保存在表格缓存中，并作为</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">先入先出</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（FIFO）进行管理。</font><font style="vertical-align: inherit;">所述
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量定义初始表高速缓存大小; </font><font style="vertical-align: inherit;">请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#table-cache" title="8.4.3.1 MySQL如何打开和关闭表格"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.4.3.1节“MySQL如何打开和关闭表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
            </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              MySQL还需要用于表定义缓存的内存。</font><font style="vertical-align: inherit;">所述
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_definition_cache"><code class="literal">table_definition_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              系统变量定义的表定义（距离的数量</font></font><code class="filename">.frm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以存储在表中定义的高速缓存文件）。</font><font style="vertical-align: inherit;">如果您使用大量表格，则可以创建大型表格定义缓存以加快表格的打开速度。</font><font style="vertical-align: inherit;">与表缓存不同，表定义缓存占用更少的空间并且不使用文件描述符。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或
               </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中mysqladmin冲水表</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令关闭不在使用一次的所有表，并标记所有在用的表被关闭当前正在执行的线程结束时。</font><font style="vertical-align: inherit;">这有效地释放了大部分使用中的内存。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直到所有表都关闭后才会返回。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              服务器在内存中缓存信息的结果
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#grant" title="13.7.1.4 GRANT语法"><code class="literal">GRANT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-user" title="13.7.1.2 CREATE USER语法"><code class="literal">CREATE USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-server" title="13.1.17 CREATE SERVER语法"><code class="literal">CREATE SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#install-plugin" title="13.7.3.3安装PLUGIN语法"><code class="literal">INSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">该内存不能由相应的释放
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#revoke" title="13.7.1.6 REVOKE语法"><code class="literal">REVOKE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-user" title="13.7.1.3 DROP USER语法"><code class="literal">DROP USER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#drop-server" title="13.1.28 DROP SERVER语法"><code class="literal">DROP SERVER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和
               </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#uninstall-plugin" title="13.7.3.4卸载PLUGIN语法"><code class="literal">UNINSTALL PLUGIN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              语句，所以执行导致缓存报表的多个实例的服务器上，将有内存使用的增加。</font><font style="vertical-align: inherit;">这个缓存的内存可以被释放</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p>
          <span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和其他系统状态程序可能会报告</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用大量内存。</font><font style="vertical-align: inherit;">这可能是由不同内存地址上的线程堆栈引起的。</font><font style="vertical-align: inherit;">例如，Solaris的</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ps</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本将
          </font><font style="vertical-align: inherit;">堆栈之间未使用的内存计为已用内存。</font><font style="vertical-align: inherit;">要验证这一点，请检查可用的交换
          </font></font><code class="literal">swap -s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们</font><font style="vertical-align: inherit;">
          用几个内存泄漏检测器（商业和开源）</font><font style="vertical-align: inherit;">测试</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以应该没有内存泄漏。
</font></font></p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="monitor-mysql-memory-use"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监视MySQL内存使用情况</font></font></h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140528100642960"></a><a class="indexterm" name="idm140528100641472"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            以下示例演示如何使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html" title="第25章MySQL性能模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance Schema</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
            和</font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html" title="第26章MySQL sys模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys模式</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来监视MySQL内存使用情况。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            大多数性能架构内存检测默认情况下处于禁用状态。</font><font style="vertical-align: inherit;">仪器可以通过更新</font></font><code class="literal">ENABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能模式</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#setup-instruments-table" title="25.11.2.3 setup_instruments表"><code class="literal">setup_instruments</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">列
             </font><font style="vertical-align: inherit;">来启用
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">记忆乐器的名称形式为
             </font><font style="vertical-align: inherit;">，其中</font><font style="vertical-align: inherit;">是诸如</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">，并且
             </font><font style="vertical-align: inherit;">是乐器细节。
</font></font><code class="literal">memory/<em class="replaceable"><code>code_area</code></em>/<em class="replaceable"><code>instrument_name</code></em></code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>code_area</code></em><font style="vertical-align: inherit;"></font><code class="literal">sql</code><font style="vertical-align: inherit;"></font><code class="literal">innodb</code><font style="vertical-align: inherit;"></font><em class="replaceable"><code>instrument_name</code></em><font style="vertical-align: inherit;"></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要查看可用的MySQL内存工具，请查询性能架构
                 </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#setup-instruments-table" title="25.11.2.3 setup_instruments表"><code class="literal">setup_instruments</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font><font style="vertical-align: inherit;">以下查询返回所有代码区域的数百个内存工具。
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%memory%';</code></strong></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                您可以通过指定代码区域来缩小结果。</font><font style="vertical-align: inherit;">例如，您可以</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过指定</font></font><code class="literal">innodb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码区域</font><font style="vertical-align: inherit;">将结果限制在
                 </font><font style="vertical-align: inherit;">内存仪器中</font><font style="vertical-align: inherit;">。
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%memory/innodb%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- + ----- ---- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NAME | </font><font style="vertical-align: inherit;">ENABLED | </font><font style="vertical-align: inherit;">TIMED |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- + ----- ---- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb /自适应哈希索引| </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / buf_buf_pool | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / dict_stats_bg_recalc_pool_t | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / dict_stats_index_map_t | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / dict_stats_n_diff_on_level | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / other | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / row_log_buf | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / row_merge_sort | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / std | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / trx_sys_t :: rw_trx_ids | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                根据您的MySQL安装代码区域可能包括</font></font><code class="literal">performance_schema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><code class="literal">sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><code class="literal">innodb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">myisam</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><code class="literal">csv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="literal">memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><code class="literal">blackhole</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><code class="literal">archive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
                 </font></font><code class="literal">partition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和其他人。
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                要启用内存工具，</font></font><code class="literal">performance-schema-instrument</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请在MySQL配置文件中</font><font style="vertical-align: inherit;">添加一条
                 </font><font style="vertical-align: inherit;">规则。</font><font style="vertical-align: inherit;">例如，要启用所有内存工具，请将此规则添加到您的配置文件并重新启动服务器：
</font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能架构仪器=“存储器/％=计数”</font></font></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  在启动时启用内存工具可确保启动时发生的内存分配计数。
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                重新启动服务器后，</font></font><code class="literal">ENABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance Schema </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#setup-instruments-table" title="25.11.2.3 setup_instruments表"><code class="literal">setup_instruments</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                表</font><font style="vertical-align: inherit;">的
                 </font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">应报告</font></font><code class="literal">YES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您启用的内存工具。</font><font style="vertical-align: inherit;">内存操作未定时</font></font><code class="literal">TIMED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#setup-instruments-table" title="25.11.2.3 setup_instruments表"><code class="literal">setup_instruments</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的
                 </font><font style="vertical-align: inherit;">列
                 </font><font style="vertical-align: inherit;">被忽略。
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%memory/innodb%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- + ----- ---- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NAME | </font><font style="vertical-align: inherit;">ENABLED | </font><font style="vertical-align: inherit;">TIMED |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- + ----- ---- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb /自适应哈希索引| </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / buf_buf_pool | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / dict_stats_bg_recalc_pool_t | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / dict_stats_index_map_t | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / dict_stats_n_diff_on_level | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / other | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / row_log_buf | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / row_merge_sort | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / std | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb / trx_sys_t :: rw_trx_ids | </font><font style="vertical-align: inherit;">NO | </font><font style="vertical-align: inherit;">NO |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                查询记忆仪器数据。</font><font style="vertical-align: inherit;">在本例中，内存仪器数据在Performance Schema </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#memory-summary-tables" title="25.11.15.9内存汇总表"><code class="literal">memory_summary_global_by_event_name</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                表格中</font><font style="vertical-align: inherit;">查询，该
                 </font><font style="vertical-align: inherit;">表格通过对数据进行汇总
                 </font></font><code class="literal">EVENT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这
                 </font></font><code class="literal">EVENT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是乐器的名称。
              </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                以下查询返回</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲池的</font><font style="vertical-align: inherit;">内存数据
                 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关列说明，请参见
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#memory-summary-tables" title="25.11.15.9内存汇总表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.15.9节“内存汇总表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.memory_summary_global_by_event_name</code></strong>
       <strong class="userinput"><code>WHERE EVENT_NAME LIKE 'memory/innodb/buf_buf_pool'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  EVENT_NAME：内存/ innodb / buf_buf_pool</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 COUNT_ALLOC：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  COUNT_FREE：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SUM_NUMBER_OF_BYTES_ALLOC：137428992</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    SUM_NUMBER_OF_BYTES_FREE：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LOW_COUNT_USED：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          CURRENT_COUNT_USED：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             HIGH_COUNT_USED：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    LOW_NUMBER_OF_BYTES_USED：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CURRENT_NUMBER_OF_BYTES_USED：137428992</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   HIGH_NUMBER_OF_BYTES_USED：137428992</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html" title="第26章MySQL sys模式"><code class="literal">sys</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构</font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html#sys-memory-global-by-current-bytes" title="26.4.3.19 memory_global_by_current_bytes和x $ memory_global_by_current_bytes视图"><code class="literal">memory_global_by_current_bytes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                表</font><font style="vertical-align: inherit;">来查询相同的底层数据，该
                 </font><font style="vertical-align: inherit;">架构
                 </font><font style="vertical-align: inherit;">表显示全局服务器当前的内存使用情况，按分配类型细分。
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM sys.memory_global_by_current_bytes</code></strong>
       <strong class="userinput"><code>WHERE event_name LIKE 'memory/innodb/buf_buf_pool'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1. row ******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       event_name：内存/ innodb / buf_buf_pool</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    current_count：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    current_alloc：131.06 MiB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
current_avg_alloc：131.06 MiB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       high_count：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       high_alloc：131.06 MiB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   high_avg_alloc：131.06 MiB</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                该</font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html" title="第26章MySQL sys模式"><code class="literal">sys</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式查询</font></font><code class="literal">current_alloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过代码区域</font><font style="vertical-align: inherit;">聚合当前分配的内存（</font><font style="vertical-align: inherit;">）：
              </font></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT SUBSTRING_INDEX(event_name,'/',2) AS</code></strong>
       <strong class="userinput"><code>code_area, sys.format_bytes(SUM(current_alloc))</code></strong>
       <strong class="userinput"><code>AS current_alloc</code></strong>
       <strong class="userinput"><code>FROM sys.x$memory_global_by_current_bytes</code></strong>
       <strong class="userinput"><code>GROUP BY SUBSTRING_INDEX(event_name,'/',2)</code></strong>
       <strong class="userinput"><code>ORDER BY SUM(current_alloc) DESC;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">code_area | </font><font style="vertical-align: inherit;">current_alloc |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb | </font><font style="vertical-align: inherit;">843.24 MiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ performance_schema | </font><font style="vertical-align: inherit;">81.29 MiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ mysys | </font><font style="vertical-align: inherit;">8.20 MiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / sql | </font><font style="vertical-align: inherit;">2.47 MiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/内存| </font><font style="vertical-align: inherit;">174.01 KiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ myisam | </font><font style="vertical-align: inherit;">46.53 KiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/黑洞| </font><font style="vertical-align: inherit;">512字节|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/联合| </font><font style="vertical-align: inherit;">512字节|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ csv | </font><font style="vertical-align: inherit;">512字节|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ vio | </font><font style="vertical-align: inherit;">496字节|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------- + -------- +</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                有关</font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html" title="第26章MySQL sys模式"><code class="literal">sys</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式的</font><font style="vertical-align: inherit;">更多信息
                 </font><font style="vertical-align: inherit;">，请参阅
                 </font></font><a class="xref" href="/mysql-5.7-google-zh/sys-schema.html" title="第26章MySQL sys模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第26章</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL sys模式</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="large-page-support"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.4.2启用大页面支持</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100573872"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          某些硬件/操作系统体系结构支持的内存页面大于默认值（通常为4KB）。</font><font style="vertical-align: inherit;">这种支持的实际实施取决于底层硬件和操作系统。</font><font style="vertical-align: inherit;">执行大量内存访问的应用程序可能通过使用大页面来获得性能改进，这是因为减少了翻译旁视缓冲区（TLB）缺失。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在MySQL中，InnoDB可以使用大页面为其缓冲池和额外的内存池分配内存。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          标准使用MySQL中的大页面将尝试使用支持的最大大小，最大为4MB。</font><font style="vertical-align: inherit;">在Solaris下，
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超大页面</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能可以使用最多256MB的页面。</font><font style="vertical-align: inherit;">此功能适用于最新的SPARC平台。</font><font style="vertical-align: inherit;">可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_super-large-pages"><code class="option">--super-large-pages</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_super-large-pages"><code class="option">--skip-super-large-pages</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          选项</font><font style="vertical-align: inherit;">启用或禁用它
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL还支持大型页面支持的Linux实现（在Linux中称为HugeTLB）。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在Linux上可以使用大页面之前，必须启用内核来支持它们，并且需要配置HugeTLB内存池。</font><font style="vertical-align: inherit;">作为参考，HugeTBL API记录在
           </font></font><code class="filename">Documentation/vm/hugetlbpage.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的Linux源文件中。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          最近的一些系统（如红帽企业Linux）的内核似乎默认启用了大页面功能。</font><font style="vertical-align: inherit;">要检查内核是否为真，请使用以下命令并查找包含</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">巨大</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”的</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出行
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Total：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Free：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Rsvd：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Surp：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hugepagesize：4096 kB</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          非空命令输出表示存在大页面支持，但零值表示没有配置页面供使用。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您的内核需要重新配置以支持大页面，请查阅该</font></font><code class="filename">hugetlbpage.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件以获取说明。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          假设您的Linux内核已启用大页面支持，请使用以下命令将其配置为供MySQL使用。</font><font style="vertical-align: inherit;">通常，将这些</font></font><code class="filename">rc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">放入</font><font style="vertical-align: inherit;">系统启动序列中执行</font><font style="vertical-align: inherit;">的
           </font><font style="vertical-align: inherit;">文件或等效启动文件中，以便每次系统启动时执行这些命令。</font><font style="vertical-align: inherit;">在MySQL服务器启动之前，命令应该在引导序列中尽早执行。</font><font style="vertical-align: inherit;">请务必根据您的系统更改分配编号和组编号。
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃设置要使用的页数。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃每页通常为2MB，因此值为20 = 40MB。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃这个命令实际上是分配内存，所以这么多</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃内存必须可用。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo 20&gt; / proc / sys / vm / nr_hugepages</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃设置允许访问的组号</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃内存（在这种情况下为102）。</font><font style="vertical-align: inherit;">mysql用户必须是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃此组的成员。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo 102&gt; / proc / sys / vm / hugetlb_shm_group</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃增加每段允许的shmem数量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃（在这种情况下为12G）。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo 1560281088&gt; / proc / sys / kernel / shmmax</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃增加共享内存总量。</font><font style="vertical-align: inherit;">价值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃是页数。</font><font style="vertical-align: inherit;">4KB /页，4194304 = 16GB。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo 4194304&gt; / proc / sys / kernel / shmall</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于MySQL的使用情况，您通常希望值的值
           </font></font><code class="literal">shmmax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接近于
           </font></font><code class="literal">shmall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证大页面配置，请</font></font><code class="filename">/proc/meminfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按前面所述重新</font><font style="vertical-align: inherit;">检查
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在你应该看到一些非零值：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Total：20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Free：20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Rsvd：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Surp：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hugepagesize：4096 kB</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          利用这个最后一步
           </font></font><code class="literal">hugetlb_shm_group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就是为
           </font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户提供一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无限</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”的</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
          值，用于memlock限制。</font><font style="vertical-align: inherit;">这可以通过编辑</font></font><code class="filename">/etc/security/limits.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或将以下命令添加到
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld-safe" title="4.3.2 mysqld_safe  -  MySQL服务器启动脚本"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld_safe</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本来完成：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ulimit -l无限制
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          将</font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ulimit</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld-safe" title="4.3.2 mysqld_safe  -  MySQL服务器启动脚本"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld_safe</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会导致
           </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font></font><code class="literal">unlimited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在切换到</font></font><code class="literal">mysql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">之前
           </font><font style="vertical-align: inherit;">设置memlock限制
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（这个假定
           </font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld-safe" title="4.3.2 mysqld_safe  -  MySQL服务器启动脚本"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld_safe</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由启动
           </font></font><code class="literal">root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL中的大页面支持默认是禁用的。</font><font style="vertical-align: inherit;">要启用它，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_large-pages"><code class="option">--large-pages</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，您可以在服务器</font></font><code class="filename">my.cnf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">使用以下行
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大型网页</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          使用此选项时，会</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动为其缓冲池和附加内存池使用大页面。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能这样做，则会回退到使用传统内存并向错误日志中写入警告：</font></font><span class="errortext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：使用常规内存池</font></font></span>
        </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要验证是否正在使用大页面，请</font></font><code class="literal">/proc/meminfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次</font><font style="vertical-align: inherit;">检查
           </font><font style="vertical-align: inherit;">：
        </font></font></p><pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Total：20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Free：20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Rsvd：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Surp：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hugepagesize：4096 kB</font></font><font></font>
</pre>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-network"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.5优化网络使用</font></font></h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#connection-threads"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.5.1 MySQL如何使用线程进行客户端连接</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#host-cache"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.5.2 DNS查找优化和主机缓存</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528100530896"></a>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="connection-threads"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.5.1 MySQL如何使用线程进行客户端连接</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100528192"></a><a class="indexterm" name="idm140528100527136"></a><a class="indexterm" name="idm140528100526064"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          连接管理器线程处理服务器侦听的网络接口上的客户端连接请求。</font><font style="vertical-align: inherit;">在所有平台上，一个管理器线程处理TCP / IP连接请求。</font><font style="vertical-align: inherit;">在Unix上，这个管理器线程还处理Unix套接字文件连接请求。</font><font style="vertical-align: inherit;">在Windows上，管理器线程处理共享内存连接请求，另一个处理命名管道连接请求。</font><font style="vertical-align: inherit;">服务器不会创建线程来处理它不会听的接口。</font><font style="vertical-align: inherit;">例如，不支持命名管道连接的Windows服务器不会创建线程来处理它们。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          连接管理器线程将每个客户端连接与专用于它的线程关联，以处理该连接的身份验证和请求处理。</font><font style="vertical-align: inherit;">管理器线程在必要时创建一个新线程，但尝试通过首先查询线程缓存来查看它是否包含可用于连接的线程来避免这样做。</font><font style="vertical-align: inherit;">当连接结束时，如果缓存未满，则其线程返回到线程缓存。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在这种连接线​​程模型中，线程数量与客户端当前连接的线程数量一样多，当服务器工作负载必须扩展以处理大量连接时存在一些缺点。</font><font style="vertical-align: inherit;">例如，线程创建和处理变得昂贵。</font><font style="vertical-align: inherit;">另外，每个线程都需要服务器和内核资源，例如堆栈空间。</font><font style="vertical-align: inherit;">为了适应大量的同时连接，每个线程的堆栈大小必须保持很小，导致它或者太小或者服务器消耗大量内存。</font><font style="vertical-align: inherit;">其他资源也可能耗尽，调度开销可能会变得很大。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要控制和监视服务器如何管理处理客户端连接的线程，几个系统和状态变量是相关的。</font><font style="vertical-align: inherit;">（请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-system-variables" title="5.1.5服务器系统变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.5节“服务器系统变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.1.7节“服务器状态变量”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          线程缓存的大小由</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">决定
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认值为0（不缓存），这会导致为每个新连接设置线程并在连接终止时处理该线程。</font><font style="vertical-align: inherit;">设置
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为
           </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用
           </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存非活动连接线程。</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在服务器启动时设置，也可以在服务器运行时更​​改。</font><font style="vertical-align: inherit;">连接线程在与其关联的客户端连接终止时变为非活动状态。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          为了监测缓存的线程和多少个线程已创建的数量，因为一个线程无法从缓存中取，监视
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Threads_cached"><code class="literal">Threads_cached</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
           </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Threads_created"><code class="literal">Threads_created</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态变量。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          您可以</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在服务器启动时或运行时</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">，以控制可同时连接的最大客户端数量。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          当线程堆栈太小时，这限制了服务器可以处理的SQL语句的复杂性，存储过程的递归深度以及其他耗费内存的操作。</font><font style="vertical-align: inherit;">要</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个线程</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">字节</font><font style="vertical-align: inherit;">的堆栈大小，请使用
           </font><font style="vertical-align: inherit;">以下命令启动服务器
           </font><font style="vertical-align: inherit;">。
</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_thread_stack"><code class="option">--thread_stack=<em class="replaceable"><code>N</code></em></code></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="host-cache"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.12.5.2 DNS查找优化和主机缓存</font></font></h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100505920"></a><a class="indexterm" name="idm140528100504864"></a><a class="indexterm" name="idm140528100503792"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          MySQL服务器在内存中维护一个包含客户端信息的主机缓存：IP地址，主机名和错误信息。</font><font style="vertical-align: inherit;">服务器为非本地TCP连接使用此缓存。</font><font style="vertical-align: inherit;">它不使用缓存来建立使用回送接口地址（</font></font><code class="literal">127.0.0.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="literal">::1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">建立的TCP连接</font><font style="vertical-align: inherit;">，也不使用使用Unix套接字文件，命名管道或共享内存建立的连接。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于每个新的客户端连接，服务器都使用客户端IP地址来检查客户端主机名是否在主机缓存中。</font><font style="vertical-align: inherit;">如果没有，则服务器尝试解析主机名。</font><font style="vertical-align: inherit;">首先，它将IP地址解析为主机名，并将该主机名解析为IP地址。</font><font style="vertical-align: inherit;">然后将结果与原始IP地址进行比较，以确保它们相同。</font><font style="vertical-align: inherit;">服务器将有关此操作结果的信息存储在主机缓存中。</font><font style="vertical-align: inherit;">如果缓存已满，则丢弃最近最少使用的条目。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#host-cache-table" title="25.11.16.1 host_cache表"><code class="literal">host_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能架构表暴露主机缓存，以便它可以使用被检查的内容</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          陈述。</font><font style="vertical-align: inherit;">这可以帮助您诊断连接问题的原因。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#host-cache-table" title="25.11.16.1 host_cache表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.16.1节“host_cache表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器像这样处理主机高速缓存中的条目：
</font></font></p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              当第一个TCP客户端连接从给定IP地址到达服务器时，会创建一个新条目来记录客户端IP，主机名和客户端查找验证标志。</font><font style="vertical-align: inherit;">最初，主机名称设置为
               </font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，标志为false。</font><font style="vertical-align: inherit;">此条目也用于来自同一始发IP的后续客户端连接。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果客户端IP条目的验证标志为false，则服务器将尝试IP到主机名称的DNS解析。</font><font style="vertical-align: inherit;">如果成功，则使用解析的主机名更新主机名，并将验证标志设置为true。</font><font style="vertical-align: inherit;">如果解决不成功，则采取的行动取决于错误是永久性的还是暂时性的。</font><font style="vertical-align: inherit;">对于永久性故障，主机名保持不变</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ，验证标志设置为true。</font><font style="vertical-align: inherit;">对于瞬态故障，主机名和验证标志保持不变。</font><font style="vertical-align: inherit;">（下一次客户端从此IP连接时，将发生另一个DNS解析尝试。）
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              如果在处理来自给定IP地址的传入客户端连接时发生错误，则服务器将更新该IP项的相应错误计数器。</font><font style="vertical-align: inherit;">有关所记录错误的说明，请参见
               </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#host-cache-table" title="25.11.16.1 host_cache表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.16.1节“host_cache表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ol>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器使用线程安全来执行主机名称解析，
           </font></font><code class="function">gethostbyaddr_r()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
           </font></font><code class="function">gethostbyname_r()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在操作系统支持时进行调用。</font><font style="vertical-align: inherit;">否则，执行查找的线程会锁定互斥锁并调用
           </font></font><code class="function">gethostbyaddr()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><code class="function">gethostbyname()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是。</font><font style="vertical-align: inherit;">在这种情况下，除非拥有互斥锁的线程释放它，否则其他线程无法解析主机缓存中未包含的主机名。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          服务器使用主机缓存有以下几个目的：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              通过缓存IP到主机名称查找的结果，服务器可避免为每个客户端连接执行DNS查找。</font><font style="vertical-align: inherit;">相反，对于给定的主机，它只需要对来自该主机的第一个连接执行查找。
            </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              缓存包含有关在连接过程中发生的错误的信息。</font><font style="vertical-align: inherit;">有些错误被认为是
               </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻塞”。</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果没有成功连接的情况下，从给定主机连续发生太多这样的事件，服务器将阻止来自该主机的进一步连接。</font><font style="vertical-align: inherit;">的
               </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_max_connect_errors"><code class="literal">max_connect_errors</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量决定阻挡发生之前允许的错误的数目。</font><font style="vertical-align: inherit;">参见</font></font><a class="xref" href="/mysql-5.7-google-zh/error-handling.html#blocked-host" title="B.5.2.5主机&#39;host_name&#39;被阻塞"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第B.5.2.5节“主机'host_name'被阻止”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要取消阻止阻止的主机，请通过发出</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-hosts"><code class="literal">FLUSH HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或执行</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqladmin flush-hosts</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">刷新主机缓存
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          即使没有</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-hosts"><code class="literal">FLUSH HOSTS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自阻止主机的最后一次连接尝试后发生的来自其他主机的活动，</font><font style="vertical-align: inherit;">阻止的主机也可能变为畅通无阻</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">发生这种情况的原因可能是，服务器丢弃最近最少使用的高速缓存条目，以便在连接从不在高速缓存中的客户端IP到达时，如果高速缓存已满，则为新条目腾出空间。</font><font style="vertical-align: inherit;">如果放弃的条目用于阻止的主机，则该主机将变为未阻止状态。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          主机缓存默认启用。</font><font style="vertical-align: inherit;">要禁用它，请</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务器启动时或运行时</font><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">设置
           </font><font style="vertical-align: inherit;">为0。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要禁用DNS主机名查找，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器
           </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，服务器仅使用IP地址，而不使用主机名将连接主机与MySQL授权表中的行匹配。</font><font style="vertical-align: inherit;">只能使用这些表中使用IP地址指定的帐户。</font><font style="vertical-align: inherit;">（请确保存在指定IP地址的帐户，否则您可能无法连接。）
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果您的DNS和主机速度非常慢，则可以通过禁用DNS查找来提高性能，</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者通过增大</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于使主机缓存更大</font><font style="vertical-align: inherit;">的值
           </font><font style="vertical-align: inherit;">来提高性能
           </font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          要完全禁止TCP / IP连接，请使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动服务器</font><font style="vertical-align: inherit;">。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          某些连接错误与TCP连接无关，在连接过程中很早（即使在知道IP地址之前），或者并非特定于任何特定IP地址（如内存不足条件）。</font><font style="vertical-align: inherit;">有关这些错误的信息，请检查
           </font><font style="vertical-align: inherit;">
          状态变量（请参见
           </font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;">第5.1.7节“服务器状态变量”</font></a><font style="vertical-align: inherit;">）。
</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#statvar_Connection_errors_xxx"><code class="literal">Connection_errors_<em class="replaceable"><code>xxx</code></em></code></a><font style="vertical-align: inherit;"></font><a class="xref" href="/mysql-5.7-google-zh/server-administration.html#server-status-variables" title="5.1.7服务器状态变量"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimize-benchmarking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13衡量绩效（标杆管理）</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#select-benchmarking"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.1测量表达式和函数的速度</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#custom-benchmarks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.2使用你自己的基准</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#monitoring-performance-schema"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.3使用performance_schema测量绩效</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528100461488"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      要衡量性能，请考虑以下因素：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          无论您是在安静的系统上测量单个操作的速度，还是</font><font style="vertical-align: inherit;">在一段时间内</font><font style="vertical-align: inherit;">一组操作（
           </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作负载</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的工作方式。</font><font style="vertical-align: inherit;">通过简单的测试，您通常会测试如何更改一个方面（配置设置，表中的一组索引，查询中的SQL子句）会影响性能。</font><font style="vertical-align: inherit;">基准测试通常是长时间运行和精心设计的性能测试，其结果可能决定高级选择，如硬件和存储配置，或者多久升级到新的MySQL版本。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          对于基准测试，有时您必须模拟繁重的数据库工作负载才能获得准确的图像。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表现可能因许多不同因素而异，几个百分点的差异可能不是决定性的胜利。</font><font style="vertical-align: inherit;">当您在不同的环境中测试时，结果可能会相反。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          取决于工作负载，某些MySQL功能有助于或无助于提高性能。</font><font style="vertical-align: inherit;">为了保持完整性，请始终在打开和关闭这些功能的情况下测试性能。</font><font style="vertical-align: inherit;">尝试与每个工作负载的两个最重要的功能是
           </font></font><a class="link" href="/mysql-5.7-google-zh/optimization.html#query-cache" title="8.10.3 MySQL查询缓存"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL查询缓存</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及
           </font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html#innodb-adaptive-hash" title="14.4.3自适应哈希索引"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适应性的散列索引</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      本节从单一开发人员可以完成的简单和直接的测量技术发展到需要额外专业知识来执行和解释结果的更复杂的测量技术。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="select-benchmarking"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.1测量表达式和函数的速度</font></font></h3>
</div>
</div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        要测量特定MySQL表达式或函数的速度，请</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端程序</font><font style="vertical-align: inherit;">调用该</font><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它的语法是
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">返回值总是为零，但</font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;">mysql</font></strong></span></a><font style="vertical-align: inherit;"> 
        打印一行显示语句执行的时间。</font><font style="vertical-align: inherit;">例如：
      </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_benchmark"><code class="literal">BENCHMARK(<em class="replaceable"><code>loop_count</code></em>,<em class="replaceable"><code>expression</code></em>)</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行工具"><span class="command"><strong><font style="vertical-align: inherit;"></font></strong></span></a><font style="vertical-align: inherit;"></font></p><pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT BENCHMARK(1000000,1+1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">BENCHMARK（1000000,1 + 1）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一排（0.32秒）</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这个结果是在Pentium II 400MHz系统上获得的。</font><font style="vertical-align: inherit;">它表明MySQL可以在0.32秒内在该系统上执行1,000,000个简单的附加表达式。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        内置的MySQL函数通常是高度优化的，但可能会有一些例外。
        </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个很好的工具，用于查明某些功能是否是您查询的问题。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="custom-benchmarks"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.2使用你自己的基准</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100438144"></a><a class="indexterm" name="idm140528100437104"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        基准您的应用程序和数据库，找出瓶颈所在。</font><font style="vertical-align: inherit;">在修复了一个瓶颈之后（或者用一个</font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><span class="quote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块</font><font style="vertical-align: inherit;">替换它</font><font style="vertical-align: inherit;">），您可以继续确定下一个瓶颈。</font><font style="vertical-align: inherit;">即使您的应用程序的整体性能目前是可以接受的，您至少应该为每个瓶颈制定一个计划，并决定如果有一天您真的需要额外的性能如何解决它。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        免费的基准套件是开源数据库基准测试版，可在</font></font><a class="ulink" href="http://osdb.sourceforge.net/" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://osdb.sourceforge.net/上找到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        只有当系统负载很重时，才会出现问题，这很常见。</font><font style="vertical-align: inherit;">我们有很多客户在生产过程中（测试过的）系统遇到负载问题时与我们联系。</font><font style="vertical-align: inherit;">在大多数情况下，性能问题归结于基本数据库设计问题（例如，表扫描在高负载情况下不好）或操作系统或库存在问题。</font><font style="vertical-align: inherit;">大多数情况下，如果系统尚未投入生产，这些问题将更容易解决。
      </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        为了避免这样的问题，请在最坏的负载下对整个应用程序进行基准测试：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqlslap" title="4.5.9 mysqlslap  - 加载仿真客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlslap</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序可以是用于模拟由多个客户端同时发出查询产生的高负载有帮助的。</font><font style="vertical-align: inherit;">请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqlslap" title="4.5.9 mysqlslap  - 加载仿真客户端"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.5.9节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqlslap</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 加载仿真客户端”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您还可以尝试基准测试软件包，例如</font></font><a class="ulink" href="https://launchpad.net/sysbench" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://launchpad.net/sysbench</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><a class="ulink" href="http://osdldbt.sourceforge.net/#dbt2" target="_top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://osdldbt.sourceforge.net/#dbt2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的SysBench和DBT2
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些程序或软件包可能会使系统瘫痪，因此请务必仅在您的开发系统上使用它们。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="monitoring-performance-schema"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.13.3使用performance_schema测量绩效</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100423936"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        您可以查询</font></font><code class="literal">performance_schema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中</font><font style="vertical-align: inherit;">的表
         </font><font style="vertical-align: inherit;">以查看有关服务器及其运行的应用程序的性能特征的实时信息。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息</font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html" title="第25章MySQL性能模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅
         </font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html" title="第25章MySQL性能模式"><font style="vertical-align: inherit;">第25章</font></a><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html" title="第25章MySQL性能模式"><i><font style="vertical-align: inherit;">MySQL性能架构</font></i></a><font style="vertical-align: inherit;">。
</font></font></p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="thread-information"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14检查线程信息</font></font></h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#thread-commands"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.1线程命令值</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#general-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.2一般线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#query-cache-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.3查询缓存线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#master-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.4复制主线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#slave-io-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.5复制从属I / O线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#slave-sql-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.6复制从SQL SQL线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#slave-connection-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.7复制从属连接线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#mysql-cluster-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.8 NDB集群线程状态</font></font></a></span></dt><dt><span class="section"><a href="/mysql-5.7-google-zh/optimization.html#event-scheduler-thread-states"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.9事件调度程序线程状态</font></font></a></span></dt></dl>
</div>
<a class="indexterm" name="idm140528100419056"></a><a class="indexterm" name="idm140528100417600"></a><a class="indexterm" name="idm140528100416112"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      当你试图确定你的MySQL服务器正在做什么时，检查进程列表会很有帮助，这个进程列表是当前在服务器内执行的一组线程。</font><font style="vertical-align: inherit;">进程列表信息可从以下来源获得：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">SHOW [FULL] PROCESSLIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.5.29，“SHOW PROCESSLIST语法”</font></font></a>
        </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-profile" title="13.7.5.30 SHOW PROFILE语法"><code class="literal">SHOW PROFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句：
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sql-syntax.html#show-profiles" title="13.7.5.31 SHOW PROFILES语法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第13.7.5.31，“显示配置文件语法”</font></font></a>
        </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">INFORMATION_SCHEMA</code>
          <a class="link" href="/mysql-5.7-google-zh/information-schema.html#processlist-table" title="24.17 INFORMATION_SCHEMA PROCESSLIST表"><code class="literal">PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表：
           </font></font><a class="xref" href="/mysql-5.7-google-zh/information-schema.html#processlist-table" title="24.17 INFORMATION_SCHEMA PROCESSLIST表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第24.17节“INFORMATION_SCHEMA PROCESSLIST表”</font></font></a>
        </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          在</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中mysqladmin processlist的</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：
           </font></font><a class="xref" href="/mysql-5.7-google-zh/programs.html#mysqladmin" title="4.5.2 mysqladmin  - 用于管理MySQL服务器的客户端"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.5.2节“ </font></font><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中mysqladmin</font></font></strong></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -客户端管理MySQL服务器”</font></font></a>
        </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          性能架构</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#threads-table" title="25.11.16.3线程表"><code class="literal">threads</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          表，阶段表和锁定表：
           </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-miscellaneous-tables" title="25.11.16性能架构杂项表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.16节“性能架构杂项表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-stage-tables" title="25.11.5性能模式阶段事件表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.5节“性能架构阶段事件表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
           </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-lock-tables" title="25.11.12性能模式锁定表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.12节“性能架构锁表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">sys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构
           </font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html#sys-processlist" title="26.4.3.22进程列表和x $ processlist视图"><code class="literal">processlist</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图，呈现从性能架构信息
           </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#threads-table" title="25.11.16.3线程表"><code class="literal">threads</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中更方便的格式：</font></font><a class="xref" href="/mysql-5.7-google-zh/sys-schema.html#sys-processlist" title="26.4.3.22进程列表和x $ processlist视图"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第26.4.3.22，“ProcessList中和X $ PROCESSLIST意见”</font></font></a>
        </p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          该</font></font><code class="literal">sys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构
           </font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html#sys-session" title="26.4.3.33会话和x $会话视图"><code class="literal">session</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图，其中介绍有关用户会话的信息（如
           </font></font><code class="literal">sys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构
           </font></font><a class="link" href="/mysql-5.7-google-zh/sys-schema.html#sys-processlist" title="26.4.3.22进程列表和x $ processlist视图"><code class="literal">processlist</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图，但是过滤掉后台进程）：
           </font></font><a class="xref" href="/mysql-5.7-google-zh/sys-schema.html#sys-session" title="26.4.3.33会话和x $会话视图"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第26.4.3.33，“会议和X $会话视图”</font></font></a>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      访问</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#threads-table" title="25.11.16.3线程表"><code class="literal">threads</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要互斥，并且对服务器性能的影响最小。
      </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#processlist-table" title="24.17 INFORMATION_SCHEMA PROCESSLIST表"><code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于它们需要互斥体</font><font style="vertical-align: inherit;">而
       </font><font style="vertical-align: inherit;">具有负面的性能后果。
      </font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#threads-table" title="25.11.16.3线程表"><code class="literal">threads</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还显示有关后台线程，哪些信息
       </font></font><a class="link" href="/mysql-5.7-google-zh/information-schema.html#processlist-table" title="24.17 INFORMATION_SCHEMA PROCESSLIST表"><code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
       </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有。</font><font style="vertical-align: inherit;">这意味着</font></font><a class="link" href="/mysql-5.7-google-zh/performance-schema.html#threads-table" title="25.11.16.3线程表"><code class="literal">threads</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用来监视其他线程信息源无法进行的活动。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      您可以随时查看有关您自己的线索的信息。</font><font style="vertical-align: inherit;">要查看有关正在为其他帐户执行的线程的信息，您必须具有该</font></font><a class="link" href="/mysql-5.7-google-zh/security.html#priv_process"><code class="literal">PROCESS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限。
    </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      每个进程列表条目包含几条信息：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">Id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 是与该线程关联的客户端的连接标识符。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">Host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指出与该线程关联的帐户。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是该线程的默认数据库，或者</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有选择任何</font><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">Command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          指出线程正在做什么。
        </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          大多数州相当于非常快速的操作。</font><font style="vertical-align: inherit;">如果一个线程停留在一个给定的状态很多秒，可能有一个问题需要调查。
        </font></font></p></li><li class="listitem"><p>
          <code class="literal">Time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示线程处于当前状态的时间。</font><font style="vertical-align: inherit;">在某些情况下，线程的当前时间概念可能会发生变化：线程可以通过改变时间</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于正在处理来自主服务器的事件的从服务器上运行的线程，线程时间设置为事件中发现的时间，因此反映了主服务器上的当前时间，而不是从服务器上的当前时间。
        </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#set-variable" title="13.7.4.1变量赋值的SET语法"><code class="literal">SET
          TIMESTAMP = <em class="replaceable"><code>value</code></em></code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
          <code class="literal">Info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含线程正在执行的语句的文本，或者</font></font><code class="literal">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它没有执行。</font><font style="vertical-align: inherit;">默认情况下，该值仅包含语句的前100个字符。</font><font style="vertical-align: inherit;">要查看完整的语句，请使用
           </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW FULL
          PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      以下部分列出了可能的
       </font></font><code class="literal">Command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值和</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      按类别分组的值。</font><font style="vertical-align: inherit;">其中一些价值的含义是不言而喻的。</font><font style="vertical-align: inherit;">对于其他人，提供了额外的描述。
</font></font></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="thread-commands"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.1线程命令值</font></font></h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140528100356864"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        线程可以具有以下任何
         </font></font><code class="literal">Command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528100353840"></a>

            <a class="indexterm" name="idm140528100352352"></a>

            <code class="literal">Binlog Dump</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这是主服务器上的一个线程，用于将二进制日志内容发送到从服务器。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100348880"></a>

            <a class="indexterm" name="idm140528100347392"></a>

            <code class="literal">Change user</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行更改用户操作。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100343968"></a>

            <a class="indexterm" name="idm140528100342480"></a>

            <code class="literal">Close stmt</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在关闭一个准备好的语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100339072"></a>

            <a class="indexterm" name="idm140528100337584"></a>

            <code class="literal">Connect</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            复制从站连接到其主站。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100334176"></a>

            <a class="indexterm" name="idm140528100332688"></a>

            <code class="literal">Connect Out</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            复制从属设备正在连接到其主设备。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100329264"></a>

            <a class="indexterm" name="idm140528100327776"></a>

            <code class="literal">Create DB</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行创建数据库操作。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100324352"></a>

            <a class="indexterm" name="idm140528100322864"></a>

            <code class="literal">Daemon</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程在服务器内部，而不是为客户端连接提供服务的线程。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100319392"></a>

            <a class="indexterm" name="idm140528100317904"></a>

            <code class="literal">Debug</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在生成调试信息。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100314496"></a>

            <a class="indexterm" name="idm140528100313008"></a>

            <code class="literal">Delayed insert</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程是一个延迟插入处理程序。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100309600"></a>

            <a class="indexterm" name="idm140528100308112"></a>

            <code class="literal">Drop DB</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行drop-database操作。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100304688"></a>

            <a class="indexterm" name="idm140528100303200"></a>

            <code class="literal">Error</code>
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100300256"></a>

            <a class="indexterm" name="idm140528100298768"></a>

            <code class="literal">Execute</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行一个准备好的语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100295360"></a>

            <a class="indexterm" name="idm140528100293872"></a>

            <code class="literal">Fetch</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在从执行准备好的语句中获取结果。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100290416"></a>

            <a class="indexterm" name="idm140528100288928"></a>

            <code class="literal">Field List</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在检索表列的信息。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100285504"></a>

            <a class="indexterm" name="idm140528100284016"></a>

            <code class="literal">Init DB</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在选择一个默认数据库。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100280608"></a>

            <a class="indexterm" name="idm140528100279120"></a>

            <code class="literal">Kill</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在杀死另一个线程。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100275712"></a>

            <a class="indexterm" name="idm140528100274224"></a>

            <code class="literal">Long Data</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行准备好的语句的结果中检索长数据。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100270768"></a>

            <a class="indexterm" name="idm140528100269280"></a>

            <code class="literal">Ping</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理服务器ping请求。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100265872"></a>

            <a class="indexterm" name="idm140528100264384"></a>

            <code class="literal">Prepare</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在准备一个准备好的声明。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100260976"></a>

            <a class="indexterm" name="idm140528100259488"></a>

            <code class="literal">Processlist</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在生成有关服务器线程的信息。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100256064"></a>

            <a class="indexterm" name="idm140528100254576"></a>

            <code class="literal">Query</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行一个语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100251168"></a>

            <a class="indexterm" name="idm140528100249680"></a>

            <code class="literal">Quit</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在终止。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100246288"></a>

            <a class="indexterm" name="idm140528100244800"></a>

            <code class="literal">Refresh</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在刷新表，日志或缓存，或重置状态变量或复制服务器信息。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100241312"></a>

            <a class="indexterm" name="idm140528100239824"></a>

            <code class="literal">Register Slave</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在注册一个从服务器。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100236416"></a>

            <a class="indexterm" name="idm140528100234928"></a>

            <code class="literal">Reset stmt</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在重置一个准备好的语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100231520"></a>

            <a class="indexterm" name="idm140528100230032"></a>

            <code class="literal">Set option</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在设置或重置客户端语句执行选项。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100226576"></a>

            <a class="indexterm" name="idm140528100225088"></a>

            <code class="literal">Shutdown</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在关闭服务器。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100221680"></a>

            <a class="indexterm" name="idm140528100220192"></a>

            <code class="literal">Sleep</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在等待客户端向其发送新的语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100216752"></a>

            <a class="indexterm" name="idm140528100215264"></a>

            <code class="literal">Statistics</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在生成服务器状态信息。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100211840"></a>

            <a class="indexterm" name="idm140528100210352"></a>

            <code class="literal">Table Dump</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在将表格内容发送到从服务器。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100206928"></a>

            <a class="indexterm" name="idm140528100205440"></a>

            <code class="literal">Time</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            没用过。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="general-thread-states"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.2一般线程状态</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528100201168"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表描述了</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        与常规查询处理关联的</font><font style="vertical-align: inherit;">线程</font><font style="vertical-align: inherit;">值，而不是更复杂的特定活动（如复制）。</font><font style="vertical-align: inherit;">其中许多仅用于查找服务器中的错误。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528100197552"></a>

            <a class="indexterm" name="idm140528100196064"></a>

            <code class="literal">After create</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当线程在创建表的函数的末尾创建表（包括内部临时表）时，会发生这种情况。</font><font style="vertical-align: inherit;">即使由于某些错误而无法创建表，也会使用此状态。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100192448"></a>

            <a class="indexterm" name="idm140528100190960"></a>

            <code class="literal">Analyzing</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在计算</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格密钥分布（例如for
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100185568"></a>

            <a class="indexterm" name="idm140528100184080"></a>

            <code class="literal">checking permissions</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在检查服务器是否具有执行语句所需的特权。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100180608"></a>

            <a class="indexterm" name="idm140528100179120"></a>

            <code class="literal">Checking table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行表格检查操作。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100175696"></a>

            <a class="indexterm" name="idm140528100174208"></a>

            <code class="literal">cleaning up</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程已经处理了一个命令并准备释放内存并重置某些状态变量。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100170720"></a>

            <a class="indexterm" name="idm140528100169232"></a>

            <code class="literal">closing tables</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在将更改后的表数据刷新到磁盘并关闭使用的表。</font><font style="vertical-align: inherit;">这应该是一个快速的操作。</font><font style="vertical-align: inherit;">如果没有，请确认您没有完整的磁盘，并且磁盘的使用不是很重。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100165616"></a>

            <a class="indexterm" name="idm140528100164112"></a>

            <code class="literal">converting HEAP to ondisk</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在将内部临时表从
             </font></font><code class="literal">MEMORY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表转换为磁盘表。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100159920"></a>

            <a class="indexterm" name="idm140528100158432"></a>

            <code class="literal">copy to tmp table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">这种状态发生在创建新结构的表之后，但在将行复制到其中之前。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于处于此状态的线程，可以使用性能模式来获取有关复制操作的进度。</font><font style="vertical-align: inherit;">请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-stage-tables" title="25.11.5性能模式阶段事件表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.5节“性能架构阶段事件表”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100152352"></a>

            <a class="indexterm" name="idm140528100150864"></a>

            <code class="literal">Copying to group table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果语句具有不同</font></font><code class="literal">ORDER BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
             </font></font><code class="literal">GROUP BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准，各行按组排列和复制到一个临时表。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100145952"></a>

            <a class="indexterm" name="idm140528100144464"></a>

            <code class="literal">Copying to tmp table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在复制到内存中的临时表。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100141040"></a>

            <a class="indexterm" name="idm140528100139552"></a>

            <code class="literal">altering table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在执行就地过程
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100134944"></a>

            <a class="indexterm" name="idm140528100133440"></a>

            <code class="literal">Copying to tmp table on disk</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在复制到磁盘上的临时表。</font><font style="vertical-align: inherit;">临时结果集变得过大（请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-temporary-tables" title="8.4.4在MySQL中使用内部临时表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">因此，线程正在将临时表从内存更改为基于磁盘的格式以节省内存。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100129040"></a>

            <a class="indexterm" name="idm140528100127552"></a>

            <code class="literal">Creating index</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理</font></font><code class="literal">ALTER TABLE ... ENABLE
            KEYS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100122768"></a>

            <a class="indexterm" name="idm140528100121280"></a>

            <code class="literal">Creating sort index</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理一个
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用内部临时表解析的问题。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100116592"></a>

            <a class="indexterm" name="idm140528100115104"></a>

            <code class="literal">creating table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在创建一个表。</font><font style="vertical-align: inherit;">这包括创建临时表。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100111648"></a>

            <a class="indexterm" name="idm140528100110160"></a>

            <code class="literal">Creating tmp table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在内存或磁盘上创建一个临时表。</font><font style="vertical-align: inherit;">如果该表在内存中创建，但稍后转换为磁盘上的表，则该操作期间的状态将为</font></font><code class="literal">Copying to tmp table on
            disk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100105840"></a>

            <a class="indexterm" name="idm140528100104320"></a>

            <code class="literal">committing alter table to storage engine</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器已完成就地
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并正在提交结果。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100099584"></a>

            <a class="indexterm" name="idm140528100098080"></a>

            <code class="literal">deleting from main table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在执行多表删除的第一部分。</font><font style="vertical-align: inherit;">它仅从第一个表中删除，并保存用于从其他（引用）表中删除的列和偏移量。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100094448"></a>

            <a class="indexterm" name="idm140528100092944"></a>

            <code class="literal">deleting from reference tables</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在执行多表删除的第二部分，并从其他表中删除匹配的行。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100089408"></a>

            <a class="indexterm" name="idm140528100087904"></a>

            <code class="literal">discard_or_import_tablespace</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理一个</font></font><code class="literal">ALTER TABLE ... DISCARD
            TABLESPACE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">一个</font></font><code class="literal">ALTER TABLE ... IMPORT
            TABLESPACE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100082976"></a>

            <a class="indexterm" name="idm140528100081520"></a>

            <code class="literal">end</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这发生在结束，但的清理之前
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#create-view" title="13.1.21 CREATE VIEW语法"><code class="literal">CREATE VIEW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100070768"></a>

            <a class="indexterm" name="idm140528100069280"></a>

            <code class="literal">executing</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程已经开始执行语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100065872"></a>

            <a class="indexterm" name="idm140528100064368"></a>

            <code class="literal">Execution of init_command</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行</font></font><code class="literal">init_command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统变量</font><font style="vertical-align: inherit;">值中的语句
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100060176"></a>

            <a class="indexterm" name="idm140528100058688"></a>

            <code class="literal">freeing items</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程执行了一个命令。</font><font style="vertical-align: inherit;">在这种状态下完成的一些项目释放涉及查询缓存。</font><font style="vertical-align: inherit;">这种状态通常会跟着</font></font><code class="literal">cleaning up</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100054448"></a>

            <a class="indexterm" name="idm140528100052960"></a>

            <code class="literal">FULLTEXT initialization</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在准备执行自然语言全文搜索。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100049504"></a>

            <a class="indexterm" name="idm140528100048016"></a>

            <code class="literal">init</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            出现这种情况的初始化之前
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。</font><font style="vertical-align: inherit;">服务器在此状态下采取的操作包括刷新二进制日志，</font></font><code class="literal">InnoDB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志和一些查询缓存清理操作。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于该</font></font><code class="literal">end</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">州，可能会发生以下操作：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在表中的数据发生更改后移除查询缓存条目
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                将事件写入二进制日志
              </font></font></p></li><li class="listitem"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                释放内存缓冲区，包括Blob
</font></font></p></li></ul>
</div>
</li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100033424"></a>

            <a class="indexterm" name="idm140528100031936"></a>

            <code class="literal">Killed</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有人</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#kill" title="13.7.6.4 KILL语法"><code class="literal">KILL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            向线程</font><font style="vertical-align: inherit;">发送了一条</font><font style="vertical-align: inherit;">语句，下次检查kill标志时应该放弃。</font><font style="vertical-align: inherit;">该标志在MySQL的每个主循环中都被检查过，但在某些情况下，线程可能仍然需要很短时间才能死亡。</font><font style="vertical-align: inherit;">如果线程被其他线程锁定，则一旦其他线程释放其锁定，kill将立即生效。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100026544"></a>

            <a class="indexterm" name="idm140528100025056"></a>

            <code class="literal">logging slow query</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在向慢查询日志写入语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100021632"></a>

            <a class="indexterm" name="idm140528100020144"></a>

            <code class="literal">login</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            连接线程的初始状态，直到客户端成功通过身份验证。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100016672"></a>

            <a class="indexterm" name="idm140528100015184"></a>

            <code class="literal">manage keys</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在启用或禁用表索引。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100011760"></a>

            <a class="indexterm" name="idm140528100010272"></a>

            <code class="literal">NULL</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个状态用于</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-processlist" title="13.7.5.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
            PROCESSLIST</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528100005632"></a>

            <a class="indexterm" name="idm140528100004144"></a>

            <code class="literal">Opening tables</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正试图打开一个表。</font><font style="vertical-align: inherit;">这应该是非常快的程序，除非有什么阻止开放。</font><font style="vertical-align: inherit;">例如，一条</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或一条
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句可以防止在语句结束之前打开一个表。</font><font style="vertical-align: inherit;">还值得检查一下，你的</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值是否足够大。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099996800"></a>

            <a class="indexterm" name="idm140528099995312"></a>

            <code class="literal">optimizing</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在为查询执行初始优化。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099991888"></a>

            <a class="indexterm" name="idm140528099990400"></a>

            <code class="literal">preparing</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这种状态发生在查询优化期间。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099986992"></a>

            <a class="indexterm" name="idm140528099985504"></a>

            <code class="literal">Purging old relay logs</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在删除不需要的中继日志文件。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099982080"></a>

            <a class="indexterm" name="idm140528099980592"></a>

            <code class="literal">query end</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这种状态发生在处理查询之后但在</font></font><code class="literal">freeing items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态</font><font style="vertical-align: inherit;">之前
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099976448"></a>

            <a class="indexterm" name="idm140528099974960"></a>

            <code class="literal">Receiving from client</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在从客户端读取数据包。</font><font style="vertical-align: inherit;">这个状态</font></font><code class="literal">Reading from net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL 5.7.8之前</font><font style="vertical-align: inherit;">被调用</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099970768"></a>

            <a class="indexterm" name="idm140528099969280"></a>

            <code class="literal">Removing duplicates</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            查询
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT
            DISTINCT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以这种方式使用，MySQL无法在早期阶段优化独特的操作。</font><font style="vertical-align: inherit;">因此，在将结果发送给客户端之前，MySQL需要额外的阶段来删除所有重复的行。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099964400"></a>

            <a class="indexterm" name="idm140528099962912"></a>

            <code class="literal">removing tmp table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程在处理</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句</font><font style="vertical-align: inherit;">后删除内部临时表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果没有创建临时表，则不使用此状态。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099958144"></a>

            <a class="indexterm" name="idm140528099956656"></a>

            <code class="literal">rename</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在重命名一个表。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099953264"></a>

            <a class="indexterm" name="idm140528099951776"></a>

            <code class="literal">rename result table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，创建了新表，并且正在重命名它以替换原始表。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099947056"></a>

            <a class="indexterm" name="idm140528099945568"></a>

            <code class="literal">Reopen tables</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程获得了表的锁，但在获取锁之后发现基础表结构发生了变化。</font><font style="vertical-align: inherit;">它释放了锁，关闭了桌子，并试图重新打开它。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099941984"></a>

            <a class="indexterm" name="idm140528099940496"></a>

            <code class="literal">Repair by sorting</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            修复代码正在使用排序来创建索引。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099937072"></a>

            <a class="indexterm" name="idm140528099935568"></a>

            <code class="literal">preparing for alter table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正准备执行就地
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099930880"></a>

            <a class="indexterm" name="idm140528099929392"></a>

            <code class="literal">Repair done</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程已完成对</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表格</font><font style="vertical-align: inherit;">的多线程修复
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099925248"></a>

            <a class="indexterm" name="idm140528099923760"></a>

            <code class="literal">Repair with keycache</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            修复代码正在通过密钥缓存逐个创建密钥。</font><font style="vertical-align: inherit;">这比</font></font><code class="literal">Repair by
            sorting</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">慢得多</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099919552"></a>

            <a class="indexterm" name="idm140528099918064"></a>

            <code class="literal">Rolling back</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在回滚事务。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099914656"></a>

            <a class="indexterm" name="idm140528099913168"></a>

            <code class="literal">Saving state</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">诸如修复或分析之类的表操作，线程正在将新的表状态保存到</font></font><code class="filename">.MYI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件头。</font><font style="vertical-align: inherit;">状态包括诸如行数，
             </font></font><code class="literal">AUTO_INCREMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计数器和密钥分布等信息。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099907440"></a>

            <a class="indexterm" name="idm140528099905936"></a>

            <code class="literal">Searching rows for update</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行第一阶段以在更新它们之前查找所有匹配的行。</font><font style="vertical-align: inherit;">如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#update" title="13.2.11更新语法"><code class="literal">UPDATE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在更改用于查找相关行的索引，则必须执行此操作。
          </font></font></p></li><li class="listitem"><p>
            <code class="literal">Sending data</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在读取和处理</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的</font><font style="vertical-align: inherit;">行
             </font><font style="vertical-align: inherit;">，并将数据发送到客户端。</font><font style="vertical-align: inherit;">由于在此状态期间发生的操作倾向于执行大量的磁盘访问（读取），因此它通常是给定查询的整个生命周期中运行时间最长的状态。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099897696"></a>

            <a class="indexterm" name="idm140528099896208"></a>

            <code class="literal">Sending to client</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在向客户端写入一个数据包。</font><font style="vertical-align: inherit;">这个状态</font></font><code class="literal">Writing to net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在MySQL 5.7.8之前</font><font style="vertical-align: inherit;">被调用</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099892016"></a>

            <a class="indexterm" name="idm140528099890528"></a>

            <code class="literal">setup</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在开始一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER
            TABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099885904"></a>

            <a class="indexterm" name="idm140528099884416"></a>

            <code class="literal">Sorting for group</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在做一个排序来满足一个</font></font><code class="literal">GROUP
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099880304"></a>

            <a class="indexterm" name="idm140528099878816"></a>

            <code class="literal">Sorting for order</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在做一个排序来满足一个</font></font><code class="literal">ORDER
            BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099874704"></a>

            <a class="indexterm" name="idm140528099873216"></a>

            <code class="literal">Sorting index</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在对索引页进行排序，以在</font></font><code class="literal">MyISAM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表优化操作</font><font style="vertical-align: inherit;">期间实现更高效的访问</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099869024"></a>

            <a class="indexterm" name="idm140528099867536"></a>

            <code class="literal">Sorting result</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            对于一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明，这与</font></font><code class="literal">Creating sort index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非临时表格</font><font style="vertical-align: inherit;">类似</font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099862160"></a>

            <a class="indexterm" name="idm140528099860672"></a>

            <code class="literal">statistics</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在计算统计信息以开发查询执行计划。</font><font style="vertical-align: inherit;">如果一个线程长时间处于这种状态，那么服务器可能是磁盘绑定执行其他工作。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099857088"></a>

            <a class="indexterm" name="idm140528099856016"></a>

            <a class="indexterm" name="idm140528099854528"></a>

            <a class="indexterm" name="idm140528099853040"></a>

            <code class="literal">System lock</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程已经调用</font></font><code class="literal">mysql_lock_tables()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            并且线程状态自此以后没有更新。</font><font style="vertical-align: inherit;">这是一个非常普遍的状态，可能由于许多原因而发生。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            例如，线程将要求或正在等待表的内部或外部系统锁。</font></font><a class="link" href="/mysql-5.7-google-zh/innodb-storage-engine.html" title="第14章InnoDB存储引擎"><code class="literal">InnoDB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在执行期间等待表级锁定
             </font><font style="vertical-align: inherit;">时可能会发生这种情况</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#lock-tables" title="13.3.5锁定表和解锁表语法"><code class="literal">LOCK TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此状态是由外部锁请求引起的，并且您没有使用</font><font style="vertical-align: inherit;">访问相同</font><font style="vertical-align: inherit;">
            表的</font><font style="vertical-align: inherit;">多个</font></font><a class="link" href="/mysql-5.7-google-zh/programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld</font></font></strong></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器，则</font></font><a class="link" href="/mysql-5.7-google-zh/storage-engines.html#myisam-storage-engine" title="15.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用该</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#option_mysqld_external-locking"><code class="option">--skip-external-locking</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            选项</font><font style="vertical-align: inherit;">禁用外部系统锁
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，外部锁定在默认情况下是禁用的，所以很可能这个选项不起作用。</font><font style="vertical-align: inherit;">对于
            </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-profile" title="13.7.5.30 SHOW PROFILE语法"><code class="literal">SHOW PROFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这个状态意味着线程正在请求锁（不等待它）。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099840592"></a>

            <a class="indexterm" name="idm140528099839104"></a>

            <code class="literal">update</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正准备开始更新表。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099835680"></a>

            <a class="indexterm" name="idm140528099834192"></a>

            <code class="literal">Updating</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在搜索要更新的行并正在更新它们。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099830752"></a>

            <a class="indexterm" name="idm140528099829264"></a>

            <code class="literal">updating main table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在执行多表更新的第一部分。</font><font style="vertical-align: inherit;">它只更新第一个表格，并保存用于更新其他（参考）表格的列和偏移量。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099825664"></a>

            <a class="indexterm" name="idm140528099824160"></a>

            <code class="literal">updating reference tables</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在执行多表更新的第二部分，并从其他表中更新匹配的行。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099820624"></a>

            <a class="indexterm" name="idm140528099819136"></a>

            <code class="literal">User lock</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程将要求或正在等待通过</font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫</font><font style="vertical-align: inherit;">请求的咨询锁定
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因为
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-profile" title="13.7.5.30 SHOW PROFILE语法"><code class="literal">SHOW PROFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个状态意味着线程正在请求锁（不等待它）。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099813104"></a>

            <a class="indexterm" name="idm140528099811616"></a>

            <code class="literal">User sleep</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程调用了一个
             </font></font><a class="link" href="/mysql-5.7-google-zh/functions.html#function_sleep"><code class="literal">SLEEP()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099806992"></a>

            <a class="indexterm" name="idm140528099805504"></a>

            <code class="literal">Waiting for commit lock</code>
          </p><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH TABLES WITH READ LOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            正在等待提交锁定。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099800864"></a>

            <a class="indexterm" name="idm140528099799360"></a>

            <code class="literal">Waiting for global read lock</code>
          </p><p>
            <a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH TABLES WITH READ LOCK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            正在等待全局读取锁定或</font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在设置</font><font style="vertical-align: inherit;">全局
             </font><font style="vertical-align: inherit;">系统变量。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099793392"></a>

            <a class="indexterm" name="idm140528099791904"></a>

            <code class="literal">Waiting for tables</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程得到了一个通知，表格的底层结构已经改变，并且需要重新打开该表以获取新结构。</font><font style="vertical-align: inherit;">但是，要重新打开该表，必须等到所有其他线程关闭相关表。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该通知发生如果另一个线程已使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或有问题的表下面的语句之一：
             </font><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">，或
             </font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">FLUSH TABLES
            <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#rename-table" title="13.1.33 RENAME TABLE语法"><code class="literal">RENAME TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099779280"></a>

            <a class="indexterm" name="idm140528099777792"></a>

            <code class="literal">Waiting for table flush</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH
            TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并等待所有线程关闭它们的表，或者线程得到通知，表的底层结构已更改，并且需要重新打开表以获取新结构。</font><font style="vertical-align: inherit;">但是，要重新打开该表，必须等到所有其他线程都关闭表中的表。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该通知发生如果另一个线程已使用
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或有问题的表下面的语句之一：
             </font><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">，
             </font><font style="vertical-align: inherit;">，或
             </font><font style="vertical-align: inherit;">。
          </font></font><code class="literal">FLUSH TABLES
            <em class="replaceable"><code>tbl_name</code></em></code><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#alter-table" title="13.1.8 ALTER TABLE语法"><code class="literal">ALTER TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#rename-table" title="13.1.33 RENAME TABLE语法"><code class="literal">RENAME TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE语法"><code class="literal">REPAIR TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE语法"><code class="literal">ANALYZE TABLE</code></a><font style="vertical-align: inherit;"></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE TABLE</code></a><font style="vertical-align: inherit;"></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099763856"></a>

            <a class="indexterm" name="idm140528099762352"></a>

            <a class="indexterm" name="idm140528099760848"></a>

            <a class="indexterm" name="idm140528099759344"></a>

            <a class="indexterm" name="idm140528099757840"></a>

            <a class="indexterm" name="idm140528099756336"></a>

            <a class="indexterm" name="idm140528099754816"></a>

            <a class="indexterm" name="idm140528099753296"></a>

            <a class="indexterm" name="idm140528099751776"></a>

            <a class="indexterm" name="idm140528099750256"></a>

            <a class="indexterm" name="idm140528099748752"></a>

            <a class="indexterm" name="idm140528099747248"></a>

            <a class="indexterm" name="idm140528099745744"></a>

            <a class="indexterm" name="idm140528099744240"></a>

            <a class="indexterm" name="idm140528099742736"></a>

            <code class="literal">Waiting for <em class="replaceable"><code>lock_type</code></em>
            lock</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在等待</font></font><code class="literal">THR_LOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从元数据锁定子系统</font><font style="vertical-align: inherit;">获取
             </font><font style="vertical-align: inherit;">锁或锁，其中
             </font></font><em class="replaceable"><code>lock_type</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示锁的类型。
          </font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这个状态表示等待一个
             </font></font><code class="literal">THR_LOCK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">Waiting for table level lock</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这些状态表示等待元数据锁定：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">Waiting for event metadata lock</code>
              </p></li><li class="listitem"><p>
                <code class="literal">Waiting for global read lock</code>
              </p></li><li class="listitem"><p>
                <code class="literal">Waiting for schema metadata lock</code>
              </p></li><li class="listitem"><p>
                <code class="literal">Waiting for stored function metadata
                lock</code>
              </p></li><li class="listitem"><p>
                <code class="literal">Waiting for stored procedure metadata
                lock</code>
              </p></li><li class="listitem"><p>
                <code class="literal">Waiting for table metadata lock</code>
              </p></li><li class="listitem"><p>
                <code class="literal">Waiting for trigger metadata lock</code>
</p></li></ul>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            有关表锁指示器的信息，请参见
             </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#internal-locking" title="8.11.1内部锁定方法"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.1节“内部锁定方法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关元数据锁定的信息，请参见</font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#metadata-locking" title="8.11.4元数据锁定"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.11.4节“元数据锁定”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要查看哪些锁阻塞了锁请求，请使用</font></font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-lock-tables" title="25.11.12性能模式锁定表"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第25.11.12节“性能模式锁表”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的
             </font><a class="xref" href="/mysql-5.7-google-zh/performance-schema.html#performance-schema-lock-tables" title="25.11.12 Performance Schema Lock Tables"><font style="vertical-align: inherit;">性能模式锁定表</font></a><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099720448"></a>

            <a class="indexterm" name="idm140528099718960"></a>

            <code class="literal">Waiting on cond</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在等待条件变为真的通用状态。</font><font style="vertical-align: inherit;">没有特定的状态信息可用。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099715440"></a>

            <a class="indexterm" name="idm140528099713952"></a>

            <code class="literal">Writing to net</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在向网络写入数据包。</font><font style="vertical-align: inherit;">这个状态被称为</font></font><code class="literal">Sending to client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 5.7.8。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="query-cache-thread-states"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.3查询缓存线程状态</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528099708864"></a><a class="indexterm" name="idm140528099707376"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些线程状态与查询缓存相关联（请参见
         </font></font><a class="xref" href="/mysql-5.7-google-zh/optimization.html#query-cache" title="8.10.3 MySQL查询缓存"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.10.3节“MySQL查询缓存”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528099703968"></a>

            <a class="indexterm" name="idm140528099702464"></a>

            <code class="literal">checking privileges on cached query</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在检查用户是否有权访问缓存的查询结果。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099698960"></a>

            <a class="indexterm" name="idm140528099697456"></a>

            <code class="literal">checking query cache for query</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器正在检查当前查询是否存在于查询缓存中。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099693968"></a>

            <a class="indexterm" name="idm140528099692464"></a>

            <code class="literal">invalidating query cache entries</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            由于基础表已更改，因此查询缓存条目被标记为无效。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099688960"></a>

            <a class="indexterm" name="idm140528099687456"></a>

            <code class="literal">sending cached result to client</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器从查询缓存中获取查询的结果并将其发送到客户端。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099683952"></a>

            <a class="indexterm" name="idm140528099682448"></a>

            <code class="literal">storing result in query cache</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器将查询的结果存储在查询缓存中。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099678976"></a>

            <a class="indexterm" name="idm140528099677472"></a>

            <code class="literal">Waiting for query cache lock</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此状态在会话正在等待采取查询缓存锁定时发生。</font><font style="vertical-align: inherit;">这种情况可能需要执行一些查询缓存操作，如任何声明
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#insert" title="13.2.5 INSERT语法"><code class="literal">INSERT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效的内容查询缓存，一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#select" title="13.2.9 SELECT语法"><code class="literal">SELECT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是寻找一个缓存项，
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#reset" title="13.7.6.6 RESET语法"><code class="literal">RESET QUERY
            CACHE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="master-thread-states"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.4复制主线程状态</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528099667952"></a><a class="indexterm" name="idm140528099666496"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表显示了您可能在</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font><code class="literal">Binlog Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程</font><font style="vertical-align: inherit;">列中
         </font><font style="vertical-align: inherit;">看到的最常见状态</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><code class="literal">Binlog Dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主服务器</font><font style="vertical-align: inherit;">上看不到任何
         </font><font style="vertical-align: inherit;">线程，则表示复制未运行; </font><font style="vertical-align: inherit;">也就是说，目前没有奴隶连接。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528099661440"></a>

            <a class="indexterm" name="idm140528099659920"></a>

            <code class="literal">Finished reading one binlog; switching to next
            binlog</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程已经完成读取二进制日志文件并打开下一个发送到从站。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099656368"></a>

            <a class="indexterm" name="idm140528099654832"></a>

            <code class="literal">Master has sent all binlog to slave; waiting for
            more updates</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程已经从二进制日志中读取所有剩余的更新并将它们发送给从服务器。</font><font style="vertical-align: inherit;">该线程现在处于空闲状态，正在等待新事件出现在由主服务器上发生的新更新导致的二进制日志中。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099651104"></a>

            <a class="indexterm" name="idm140528099649600"></a>

            <code class="literal">Sending binlog event to slave</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            二进制日志由</font></font><span class="emphasis"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font></font></em></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组成</font><font style="vertical-align: inherit;">，其中事件通常是更新和其他一些信息。</font><font style="vertical-align: inherit;">线程已经从二进制日志中读取一个事件，并且正在将它发送给从站。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099645568"></a>

            <a class="indexterm" name="idm140528099644064"></a>

            <code class="literal">Waiting to finalize termination</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程停止时发生的非常简短的状态。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="slave-io-thread-states"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.5复制从属I / O线程状态</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528099639664"></a><a class="indexterm" name="idm140528099638208"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表显示了您在</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从服务器I / O线程列中</font><font style="vertical-align: inherit;">看到的最常见状态
         </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此状态也出现在</font></font><code class="literal">Slave_IO_State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">列中</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#show-slave-status" title="13.7.5.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW SLAVE
        STATUS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此您可以通过使用该语句获得关于正在发生的事情的良好视图。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528099632624"></a>

            <a class="indexterm" name="idm140528099631136"></a>

            <code class="literal">Checking master version</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与主站建立连接后，状态会非常短暂地发生。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099627664"></a>

            <a class="indexterm" name="idm140528099626176"></a>

            <code class="literal">Connecting to master</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在尝试连接到主服务器。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099622752"></a>

            <a class="indexterm" name="idm140528099621248"></a>

            <code class="literal">Queueing master event to the relay log</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程已经读取了一个事件并将其复制到中继日志中，以便SQL线程可以处理它。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099617728"></a>

            <a class="indexterm" name="idm140528099616208"></a>

            <code class="literal">Reconnecting after a failed binlog dump
            request</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正尝试重新连接到主设备。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099612704"></a>

            <a class="indexterm" name="idm140528099611184"></a>

            <code class="literal">Reconnecting after a failed master event
            read</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正尝试重新连接到主设备。</font><font style="vertical-align: inherit;">当连接再次建立时，状态变为
             </font></font><code class="literal">Waiting for master to send event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099606880"></a>

            <a class="indexterm" name="idm140528099605376"></a>

            <code class="literal">Registering slave on master</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            建立与主站的连接后，发生非常短暂的状态。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099601888"></a>

            <a class="indexterm" name="idm140528099600400"></a>

            <code class="literal">Requesting binlog dump</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            与主站建立连接后，状态会非常短暂地发生。</font><font style="vertical-align: inherit;">该线程向所述主机发送对其二进制日志内容的请求，从所请求的二进制日志文件名称和位置开始。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099596768"></a>

            <a class="indexterm" name="idm140528099595264"></a>

            <code class="literal">Waiting for its turn to commit</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当从线程正在等待较早的工作线程提交时发生的状态，如果
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_preserve_commit_order"><code class="literal">slave_preserve_commit_order</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            启用。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099590464"></a>

            <a class="indexterm" name="idm140528099588960"></a>

            <code class="literal">Waiting for master to send event</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程已连接到主服务器并等待二进制日志事件到达。</font><font style="vertical-align: inherit;">如果主站空闲，这可能会持续很长时间。</font><font style="vertical-align: inherit;">如果等待持续
             </font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_net_timeout"><code class="literal">slave_net_timeout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数秒，则发生超时。</font><font style="vertical-align: inherit;">此时，线程认为连接断开并尝试重新连接。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099583920"></a>

            <a class="indexterm" name="idm140528099582464"></a>

            <code class="literal">Waiting for master update</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            之前的初始状态</font></font><code class="literal">Connecting to
            master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099578320"></a>

            <a class="indexterm" name="idm140528099576816"></a>

            <code class="literal">Waiting for slave mutex on exit</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在停止时发生的状态。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099573360"></a>

            <a class="indexterm" name="idm140528099571824"></a>

            <code class="literal">Waiting for the slave SQL thread to free enough
            relay log space</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            您正在使用非零
             </font></font><a class="link" href="/mysql-5.7-google-zh/server-administration.html#sysvar_relay_log_space_limit"><code class="literal">relay_log_space_limit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            值，并且中继日志已经变得足够大，以至于它们的组合大小超过此值。</font><font style="vertical-align: inherit;">I / O线程正在等待，直到SQL线程通过处理中继日志内容来释放足够的空间，以便它可以删除一些中继日志文件。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099566720"></a>

            <a class="indexterm" name="idm140528099565200"></a>

            <code class="literal">Waiting to reconnect after a failed binlog dump
            request</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            如果二进制日志转储请求失败（由于断开连接），线程在睡眠时进入此状态，然后尝试定期重新连接。</font><font style="vertical-align: inherit;">重试之间的时间间隔可以使用</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">指定
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099560320"></a>

            <a class="indexterm" name="idm140528099558800"></a>

            <code class="literal">Waiting to reconnect after a failed master event
            read</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            阅读时发生错误（由于断开连接）。</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在尝试重新连接之前</font><font style="vertical-align: inherit;">，线程正在由</font><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">设置的秒数</font><font style="vertical-align: inherit;">（默认为60）</font><font style="vertical-align: inherit;">休眠
             </font><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="slave-sql-thread-states"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.6复制从SQL SQL线程状态</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528099552976"></a><a class="indexterm" name="idm140528099551520"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        以下列表显示了您可能在</font></font><code class="literal">State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从属服务器SQL线程列中</font><font style="vertical-align: inherit;">看到的最常见状态</font><font style="vertical-align: inherit;">：
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528099548032"></a>

            <a class="indexterm" name="idm140528099546544"></a>

            <code class="literal">Killing slave</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理一个</font></font><code class="literal">STOP SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099542416"></a>

            <a class="indexterm" name="idm140528099540880"></a>

            <code class="literal">Making temporary file (append) before replaying
            LOAD DATA INFILE</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行一条
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句，并将数据附加到一个临时文件，该文件包含从机将读取行的数据。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099536000"></a>

            <a class="indexterm" name="idm140528099534464"></a>

            <code class="literal">Making temporary file (create) before replaying
            LOAD DATA INFILE</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在执行
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句并创建一个临时文件，该文件包含从机将读取行的数据。</font><font style="vertical-align: inherit;">只有</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE语法"><code class="literal">LOAD DATA
            INFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行早于版本5.0.3的MySQL版本的主机记录</font><font style="vertical-align: inherit;">原始</font><font style="vertical-align: inherit;">语句时</font><font style="vertical-align: inherit;">才会遇到此状态
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099528192"></a>

            <a class="indexterm" name="idm140528099526688"></a>

            <code class="literal">Reading event from the relay log</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程从中继日志中读取了一个事件，以便处理该事件。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099523200"></a>

            <a class="indexterm" name="idm140528099521680"></a>

            <code class="literal">Slave has read all relay log; waiting for more
            updates</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程处理了中继日志文件中的所有事件，现在正在等待I / O线程将新事件写入中继日志。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099518080"></a>

            <a class="indexterm" name="idm140528099516576"></a>

            <code class="literal">Waiting for an event from Coordinator</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            使用多线程从站（</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大于1），其中一个从属工作线程正在等待来自协调程序线程的事件。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099511696"></a>

            <a class="indexterm" name="idm140528099510240"></a>

            <code class="literal">Waiting for slave mutex on exit</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程停止时发生的非常简短的状态。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099506784"></a>

            <a class="indexterm" name="idm140528099505264"></a>

            <code class="literal">Waiting for Slave Workers to free pending
            events</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            当Worker处理的事件总大小超过</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_pending_jobs_size_max"><code class="literal">slave_pending_jobs_size_max</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            系统变量</font><font style="vertical-align: inherit;">的大小时，会发生此等待操作
             </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当尺寸降到这个限制以下时，协调员恢复调度。</font><font style="vertical-align: inherit;">只有</font></font><a class="link" href="/mysql-5.7-google-zh/replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为大于0 </font><font style="vertical-align: inherit;">时才会发生此状态
             </font><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099498928"></a>

            <a class="indexterm" name="idm140528099497472"></a>

            <code class="literal">Waiting for the next event in relay log</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            之前的初始状态</font></font><code class="literal">Reading event from the
            relay log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099493312"></a>

            <a class="indexterm" name="idm140528099491776"></a>

            <code class="literal">Waiting until MASTER_DELAY seconds after master
            executed event</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            SQL线程已经读取了一个事件，但正在等待从属延迟失效。</font><font style="vertical-align: inherit;">这个延迟是通过</font></font><code class="literal">MASTER_DELAY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">设置
             </font><font style="vertical-align: inherit;">的
             </font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>
<p><font style="vertical-align: inherit;"></font><code class="literal">Info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL线程</font><font style="vertical-align: inherit;">
        的</font><font style="vertical-align: inherit;">列也可以显示语句的文本。</font><font style="vertical-align: inherit;">这表明线程已经从中继日志中读取了一个事件，从中提取了语句，并且可能正在执行它。
</font></font></p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="slave-connection-thread-states"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.7复制从属连接线程状态</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528099483872"></a><a class="indexterm" name="idm140528099482384"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些线程状态出现在复制从服务器上，但与连接线程关联，而不与I / O或SQL线程关联。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528099478704"></a>

            <a class="indexterm" name="idm140528099477216"></a>

            <code class="literal">Changing master</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理一个</font></font><a class="link" href="/mysql-5.7-google-zh/sql-syntax.html#change-master-to" title="13.4.2.1将主设备更改为语法"><code class="literal">CHANGE
            MASTER TO</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099472624"></a>

            <a class="indexterm" name="idm140528099471136"></a>

            <code class="literal">Killing slave</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理一个</font></font><code class="literal">STOP SLAVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            语句。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099467008"></a>

            <a class="indexterm" name="idm140528099465504"></a>

            <code class="literal">Opening master dump table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此状态发生后</font></font><code class="literal">Creating table from master
            dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099461344"></a>

            <a class="indexterm" name="idm140528099459840"></a>

            <code class="literal">Reading master dump table data</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此状态发生后</font></font><code class="literal">Opening master dump
            table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099455696"></a>

            <a class="indexterm" name="idm140528099454176"></a>

            <code class="literal">Rebuilding the index on master dump table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            此状态发生后</font></font><code class="literal">Reading master dump table
            data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font></p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-cluster-thread-states"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.8 NDB集群线程状态</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528099449088"></a><a class="indexterm" name="idm140528099447600"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528099444544"></a>

            <a class="indexterm" name="idm140528099443040"></a>

            <code class="literal">Committing events to binlog</code>
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099440064"></a>

            <a class="indexterm" name="idm140528099438560"></a>

            <code class="literal">Opening mysql.ndb_apply_status</code>
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099435584"></a>

            <a class="indexterm" name="idm140528099434096"></a>

            <code class="literal">Processing events</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在处理二进制日志记录的事件。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099430672"></a>

            <a class="indexterm" name="idm140528099429168"></a>

            <code class="literal">Processing events from schema table</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在完成模式复制的工作。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099425712"></a>

            <a class="indexterm" name="idm140528099424224"></a>

            <code class="literal">Shutting down</code>
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099421280"></a>

            <a class="indexterm" name="idm140528099419760"></a>

            <code class="literal">Syncing ndb table schema operation and
            binlog</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            这用于为NDB提供正确的二进制日志模式操作。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099416224"></a>

            <a class="indexterm" name="idm140528099414688"></a>

            <code class="literal">Waiting for allowed to take ndbcluster global
            schema lock</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在等待获取全局模式锁定的权限。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099411152"></a>

            <a class="indexterm" name="idm140528099409648"></a>

            <code class="literal">Waiting for event from ndbcluster</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            服务器充当NDB群集中的SQL节点，并连接到群集管理节点。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099406128"></a>

            <a class="indexterm" name="idm140528099404624"></a>

            <code class="literal">Waiting for first event from ndbcluster</code>
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099401648"></a>

            <a class="indexterm" name="idm140528099400112"></a>

            <code class="literal">Waiting for ndbcluster binlog update to reach
            current position</code>
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099397056"></a>

            <a class="indexterm" name="idm140528099395536"></a>

            <code class="literal">Waiting for ndbcluster global schema lock</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            该线程正在等待由另一个线程持有的全局模式锁被释放。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099392000"></a>

            <a class="indexterm" name="idm140528099390496"></a>

            <code class="literal">Waiting for ndbcluster to start</code>
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099387520"></a>

            <a class="indexterm" name="idm140528099386016"></a>

            <code class="literal">Waiting for schema epoch</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            线程正在等待模式时期（即全局检查点）。
</font></font></p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="event-scheduler-thread-states"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.14.9事件调度程序线程状态</font></font></h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140528099381584"></a><a class="indexterm" name="idm140528099380096"></a><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这些状态发生在事件调度程序线程，为执行预定事件而创建的线程或终止调度程序的线程中。
</font></font></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="indexterm" name="idm140528099377264"></a>

            <a class="indexterm" name="idm140528099375776"></a>

            <code class="literal">Clearing</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            调度程序线程或执行事件的线程正在终止并即将结束。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099372304"></a>

            <a class="indexterm" name="idm140528099370816"></a>

            <code class="literal">Initialized</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            调度程序线程或将执行事件的线程已初始化。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099367360"></a>

            <a class="indexterm" name="idm140528099365856"></a>

            <code class="literal">Waiting for next activation</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            调度程序有一个非空的事件队列，但未来会进行下一次激活。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099362368"></a>

            <a class="indexterm" name="idm140528099360864"></a>

            <code class="literal">Waiting for scheduler to stop</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            发出的线程</font></font><code class="literal">SET GLOBAL
            event_scheduler=OFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在等待调度程序停止。
          </font></font></p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140528099356656"></a>

            <a class="indexterm" name="idm140528099355168"></a>

            <code class="literal">Waiting on empty queue</code>
          </p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            调度程序的事件队列是空的，它正在休眠。
</font></font></p></li></ul>
</div>

</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tbody><tr>
<td width="40%" align="left"><a accesskey="p" href="/mysql-5.7-google-zh/backup-and-recovery.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></a></td>
<td width="20%" align="center"><a accesskey="u" href="/mysql-5.7-google-zh/optimization.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向上</font></font></a></td>
<td width="40%" align="right">&nbsp;<a accesskey="n" href="/mysql-5.7-google-zh/language-structure.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个</font></font></a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7章备份和恢复</font></font></td>
<td width="20%" align="center"><a accesskey="h" href="/mysql-5.7-google-zh/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家</font></font></a></td>
<td width="40%" align="right" valign="top"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9章语言结构</font></font></td>
</tr>
</tbody></table>
</div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./images/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>