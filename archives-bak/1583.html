
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Nginx 编译安装和增加扩展与升级 | 青春部落    </title>
    <meta name="keywords"  content="Nginx,Web,编译安装,configure,系统升级" />
    <meta name="description"  content="Nginx服务编译安装和升级说明" />
    <link rel="stylesheet" type="text/css" media="all" href="https://cn-blogs.cn/wp-content/themes/pencilone/style.css" />
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="pingback" href="https://cn-blogs.cn/xmlrpc.php">
    <link id="favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="青春部落 &raquo; Nginx 编译安装和增加扩展与升级评论Feed" href="https://cn-blogs.cn/archives/1583.html/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/cn-blogs.cn\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='https://api.w.org/' href='https://cn-blogs.cn/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://cn-blogs.cn/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://cn-blogs.cn/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='nginx 502' href='https://cn-blogs.cn/archives/574.html' />
<link rel='next' title='Nginx 用户认证和访问控制403' href='https://cn-blogs.cn/archives/1622.html' />
<meta name="generator" content="WordPress 4.9.1" />
<link rel="canonical" href="https://cn-blogs.cn/archives/1583.html" />
<link rel='shortlink' href='https://cn-blogs.cn/?p=1583' />
<link rel="alternate" type="application/json+oembed" href="https://cn-blogs.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcn-blogs.cn%2Farchives%2F1583.html" />
<link rel="alternate" type="text/xml+oembed" href="https://cn-blogs.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcn-blogs.cn%2Farchives%2F1583.html&#038;format=xml" />
<link rel="icon" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-32x32.png" sizes="32x32" />
<link rel="icon" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-180x180.png" />
<meta name="msapplication-TileImage" content="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-270x270.png" />

<meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">


</head>

<body class="post-template-default single single-post postid-1583 single-format-standard">
<header class="navbar">
<div class="container">
    <div class="navbar-brand">
        <img src="/logo.png" width="73" height="88">
        <div>
        <h1 class="title2 is-3 navbar-item">
            <a href="https://cn-blogs.cn/" rel="home">青春部落</a>
        </h1>
        <p class="has-text-right">
            <a href="/">记录生活的足迹</a>
        </p>
        </div>
    </div>
    <div class="navbar-menu is-active">
    <div class="navbar-end">
    <div class="tabs is-right">
    <a class="navbar-item" href="/pages/index.html">索引</a>
    <a class="navbar-item" href="/about">About</a>
    </div>
    </div>
    </div>
</div>
</header>


<main class="container">
        <article class="article margin-top20">

        <!-- 文章分类和上一篇\下一篇 -->
        <div class="box columns">
            <!-- 文章分类 -->
            <div class="column is-two-fifth">
                <div class="categproe-name">分类：</div>
                <ul class="post-categories">
	<li><a href="https://cn-blogs.cn/archives/category/operation-tool/webserver/nginx" rel="category tag">Nginx</a></li></ul>            </div>
            <!-- 文章分类结束 -->

            <!-- 上一篇和下一篇 -->
            <div class="column is-two-fifth is-offset-5">
                
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://cn-blogs.cn/archives/574.html" rel="prev">上一篇：nginx 502</a></div><div class="nav-next"><a href="https://cn-blogs.cn/archives/1622.html" rel="next">下一篇：Nginx 用户认证和访问控制403</a></div></div>
	</nav>            </div>
            <!-- 上一篇和下一篇结束 -->
        </div>

        <!-- 文章信息 -->
        <!-- 文章标题 -->
        <div class="title is-3 has-text-centered">
            Nginx 编译安装和增加扩展与升级        </div>
        <!-- 文章标题结束 -->

        <!-- 文章作者、发布时间、更新时间 -->
        <div class="subtitle is-5 has-text-centered">
            <span class="entry-author"><a href="https://cn-blogs.cn/archives/author/admin" title="由admin发布" rel="author">admin</a></span>
            <span class="entry-date">2015/05/20</span>
            <span class="update is-hidden">2018-08-29</span>
        </div>
        <!-- 文章作者、发布时间、更新时间结束 -->

        <!-- 文章内容 -->
        <div class="content article-body">
            <div class="content">
                <h2>编译安装过程</h2>
<p>GCC编译器：GNU Compiler Collection,是GNU社区推出的自由编译器，支持C，C++等<br />
autoconf和automake工具用于生成makefile</p>
<h3>依赖包安装</h3>
<p><code>yum -y gcc gcc-c++ ncurses-devel perl-devel openssl-devel pcre-devel</code><br />
./configure &#8211;help 编译帮助</p>
<h3>生成文件存储目录</h3>
<table>
<tbody>
<tr>
<th>–prefix</th>
<th>Nginx安装的基础目录</th>
<th>/usr/local/nginx</th>
</tr>
<tr>
<th>–sbin-path</th>
<th>Nginx二进制安装目录</th>
<th>/sbin/nginx</th>
</tr>
<tr>
<th>–conf-path=</th>
<th>主配置文件安装位置</th>
<th>/conf/nginx.conf.</th>
</tr>
<tr>
<th>–error-log-path=</th>
<th>错误日志位置</th>
<th>/logs/error.log.</th>
</tr>
<tr>
<th>–pid-path=</th>
<th>Nginx pid文件路径，可以在配置文件指定</th>
<th>/logs/nginx.pid.</th>
</tr>
<tr>
<th>–lock-path=</th>
<th>锁文件位置</th>
<th>/logs/nginx.lock.</th>
</tr>
<tr>
<th>–with-perl_modules_path=</th>
<th>Perl模块位置</th>
<th></th>
</tr>
<tr>
<th>–with-perl=</th>
<th>Perl二进制文件路径</th>
<th></th>
</tr>
<tr>
<th>–http-log-path=</th>
<th>访问日志路径，可以在配置文件指定</th>
<th>/logs/access.log.</th>
</tr>
<tr>
<th>–http-client-body-temp-path=</th>
<th>存放由客户端请求生成的临时文件路径</th>
<th>/client_body_temp</th>
</tr>
<tr>
<th>–http-proxy-temp-path=</th>
<th>proxy产生的临时文件路径</th>
<th>/proxy_temp</th>
</tr>
<tr>
<th>–http-fastcgi-temp-path=</th>
<th>由HTTP，FastCGI模块产生的临时文件路径</th>
<th>/ fastcgi_temp</th>
</tr>
<tr>
<th>–http-uwsgi-temp-path=</th>
<th>由HTTP uWSGI模块产生的临时文件路径</th>
<th>/uwsgi_temp</th>
</tr>
<tr>
<th>–http-scgi-temp-path=</th>
<th>由HTTP，SCGI模块产生的临时文件路径</th>
<th>/scgi_temp</th>
</tr>
</tbody>
</table>
<h3>编译过程中的依赖库</h3>
<ul>
<li>–with-cc=… 指定C编译器的备用路径。</li>
<li>–with-cpp=… 指定C预处理器的备用路径。</li>
<li>–with-cc-opt=… 定义要传递到C编译器命令行的其他选项。</li>
<li>–with-ld-opt=… 定义要传递到C链接器命令行的其他选项。</li>
<li>–with-cpu-opt=… 在以下值中指定不同的目标处理器体系结构：pentium，pentiumpro，pentium3，pentium4，athlon，opteron，sparc32，sparc64和ppc64。</li>
</ul>
<p>PCRE选项|rewrite规则重写</p>
<ul>
<li>–without-pcre 禁用PCRE库的使用。 不建议使用此设置，因为它将删除对正则表达式的支持，从而禁用Rewrite模块。</li>
<li>–with-pcre 强制使用PCRE库。</li>
<li>–with-pcre=… 允许您指定PCRE库源代码的路径。</li>
<li>–with-pcre-opt=… 构建PCRE库的其他选项。</li>
<li>–with-pcre-jit=… 构建PCRE与JIT编译的支持。</li>
</ul>
<p>MD5选项</p>
<ul>
<li>–with-md5=… 指定MD5库源的路径。</li>
<li>–with-md5-opt=… 用于构建MD5库的其他选项。</li>
<li>–with-md5-asm 为MD5库指定汇编源。</li>
</ul>
<p>SHA1选项</p>
<ul>
<li>–with-sha1=… 指定SHA1库源的路径。</li>
<li>–with-sha1-opt=… 构建SHA1库的其他选项。</li>
<li>–with-sha1-asm 为SHA1库指定汇编器源。</li>
</ul>
<p>zlib选项|gzip压缩</p>
<ul>
<li>–with-zlib=… 指定zlib library源的路径。</li>
<li>–with-zlib-opt=… 用于构建zlib库的其他选项。</li>
<li>–with-zlib-asm=… 为zlib库指定汇编器源。</li>
</ul>
<p>OpenSSL选项|ssl 证书安全</p>
<ul>
<li>–with-openssl=… 指定OpenSSL库源的路径。</li>
<li>–with-openssl-opt=… 用于构建OpenSSL库的其他选项。</li>
</ul>
<h3>模块设置</h3>
<h4>默认启用的模块</h4>
<p>以下参数允许您禁用默认情况下启用的模块：</p>
<ul>
<li>–without-http_charset_module#编码</li>
<li>–without-http_gzip_module#压缩</li>
<li>–without-http_ssi_module#ssi文件</li>
<li>–without-http_userid_module#确认客户端cookies</li>
<li>–without-http_access_module#访问控制</li>
<li>–without-http_auth_basic_module #用户认证，htpasswd</li>
<li>–without-http_autoindex_module#自动生成目录列表</li>
<li>–without-http_geo_module#客户端ip定位</li>
<li>–without-http_map_module#使用键/值设置配置</li>
<li>&#8211;without-http_split_clients_Module#根据条件划分用户，如ip，cookies</li>
<li>–without-http_referer_module#拒绝报头中referer值不正确的请求</li>
<li>–without-http_rewrite_module#重写规则，依赖pcre</li>
<li>–without-http_proxy_module#代理服务器</li>
<li>–without-http_fastcgi_module#与fastcgi进程交互</li>
<li>–without-http_uwsgi_module#与uwsgi交互</li>
<li>–without-http_scgi_module#与scgi交互</li>
<li>–without-http_memcached_module#缓存</li>
<li>–without-http_limit_conn_module#限制会话并发数</li>
<li>–without-http_limit_req_module#限制一个ip请求数</li>
<li>–without-http_empty_gif_module#</li>
<li>–without-http_browser_module#浏览器信息</li>
<li>–without-http_upstream_ip_hash_module#负载均衡</li>
<li>–without-http_upstream_least_conn_module#</li>
</ul>
<h4>默认禁用的模块</h4>
<p>以下参数允许您启用默认禁用的模块：</p>
<ul>
<li>–with-http_ssl_module#证书依赖openssl</li>
<li>–with-http_realip_module#获取用户真实ip，前端有代理服务器</li>
<li>–with-http_addition_module#输出过滤器，支持不完全缓冲</li>
<li>–with-http_xslt_module#过滤转换XML请求</li>
<li>–with-http_image_filter_module#图片过滤器</li>
<li>–with-http_geoip_module#使用Geoip文件，定位ip</li>
<li>–with-http_sub_module#用其他文档，替换nginx响应文本</li>
<li>–with-http_dav_module#增加http操作符</li>
<li>–with-http_flv_module#</li>
<li>–with-http_mp4_module#</li>
<li>–with-http_gzip_static_module#在线实时压缩输出数据流</li>
<li>–with-http_random_index_module#随机挑选目录进行索引</li>
<li>–with-http_secure_link_module#计算和检查要求所需的安全链接</li>
<li>–with-http_stub_status_module#工作状态status</li>
<li>–with-google_perftools_module#调试</li>
<li>–with-http_degradation_module#内存不足情况，返回204或444</li>
<li>–with-http_perl_module</li>
<li>–with-http_spdy_module</li>
<li>–with-http_gunzip_module</li>
<li>–with-http_auth_request_module</li>
</ul>
<h2>重新编译(增加扩展和升级)</h2>
<p>如果需要对现有的Nginx服务升级或者添加新模块时，则需要对Nginx编译处理。</p>
<h4>获取当前的编译参数</h4>
<p><code>#/usr/local/nginx/nginx -V<br />
nginx version: nginx/1.4.7<br />
built by gcc 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC)<br />
TLS SNI support enabled<br />
configure arguments: –prefix=/usr/local/nginx –user=www –group=www –sbin-path=/usr/local/nginx/nginx –conf-path=/usr/local/nginx/nginx.conf –pid-path=/usr/local/nginx/nginx.pid –with-pcre=/usr/local/src/lnmp/pcre-8.33 –with-zlib=/usr/local/src/lnmp/zlib-1.2.8 –with-openssl=/usr/local/src/lnmp/openssl-1.0.1e</code><br />
继承之前的编译参数，避免Nginx服务因编译参数产生不兼容的问题。</p>
<h4>编译新服务</h4>
<p>进入nginx源码包<br />
<code># cd /usr/local/src/nginx-1.4.7<br />
# ./configure –prefix=/usr/local/nginx –user=www –group=www –sbin-path=/usr/local/nginx/nginx –conf-path=/usr/local/nginx/nginx.conf –pid-path=/usr/local/nginx/nginx.pid –with-pcre=/usr/local/src/lnmp/pcre-8.33 –with-zlib=/usr/local/src/lnmp/zlib-1.2.8 –with-openssl=/usr/local/src/lnmp/openssl-1.0.1e –with-http_gzip_static_module –with-http_ssl_module</code><br />
新增–with-http_ssl_module 、–with-http_gzip_static_module 这些模块参数。<strong>Configure执行完成后，只执行make过程，禁止执行make install过程！</strong><br />
<code># make</code><br />
执行完后，在源码目录下会有一个objs目录。objs目录下的nginx文件，就是我们需要的Nginx程序了。</p>
<h4>配置部署</h4>
<p><code>#cp /usr/local/nginx/nginx /usr/local/nginx/nginx.bak</code><br />
把新的nginx程序覆盖旧的<br />
<code>#cp ./objs/nginx /usr/local/nginx/sbin/nginx</code><br />
测试新的nginx程序是否正确<br />
<code># /usr/local/nginx/nginx -t<br />
nginx: the configuration file /usr/local/nginx/nginx.conf syntax is ok<br />
nginx: configuration file /usr/local/nginx/nginx.conf test is successful</code><br />
最后重启nginx</p>
<p><a href="https://cn-blogs.cn/archives/1583.html/nginx_run" rel="attachment wp-att-4555">nginx_run</a></p>
            </div>
        </div>
        <!-- 文章内容结束 -->
    </article>


</main><!-- .content-area -->

<div class="footer">
    <div class="container">

<div class="has-text-centered">
Copyright©2015-20178 cn-blogs.cn. All Rights Reserved. 鲁ICP备18001334号-2
</div>
    </div>
  </div>

</body>
</html>
