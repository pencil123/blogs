
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>MySQL 二进制日志 BinLog | 青春部落    </title>
    <meta name="keywords"  content="MySQL,binlog,二进制日志" />
    <meta name="description"  content="MySQL,数据库中二进制日志设置说明" />
    <link rel="stylesheet" type="text/css" media="all" href="https://cn-blogs.cn/wp-content/themes/pencilone/style.css" />
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="pingback" href="https://cn-blogs.cn/xmlrpc.php">
    <link id="favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="青春部落 &raquo; MySQL 二进制日志 BinLog评论Feed" href="https://cn-blogs.cn/archives/357.html/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/cn-blogs.cn\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='https://api.w.org/' href='https://cn-blogs.cn/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://cn-blogs.cn/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://cn-blogs.cn/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='MySQL 二进制日志模式' href='https://cn-blogs.cn/archives/355.html' />
<link rel='next' title='Relaylog 中继日志参数设置' href='https://cn-blogs.cn/archives/359.html' />
<meta name="generator" content="WordPress 4.9.1" />
<link rel="canonical" href="https://cn-blogs.cn/archives/357.html" />
<link rel='shortlink' href='https://cn-blogs.cn/?p=357' />
<link rel="alternate" type="application/json+oembed" href="https://cn-blogs.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcn-blogs.cn%2Farchives%2F357.html" />
<link rel="alternate" type="text/xml+oembed" href="https://cn-blogs.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcn-blogs.cn%2Farchives%2F357.html&#038;format=xml" />
<link rel="icon" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-32x32.png" sizes="32x32" />
<link rel="icon" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-180x180.png" />
<meta name="msapplication-TileImage" content="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-270x270.png" />

<meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">


</head>

<body class="post-template-default single single-post postid-357 single-format-standard">
<header class="navbar">
<div class="container">
    <div class="navbar-brand">
        <img src="/logo.png" width="73" height="88">
        <div>
        <h1 class="title2 is-3 navbar-item">
            <a href="https://cn-blogs.cn/" rel="home">青春部落</a>
        </h1>
        <p class="has-text-right">
            <a href="/">记录生活的足迹</a>
        </p>
        </div>
    </div>
    <div class="navbar-menu is-active">
    <div class="navbar-end">
    <div class="tabs is-right">
    <a class="navbar-item" href="/pages/index.html">索引</a>
    <a class="navbar-item" href="/about">About</a>
    </div>
    </div>
    </div>
</div>
</header>


<main class="container">
        <article class="article margin-top20">

        <!-- 文章分类和上一篇\下一篇 -->
        <div class="box columns">
            <!-- 文章分类 -->
            <div class="column is-two-fifth">
                <div class="categproe-name">分类：</div>
                <ul class="post-categories">
	<li><a href="https://cn-blogs.cn/archives/category/databases/mysql" rel="category tag">MySQL</a></li></ul>            </div>
            <!-- 文章分类结束 -->

            <!-- 上一篇和下一篇 -->
            <div class="column is-two-fifth is-offset-5">
                
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://cn-blogs.cn/archives/355.html" rel="prev">上一篇：MySQL 二进制日志模式</a></div><div class="nav-next"><a href="https://cn-blogs.cn/archives/359.html" rel="next">下一篇：Relaylog 中继日志参数设置</a></div></div>
	</nav>            </div>
            <!-- 上一篇和下一篇结束 -->
        </div>

        <!-- 文章信息 -->
        <!-- 文章标题 -->
        <div class="title is-3 has-text-centered">
            MySQL 二进制日志 BinLog        </div>
        <!-- 文章标题结束 -->

        <!-- 文章作者、发布时间、更新时间 -->
        <div class="subtitle is-5 has-text-centered">
            <span class="entry-author"><a href="https://cn-blogs.cn/archives/author/admin" title="由admin发布" rel="author">admin</a></span>
            <span class="entry-date">2015/12/23</span>
            <span class="update is-hidden">2018-04-12</span>
        </div>
        <!-- 文章作者、发布时间、更新时间结束 -->

        <!-- 文章内容 -->
        <div class="content article-body">
            <div class="content">
                <p>二进制日志记录对数据库修改的语句。它还可能包括一些可能对数据库修改的语句(例如:delete数据where匹配为空)，除非使用ROW记录格式。<br />
二进制日志还记录每条语句执行花费的时间。</p>
<h4>二进制的内容</h4>
<p>1、二进制日志记录事件的格式<br />
2、事件发生的日期和时间<br />
3、服务器标识<br />
4、结束的位置 end_log_pos<br />
5、事件类型<br />
6、执行时间的线程ID<br />
7、语句的时间戳与写入二进制文件中的时间差<br />
8、错误代码<br />
9、事件内容</p>
<h4>日志文件</h4>
<p>1、mysqld将数字扩展名附加到二进制日志基本名称以生成二进制日志文件名称。每次服务器创建一个新的日志文件时，该编号都会增加，从而创建一系列有序的文件。<br />
2、要跟踪哪些二进制日志文件已被使用， mysqld还会创建一个二进制日志索引文件，其中包含所有使用的二进制日志文件的名称。<br />
3、您可以使用该RESET MASTER语句或其子集删除所有二进制日志文件 PURGE BINARY LOGS。</p>
<h4>二进制日志功能性说明</h4>
<p>1、运行启用二进制日志记录的服务器会使性能稍微降低。但是，二进制日志的优势使您能够设置复制和恢复操作，这通常会超过此次要的性能下降。<br />
2、二进制日志通常对意外暂停具有弹性，因为只有完整的事务被记录或回读。<br />
3、写入二进制日志的语句中的密码(服务管理)被服务器重写，不会以纯文本形式出现。<br />
4、具有该SUPER 特权的客户端可以通过使用SET sql_log_bin=0语句禁用其自己的语句的二进制日志记录。<br />
5、默认情况下，服务器记录事件的长度以及事件本身，并使用它来验证事件写入是否正确。您还可以通过设置binlog_checksum系统变量，使服务器为事件写入校验和 。<br />
6、记录在二进制日志中的事件的格式取决于二进制日志记录格式。支持三种格式类型，基于行的日志记录，基于语句的日志记录和混合基日志记录。<br />
7、服务器以&#8211;binlog-do-db与&#8211;binlog-ignore-db设置二进制日志过滤。<br />
8、二进制日志记录发生在语句或事务完成后，而不是任何锁定被释放或者任何提交完成之前。这可以确保日志按提交顺序进行记录。<br />
9、非事务表的更新在执行后立即存储在二进制日志中。<br />
10、二进制日志格式有一些已知的限制，可能会影响从备份恢复。<br />
11、默认情况下，二进制日志在每次write（sync_binlog=1）时同步到磁盘。<br />
12、在解析二进制日志时，以下系统变量的会话值将写入二进制日志并由复制从属服务器执行：<br />
<code>    sql_mode（除了 NO_DIR_IN_CREATE不复制模式;请参见 第16.4.1.38节“复制和变量”）<br />
foreign_key_checks<br />
unique_checks<br />
character_set_client<br />
collation_connection<br />
collation_database<br />
collation_server<br />
sql_auto_is_null </code></p>
<h4>修改mysql数据库表的日志记录</h4>
<p>MySQL服务中的mysql数据库，记录了服务的管理信息。对mysql数据库中有关权限信息的表格的修改分为两类：直接修改(insert,update,delete)和间接修改(grant\revoke等)。有关权限表修改的语句二进制记录方式规则如下：<br />
MySQL根据binlog_format设置，记录直接修改的语句；这涉及到语句，如 INSERT， UPDATE， DELETE， REPLACE， DO， LOAD DATA INFILE，SELECT，和 TRUNCATE TABLE。<br />
MySQL不管binlog_format设置为何，都以语句(statements)方式记录间接修改的语句。这涉及语句，例如 GRANT， REVOKE， SET PASSWORD， RENAME USER， CREATE（所有形式的除外 CREATE TABLE &#8230; SELECT）， ALTER（所有形式的），和DROP（各种形式）。</p>
<p>CREATE TABLE &#8230; SELECT是数据定义和数据操作的组合。该CREATE TABLE 部分是利用语句格式记录，且 SELECT部分是根据的值记录binlog_format。</p>
<h3>二进制日志设置的参数</h3>
<table>
<tbody>
<tr>
<th>log_bin</th>
<th>是否开启二进制日志；设置二进制日志的存储文件</th>
</tr>
<tr>
<th>binlog_format</th>
<th>二进制日志模式</th>
</tr>
<tr>
<th>binlog_cache_size</th>
<th>高速缓存的大小，用于在事务处理期间更改二进制日志。</th>
</tr>
<tr>
<th>max_binlog_cache_size</th>
<th>BinLog 能够使用的最大cache 内存大小</th>
</tr>
<tr>
<th>max_binlog_size</th>
<th>二进制日志文件最大SIZE</th>
</tr>
<tr>
<th>sync_binlog</th>
<th>二进制日志同步方式</th>
</tr>
<tr>
<th>binlog-do-db</th>
<th>二进制日志记录的数据库</th>
</tr>
<tr>
<th>binlog-ignore-db</th>
<th>二进制日志忽略的数据库</th>
</tr>
<tr>
<th>expire_logs_days</th>
<th>二进制日志过期天数</th>
</tr>
<tr>
<th>log_slave_updates</th>
<th>Slave SQL_THREAD 操作写入日志</th>
</tr>
</tbody>
</table>
<h4>log_bin 开启二进制日志</h4>
<p>配置文件中设置log_bin参数为二进制日志文件名<br />
Mysql实例会根据log_bin参数开启二进制日志；<br />
并设置二进制文件名为log_bin_basename，设置log_bin_index参数。</p>
<h4>binlog_format</h4>
<blockquote class="wp-embedded-content" data-secret="JiabR5tiVW"><p><a href="https://www.cn-blogs.cn/archives/355.html">二进制日志模式</a></p></blockquote>
<p><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; clip: rect(1px, 1px, 1px, 1px);" src="https://www.cn-blogs.cn/archives/355.html/embed#?secret=JiabR5tiVW" data-secret="JiabR5tiVW" width="500" height="282" title="《二进制日志模式》—青春部落" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></p>
<h4>binlog_cache_size</h4>
<p>高速缓存的大小，用于在事务处理期间更改二进制日志。如果服务器支持任何事务性存储引擎，并且服务器启用了二进制日志（&#8211;log-bin选项），则为每个客户端分配一个二进制日志高速缓存。如果您经常使用大型事务，则可以增加此缓存大小以获得更好的性能。</p>
<h4>max_binlog_cache_size</h4>
<p>Binlog能够使用的最大cache内存大小。<br />
当执行多语句事务时，max_binlog_cache_size 如果不够大，系统可能会报出“Multi-statement transaction required more than ‘max_binlog_cache_size’ bytes of storage”的错误。</p>
<h4>max_binlog_size</h4>
<p>二进制日志文件最大SIZE</p>
<h4>sync_binlog</h4>
<p>在将二进制日志同步到磁盘之前，控制要收集的二进制日志提交组的数量。<br />
二进制日志同步的方式；影响到二进制日志记录的性能和二进制日志记录数据的完整性。<br />
<strong>参数说明：</strong><br />
<strong>sync_binlog=0</strong>;当事务提交之后，MySQL 不做fsync 之类的磁盘同步指令刷新binlog_cache 中的信息到磁盘，而让Filesystem 自行决定什么时候来做同步，或者cache 满了之后才同步到磁盘。<br />
<strong>sync_binlog=1;</strong>所有事务在提交之前都会同步到二进制日志中。因此，即使意外重启，二进制日志中缺少的任何事务也只能处于准备状态。<br />
<strong>sync_binlog&gt;1;</strong>事务将被提交而不被同步到磁盘。因此，如果发生电源故障或操作系统崩溃，服务器可能会提交一些未被同步到二进制日志的事务</p>
<h4>binlog-do-db</h4>
<p>记录数据库修改的日志</p>
<h4>binlog-ignore-db</h4>
<p>忽略数据库修改的日志</p>
<p><strong>binlog-do-db和binlog-ignore-db 在使用时，应当注意他们的实现过程。</strong><br />
Mysql服务判断数据更改的操作是否要记录日志，并没有那么智能和完善。<br />
正常情况下时，是根据“选择数据库”(use dbname)操作来确定修改操作是否要记录的。其中根据binlog_format的类型不同还会存在差别。<br />
非正常的情况：如果没有“选择数据库”(use dbname)或者“选择A数据库，更改B数据库数据”；这种情况下，就会造成数据修改操作在日志中丢失的情况。<br />
<c>expire_logs_days</h4>
<p>默认值为0,表示二进制日志永远不过期</p>
<h3>主从同步注意点</h3>
<p>默认情况下，Slave服务不会将从Master服务接收到的任何数据修改写入其自己的二进制日志。要记录这些修改，请设置&#8211;log-slave-updates参数。<br />
slave实例配置–log-bin选项也只会记录slave实例自己的数据修改操作。</p>
<h4>log_slave_updates default OFF</h4>
<p>slave数据库实例从master实例读取到的修改记录写入到中继日志；然后在slave实例中执行更新；最后写入到slave实例中二进制日志中。<br />
1、log_slave_updates 选项没有开启，就不会执行最后的操作。<br />
2、log_slave_updates 选项开启后，就会执行上面的最后操作。<br />
3、为了使这个选项有效，从站也必须使用–log-bin选项来启动二进制日志记录。</p>
            </div>
        </div>
        <!-- 文章内容结束 -->
    </article>


</main><!-- .content-area -->

<div class="footer">
    <div class="container">

<div class="has-text-centered">
Copyright©2015-20178 cn-blogs.cn. All Rights Reserved. 鲁ICP备18001334号-2
</div>
    </div>
  </div>

</body>
</html>
