
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Nginx 进程管理 | 青春部落    </title>
    <meta name="keywords"  content="Nginx,进程管理" />
    <meta name="description"  content="Nginx服务的进程管理操作" />
    <link rel="stylesheet" type="text/css" media="all" href="https://cn-blogs.cn/wp-content/themes/pencilone/style.css" />
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="pingback" href="https://cn-blogs.cn/xmlrpc.php">
    <link id="favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="青春部落 &raquo; Nginx 进程管理评论Feed" href="https://cn-blogs.cn/archives/2407.html/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/cn-blogs.cn\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='https://api.w.org/' href='https://cn-blogs.cn/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://cn-blogs.cn/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://cn-blogs.cn/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='输入日志' href='https://cn-blogs.cn/archives/1782.html' />
<link rel='next' title='Nginx Listen指令参数' href='https://cn-blogs.cn/archives/1938.html' />
<meta name="generator" content="WordPress 4.9.1" />
<link rel="canonical" href="https://cn-blogs.cn/archives/2407.html" />
<link rel='shortlink' href='https://cn-blogs.cn/?p=2407' />
<link rel="alternate" type="application/json+oembed" href="https://cn-blogs.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcn-blogs.cn%2Farchives%2F2407.html" />
<link rel="alternate" type="text/xml+oembed" href="https://cn-blogs.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcn-blogs.cn%2Farchives%2F2407.html&#038;format=xml" />
<link rel="icon" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-32x32.png" sizes="32x32" />
<link rel="icon" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-180x180.png" />
<meta name="msapplication-TileImage" content="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-270x270.png" />

<meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">


</head>

<body class="post-template-default single single-post postid-2407 single-format-standard">
<header class="navbar">
<div class="container">
    <div class="navbar-brand">
        <img src="/logo.png" width="73" height="88">
        <div>
        <h1 class="title2 is-3 navbar-item">
            <a href="https://cn-blogs.cn/" rel="home">青春部落</a>
        </h1>
        <p class="has-text-right">
            <a href="/">记录生活的足迹</a>
        </p>
        </div>
    </div>
    <div class="navbar-menu is-active">
    <div class="navbar-end">
    <div class="tabs is-right">
    <a class="navbar-item" href="/pages/index.html">索引</a>
    <a class="navbar-item" href="/about">About</a>
    </div>
    </div>
    </div>
</div>
</header>


<main class="container">
        <article class="article margin-top20">

        <!-- 文章分类和上一篇\下一篇 -->
        <div class="box columns">
            <!-- 文章分类 -->
            <div class="column is-two-fifth">
                <div class="categproe-name">分类：</div>
                <ul class="post-categories">
	<li><a href="https://cn-blogs.cn/archives/category/operation-tool/webserver/nginx" rel="category tag">Nginx</a></li></ul>            </div>
            <!-- 文章分类结束 -->

            <!-- 上一篇和下一篇 -->
            <div class="column is-two-fifth is-offset-5">
                
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://cn-blogs.cn/archives/1782.html" rel="prev">上一篇：输入日志</a></div><div class="nav-next"><a href="https://cn-blogs.cn/archives/1938.html" rel="next">下一篇：Nginx Listen指令参数</a></div></div>
	</nav>            </div>
            <!-- 上一篇和下一篇结束 -->
        </div>

        <!-- 文章信息 -->
        <!-- 文章标题 -->
        <div class="title is-3 has-text-centered">
            Nginx 进程管理        </div>
        <!-- 文章标题结束 -->

        <!-- 文章作者、发布时间、更新时间 -->
        <div class="subtitle is-5 has-text-centered">
            <span class="entry-author"><a href="https://cn-blogs.cn/archives/author/admin" title="由admin发布" rel="author">admin</a></span>
            <span class="entry-date">2015/07/01</span>
            <span class="update is-hidden">2018-04-20</span>
        </div>
        <!-- 文章作者、发布时间、更新时间结束 -->

        <!-- 文章内容 -->
        <div class="content article-body">
            <div class="content">
                <h3>Nginx进程管理参数：</h3>
<p><code> -?,-h : this help<br />
-v : show version and exit<br />
-m : show all modules and exit<br />
-l : show all directives and exit<br />
-V : show version, modules and configure options then exit<br />
-t : test configuration and exit<br />
-d : dump configuration and exit<br />
-q : suppress non-error messages during configuration testing<br />
-s signal : send signal to a master process: stop, quit, reopen, reload#停止，退出，<br />
-p prefix : set prefix path (default: /usr/local/nginx/)<br />
-c filename : set configuration file (default: conf/nginx.conf)<br />
-g directives : set global directives out of configuration file</code></p>
<h3>控制信号：</h3>
<p>nginx can be controlled with signals. The process ID of the master process is written to PID file. The master process supports the following signals:<br />
nginx可以用信号控制。主进程的进程ID写在PID文件中。主进程支持的信号如下：<br />
<strong>1、TERM, INT：</strong>fast shutdown#快速关闭<br />
<strong>2、QUIT</strong>：graceful shutdown#正常关闭<br />
<strong>3、HUP：</strong>changing configuration, keeping up with a changed time zone (only for FreeBSD and Linux), starting new worker processes with a new configuration, graceful shutdown of old worker processes<br />
#修改配置，用新的配置开启新的工作进程，正常关闭旧的进程<br />
<strong>4、USR1：</strong>re-opening log files#重新打开日志文件<br />
<strong>5、USR2：</strong>upgrading an executable file#平滑升级可执行文件<br />
<strong>6、WINCH：</strong>graceful shutdown of worker processes#正常关闭工作进程</p>
<p>Individual worker processes can be controlled with signals as well, though it is not required. The supported signals are:<br />
也可以使用信号来控制工作进程，信号支持的有：</p>
<p>TERM, INT fast shutdown<br />
QUIT graceful shutdown<br />
USR1 re-opening log files<br />
WINCH abnormal termination for debugging (requires debug_points to be enabled) #调试异常终止</p>
<h3>主要信号处理过程</h3>
<p><strong>Changing Configuration 修改配置</strong><br />
In order for nginx to re-read the configuration file, a HUP signal should be sent to the master process. The master process first checks the syntax validity, then tries to apply new configuration, that is, to open log files and new listen sockets.<br />
If this fails, it rolls back changes and continues to work with old configuration.<br />
If this succeeds, it starts new worker processes, and sends messages to old worker processes requesting them to shut down gracefully. Old worker processes close listen sockets and continue to service old clients. After all clients are serviced, old worker processes are shut down.<br />
<strong>HUP信号；</strong>如果新配置文件有问题，则进程使用旧配置文件参数继续运行</p>
<p><strong>Rotating Log-files 重新加载日志</strong><br />
<strong>USR1信号</strong>：主进程会命令工作进程重新加载日志文件。</p>
<p><strong>Upgrading Executable on the Fly 平滑升级可执行文件</strong><br />
<strong>USR2信号</strong>：nginx运行中升级nginx文件的过程<br />
1、使用新文件替换nginx原文件；<br />
2、USR2信号发送给主进程<br />
3、新主进程启动，进程ID存储在新的pid文件中（加特殊后缀）<br />
4、新主进程启动工作进程<br />
5、旧的主进程会收到WINCH信号，开始正常关闭工作进程。<br />
6.1如果新的主进程配置运行正常，则旧的主进程收到QUIT信号，正常关闭。<br />
6.2如果新的主进程配置运行异常，则旧的主进程开重新启动工作进程；新主进程关闭。</p>
            </div>
        </div>
        <!-- 文章内容结束 -->
    </article>


</main><!-- .content-area -->

<div class="footer">
    <div class="container">

<div class="has-text-centered">
Copyright©2015-20178 cn-blogs.cn. All Rights Reserved. 鲁ICP备18001334号-2
</div>
    </div>
  </div>

</body>
</html>
