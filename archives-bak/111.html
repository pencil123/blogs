
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Samba 配置文件 | 青春部落    </title>
    <meta name="keywords"  content="Samba,文件共享,配置文件,Global" />
    <meta name="description"  content="共享服务Samba软件文档配置说明" />
    <link rel="stylesheet" type="text/css" media="all" href="https://cn-blogs.cn/wp-content/themes/pencilone/style.css" />
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="pingback" href="https://cn-blogs.cn/xmlrpc.php">
    <link id="favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="青春部落 &raquo; Samba 配置文件评论Feed" href="https://cn-blogs.cn/archives/111.html/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/cn-blogs.cn\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='https://api.w.org/' href='https://cn-blogs.cn/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://cn-blogs.cn/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://cn-blogs.cn/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Samba 文件共享说明' href='https://cn-blogs.cn/archives/109.html' />
<link rel='next' title='Samba 错误排查' href='https://cn-blogs.cn/archives/117.html' />
<meta name="generator" content="WordPress 4.9.1" />
<link rel="canonical" href="https://cn-blogs.cn/archives/111.html" />
<link rel='shortlink' href='https://cn-blogs.cn/?p=111' />
<link rel="alternate" type="application/json+oembed" href="https://cn-blogs.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcn-blogs.cn%2Farchives%2F111.html" />
<link rel="alternate" type="text/xml+oembed" href="https://cn-blogs.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcn-blogs.cn%2Farchives%2F111.html&#038;format=xml" />
<link rel="icon" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-32x32.png" sizes="32x32" />
<link rel="icon" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-180x180.png" />
<meta name="msapplication-TileImage" content="https://cn-blogs.cn/wp-content/uploads/2018/03/cropped-logo-270x270.png" />

<meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">


</head>

<body class="post-template-default single single-post postid-111 single-format-standard">
<header class="navbar">
<div class="container">
    <div class="navbar-brand">
        <img src="/logo.png" width="73" height="88">
        <div>
        <h1 class="title2 is-3 navbar-item">
            <a href="https://cn-blogs.cn/" rel="home">青春部落</a>
        </h1>
        <p class="has-text-right">
            <a href="/">记录生活的足迹</a>
        </p>
        </div>
    </div>
    <div class="navbar-menu is-active">
    <div class="navbar-end">
    <div class="tabs is-right">
    <a class="navbar-item" href="/pages/index.html">索引</a>
    <a class="navbar-item" href="/about">About</a>
    </div>
    </div>
    </div>
</div>
</header>


<main class="container">
        <article class="article margin-top20">

        <!-- 文章分类和上一篇\下一篇 -->
        <div class="box columns">
            <!-- 文章分类 -->
            <div class="column is-two-fifth">
                <div class="categproe-name">分类：</div>
                <ul class="post-categories">
	<li><a href="https://cn-blogs.cn/archives/category/operation-tool/baseservers" rel="category tag">基础服务</a></li></ul>            </div>
            <!-- 文章分类结束 -->

            <!-- 上一篇和下一篇 -->
            <div class="column is-two-fifth is-offset-5">
                
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://cn-blogs.cn/archives/109.html" rel="prev">上一篇：Samba 文件共享说明</a></div><div class="nav-next"><a href="https://cn-blogs.cn/archives/117.html" rel="next">下一篇：Samba 错误排查</a></div></div>
	</nav>            </div>
            <!-- 上一篇和下一篇结束 -->
        </div>

        <!-- 文章信息 -->
        <!-- 文章标题 -->
        <div class="title is-3 has-text-centered">
            Samba 配置文件        </div>
        <!-- 文章标题结束 -->

        <!-- 文章作者、发布时间、更新时间 -->
        <div class="subtitle is-5 has-text-centered">
            <span class="entry-author"><a href="https://cn-blogs.cn/archives/author/admin" title="由admin发布" rel="author">admin</a></span>
            <span class="entry-date">2016/05/19</span>
            <span class="update is-hidden">2018-05-07</span>
        </div>
        <!-- 文章作者、发布时间、更新时间结束 -->

        <!-- 文章内容 -->
        <div class="content article-body">
            <div class="content">
                <h3>配置文件</h3>
<p>主配置文件：<code>/etc/samba/smb.conf</code><br />
windows和linux系统用户转换：<code>/etc/samba/smbusers</code><br />
主机名称解析文件：<code>/etc/samba/lmhosts</code></p>
<h3>全局设置</h3>
<h4>服务端标识</h4>
<p><code>workgroup = MYGROUP</code><br />
定义该Samba服务器所在的工作组或者域（如果下面的security=domain的话）。<br />
<code>server string = MY Samba Server</code><br />
设定机器的描述，当我们通过网络邻居访问的时候可以在备注里面看见这个内容，而且还可以使用samba设定的变量。<br />
<code>%S = 当前服务名（如果有的话）<br />
%P = 当前服务的根目录（如果有的话）<br />
%u = 当前服务的用户名（如果有的话）<br />
%g = 当前用户说在的主工作组<br />
%U = 当前对话的用户名<br />
%G = 当前对话的用户的主工作组<br />
%H = 当前服务的用户的Home目录<br />
%v = Samba服务的版本号。<br />
%h = 运行Samba服务机器的主机名<br />
%m = 客户机的NETBIOS名称<br />
%L = 服务器的NETBIOS名称<br />
%M = 客户机的主机名<br />
%N = NIS服务器名<br />
%p = NIS服务的Home目录<br />
%R = 说采用的协议等级(值可以是CORE, COREPLUS, LANMAN1, LANMAN2，NT1)<br />
%d = 当前服务进程的ID<br />
%a = 客户机的结构（只能识别几项：Samba，WfWg，WinNT，Win95）<br />
%I = 客户机的IP<br />
%T = 当前日期和时间</code></p>
<h4>用户认证</h4>
<p><code>security = security_level</code><br />
定义Samba的安全级别，按从低到高分为四级：<strong>share，user，server，domain。</strong><br />
<code>guest account = pcguest</code><br />
定义游客帐号，而且需要把这个帐号加入/etc/passwd，不然它就用缺省的nobody<br />
<code>password server = &lt;NT-Server-Name&gt;</code><br />
当前面的security设定为server或者domain的时候才有必要设定它。<br />
<code>password level = n</code><br />
这是设定针对一些SMB客户像OS/2之类而设的，这样的系统在发送用户密码的时候，会把密码转换成大写再发送，这样就和samba的密码不一致，这个参数可以设定密码里允许的大写字母个数，这样samba就根据这个数目对接收到的密码进行大小写重组，以重组过的密码尝试验证密码的正确性。n越大，组合的次数就越多，验证时间就越长，安全性也会因此变得越低。例如n=2，用户的密码是abcd，但发送出去其实是ABCD，samba就会把这个ABCD进行大小写重组，组合后的结果可以是: Abcd, aBcd, abCd, abcD, abcd, ABcd, AbCd, AbcD,aBCd,aBcD,abCD。<br />
所以如果没有必要，就把n定为是零。这样的话samba只尝试两次，一个是接收到的密码，另一个尝试的是这个密码都是小写的情况。<br />
<code>username level = n</code><br />
这个是对于用户名的情况，说明和上面一项类似。<br />
<code>encrypt passwords = yes|no</code><br />
设置是否对密码进行加密，samba本身有一个密码文件/etc/samba/smbpasswd，如果不对密码进行加密则在验证会话期间客户机和服务器之间传递的是明文密码，samba直接把这个密码和Linux里的/etc/samba/smbpasswd密码文件进行验证。但是在Windows 95 OS/R2以后的版本和Windows NT SP3以后的版本缺省都不传送明文密码，要让这些系统能传送明文密码必须在其注册表里更改，比较麻烦，好的方法就是把这里的这个开关设置为yes。<br />
<code>smb passwd file = smbPasswordFile</code><br />
设置存放samba用户密码的文件smbPasswordFile(一般是/etc/samba/smbpasswd)。<br />
<code>ssl CA certFile = sslFile</code><br />
当samba编译的时候支持SSL的时候，需要指定SSL的证书的位置（一般在/usr/share/ssl/certs/ca-bundle.crt）。<br />
<code>unix password sync = yes|no<br />
passwd program = /usr/bin/passwd %u<br />
passwd chat = *New*UNIX*password* %n<br />
*ReType*new*UNIX*password* %n<br />
*passwd:*all*authentication*tokens*updated*successfully*</code><br />
这三项设置能否从windows的应用程序修改unix系统的用户密码<br />
<code>username map = UsermapFile</code><br />
指定用户映射文件（一般是/etc/samba/smbusers），当我们在这个文件里面指定一行root = administrator admin的时候，客户机的用户是admin或者administrator连接时会被当作用户root看待。<br />
<code>include = MachineConfFile</code><br />
指定对不同机器的连接采用不同的配置文件MachineConfFile（一般为了灵活管理使用/etc/samba/smb.conf.%m，由于采用了samba的变量，把配置文件和客户机的NETBIOS名称关联起来，能很容易地控制这些客户机的权限和设置）。<br />
<code>preserve case = yes|no<br />
short preserve case = yes|no</code><br />
指定拷贝DOS文件的时候保持大小写，缺省是no<br />
<code>default case = lower|upper</code><br />
所有的DOS文件的缺省是大写还是小写<br />
<code>case sensitive = yes|no</code><br />
大小写敏感，一般是no,不然会出现一些问题。</p>
<h4>网络配置</h4>
<p><code>socket options = TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF=8192</code><br />
这个是网络socket方面的一些参数，能实现最好的文件传输性能。相关的选项还有SO_KEEPALIVE、 SO_REUSEADDR、SO_BROADCAST、IPTOS_LOWDELAY、IPTOS_THROUGHPUT、SO_SNDLOWAT （*）、SO_RCVLOWAT（*），带*号的要指定数值。一般如果在本地网络，就只用IPTOS_LOWDELAY,如果是有一个本地网络的，就用 IPTOS_LOWDELAY TCP_NODELAY，如果是广域网络，就试试IPTOS_THROUGHPUT。<br />
<code>hosts allow = 网络或者主机</code><br />
这里可以设置允许访问的网络和主机IP，比如允许192.168.1.0/24和192.168.2.1/32访问，就用<code>host allow = 192.168.1. 192.168.2.1 127.0.0.1</code><br />
<code>interfaces = interface1 interface2</code><br />
如果有多个网络接口，就必须在这里指定。如<code>interface = 192.168.12.2/24 192.168.13.2/24</code><br />
<code>remote browse sync = host(subnet)</code><br />
这里指定浏览列表同步信息从哪里取得， 如果用host（比如192.168.3.25）或者整个子网（192.168.5.255）。<br />
<strong>★什么是浏览（Browse）★</strong><br />
在SMB 协议中，计算机为了访问网络资源，就需要了解网络上存在的资源列表（例如在Windows下使用网络邻居查看可以访问的计算机），这个机制就被称为浏览（Browse）。<br />
虽然SMB协议中经常使用广播的方式，但如果每次都使用广播的方式了解当前的网络资源（包括提供服务的计算机和各个计算机上的服务资源），就需要消耗大量的网络资源和浪费较长的查找时间，因此最好在网络中维护一个网络资源的列表，以方便查找网络资源。只有必要的时候，才重新查找资源，例如使用Windows下的查找计算机功能。<br />
但没有必要每个计算机都维护整个资源列表，维护网络中当前资源列表的任务由网络上的几个特殊计算机完成的，这些计算机被称为Browser，这些Browser通过记录广播数据或查询名字服务器来记录网络上的各种资源。<br />
Browser 并不是事先指定的计算机，而是在普通计算机之间通过自动进行的推举产生的。不同的计算机可以按照其提供服务的能力，设置在推举时具备的不同权重。为了保证一个Browser停机时网络浏览仍然正常，网络中常常存在多个Browser，一个为主Browser（Master Browser），其他的为备份Browser。</p>
<p><code>remote announce = host(subnet)</code><br />
指定这些机器向网络宣告自己，而不是有Browser得到。<br />
<code>local master = yes|no</code><br />
这个参数指定nmbd是否试图成为本地主浏览器，默认值是yes，如果设为no则samba服务器就永远都不会成为本地主浏览器。但即使设置了yes，也不等于samba服务器就会成为本地主浏览器。只是参与本地主浏览器选择。<br />
<code>os level = n</code><br />
n的值是个整数，决定了nmbd是否有机会成为本地广播区域的工作组里的本地主浏览器，默认值是零，零则意味着nmbd失去浏览选择。如果要nmbd更有机会成为本地主浏览器的话，可以设为65。<br />
<code>domain master = yes|no</code><br />
这个参数让nmbd成为一个域浏览器，取得各本地主浏览器的浏览列表，并将整个域的浏览列表递交给各本地主浏览器。<br />
<code>preferred master = yes|no</code><br />
这个参数指定nmbd是否是工作组里的首要的主浏览器，如果指定为yes，nmbd在启动的时候就强制一个浏览选择。</p>
<h4>打印机</h4>
<p><code>printcap name = printcapFile</code><br />
到printcapFile（一般是/etc/printcap）这个文件中取得打印机的描述信息<br />
<code>load printers = yes|no</code><br />
设定是否自动共享打印机而不用设置下面的[printer]一节的相关东西<br />
<code>printing = PrintSystemType</code><br />
定义打印系统的类型，缺省是lprng,可选项有：bsd, sysv, plp, lprng, aix, hpux, qnx。</p>
<h4>日志</h4>
<p><code>log file = LogFileName</code><br />
定义记录文件的位置LogFileName（一般是用/var/log/samba/%m.log）<br />
<code>max log size = size</code><br />
定义记录文件的大小size（单位是KB，如果是0的话就不限大小）</p>
<h3>共享设置</h3>
<h4>共享资源</h4>
<p>每个SMB服务器能对外提供文件或打印服务，每个共享资源需要被给予一个共享名，这个名字将显示在这个服务器的资源列表中。<br />
如果一个资源的名字的最后一个字母为$，则这个共享名就为隐藏共享，不能直接表现在浏览列表中，而只能通过直接访问这个名字来进行访问。<br />
在SMB协议中，为了获得服务器提供的资源列表，必须使用一个隐藏的资源名字IPC$来访问服务器，否则客户无法获得系统资源的列表。</p>
<h4>[homes]资源配置</h4>
<p>在smb.conf文件中一般没有对这个目录的设定特定比如路径等。<br />
当客户机发出服务请求时，就在smb.conf文件的其它部分查找特定内容的服务。如果没有发现这些服务，并且提供了homes段时，那么就搜索密码文件得到用户的Home目录。通过Homes段，Samba可以得到用户的Home 目录并使之共享。<br />
<code>[homes]<br />
comment=Home Directory<br />
browseable=no<br />
writable=yes</code></p>
<h4>共享资源配置</h4>
<p><code>[MyShare]<br />
#1、MyShare指定共享名，一般就是网络邻居里面可以看见的文件夹的名字。<br />
comment = grind’s file<br />
#2、comment指的是对改共享的备注。<br />
path = /home/grind<br />
#3、path 指定共享的路径，其中可以配合samba变量使用。比如你可以指定path=/data/%m，这样如果一台机器的NETBIOS名字是grind,它访问MyShare这个共享的时候就是进入/data/grind目录。<br />
allow hosts = host(subnet)<br />
deny hosts = host(subnet)<br />
#4、和前面的全局设置的方法一样<br />
writable = yes|no<br />
#5、writeable指定了这个目录缺省是否可写，也可以用readonly = no来设置可写。<br />
user = user(@group)<br />
#6、user设置所有可能使用该共享资源的用户，也可以用@group代表group这个组的所有成员，不同的项目之间用空格或者逗号隔开。<br />
valid users = user(@group)<br />
#7、valid users指定能够使用该共享资源的用户和组<br />
invalid users = user(@group)<br />
#8、invalid users指定不能够使用该共享资源的用户和组。<br />
read list = user(@group)<br />
#9、read list 指定只能读取该共享资源的用户和组。<br />
write list = user(@group)<br />
#10、write list指定能读取和写该共享资源的用户和组。<br />
admin list = user(@group)<br />
#11、admin list指定能管理该共享资源（包括读写和权限赋予等）的用户和组<br />
public = yes|no<br />
#12、public指明该共享资源是否能给游客帐号访问，这个开关有时候也叫guest ok，所以有的配置文件中出现guest ok = yes其实和public = yes是一样的。<br />
hide dot files = yes|no<br />
#13、hide dot files指明是不是像unix那样隐藏以“.”号开头的文件。<br />
create mode = 0755<br />
#14、create mode指明新建立的文件的属性，一般是0755。<br />
directory mode = 0755<br />
#15、directory mode指明新建立的目录的属性，一般是0755。<br />
sync always = yes|no<br />
#16、sync always指明对该共享资源进行写操作后是否进行同步操作<br />
short preserve case = yes|no<br />
#17、short preserve case指明不管文件名大小写。<br />
preserve case = yes|no<br />
#18、preserve case指明保持大小写。<br />
case sensitive = yes|no<br />
#19、case sensitive指明是否对大小写敏感，一般选no,不然可能引起错误。<br />
mangle case = yes|no<br />
#20、mangle case指明混合大小写。<br />
default case = upper|lower<br />
#21、default case指明缺省的文件名是全部大写还是小写。<br />
force user = grind<br />
#22、force user强制把建立文件的属主是谁。<br />
wide links = yes|no<br />
#23、wide links指明是否允许共享外符号连接，比如共享资源里面有个连接指向非共享资源里面的文件或者目录，如果设置wide links = no将使该连接不可用。<br />
max connections = 100<br />
#24、max connections = n设定同时连接数是n。<br />
delete readonly = yes|no<br />
#25、delete readonly指明能否删除共享资源里面已经被定义为只读的文件。</code></p>
<h4>光驱共享设置</h4>
<p><code>[cdrom]<br />
comment = grind’s cdrom<br />
path = /mnt/cdrom<br />
public = yes<br />
browseable = yes<br />
root preexec = /bin/mount -t iso9660 /dev/cd0 /mnt/cdrom<br />
root postexec = /bin/umount /mnt/cdrom</code><br />
这里root preexec指明了连接时用root的身份运行mount命令，而root postexec则指明了断开时用root身份运行umount,有效实现了对光驱的共享。</p>
<h4>打印机共享设置</h4>
<p><code>[printers]<br />
path = /var/spool/samba<br />
writeable = no<br />
guest ok = yes<br />
printable = yes<br />
printer driver = HP LaserJet 5L</code><br />
这里printable指明该打印机可以打印， guest ok说明游客也能打印，path指明打印的文件队列暂时放到/var/spool/samba目录下。<br />
printer driver的作用是指明该打印机的类型，这样我们在安装网络打印机的时候可以直接自动安装驱动而不必选择。</p>
<h3>配置示例</h3>
<h4>global 配置</h4>
<p><code>workgroup = WORKGROUP #windows系统工作组<br />
server string = Samba Server Version %v #服务器说明<br />
hosts allow = 192.168.0.0/255.255.0.0<br />
security = user #认证方式<br />
passdb backend = tdbsam #密码存储<br />
load printers = yes #print<br />
cups options = raw #print</code></p>
<h4>共享配置</h4>
<p>[home] #共享名<br />
<code>comment = All Printers #说明<br />
path = /var/spool/samba #路径<br />
browseable = no #是否可以显示 (在网络中看到文件夹)<br />
guest ok = no #在user方式中无效<br />
writable = no #是否可写<br />
printable = yes #是否为打印机<br />
write list = +samba # samba组的用户可写<br />
share modes = no #是SMB服务器是否开启共享模式，<br />
Create mode = 0700</code><br />
[project]<br />
<code>path = /develop/project<br />
public = yes<br />
writable = no<br />
printable = no<br />
browseable = yes<br />
guest ok = yes<br />
write list = zhangly , samba</code><br />
[weekly]<br />
<code>path = /develop/weekly<br />
public = yes<br />
writable = no<br />
printable = no<br />
browseable = yes<br />
guest ok = yes<br />
write list = zhangly , samba</code></p>
            </div>
        </div>
        <!-- 文章内容结束 -->
    </article>


</main><!-- .content-area -->

<div class="footer">
    <div class="container">

<div class="has-text-centered">
Copyright©2015-20178 cn-blogs.cn. All Rights Reserved. 鲁ICP备18001334号-2
</div>
    </div>
  </div>

</body>
</html>
